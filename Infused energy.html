<!DOCTYPE html>
<!-- saved from url=(0087)https://infusedenergy.shop/apps/gbb/easybundle/5?page=addProductsPage1&currentFlow=byob -->
<html class="js bundle-5 gbbBundle-HTML hydrated" lang="de" dir="ltr" data-google-analytics-opt-out="" style="--gbb-product-card-bg-color: #f1f2f3; --gbb-product-card-border-radius: 0px; --gbb-product-card-image-border-radius: 0px; --gbb-product-card-image-fit: cover; --gbb-product-card-per-row-xtra-large-screen: 4; --gbb-product-card-per-row-large-screen: 4; --gbb-product-card-text-color: #252525; --gbb-product-card-title-font-size: 19px; --gbb-product-card-title-font-weight: Bold; --gbb-product-card-final-price-visibility: block; --gbb-product-card-compare-at-price-font-color: #8D8D8D; --gbb-product-card-compare-at-price-font-size: 18px; --gbb-product-card-compare-at-price-font-weight: Regular; --gbb-product-card-compare-at-price-visibility: block; --gbb-product-card-final-price-font-size: 16px; --gbb-product-card-final-price-font-color: #252525; --gbb-product-card-final-price-font-weight: Bold; --gbb-product-card-button-color: #000000; --gbb-product-card-button-text-color: #ffffff; --gbb-product-card-button-border-radius: 0px; --gbb-product-card-allow-only-one-quantity: block; --gbb-product-card-quantity-selector-bg-color: #A5C02F; --gbb-product-card-quantity-selector-btns-bg-color: #000000; --gbb-product-card-quantity-selector-button-text-color: #FFFFFF; --gbb-product-card-quantity-selector-text-color: #000000; --gbb-product-card-quantity-selector-border-radius: 6px; --gbb-navigation-banner-title-color: #ffffff; --gbb-navigation-banner-text-color: #ffffff; --gbb-navigation-banner-step-completion-color: #A5C02F; --gbb-navigation-banner-step-done-color: #000000; --gbb-navigation-banner-step-text-color: #000000; --gbb-navigation-banner-step-progress-bar-filled-color: #A5C02F; --gbb-navigation-banner-step-progress-bar-empty-color: #E7EBD1; --gbb-navigation-banner-step-text-font-size: 16px; --gbb-navigation-banner-check-color: #ffffff; --gbb-navigation-banner-step-completed-border-color: #000000; --gbb-navigation-banner-step-completed-border-width: 4px; --gbb-navigation-banner-step-incomplete-bg-color: #E7EBD1; --gbb-navigation-banner-step-incomplete-border-color: #cccccc; --gbb-navigation-banner-step-incomplete-border-width: 4px; --gbb-navigation-banner-tabs-active-bg-color: #81bc29; --gbb-navigation-banner-tabs-active-text-color: #000; --gbb-navigation-banner-tabs-inactive-bg-color: #FFFFFF; --gbb-navigation-banner-tabs-inactive-text-color: #000; --gbb-navigation-banner-tabs-border-color: #000; --gbb-navigation-banner-tabs-corner-radius: 0px; --gbb-cart-footer-bg-color: #000000; --gbb-cart-footer-buttons-container-bg-color: #000000; --gbb-cart-footer-border-radius: 0px; --gbb-cart-footer-product-image-border-radius: 0px; --gbb-cart-footer-buttons-container-border-radius: 0px; --gbb-cart-footer-show-hide-prices: visible; --gbb-cart-footer-text-color: #ffffff; --gbb-cart-footer-strikethrough-price-color: #8D8D8D; --gbb-cart-footer-final-price-font-color: #ffffff; --gbb-cart-footer-final-price-font-thickness: Bold; --gbb-cart-footer-strikethrough-price-font-thickness: Regular; --gbb-cart-footer-back-button-color: #000000; --gbb-cart-footer-back-button-text-color: #ffffff; --gbb-cart-footer-back-button-border-color: #000000; --gbb-cart-footer-back-button-border-thickness: 2px; --gbb-cart-footer-next-button-text-color: #000000; --gbb-cart-footer-next-button-color: #A5C02F; --gbb-cart-footer-next-button-border-color: #000000; --gbb-cart-footer-next-button-border-thickness: 2px; --gbb-cart-footer-buttons-border-radius: 0px; --gbb-cart-footer-buttons-padding: 10px; --gbb-cart-footer-discount-text-color: #ffffff; --gbb-cart-footer-discount-progress-bar-empty-color: #E7EBD1; --gbb-cart-footer-discount-progress-bar-filled-color: #A5C02F; --gbb-cart-footer-discount-text-visibility: visible; --gbb-cart-footer-total-label-color: #ffffff;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<style>#trustedshops-productreviews-sticker-wrapper {margin: 20px 20px 0 20px;}</style><script type="text/javascript" charset="utf-8" async="" src="./Infused energy_files/XF7A7FF3042B3B87EAE4465804149BBBD.js.download"></script><script type="text/javascript" async="" src="./Infused energy_files/facebook-track.js.download"></script><script type="text/javascript" async="" src="./Infused energy_files/tiktok-track.js.download"></script><script type="text/javascript" async="" src="./Infused energy_files/charles-snippet.js.download"></script><script type="text/javascript" async="" src="./Infused energy_files/trustedshops_shopify.js.download"></script><script type="text/javascript" async="" src="./Infused energy_files/loader.js.download"></script><script type="text/javascript" async="" src="./Infused energy_files/covet-pics-widget-inject.js.download"></script><script async="" src="./Infused energy_files/clarity.js.download"></script><script async="true" src="./Infused energy_files/fbevents.js.download"></script><script type="text/javascript" async="" src="./Infused energy_files/trekkie.storefront.c44d6898594db6c4847cb75ef4de7d5f4456a012.min.js.download"></script><script async="" src="./Infused energy_files/q1geqafakq"></script><script>
  window.consentmo_gcm_initial_state = "1";
  window.consentmo_gcm_state = "1";
  window.consentmo_gcm_security_storage = "strict";
  window.consentmo_gcm_ad_storage = "marketing";
  window.consentmo_gcm_analytics_storage = "analytics";
  window.consentmo_gcm_functionality_storage = "functionality";
  window.consentmo_gcm_personalization_storage = "functionality";
  window.consentmo_gcm_ads_data_redaction = "true";
  window.consentmo_gcm_url_passthrough = "true";
  window.consentmo_gcm_data_layer_name = "dataLayer";
  
  // Google Consent Mode V2 integration script from Consentmo GDPR
  window.isenseRules = {};
  window.isenseRules.gcm = {
      gcmVersion: 2,
      integrationVersion: 3,
      customChanges: false,
      consentUpdated: false,
      initialState: 7,
      isCustomizationEnabled: false,
      adsDataRedaction: true,
      urlPassthrough: false,
      dataLayer: 'dataLayer',
      categories: { ad_personalization: "marketing", ad_storage: "marketing", ad_user_data: "marketing", analytics_storage: "analytics", functionality_storage: "functionality", personalization_storage: "functionality", security_storage: "strict"},
      storage: { ad_personalization: "false", ad_storage: "false", ad_user_data: "false", analytics_storage: "false", functionality_storage: "false", personalization_storage: "false", security_storage: "false", wait_for_update: 2000 }
  };
  if(window.consentmo_gcm_state !== null && window.consentmo_gcm_state !== "" && window.consentmo_gcm_state !== "0") {
    window.isenseRules.gcm.isCustomizationEnabled = true;
    window.isenseRules.gcm.initialState = window.consentmo_gcm_initial_state === null || window.consentmo_gcm_initial_state.trim() === "" ? window.isenseRules.gcm.initialState : window.consentmo_gcm_initial_state;
    window.isenseRules.gcm.categories.ad_storage = window.consentmo_gcm_ad_storage === null || window.consentmo_gcm_ad_storage.trim() === "" ? window.isenseRules.gcm.categories.ad_storage : window.consentmo_gcm_ad_storage;
    window.isenseRules.gcm.categories.ad_user_data = window.consentmo_gcm_ad_storage === null || window.consentmo_gcm_ad_storage.trim() === "" ? window.isenseRules.gcm.categories.ad_user_data : window.consentmo_gcm_ad_storage;
    window.isenseRules.gcm.categories.ad_personalization = window.consentmo_gcm_ad_storage === null || window.consentmo_gcm_ad_storage.trim() === "" ? window.isenseRules.gcm.categories.ad_personalization : window.consentmo_gcm_ad_storage;
    window.isenseRules.gcm.categories.analytics_storage = window.consentmo_gcm_analytics_storage === null || window.consentmo_gcm_analytics_storage.trim() === "" ? window.isenseRules.gcm.categories.analytics_storage : window.consentmo_gcm_analytics_storage;
    window.isenseRules.gcm.categories.functionality_storage = window.consentmo_gcm_functionality_storage === null || window.consentmo_gcm_functionality_storage.trim() === "" ? window.isenseRules.gcm.categories.functionality_storage : window.consentmo_gcm_functionality_storage;
    window.isenseRules.gcm.categories.personalization_storage = window.consentmo_gcm_personalization_storage === null || window.consentmo_gcm_personalization_storage.trim() === "" ? window.isenseRules.gcm.categories.personalization_storage : window.consentmo_gcm_personalization_storage;
    window.isenseRules.gcm.categories.security_storage = window.consentmo_gcm_security_storage === null || window.consentmo_gcm_security_storage.trim() === "" ? window.isenseRules.gcm.categories.security_storage : window.consentmo_gcm_security_storage;
    window.isenseRules.gcm.urlPassthrough = window.consentmo_gcm_url_passthrough === null || window.consentmo_gcm_url_passthrough.trim() === "" ? window.isenseRules.gcm.urlPassthrough : window.consentmo_gcm_url_passthrough;
    window.isenseRules.gcm.adsDataRedaction = window.consentmo_gcm_ads_data_redaction === null || window.consentmo_gcm_ads_data_redaction.trim() === "" ? window.isenseRules.gcm.adsDataRedaction : window.consentmo_gcm_ads_data_redaction;
    window.isenseRules.gcm.dataLayer = window.consentmo_gcm_data_layer_name === null || window.consentmo_gcm_data_layer_name.trim() === "" ? window.isenseRules.gcm.dataLayer : window.consentmo_gcm_data_layer_name;
  }
  window.isenseRules.initializeGcm = function (rules) {
    if(window.isenseRules.gcm.isCustomizationEnabled) {
      rules.initialState = window.isenseRules.gcm.initialState;
      rules.urlPassthrough = window.isenseRules.gcm.urlPassthrough === true || window.isenseRules.gcm.urlPassthrough === 'true';
      rules.adsDataRedaction = window.isenseRules.gcm.adsDataRedaction === true || window.isenseRules.gcm.adsDataRedaction === 'true';
    }
    
    let initialState = parseInt(rules.initialState);
    let marketingBlocked = initialState === 0 || initialState === 2 || initialState === 5 || initialState === 7;
    let analyticsBlocked = initialState === 0 || initialState === 3 || initialState === 6 || initialState === 7;
    let functionalityBlocked = initialState === 4 || initialState === 5 || initialState === 6 || initialState === 7;

    let gdprCache = localStorage.getItem('gdprCache') ? JSON.parse(localStorage.getItem('gdprCache')) : null;
    if (gdprCache && typeof gdprCache.updatedPreferences !== "undefined") {
      let updatedPreferences = gdprCache.updatedPreferences;
      marketingBlocked = parseInt(updatedPreferences.indexOf('marketing')) > -1;
      analyticsBlocked = parseInt(updatedPreferences.indexOf('analytics')) > -1;
      functionalityBlocked = parseInt(updatedPreferences.indexOf('functionality')) > -1;
    }

    Object.entries(rules.categories).forEach(category => {
      if(rules.storage.hasOwnProperty(category[0])) {
        switch(category[1]) {
          case 'strict':
            rules.storage[category[0]] = "granted";
            break;
          case 'marketing':
            rules.storage[category[0]] = marketingBlocked ? "denied" : "granted";
            break;
          case 'analytics':
            rules.storage[category[0]] = analyticsBlocked ? "denied" : "granted";
            break;
          case 'functionality':
            rules.storage[category[0]] = functionalityBlocked ? "denied" : "granted";
            break;
        }
      }
    });
    rules.consentUpdated = true;
    isenseRules.gcm = rules;
  }

  // Google Consent Mode - initialization start
  window.isenseRules.initializeGcm({
    ...window.isenseRules.gcm,
    adsDataRedaction: true,
    urlPassthrough: false,
    initialState: 7
  });

  /*
  * initialState acceptable values:
  * 0 - Set both ad_storage and analytics_storage to denied
  * 1 - Set all categories to granted
  * 2 - Set only ad_storage to denied
  * 3 - Set only analytics_storage to denied
  * 4 - Set only functionality_storage to denied
  * 5 - Set both ad_storage and functionality_storage to denied
  * 6 - Set both analytics_storage and functionality_storage to denied
  * 7 - Set all categories to denied
  */

  window[window.isenseRules.gcm.dataLayer] = window[window.isenseRules.gcm.dataLayer] || [];
  function gtag() { window[window.isenseRules.gcm.dataLayer].push(arguments); }
  gtag("consent", "default", isenseRules.gcm.storage);
  isenseRules.gcm.adsDataRedaction && gtag("set", "ads_data_redaction", isenseRules.gcm.adsDataRedaction);
  isenseRules.gcm.urlPassthrough && gtag("set", "url_passthrough", isenseRules.gcm.urlPassthrough);
</script>    
    
    <!-- Ablyft script -->
    <script src="./Infused energy_files/15968522.js.download"></script>
    <!-- Ablyft script -->

    <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "q1geqafakq");
</script>
   
    <style data-styles="">covet-pics-crop-text,covet-pics-direct-buy,covet-pics-gallery-grid,covet-pics-gallery-header,covet-pics-gallery-item,covet-pics-gallery-item-caption,covet-pics-gallery-item-detail,covet-pics-gallery-slider,covet-pics-highlighted,covet-pics-highlighted-hotspots,covet-pics-highlighted-page,covet-pics-hotspots,covet-pics-popup,covet-pics-popup-links,covet-pics-popup-review,covet-pics-popup-shared-links,covet-pics-popup-slider,covet-pics-post,covet-pics-star-rating,covet-pics-upload,covet-pics-widget{visibility:hidden}.hydrated{visibility:inherit}</style>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="theme-color" content="#111111">
    <link rel="canonical" href="https://infusedenergy.shop/apps/gbb/easybundle/5?page=addproductspage1">
    <link rel="preconnect" href="https://cdn.shopify.com/">
    <link rel="preconnect" href="https://fonts.shopifycdn.com/">
    <link rel="dns-prefetch" href="https://productreviews.shopifycdn.com/">
    <link rel="dns-prefetch" href="https://ajax.googleapis.com/">
    <link rel="dns-prefetch" href="https://maps.googleapis.com/">
    <link rel="dns-prefetch" href="https://maps.gstatic.com/"><link rel="shortcut icon" href="https://infusedenergy.shop/cdn/shop/files/fvicon_leaf_ae65b3b1-254a-4506-ab2b-8315fed445f2_32x32.png?v=1681573848" type="image/png"><title>Infused energy
</title>
<meta property="og:site_name" content="Infused energy">
  <meta property="og:url" content="https://infusedenergy.shop/apps/gbb/easybundle/5?page=addproductspage1">
  <meta property="og:title" content="Infused energy">
  <meta property="og:type" content="website">
  <meta property="og:description" content="Auf gesunde und wohltuende Weise wach und fit mit Infused energy®. Basierend auf 100% pflanzlichen Zutaten ökologischer Landwirtschaft."><meta property="og:image" content="http://infusedenergy.shop/cdn/shop/files/IN_1-3_Tagen_bei_dir_c370d52e-93f6-49ad-a829-a30f07a64b93.png?v=1681548589">
    <meta property="og:image:secure_url" content="https://infusedenergy.shop/cdn/shop/files/IN_1-3_Tagen_bei_dir_c370d52e-93f6-49ad-a829-a30f07a64b93.png?v=1681548589">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="628"><meta name="twitter:site" content="@">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Infused energy">
  <meta name="twitter:description" content="Auf gesunde und wohltuende Weise wach und fit mit Infused energy®. Basierend auf 100% pflanzlichen Zutaten ökologischer Landwirtschaft.">
<style data-shopify="">@font-face {
  font-family: "ITC Avant Garde Gothic";
  font-weight: 700;
  font-style: normal;
  font-display: swap;
  src: url("//infusedenergy.shop/cdn/fonts/itc_avant_garde_gothic/itcavantgardegothic_n7.e4cdcda7001c6328cfe571734c25261390a886d4.woff2?h1=aW5mdXNlZGVuZXJneS5zaG9w&h2=aW5mdXNlZGVuZXJneS5kZQ&h3=aW5mdXNlZC1kcmlua3MuYWNjb3VudC5teXNob3BpZnkuY29t&hmac=87b926986fa089a1391362f40db73b5361efaca142a1d913fe54ca2ab80425c5") format("woff2"),
       url("//infusedenergy.shop/cdn/fonts/itc_avant_garde_gothic/itcavantgardegothic_n7.92961a6809350e21152cba06e9fa88f81a23d481.woff?h1=aW5mdXNlZGVuZXJneS5zaG9w&h2=aW5mdXNlZGVuZXJneS5kZQ&h3=aW5mdXNlZC1kcmlua3MuYWNjb3VudC5teXNob3BpZnkuY29t&hmac=819aa8e7594978b652f6902e84019391dada2189112aed494432274b6f1f9514") format("woff");
}

  @font-face {
  font-family: Futura;
  font-weight: 400;
  font-style: normal;
  font-display: swap;
  src: url("//infusedenergy.shop/cdn/fonts/futura/futura_n4.df36ce3d9db534a4d7947f4aa825495ed740e410.woff2?h1=aW5mdXNlZGVuZXJneS5zaG9w&h2=aW5mdXNlZGVuZXJneS5kZQ&h3=aW5mdXNlZC1kcmlua3MuYWNjb3VudC5teXNob3BpZnkuY29t&hmac=cd0eecaa17bfa8f542ad0738eb6b57695a4be9d26bd3cba99129a6ef34513899") format("woff2"),
       url("//infusedenergy.shop/cdn/fonts/futura/futura_n4.6bce24beb4ba1ff4ddeb20f7cd6e2fa513a3d6ec.woff?h1=aW5mdXNlZGVuZXJneS5zaG9w&h2=aW5mdXNlZGVuZXJneS5kZQ&h3=aW5mdXNlZC1kcmlua3MuYWNjb3VudC5teXNob3BpZnkuY29t&hmac=f6a2253b030b4ca03075b3bece86ac5e2b9150664472b8baabd012fbcb93407c") format("woff");
}


  @font-face {
  font-family: Futura;
  font-weight: 600;
  font-style: normal;
  font-display: swap;
  src: url("//infusedenergy.shop/cdn/fonts/futura/futura_n6.bbe2e25d5b96d13ff36b242171a3d07cf5a60170.woff2?h1=aW5mdXNlZGVuZXJneS5zaG9w&h2=aW5mdXNlZGVuZXJneS5kZQ&h3=aW5mdXNlZC1kcmlua3MuYWNjb3VudC5teXNob3BpZnkuY29t&hmac=b5509b80941d47d493c6894685c29e6e26619afc9cc38e82c39122073f344dda") format("woff2"),
       url("//infusedenergy.shop/cdn/fonts/futura/futura_n6.66fa8f5c3c4b2c7c04809ecefe751450fa59d995.woff?h1=aW5mdXNlZGVuZXJneS5zaG9w&h2=aW5mdXNlZGVuZXJneS5kZQ&h3=aW5mdXNlZC1kcmlua3MuYWNjb3VudC5teXNob3BpZnkuY29t&hmac=a81890dcea23c30aa6ef73d8c37f714ea93c852dffe9f611db00bb5d822aa839") format("woff");
}

  @font-face {
  font-family: Futura;
  font-weight: 400;
  font-style: oblique;
  font-display: swap;
  src: url("//infusedenergy.shop/cdn/fonts/futura/futura_o4.9747e2e6ed2f11b894984527c927b42234e48815.woff2?h1=aW5mdXNlZGVuZXJneS5zaG9w&h2=aW5mdXNlZGVuZXJneS5kZQ&h3=aW5mdXNlZC1kcmlua3MuYWNjb3VudC5teXNob3BpZnkuY29t&hmac=93b75c27026d0384b84718632570a500df234da117348de238290b3415d276fa") format("woff2"),
       url("//infusedenergy.shop/cdn/fonts/futura/futura_o4.d5edc6b1d9a050bbe0beb9093d73b883bf18c6c1.woff?h1=aW5mdXNlZGVuZXJneS5zaG9w&h2=aW5mdXNlZGVuZXJneS5kZQ&h3=aW5mdXNlZC1kcmlua3MuYWNjb3VudC5teXNob3BpZnkuY29t&hmac=91cc5322076bc9f3b130242a58ae71010f5dda8d532a3cbaa48047e75c8d7d06") format("woff");
}

  @font-face {
  font-family: Futura;
  font-weight: 600;
  font-style: oblique;
  font-display: swap;
  src: url("//infusedenergy.shop/cdn/fonts/futura/futura_o6.2978dbd38bd9b3e8b72ee3299cd940da2900eb72.woff2?h1=aW5mdXNlZGVuZXJneS5zaG9w&h2=aW5mdXNlZGVuZXJneS5kZQ&h3=aW5mdXNlZC1kcmlua3MuYWNjb3VudC5teXNob3BpZnkuY29t&hmac=ae43b9026b95488c6827994a1354ed03a5b00a79ea8d67fb45ca384d84473b32") format("woff2"),
       url("//infusedenergy.shop/cdn/fonts/futura/futura_o6.bbc5bc6e7a675b3182e4866da9f9643bb3821261.woff?h1=aW5mdXNlZGVuZXJneS5zaG9w&h2=aW5mdXNlZGVuZXJneS5kZQ&h3=aW5mdXNlZC1kcmlua3MuYWNjb3VudC5teXNob3BpZnkuY29t&hmac=5b4d79b5bee034c7b1ac1ad21fed9dfdb256b5720401f2e7617d713de1142944") format("woff");
}

</style><link href="./Infused energy_files/theme.css" rel="stylesheet" type="text/css" media="all">
    <link href="./Infused energy_files/custom.css" rel="stylesheet" type="text/css" media="all">
<style data-shopify="">:root {
    --typeHeaderPrimary: "ITC Avant Garde Gothic";
    --typeHeaderFallback: sans-serif;
    --typeHeaderSize: 35px;
    --typeHeaderWeight: 700;
    --typeHeaderLineHeight: 1.2;
    --typeHeaderSpacing: 0.0em;

    --typeBasePrimary:Futura;
    --typeBaseFallback:sans-serif;
    --typeBaseSize: 17px;
    --typeBaseWeight: 400;
    --typeBaseLineHeight: 1.6;
    --typeBaseSpacing: 0.025em;

    --iconWeight: 3px;
    --iconLinecaps: miter;
  }

  
.collection-hero__content:before,
  .hero__image-wrapper:before,
  .hero__media:before {
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0.0) 0%, rgba(0, 0, 0, 0.0) 40%, rgba(0, 0, 0, 0.62) 100%);
  }

  .skrim__item-content .skrim__overlay:after {
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0.0) 30%, rgba(0, 0, 0, 0.62) 100%);
  }

  .placeholder-content {
    background-image: linear-gradient(100deg, #ffffff 40%, #f7f7f7 63%, #ffffff 79%);
  }</style>
    <script>
      document.documentElement.className = document.documentElement.className.replace('no-js', 'js');

      window.theme = window.theme || {};
      theme.routes = {
        home: "/",
        cart: "/cart.js",
        cartPage: "/cart",
        cartAdd: "/cart/add.js",
        cartChange: "/cart/change.js",
        search: "/search"
      };
      theme.strings = {
        soldOut: "Ausverkauft",
        unavailable: "Nicht verfügbar",
        inStockLabel: "Auf Lager",
        oneStockLabel: "",
        otherStockLabel: "",
        willNotShipUntil: "Wird nach dem [date] versendet",
        willBeInStockAfter: "Wird nach dem [date] auf Lager sein",
        waitingForStock: "Inventar auf dem Weg",
        cartSavings: "Sie sparen [savings]",
        cartEmpty: "Ihr Einkaufswagen ist im Moment leer.",
        cartTermsConfirmation: "Sie müssen den Verkaufsbedingungen zustimmen, um auszuchecken",
        searchCollections: "Kollektionen:",
        searchPages: "Seiten:",
        searchArticles: "Artikel:"
      };
      theme.settings = {
        cartType: "page",
        isCustomerTemplate: false,
        moneyFormat: "€{{amount_with_comma_separator}}",
        predictiveSearch: true,
        predictiveSearchType: "product,article,page,collection",
        quickView: false,
        themeName: 'Motion',
        themeVersion: "10.0.0"
      };
    </script>

    <script>window.performance && window.performance.mark && window.performance.mark('shopify.content_for_header.start');</script><meta name="google-site-verification" content="29RT5B8oCQnq3I4G51FZqayWy3FoRYqNrhajYwBrJmk">
<meta name="facebook-domain-verification" content="pshlteqg9di4inghjub5r3wkw869ac">
<meta id="shopify-digital-wallet" name="shopify-digital-wallet" content="/9397043260/digital_wallets/dialog">
<meta name="shopify-checkout-api-token" content="f7e001a61a52619c81af18fe55ed1346">
<meta id="in-context-paypal-metadata" data-shop-id="9397043260" data-venmo-supported="false" data-environment="production" data-locale="de_DE" data-paypal-v4="true" data-currency="EUR">
<script async="async" src="./Infused energy_files/preloads.js.download"></script>
<link rel="preconnect" href="https://shop.app/" crossorigin="anonymous">
<script async="async" src="./Infused energy_files/preloads(1).js.download" crossorigin="anonymous"></script>
<script id="apple-pay-shop-capabilities" type="application/json">{"shopId":9397043260,"countryCode":"DE","currencyCode":"EUR","merchantCapabilities":["supports3DS"],"merchantId":"gid:\/\/shopify\/Shop\/9397043260","merchantName":"Infused energy","requiredBillingContactFields":["postalAddress","email"],"requiredShippingContactFields":["postalAddress","email"],"shippingType":"shipping","supportedNetworks":["visa","maestro","masterCard","amex"],"total":{"type":"pending","label":"Infused energy","amount":"1.00"},"shopifyPaymentsEnabled":true,"supportsSubscriptions":false}</script>
<script id="shopify-features" type="application/json">{"accessToken":"f7e001a61a52619c81af18fe55ed1346","betas":["rich-media-storefront-analytics"],"domain":"infusedenergy.shop","predictiveSearch":true,"shopId":9397043260,"smart_payment_buttons_url":"https:\/\/infusedenergy.shop\/cdn\/shopifycloud\/payment-sheet\/assets\/latest\/spb.de.js","dynamic_checkout_cart_url":"https:\/\/infusedenergy.shop\/cdn\/shopifycloud\/payment-sheet\/assets\/latest\/dynamic-checkout-cart.de.js","locale":"de"}</script>
<script>var Shopify = Shopify || {};
Shopify.shop = "infused-drinks.myshopify.com";
Shopify.locale = "de";
Shopify.currency = {"active":"EUR","rate":"1.0"};
Shopify.country = "DE";
Shopify.theme = {"name":" Infused-Energy-Shopify\/dev","id":143165587722,"schema_name":"Motion","schema_version":"10.0.0","theme_store_id":null,"role":"main"};
Shopify.theme.handle = "null";
Shopify.theme.style = {"id":null,"handle":null};
Shopify.cdnHost = "infusedenergy.shop/cdn";
Shopify.routes = Shopify.routes || {};
Shopify.routes.root = "/";</script>
<script type="module">!function(o){(o.Shopify=o.Shopify||{}).modules=!0}(window);</script>
<script>!function(o){function n(){var o=[];function n(){o.push(Array.prototype.slice.apply(arguments))}return n.q=o,n}var t=o.Shopify=o.Shopify||{};t.loadFeatures=n(),t.autoloadFeatures=n()}(window);</script>
<script>window.ShopifyPay = window.ShopifyPay || {};
window.ShopifyPay.apiHost = "shop.app\/pay";</script>
<script>
  window.Shopify = window.Shopify || {};
  if (!window.Shopify.featureAssets) window.Shopify.featureAssets = {};
  window.Shopify.featureAssets['shop-js'] = {"init-fed-cm":["modules/v2/client.init-fed-cm_BsrfTLNc.de.esm.js","modules/v2/chunk.common_C-c9Lh-p.esm.js"],"shop-cash-offers":["modules/v2/client.shop-cash-offers_D0Yzs0hR.de.esm.js","modules/v2/chunk.common_C-c9Lh-p.esm.js","modules/v2/chunk.modal_BQsrVM38.esm.js"],"init-shop-email-lookup-coordinator":["modules/v2/client.init-shop-email-lookup-coordinator_ENRsFuV8.de.esm.js","modules/v2/chunk.common_C-c9Lh-p.esm.js"],"shop-toast-manager":["modules/v2/client.shop-toast-manager_CpWvagY2.de.esm.js","modules/v2/chunk.common_C-c9Lh-p.esm.js"],"checkout-modal":["modules/v2/client.checkout-modal_C7sSGYkE.de.esm.js","modules/v2/chunk.common_C-c9Lh-p.esm.js","modules/v2/chunk.modal_BQsrVM38.esm.js"],"avatar":["modules/v2/client.avatar_BTnouDA3.de.esm.js"],"pay-button":["modules/v2/client.pay-button_Dqld5l2Y.de.esm.js","modules/v2/chunk.common_C-c9Lh-p.esm.js"],"shop-login-button":["modules/v2/client.shop-login-button_5E_QVA3t.de.esm.js","modules/v2/chunk.common_C-c9Lh-p.esm.js","modules/v2/chunk.modal_BQsrVM38.esm.js"],"init-customer-accounts-sign-up":["modules/v2/client.init-customer-accounts-sign-up_DshdRwwk.de.esm.js","modules/v2/client.shop-login-button_5E_QVA3t.de.esm.js","modules/v2/chunk.common_C-c9Lh-p.esm.js","modules/v2/chunk.modal_BQsrVM38.esm.js"],"init-shop-for-new-customer-accounts":["modules/v2/client.init-shop-for-new-customer-accounts_Ze3eJKZO.de.esm.js","modules/v2/client.shop-login-button_5E_QVA3t.de.esm.js","modules/v2/chunk.common_C-c9Lh-p.esm.js","modules/v2/chunk.modal_BQsrVM38.esm.js"],"init-customer-accounts":["modules/v2/client.init-customer-accounts_Oo_n3IUP.de.esm.js","modules/v2/client.shop-login-button_5E_QVA3t.de.esm.js","modules/v2/chunk.common_C-c9Lh-p.esm.js","modules/v2/chunk.modal_BQsrVM38.esm.js"],"shop-follow-button":["modules/v2/client.shop-follow-button_DSlID_4_.de.esm.js","modules/v2/chunk.common_C-c9Lh-p.esm.js","modules/v2/chunk.modal_BQsrVM38.esm.js"],"lead-capture":["modules/v2/client.lead-capture_Bg8kbA8t.de.esm.js","modules/v2/chunk.common_C-c9Lh-p.esm.js","modules/v2/chunk.modal_BQsrVM38.esm.js"],"payment-terms":["modules/v2/client.payment-terms_CSh1mFk-.de.esm.js","modules/v2/chunk.common_C-c9Lh-p.esm.js","modules/v2/chunk.modal_BQsrVM38.esm.js"]};
</script>
<script>(function() {
  function asyncLoad() {
    var urls = ["https:\/\/shopify.covet.pics\/covet-pics-widget-inject.js?shop=infused-drinks.myshopify.com","\/\/cdn.shopify.com\/proxy\/1ff389f1899b7ce12e9d0b09e427495c3a066c7eb31ac33ce70aefab3ed32013\/api.goaffpro.com\/loader.js?shop=infused-drinks.myshopify.com\u0026sp-cache-control=cHVibGljLCBtYXgtYWdlPTkwMA","https:\/\/cdn.shopify.com\/s\/files\/1\/0093\/9704\/3260\/t\/22\/assets\/trustedshops_shopify.js?v=1665736701\u0026shop=infused-drinks.myshopify.com","https:\/\/cdn.hello-charles.com\/charles-satellite\/1.x\/charles-snippet.js?proxy_vendor=shopify\u0026universe_uri=https:\/\/infusedenergy.hello-charles.com\u0026script_id=28c2b3f3-1e68-4649-91cf-ac98ad9ba2bf\u0026shop=infused-drinks.myshopify.com","https:\/\/cdn.adtrace.ai\/tiktok-track.js?shop=infused-drinks.myshopify.com","https:\/\/cdn.adtrace.ai\/facebook-track.js?shop=infused-drinks.myshopify.com"];
    for (var i = 0; i < urls.length; i++) {
      var s = document.createElement('script');
      s.type = 'text/javascript';
      s.async = true;
      s.src = urls[i];
      var x = document.getElementsByTagName('script')[0];
      x.parentNode.insertBefore(s, x);
    }
  };
  if(window.attachEvent) {
    window.attachEvent('onload', asyncLoad);
  } else {
    window.addEventListener('load', asyncLoad, false);
  }
})();</script>
<script id="__st">var __st={"a":9397043260,"offset":3600,"reqid":"4b36c0ca-7a37-4cd2-85f4-fdcf074d3e43-1738917792","pageurl":"infusedenergy.shop\/apps\/gbb\/easybundle\/5?page=addProductsPage1\u0026currentFlow=byob","t":"prospect","u":"ea14ce24afe5"};</script>
<script>window.ShopifyPaypalV4VisibilityTracking = true;</script>
<script id="form-persister">!function(){'use strict';const t='contact',e='new_comment',n=[[t,t],['blogs',e],['comments',e],[t,'customer']],o='password',r='form_key',c=['recaptcha-v3-token','g-recaptcha-response','h-captcha-response',o],s=()=>{try{return window.sessionStorage}catch{return}},i='__shopify_v',u=t=>t.elements[r],a=function(){const t=[...n].map((([t,e])=>`form[action*='/${t}']:not([data-nocaptcha='true']) input[name='form_type'][value='${e}']`)).join(',');var e;return e=t,()=>e?[...document.querySelectorAll(e)].map((t=>t.form)):[]}();function m(t){const e=u(t);a().includes(t)&&(!e||!e.value)&&function(t){try{if(!s())return;!function(t){const e=s();if(!e)return;const n=u(t);if(!n)return;const o=n.value;o&&e.removeItem(o)}(t);const e=Array.from(Array(32),(()=>Math.random().toString(36)[2])).join('');!function(t,e){u(t)||t.append(Object.assign(document.createElement('input'),{type:'hidden',name:r})),t.elements[r].value=e}(t,e),function(t,e){const n=s();if(!n)return;const r=[...t.querySelectorAll(`input[type='${o}']`)].map((({name:t})=>t)),u=[...c,...r],a={};for(const[o,c]of new FormData(t).entries())u.includes(o)||(a[o]=c);n.setItem(e,JSON.stringify({[i]:1,action:t.action,data:a}))}(t,e)}catch(e){console.error('failed to persist form',e)}}(t)}const f=t=>{if('true'===t.dataset.persistBound)return;const e=function(t,e){const n=function(t){return'function'==typeof t.submit?t.submit:HTMLFormElement.prototype.submit}(t).bind(t);return function(){let t;return()=>{t||(t=!0,(()=>{try{e(),n()}catch(t){(t=>{console.error('form submit failed',t)})(t)}})(),setTimeout((()=>t=!1),250))}}()}(t,(()=>{m(t)}));!function(t,e){if('function'==typeof t.submit&&'function'==typeof e)try{t.submit=e}catch{}}(t,e),t.addEventListener('submit',(t=>{t.preventDefault(),e()})),t.dataset.persistBound='true'};!function(){function t(t){const e=(t=>{const e=t.target;return e instanceof HTMLFormElement?e:e&&e.form})(t);e&&m(e)}document.addEventListener('submit',t),document.addEventListener('DOMContentLoaded',(()=>{const e=a();for(const t of e)f(t);var n;n=document.body,new window.MutationObserver((t=>{for(const e of t)if('childList'===e.type&&e.addedNodes.length)for(const t of e.addedNodes)1===t.nodeType&&'FORM'===t.tagName&&a().includes(t)&&f(t)})).observe(n,{childList:!0,subtree:!0,attributes:!1}),document.removeEventListener('submit',t)}))}()}();</script>
<script integrity="sha256-EGCDRYTvIEOXsReXgqGwkAR+5Dl8tickSrieA/ZcQwc=" data-source-attribution="shopify.loadfeatures" defer="defer" src="./Infused energy_files/load_feature-1060834584ef204397b1179782a1b090047ee4397cb627244ab89e03f65c4307.js.download" crossorigin="anonymous"></script>
<script crossorigin="anonymous" defer="defer" src="./Infused energy_files/storefront-80e528be853eac23af2454534897ca9536b1d3d04aa043b042f34879a3c111c8.js.download"></script>
<script data-source-attribution="shopify.dynamic_checkout.dynamic.init">var Shopify=Shopify||{};Shopify.PaymentButton=Shopify.PaymentButton||{isStorefrontPortableWallets:!0,init:function(){window.Shopify.PaymentButton.init=function(){};var t=document.createElement("script");t.src="https://infusedenergy.shop/cdn/shopifycloud/portable-wallets/latest/portable-wallets.de.js",t.type="module",document.head.appendChild(t)}};
</script>
<script data-source-attribution="shopify.dynamic_checkout.buyer_consent">
  function portableWalletsHideBuyerConsent(e){var t=document.getElementById("shopify-buyer-consent"),n=document.getElementById("shopify-subscription-policy-button");t&&n&&(t.classList.add("hidden"),t.setAttribute("aria-hidden","true"),n.removeEventListener("click",e))}function portableWalletsShowBuyerConsent(e){var t=document.getElementById("shopify-buyer-consent"),n=document.getElementById("shopify-subscription-policy-button");t&&n&&(t.classList.remove("hidden"),t.removeAttribute("aria-hidden"),n.addEventListener("click",e))}window.Shopify?.PaymentButton&&(window.Shopify.PaymentButton.hideBuyerConsent=portableWalletsHideBuyerConsent,window.Shopify.PaymentButton.showBuyerConsent=portableWalletsShowBuyerConsent);
</script>
<script data-source-attribution="shopify.dynamic_checkout.cart.bootstrap">document.addEventListener("DOMContentLoaded",(function(){function t(){return document.querySelector("shopify-accelerated-checkout-cart, shopify-accelerated-checkout")}if(t())Shopify.PaymentButton.init();else{new MutationObserver((function(e,n){t()&&(Shopify.PaymentButton.init(),n.disconnect())})).observe(document.body,{childList:!0,subtree:!0})}}));
</script>

<link rel="stylesheet" media="screen" href="./Infused energy_files/accelerated-checkout-backwards-compat.css" crossorigin="anonymous">

<style id="shopify-accelerated-checkout-cart">
        #shopify-buyer-consent {
  margin-top: 1em;
  display: inline-block;
  width: 100%;
}

#shopify-buyer-consent.hidden {
  display: none;
}

#shopify-subscription-policy-button {
  background: none;
  border: none;
  padding: 0;
  text-decoration: underline;
  font-size: inherit;
  cursor: pointer;
}

#shopify-subscription-policy-button::before {
  box-shadow: none;
}

      </style>
<script>window.performance && window.performance.mark && window.performance.mark('shopify.content_for_header.end');</script>

    <script src="./Infused energy_files/gsap.min.js.download" defer="defer"></script>
    <script src="./Infused energy_files/vendor-scripts-v14.js.download" defer="defer"></script><link rel="stylesheet" href="./Infused energy_files/country-flags.css"><link rel="stylesheet" href="./Infused energy_files/jvl6kkl.css">

    <script src="./Infused energy_files/theme.js.download" defer="defer"></script>
    <script src="./Infused energy_files/imagesloaded.pkgd.min.js.download"></script>
    <script src="./Infused energy_files/custom.js.download" defer="defer"></script>
  <link rel="dns-prefetch" href="https://cdn.secomapp.com/">
<link rel="dns-prefetch" href="https://ajax.googleapis.com/">
<link rel="dns-prefetch" href="https://cdnjs.cloudflare.com/">
<link rel="preload" as="stylesheet" href="./Infused energy_files/sca-pp.css">

<link rel="stylesheet" href="./Infused energy_files/sca-pp.css">
 <script>
  
  SCAPPShop = {};
    
  </script> 


            <!-- giftbox-script -->
            <script src="./Infused energy_files/giftbox-config.js.download" type="text/javascript"></script>
            <!-- / giftbox-script -->
            
<!-- BEGIN app block: shopify://apps/tiktok-ads-tiktok-pixels/blocks/turbo-tiktok/0f61e244-e2c9-43da-9523-9762c9f7e6bf -->






    <meta data-adttp="C7KIEHC6J7TUJ5K90ING">




<script>
    window.__adTraceTikTokPaused = ``;
    window.__adTraceTikTokServerSideApiEnabled = `true`;
    window.__adTraceShopifyDomain = `https://infusedenergy.shop`;
    window.__adTraceIsProductPage = ``.includes("product");
    window.__adTraceShopCurrency = `EUR`;
    window.__adTraceProductInfo = {
        "id": "",
        "name": ``,
        "price": "",
        "url": "",
        "description": null,
        "image": "<!-- Liquid error (shopify://apps/tiktok-ads-tiktok-pixels/blocks/turbo-tiktok/0f61e244-e2c9-43da-9523-9762c9f7e6bf line 31): invalid url input -->"
    };
    
</script>
<!-- END app block --><!-- BEGIN app block: shopify://apps/easygift/blocks/app-embed/0f7d4f74-1e89-4820-aec4-6564d7e535d2 -->










  
    <script async="" type="text/javascript" src="./Infused energy_files/script.js.download"></script>
  


 
  <meta id="easygift-shop" itemid="c2hvcF8kXzE3Mzg5MTc3OTY=" content="null">


<script defer="">
  (async function() {
    try {

      const blockVersion = "v3"
      if (blockVersion != "v3") {
        return 
      }

      let metaErrorFlag = false;
      if (metaErrorFlag) {
        return
      }

      const metafields = {};

      let savedRulesArray = [];
      for (const [key, value] of Object.entries(metafields)) {
        if (value) {
          for (const prop in value) {
            savedRulesArray.push(value);
            break;
          }
        }
      }

      const metaTag = document.createElement('meta');
      metaTag.id = 'easygift-rules'; 
      metaTag.content = JSON.stringify(savedRulesArray);
      metaTag.setAttribute('itemid', 'cnVsZXNfJF8xNzM4OTE3Nzk2');
  
      document.head.appendChild(metaTag);
      } catch (err) {
        
      }
  })();
</script><meta id="easygift-rules" content="[]" itemid="cnVsZXNfJF8xNzM4OTE3Nzk2">

<!-- END app block --><!-- BEGIN app block: shopify://apps/essential-announcement/blocks/app-embed/93b5429f-c8d6-4c33-ae14-250fd84f361b --><script>
  
    window.essentialAnnouncementConfigs = [{"id":"9eb920bf-362f-440a-b018-3ae144a6cbea","createdAt":"2025-01-16T07:58:10.763+00:00","name":"Tasting Aktion","title":"INFUSER BOTTLE FOR FREE","subheading":"Upgrade für grenzenlose Erfrischung","style":{"icon":{"size":32,"originalColor":true,"color":{"hex":"#333333"},"background":{"hex":"#ffffff","alpha":0,"rgba":"rgba(255, 255, 255, 0)"},"cornerRadius":4},"selectedTemplate":"Dawn","position":"bottom-page","stickyBar":false,"backgroundType":"gradientBackground","singleColor":"#FFFFFF","gradientTurn":142,"gradientStart":"#121512","gradientEnd":"#2b9fa4","borderRadius":"0","borderSize":"0","borderColor":"#fdfdff","titleSize":"18","titleColor":"#ffffff","font":"","subheadingSize":"14","subheadingColor":"#f2f2f2","buttonBackgroundColor":"#e52b38","buttonFontSize":"14","buttonFontColor":"#FFFFFF","buttonBorderRadius":"4","couponCodeButtonOutlineColor":"#202223","couponCodeButtonIconColor":"#202223","couponCodeButtonFontColor":"#202223","couponCodeButtonFontSize":"14","couponCodeButtonBorderRadius":"4","closeIconColor":"#ffffff","arrowIconColor":"#9f9daa","spacing":{"insideTop":10,"insideBottom":10,"outsideTop":0,"outsideBottom":10}},"announcementType":"simple","announcementPlacement":"","published":true,"showOnProducts":[],"showOnCollections":[],"updatedAt":"2025-02-06T17:57:50.184+00:00","CTAType":"button","CTALink":"https://infusedenergy.shop/pages/infusedays","closeButton":true,"buttonText":"ZUR AKTION","announcements":[{"title":"Enjoy a 20% discount on all our products!","subheading":"","CTAType":"button","buttonText":"Shop now!","CTALink":"","icon":"","id":276,"couponCode":""},{"title":"Enjoy a 20% discount on all our products!","subheading":"","CTAType":"button","buttonText":"Shop now!","CTALink":"","icon":"","id":440,"couponCode":""}],"shop":"infused-drinks.myshopify.com","animationSpeed":80,"rotateDuration":4,"translations":[],"startDate":null,"endDate":null,"icon":"https://vamxifegjdrgriapwsjg.supabase.co/storage/v1/object/public/files/infused-drinks.myshopify.com/Design%20ohne%20Titel%20(1)-1738864448524.png","locationType":"","showInCountries":[],"showOnProductsInCollections":[],"type":"product-page","couponCode":""}];
  
  window.essentialAnnouncementMeta = {
    productCollections: null,
    productData: null,
    templateName: "",
    collectionId: null,
  };
</script>

 




<script src="./Infused energy_files/announcement-bar-essential-apps.js.download" defer=""></script>

<!-- END app block --><link href="./Infused energy_files/popup-main.css" rel="stylesheet" type="text/css" media="all">
<script src="./Infused energy_files/tiktok-pixel.js.download" type="text/javascript" defer="defer"></script>
<script src="./Infused energy_files/freeGiftLogicv1.js.download" type="text/javascript" defer="defer"></script>
<link href="./Infused energy_files/freeGiftLogicv1.css" rel="stylesheet" type="text/css" media="all">
<script src="./Infused energy_files/giftBoxLogicv1.js.download" type="text/javascript" defer="defer"></script>
<link href="./Infused energy_files/giftBoxv1.css" rel="stylesheet" type="text/css" media="all">
<link href="https://monorail-edge.shopifysvc.com/" rel="dns-prefetch">
<script>(function(){if ("sendBeacon" in navigator && "performance" in window) {var session_token = document.cookie.match(/_shopify_s=([^;]*)/);function handle_abandonment_event(e) {var entries = performance.getEntries().filter(function(entry) {return /monorail-edge.shopifysvc.com/.test(entry.name);});if (!window.abandonment_tracked && entries.length === 0) {window.abandonment_tracked = true;var currentMs = Date.now();var navigation_start = performance.timing.navigationStart;var payload = {shop_id: 9397043260,url: window.location.href,navigation_start,duration: currentMs - navigation_start,session_token: session_token && session_token.length === 2 ? session_token[1] : "",page_type: ""};window.navigator.sendBeacon("https://monorail-edge.shopifysvc.com/v1/produce", JSON.stringify({schema_id: "online_store_buyer_site_abandonment/1.1",payload: payload,metadata: {event_created_at_ms: currentMs,event_sent_at_ms: currentMs}}));}}window.addEventListener('pagehide', handle_abandonment_event);}}());</script>
<script id="web-pixels-manager-setup">(function d(d,e,n,o,r,i){if(!Boolean(null===(t=null===(a=window.Shopify)||void 0===a?void 0:a.analytics)||void 0===t?void 0:t.replayQueue)){var a,t,s=function(){var d={modern:/Edge?\/(1{2}[4-9]|1[2-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Firefox\/(1{2}[4-9]|1[2-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Chrom(ium|e)\/(9{2}|\d{3,})\.\d+(\.\d+|)|(Maci|X1{2}).+ Version\/(15\.\d+|(1[6-9]|[2-9]\d|\d{3,})\.\d+)([,.]\d+|)( \(\w+\)|)( Mobile\/\w+|) Safari\/|Chrome.+OPR\/(9{2}|\d{3,})\.\d+\.\d+|(CPU[ +]OS|iPhone[ +]OS|CPU[ +]iPhone|CPU IPhone OS|CPU iPad OS)[ +]+(15[._]\d+|(1[6-9]|[2-9]\d|\d{3,})[._]\d+)([._]\d+|)|Android:?[ /-](13\d|1[4-9]\d|[2-9]\d{2}|\d{4,})(\.\d+|)(\.\d+|)|Android.+Firefox\/(13\d|1[4-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Android.+Chrom(ium|e)\/(13\d|1[4-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|SamsungBrowser\/([2-9]\d|\d{3,})\.\d+/,legacy:/Edge?\/(1[6-9]|[2-9]\d|\d{3,})\.\d+(\.\d+|)|Firefox\/(5[4-9]|[6-9]\d|\d{3,})\.\d+(\.\d+|)|Chrom(ium|e)\/(5[1-9]|[6-9]\d|\d{3,})\.\d+(\.\d+|)([\d.]+$|.*Safari\/(?![\d.]+ Edge\/[\d.]+$))|(Maci|X1{2}).+ Version\/(10\.\d+|(1[1-9]|[2-9]\d|\d{3,})\.\d+)([,.]\d+|)( \(\w+\)|)( Mobile\/\w+|) Safari\/|Chrome.+OPR\/(3[89]|[4-9]\d|\d{3,})\.\d+\.\d+|(CPU[ +]OS|iPhone[ +]OS|CPU[ +]iPhone|CPU IPhone OS|CPU iPad OS)[ +]+(10[._]\d+|(1[1-9]|[2-9]\d|\d{3,})[._]\d+)([._]\d+|)|Android:?[ /-](13\d|1[4-9]\d|[2-9]\d{2}|\d{4,})(\.\d+|)(\.\d+|)|Mobile Safari.+OPR\/([89]\d|\d{3,})\.\d+\.\d+|Android.+Firefox\/(13\d|1[4-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Android.+Chrom(ium|e)\/(13\d|1[4-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Android.+(UC? ?Browser|UCWEB|U3)[ /]?(15\.([5-9]|\d{2,})|(1[6-9]|[2-9]\d|\d{3,})\.\d+)\.\d+|SamsungBrowser\/(5\.\d+|([6-9]|\d{2,})\.\d+)|Android.+MQ{2}Browser\/(14(\.(9|\d{2,})|)|(1[5-9]|[2-9]\d|\d{3,})(\.\d+|))(\.\d+|)|K[Aa][Ii]OS\/(3\.\d+|([4-9]|\d{2,})\.\d+)(\.\d+|)/},e=d.modern,n=d.legacy,o=navigator.userAgent;return e.test(o)?"modern":(n.test(o),"legacy")}(),l=null!=i?i:{modern:"",legacy:""};window.Shopify=window.Shopify||{};var u=window.Shopify;u.analytics=u.analytics||{};var c=u.analytics;c.replayQueue=[],c.publish=function(d,e,n){return c.replayQueue.push([d,e,n]),!0};try{self.performance.mark("wpm:start")}catch(d){}var f=[n,"/wpm","/b",r,s.substring(0,1),".js"].join(""),h=l[s];!function(d){var e=d.src,n=d.async,o=void 0===n||n,r=d.onload,i=d.onerror,a=d.sri,t=document.createElement("script"),s=document.head,l=document.body;t.async=o,t.src=e,a&&(t.integrity=a,t.crossOrigin="anonymous"),r&&t.addEventListener("load",r),i&&t.addEventListener("error",i),s?s.appendChild(t):l?l.appendChild(t):console.error("Did not find a head or body element to append the script")}({src:f,async:!0,onload:function(){if(!function(){var d,e;return Boolean(null===(e=null===(d=window.Shopify)||void 0===d?void 0:d.analytics)||void 0===e?void 0:e.initialized)}()){var n=window.webPixelsManager.init(d)||void 0;if(n){e(n);var o=window.Shopify.analytics;o.replayQueue.forEach((function(d){var e=d[0],o=d[1],r=d[2];n.publishCustomEvent(e,o,r)})),o.replayQueue=[],o.publish=n.publishCustomEvent,o.visitor=n.visitor,o.initialized=!0}}},onerror:function(){var e=d.storefrontBaseUrl.replace(/\/$/,""),n="".concat(e,"/.well-known/shopify/monorail/unstable/produce_batch"),r=JSON.stringify({metadata:{event_sent_at_ms:(new Date).getTime()},events:[{schema_id:"web_pixels_manager_load/3.1",payload:{version:o||"latest",bundle_target:s,page_url:self.location.href,status:"failed",surface:d.surface,error_msg:"".concat(f," has failed to load")},metadata:{event_created_at_ms:(new Date).getTime()}}]});try{if(self.navigator.sendBeacon.bind(self.navigator)(n,r))return!0}catch(d){}var i=new XMLHttpRequest;try{return i.open("POST",n,!0),i.setRequestHeader("Content-Type","text/plain"),i.send(r),!0}catch(d){console&&console.warn&&console.warn("[Web Pixels Manager] Got an unhandled error while logging a load error.")}return!1},sri:function(d){return"string"==typeof d&&/^sha384-[A-Za-z0-9+/=]+$/.test(d)}(h)?h:""})}})({shopId: 9397043260,storefrontBaseUrl: "https://infusedenergy.shop",extensionsBaseUrl: "https://extensions.shopifycdn.com/cdn/shopifycloud/web-pixels-manager",surface: "storefront-renderer",enabledBetaFlags: ["6a396365"],webPixelsConfigList: [{"id":"1834615050","configuration":"{\"pixel_id\":\"304404696686519\",\"pixel_type\":\"facebook_pixel\"}","eventPayloadVersion":"v1","runtimeContext":"OPEN","scriptVersion":"8d894c63179843e74a9691414b5ad83d","type":"APP","apiClientId":2329312,"privacyPurposes":["ANALYTICS","MARKETING","SALE_OF_DATA"]},{"id":"1834320138","configuration":"{\"myshopifyDomain\":\"infused-drinks.myshopify.com\",\"fallbackTrackingEnabled\":\"0\",\"storeUsesCashOnDelivery\":\"false\"}","eventPayloadVersion":"v1","runtimeContext":"STRICT","scriptVersion":"5c0f1926339ad61df65a4737e07d8842","type":"APP","apiClientId":1326022657,"privacyPurposes":["ANALYTICS","MARKETING","SALE_OF_DATA"]},{"id":"1038975242","configuration":"{\"config\":\"{\\\"pixel_id\\\":\\\"G-1ZEHCK5DBK\\\",\\\"target_country\\\":\\\"DE\\\",\\\"gtag_events\\\":[{\\\"type\\\":\\\"purchase\\\",\\\"action_label\\\":\\\"G-1ZEHCK5DBK\\\"},{\\\"type\\\":\\\"page_view\\\",\\\"action_label\\\":\\\"G-1ZEHCK5DBK\\\"},{\\\"type\\\":\\\"view_item\\\",\\\"action_label\\\":\\\"G-1ZEHCK5DBK\\\"},{\\\"type\\\":\\\"search\\\",\\\"action_label\\\":\\\"G-1ZEHCK5DBK\\\"},{\\\"type\\\":\\\"add_to_cart\\\",\\\"action_label\\\":\\\"G-1ZEHCK5DBK\\\"},{\\\"type\\\":\\\"begin_checkout\\\",\\\"action_label\\\":\\\"G-1ZEHCK5DBK\\\"},{\\\"type\\\":\\\"add_payment_info\\\",\\\"action_label\\\":\\\"G-1ZEHCK5DBK\\\"}],\\\"enable_monitoring_mode\\\":false}\"}","eventPayloadVersion":"v1","runtimeContext":"OPEN","scriptVersion":"642ed32d7fafb3e0986c8ba3bf3908a1","type":"APP","apiClientId":1780363,"privacyPurposes":[]},{"id":"157024522","configuration":"{\"tagID\":\"2613290892183\"}","eventPayloadVersion":"v1","runtimeContext":"STRICT","scriptVersion":"4fd0680eed907adaf3f85849c393d688","type":"APP","apiClientId":3009811,"privacyPurposes":["ANALYTICS","MARKETING","SALE_OF_DATA"]},{"id":"30540042","configuration":"{\"myshopifyDomain\":\"infused-drinks.myshopify.com\",\"fallbackTrackingEnabled\":\"0\",\"storeUsesCashOnDelivery\":\"false\"}","eventPayloadVersion":"v1","runtimeContext":"STRICT","scriptVersion":"14f12110be0eba0c1b16c0a6776a09e7","type":"APP","apiClientId":4503629,"privacyPurposes":["ANALYTICS","MARKETING","SALE_OF_DATA"]},{"id":"120357130","eventPayloadVersion":"1","runtimeContext":"LAX","scriptVersion":"1","type":"CUSTOM","privacyPurposes":[],"name":"AdTrace Pixel"},{"id":"154239242","eventPayloadVersion":"1","runtimeContext":"LAX","scriptVersion":"1","type":"CUSTOM","privacyPurposes":["ANALYTICS","MARKETING"],"name":"ABLyft Tracking"},{"id":"158695690","eventPayloadVersion":"1","runtimeContext":"LAX","scriptVersion":"1","type":"CUSTOM","privacyPurposes":[],"name":"Consentmo-CheckoutCookieBanner"},{"id":"shopify-app-pixel","configuration":"{}","eventPayloadVersion":"v1","runtimeContext":"STRICT","scriptVersion":"0282","apiClientId":"shopify-pixel","type":"APP","privacyPurposes":["ANALYTICS","MARKETING"]},{"id":"shopify-custom-pixel","eventPayloadVersion":"v1","runtimeContext":"LAX","scriptVersion":"0282","apiClientId":"shopify-pixel","type":"CUSTOM","privacyPurposes":["ANALYTICS","MARKETING"]}],isMerchantRequest: false,effectiveTopLevelDomain: "",initData: {"shop":{"name":"Infused energy","paymentSettings":{"currencyCode":"EUR"},"myshopifyDomain":"infused-drinks.myshopify.com","countryCode":"DE","storefrontUrl":"https:\/\/infusedenergy.shop"},"customer":null,"cart":{"cost":{"totalAmount":{"amount":107.6,"currencyCode":"EUR"}},"lines":[{"cost":{"totalAmount":{"amount":26.9,"currencyCode":"EUR"}},"merchandise":{"price":{"amount":26.9,"currencyCode":"EUR"},"product":{"title":"Energy latte - Cacao","vendor":"Infused energy","id":"9797276565770","untranslatedTitle":"Energy latte - Cacao","url":"\/products\/energy-latte-cacao","type":""},"id":"50264118821130","image":{"src":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Cacao_Milky-Chocolate_Front_1420x1420_c289b805-bc64-4733-8c95-e41d29dc46b0.png?v=1731316426"},"sku":"IEL_CA","title":"Default Title","untranslatedTitle":"Default Title"},"quantity":1},{"cost":{"totalAmount":{"amount":26.9,"currencyCode":"EUR"}},"merchandise":{"price":{"amount":26.9,"currencyCode":"EUR"},"product":{"title":"Energy latte - Spekulatius","vendor":"Infused energy","id":"8358568722698","untranslatedTitle":"Energy latte - Spekulatius","url":"\/products\/infused-energy-latte-spekulatius","type":""},"id":"44966031556874","image":{"src":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Christmas-Edition_Spekulatius_Front_1420x1420_9580a96a-eaed-4725-8a76-236656a84d4c.png?v=1701975690"},"sku":"IEL-XMS_240","title":"Default Title","untranslatedTitle":"Default Title"},"quantity":1},{"cost":{"totalAmount":{"amount":26.9,"currencyCode":"EUR"}},"merchandise":{"price":{"amount":26.9,"currencyCode":"EUR"},"product":{"title":"Energy latte - Matcha x Coffee","vendor":"Infused energy","id":"9604885086474","untranslatedTitle":"Energy latte - Matcha x Coffee","url":"\/products\/energy-latte-iced-coffee","type":""},"id":"49703104741642","image":{"src":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Matcha-Iced-Coffee_Front_1420x1420_f07eb706-ea0a-4363-906f-e876a9285526.png?v=1722512555"},"sku":"IEL-IC_240","title":"Default Title","untranslatedTitle":"Default Title"},"quantity":1},{"cost":{"totalAmount":{"amount":26.9,"currencyCode":"EUR"}},"merchandise":{"price":{"amount":26.9,"currencyCode":"EUR"},"product":{"title":"Energy latte - Dubai Edition (limitiert)","vendor":"Infused energy","id":"9816077304074","untranslatedTitle":"Energy latte - Dubai Edition (limitiert)","url":"\/products\/energy-latte-dubai-edition-limitiert","type":""},"id":"50325483651338","image":{"src":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Dubai_Front_1420x1420_60bb1c56-404b-4af6-93a0-763c06c3e273.png?v=1732284794"},"sku":"FE-XL-LT-DB","title":"Default Title","untranslatedTitle":"Default Title"},"quantity":1}],"totalQuantity":4,"attributes":[{"key":"_kite_cfData","value":"{\"Aktions-Rabatt\":\"\"}"},{"key":"_customerTags","value":"[]"},{"key":"gbbDiscountCode-Energy Latte","value":"EasyBundle-MYV2XCT7NV"},{"key":"show_payment","value":"true"}],"id":"Z2NwLWV1cm9wZS13ZXN0MzowMUo0OFY2MzdIRFBQRUE3UjJWNzZORVRXWg"},"checkout":null,"productVariants":[],"purchasingCompany":null},},function pageEvents(webPixelsManagerAPI) {webPixelsManagerAPI.publish("page_viewed", {});},"https://infusedenergy.shop/cdn","fa4e28fae492e8b8cbffa58e31a72fa67ab51995","bb202aaewd7fabeadp1286c7ffm6c4f3798",{"modern":"","legacy":""});</script><script async="" src="./Infused energy_files/bbb202aaewd7fabeadp1286c7ffm6c4f3798m.js.download"></script>  <script>window['GoogleAnalyticsObject'] = 'ga';
window['ga'] = window['ga'] || function() {
  (window['ga'].q = window['ga'].q || []).push(arguments);
};
window['ga'].l = 1 * new Date();</script>
<script>var _gaUTrackerOptions = {'allowLinker': true};ga('create', 'UA-142594160-1', 'auto', _gaUTrackerOptions);ga('send', 'pageview');
      (function(){
        ga('require', 'linker');
        function addListener(element, type, callback) {
          if (element.addEventListener) {
            element.addEventListener(type, callback);
          }
          else if (element.attachEvent) {
            element.attachEvent('on' + type, callback);
          }
        }
        function decorate(event) {
          event = event || window.event;
          var target = event.target || event.srcElement;
          if (target && (target.action || target.href)) {
            ga(function (tracker) {
              var linkerParam = tracker.get('linkerParam');
              document.cookie = '_shopify_ga=' + linkerParam + '; ' + 'path=/';
            });
          }
        }
        addListener(window, 'load', function(){
          for (var i=0; i<document.forms.length; i++) {
            if(document.forms[i].action && document.forms[i].action.indexOf('/cart') >= 0) {
              addListener(document.forms[i], 'submit', decorate);
            }
          }
          for (var i=0; i<document.links.length; i++) {
            if(document.links[i].href && document.links[i].href.indexOf('/checkout') >= 0) {
              addListener(document.links[i], 'click', decorate);
            }
          }
        })
      }());
    </script>
<script>window.ShopifyAnalytics = window.ShopifyAnalytics || {};
window.ShopifyAnalytics.meta = window.ShopifyAnalytics.meta || {};
window.ShopifyAnalytics.meta.currency = 'EUR';
var meta = {"page":{}};
for (var attr in meta) {
  window.ShopifyAnalytics.meta[attr] = meta[attr];
}</script>
<script>window.ShopifyAnalytics.merchantGoogleAnalytics = function() {
  
};
</script>
<script class="analytics">(function () {
    var customDocumentWrite = function(content) {
      var jquery = null;

      if (window.jQuery) {
        jquery = window.jQuery;
      } else if (window.Checkout && window.Checkout.$) {
        jquery = window.Checkout.$;
      }

      if (jquery) {
        jquery('body').append(content);
      }
    };

    var hasLoggedConversion = function(token) {
      if (token) {
        return document.cookie.indexOf('loggedConversion=' + token) !== -1;
      }
      return false;
    }

    var setCookieIfConversion = function(token) {
      if (token) {
        var twoMonthsFromNow = new Date(Date.now());
        twoMonthsFromNow.setMonth(twoMonthsFromNow.getMonth() + 2);

        document.cookie = 'loggedConversion=' + token + '; expires=' + twoMonthsFromNow;
      }
    }

    var trekkie = window.ShopifyAnalytics.lib = window.trekkie = window.trekkie || [];
    if (trekkie.integrations) {
      return;
    }
    trekkie.methods = [
      'identify',
      'page',
      'ready',
      'track',
      'trackForm',
      'trackLink'
    ];
    trekkie.factory = function(method) {
      return function() {
        var args = Array.prototype.slice.call(arguments);
        args.unshift(method);
        trekkie.push(args);
        return trekkie;
      };
    };
    for (var i = 0; i < trekkie.methods.length; i++) {
      var key = trekkie.methods[i];
      trekkie[key] = trekkie.factory(key);
    }
    trekkie.load = function(config) {
      trekkie.config = config || {};
      trekkie.config.initialDocumentCookie = document.cookie;
      var first = document.getElementsByTagName('script')[0];
      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.onerror = function(e) {
        var scriptFallback = document.createElement('script');
        scriptFallback.type = 'text/javascript';
        scriptFallback.onerror = function(error) {
                var Monorail = {
      produce: function produce(monorailDomain, schemaId, payload) {
        var currentMs = new Date().getTime();
        var event = {
          schema_id: schemaId,
          payload: payload,
          metadata: {
            event_created_at_ms: currentMs,
            event_sent_at_ms: currentMs
          }
        };
        return Monorail.sendRequest("https://" + monorailDomain + "/v1/produce", JSON.stringify(event));
      },
      sendRequest: function sendRequest(endpointUrl, payload) {
        // Try the sendBeacon API
        if (window && window.navigator && typeof window.navigator.sendBeacon === 'function' && typeof window.Blob === 'function' && !Monorail.isIos12()) {
          var blobData = new window.Blob([payload], {
            type: 'text/plain'
          });

          if (window.navigator.sendBeacon(endpointUrl, blobData)) {
            return true;
          } // sendBeacon was not successful

        } // XHR beacon

        var xhr = new XMLHttpRequest();

        try {
          xhr.open('POST', endpointUrl);
          xhr.setRequestHeader('Content-Type', 'text/plain');
          xhr.send(payload);
        } catch (e) {
          console.log(e);
        }

        return false;
      },
      isIos12: function isIos12() {
        return window.navigator.userAgent.lastIndexOf('iPhone; CPU iPhone OS 12_') !== -1 || window.navigator.userAgent.lastIndexOf('iPad; CPU OS 12_') !== -1;
      }
    };
    Monorail.produce('monorail-edge.shopifysvc.com',
      'trekkie_storefront_load_errors/1.1',
      {shop_id: 9397043260,
      theme_id: 143165587722,
      app_name: "storefront",
      context_url: window.location.href,
      source_url: "//infusedenergy.shop/cdn/s/trekkie.storefront.c44d6898594db6c4847cb75ef4de7d5f4456a012.min.js"});

        };
        scriptFallback.async = true;
        scriptFallback.src = '//infusedenergy.shop/cdn/s/trekkie.storefront.c44d6898594db6c4847cb75ef4de7d5f4456a012.min.js';
        first.parentNode.insertBefore(scriptFallback, first);
      };
      script.async = true;
      script.src = '//infusedenergy.shop/cdn/s/trekkie.storefront.c44d6898594db6c4847cb75ef4de7d5f4456a012.min.js';
      first.parentNode.insertBefore(script, first);
    };
    trekkie.load(
      {"Trekkie":{"appName":"storefront","development":false,"defaultAttributes":{"shopId":9397043260,"isMerchantRequest":null,"themeId":143165587722,"themeCityHash":"3498147304335237051","contentLanguage":"de","currency":"EUR"},"isServerSideCookieWritingEnabled":true,"monorailRegion":"shop_domain"},"Session Attribution":{},"S2S":{"facebookCapiEnabled":true,"source":"trekkie-storefront-renderer","apiClientId":580111}}
    );

    var loaded = false;
    trekkie.ready(function() {
      if (loaded) return;
      loaded = true;

      window.ShopifyAnalytics.lib = window.trekkie;

  
      var originalDocumentWrite = document.write;
      document.write = customDocumentWrite;
      try { window.ShopifyAnalytics.merchantGoogleAnalytics.call(this); } catch(error) {};
      document.write = originalDocumentWrite;

      window.ShopifyAnalytics.lib.page(null,{"shopifyEmitted":true});

      var match = window.location.pathname.match(/checkouts\/(.+)\/(thank_you|post_purchase)/)
      var token = match? match[1]: undefined;
      if (!hasLoggedConversion(token)) {
        setCookieIfConversion(token);
        
      }
    });


        var eventsListenerScript = document.createElement('script');
        eventsListenerScript.async = true;
        eventsListenerScript.src = "//infusedenergy.shop/cdn/shopifycloud/shopify/assets/shop_events_listener-20905db421adb60b04582abab58b285362bc2e1011d17cd3eabb3bfe05798c59.js";
        document.getElementsByTagName('head')[0].appendChild(eventsListenerScript);

})();</script><script async="" src="./Infused energy_files/shop_events_listener-20905db421adb60b04582abab58b285362bc2e1011d17cd3eabb3bfe05798c59.js.download"></script>
<script class="boomerang">
(function () {
  window.BOOMR = window.BOOMR || {};
  window.BOOMR.themeName = "Motion";
  window.BOOMR.themeVersion = "10.0.0";
  window.BOOMR.shopId = 9397043260;
  window.BOOMR.themeId = 143165587722;
})();</script>
<script defer="" src="./Infused energy_files/shopify-perf-kit-1.2.0.min.js.download" data-application="storefront-renderer" data-shop-id="9397043260" data-render-region="gcp-europe-west3" data-page-type="" data-theme-instance-id="143165587722" data-monorail-region="shop_domain" data-resource-timing-sampling-rate="10"></script>
<script async="async" src="./Infused energy_files/analytics.js.download"></script>
<script type="text/javascript" src="./Infused energy_files/jquery.min.js.download"></script><script async="" src="./Infused energy_files/677f84983bee7a9c88cfe4fc.js.download"></script><script src="./Infused energy_files/pixel.modern.js.download" async=""></script><script src="./Infused energy_files/pixel.modern(1).js.download" async=""></script><style type="text/css" id="essential-apps-announcement-bar-css">
        .essential_annoucement_bar_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea {
          overflow: hidden;
          position: relative;
          display: flex !important;
          flex-wrap: nowrap;
          column-gap: 26px;
          row-gap: 10px;
          
          background: linear-gradient(142deg, #121512, #2b9fa4);
          padding: 10px;
          
          align-items: center;
          justify-content: center;
          width: 100%;
           border-radius: 0px;
          border: #fdfdff solid 0px;
          
        }

        .essential_annoucement_bar_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea.top_page {
          z-index: 101;
        }

        .essential_annoucement_bar_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea.top_page_styles {}

        .essential_annoucement_bar_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea.top_page_sticky {
          position: sticky; 
          top: 0;
        }

        .essential_annoucement_bar_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea.bottom_page {
          z-index: 101;
          bottom: 0; 
          left: 0;
          position: fixed;
          width: 100%;
        }

        .essential_annoucement_bar_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea.bottom_page_styles {}
        
        .essential_annoucement_bar_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea.clickable {
          cursor: pointer;
        }

        .essential_annoucement_main_content_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea {
          display: flex;
          align-items: center;
          justify-content: center;
          flex-grow: 1;
          overflow: hidden;
          gap: 26px;
        }

        .essential_annoucement_titles_outside_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea {
          overflow: hidden;
          position: relative;
          width: auto;
          padding: 0;
        }

        .essential_annoucement_running_line_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea {
          display: flex;
          width: 100%;
        }

        .essential_annoucement_bar_running_line_title_9eb920bf-362f-440a-b018-3ae144a6cbea {
          font-weight: bold;
          font-size: 18px;
          color: #ffffff;
          margin: 0;
          padding: 0;
          line-height: 1.2;
          letter-spacing: normal;
          text-transform: none;
          text-align: left;
          white-space: nowrap;
          animation: runningLine 28.75s linear infinite;
          animation-delay: -28.75s;
          display: flex;
          gap: 26px;
          padding-right: 26px;
        }

        .essential_annoucement_running_line_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea .essential_annoucement_bar_running_line_title_9eb920bf-362f-440a-b018-3ae144a6cbea:nth-child(2) {
          animation: runningLine2 28.75s linear infinite;
          animation-delay: -14.375s;
        }

        .essential_annoucement_bar_slider_container_9eb920bf-362f-440a-b018-3ae144a6cbea {
          margin: 0;
          align-items: center;
        }

        .essential_annoucement_bar_slide_9eb920bf-362f-440a-b018-3ae144a6cbea {
          display: flex;
          justify-content: center;
          align-items: center;
          gap: 26px;
        }

        .essential_annoucement_bar_slide_9eb920bf-362f-440a-b018-3ae144a6cbea.glide__slide--active {
          z-index: 1;
        }

        .essential_annoucement_bar_slide_9eb920bf-362f-440a-b018-3ae144a6cbea.clickable {
          cursor: pointer;
        }

        .essential_annoucement_bar_glide__arrow {
          cursor: pointer;
        }

        .essential_annoucement_bar_glide__arrows_prev_9eb920bf-362f-440a-b018-3ae144a6cbea {
          position: absolute;
          left: -20px;
          top: 0;
          bottom: 0;
          height: 20px;
          margin: auto;
        }

        .essential_annoucement_bar_glide__arrows_next_9eb920bf-362f-440a-b018-3ae144a6cbea {
          position: absolute;
          right: -20px;
          top: 0;
          bottom: 0;
          height: 20px;
          margin: auto;
        }

        .essential_annoucement_titles_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea.center {
          text-align: center;
        }
        
        .essential_annoucement_bar_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea h2, 
        .essential_annoucement_bar_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea h4, 
        .essential_annoucement_bar_title_container_9eb920bf-362f-440a-b018-3ae144a6cbea, 
        #essential_annoucement_bar_title_9eb920bf-362f-440a-b018-3ae144a6cbea {
            font-weight: bold;
            font-size: 18px;
            color: #ffffff;
            margin: 0;
            padding: 0;
            line-height: 1.2;
            letter-spacing: normal;
            text-transform: none;
            white-space: pre-wrap;
        }
    
        .essential_annoucement_bar_subheading_9eb920bf-362f-440a-b018-3ae144a6cbea {
            font-size: 14px;
            color: #f2f2f2;
            line-height: 1.2;
            letter-spacing: normal;
            padding: 0;
            margin: 0;
        }

        .essential_annoucement_cta_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea {
          display: flex;
          gap: 10px;
          flex-wrap: nowrap;
        }

        .essential_annoucement_bar_coupon_code_button_9eb920bf-362f-440a-b018-3ae144a6cbea {
          display: flex;
          align-items: center;
          cursor: pointer;
          text-decoration: none;
          background: none;
          border: 2px solid #202223;
          white-space: nowrap;
          padding: 6px 14px;
          border-radius: 4px;
          font-size: 14px;
          color: #202223;
          line-height: 1.5;
          gap: 10px;
          font-weight: 600;
        }

        .essential_annoucement_bar_coupon_code_button_icon_9eb920bf-362f-440a-b018-3ae144a6cbea {
            height: 14px;
            width: 14px;
            background-repeat: no-repeat;
            background-position: center;
            background-color: #202223;
            -webkit-mask-image: url('data:image/svg+xml;utf8,<svg width="12" height="14" viewBox="0 0 12 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.51547 1.75C2.6385 0.763422 3.4801 0 4.5 0H7.5C8.5269 0 9.37305 0.773938 9.48696 1.77035C9.48618 1.76355 9.48537 1.75677 9.48453 1.75H9.75C10.9926 1.75 12 2.75736 12 4V11.75C12 12.9926 10.9926 14 9.75 14H2.25C1.00736 14 0 12.9926 0 11.75V4C0 2.75736 1.00736 1.75 2.25 1.75H2.51547ZM4.5 1.5H7.5C7.77614 1.5 8 1.72386 8 2V3C8 3.27614 7.77614 3.5 7.5 3.5H4.5C4.22386 3.5 4 3.27614 4 3V2C4 1.72386 4.22386 1.5 4.5 1.5ZM2.51304 3.22965C2.51382 3.23645 2.51463 3.24323 2.51547 3.25H2.25C1.83579 3.25 1.5 3.58579 1.5 4V11.75C1.5 12.1642 1.83579 12.5 2.25 12.5H9.75C10.1642 12.5 10.5 12.1642 10.5 11.75V4C10.5 3.58579 10.1642 3.25 9.75 3.25H9.48453C9.3615 4.23658 8.51991 5 7.5 5H4.5C3.4731 5 2.62695 4.22606 2.51304 3.22965Z" fill="black"/></svg>');
            -webkit-mask-size: 12px;
            -webkit-mask-repeat: no-repeat;
            -webkit-mask-position: center;
            mask-image: url('data:image/svg+xml;utf8,<svg width="12" height="14" viewBox="0 0 12 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.51547 1.75C2.6385 0.763422 3.4801 0 4.5 0H7.5C8.5269 0 9.37305 0.773938 9.48696 1.77035C9.48618 1.76355 9.48537 1.75677 9.48453 1.75H9.75C10.9926 1.75 12 2.75736 12 4V11.75C12 12.9926 10.9926 14 9.75 14H2.25C1.00736 14 0 12.9926 0 11.75V4C0 2.75736 1.00736 1.75 2.25 1.75H2.51547ZM4.5 1.5H7.5C7.77614 1.5 8 1.72386 8 2V3C8 3.27614 7.77614 3.5 7.5 3.5H4.5C4.22386 3.5 4 3.27614 4 3V2C4 1.72386 4.22386 1.5 4.5 1.5ZM2.51304 3.22965C2.51382 3.23645 2.51463 3.24323 2.51547 3.25H2.25C1.83579 3.25 1.5 3.58579 1.5 4V11.75C1.5 12.1642 1.83579 12.5 2.25 12.5H9.75C10.1642 12.5 10.5 12.1642 10.5 11.75V4C10.5 3.58579 10.1642 3.25 9.75 3.25H9.48453C9.3615 4.23658 8.51991 5 7.5 5H4.5C3.4731 5 2.62695 4.22606 2.51304 3.22965Z" fill="black"/></svg>');
            mask-size: 12px;
            mask-repeat: no-repeat;
            mask-position: center;
            display: flex;
        }

        .essential_annoucement_bar_coupon_code_button_icon_checked_9eb920bf-362f-440a-b018-3ae144a6cbea {
            height: 14px;
            width: 14px;
            background-repeat: no-repeat;
            background-position: center;
            background-color: #202223;
            -webkit-mask-image: url('data:image/svg+xml;utf8,<svg width="12" height="14" viewBox="0 0 12 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.28033 6.21967C9.57322 6.51256 9.57322 6.98744 9.28033 7.28033L5.78033 10.7803C5.48744 11.0732 5.01256 11.0732 4.71967 10.7803L2.96967 9.03033C2.67678 8.73744 2.67678 8.26256 2.96967 7.96967C3.26256 7.67678 3.73744 7.67678 4.03033 7.96967L5.25 9.18934L8.21967 6.21967C8.51256 5.92678 8.98744 5.92678 9.28033 6.21967Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M2.51547 1.75C2.6385 0.763422 3.4801 0 4.5 0H7.5C8.5269 0 9.37305 0.773938 9.48696 1.77035C9.48618 1.76355 9.48537 1.75677 9.48453 1.75H9.75C10.9926 1.75 12 2.75736 12 4V11.75C12 12.9926 10.9926 14 9.75 14H2.25C1.00736 14 0 12.9926 0 11.75V4C0 2.75736 1.00736 1.75 2.25 1.75H2.51547ZM4.5 1.5H7.5C7.77614 1.5 8 1.72386 8 2V3C8 3.27614 7.77614 3.5 7.5 3.5H4.5C4.22386 3.5 4 3.27614 4 3V2C4 1.72386 4.22386 1.5 4.5 1.5ZM2.51304 3.22965C2.51382 3.23645 2.51463 3.24323 2.51547 3.25H2.25C1.83579 3.25 1.5 3.58579 1.5 4V11.75C1.5 12.1642 1.83579 12.5 2.25 12.5H9.75C10.1642 12.5 10.5 12.1642 10.5 11.75V4C10.5 3.58579 10.1642 3.25 9.75 3.25H9.48453C9.3615 4.23658 8.51991 5 7.5 5H4.5C3.4731 5 2.62695 4.22606 2.51304 3.22965Z" fill="black"/></svg>');
            -webkit-mask-size: 12px;
            -webkit-mask-repeat: no-repeat;
            -webkit-mask-position: center;
            mask-image: url('data:image/svg+xml;utf8,<svg width="12" height="14" viewBox="0 0 12 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.28033 6.21967C9.57322 6.51256 9.57322 6.98744 9.28033 7.28033L5.78033 10.7803C5.48744 11.0732 5.01256 11.0732 4.71967 10.7803L2.96967 9.03033C2.67678 8.73744 2.67678 8.26256 2.96967 7.96967C3.26256 7.67678 3.73744 7.67678 4.03033 7.96967L5.25 9.18934L8.21967 6.21967C8.51256 5.92678 8.98744 5.92678 9.28033 6.21967Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M2.51547 1.75C2.6385 0.763422 3.4801 0 4.5 0H7.5C8.5269 0 9.37305 0.773938 9.48696 1.77035C9.48618 1.76355 9.48537 1.75677 9.48453 1.75H9.75C10.9926 1.75 12 2.75736 12 4V11.75C12 12.9926 10.9926 14 9.75 14H2.25C1.00736 14 0 12.9926 0 11.75V4C0 2.75736 1.00736 1.75 2.25 1.75H2.51547ZM4.5 1.5H7.5C7.77614 1.5 8 1.72386 8 2V3C8 3.27614 7.77614 3.5 7.5 3.5H4.5C4.22386 3.5 4 3.27614 4 3V2C4 1.72386 4.22386 1.5 4.5 1.5ZM2.51304 3.22965C2.51382 3.23645 2.51463 3.24323 2.51547 3.25H2.25C1.83579 3.25 1.5 3.58579 1.5 4V11.75C1.5 12.1642 1.83579 12.5 2.25 12.5H9.75C10.1642 12.5 10.5 12.1642 10.5 11.75V4C10.5 3.58579 10.1642 3.25 9.75 3.25H9.48453C9.3615 4.23658 8.51991 5 7.5 5H4.5C3.4731 5 2.62695 4.22606 2.51304 3.22965Z" fill="black"/></svg>');
            mask-size: 12px;
            mask-repeat: no-repeat;
            mask-position: center;
            display: none;
        }
        
        .essential_annoucement_bar_cta_9eb920bf-362f-440a-b018-3ae144a6cbea {
          display: block;        
          cursor: pointer;
          text-decoration: none;
          background: #e52b38;
          border: 0;
          white-space: nowrap;
          padding: 8px 16px;
          line-height: 1.5;
          border-radius: 4px;
          font-size: 14px;
          color: #FFFFFF;
        }

        .essential_annoucement_bar_close_button_9eb920bf-362f-440a-b018-3ae144a6cbea {
          display: block;
          border: none;
          background: none;
          cursor: pointer;
          margin-left: auto;
        }

        .essential_annoucement_bar_close_button_9eb920bf-362f-440a-b018-3ae144a6cbea svg {
          width: 12px;
          height: 12px;
          display: block;
        }

        @media (max-width: 430px) {
          .essential_annoucement_bar_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea {
            justify-items: center;
            text-align: center;
            padding: 10px 15px;
          }

          .essential_annoucement_bar_close_button_9eb920bf-362f-440a-b018-3ae144a6cbea {
            position: absolute;
            padding: 0;
            transform: none;
            top: 5px;
            right: 2px;
          }

          .essential_annoucement_bar_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea h2,
          .essential_annoucement_bar_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea h4,
          .essential_annoucement_bar_title_container_9eb920bf-362f-440a-b018-3ae144a6cbea,
          #essential_annoucement_bar_title_9eb920bf-362f-440a-b018-3ae144a6cbea {
              text-align: center;
              white-space: pre-wrap;
          }

          .essential_annoucement_main_content_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea {
            gap: 10px;
          }

          .essential_annoucement_bar_slide_9eb920bf-362f-440a-b018-3ae144a6cbea {
            gap: 10px;
          }

          .essential_annoucement_titles_outside_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea {
            padding: 0;
          }

          .essential_annoucement_bar_glide__arrows_9eb920bf-362f-440a-b018-3ae144a6cbea {
            display: none!important;
          }
        }

        @keyframes runningLine {
          from {
            -moz-transform: translateX(100%);
            -webkit-transform: translateX(100%);
            transform: translateX(100%);
          }
          to {
            -moz-transform: translateX(-100%);
            -webkit-transform: translateX(-100%);
            transform: translateX(-100%);
          }
        }

        @keyframes runningLine2 {
          from {
            -moz-transform: translateX(0);
            -webkit-transform: translateX(0);
            transform: translateX(0);
          }
          to {
            -moz-transform: translateX(-200%);
            -webkit-transform: translateX(-200%);
            transform: translateX(-200%);
          }
        }

        
        @media (max-width: 620px) { 
          .essential_annoucement_bar_running_line_title_9eb920bf-362f-440a-b018-3ae144a6cbea {
            font-size: 14px;
          }

          .essential_annoucement_bar_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea h2, 
          .essential_annoucement_bar_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea h4,
          .essential_annoucement_bar_title_container_9eb920bf-362f-440a-b018-3ae144a6cbea,
          #essential_annoucement_bar_title_9eb920bf-362f-440a-b018-3ae144a6cbea {
              font-size: 14px;
          }

          .essential_annoucement_bar_subheading_9eb920bf-362f-440a-b018-3ae144a6cbea {
            font-size: 11px;
          }

          .essential_annoucement_bar_cta_9eb920bf-362f-440a-b018-3ae144a6cbea {
            font-size: 12px;
          }
        }
        
    
      .essential_annoucement_bar_icon_container_9eb920bf-362f-440a-b018-3ae144a6cbea {
        display: flex !important;
        align-items: center;
        justify-content: center;
        padding: 4px;
        margin-right: -13px;
        border-radius: 4px;
        background-color: rgba(255, 255, 255, 0);
      }

      @media (max-width: 620px) {
        .essential_annoucement_bar_icon_container_9eb920bf-362f-440a-b018-3ae144a6cbea {
          margin-right: -4px;
        }
      }
      
          .essential_annoucement_bar_icon_9eb920bf-362f-440a-b018-3ae144a6cbea {
          height: 32px;
          width: 32px;
          display: flex !important;

          

          background-image: url('https://vamxifegjdrgriapwsjg.supabase.co/storage/v1/object/public/files/infused-drinks.myshopify.com/Design%20ohne%20Titel%20(1)-1738864448524.png');
              background-repeat: no-repeat;
              background-position: center;   
              background-size: 32px;
        }
      </style><script id="decify-surveys-client" src="./Infused energy_files/surveys-client.js.download" defer=""></script><script type="text/javascript" src="./Infused energy_files/jquery.min.js.download"></script><link rel="stylesheet" type="text/css" href="chrome-extension://enejkfhimljloggnimhebadbjajhgkad/font/Inter.css"><style id="decify-surveys-client-css">._SurveyApp_bw9ud_1 *{box-sizing:border-box}._SurveyApp_bw9ud_1 p{margin:0}._Overlay_xmusa_1:empty{display:block;position:var(--position);top:0;left:0;width:100%;height:100%;z-index:21474836472;background-color:var(--overlay-background-color)}._SurveyWidget_9d2ae_1{display:flex;flex-direction:column;gap:16px;max-height:80vh;padding:var(--widget-padding-block) var(--widget-padding-inline);border-width:var(--widget-border-width);border-style:var(--widget-border-style);border-radius:var(--widget-border-radius);border-color:var(--widget-border-color);background-color:var(--widget-background-color)}._SurveyWidget_9d2ae_1._Type--Flyout_9d2ae_13{position:var(--position);bottom:0;left:50%;translate:-50% 0;z-index:21474836472;width:100%;border-radius:var(--widget-border-radius) var(--widget-border-radius) 0 0;box-shadow:var(--widget-shadow-offset-x) var(--widget-shadow-offset-y) var(--widget-shadow-blur-radius) var(--widget-shadow-spread-radius) var(--widget-shadow-color);transition:translate .3s ease-in-out}@media screen and (min-width: 1000px){._SurveyWidget_9d2ae_1._Type--Flyout_9d2ae_13{right:16px;left:auto;translate:unset;max-width:500px}}._SurveyWidget_9d2ae_1._Type--Flyout_9d2ae_13:not(._SurveyWidget--Open_9d2ae_32){translate:-50% 100%}@media screen and (min-width: 1000px){._SurveyWidget_9d2ae_1._Type--Flyout_9d2ae_13:not(._SurveyWidget--Open_9d2ae_32){translate:0 100%}}._SurveyWidget_9d2ae_1._Type--Popup_9d2ae_40{position:var(--position);top:50%;left:50%;translate:-50% -50%;z-index:21474836472;width:calc(100% - 16px);box-shadow:var(--widget-shadow-offset-x) var(--widget-shadow-offset-y) var(--widget-shadow-blur-radius) var(--widget-shadow-spread-radius) var(--widget-shadow-color)}@media screen and (min-width: 1000px){._SurveyWidget_9d2ae_1._Type--Popup_9d2ae_40{width:500px}}._SurveyWidget_9d2ae_1._Type--Popup_9d2ae_40:not(._SurveyWidget--Open_9d2ae_32){display:none}._SurveyWidget_9d2ae_1._Type--Link_9d2ae_57{width:calc(100% - 16px);margin:0 auto}@media screen and (min-width: 1000px){._SurveyWidget_9d2ae_1._Type--Link_9d2ae_57{width:500px}}._SurveyWidget__CloseButton_9d2ae_66{border:0;background-color:transparent;position:absolute;top:4px;right:4px;padding:8px;display:inline-flex;align-items:center;justify-content:center;color:var(--text-color);opacity:.5;cursor:pointer}._SurveyWidget__CloseButton_9d2ae_66._Position--Outside_9d2ae_81{top:-8px;right:0;transform:translateY(-100%);padding:0}._SurveyWidget__Header_9d2ae_87{display:flex;flex-direction:column;gap:8px;padding-right:40px}._SurveyWidget__Content_9d2ae_93{max-height:var(--max-height);overflow-y:auto;overflow:-moz-scrollbars-none;-ms-overflow-style:none;scrollbar-width:none}._SurveyWidget__Content_9d2ae_93::-webkit-scrollbar{display:none;width:0!important;height:0!important;background:transparent}._SurveyWidget__Footer_9d2ae_106{display:flex;flex-direction:column;align-items:center;justify-content:space-between;gap:16px;margin-top:auto}._Background_9d2ae_115{display:block;position:absolute;top:0;left:0;z-index:-1;width:100%;height:100%;background-color:var(--page-background-color)}._Branding_uq819_1{display:inline-flex;align-items:flex-end;gap:8px;text-decoration:none}._Branding__LogoIcon_uq819_7{width:16px;height:16px;color:var(--text-color)}._Branding__Text_uq819_12{color:var(--text-color);font-size:12px;line-height:1}._LongTextBlock_1el9q_1{display:flex;flex-direction:column}._MultipleChoiceBlock_jsfp3_1{display:flex;flex-direction:column;gap:8px;width:100%}._MultipleChoiceBlockItem_jsfp3_8{width:100%}._MultipleChoiceBlockItem__Input_jsfp3_11{border:0;clip:rect(0 0 0 0);clip-path:inset(100%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;white-space:nowrap;width:1px}._MultipleChoiceBlockItem__Content_jsfp3_23{display:flex;align-items:center;gap:8px;padding-block:var(--checkbox-padding-block);padding-inline:var(--checkbox-padding-inline);border-width:var(--checkbox-border-width);border-style:var(--checkbox-border-style);border-radius:var(--button-border-radius);border-color:var(--checkbox-border-color);background-color:var(--checkbox-background-color);color:var(--checkbox-color);font-family:var(--checkbox-font-family);font-size:var(--checkbox-font-size);font-weight:var(--checkbox-font-weight);letter-spacing:var(--checkbox-letter-spacing);text-transform:var(--checkbox-text-transform);cursor:pointer}._MultipleChoiceBlockItem__Input_jsfp3_11:not(:disabled)~._MultipleChoiceBlockItem__Content_jsfp3_23:hover{border-color:var(--checkbox-border-color-hover);background-color:var(--checkbox-background-color-hover);color:var(--checkbox-color-hover)}._MultipleChoiceBlockItem__Input_jsfp3_11:not(:disabled)~._MultipleChoiceBlockItem__Content_jsfp3_23:active{border-color:var(--checkbox-border-color-active);background-color:var(--checkbox-background-color-active);color:var(--checkbox-color-active)}._MultipleChoiceBlockItem__Input_jsfp3_11:checked~._MultipleChoiceBlockItem__Content_jsfp3_23{border-color:var(--checkbox-border-color-active);background-color:var(--checkbox-background-color-active);color:var(--checkbox-color-active)}._MultipleChoiceBlockItem__Checkbox_jsfp3_57,._MultipleChoiceBlockItem__Radio_jsfp3_57{position:relative;flex-shrink:0;width:16px;height:16px;border:1px solid currentColor;border-radius:4px}._MultipleChoiceBlockItem__Checkbox_jsfp3_57 ._Icon_jsfp3_65,._MultipleChoiceBlockItem__Radio_jsfp3_57 ._Icon_jsfp3_65{position:absolute;top:0;right:0;bottom:0;left:0;width:100%;height:100%;color:currentColor}._MultipleChoiceBlockItem__Input_jsfp3_11:not(:checked)~._MultipleChoiceBlockItem__Content_jsfp3_23 ._MultipleChoiceBlockItem__Checkbox_jsfp3_57 ._Icon_jsfp3_65,._MultipleChoiceBlockItem__Input_jsfp3_11:not(:checked)~._MultipleChoiceBlockItem__Content_jsfp3_23 ._MultipleChoiceBlockItem__Radio_jsfp3_57 ._Icon_jsfp3_65{opacity:0}._MultipleChoiceBlockItem__Radio_jsfp3_57{border-radius:100%}._MultipleChoiceBlockItem__Label_jsfp3_78{min-width:0;word-wrap:break-word;-webkit-hyphens:auto;hyphens:auto}._MultipleChoiceBlockItem__OtherInput_jsfp3_83{flex-grow:1;padding:0;border:0;background-color:transparent;color:inherit;font-size:inherit}._MultipleChoiceBlockItem__OtherInput_jsfp3_83:focus{outline:none}._RatingBlock_188x6_1{display:flex;flex-direction:column;gap:8px}._RatingBlock__List_188x6_6{display:flex;flex-wrap:nowrap;gap:2px}._RatingBlock__Labels_188x6_11{display:flex;justify-content:space-between}._RatingItem_188x6_16{display:inline-flex;width:100%}._RatingItem__Input_188x6_20{border:0;clip:rect(0 0 0 0);clip-path:inset(100%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;white-space:nowrap;width:1px}._RatingItem__Label_188x6_32{display:inline-flex;align-items:center;justify-content:center;width:100%;height:100%;padding:var(--checkbox-padding-block) 0;border:var(--checkbox-border-width) var(--checkbox-border-style) var(--checkbox-border-color);border-radius:var(--checkbox-border-radius);background-color:var(--checkbox-background-color);color:var(--checkbox-color);font-family:var(--checkbox-font-family);font-size:var(--checkbox-font-size);font-weight:var(--checkbox-font-weight);letter-spacing:var(--checkbox-letter-spacing);text-transform:var(--checkbox-text-transform);cursor:pointer}._RatingItem__Input_188x6_20:not(:disabled)~._RatingItem__Label_188x6_32:hover{border-color:var(--checkbox-border-color-hover);background-color:var(--checkbox-background-color-hover);color:var(--checkbox-color-hover)}._RatingItem__Input_188x6_20:not(:disabled)~._RatingItem__Label_188x6_32:active{border-color:var(--checkbox-border-color-active);background-color:var(--checkbox-background-color-active);color:var(--checkbox-color-active)}._RatingItem__Input_188x6_20:checked+._RatingItem__Label_188x6_32{border-color:var(--checkbox-border-color-active);background-color:var(--checkbox-background-color-active);color:var(--checkbox-color-active)}._ShortTextBlock_lmqfj_1{display:flex;flex-direction:column}._Button_1093r_1{display:inline-flex;justify-content:center;width:100%;padding-block:var(--button-padding-block);padding-inline:var(--button-padding-inline);border-width:var(--button-border-width);border-style:var(--button-border-style);border-radius:var(--button-border-radius);border-color:var(--button-border-color);background-color:var(--button-background-color);color:var(--button-color);font-family:var(--button-font-family);font-size:var(--button-font-size);font-weight:var(--button-font-weight);letter-spacing:var(--button-letter-spacing);text-transform:var(--button-text-transform)}._Button_1093r_1:not(:disabled){cursor:pointer}._Button_1093r_1:not(:disabled):hover{border-color:var(--button-border-color-hover);background-color:var(--button-background-color-hover);color:var(--button-color-hover)}._Button_1093r_1:not(:disabled):active{border-color:var(--button-border-color-active);background-color:var(--button-background-color-active);color:var(--button-color-active)}._Button_1093r_1:disabled{border-color:var(--button-border-color-disabled);background-color:var(--button-background-color-disabled);color:var(--button-color-disabled)}._Heading_td1xk_1{font-family:var(--heading-font-family);font-size:var(--heading-font-size);font-weight:var(--heading-font-weight);letter-spacing:var(--heading-letter-spacing);text-transform:var(--heading-text-transform);line-height:1.333em;color:var(--heading-color)}._Text_riu9t_1{font-family:var(--text-font-family);font-weight:var(--text-font-weight);letter-spacing:var(--text-letter-spacing);text-transform:var(--text-text-transform);line-height:1.333em;color:var(--text-color)}._Variant--BodySm_riu9t_10{font-size:calc(var(--text-font-size) / 1.2)}._Variant--BodyMd_riu9t_14{font-size:var(--text-font-size)}._Prominence--Weak_riu9t_18{opacity:.5}._TextField_1hsbc_1{padding-block:var(--text-field-padding-block);padding-inline:var(--text-field-padding-inline);border-width:var(--text-field-border-width);border-style:var(--text-field-border-style);border-radius:var(--text-field-border-radius);border-color:var(--text-field-border-color);background-color:var(--text-field-background-color);color:var(--text-field-color);font-family:var(--text-field-font-family);font-size:var(--text-field-font-size);font-weight:var(--text-field-font-weight);letter-spacing:var(--text-field-letter-spacing);text-transform:var(--text-field-text-transform)}._TextField_1hsbc_1:not(:disabled):hover{border-color:var(--text-field-border-color-hover);background-color:var(--text-field-background-color-hover);color:var(--text-field-color-hover)}._TextField_1hsbc_1:active{border-color:var(--text-field-border-color-active);background-color:var(--text-field-background-color-active);color:var(--text-field-color-active)}._TextField_1hsbc_1:disabled{border-color:var(--text-field-border-color-disabled);background-color:var(--text-field-background-color-disabled);color:var(--text-field-color-disabled)}._TextField_1hsbc_1:focus-visible{outline:none}._TextField_1hsbc_1::placeholder{color:var(--text-field-color);opacity:.5}</style><style>
                    .gbbActiveVariant {
                            background: #000000 !important;
                            color:#ffffff !important;
                        }
                    .gbbActiveImage {
                            border: 2px solid #000000 !important;
                    }    
                    .gbbBodyWrapper ::-webkit-scrollbar-thumb{
                        background: #F6F6F6 !important;
                    }    
                    .gbbActiveMsgDeliveryOptions {
                        border: 1px solid #A2A2A2 !important;
                        background-color: rgb(255, 255, 255) !important;
                    }      
                    .gbbCustomerUploadButton{
                        background-color: #000000;
                        color: #ffffff;
                    }      
                    </style><link rel="dns-prefetch preconnect" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/" crossorigin=""><script src="./Infused energy_files/covet-pics-widget.esm.js.download" type="module"></script><script src="./Infused energy_files/covet-pics-widget.js.download" nomodule=""></script><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.de/polyfills.aaTJ3aJS.js" crossorigin=""><style>.chspt-bubble-wrap{position:fixed;bottom:1rem;z-index:2147483640}.chspt-bubble-wrap .chspt-bubble{position:relative;height:1em;width:1em;border-radius:50%;cursor:pointer;display:block;background-position:center center;background-size:contain;background-repeat:no-repeat;box-shadow:0 10px 15px 3px rgba(0,0,0,.15);-webkit-animation:chspt-breathing 2s ease-out infinite normal;animation:chspt-breathing 2s ease-out infinite normal}.chspt-bubble-wrap .chspt-bubble--speech-bubble{position:relative;font-size:1rem;padding:1rem 1.25rem .5rem 1.25rem;margin-bottom:1rem;border-radius:16px 16px 0 16px;box-shadow:0 30.4528px 68.9024px -12px rgba(0,0,0,.07016),0 24.3724px 58.8672px -12px rgba(0,0,0,.04968),0 20.3656px 59.1808px -12px rgba(0,0,0,.03412),0 17.0392px 47.1296px -12px rgba(0,0,0,.01904);transition:all 350ms ease;max-width:18rem;transform:translateY(1rem);opacity:0;pointer-events:none;display:none}.chspt-bubble-wrap .chspt-bubble--speech-bubble .chspt-bubble--speech-bubble--arrow{width:0;height:0;position:absolute;border-right:28px solid #fff;border-left:14px solid transparent;border-top:14px solid #fff;border-bottom:20px solid transparent;right:0;bottom:-13px;z-index:-1}.chspt-bubble-wrap .chspt-bubble--speech-bubble .chspt-bubble--speech-bubble--content{line-height:1.8;z-index:10}.chspt-bubble-wrap .chspt-bubble--speech-bubble .chspt-bubble--speech-bubble--btn{display:block;margin:1rem 0 .25rem 0;padding:.65rem 1rem;border-radius:.75rem;text-align:center;text-decoration:none;font-weight:bolder;-webkit-backface-visibility:hidden;backface-visibility:hidden;transform:translate3d(0,0,0);transition:.2s ease transform;transform-origin:51% 51%}.chspt-bubble-wrap .chspt-bubble--speech-bubble .chspt-bubble--speech-bubble--btn:hover{transform:translate3d(0,0,0) scale(1.02)}.chspt-bubble-wrap .chspt-bubble--speech-bubble .chspt-bubble--speech-bubble--btn:active{transition:none;transform:scale(1)}.chspt-bubble-wrap .chspt-bubble--speech-bubble .chspt-bubble--close{position:absolute;top:-30px;right:0;width:24px;height:24px;line-height:24px;text-align:center;border-radius:50%;cursor:pointer;box-shadow:0 2px 6px 0 rgba(0,0,0,.1);transition:.2s ease transform}.chspt-bubble-wrap .chspt-bubble--speech-bubble .chspt-bubble--close svg{height:10px;width:10px;display:inline-block}.chspt-bubble-wrap .chspt-bubble--speech-bubble .chspt-bubble--close:hover{transform:scale(1.15)}.chspt-bubble-wrap .chspt-bubble--speech-bubble .chspt-bubble--close:active{transition:none;transform:scale(1)}.chspt-bubble-wrap .chspt-bubble--speech-bubble .chspt-bubble--copyright{display:flex;width:100%;align-items:center}.chspt-bubble-wrap .chspt-bubble--speech-bubble .chspt-bubble--copyright span{margin-left:.5rem;font-size:.75rem;color:#ababab;text-decoration:none}.chspt-bubble-wrap .chspt-bubble--speech-bubble.chspt-bubble-show{transform:translateY(0);opacity:1;pointer-events:all}.chspt-bubble-wrap.chspt-bubble-right{right:1rem}.chspt-bubble-wrap.chspt-bubble-right .chspt-bubble{margin-left:auto}.chspt-bubble-wrap.chspt-bubble-left{left:1rem}.chspt-bubble-wrap.chspt-bubble-left .chspt-bubble--speech-bubble{border-radius:16px 16px 16px 16px}.chspt-bubble-wrap.chspt-bubble-left .chspt-bubble--speech-bubble .chspt-bubble--speech-bubble--arrow{right:auto;left:0;transform:scaleX(-1)}@-webkit-keyframes chspt-breathing{0%{transform:scale(.9)}25%{transform:scale(1)}70%{transform:scale(.9)}100%{transform:scale(.9)}}@keyframes chspt-breathing{0%{transform:scale(.9)}25%{transform:scale(1)}70%{transform:scale(.9)}100%{transform:scale(.9)}}.chspt-order-opt-in-widget{padding:1.5rem;text-align:center;background:var(--chspt-typ-w-bg-color);color:var(--chspt-typ-w-text-color)}.chspt-order-opt-in-widget header,.chspt-order-opt-in-widget section{max-width:444px;margin-left:auto;margin-right:auto}.chspt-order-opt-in-widget.chspt-widget-loading{pointer-events:none;opacity:.4}.chspt-order-opt-in-widget header{display:flex;align-items:flex-start;padding-bottom:1rem;width:100%;justify-content:center}.chspt-order-opt-in-widget header .chspt-title-wrap{flex:4;display:inline-flex}.chspt-order-opt-in-widget header svg{flex:0 0 1.5rem;width:auto;height:1.5rem;margin-right:.5rem}.chspt-order-opt-in-widget header select{flex:0 0 1.5rem;width:auto;padding:.125rem .438rem;margin-left:1.5rem;background:#f3f3f3;border:1px solid #e9e9e9;border-radius:.5rem;font-size:.875rem;color:#221f20;-webkit-appearance:auto;-moz-appearance:auto;appearance:auto}.chspt-order-opt-in-widget header h3{color:var(--chspt-typ-w-text-color);margin:0;padding:0;font-size:1rem;font-weight:700;flex:0 1 auto}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--description p{margin-bottom:1rem;font-size:.875rem}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--phone-wrap{display:flex;align-items:flex-start}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--phone-wrap .chspt-order-opt-in-widget--country{flex:0 0 2rem}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--phone-wrap .chspt-order-opt-in-widget--phone{flex:1 1 auto;padding-left:1rem}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--phone-wrap .chspt-order-opt-in-widget--phone .chspt-order-opt-in-widget--input-wrap{background:#f8f8f8;border-radius:.75rem;display:flex;overflow:hidden}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--phone-wrap .chspt-order-opt-in-widget--phone .chspt-order-opt-in-widget--input-wrap .chspt-order-opt-in-widget--country-code{background:#f3f3f3;border-radius:.5rem 9999px 9999px .5rem;padding:.5rem 1.4rem;display:flex;align-items:center;color:#221f20}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--phone-wrap .chspt-order-opt-in-widget--phone .chspt-order-opt-in-widget--input-wrap .chspt-order-opt-in-widget--country-code input{width:2.2rem;padding-left:.2rem}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--phone-wrap .chspt-order-opt-in-widget--phone .chspt-order-opt-in-widget--input-wrap input{width:100%;padding-left:1rem;border:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;background:0 0;outline:0;color:#221f20}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--phone-wrap .chspt-order-opt-in-widget--phone .chspt-order-opt-in-widget--legal{margin-top:1rem}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--phone-wrap .chspt-order-opt-in-widget--phone .chspt-order-opt-in-widget--legal>label{display:flex;align-items:center;justify-content:center;color:var(--chspt-typ-w-text-color)}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--phone-wrap .chspt-order-opt-in-widget--phone .chspt-order-opt-in-widget--legal .chspt-order-opt-in-widget--checkbox{position:relative;display:block;cursor:pointer;margin-right:.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--phone-wrap .chspt-order-opt-in-widget--phone .chspt-order-opt-in-widget--legal .chspt-order-opt-in-widget--checkbox .chspt-order-opt-in-widget--checkbox-control{display:block;position:relative;height:1.25rem;width:1.25rem;background:#f3f3f3;border-radius:4px}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--phone-wrap .chspt-order-opt-in-widget--phone .chspt-order-opt-in-widget--legal .chspt-order-opt-in-widget--checkbox .chspt-order-opt-in-widget--checkbox-control svg{position:absolute;left:0;top:0;width:1.25rem;height:1.25rem;transition:transform 150ms ease;transform:scale(0)}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--phone-wrap .chspt-order-opt-in-widget--phone .chspt-order-opt-in-widget--legal .chspt-order-opt-in-widget--checkbox input{position:absolute;opacity:0;cursor:pointer;height:0;width:0}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--phone-wrap .chspt-order-opt-in-widget--phone .chspt-order-opt-in-widget--legal .chspt-order-opt-in-widget--checkbox input:checked+.chspt-order-opt-in-widget--checkbox-control svg{transform:scale(1)}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--phone-wrap .chspt-order-opt-in-widget--phone .chspt-order-opt-in-widget--legal a{color:inherit;font-size:.85rem;opacity:.5;text-decoration:underline}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--cta{padding-top:1.5rem}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--cta button{-webkit-appearance:none;-moz-appearance:none;appearance:none;outline:0;border:none;padding:.5rem 1.4rem;background:var(--chspt-typ-w-cta-bg-color);color:var(--chspt-typ-w-cta-text-color);text-align:center;border-radius:9999px}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--cta button svg{height:1.8rem;width:1.8rem;vertical-align:middle;line-height:0}.chspt-order-opt-in-widget .chspt-order-opt-in-widget--cta button span{font-size:1.1rem;padding-left:.25rem;display:inline-block;vertical-align:middle}.chspt-order-opt-in-widget.chspt-widget-success{background:var(--chspt-typ-w-success-bg-color);color:var(--chspt-typ-w-success-text-color);margin:1rem 0;min-height:17.85rem;height:100%;display:flex;align-items:center;justify-content:center}.chspt-order-opt-in-widget.chspt-widget-success header{display:flex;align-items:center;padding-bottom:1rem;width:100%;justify-content:center}.chspt-order-opt-in-widget.chspt-widget-success header svg{flex:0 0 2rem;width:2em;height:2rem;margin-right:.5rem}.chspt-order-opt-in-widget.chspt-widget-success header h3{margin:0;padding:0;font-weight:700;flex:0 1 auto;color:var(--chspt-typ-w-success-text-color)}.chspt-order-opt-in-widget.chspt-shopify-widget{margin-top:2rem}.chspt-modal-wrapper .chspt-modal{position:fixed;background:#fff;top:50%;left:50%;transform:translate(-50%,-50%);opacity:0;transition:all .2s ease-in-out;visibility:hidden;box-shadow:0 1px 3px 0 rgba(0,0,0,.1);max-height:90vh;z-index:999999}.chspt-modal-wrapper .chspt-modal .chspt-modal-close{position:absolute;height:30px;width:30px;min-width:0;color:#000;padding:0;right:calc(-30px / 2);top:calc(-30px / 2);border-radius:50%;border:none;background:#fff;outline:0;box-shadow:0 1px 3px 0 rgba(0,0,0,.1);display:flex;align-items:center;justify-content:center;opacity:0;visibility:hidden;transition:all .2s ease-in-out}.chspt-modal-wrapper .chspt-modal-overlay{position:fixed;top:0;bottom:0;left:0;right:0;transition:all .2s ease-in-out;background:gray;visibility:hidden;opacity:0;z-index:999999}.chspt-modal-wrapper.chspt-open .chspt-modal-overlay{visibility:visible;opacity:.5}.chspt-modal-wrapper.chspt-open .chspt-modal{opacity:1;visibility:visible}.chspt-modal-wrapper.chspt-open .chspt-modal .chspt-modal-close{opacity:1;visibility:visible}@media only screen and (min-width:576px){.chspt-modal{max-width:576px}}</style><style type="text/css" data-aphrodite=""></style><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.de/app.Cmz0dp0l.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.de/page-OnePage.CBlRslaG.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.de/DeliveryMethodSelectorSection.D3DlSDiW.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.de/useEditorShopPayNavigation.BIRuXOUZ.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.de/VaultedPayment.BexX1No3.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.de/LocalizationExtensionField.CU41F_7o.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.de/RememberMeDescriptionText.BM5qMQpE.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.de/ShopPayOptInDisclaimer.BYBMSMJe.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.de/PayButtonSection.B4rA5W4K.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.de/component-ShopPayVerificationSwitch.CL_EzNEH.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.de/useSubscribeMessenger.C-ZloIHt.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.de/index.iwkAaohc.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="style" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.de/assets/app.CqblHuRC.css" crossorigin=""><link rel="prefetch" fetchpriority="low" as="style" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.de/assets/OnePage.PMX4OSBO.css" crossorigin=""><link rel="prefetch" fetchpriority="low" as="style" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.de/assets/DeliveryMethodSelectorSection.DmqjTkNB.css" crossorigin=""><link rel="prefetch" fetchpriority="low" as="style" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.de/assets/useEditorShopPayNavigation.DCOTvxC3.css" crossorigin=""><link rel="prefetch" fetchpriority="low" as="style" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.de/assets/ShopPayVerificationSwitch.DW7NMDXG.css" crossorigin=""><link rel="prefetch" fetchpriority="low" as="image" href="https://cdn.shopify.com/s/files/1/0093/9704/3260/files/IN_1-3_Tagen_bei_dir_c370d52e-93f6-49ad-a829-a30f07a64b93_x320.png?v=1681548589" crossorigin=""></head>


  <body class="template- template- loaded" data-transitions="true" data-type_header_capitalize="false" data-type_base_accent_transform="true" data-type_header_accent_transform="true" data-animate_sections="true" data-animate_underlines="true" data-animate_buttons="true" data-animate_images="true" data-animate_page_transition_style="page-slow-fade" data-type_header_text_alignment="true" data-animate_images_style="zoom-fade" data-aos-easing="ease-out-quad" data-aos-duration="400" data-aos-delay="0" data-new-gr-c-s-check-loaded="14.1221.0" data-gr-ext-installed="" data-page="addProductsPage1" style="min-height: auto;"><div class="essential_annoucement_bar_wrapper essential_annoucement_bar_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea essential_annoucement_bar_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea_ bottom_page bottom_page_styles"><div class="essential_annoucement_main_content_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea"><div id="essential_annoucement_bar_icon_container_9eb920bf-362f-440a-b018-3ae144a6cbea" class="essential_annoucement_bar_icon_container_9eb920bf-362f-440a-b018-3ae144a6cbea"><div id="essential_annoucement_bar_icon_9eb920bf-362f-440a-b018-3ae144a6cbea" class="essential_annoucement_bar_icon_9eb920bf-362f-440a-b018-3ae144a6cbea"></div></div><div class="essential_annoucement_titles_outside_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea"><div class="essential_annoucement_titles_wrapper_9eb920bf-362f-440a-b018-3ae144a6cbea "><div id="essential_annoucement_bar_title_9eb920bf-362f-440a-b018-3ae144a6cbea" class="essential_annoucement_bar_title_container_9eb920bf-362f-440a-b018-3ae144a6cbea h2">INFUSER BOTTLE FOR FREE</div><p class="essential_annoucement_bar_subheading_9eb920bf-362f-440a-b018-3ae144a6cbea">Upgrade für grenzenlose Erfrischung</p></div></div><a class="essential_annoucement_bar_cta_9eb920bf-362f-440a-b018-3ae144a6cbea" href="https://infusedenergy.shop/pages/infusedays">ZUR AKTION</a></div><button class="essential_annoucement_bar_close_button_9eb920bf-362f-440a-b018-3ae144a6cbea"><svg width="12" height="12" fill="none"><path d="m7.414 6 4.293-4.293A.999.999 0 1 0 10.293.293L6 4.586 1.707.293A.999.999 0 1 0 .293 1.707L4.586 6 .293 10.293a.999.999 0 1 0 1.414 1.414L6 7.414l4.293 4.293a.997.997 0 0 0 1.414 0 .999.999 0 0 0 0-1.414L7.414 6Z" fill="#ffffff"></path></svg></button></div>
    
      <script type="text/javascript">
        window.setTimeout(function () {
          document.body.className += ' loaded';
        }, 25);
      </script>
    

    <a class="in-page-link visually-hidden skip-link js-no-transition" href="https://infusedenergy.shop/apps/gbb/easybundle/5?page=addProductsPage1&amp;currentFlow=byob#MainContent">Direkt zum Inhalt</a>

    <div id="PageContainer" class="page-container">
      <div class="transition-body"><div id="shopify-section-header" class="shopify-section"><div id="NavDrawer" class="drawer drawer--right">
  <div class="drawer__contents">
    <div class="drawer__fixed-header">
      <div class="drawer__header appear-animation appear-delay-2">
        <div class="drawer__title">
          <a href="https://infusedenergy.shop/" itemprop="url">
            <img src="./Infused energy_files/drawer-logo.png" alt="Infused energy" itemprop="logo">
          </a>
        </div>
        <div class="drawer__close">
          <button type="button" class="drawer__close-button js-drawer-close">
            <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-close" viewBox="0 0 64 64"><path d="M19 17.61l27.12 27.13m0-27.12L19 44.74"></path></svg>
            <span class="icon__fallback-text">Menü schließen</span>
          </button>
        </div>
      </div>
    </div>
    <div class="drawer__scrollable">
      <ul class="mobile-nav" role="navigation" aria-label="Primary"><li class="mobile-nav__item appear-animation appear-delay-3"><div class="mobile-nav__has-sublist"><a href="https://infusedenergy.shop/collections/shop-landing-page" class="mobile-nav__link" id="Label-collections-shop-landing-page1">
                    SHOP
                  </a>
                  <div class="mobile-nav__toggle">
                    <button type="button" class="collapsible-trigger collapsible--auto-height" aria-controls="Linklist-collections-shop-landing-page1" aria-labelledby="Label-collections-shop-landing-page1" aria-expanded="false"><span class="collapsible-trigger__icon collapsible-trigger__icon--open" role="presentation">
  <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon--wide icon-chevron-down" viewBox="0 0 28 16"><path d="M1.57 1.59l12.76 12.77L27.1 1.59" stroke-width="2" stroke="#000" fill="none" fill-rule="evenodd"></path></svg>
</span>
</button>
                  </div></div><div id="Linklist-collections-shop-landing-page1" class="mobile-nav__sublist collapsible-content collapsible-content--all">
                <div class="collapsible-content__inner"><ul class="mobile-nav__sublist sublist__megamenu"><li class="mobile-nav__item">
                        <div class="mobile-nav__child-item"><a href="https://infusedenergy.shop/collections/starter-sets" class="mobile-nav__link" id="Sublabel-collections-starter-sets1">
                              Starter Sets
                            </a></div></li><li class="mobile-nav__item">
                        <div class="mobile-nav__child-item"><a href="https://infusedenergy.shop/collections/einzelne-editionen" class="mobile-nav__link" id="Sublabel-collections-einzelne-editionen2">
                              Einzelne Editionen
                            </a></div></li><li class="mobile-nav__item">
                        <div class="mobile-nav__child-item"><a href="https://infusedenergy.shop/collections/infuser-bottles" class="mobile-nav__link" id="Sublabel-collections-infuser-bottles3">
                              Infuser Bottles
                            </a></div></li><li class="mobile-nav__item">
                        <div class="mobile-nav__child-item"><a href="https://infusedenergy.shop/collections/infused-fruity" class="mobile-nav__link" id="Sublabel-collections-infused-fruity4">
                              Infused Fruity
                            </a></div></li><li class="mobile-nav__item">
                        <div class="mobile-nav__child-item"><a href="https://infusedenergy.shop/collections/infused-recovery" class="mobile-nav__link" id="Sublabel-collections-infused-recovery5">
                              Infused Recovery
                            </a></div></li></ul><a href="https://infusedenergy.shop/collections/einzelne-editionen" class="ie__mega ie__mega--mobile appear-animation appear-delay-1">

                    


  <img src="./Infused energy_files/IE_Webshop_Header_Einzelpackungen.jpg" alt="Einzelne Editionen" srcset="//infusedenergy.shop/cdn/shop/collections/IE_Webshop_Header_Einzelpackungen.jpg?v=1677146084&amp;width=352 352w, //infusedenergy.shop/cdn/shop/collections/IE_Webshop_Header_Einzelpackungen.jpg?v=1677146084&amp;width=400 400w" width="400" height="125" loading="lazy" class="image-fit background-media-text__image background-media-text__image--header" sizes="100%">


<h3 class="mobile_mega_title"><strong>Infused</strong> energy
</h3>
                    
                      <p class="mega_menu_description mega_menu_description_mobile">Fokus &amp; Energie</p>
                    
                   </a><a href="https://infusedenergy.shop/collections/starter-sets" class="ie__mega ie__mega--mobile appear-animation appear-delay-2">

                    


  <img src="./Infused energy_files/IE_Webshop_Header_Bottle-Sets.jpg" alt="Starter Sets" srcset="//infusedenergy.shop/cdn/shop/collections/IE_Webshop_Header_Bottle-Sets.jpg?v=1724840503&amp;width=352 352w, //infusedenergy.shop/cdn/shop/collections/IE_Webshop_Header_Bottle-Sets.jpg?v=1724840503&amp;width=400 400w" width="400" height="125" loading="lazy" class="image-fit background-media-text__image background-media-text__image--header" sizes="100%">


<h3 class="mobile_mega_title"><strong>Starter</strong> Sets
</h3>
                    
                      <p class="mega_menu_description mega_menu_description_mobile">Perfekt für Neueinsteiger</p>
                    
                   </a><a href="https://infusedenergy.shop/collections/infused-fruity" class="ie__mega ie__mega--mobile appear-animation appear-delay-3">

                    


  <img src="./Infused energy_files/IE_Shop_Produktuebersicht-Header_Fruity_2880x900_3dd63482-0ea8-4860-829c-f5ee1cdf0add.jpg" alt="Koffeinfreie drinks" srcset="//infusedenergy.shop/cdn/shop/collections/IE_Shop_Produktuebersicht-Header_Fruity_2880x900_3dd63482-0ea8-4860-829c-f5ee1cdf0add.jpg?v=1677148641&amp;width=352 352w, //infusedenergy.shop/cdn/shop/collections/IE_Shop_Produktuebersicht-Header_Fruity_2880x900_3dd63482-0ea8-4860-829c-f5ee1cdf0add.jpg?v=1677148641&amp;width=400 400w" width="400" height="125" loading="lazy" class="image-fit background-media-text__image background-media-text__image--header" sizes="100%">


<h3 class="mobile_mega_title"><strong>Infused</strong> fruity
</h3>
                    
                      <p class="mega_menu_description mega_menu_description_mobile">koffeinfreier Genuss</p>
                    
                   </a><a href="https://infusedenergy.shop/collections/mix-match" class="ie__mega ie__mega--mobile appear-animation appear-delay-4">

                    


  <img src="./Infused energy_files/Mix_and_Match.png" alt="Mix &amp; Match" srcset="//infusedenergy.shop/cdn/shop/collections/Mix_and_Match.png?v=1726137290&amp;width=352 352w, //infusedenergy.shop/cdn/shop/collections/Mix_and_Match.png?v=1726137290&amp;width=400 400w" width="400" height="125" loading="lazy" class="image-fit background-media-text__image background-media-text__image--header" sizes="100%">


<h3 class="mobile_mega_title"><strong>Individuelle</strong> Sets
</h3>
                    
                      <p class="mega_menu_description mega_menu_description_mobile">Wähle deine Favoriten</p>
                    
                   </a><a href="https://infusedenergy.shop/collections/infuser-bottles" class="ie__mega ie__mega--mobile appear-animation appear-delay-5">

                    


  <img src="./Infused energy_files/IE_Webshop_Header_Infuser-Bottles_Homeinfuser.jpg" alt="Infuser Bottles" srcset="//infusedenergy.shop/cdn/shop/collections/IE_Webshop_Header_Infuser-Bottles_Homeinfuser.jpg?v=1720097430&amp;width=352 352w, //infusedenergy.shop/cdn/shop/collections/IE_Webshop_Header_Infuser-Bottles_Homeinfuser.jpg?v=1720097430&amp;width=400 400w" width="400" height="125" loading="lazy" class="image-fit background-media-text__image background-media-text__image--header" sizes="100%">


<h3 class="mobile_mega_title"><strong>Infuser</strong> Bottles
</h3>
                    
                      <p class="mega_menu_description mega_menu_description_mobile">Flaschen &amp; Zubehör</p>
                    
                   </a><a href="https://infusedenergy.shop/collections/infused-recovery" class="ie__mega ie__mega--mobile appear-animation appear-delay-6">

                    


  <img src="./Infused energy_files/IE_Shop_Produktuebersicht-Header_Recovery_2880x900_44cc622d-a014-42d5-b959-bb0d378fb748.jpg" alt="Infused Recovery" srcset="//infusedenergy.shop/cdn/shop/collections/IE_Shop_Produktuebersicht-Header_Recovery_2880x900_44cc622d-a014-42d5-b959-bb0d378fb748.jpg?v=1725038265&amp;width=352 352w, //infusedenergy.shop/cdn/shop/collections/IE_Shop_Produktuebersicht-Header_Recovery_2880x900_44cc622d-a014-42d5-b959-bb0d378fb748.jpg?v=1725038265&amp;width=400 400w" width="400" height="222" loading="lazy" class="image-fit background-media-text__image background-media-text__image--header" sizes="100%">


<h3 class="mobile_mega_title"><strong>Infused</strong> Recovery
</h3>
                    
                      <p class="mega_menu_description mega_menu_description_mobile">Regeneration &amp; Schlaf</p>
                    
                   </a><a href="https://infusedenergy.shop/collections/energy-latte" class="ie__mega ie__mega--mobile appear-animation appear-delay-7">

                    


  <img src="./Infused energy_files/new_MIX_MATCH_HEADER_MIDSUMMER_new.png" alt="Energy latte" srcset="//infusedenergy.shop/cdn/shop/collections/new_MIX_MATCH_HEADER_MIDSUMMER_new.png?v=1725038181&amp;width=352 352w, //infusedenergy.shop/cdn/shop/collections/new_MIX_MATCH_HEADER_MIDSUMMER_new.png?v=1725038181&amp;width=400 400w" width="400" height="222" loading="lazy" class="image-fit background-media-text__image background-media-text__image--header" sizes="100%">


<h3 class="mobile_mega_title"><strong>energy</strong> Latte
</h3>
                    
                      <p class="mega_menu_description mega_menu_description_mobile">Cremiger Wachmacher</p>
                    
                   </a><a href="https://infusedenergy.shop/collections/clean-2025" class="ie__mega ie__mega--mobile appear-animation appear-delay-8">

                    


  <img src="./Infused energy_files/20_6f3e3e03-28c0-47eb-981a-4b3eb0315f70.png" alt="Clean 2025" srcset="//infusedenergy.shop/cdn/shop/collections/20_6f3e3e03-28c0-47eb-981a-4b3eb0315f70.png?v=1735479585&amp;width=352 352w, //infusedenergy.shop/cdn/shop/collections/20_6f3e3e03-28c0-47eb-981a-4b3eb0315f70.png?v=1735479585&amp;width=400 400w" width="400" height="125" loading="lazy" class="image-fit background-media-text__image background-media-text__image--header" sizes="100%">


<h3 class="mobile_mega_title">Clean <strong>2025</strong>
</h3>
                    
                      <p class="mega_menu_description mega_menu_description_mobile">Für deinen Neustart 2025</p>
                    
                   </a><a href="https://infusedenergy.shop/collections/community-editionen" class="ie__mega ie__mega--mobile appear-animation appear-delay-9">

                    


  <img src="./Infused energy_files/IE_Shop_Produktuebersicht-Header_Community-Editions_2880x900_ad28f86a-23a3-479d-9297-f88e73f5520a.jpg" alt="Limited Editions" srcset="//infusedenergy.shop/cdn/shop/collections/IE_Shop_Produktuebersicht-Header_Community-Editions_2880x900_ad28f86a-23a3-479d-9297-f88e73f5520a.jpg?v=1737883902&amp;width=352 352w, //infusedenergy.shop/cdn/shop/collections/IE_Shop_Produktuebersicht-Header_Community-Editions_2880x900_ad28f86a-23a3-479d-9297-f88e73f5520a.jpg?v=1737883902&amp;width=400 400w" width="400" height="125" loading="lazy" class="image-fit background-media-text__image background-media-text__image--header" sizes="100%">


<h3 class="mobile_mega_title"><strong>Limited</strong> Editions
</h3>
                    
                      <p class="mega_menu_description mega_menu_description_mobile">Einzigartig &amp; limitiert</p>
                    
                   </a></div>
              </div></li><li class="mobile-nav__item appear-animation appear-delay-4"><a href="https://infusedenergy.shop/pages/zutaten-1" class="mobile-nav__link">ZUTATEN</a></li><li class="mobile-nav__item appear-animation appear-delay-5"><a href="https://infusedenergy.shop/pages/wirkung" class="mobile-nav__link">WIRKUNG</a></li><li class="mobile-nav__item appear-animation appear-delay-6"><a href="https://infusedenergy.shop/pages/story" class="mobile-nav__link">STORY</a></li><li class="mobile-nav__item appear-animation appear-delay-7"><a href="https://infusedenergy.shop/pages/faq-1" class="mobile-nav__link">FAQ</a></li><li class="mobile-nav__item appear-animation appear-delay-8"><a href="https://infusedenergy.shop/pages/kontakt-1" class="mobile-nav__link">KONTAKT</a></li><li class="mobile-nav__item appear-animation appear-delay-9">
              <a href="https://infusedenergy.shop/account/login" class="mobile-nav__link">Einloggen</a>
            </li><li class="mobile-nav__spacer"></li>
      </ul>

      <a href="https://infusedenergy.shop/products/30-days-cleaning-kur" class="drawer__teaser">
        <span>START <strong>2025</strong> RIGHT</span>
        <div class="drawer__teaser-img">
        


  <img src="./Infused energy_files/Kein_Titel_500_x_800_px_1080_x_1920_px_915_x_570_px_2.png" srcset="//infusedenergy.shop/cdn/shop/files/Kein_Titel_500_x_800_px_1080_x_1920_px_915_x_570_px_2.png?v=1736535181&amp;width=352 352w, //infusedenergy.shop/cdn/shop/files/Kein_Titel_500_x_800_px_1080_x_1920_px_915_x_570_px_2.png?v=1736535181&amp;width=400 400w" width="400" height="249" loading="lazy" class="image-fit background-media-text__image" sizes="100%">


        </div><h4><strong>30 TAGE</strong> CLEANING KUR</h4>
        <p>The power of nature</p>
      </a>

      <ul class="no-bullets social-icons mobile-nav__social"><li>
      <a target="_blank" rel="noopener" href="https://www.instagram.com/infused.energy/?hl=de" title="Infused energy auf Instagram" class="js-no-transition">
        <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-instagram" viewBox="0 0 32 32"><path fill="#444" d="M16 3.094c4.206 0 4.7.019 6.363.094 1.538.069 2.369.325 2.925.544.738.287 1.262.625 1.813 1.175s.894 1.075 1.175 1.813c.212.556.475 1.387.544 2.925.075 1.662.094 2.156.094 6.363s-.019 4.7-.094 6.363c-.069 1.538-.325 2.369-.544 2.925-.288.738-.625 1.262-1.175 1.813s-1.075.894-1.813 1.175c-.556.212-1.387.475-2.925.544-1.663.075-2.156.094-6.363.094s-4.7-.019-6.363-.094c-1.537-.069-2.369-.325-2.925-.544-.737-.288-1.263-.625-1.813-1.175s-.894-1.075-1.175-1.813c-.212-.556-.475-1.387-.544-2.925-.075-1.663-.094-2.156-.094-6.363s.019-4.7.094-6.363c.069-1.537.325-2.369.544-2.925.287-.737.625-1.263 1.175-1.813s1.075-.894 1.813-1.175c.556-.212 1.388-.475 2.925-.544 1.662-.081 2.156-.094 6.363-.094zm0-2.838c-4.275 0-4.813.019-6.494.094-1.675.075-2.819.344-3.819.731-1.037.4-1.913.944-2.788 1.819S1.486 4.656 1.08 5.688c-.387 1-.656 2.144-.731 3.825-.075 1.675-.094 2.213-.094 6.488s.019 4.813.094 6.494c.075 1.675.344 2.819.731 3.825.4 1.038.944 1.913 1.819 2.788s1.756 1.413 2.788 1.819c1 .387 2.144.656 3.825.731s2.213.094 6.494.094 4.813-.019 6.494-.094c1.675-.075 2.819-.344 3.825-.731 1.038-.4 1.913-.944 2.788-1.819s1.413-1.756 1.819-2.788c.387-1 .656-2.144.731-3.825s.094-2.212.094-6.494-.019-4.813-.094-6.494c-.075-1.675-.344-2.819-.731-3.825-.4-1.038-.944-1.913-1.819-2.788s-1.756-1.413-2.788-1.819c-1-.387-2.144-.656-3.825-.731C20.812.275 20.275.256 16 .256z"></path><path fill="#444" d="M16 7.912a8.088 8.088 0 0 0 0 16.175c4.463 0 8.087-3.625 8.087-8.088s-3.625-8.088-8.088-8.088zm0 13.338a5.25 5.25 0 1 1 0-10.5 5.25 5.25 0 1 1 0 10.5zM26.294 7.594a1.887 1.887 0 1 1-3.774.002 1.887 1.887 0 0 1 3.774-.003z"></path></svg>
        <span class="icon__fallback-text">Instagram</span>
      </a>
    </li><li>
      <a target="_blank" rel="noopener" href="https://www.facebook.com/infusedenergyDE" title="Infused energy auf Facebook" class="js-no-transition">
        <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-facebook" viewBox="0 0 14222 14222"><path d="M14222 7112c0 3549.352-2600.418 6491.344-6000 7024.72V9168h1657l315-2056H8222V5778c0-562 275-1111 1159-1111h897V2917s-814-139-1592-139c-1624 0-2686 984-2686 2767v1567H4194v2056h1806v4968.72C2600.418 13603.344 0 10661.352 0 7112 0 3184.703 3183.703 1 7111 1s7111 3183.703 7111 7111zm-8222 7025c362 57 733 86 1111 86-377.945 0-749.003-29.485-1111-86.28zm2222 0v-.28a7107.458 7107.458 0 0 1-167.717 24.267A7407.158 7407.158 0 0 0 8222 14137zm-167.717 23.987C7745.664 14201.89 7430.797 14223 7111 14223c319.843 0 634.675-21.479 943.283-62.013z"></path></svg>
        <span class="icon__fallback-text">Facebook</span>
      </a>
    </li><li>
      <a target="_blank" rel="noopener" href="https://www.youtube.com/channel/UCoPCBmF79qQiOSyGhFw0HyQ" title="Infused energy auf YouTube" class="js-no-transition">
        <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-youtube" viewBox="0 0 21 20"><path fill="#444" d="M-.196 15.803q0 1.23.812 2.092t1.977.861h14.946q1.165 0 1.977-.861t.812-2.092V3.909q0-1.23-.82-2.116T17.539.907H2.593q-1.148 0-1.969.886t-.82 2.116v11.894zm7.465-2.149V6.058q0-.115.066-.18.049-.016.082-.016l.082.016 7.153 3.806q.066.066.066.164 0 .066-.066.131l-7.153 3.806q-.033.033-.066.033-.066 0-.098-.033-.066-.066-.066-.131z"></path></svg>
        <span class="icon__fallback-text">YouTube</span>
      </a>
    </li><li>
      <a target="_blank" rel="noopener" href="https://www.tiktok.com/@infused.energy?lang=de-DE" title="Infused energy auf TikTok" class="js-no-transition">
        <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-tiktok" viewBox="0 0 2859 3333"><path d="M2081 0c55 473 319 755 778 785v532c-266 26-499-61-770-225v995c0 1264-1378 1659-1932 753-356-583-138-1606 1004-1647v561c-87 14-180 36-265 65-254 86-398 247-358 531 77 544 1075 705 992-358V1h551z"></path></svg>
        <span class="icon__fallback-text">TikTok</span>
      </a>
    </li></ul>

    </div>
  </div>
</div>

<style data-shopify="">.site-nav__link,
  .site-nav__dropdown-link {
    font-size: 18px;
  }.site-header {
      border-bottom: 1px solid;
      border-bottom-color: #e8e8e1;
    }</style><div data-section-id="header" data-section-type="header">
  <div id="HeaderWrapper" class="header-wrapper"><div id="StickyHeaderWrap" style="height: 124px;"><header id="SiteHeader" class="site-header" data-sticky="true" data-overlay="false">
      <div class="page-width">
        <div class="header-layout header-layout--left-center" data-logo-align="left"><div class="header-item header-item--logo"><style data-shopify="">.header-item--logo,
  .header-layout--left-center .header-item--logo,
  .header-layout--left-center .header-item--icons {
    -webkit-box-flex: 0 1 140px;
    -ms-flex: 0 1 140px;
    flex: 0 1 140px;
  }

  @media only screen and (min-width: 769px) {
    .header-item--logo,
    .header-layout--left-center .header-item--logo,
    .header-layout--left-center .header-item--icons {
      -webkit-box-flex: 0 0 200px;
      -ms-flex: 0 0 200px;
      flex: 0 0 200px;
    }
  }

  .site-header__logo a {
    max-width: 140px;
  }
  .is-light .site-header__logo .logo--inverted {
    max-width: 140px;
  }
  @media only screen and (min-width: 769px) {
    .site-header__logo a {
      max-width: 200px;
    }

    .is-light .site-header__logo .logo--inverted {
      max-width: 200px;
    }
  }</style><div id="LogoContainer" class="h1 site-header__logo" itemscope="" itemtype="http://schema.org/Organization">
  <a href="https://infusedenergy.shop/" itemprop="url" class="site-header__logo-link logo--has-inverted" style="padding-top: 30.0%">
    <img class="small--hide" src="./Infused energy_files/ie-logo-black_200x.png" srcset="//infusedenergy.shop/cdn/shop/files/ie-logo-black_200x.png?v=1672310063 1x, //infusedenergy.shop/cdn/shop/files/ie-logo-black_200x@2x.png?v=1672310063 2x" alt="Infused energy" itemprop="logo">
    <img class="medium-up--hide" src="./Infused energy_files/ie-logo-black_140x.png" srcset="//infusedenergy.shop/cdn/shop/files/ie-logo-black_140x.png?v=1672310063 1x, //infusedenergy.shop/cdn/shop/files/ie-logo-black_140x@2x.png?v=1672310063 2x" alt="Infused energy">
  </a><a href="https://infusedenergy.shop/" itemprop="url" class="site-header__logo-link logo--inverted" style="padding-top: 30.0%">
      <img class="small--hide" src="./Infused energy_files/ie-logo-white_200x.png" srcset="//infusedenergy.shop/cdn/shop/files/ie-logo-white_200x.png?v=1672310083 1x, //infusedenergy.shop/cdn/shop/files/ie-logo-white_200x@2x.png?v=1672310083 2x" alt="Infused energy" itemprop="logo">
      <img class="medium-up--hide" src="./Infused energy_files/ie-logo-white_140x.png" srcset="//infusedenergy.shop/cdn/shop/files/ie-logo-white_140x.png?v=1672310083 1x, //infusedenergy.shop/cdn/shop/files/ie-logo-white_140x@2x.png?v=1672310083 2x" alt="Infused energy">
    </a></div></div><div class="header-item header-item--navigation text-center"><ul class="site-nav site-navigation medium-down--hide" role="navigation" aria-label="Primary"><li class="site-nav__item site-nav__expanded-item site-nav--has-dropdown site-nav--is-megamenu" aria-haspopup="true">

      <a href="https://infusedenergy.shop/collections/shop-landing-page" class="site-nav__link site-nav__link--has-dropdown">
        SHOP
<svg aria-hidden="true" focusable="false" role="presentation" class="icon icon--wide icon-chevron-down" viewBox="0 0 28 16"><path d="M1.57 1.59l12.76 12.77L27.1 1.59" stroke-width="2" stroke="#000" fill="none" fill-rule="evenodd"></path></svg></a><div class="site-nav__dropdown megamenu text-left">
          <div class="page-width">
            <div class="megamenu__wrapper">
              <div class="megamenu__cols">
                <div class="megamenu__col"><a href="https://infusedenergy.shop/collections/einzelne-editionen" class="ie__mega appear-animation appear-delay-1">

                    


  <img src="./Infused energy_files/IE_Webshop_Header_Einzelpackungen(1).jpg" alt="Einzelne Editionen" srcset="//infusedenergy.shop/cdn/shop/collections/IE_Webshop_Header_Einzelpackungen.jpg?v=1677146084&amp;width=352 352w, //infusedenergy.shop/cdn/shop/collections/IE_Webshop_Header_Einzelpackungen.jpg?v=1677146084&amp;width=600 600w" width="600" height="188" loading="lazy" class="image-fit background-media-text__image background-media-text__image--header" sizes="100%">


<h3 class="margin_botton_zero"><strong>Infused</strong> energy
</h3>
                    
                      <p class="mega_menu_description mega_menu_description_desktop">Fokus &amp; Energie</p>
                    
                   </a><a href="https://infusedenergy.shop/collections/starter-sets" class="ie__mega appear-animation appear-delay-2">

                    


  <img src="./Infused energy_files/IE_Webshop_Header_Bottle-Sets(1).jpg" alt="Starter Sets" srcset="//infusedenergy.shop/cdn/shop/collections/IE_Webshop_Header_Bottle-Sets.jpg?v=1724840503&amp;width=352 352w, //infusedenergy.shop/cdn/shop/collections/IE_Webshop_Header_Bottle-Sets.jpg?v=1724840503&amp;width=600 600w" width="600" height="188" loading="lazy" class="image-fit background-media-text__image background-media-text__image--header" sizes="100%">


<h3 class="margin_botton_zero"><strong>Starter</strong> Sets
</h3>
                    
                      <p class="mega_menu_description mega_menu_description_desktop">Perfekt für Neueinsteiger</p>
                    
                   </a><a href="https://infusedenergy.shop/collections/infused-fruity" class="ie__mega appear-animation appear-delay-3">

                    


  <img src="./Infused energy_files/IE_Shop_Produktuebersicht-Header_Fruity_2880x900_3dd63482-0ea8-4860-829c-f5ee1cdf0add(1).jpg" alt="Koffeinfreie drinks" srcset="//infusedenergy.shop/cdn/shop/collections/IE_Shop_Produktuebersicht-Header_Fruity_2880x900_3dd63482-0ea8-4860-829c-f5ee1cdf0add.jpg?v=1677148641&amp;width=352 352w, //infusedenergy.shop/cdn/shop/collections/IE_Shop_Produktuebersicht-Header_Fruity_2880x900_3dd63482-0ea8-4860-829c-f5ee1cdf0add.jpg?v=1677148641&amp;width=600 600w" width="600" height="188" loading="lazy" class="image-fit background-media-text__image background-media-text__image--header" sizes="100%">


<h3 class="margin_botton_zero"><strong>Infused</strong> fruity
</h3>
                    
                      <p class="mega_menu_description mega_menu_description_desktop">koffeinfreier Genuss</p>
                    
                   </a><a href="https://infusedenergy.shop/collections/mix-match" class="ie__mega appear-animation appear-delay-4">

                    


  <img src="./Infused energy_files/Mix_and_Match(1).png" alt="Mix &amp; Match" srcset="//infusedenergy.shop/cdn/shop/collections/Mix_and_Match.png?v=1726137290&amp;width=352 352w, //infusedenergy.shop/cdn/shop/collections/Mix_and_Match.png?v=1726137290&amp;width=600 600w" width="600" height="188" loading="lazy" class="image-fit background-media-text__image background-media-text__image--header" sizes="100%">


<h3 class="margin_botton_zero"><strong>Individuelle</strong> Sets
</h3>
                    
                      <p class="mega_menu_description mega_menu_description_desktop">Wähle deine Favoriten</p>
                    
                   </a><a href="https://infusedenergy.shop/collections/infuser-bottles" class="ie__mega appear-animation appear-delay-5">

                    


  <img src="./Infused energy_files/IE_Webshop_Header_Infuser-Bottles_Homeinfuser(1).jpg" alt="Infuser Bottles" srcset="//infusedenergy.shop/cdn/shop/collections/IE_Webshop_Header_Infuser-Bottles_Homeinfuser.jpg?v=1720097430&amp;width=352 352w, //infusedenergy.shop/cdn/shop/collections/IE_Webshop_Header_Infuser-Bottles_Homeinfuser.jpg?v=1720097430&amp;width=600 600w" width="600" height="188" loading="lazy" class="image-fit background-media-text__image background-media-text__image--header" sizes="100%">


<h3 class="margin_botton_zero"><strong>Infuser</strong> Bottles
</h3>
                    
                      <p class="mega_menu_description mega_menu_description_desktop">Flaschen &amp; Zubehör</p>
                    
                   </a><a href="https://infusedenergy.shop/collections/infused-recovery" class="ie__mega appear-animation appear-delay-6">

                    


  <img src="./Infused energy_files/IE_Shop_Produktuebersicht-Header_Recovery_2880x900_44cc622d-a014-42d5-b959-bb0d378fb748(1).jpg" alt="Infused Recovery" srcset="//infusedenergy.shop/cdn/shop/collections/IE_Shop_Produktuebersicht-Header_Recovery_2880x900_44cc622d-a014-42d5-b959-bb0d378fb748.jpg?v=1725038265&amp;width=352 352w, //infusedenergy.shop/cdn/shop/collections/IE_Shop_Produktuebersicht-Header_Recovery_2880x900_44cc622d-a014-42d5-b959-bb0d378fb748.jpg?v=1725038265&amp;width=600 600w" width="600" height="333" loading="lazy" class="image-fit background-media-text__image background-media-text__image--header" sizes="100%">


<h3 class="margin_botton_zero"><strong>Infused</strong> Recovery
</h3>
                    
                      <p class="mega_menu_description mega_menu_description_desktop">Regeneration &amp; Schlaf</p>
                    
                   </a><a href="https://infusedenergy.shop/collections/energy-latte" class="ie__mega appear-animation appear-delay-7">

                    


  <img src="./Infused energy_files/new_MIX_MATCH_HEADER_MIDSUMMER_new(1).png" alt="Energy latte" srcset="//infusedenergy.shop/cdn/shop/collections/new_MIX_MATCH_HEADER_MIDSUMMER_new.png?v=1725038181&amp;width=352 352w, //infusedenergy.shop/cdn/shop/collections/new_MIX_MATCH_HEADER_MIDSUMMER_new.png?v=1725038181&amp;width=600 600w" width="600" height="333" loading="lazy" class="image-fit background-media-text__image background-media-text__image--header" sizes="100%">


<h3 class="margin_botton_zero"><strong>energy</strong> Latte
</h3>
                    
                      <p class="mega_menu_description mega_menu_description_desktop">Cremiger Wachmacher</p>
                    
                   </a><a href="https://infusedenergy.shop/collections/clean-2025" class="ie__mega appear-animation appear-delay-8">

                    


  <img src="./Infused energy_files/20_6f3e3e03-28c0-47eb-981a-4b3eb0315f70(1).png" alt="Clean 2025" srcset="//infusedenergy.shop/cdn/shop/collections/20_6f3e3e03-28c0-47eb-981a-4b3eb0315f70.png?v=1735479585&amp;width=352 352w, //infusedenergy.shop/cdn/shop/collections/20_6f3e3e03-28c0-47eb-981a-4b3eb0315f70.png?v=1735479585&amp;width=600 600w" width="600" height="188" loading="lazy" class="image-fit background-media-text__image background-media-text__image--header" sizes="100%">


<h3 class="margin_botton_zero">Clean <strong>2025</strong>
</h3>
                    
                      <p class="mega_menu_description mega_menu_description_desktop">Für deinen Neustart 2025</p>
                    
                   </a><a href="https://infusedenergy.shop/collections/community-editionen" class="ie__mega appear-animation appear-delay-9">

                    


  <img src="./Infused energy_files/IE_Shop_Produktuebersicht-Header_Community-Editions_2880x900_ad28f86a-23a3-479d-9297-f88e73f5520a(1).jpg" alt="Limited Editions" srcset="//infusedenergy.shop/cdn/shop/collections/IE_Shop_Produktuebersicht-Header_Community-Editions_2880x900_ad28f86a-23a3-479d-9297-f88e73f5520a.jpg?v=1737883902&amp;width=352 352w, //infusedenergy.shop/cdn/shop/collections/IE_Shop_Produktuebersicht-Header_Community-Editions_2880x900_ad28f86a-23a3-479d-9297-f88e73f5520a.jpg?v=1737883902&amp;width=600 600w" width="600" height="188" loading="lazy" class="image-fit background-media-text__image background-media-text__image--header" sizes="100%">


<h3 class="margin_botton_zero"><strong>Limited</strong> Editions
</h3>
                    
                      <p class="mega_menu_description mega_menu_description_desktop">Einzigartig &amp; limitiert</p>
                    
                   </a></div>
              </div>
              
              <div class="megamenu__showall">
                <a class="btn btn--inverse underline__link" href="https://infusedenergy.shop/collections/starter-sets">Perfekt für deine 1. Bestellung</a>
              </div>
            
</div>
              <div class="megamenu__newsletter">
                <div>
                  <button class="rm-open-popup megamenu__newsletter-btn">Newsletter abonnieren</button>
                  <span>Du kannst den Newsletter jederzeit abbestellen. Unsere <a href="https://infusedenergy.shop/pages/datenschutz">Datenschutzerklärung</a> findest du hier.</span>
                </div>
                <p>Melde dich hier zu unserem Newsletter an und erhalte als Dankeschön einen 15 % Gutschein</p>
              </div>

          </div>
        </div></li><li class="site-nav__item site-nav__expanded-item">

      <a href="https://infusedenergy.shop/pages/zutaten-1" class="site-nav__link">
        ZUTATEN
</a></li><li class="site-nav__item site-nav__expanded-item">

      <a href="https://infusedenergy.shop/pages/wirkung" class="site-nav__link">
        WIRKUNG
</a></li><li class="site-nav__item site-nav__expanded-item">

      <a href="https://infusedenergy.shop/pages/story" class="site-nav__link">
        STORY
</a></li><li class="site-nav__item site-nav__expanded-item">

      <a href="https://infusedenergy.shop/pages/faq-1" class="site-nav__link">
        FAQ
</a></li><li class="site-nav__item site-nav__expanded-item">

      <a href="https://infusedenergy.shop/pages/kontakt-1" class="site-nav__link">
        KONTAKT
</a></li></ul>
</div><div class="header-item header-item--icons"><div class="site-nav site-nav--icons">
  <div class="site-nav__icons">
    
      <a class="site-nav__link site-nav__link--icon medium-down--hide" href="https://infusedenergy.shop/account">
        <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-user" viewBox="0 0 64 64"><path d="M35 39.84v-2.53c3.3-1.91 6-6.66 6-11.41 0-7.63 0-13.82-9-13.82s-9 6.19-9 13.82c0 4.75 2.7 9.51 6 11.41v2.53c-10.18.85-18 6-18 12.16h42c0-6.19-7.82-11.31-18-12.16z"></path></svg>
        <span class="icon__fallback-text">
          
            Einloggen
          
        </span>
      </a>
    

    
      <a href="https://infusedenergy.shop/search" class="site-nav__link site-nav__link--icon js-search-header js-no-transition">
        <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-search" viewBox="0 0 64 64"><path d="M47.16 28.58A18.58 18.58 0 1 1 28.58 10a18.58 18.58 0 0 1 18.58 18.58zM54 54L41.94 42"></path></svg>
        <span class="icon__fallback-text">Suche</span>
      </a>
    

    
      <button type="button" class="site-nav__link site-nav__link--icon js-drawer-open-nav large-up--hide" aria-controls="NavDrawer" aria-expanded="false">
        <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-hamburger" viewBox="0 0 64 64"><path d="M7 15h51M7 32h43M7 49h51"></path></svg>
        <span class="icon__fallback-text">Seitennavigation</span>
      </button>
    

    <a href="https://infusedenergy.shop/cart" class="site-nav__link site-nav__link--icon js-drawer-open-cart js-no-transition" aria-controls="CartDrawer" data-icon="cart">
      <span class="cart-link"><svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-cart" viewBox="0 0 64 64"><path d="M14 17.44h46.79l-7.94 25.61H20.96l-9.65-35.1H3"></path><circle cx="27" cy="53" r="2"></circle><circle cx="47" cy="53" r="2"></circle></svg><span class="icon__fallback-text">Einkaufswagen</span>
        <span class="cart-link__bubble cart-link__bubble--visible"></span>
      </span>
    </a>
  </div>
</div>
</div>
        </div></div>
      <div class="site-header__search-container">
        <div class="site-header__search">
          <div class="page-width">
            <form action="https://infusedenergy.shop/search" method="get" id="HeaderSearchForm" class="site-header__search-form" role="search" autocomplete="off">
              <input type="hidden" name="type" value="product,article,page,collection">
              <input type="hidden" name="options[prefix]" value="last">
              <label for="search-icon" class="hidden-label">Suchen</label>
              <label for="SearchClose" class="hidden-label">"Schließen (Esc)"</label>
              <button type="submit" id="search-icon" class="text-link site-header__search-btn">
                <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-search" viewBox="0 0 64 64">
                  <path d="M47.16 28.58A18.58 18.58 0 1 1 28.58 10a18.58 18.58 0 0 1 18.58 18.58zM54 54L41.94 42"></path>
                </svg>
                <span class="icon__fallback-text">Suchen</span>
              </button>
              <input type="search" name="q" value="" placeholder="Durchsuchen Sie unseren Shop" class="site-header__search-input" aria-label="Durchsuchen Sie unseren Shop">
            </form>
            <button type="button" id="SearchClose" class="text-link site-header__search-btn">
              <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-close" viewBox="0 0 64 64">
                <path d="M19 17.61l27.12 27.13m0-27.12L19 44.74"></path>
              </svg>
              <span class="icon__fallback-text">"Schließen (Esc)"</span>
            </button>
          </div>
        </div><div id="PredictiveWrapper" class="predictive-results hide">
            <div class="page-width">
              <div id="PredictiveResults" class="predictive-result__layout"></div>
              <div class="text-center predictive-results__footer">
                <button type="button" class="btn" data-predictive-search-button="">
                  <small>
                    Mehr sehen
                  </small>
                </button>
              </div>
            </div>
          </div></div>
    </header></div>
  </div>
</div>
</div><div id="shopify-section-newsletter-popup" class="shopify-section index-section--hidden">


</div>

        <main class="main-content" id="MainContent">
          
    
    <div class="gbbPageBody gbbProductsCardLayoutV2 gbbNewPageCustomization bundle-5" id="gbbBundle" style="font-family: nudista-web, sans-serif, sans-serif; background-color: rgb(255, 255, 255);"><div class="gbbHTMLWrapper"><div class="gbbBodyWrapper"><div class="gbbAddGiftBoxPageWrapper" style=""><div class="gbbAddProductsPageHeader"><div class="gbbPageHeader"></div><div class="gbbAddProductsPageNavigationContainer" style="margin: 0%;"><div class="gbbNavigationItemsContainer"><div class="gbbNavigationItem" id="addProductsPage1"><div class="gbbNavigationStepImgContainer gbbNavigationStepImgContainerActive" style="border: 4px solid rgb(165, 192, 47);"><img class="gbbNavigationImage" src="./Infused energy_files/1722574703530.png"></div><div class="gbbNavigationTitleContainer"><p class="gbbNavigationTitle" style="color: rgb(0, 0, 0);">Sorten</p></div></div><div class="gbbNavigationItem" id="addProductsPage2"><div class="gbbNavigationStepImgContainer"><img class="gbbNavigationImage" src="./Infused energy_files/1722595532622.png"></div><div class="gbbNavigationTitleContainer"><p class="gbbNavigationTitle" style="color: rgb(0, 0, 0);">Zubehör</p></div></div><div class="gbbStepsProgressBarContainer" style="width: 451.93px;"><div class="gbbStepsProgressBar" style="background: rgb(231, 235, 209);"><div class="gbbStepsProgressBarFilled" style="background: rgb(165, 192, 47); width: 0px;"></div></div></div></div></div></div><div class="gbbAddProductPageSubtextWrapper"><div class="gbbAddProductPageSubtext" style="color: rgb(0, 0, 0);"></div><div class="gbbAddProductPageBanners"><img class="gbbMobileImageBanner" src="./Infused energy_files/1732479681588.png"><img class="gbbDesktopImageBanner" src="./Infused energy_files/1732479678991.png"></div></div><div class="gbbDiscountComponent"></div><div class="gbbAddProductsPageHTML"><div class="gbbAddProductsContainerHTML"><div class="gbbFiltersSearchSortHeader"></div><div class="gbbProductsContainer"><div class="gbbProductsItemsContainer gbbProductsItemsContainerLessProducts" total-products="4"><div class="gbbProductItem" productid="9797276565770" firstvariantid="50264118821130" style="background: rgb(241, 242, 243); color: rgb(37, 37, 37);"><div class="gbbProductImageContainer"><img class="gbbProductImageContainerImg0 gbbProductImageContainerImg gbbFade" src="./Infused energy_files/IE_Infused-Latte_Cacao_Milky-Chocolate_Front_1420x1420_c289b805-bc64-4733-8c95-e41d29dc46b0.png" style="display: block;"><a class="gbbPrevImage" style="display: none;">❮</a><a class="gbbNextImage" style="display: none;">❯</a><div class="gbbProductItemOverLay"><div class="gbbOverLayIconContainer"></div></div></div><div class="gbbProductTextContainer"><div class="gbbProductItemTitle" style="cursor: pointer;"><div class="gbbProductTitleOnly">Energy latte - Cacao</div><div class="gbbVariantTitle"></div></div></div><div class="gbbProductActionContainer"><div class="gbbProductItemPricesContainer"><div class="gbbProductItemCompareAtPrice"></div><div class="gbbProductItemPrice">€26.90</div></div><div class="gbbProductButtonWrapper"><div class="gbbProductAddButton" style="background: rgb(0, 0, 0); color: rgb(255, 255, 255);">Hinzufügen</div></div></div></div><div class="gbbProductItem" productid="9816077304074" firstvariantid="50325483651338" style="background: rgb(241, 242, 243); color: rgb(37, 37, 37);"><div class="gbbProductImageContainer"><img class="gbbProductImageContainerImg0 gbbProductImageContainerImg gbbFade" src="./Infused energy_files/IE_Infused-Latte_Dubai_Front_1420x1420_60bb1c56-404b-4af6-93a0-763c06c3e273.png" style="display: block;"><a class="gbbPrevImage" style="display: none;">❮</a><a class="gbbNextImage" style="display: none;">❯</a><div class="gbbProductItemOverLay"><div class="gbbOverLayIconContainer"></div></div></div><div class="gbbProductTextContainer"><div class="gbbProductItemTitle" style="cursor: pointer;"><div class="gbbProductTitleOnly">Energy latte - Dubai Edition (limitiert)</div><div class="gbbVariantTitle"></div></div></div><div class="gbbProductActionContainer"><div class="gbbProductItemPricesContainer"><div class="gbbProductItemCompareAtPrice"></div><div class="gbbProductItemPrice">€26.90</div></div><div class="gbbProductButtonWrapper"><div class="gbbProductAddButton" style="background: rgb(0, 0, 0); color: rgb(255, 255, 255);">Hinzufügen</div></div></div></div><div class="gbbProductItem" productid="9604885086474" firstvariantid="49703104741642" data-load-more-indicator-status="active" style="background: rgb(241, 242, 243); color: rgb(37, 37, 37);"><div class="gbbProductImageContainer"><img class="gbbProductImageContainerImg0 gbbProductImageContainerImg gbbFade" src="./Infused energy_files/IE_Infused-Latte_Matcha-Iced-Coffee_Front_1420x1420_f07eb706-ea0a-4363-906f-e876a9285526.png" style="display: block;"><a class="gbbPrevImage" style="display: none;">❮</a><a class="gbbNextImage" style="display: none;">❯</a><div class="gbbProductItemOverLay"><div class="gbbOverLayIconContainer"></div></div></div><div class="gbbProductTextContainer"><div class="gbbProductItemTitle" style="cursor: pointer;"><div class="gbbProductTitleOnly">Energy latte - Matcha x Coffee</div><div class="gbbVariantTitle"></div></div></div><div class="gbbProductActionContainer"><div class="gbbProductItemPricesContainer"><div class="gbbProductItemCompareAtPrice"></div><div class="gbbProductItemPrice">€26.90</div></div><div class="gbbProductButtonWrapper"><div class="gbbProductAddButton" style="background: rgb(0, 0, 0); color: rgb(255, 255, 255);">Hinzufügen</div></div></div></div><div class="gbbProductItem" productid="9872739926282" firstvariantid="50515866878218" style="background: rgb(241, 242, 243); color: rgb(37, 37, 37);"><div class="gbbProductImageContainer"><img class="gbbProductImageContainerImg0 gbbProductImageContainerImg gbbFade" src="./Infused energy_files/IE_Infused-Latte_Golden-Milk_Front_1420x1420_193c122c-a6a4-4961-b37d-3afaf2158872.png" style="display: block;"><div class="gbbProductItemOverLay"><div class="gbbOverLayIconContainer"></div></div></div><div class="gbbProductTextContainer"><div class="gbbProductItemTitle" style="cursor: pointer;"><div class="gbbProductTitleOnly">Golden Milk</div><div class="gbbVariantTitle"></div></div></div><div class="gbbProductActionContainer"><div class="gbbProductItemPricesContainer"><div class="gbbProductItemCompareAtPrice">€23.90</div><div class="gbbProductItemPrice">€14.90</div></div><div class="gbbProductButtonWrapper"><div class="gbbProductAddButton" style="background: rgb(0, 0, 0); color: rgb(255, 255, 255);">Hinzufügen</div></div></div></div></div></div></div></div><div class="gbbAddProductsPageFooterHTML" style="background: rgb(0, 0, 0); color: rgb(255, 255, 255);"><div class="gbbPageFooterHTML"><div class="gbbDiscountFooterHTML"><div class="gbbDiscountMessageContainer"><div class="gbbDiscountMessage" style="color: rgb(255, 255, 255);">Dir fehlen noch 30€ um 25% Rabatt zu erhalten.</div></div></div><div class="gbbProductsFooterHTML" style="background: rgb(0, 0, 0); color: rgb(255, 255, 255); grid-template-columns: 1fr;"><div class="gbbFooterButtonsContainer" style="background: rgb(0, 0, 0);"><div class="gbbFooterButtonsWrapper"><div class="gbbFooterBackButton gbbDisabled" style="background: rgb(0, 0, 0); color: rgb(255, 255, 255);">Zurück</div><div class="gbbFooterTotalContainer"><div class="gbbFooterTotalLabel" style="color: rgb(255, 255, 255);">Gesamt</div><div class="gbbFooterTotalValueContainer" style="color: rgb(255, 255, 255);"><div class="gbbFooterDiscountedTotalValue" style="color: rgb(255, 255, 255);">€0.00</div></div></div><div class="gbbFooterNextButton" style="background: rgb(165, 192, 47); color: rgb(0, 0, 0); grid-column: 3 / 3;">Weiter</div></div></div></div><div class="gbbCartIconWithQuantityContainer" style="background: rgb(165, 192, 47); color: rgb(0, 0, 0);"><div class="gbbCartIconWithQuantityText"><div class="gbbCartQuantity">0</div></div><svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M3 4.50059C3 4.00353 3.40294 3.60059 3.9 3.60059H5.83438C6.88071 3.60059 7.76448 4.37015 7.91285 5.40059H19.5C19.7507 5.40059 19.99 5.50514 20.1604 5.68908C20.3307 5.87302 20.4166 6.11966 20.3974 6.36961L19.9678 11.9537C19.8356 13.673 18.4019 15.0006 16.6775 15.0006H9.05636L9.16772 15.936C9.18568 16.087 9.31365 16.2006 9.46562 16.2006H17.1C17.5971 16.2006 18 16.6035 18 17.1006C18 17.5976 17.5971 18.0006 17.1 18.0006H9.46562C8.40184 18.0006 7.50609 17.2051 7.38034 16.1488L6.13228 5.66512C6.11432 5.51422 5.98635 5.40059 5.83438 5.40059H3.9C3.40294 5.40059 3 4.99764 3 4.50059ZM8.84207 13.2006H16.6775C17.4613 13.2006 18.113 12.5971 18.1731 11.8156L18.5281 7.20059H8.12778L8.84207 13.2006ZM12 20.4006C12 21.0633 11.4627 21.6006 10.8 21.6006C10.1373 21.6006 9.6 21.0633 9.6 20.4006C9.6 19.7378 10.1373 19.2006 10.8 19.2006C11.4627 19.2006 12 19.7378 12 20.4006ZM18 20.4006C18 21.0633 17.4627 21.6006 16.8 21.6006C16.1373 21.6006 15.6 21.0633 15.6 20.4006C15.6 19.7378 16.1373 19.2006 16.8 19.2006C17.4627 19.2006 18 19.7378 18 20.4006Z" fill="#000000"></path>
</svg></div></div></div></div></div></div></div>
    <script>window.tmpCartSettings2 = {"userData":{"_id":"663a6c541ca83246411e8953","shopName":"infused-drinks.myshopify.com","brandName":"Infused energy","bundleSettings":{"allowMultipleBoxesFromSameBundle":true,"showCompareAtPrice":true,"dontIndexGiftboxBuilderPages_onGoogle":false,"isValidateInventoryEnabled":false,"combineWithOrderDiscounts":true,"isDiscountMethodAutomatic":true,"removeUnUsedVariantImages":false,"calculateAutomaticDiscountInPercentage":true},"counters":{"reviewModal":100,"themeExtensionModal":5,"instructionsModalCnt":1,"viewBundleModalCnt":0,"createBundleModalCnt":0},"countryCode":"DE","countryName":"Germany","createdAt":"2024-05-07T18:00:52.310Z","currency":"EUR","currencyInfo":{"code":"EUR","symbol":"€","thousandsSeparator":" ","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"customSettings":{"initialModalPopupCnt":0,"disableCartSettings":false,"addToCartBtnSelectors":"","checkoutBtnSelectors":"","customStyle":null,"addAfterAddTocartBtn":false,"addAftercheckoutBtn":false,"overWriteDummyProductsLinkOnCollectionPages":true,"disableApp":false,"loadingGif":"https://gift-box-builder-app4.s3.us-east-2.amazonaws.com/public/icons/loadingGif.gif","stackDiscounts":true,"showOnlyAdminSelectedVariants":true,"overWriteCheckoutBtn":false,"addGiftMessageToNote":true,"buyNowBtn":"","cartItemQuantityBtnSelectors":"","cartItemRemoveParentSelectors":"","cartItemRemoveSelectors":"","cartItemSelectors":"","checkIfShowBundleAsProductEnabled":false,"customBundleScript":"","customCartIntegrationScript":"","customStyleForBuilderPages":".gbbAddProductsPageFooterHTML, .gbbChooseGiftBoxPageFooterHTML, .gbbPersonalizePageFooterHTML, .gbbPrecuratedBoxPageFooterHTML, .gbbMultipleCategoriesPageFooterHTML {\n  z-index: 9999999999999999999999999999999;\n  margin-bottom: 330px;\n}\n@media only screen and (max-width: 768px) {\n  .gbbAddProductsPageFooterHTML,\n  .gbbChooseGiftBoxPageFooterHTML,\n  .gbbPersonalizePageFooterHTML,\n  .gbbPrecuratedBoxPageFooterHTML,\n  .gbbMultipleCategoriesPageFooterHTML {\n      z-index: 9999999999999999999999999999999;\n      margin-bottom: 25px;\n  }\n}\n.gbbProductImageContainerImg{\n       object-fit: contain !important;\n}\n@media screen and (max-width: 600px){\n.gbbProductsItemsContainer {\ngrid-template-columns: repeat(2,1fr) !important;\n}\n}\n.gbbProductsItemsContainer {\ngrid-template-columns: repeat(5,1fr);\n}\n#shopify-section-footer {\n  margin-top: 122px;\n}\n.gbbCartProductsContainerModal {\n  z-index: 1000000000000000000000000000;\n}\n.gbbCategoryContainer.gbbCategoryContainerTabUI.gbbCategoryContainerTabUIActive {\n  background-color: #A5C02F !important;\n  color: #F6F6F6 !important;\n}\n@media (max-width: 768px) {\n  .gbbFooterButtonsWrapper {\n      display: flex !important;\n      justify-content: center !important;\n  }\n}\n.gbbMutipleCategoriesDropdown {\n  color: white;\n  background-color: #87B138;\n  padding: 10px;\n  border-radius: 4px;\n}\n\n\n@media only screen and (max-width: 768px) {\n  .gbbProductsCardLayoutV2 .gbbCartIconWithQuantityContainer {\n      position: absolute;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      display: flex;\n      padding: 2px 14px;\n      border-radius: 10px;\n      font-size: 14px;\n      align-items: center;\n  }\n}\n\n\n\n.gbbMultipleCategoriesRibbonContainer {\npadding: 21px 15px;\nplace-content: start;\nflex-wrap: wrap;\ngrid-gap: 10px;\noverflow-x: auto;\ntop: 0;\nz-index: 2;\nmargin-bottom: 100px;\n}\n.gbbFooterProductImageContainer{\nbackground: none;\nborder:none;\n}\n.gbbProductsCardLayoutV2 .gbbFooterBackButton, .gbbProductsCardLayoutV2 .gbbFooterNextButton{\nborder-radius: 0px;\n}\n.gbbProductsCardLayoutV2 .gbbProductAddButton {\nborder-radius: 0px;\n}\n.gbbProductsCardLayoutV2 .gbbProductQuantityHTML, .gbbProductVariantModalLayoutV2 .gbbProductQuantityHTML,.gbbProductsCardLayoutV2 .gbbProductQuantityRemoveButton, .gbbProductsCardLayoutV2 .gbbProductQuantityAddButton{\ncolor: #000000 !important;\nbackground: #A5C02F !important;\nborder-radius: 0px;\nfont-weight: bold;\n}\n@media screen and (min-width: 1240px) {\n.gbbMultipleCategoriesRibbonContainer {\n  display: flex;\n}\n}\n.gbbProductsCardLayoutV2 .gbbProductItem {\nbackground: white;\npadding: 8px;\ngrid-gap: inherit;\nborder: 2px solid black;\n}\n.gbbProductImageContainer {\nposition: relative;\ncursor: pointer;\n-webkit-tap-highlight-color: transparent;\ntop: -73px;\n}\n.gbbProductAddButton {\n-webkit-tap-highlight-color: transparent;\npadding: 10px;\nwidth: 100%;\nbackground: #000000;\ncolor: #FFFFFF;\nborder: none;\nfont-size: 14px;\ncursor: pointer;\ntext-align: center;\n}\n.gbbProductAddButton {\n-webkit-tap-highlight-color: transparent;\npadding: 10px;\nwidth: 100%;\nbackground: #000000;\ncolor: #FFFFFF;\ncursor: pointer;\ntext-align: center;\nfont-style: italic;\nline-height: 28.4px;\n}\n.gbbProductsItemsContainer {\ngrid-template-columns: repeat(4, 1fr);\n}\n.gbbProductsCardLayoutV2 .gbbProductItem {\nbackground: white;\npadding: 8px;\ngrid-gap: 5px;\nborder-radius: 0px;\nborder: 2px solid black;\nbackground: white !important;\n}\n.gbbProductsItemsContainer {\ngrid-template-columns: repeat(4, 1fr);\nrow-gap: 100px;\n}\n.gbbProductItem {\ndisplay: grid;\ngrid-template-rows: 151px 105px 49px;\nbackground: #F1F2F3;\n/* padding: 10px; */\nposition: relative;\nbox-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);\ntransition: all 0.3s cubic-bezier(.25, .8, .25, 1);\n}\n.gbbProductsCardLayoutV2 .gbbProductImageContainer {\nborder-radius: 0px;\noverflow: hidden;\nheight: 253px;\n}\n.gbbProductImageContainerImg {\nbackground: transparent;\n}\n@media only screen and (max-width: 768px) {\n.gbbMultipleCategoryBody {\n  margin-top: 100px;\n  /* Adjust the value as needed for mobile */\n}\n}\n@media screen and (max-width: 767px) {\n.gbbProductItem {\n  grid-template-rows: 69px 60px 60px;\n}\n.gbbProductsCardLayoutV2 .gbbProductImageContainer {\n  border-radius: 0px;\n  overflow: hidden;\n  height: 145px;\n}\n}\n.gbbCategoryContainer.gbbCategoryContainerTabUI, .gbbMutipleCategoriesDropdown {\nborder-radius: 0px;\nborder: 2px solid #000000 !important;\n}\n.gbbCategoryHeaderContainerTabUI.gbbCategoryHeaderContainer{\nfont-style: italic !important;\n}\n.gbbProductsCardLayoutV2 .gbbFooterBackButton{\nborder: 2px solid #ffffff !important;\n}\n.gbbProductsCardLayoutV2 .gbbFooterTotalLabel, .gbbFooterTotalValue{\ncolor: #A5C02F !important;\n}\n.gbbAddProductsPageFooterHTML{\nborder-top: none;\n}\n.gbbNavigationStepImgContainer{\nbackground: #E7EBD1;\nborder: 2px solid black !important;\n}\n.gbbNavigationStepImgContainerActive{\nbackground: #A5C02F !important;\nborder: 2px solid black !important;\n}\n.gbbProductItemOverLay {\ndisplay: none !important;\n}\n.gbbProductItemOverLay{\nposition: unset;\nbackground-color: unset;\ntransition: unset;\n}\n.gbbProductVariantModalContentContainer .gbbProductImageContainerImg{\nmax-height: 100%;\n}\n.gbbProductVariantModalBodyContainer .gbbProductImageContainer {\ntop: 0px;\n}\n.gbbProductVariantAddButton, .gbbProductQuantityRemoveButton, .gbbProductQuantityAddButton{\nborder-radius: 0px;\n}\n.gbbProductQuantityRemoveButton, .gbbProductQuantityAddButton{\nbackground: #A5C02F !important;\ncolor: black !important;\n}\n.gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbFooterProductImageContainer{\nborder-radius: 0px;\n}\n.gbbFooterProductRemoveButtonIcon svg{\nfill: #A5C02F;\n}\n.gbbFooterProductTitle{\nfont-weight: bold !important;\nfont-style: italic;\n}\n.gbbFooterProductPrice{\nfont-weight: normal;\n}\n.gbbCartQuantity{\nfont-weight: bold;\n}\n.shopify-section-footer {\n  opacity: 0;\n  visibility: hidden;\n  transition: opacity 1s ease-in, visibility 0s linear 3s;\n}\n.gbbMultipleCategoriesRibbonContainer{\nmargin-bottom: 0px;\n}\n.gbbMultipleCategoriesDropdownContainer{\n    display: none;\n  }\n\n  .gbbMultipleCategoriesRibbonContainer{\n    display: flex;\n  }\n@media screen and (min-width: 1024px) {\n  .gbbMultipleCategoriesActiveCategorySubtitle {\n      margin-bottom: 60px;\n  }\n}\n.gbbFade {\nanimation-name: gbbSlideAbove;\nanimation-duration: 0.4s;\n}\n\n@keyframes gbbSlideAbove {\nfrom {\n  transform: translateY(100%);\n  opacity: 0.4;\n} \nto {\n  transform: translateY(0);\n  opacity: 1;\n}\n}\n.gbbProductsCardLayoutV2 .gbbCartIconWithQuantityContainer{\nborder-radius: 20px;\n}\n.gbbCartQuantity{\nfont-size: large;\n}\n.gbbProductsCardLayoutV2 .gbbCartIconWithQuantityContainer>svg{\nheight: 30px;\n}\n.gbbProductsCardLayoutV2 .showBoxProductsInFooter{\npadding-top: 14px;\n}\n@media screen and (max-width: 767px){\n.gbbProductsCardLayoutV2 .gbbProductImageContainer {\n   height: 185px;\n   padding-bottom: 10px;\n}\n.gbbProductTitleOnly{\nfont-size: 14px !important;\n}\n}\n.gbbProductsCardLayoutV2 .gbbDiscountFooterHTML {\n    padding-top: 15px;\n}\n.gbbDiscountMessage{\ncolor: white !important;\n}\n.gbbAddProductPageSubtext{\npadding-bottom: 40px;\n}\n.gbbProductsCardLayoutV2 .gbbProductQuantityHTML, .gbbProductVariantModalLayoutV2 .gbbProductQuantityHTML, .gbbProductsCardLayoutV2 .gbbProductQuantityRemoveButton, .gbbProductsCardLayoutV2 .gbbProductQuantityAddButton{\nborder-radius: 0px !important;\n}\n.gbbProductQuantityHTML{\nborder-radius: 0px;\n}\n@media (max-width: 600px) {\n    .gbbMobileImageBanner{\npadding-bottom: 30px;\n}\n}\n\n.gbbMultipleCategoriesActiveCategorySubtitle {\n\ntext-align: center;\n\n}","customStyleForDummyProductPage":null,"customThemeIntegrationScript":"","enableCustomThemeIntegrationScript":false,"isCartIntegrationEnabled":false,"loadingBgColor":"#ffffff","preparingBundleGif":"https://d3ks0ngva6go34.cloudfront.net/public/packagingbundle.gif","redirectToCartEnabled":true,"redirectToCheckoutEnabled":false,"redirectToScript":"","redirectUrlForCheckoutBtn":"","selectorToRenderBundlePostionOnCart":"Over","selectorToRenderBundlePostionOnSideCart":"Over","selectorToRenderBundleProduct":"","selectorToRenderBundleProductOnSideCart":"","sideCartCheckoutBtnSelectors":"","integrations":{"judgeme":{"isEnabled":false,"public_token":""}},"enableStoreFrontGQLAPI":false},"isAppFree":false,"isSubscription":{"id":35017851146,"name":"EasyBundle_MonthlyEnterprise_399","price":"299.00","billing_on":"2024-10-24","status":"active","created_at":"2024-09-24T07:56:54+02:00","updated_at":"2024-09-24T08:20:00+02:00","activated_on":"2024-09-24","return_url":"https://infused-drinks.myshopify.com/admin/apps/10b4272bede142b02924feec498b4009","test":false,"cancelled_on":null,"trial_days":0,"trial_ends_on":"2024-09-24","api_client_id":3918921729,"decorated_return_url":"https://infused-drinks.myshopify.com/admin/apps/10b4272bede142b02924feec498b4009?charge_id=35017851146","capped_amount":"550.00","balance_used":"0.0","balance_remaining":"550.00","risk_level":0.0575675,"currency":"USD"},"multipleCurrenciesInfo":{"AED":{"code":"AED","symbol":"د.إ.‏","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"AFN":{"code":"AFN","symbol":"؋","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"ALL":{"code":"ALL","symbol":"Lek","thousandsSeparator":".","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"AMD":{"code":"AMD","symbol":"֏","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"ANG":{"code":"ANG","symbol":"ƒ","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"AUD":{"code":"AUD","symbol":"$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"AWG":{"code":"AWG","symbol":"ƒ","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"AZN":{"code":"AZN","symbol":"₼","thousandsSeparator":" ","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"BAM":{"code":"BAM","symbol":"КМ","thousandsSeparator":".","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"BBD":{"code":"BBD","symbol":"$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"BDT":{"code":"BDT","symbol":"৳","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":0},"BGN":{"code":"BGN","symbol":"лв.","thousandsSeparator":" ","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"BIF":{"code":"BIF","symbol":"FBu","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":false,"decimalDigits":0},"BND":{"code":"BND","symbol":"$","thousandsSeparator":".","decimalSeparator":",","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":0},"BOB":{"code":"BOB","symbol":"Bs","thousandsSeparator":".","decimalSeparator":",","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"BSD":{"code":"BSD","symbol":"$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"BWP":{"code":"BWP","symbol":"P","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"BZD":{"code":"BZD","symbol":"BZ$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"CAD":{"code":"CAD","symbol":"$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"CDF":{"code":"CDF","symbol":"FC","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"CHF":{"code":"CHF","symbol":"CHF","thousandsSeparator":"'","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"CNY":{"code":"CNY","symbol":"¥","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"CRC":{"code":"CRC","symbol":"₡","thousandsSeparator":".","decimalSeparator":",","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"CVE":{"code":"CVE","symbol":"$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"CZK":{"code":"CZK","symbol":"Kč","thousandsSeparator":" ","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"DJF":{"code":"DJF","symbol":"Fdj","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":false,"decimalDigits":0},"DKK":{"code":"DKK","symbol":"kr.","thousandsSeparator":"","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"DOP":{"code":"DOP","symbol":"RD$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"DZD":{"code":"DZD","symbol":"د.ج.‏","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"EGP":{"code":"EGP","symbol":"ج.م.‏","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"ETB":{"code":"ETB","symbol":"ETB","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"EUR":{"code":"EUR","symbol":"€","thousandsSeparator":" ","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"FJD":{"code":"FJD","symbol":"$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"FKP":{"code":"FKP","symbol":"£","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"GBP":{"code":"GBP","symbol":"£","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"GMD":{"code":"GMD","symbol":"D","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"GNF":{"code":"GNF","symbol":"FG","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":false,"decimalDigits":0},"GTQ":{"code":"GTQ","symbol":"Q","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"GYD":{"code":"GYD","symbol":"$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"HKD":{"code":"HKD","symbol":"HK$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"HNL":{"code":"HNL","symbol":"L.","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"HUF":{"code":"HUF","symbol":"Ft","thousandsSeparator":" ","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"IDR":{"code":"IDR","symbol":"Rp","thousandsSeparator":".","decimalSeparator":",","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":0},"ILS":{"code":"ILS","symbol":"₪","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"INR":{"code":"INR","symbol":"₹","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"ISK":{"code":"ISK","symbol":"kr.","thousandsSeparator":".","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":0},"JMD":{"code":"JMD","symbol":"J$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"JPY":{"code":"JPY","symbol":"¥","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":0},"KES":{"code":"KES","symbol":"KSh","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"KGS":{"code":"KGS","symbol":"сом","thousandsSeparator":" ","decimalSeparator":"-","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"KHR":{"code":"KHR","symbol":"៛","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":false,"decimalDigits":0},"KMF":{"code":"KMF","symbol":"CF","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"KRW":{"code":"KRW","symbol":"₩","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":0},"KYD":{"code":"KYD","symbol":"$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"KZT":{"code":"KZT","symbol":"₸","thousandsSeparator":" ","decimalSeparator":"-","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"LAK":{"code":"LAK","symbol":"₭","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":false,"decimalDigits":0},"LBP":{"code":"LBP","symbol":"ل.ل.‏","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"LKR":{"code":"LKR","symbol":"₨","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":0},"MAD":{"code":"MAD","symbol":"د.م.‏","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"MDL":{"code":"MDL","symbol":"lei","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"MKD":{"code":"MKD","symbol":"ден.","thousandsSeparator":".","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"MMK":{"code":"MMK","symbol":"K","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"MNT":{"code":"MNT","symbol":"₮","thousandsSeparator":" ","decimalSeparator":",","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"MOP":{"code":"MOP","symbol":"MOP$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"MUR":{"code":"MUR","symbol":"₨","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"MVR":{"code":"MVR","symbol":"MVR","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":1},"MWK":{"code":"MWK","symbol":"MK","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"MYR":{"code":"MYR","symbol":"RM","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"NGN":{"code":"NGN","symbol":"₦","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"NIO":{"code":"NIO","symbol":"C$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"NPR":{"code":"NPR","symbol":"₨","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"NZD":{"code":"NZD","symbol":"$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"PEN":{"code":"PEN","symbol":"S/.","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"PGK":{"code":"PGK","symbol":"K","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"PHP":{"code":"PHP","symbol":"₱","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"PKR":{"code":"PKR","symbol":"₨","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"PLN":{"code":"PLN","symbol":"zł","thousandsSeparator":" ","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"PYG":{"code":"PYG","symbol":"₲","thousandsSeparator":".","decimalSeparator":",","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"QAR":{"code":"QAR","symbol":"﷼","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"RON":{"code":"RON","symbol":"L","thousandsSeparator":".","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"RSD":{"code":"RSD","symbol":"Дин.","thousandsSeparator":".","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"RWF":{"code":"RWF","symbol":"RWF","thousandsSeparator":" ","decimalSeparator":",","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"SAR":{"code":"SAR","symbol":"﷼","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"SBD":{"code":"SBD","symbol":"$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"SEK":{"code":"SEK","symbol":"kr","thousandsSeparator":".","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"SGD":{"code":"SGD","symbol":"$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"SHP":{"code":"SHP","symbol":"£","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"SLL":{"code":"SLL","symbol":"Le","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"STD":{"code":"STD","symbol":"Db","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"THB":{"code":"THB","symbol":"฿","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"TJS":{"code":"TJS","symbol":"TJS","thousandsSeparator":" ","decimalSeparator":";","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"TOP":{"code":"TOP","symbol":"T$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"TTD":{"code":"TTD","symbol":"TT$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"TWD":{"code":"TWD","symbol":"NT$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"TZS":{"code":"TZS","symbol":"TSh","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"UAH":{"code":"UAH","symbol":"₴","thousandsSeparator":" ","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"UGX":{"code":"UGX","symbol":"USh","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"USD":{"code":"USD","symbol":"$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"UYU":{"code":"UYU","symbol":"$U","thousandsSeparator":".","decimalSeparator":",","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"UZS":{"code":"UZS","symbol":"сўм","thousandsSeparator":" ","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"VND":{"code":"VND","symbol":"₫","thousandsSeparator":".","decimalSeparator":".","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":0},"VUV":{"code":"VUV","symbol":"VT","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":false,"decimalDigits":0},"WST":{"code":"WST","symbol":"WS$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"XAF":{"code":"XAF","symbol":"F","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"XCD":{"code":"XCD","symbol":"$","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"XOF":{"code":"XOF","symbol":"F","thousandsSeparator":" ","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"XPF":{"code":"XPF","symbol":"F","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"YER":{"code":"YER","symbol":"﷼","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2}},"otherInfo":[],"planId":"","shopDomain":"infusedenergy.shop","status":"1","timezone":"","updatedAt":"2025-02-07T08:35:50.653Z","lastVisitTime":"2024-09-03T07:20:18.967Z","loginData":{"lastLoggedInAt":"2025-02-07T06:50:47.439Z"},"isOnBoardingCompleted":true,"onboardingObject":{"selectedDomain":null,"selectedBundleTypeId":null},"videoPage":{"backgroundColor":"#ffffff","logoImg":"https://db07ji0eqime4.cloudfront.net/redeemPage/giftcard/default-no-logo.jpg"},"totalBundleRevenue":8150708.989999848,"totalOrdersCount":23489,"reviewData":{"reviewStatus":"REVIEW_GIVEN","reviewGivenDate":"2024-08-03T23:00:50.482Z","lastShownAt":"2024-09-27T12:21:12.514Z"},"mantleApiToken":"bb2e7887-8a89-45a2-91ae-84f8183f9930","storefrontAccessToken":"44e534a61e7c4f1afb8cef69e6138bcc","isAppLevelMetafieldCreated":true},"languageData":{"_id":"663a6c541ca83246411e897f","shopName":"infused-drinks.myshopify.com","__v":0,"createdAt":"2024-05-07T18:00:52.943Z","en":{"landingPage":{"bannerText":{"id":"bannerText","label":"Banner Text","type":"text","value":"Build your own Bundle in just a few clicks!"},"bannerSubtext":{"id":"bannerSubtext","label":"Banner Subtext","type":"text","value":"Send a custom bundle to your loved one in just a few steps"},"bannerButtonText":{"id":"bannerButtonText","label":"Banner Button Text","type":"text","value":"Start Building your Bundle"},"selectPreCuratedBoxLabel":{"id":"selectPreCuratedBoxLabel","label":"Select Pre-Curated Box Label","type":"text","value":"Or select from a range of pre-curated Gift Boxes"}},"sortBy":{"sortLabel":{"id":"sortLabel","label":"Sort Label","type":"text","value":"Sort"},"alphabeticalAToZ":{"id":"alphabeticalAToZ","label":"Alphabetical, A-Z Label","value":"Alphabetical, A-Z"},"alphabeticalZToA":{"id":"alphabeticalZToA","label":"Alphabetical, Z-A Label","value":"Alphabetical, Z-A"},"priceHighToLow":{"id":"priceHighToLow","label":"Price, High to Low Label","value":"Price, High to Low"},"priceLowToHigh":{"id":"priceLowToHigh","label":"Price, Low to High Label","value":"Price, Low to High"},"featured":{"id":"featured","label":"Featured Label","type":"text","value":"Featured"}},"giftBoxPage":{"selectGiftBoxLabel":{"id":"selectGiftBoxLabel","label":"Select Bundle Label","type":"text","value":"Select a Bundle Box"},"giftBoxPageSubtext":{"id":"giftBoxPageSubtext","label":"Gift Box Page Subtext","type":"text","value":""}},"personalizePage":{"selectGreetingCardLabel":{"id":"selectGreetingCardLabel","label":"Select Greeting Card Label","type":"text","value":"Select A Greeting Card"},"clearSelectionButton":{"id":"clearSelectionButton","label":"Clear Selection label","type":"text","value":"Clear Selection"},"noImagesAvailable":{"id":"noImagesAvailable","label":"No Images Available label","type":"text","value":"No Images Available"},"messageLabel":{"id":"messageLabel","label":"Message Label","type":"text","value":"Message"},"senderNamePlaceholder":{"id":"senderNamePlaceholder","label":"Sender Name Placeholder","type":"text","value":"From"},"recipientNamePlaceholder":{"id":"recipientNamePlaceholder","label":"Recipient Name Placeholder","type":"text","value":"To"},"messagePlaceholder":{"id":"messagePlaceholder","label":"Message Placeholder","type":"text","value":"Enter a message here..."},"emailAddressLabel":{"id":"emailAddressLabel","label":"Recipient Email Address Label","type":"text","value":"Recipient Email Address"},"emailAddressPlaceholder":{"id":"emailAddressPlaceholder","label":"Recipient Email Address Placeholder","type":"text","value":"Enter a recipient email address here..."},"emailValidationMessage":{"id":"emailValidationMessage","label":"Email Validation Message","type":"text","value":"Please enter a valid email address"},"sendNow":{"id":"sendNow","label":"Send Now Label","type":"text","value":"Send Now"},"sendLater":{"id":"sendLater","label":"Send Later Label","type":"text","value":"Send Later"},"personalizePageSubtext":{"id":"personalizePageSubtext","label":"Personalize Page Subtext","type":"text","value":""},"messageIsRequiredError":{"id":"messageIsRequiredError","label":"Message is required warning","type":"text","value":"Please enter a message"}},"reviewPage":{"reviewPageBannerText":{"id":"reviewPageBannerText","label":"Review Page Banner Text","type":"text","value":"You’ve made the  Right Choice!"},"reviewPageBannerSubtext":{"id":"reviewPageBannerSubtext","label":"Review Page Banner Subtext","type":"text","value":"Review your bundle and proceed to checkout"},"addOnsLabel":{"id":"addOnsLabel","label":"Add Ons Label","type":"text","value":"Add Ons"},"totalValueLabel":{"id":"totalValueLabel","label":"Total Value Label","type":"text","value":"Gesamtwert"},"totalLabel":{"id":"totalLabel","label":"Total Label","type":"text","value":"Gesamt"},"productLabel":{"id":"productLabel","label":"Product Header Label","type":"text","value":"Produkt"},"priceLabel":{"id":"priceLabel","label":"Price Header Text","type":"text","value":"Preis"},"quantityLabel":{"id":"quantityLabel","label":"Quantity Header Text","type":"text","value":"Menge"},"deliveryDateLabel":{"id":"deliveryDateLabel","label":"Delivery Date Label","type":"text","value":"Delivery Date"},"productsLabelText":{"id":"productsLabelText","label":"Products Label Text","type":"text","value":"Produkte"},"messagesLabelText":{"id":"messagesLabelText","label":"Messages Label Text","type":"text","value":"Nachrichten"},"discountAppliedLabel":{"id":"discountAppliedLabel","label":"Discount Applied Label","type":"text","value":"Rabatt"},"subtotalLabel":{"id":"subtotalLabel","label":"Sub Total Label","type":"text","value":"Zwischensumme"},"orderDetailsLabel":{"id":"orderDetailsLabel","label":"Order Details Label","type":"text","value":"Bestell Details"},"itemsLabel":{"id":"itemsLabel","label":"No. of Items Label","type":"text","value":"Item(s)"},"oneTimePurchaseLabel":{"id":"oneTimePurchaseLabel","label":"One-Time Purchase label","type":"text","value":"One-Time Purchase"},"subscribeAndSaveLabel":{"id":"subscribeAndSaveLabel","label":"Subscribe and Save label","type":"text","value":"Speichern"},"noSubscriptionFoundLabel":{"id":"noSubscriptionFoundLabel","label":"No Subscription plans found label","type":"text","value":"Oops! No Subscription plans were found"},"deliveryFrequencyLabel":{"id":"deliveryFrequencyLabel","label":"Delivery Frequency Label","type":"text","value":"Delivery Frequency"},"createNewBoxLabel":{"id":"createNewBoxLabel","label":"Create New Box Label","type":"text","value":"Weiteres Set erstellen"},"editButtonText":{"id":"editButtonText","label":"Edit Label","type":"text","value":"Bearbeiten"},"deliverySchedulerPlaceholderText":{"id":"deliverySchedulerPlaceholderText","label":"Delivery Scheduler Placeholder Text","type":"text","value":"Select a date"}},"productPage":{"selectProductsLabel":{"id":"selectProductsLabel","label":"Select Products Label","type":"text","value":"Select Products"},"productPageSubtext":{"id":"productPageSubtext","label":"Product Page Subtext","type":"text","value":""}},"videoMessage":{"permissionDenied":{"id":"permissionDenied","label":"Permission Denied","type":"text","value":"Permission Denied"},"uploadConfirmation":{"id":"uploadConfirmation","label":"Upload Confirmation","type":"text","value":"Your video has been successfully uploaded!"},"pressToRecord":{"id":"pressToRecord","label":"Press to record","type":"text","value":"Press to record"},"recording":{"id":"recording","label":"Recording","type":"text","value":"Recording...."},"errorMessage":{"id":"errorMessage","label":"Error Message","type":"text","value":"An error occured, Please try again!"},"loading":{"id":"loading","label":"Loading","type":"text","value":"Loading...."},"uploading":{"id":"uploading","label":"Uploading","type":"text","value":"Uploading...."},"sendVideoMessageText":{"id":"sendVideoMessageText","label":"Send Video Message Text","type":"text","value":"Send Video Message"},"giftMessageDeliveryInfo":{"id":"giftMessageDeliveryInfo","label":"Message Delivery Info","type":"text","value":"The message will be sent to the recipient via email as soon as the order is placed"},"saveVideoText":{"id":"saveVideoText","label":"Save Video Text","type":"text","value":"Save Video"},"reRecordVideoText":{"id":"reRecordVideoText","label":"Re-Record Video Text","type":"text","value":"Re-Record Video"}},"navigationSteps":{"productPageStepText":{"id":"productPageStepText","label":"Product Page Step Text","type":"text","value":"Add Products"},"giftBoxStepText":{"id":"giftBoxStepText","label":"Bundle Step Text","type":"text","value":"Add Gift Box"},"personalizeStepText":{"id":"personalizeStepText","label":"Personalize Step Text","type":"text","value":"Personalize"},"multipleCategoriesStepText":{"id":"multipleCategoriesStepText","label":"Multiple Categories Step Text","type":"text","value":"Multiple Categories"}},"general":{"noProductsAvailable":{"id":"noProductsAvailable","label":"No Products Available label","type":"text","value":"Keine Produkte verfügbar"},"filtersLabel":{"id":"filtersLabel","label":"Filters Label","type":"text","value":"Filter"},"clearSelection":{"id":"clearSelection","label":"Clear Filters Selection","type":"text","value":"Clear Selection"},"searchLabel":{"id":"searchLabel","label":"Search Label","type":"text","value":"Suche"},"addToBoxButtonText":{"id":"addToBoxButtonText","label":"Add To Box Button","type":"text","value":"Hinzufügen"},"chooseOptionsButtonText":{"id":"chooseOptionsButtonText","label":"Choose Options Button","type":"text","value":"Größe wählen"},"loadMoreProductsButtonText":{"id":"loadMoreProductsButtonText","label":"Load More Products Button","type":"text","value":"Load More Products"},"loadingCheckoutButtonText":{"id":"loadingCheckoutButtonText","label":"Loading Checkout Button","type":"text","value":"Loading Checkout..."},"addedText":{"id":"addedText","label":"Added Label","type":"text","value":"Ausgewählt"},"addButtonText":{"id":"addButtonText","label":"Add Button Text","type":"text","value":"Hinzufügen"},"nextButtonText":{"id":"nextButtonText","label":"Next Button Text","type":"text","value":"Weiter"},"addToCartButtonText":{"id":"addToCartButtonText","label":"Add To Cart Button Text","type":"text","value":"In den Warenkorb"},"backButtonText":{"id":"backButtonText","label":"Back Button Text","type":"text","value":"Zurück"},"checkoutButtonText":{"id":"checkoutButtonText","label":"Checkout Button Text","type":"text","value":"Kasse"},"removeButtonText":{"id":"removeButtonText","label":"Remove Button Text","type":"text","value":"Entfernen"},"reviewButtonText":{"id":"reviewButtonText","label":"Review Button Text","type":"text","value":"überprüfen"},"combinationNotAvailable":{"id":"combinationNotAvailable","label":"Combination Not Available","type":"text","value":"Combination Not Available"},"quantity":{"id":"quantity","label":"Quantity Label","type":"text","value":"Menge"},"viewCartProductsLabel":{"id":"viewCartProductsLabel","label":"View Cart Products Label","type":"text","value":"DEIN MIX"},"selectedProductsLabel":{"id":"selectedProductsLabel","label":"Selected Products Label","type":"text","value":"Ausgewählte Produkte"},"selectBundleProductsText":{"id":"selectBundleProductsText","label":"Select Bundle Products label","type":"text","value":"Select Bundle Products"},"redirectingText":{"id":"redirectingText","label":"Redirecting label","type":"text","value":"Weiterleitung.."},"preparingBundleText":{"id":"preparingBundleText","label":"Preparing Bundle Label","type":"text","value":"Set wird vorbereitet.."},"productsNotAvailableText":{"id":"productsNotAvailableText","label":"Products Not Available Label","type":"text","value":"Oops! Some Products are not available"},"discountsMayNotApplyText":{"id":"discountsMayNotApplyText","label":"Discounts may not be applied Label","type":"text","value":"discounts may not be applied"},"removeAllBoxProducts":{"id":"removeAllBoxProducts","label":"Remove all Box Products Label (Cart Page Popup)","type":"text","value":"This is a Box Product. Removing this will remove all the products from box"},"cartPageCheckoutButtonLoadingText":{"id":"cartPageCheckoutButtonLoadingText","label":"Cart Page Checkout Button Loading Text","type":"text","value":"Loading Checkout..."},"inventoryInStockText":{"id":"inventoryInStockText","label":"Inventory in Stock Label","type":"text","value":"in Stock"},"inventoryLimitReachedText":{"id":"inventoryLimitReachedText","label":"Inventory Limit Reached Label","type":"text","value":"No More Stock"}},"discountRules":{"rule1":{"amount":{"id":"amount","label":"Amount","type":"text","value":""},"text":{"id":"text","label":"Text","type":"text","value":""}},"rule2":{"amount":{"id":"amount","label":"Amount","type":"text","value":""},"text":{"id":"text","label":"Text","type":"text","value":""}},"rule3":{"amount":{"id":"amount","label":"Amount","type":"text","value":""},"text":{"id":"text","label":"Text","type":"text","value":""}},"rule4":{"amount":{"id":"amount","label":"Amount","type":"text","value":""},"text":{"id":"text","label":"Text","type":"text","value":""}},"rule5":{"amount":{"id":"amount","label":"Amount","type":"text","value":""},"text":{"id":"text","label":"Text","type":"text","value":""}}},"conditions":{"amount":{"greaterThanOrEqualTo":{"id":"greaterThanOrEqualTo","label":"Greater than condition message","type":"text","value":"Add products worth at least ##conditionAmount## on this step"},"lessThanOrEqualTo":{"id":"lessThanOrEqualTo","label":"Less than condition message","type":"text","value":"Add products worth maximum of ##conditionAmount## on this step"},"equalTo":{"id":"equalTo","label":"Equal to condition message","type":"text","value":"Add products worth ##conditionAmount## on this step"}},"quantity":{"greaterThanOrEqualTo":{"id":"greaterThanOrEqualTo","label":"Greater than condition message","type":"text","value":"Füge genau ##conditionQuantity## Geschmacksrichtung hinzu."},"lessThanOrEqualTo":{"id":"lessThanOrEqualTo","label":"Less than condition message","type":"text","value":"Es kann in diesem Schritt nur ##conditionQuantity## Geschmack gewählt werden."},"equalTo":{"id":"equalTo","label":"Equal to condition message","type":"text","value":"Füge ##conditionQuantity## Geschmack hinzu."}},"weight":{"greaterThanOrEqualTo":{"id":"greaterThanOrEqualTo","label":"Greater than condition message","type":"text","value":"Add products weighing at least ##conditionWeight## on this step"},"lessThanOrEqualTo":{"id":"lessThanOrEqualTo","label":"Less than condition message","type":"text","value":"Add products weighing maximum of ##conditionWeight## on this step"},"equalTo":{"id":"equalTo","label":"Equal to condition message","type":"text","value":"Add products weighing ##conditionWeight## on this step"}}},"multipleCategoriesPage":{"multipleCategoriesSubtext":{"id":"multipleCategoriesSubtext","label":"Multiple Categories Page Subtext","type":"text","value":""}},"multipleCategories":{},"addons":{"maxAddonProductsAllowed":{"id":"maxAddonProductsAllowed","label":"Max Addon Products Allowed message","type":"text","value":" add maximum ##maxAllowedAddons## products to continue"},"addonProductsMandatory":{"id":"addonProductsMandatory","label":"Addon Products Mandatory message","type":"text","value":"Please add atleast one product"}}},"languageMode":"MULTIPLE","updatedAt":"2024-09-27T15:31:27.726Z","mixAndMatchTextData":{"en":{"general":{"noProductsAvailable":{"id":"noProductsAvailable","label":"No Products Available label","type":"text","value":"No Products Available"},"addBundleToCartBtnText":{"id":"addBundleToCartBtnText","label":"Add Bundle Cart label","type":"text","value":"In den Warenkorb legen"},"addBundleToCartLoadingBtnText":{"id":"addBundleToCartLoadingBtnText","label":"Add Bundle Loading label","type":"text","value":"Adding Bundle..."},"inventoryLimitReachedText":{"id":"inventoryLimitReachedText","label":"Inventory Limit Reached Label","type":"text","value":"No More Stock"},"emptyCardText":{"id":"emptyCardText","label":"Add Product Card Text","type":"text","value":"Hinzufügen"}},"footer":{"footerPrevBtnText":{"id":"footerPrevBtnText","label":"Footer Previous Button","type":"text","value":"Prev"},"footerNextBtnText":{"id":"footerNextBtnText","label":"Footer Next Button","type":"text","value":"Next"},"footerFinishBtnText":{"id":"footerFinishBtnText","label":"Footer Finish Button","type":"text","value":"Done"}},"productCard":{"productCardAddBtnText":{"id":"productCardAddBtnText","label":"Product Add to Cart Button","type":"text","value":"Add to Cart"},"productVariantLabelText":{"id":"productVariantLabelText","label":"Product Variant Label","type":"text","value":"Select variant"}},"conditions":{"amount":{"greaterThanOrEqualTo":{"id":"greaterThanOrEqualTo","label":"Greater than condition message","type":"text","value":"Add products worth at least ##conditionAmount## on this step"},"lessThanOrEqualTo":{"id":"lessThanOrEqualTo","label":"Less than condition message","type":"text","value":"Add products worth maximum of ##conditionAmount## on this step"},"equalTo":{"id":"equalTo","label":"Equal to condition message","type":"text","value":"Add products worth ##conditionAmount## on this step"}},"quantity":{"greaterThanOrEqualTo":{"id":"greaterThanOrEqualTo","label":"Greater than condition message","type":"text","value":"Add at least ##conditionQuantity## products on this step"},"lessThanOrEqualTo":{"id":"lessThanOrEqualTo","label":"Less than condition message","type":"text","value":"Add a maximum of ##conditionQuantity## products to continue"},"equalTo":{"id":"equalTo","label":"Equal to condition message","type":"text","value":"Add exactly ##conditionQuantity## products on this step"}},"weight":{"greaterThanOrEqualTo":{"id":"greaterThanOrEqualTo","label":"Greater than condition message","type":"text","value":"Add products weighing at least ##conditionWeight## on this step"},"lessThanOrEqualTo":{"id":"lessThanOrEqualTo","label":"Less than condition message","type":"text","value":"Add products weighing maximum of ##conditionWeight## on this step"},"equalTo":{"id":"equalTo","label":"Equal to condition message","type":"text","value":"Add products weighing ##conditionWeight## on this step"}}}},"de":{"general":{"noProductsAvailable":{"id":"noProductsAvailable","label":"No Products Available label","type":"text","value":"No Products Available"},"addBundleToCartBtnText":{"id":"addBundleToCartBtnText","label":"Add Bundle Cart label","type":"text","value":"In den Warenkorb legen"},"addBundleToCartLoadingBtnText":{"id":"addBundleToCartLoadingBtnText","label":"Add Bundle Loading label","type":"text","value":"Adding Bundle..."},"inventoryLimitReachedText":{"id":"inventoryLimitReachedText","label":"Inventory Limit Reached Label","type":"text","value":"No More Stock"},"emptyCardText":{"id":"emptyCardText","label":"Add Product Card Text","type":"text","value":"Hinzufügen"}},"footer":{"footerPrevBtnText":{"id":"footerPrevBtnText","label":"Footer Previous Button","type":"text","value":"Zurück"},"footerNextBtnText":{"id":"footerNextBtnText","label":"Footer Next Button","type":"text","value":"Weiter"},"footerFinishBtnText":{"id":"footerFinishBtnText","label":"Footer Finish Button","type":"text","value":"Done"}},"productCard":{"productCardAddBtnText":{"id":"productCardAddBtnText","label":"Product Add to Cart Button","type":"text","value":"Wählen"},"productVariantLabelText":{"id":"productVariantLabelText","label":"Product Variant Label","type":"text","value":"Select variant"}},"conditions":{"amount":{"greaterThanOrEqualTo":{"id":"greaterThanOrEqualTo","label":"Greater than condition message","type":"text","value":"Add products worth at least ##conditionAmount## on this step"},"lessThanOrEqualTo":{"id":"lessThanOrEqualTo","label":"Less than condition message","type":"text","value":"Add products worth maximum of ##conditionAmount## on this step"},"equalTo":{"id":"equalTo","label":"Equal to condition message","type":"text","value":"Add products worth ##conditionAmount## on this step"}},"quantity":{"greaterThanOrEqualTo":{"id":"greaterThanOrEqualTo","label":"Greater than condition message","type":"text","value":"Add at least ##conditionQuantity## products on this step"},"lessThanOrEqualTo":{"id":"lessThanOrEqualTo","label":"Less than condition message","type":"text","value":"Add a maximum of ##conditionQuantity## products to continue"},"equalTo":{"id":"equalTo","label":"Equal to condition message","type":"text","value":"Add exactly ##conditionQuantity## products on this step"}},"weight":{"greaterThanOrEqualTo":{"id":"greaterThanOrEqualTo","label":"Greater than condition message","type":"text","value":"Add products weighing at least ##conditionWeight## on this step"},"lessThanOrEqualTo":{"id":"lessThanOrEqualTo","label":"Less than condition message","type":"text","value":"Add products weighing maximum of ##conditionWeight## on this step"},"equalTo":{"id":"equalTo","label":"Equal to condition message","type":"text","value":"Add products weighing ##conditionWeight## on this step"}}}}}},"pageCustomizationData":{"_id":"663a6c541ca83246411e897e","shopName":"infused-drinks.myshopify.com","__v":0,"banners":{"landingPageImageSrc":"https://d3ks0ngva6go34.cloudfront.net/public/banners/landing_page_bannerv2.png","pageBannerImageSrc":"https://d3ks0ngva6go34.cloudfront.net/public/banners/page_banner_temp.png","productReviewImageSrc":"https://d3ks0ngva6go34.cloudfront.net/public/banners/landing_page_bannerv2.png"},"cartFooter":{"cartFooterBgColor":"#000000","cartFooterButtonsContainerBgColor":"#000000","cartFooterBorderRadius":"0px","cartFooterProductImageBorderRadius":"0px","cartFooterButtonsContainerBorderRadius":"0px","cartFooterShowHidePrices":"Show","cartFooterTextColor":"#ffffff","cartFooterDiscountedPriceColor":"#8D8D8D","cartFooterFinalPriceFontThickness":"Bold","cartFooterFinalPriceFontColor":"#ffffff","cartFooterStrikethroughPriceFontThickness":"Regular","cartFooterBackButtonColor":"#000000","cartFooterBackButtonTextColor":"#ffffff","cartFooterBackButtonBorderColor":"#000000","cartFooterBackButtonBorderThickness":"2px","cartFooterNextButtonTextColor":"#000000","cartFooterNextButtonColor":"#A5C02F","cartFooterNextButtonBorderColor":"#000000","cartFooterNextButtonBorderThickness":"2px","cartFooterButtonsBorderRadius":"0px","cartFooterButtonsPadding":"10px","cartFooterDiscountProgressBarEmptyColor":"#E7EBD1","cartFooterDiscountProgressBarFilledColor":"#A5C02F","cartFooterDiscountTextVisibility":"Show","cartFooterDiscountTextColor":"#ffffff","cartFooterTotalLabelColor":"#ffffff"},"colors":{"disabledColor":"gray","primaryColor":"blue","productBox":"blue","secondaryColor":"aqua","textColor":"black"},"createdAt":"2024-05-07T18:00:52.943Z","landingPage":{"landingPageTextColor":"#000000","landingPageButtonBgColor":"#000000","landingPageButtonTextColor":"#ffffff"},"navigationBanner":{"navigationBannerStepTextColor":"#000000","navigationBannerStepFontSize":"16px","navigationCheckColor":"#ffffff","navigationBannerStepCompletionColor":"#A5C02F","navigationBannerStepCompletedBorderColor":"#000000","navigationBannerStepCompletedBorderWidth":"4px","navigationBannerStepIncompleteBgColor":"#E7EBD1","navigationBannerStepIncompleteBorderColor":"#cccccc","navigationBannerStepIncompleteBorderWidth":"4px","navigationBannerStepProgressBarFilledColor":"#A5C02F","navigationBannerStepProgressBarEmptyColor":"#E7EBD1","tabsActiveBgColor":"#81bc29","tabsActiveTextColor":"#000","tabsInactiveBgColor":"#FFFFFF","tabsInactiveTextColor":"#000","tabsBorderColor":"#000","tabsCornerRadius":"0px","navigationBannerTitleColor":"#ffffff","navigationBannerTextColor":"#ffffff","navigationBannerStepDoneColor":"#000000"},"previewPage":{"bannerTextColor":"#ffffff"},"primaryFont":"","productCard":{"productCardBgColor":"#f1f2f3","cardBorderRadius":"0px","cardImageBorderRadius":"0px","productImageFit":"cover","cardsPerRowXL":4,"cardsPerRowL":4,"productCardTextColor":"#252525","productTitleFontSize":"19px","productTitleFontWeight":"Bold","productPriceVisibility":"Show","compareAtPriceColor":"#8D8D8D","compareAtPriceFontSize":"18px","compareAtPriceFontWeight":"Regular","compareAtPriceVisibility":"Show","finalPriceFontSize":"16px","finalPriceFontColor":"#252525","finalPriceFontWeight":"Bold","productCardButtonColor":"#000000","productCardButtonTextColor":"#ffffff","buttonBorderRadius":"0px","quantitySelectorTextColor":"#000000","allowOnlyOneQuantity":false,"quantitySelectorBgColor":"#000000","productCardQuantitySelectorBgColor":"#A5C02F","quantitySelectorButtonTextColor":"#FFFFFF","quantitySelectorButtonBorderRadius":"6px"},"quickSettings":{"isQuickSettingsEnabled":true,"colors":{"primaryColor":"#000000","buttonBgColor":"#000000","buttonTextColor":"#ffffff"}},"summaryBlock":{"summaryBlockAddToCartButtonColor":"#000000","summaryBlockAddToCartButtonTextColor":"#ffffff","summaryBlockBackButtonColor":"#252525","summaryBlockBackButtonTextColor":"#ffffff","summaryBuildNewBoxTextColor":"#ffffff","summaryBuildNewBoxButtonColor":"#6d7175"},"updatedAt":"2025-01-29T14:11:41.568Z","templateLevelConfig":{"NATURAL_NOOK":{"banners":{"landingPageImageSrc":"https://d3ks0ngva6go34.cloudfront.net/public/banners/landing_page_bannerv2.png","pageBannerImageSrc":"https://d3ks0ngva6go34.cloudfront.net/public/banners/page_banner_temp.png","productReviewImageSrc":"https://d3ks0ngva6go34.cloudfront.net/public/banners/landing_page_bannerv2.png"},"cartFooter":{"cartFooterBgColor":"#f1f2f3","cartFooterTextColor":"#000000","cartFooterNextButtonColor":"#a17E5D","cartFooterNextButtonTextColor":"#ffffff","cartFooterBackButtonColor":"#a17E5D","cartFooterBackButtonTextColor":"#ffffff","cartFooterDiscountTextColor":"#000000"},"colors":{"disabledColor":"gray","primaryColor":"blue","productBox":"blue","secondaryColor":"aqua","textColor":"black"},"landingPage":{"landingPageTextColor":"#000000","landingPageButtonBgColor":"#000000","landingPageButtonTextColor":"#ffffff"},"navigationBanner":{"navigationBannerTitleColor":"#ffffff","navigationBannerTextColor":"#ffffff","navigationBannerStepCompletionColor":"#000000","navigationBannerStepDoneColor":"#ffffff","navigationBannerStepTextColor":"#8A5A44"},"previewPage":{"bannerTextColor":"#ffffff"},"primaryFont":"","productCard":{"productCardBgColor":"#f1f2f3","productCardTextColor":"#252525","productCardButtonColor":"#a17E5D","productCardButtonTextColor":"#ffffff"},"quickSettings":{"isQuickSettingsEnabled":false,"colors":{"primaryColor":"#000000","buttonBgColor":"#000000","buttonTextColor":"#ffffff"}},"summaryBlock":{"summaryBlockAddToCartButtonColor":"#a17E5D","summaryBlockAddToCartButtonTextColor":"#ffffff","summaryBuildNewBoxButtonColor":"#6d7175","summaryBuildNewBoxTextColor":"#ffffff"},"categoryBlock":{"categoryBgColor":"#f5f5f5"},"generalSettings":{"scrollBar":{"scrollBarColor":"#000000"},"conditionToast":{"conditionToastBgColor":"#a17E5D","conditionToastTextColor":"#ffffff"},"icon":{"iconBgColor":"#000000","iconTextColor":"#a17E5D"},"productPage":{"productPageTitleColor":"#8A5A44"},"bundle":{"bundleBgColor":"#F5F5DC"}}},"ELEGANT_ARRAY":{"banners":{"landingPageImageSrc":"https://d3ks0ngva6go34.cloudfront.net/public/banners/landing_page_bannerv2.png","pageBannerImageSrc":"https://d3ks0ngva6go34.cloudfront.net/public/banners/page_banner_temp.png","productReviewImageSrc":"https://d3ks0ngva6go34.cloudfront.net/public/banners/landing_page_bannerv2.png"},"cartFooter":{"cartFooterBgColor":"#f1f2f3","cartFooterTextColor":"#000000","cartFooterNextButtonColor":"#a7b8c2","cartFooterNextButtonTextColor":"#ffffff","cartFooterBackButtonColor":"#6d7175","cartFooterBackButtonTextColor":"#ffffff","cartFooterDiscountTextColor":"#000000"},"colors":{"disabledColor":"gray","primaryColor":"blue","productBox":"blue","secondaryColor":"aqua","textColor":"black"},"landingPage":{"landingPageTextColor":"#000000","landingPageButtonBgColor":"#a7b8c2","landingPageButtonTextColor":"#ffffff"},"navigationBanner":{"navigationBannerTitleColor":"#ffffff","navigationBannerTextColor":"#ffffff","navigationBannerStepCompletionColor":"#000000","navigationBannerStepDoneColor":"#ffffff","navigationBannerStepTextColor":"#000000"},"previewPage":{"bannerTextColor":"#ffffff"},"primaryFont":"","productCard":{"productCardBgColor":"#e0e6f0 ","productCardTextColor":"#3a4a58","productCardButtonColor":"#a7b8c2","productCardButtonTextColor":"#ffffff"},"quickSettings":{"isQuickSettingsEnabled":false,"colors":{"primaryColor":"#000000","buttonBgColor":"#000000","buttonTextColor":"#ffffff"}},"summaryBlock":{"summaryBlockAddToCartButtonColor":"#a7b8c2","summaryBlockAddToCartButtonTextColor":"#ffffff","summaryBuildNewBoxButtonColor":"#6d7175","summaryBuildNewBoxTextColor":"#ffffff"},"categoryBlock":{"categoryBgColor":"#DFF3FF"},"generalSettings":{"scrollBar":{"scrollBarColor":"#000000"},"conditionToast":{"conditionToastBgColor":"#000000","conditionToastTextColor":"#ffffff"},"icon":{"iconBgColor":"#000000","iconTextColor":"#ffffff"},"productPage":{"productPageTitleColor":"#000000"},"bundle":{"bundleBgColor":"#ffffff"}}},"TECHI_TREND":{"banners":{"landingPageImageSrc":"https://d3ks0ngva6go34.cloudfront.net/public/banners/landing_page_bannerv2.png","pageBannerImageSrc":"https://d3ks0ngva6go34.cloudfront.net/public/banners/page_banner_temp.png","productReviewImageSrc":"https://d3ks0ngva6go34.cloudfront.net/public/banners/landing_page_bannerv2.png"},"cartFooter":{"cartFooterBgColor":"#000000","cartFooterTextColor":"#ffffff","cartFooterNextButtonColor":"#0F0","cartFooterNextButtonTextColor":"#000000","cartFooterBackButtonColor":"#0F0","cartFooterBackButtonTextColor":"#000000","cartFooterDiscountTextColor":"#0F0"},"colors":{"disabledColor":"gray","primaryColor":"blue","productBox":"blue","secondaryColor":"aqua","textColor":"black"},"landingPage":{"landingPageTextColor":"#000000","landingPageButtonBgColor":"#000000","landingPageButtonTextColor":"#ffffff"},"navigationBanner":{"navigationBannerTitleColor":"#ffffff","navigationBannerTextColor":"#ffffff","navigationBannerStepCompletionColor":"#0F0","navigationBannerStepDoneColor":"#ffffff","navigationBannerStepTextColor":"#0F0"},"previewPage":{"bannerTextColor":"#ffffff"},"primaryFont":"","productCard":{"productCardBgColor":"#242424","productCardTextColor":"#ffffff","productCardButtonColor":"#0F0","productCardButtonTextColor":"#000000"},"quickSettings":{"isQuickSettingsEnabled":false,"colors":{"primaryColor":"#000000","buttonBgColor":"#000000","buttonTextColor":"#ffffff"}},"summaryBlock":{"summaryBlockAddToCartButtonColor":"#0F0","summaryBlockAddToCartButtonTextColor":"#000000","summaryBuildNewBoxButtonColor":"#000000","summaryBuildNewBoxTextColor":"#ffffff"},"categoryBlock":{"categoryBgColor":"#000000"},"generalSettings":{"scrollBar":{"scrollBarColor":"#000000"},"conditionToast":{"conditionToastBgColor":"#0F0","conditionToastTextColor":"#000000"},"icon":{"iconBgColor":"#0F0","iconTextColor":"#000000"},"productPage":{"productPageTitleColor":"#0F0"},"bundle":{"bundleBgColor":"#000000"}}}},"categoryBlock":{"categoryBgColor":"#f5f5f5","tabActiveBgColor":"#A5C02F","tabActiveTextColor":"#000000","tabInactiveBgColor":"#ffffff","tabInactiveTextColor":"#000000"},"generalSettings":{"bundleBgColor":"#ffffff","scrollBarColor":"#F6F6F6","productPageTitleColor":"#000000","productPageFontSize":"18px","bundleUpSellButtonBg":"#000000","bundleUpSellButtonBorderColor":"#ff0000","bundleUpsellTextColor":"#ffffff","conditionToastBgColor":"#000000","conditionToastTextColor":"#ffffff","iconColor":"#000000","iconBgColor":"#ffffff","iconTextColor":"#1d1d1b","applyNewPageCustomization":true,"scrollBar":{"scrollBarColor":"#A5C02F"},"conditionToast":{"conditionToastBgColor":"#000000","conditionToastTextColor":"#ffffff"},"icon":{"iconBgColor":"#000000","iconTextColor":"#ffffff"},"productPage":{"productPageTitleColor":"#000000"},"bundle":{"bundleBgColor":"#ffffff"}},"mixAndMatchData":{"executeScriptAfterAddToCart":"","redirectToCartEnabled":true,"redirectToCheckoutEnabled":false,"isExecuteCustomScriptAfterAddToCartEnabled":false,"executeDefaultSideCartUpdate":false,"sideCartSectionId":"","sideCartSectionSelector":"","cartPageItemsSelector":"","cartPageItemsSectionId":"","hideOutOfStockProducts":true,"isValidateInventoryEnabled":false,"executeCustomAfterPageLoad":"","customStyle":".gbbMixEmptyStateCardWrapper {\n    grid-template-columns: repeat(2, 1fr);\n}\n.gbbMixProductPageWidgetContainer {\n    padding-bottom: 10px;\n}\n.gbbMixSelectedProductCard {\n    border: 2.4px solid black;\n    border-radius: unset;\n}\n.gbbMixProductsContainer .gbbMixProductsItemsContainer .gbbMixProductItem {\n    grid-template-rows: 3fr;\n}\n.gbbMixSelectedProductCard, .gbbMixProductPageCategorySelectedPrtoductIconWrapper svg path {\n    fill: black !Important;\n}\n.gbbMixProductPageCategoriesWrapperHStacked {\n    grid-template-columns: repeat(2 , 1fr);\n}\n.gbbMixEmptyStateCard {\n    border-radius: 0px;\n}\n.gbbMixBundlePrice{\n    display:none;\n}\n\n.gbbMixDiscountText {\n    display: none !important;\n}","showProductComparedAtPrice":false},"mixAndMatchConfig":{"productCard":{"productCardBgColor":"#FFFFFF","productCardBorderRadius":"0px","productCardImageBorderRadius":"0px","productCardImageFit":"cover","productCardTitleColor":"#1E1E1E","productCardTitleFont":"16px","productCardTitleWeight":"Bold","productCardTitleVisibility":"Show","productCardPriceColor":"#000000","productCardPriceFont":"16px","productCardPriceWeight":"Bold","productCardPriceVisibility":"Show","productCardComparedAtPriceColor":"#ABABAB","productCardComparedAtPriceFont":"12px","productCardComparedAtPriceWeight":"Regular","productCardComparedAtPriceVisibility":"Hide","productCardButtonBgColor":"#a4c02d","productCardButtonTextColor":"#000000","productCardButtonBorderRadius":"0px","productCardQuantityButtonBorderRadius":"5px","productCardQuantityLabelColor":"#000000","productCardQuantityBgColor":"#EEEEEE","productCardQuantityBorderRadius":"6px","productCardVariantSelectorBgColor":"#FFFFFF","productCardVariantSelectorTextColor":"#000000","productCardVariantSelectorBorderRadius":"5px"},"emptyStateCard":{"emptyStateCardBgColor":"#FFFFFF","emptyStateCardBorderColor":"#000","emptyStateCardIconColor":"#000","emptyStateCardTextColor":"#3E3E3E","emptyStateCardBorderStyle":"Dashed"},"drawer":{"drawerBgColor":"#F4F9F9","drawerBorderRadius":"15px 15px 0 0","drawerCloseIconColor":"#303030","drawerScrollBarColor":"#555555","drawerOverlayBgColor":"#1E1E1E80","drawerCloseIconBgColor":"#D4D4D4"},"tabs":{"tabsActiveBgColor":"#1E1E1E","tabsActiveTextColor":"#FFFFFF","tabsInactiveBgColor":"#F4F9F9","tabsInactiveTextColor":"#1E1E1E","tabsBorderRadius":"8px"},"bundleHeader":{"headerConditionTextColor":"#000000","headerConditionTextFont":"24px","headerDiscountTextColor":"#444","headerDiscountTextFont":"16px"},"toast":{"toastBgColor":"#1E1E1EE6","toastTextColor":"#FFF"},"footer":{"footerBgColor":"#1E1E1ECC","footerTotalPriceAndQuantityPillBgColor":"#FFF","footerBorderRadius":"15px","footerTotalPriceAndQuantityPillBorderRadius":"16px","footerPriceSectionVisibility":"Show","footerFinalPriceColor":"#000","footerStrikeThroughPriceColor":"#000","footerBackBtnBgColor":"#FFF","footerBackBtnTextColor":"#000","footerNextBtnBgColor":"#FFF","footerNextBtnTextColor":"#000","footerButtonsBorderRadius":"10px"},"addBundleBtn":{"addBundleBtnBgColor":"#000000","addBundleBtnBorderRadius":"0px","addBundleBtnTextColor":"#FFFFFF"}}},"stepsConfigurationData":{"_id":"66abeff867ad78da1912fe89","bundleId":"5","bundleName":"Energy Latte","shopName":"infused-drinks.myshopify.com","landingPageData":{"isLandingPageEnabled":false,"stepImage":"https://d3ks0ngva6go34.cloudfront.net/public/banners/landing_page_bannerv2.png","isVisibleOnAdminUi":true,"bannerText":"Build your own Bundle in just a few clicks!","bannerButtonText":"Build your Custom Bundle","bannerSubtext":"Send a custom bundle to your loved one in just a few steps"},"personalizationData":{"isVisibleOnAdminUi":true,"isPersonalizationEnabled":false,"personalizeStepText":"Personalize","personalizePageSubtext":"","stepImage":"https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg","giftMessage":{"messageProduct":{"isMessageProductEnabled":true,"status":"active","product":{"id":8556560744714,"title":"Message","admin_graphql_api_id":"gid://shopify/Product/8556560744714","body_html":"custom message for the user","vendor":"Infused energy","product_type":"","created_at":"2024-05-07T18:11:47Z","handle":"message","updated_at":"2025-02-05T09:22:25Z","published_at":"2024-05-07T18:11:47Z","template_suffix":null,"tags":"","status":"active","variants":[{"id":45576057094410,"title":"Message","price":"0.00","position":1,"inventory_policy":"continue","compare_at_price":null,"created_at":"2024-05-07T18:11:47Z","updated_at":"2024-12-07T13:34:36Z","taxable":false,"barcode":null,"sku":"","selected_options":[{"name":"Title","value":"Message"}],"inventory_quantity":0,"admin_graphql_api_id":"gid://shopify/ProductVariant/45576057094410","image_id_old":{"id":"gid://shopify/ProductImage/46868461945098"},"image_id":39631917089034,"media":{"nodes":[{"id":"gid://shopify/MediaImage/39631917089034"}]},"product_id":8556560744714,"option1":"Message","option2":null,"option3":null,"variantImage":"https://d3ks0ngva6go34.cloudfront.net/public/message_default.png"}],"options":[{"id":10897736335626,"name":"Title","position":1,"values":["Message"],"product_id":8556560744714}],"images":[{"id":39631917089034,"alt":"","admin_graphql_api_id":"gid://shopify/MediaImage/39631917089034","product_id":8556560744714,"width":200,"height":200,"src":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/message_default_ff4e6478-d4ed-4feb-8617-ebed9d40cc53.png?v=1715105509","variant_ids":[45576057094410]}],"image":{"id":39631917089034,"admin_graphql_api_id":"gid://shopify/MediaImage/39631917089034","alt":"","product_id":8556560744714,"width":200,"height":200,"src":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/message_default_ff4e6478-d4ed-4feb-8617-ebed9d40cc53.png?v=1715105509","variant_ids":[45576057094410]}}}}},"multipleCategoriesData":{"isMultipleCategoriesEnabled":false,"stepImage":"https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconf3.png"},"summaryPageData":{"isSummaryPageEnabled":false,"isVisibleOnAdminUi":true,"reviewPageBannerText":"You’ve made the  Right Choice!","reviewPageBannerSubtext":"Review your bundle and proceed to checkout"},"createdAt":"2024-08-01T20:28:40.474Z","updatedAt":"2025-02-06T16:32:08.216Z","__v":0,"bundleChecklist":{"publishBundle":false,"reviewDefaultLanguageText":false,"changeBundleColors":false},"bundleChecklistStatus":"IN_PROGRESS","bundleDesignTemplate":"BUILD_FROM_SCRATCH_NEWPRODUCTCARD","bundleStatus":"ACTIVE","productsData1":{"isVisibleOnAdminUi":true,"stepImage":"https://d3ks0ngva6go34.cloudfront.net/giftBox/infused-drinks.myshopify.com/1722574703530.png","products":[{"productId":"9797276565770","graphqlId":"gid://shopify/Product/9797276565770","handle":"energy-latte-cacao","variants":[{"variantId":"50264118821130","variantGraphqlId":"gid://shopify/ProductVariant/50264118821130","inventoryQuantity":680,"inventoryPolicy":"CONTINUE","price":"26.90","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/IE_Infused-Latte_Cacao_Milky-Chocolate_Front_1420x1420_c289b805-bc64-4733-8c95-e41d29dc46b0.png?v=1731316426"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/IE_Infused-Latte_Cacao_Milky-Chocolate_Front_1420x1420_ec028ba4-7c3c-47c2-a6df-6f546550adae.png?v=1731316442"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/Design_ohne_Titel_8.png?v=1731316506"}],"title":"Energy latte - Cacao","tags":["include"],"updated_at":null,"sellingPlanGroups":[]},{"productId":"9816077304074","graphqlId":"gid://shopify/Product/9816077304074","handle":"energy-latte-dubai-edition-limitiert","variants":[{"variantId":"50325483651338","variantGraphqlId":"gid://shopify/ProductVariant/50325483651338","inventoryQuantity":670,"inventoryPolicy":"CONTINUE","price":"26.90","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/IE_Infused-Latte_Dubai_Front_1420x1420_60bb1c56-404b-4af6-93a0-763c06c3e273.png?v=1732284794"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/IE_Infused-Latte_Dubai_Front_1420x1420_d05d05f8-e60d-41c3-b229-feb33592a890.png?v=1732284808"}],"title":"Energy latte - Dubai Edition (limitiert)","tags":["include"],"updated_at":null,"sellingPlanGroups":[]},{"productId":"9604885086474","graphqlId":"gid://shopify/Product/9604885086474","handle":"energy-latte-iced-coffee","variants":[{"variantId":"49703104741642","variantGraphqlId":"gid://shopify/ProductVariant/49703104741642","inventoryQuantity":8954,"inventoryPolicy":"CONTINUE","price":"26.90","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/IE_Infused-Latte_Matcha-Iced-Coffee_Front_1420x1420_f07eb706-ea0a-4363-906f-e876a9285526.png?v=1722512555"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/IE_Infused-Latte_Matcha-Iced-Coffee_Front_1420x1420_0afb2863-5a8c-470a-8197-3ee95d91a668.png?v=1722512571"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/Still_Life_Webshop_preview_3.png?v=1725039074"}],"title":"Energy latte - Matcha x Coffee","tags":["include"],"updated_at":null,"sellingPlanGroups":[]},{"productId":"9872739926282","graphqlId":"gid://shopify/Product/9872739926282","handle":"golden-milk","variants":[{"variantId":"50515866878218","variantGraphqlId":"gid://shopify/ProductVariant/50515866878218","inventoryQuantity":910,"inventoryPolicy":"DENY","price":"19.90","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/IE_Infused-Latte_Golden-Milk_Front_1420x1420_193c122c-a6a4-4961-b37d-3afaf2158872.png?v=1735481566"}],"title":"Golden Milk","tags":["include"],"updated_at":null,"sellingPlanGroups":[]}],"sortBy":{"isSortByEnabled":true,"categories":{"alphabeticalAToZ":{"id":"alphabeticalAToZ","label":"Alphabetical, A-Z","isEnabled":true},"alphabeticalZToA":{"id":"alphabeticalZToA","label":"Alphabetical, Z-A","isEnabled":true},"priceHighToLow":{"id":"priceHighToLow","label":"Price, High to Low","isEnabled":false},"priceLowToHigh":{"id":"priceLowToHigh","label":"Price, Low to High","isEnabled":false}}},"search":{"isSearchEnabled":true},"filterTypes":{"isFiltersEnabled":true,"categories":{},"filterRule":"OR","filterRuleAcrossCategory":"OR"},"productPageStepText":"Sorten","productPageSubtext":"","productPageKey":"productsData1","autoNextStepOnConditionMet":false,"conditions":[],"displayVariantsAsIndividualProducts":false,"filterBySearch":{"isSearchEnabled":false,"searchQuery":{"searchField":"title","searchFieldType":"String"}},"isProductsEnabled":true,"pageBanners":{"mobileBanner":"https://d3ks0ngva6go34.cloudfront.net/giftBox/infused-drinks.myshopify.com/1732479681588.png","desktopBanner":"https://d3ks0ngva6go34.cloudfront.net/giftBox/infused-drinks.myshopify.com/1732479678991.png"},"uniqueProductsData":[{"productId":"9797276565770","graphqlId":"gid://shopify/Product/9797276565770","handle":"energy-latte-cacao","variants":[{"variantId":"50264118821130","variantGraphqlId":"gid://shopify/ProductVariant/50264118821130","inventoryQuantity":680,"inventoryPolicy":"CONTINUE","price":"26.90","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/IE_Infused-Latte_Cacao_Milky-Chocolate_Front_1420x1420_c289b805-bc64-4733-8c95-e41d29dc46b0.png?v=1731316426"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/IE_Infused-Latte_Cacao_Milky-Chocolate_Front_1420x1420_ec028ba4-7c3c-47c2-a6df-6f546550adae.png?v=1731316442"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/Design_ohne_Titel_8.png?v=1731316506"}],"title":"Energy latte - Cacao","tags":["include"],"updated_at":null,"sellingPlanGroups":[]},{"productId":"9816077304074","graphqlId":"gid://shopify/Product/9816077304074","handle":"energy-latte-dubai-edition-limitiert","variants":[{"variantId":"50325483651338","variantGraphqlId":"gid://shopify/ProductVariant/50325483651338","inventoryQuantity":670,"inventoryPolicy":"CONTINUE","price":"26.90","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/IE_Infused-Latte_Dubai_Front_1420x1420_60bb1c56-404b-4af6-93a0-763c06c3e273.png?v=1732284794"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/IE_Infused-Latte_Dubai_Front_1420x1420_d05d05f8-e60d-41c3-b229-feb33592a890.png?v=1732284808"}],"title":"Energy latte - Dubai Edition (limitiert)","tags":["include"],"updated_at":null,"sellingPlanGroups":[]},{"productId":"9604885086474","graphqlId":"gid://shopify/Product/9604885086474","handle":"energy-latte-iced-coffee","variants":[{"variantId":"49703104741642","variantGraphqlId":"gid://shopify/ProductVariant/49703104741642","inventoryQuantity":8954,"inventoryPolicy":"CONTINUE","price":"26.90","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/IE_Infused-Latte_Matcha-Iced-Coffee_Front_1420x1420_f07eb706-ea0a-4363-906f-e876a9285526.png?v=1722512555"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/IE_Infused-Latte_Matcha-Iced-Coffee_Front_1420x1420_0afb2863-5a8c-470a-8197-3ee95d91a668.png?v=1722512571"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/Still_Life_Webshop_preview_3.png?v=1725039074"}],"title":"Energy latte - Matcha x Coffee","tags":["include"],"updated_at":null,"sellingPlanGroups":[]},{"productId":"9872739926282","graphqlId":"gid://shopify/Product/9872739926282","handle":"golden-milk","variants":[{"variantId":"50515866878218","variantGraphqlId":"gid://shopify/ProductVariant/50515866878218","inventoryQuantity":910,"inventoryPolicy":"DENY","price":"19.90","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/IE_Infused-Latte_Golden-Milk_Front_1420x1420_193c122c-a6a4-4961-b37d-3afaf2158872.png?v=1735481566"}],"title":"Golden Milk","tags":["include"],"updated_at":null,"sellingPlanGroups":[]}],"sellingPlanGroupsData":[]},"conditionalLogic":{"isEnabled":false,"rules":[]},"customBundleLevelStyle":"","enableRecurringDiscounts":false,"isOneTimePurchaseEnabled":true,"isOrderSubscriptionsEnabled":false,"defaultProductsData":{"isDefaultProductsEnabled":false,"products":[]},"productsData2":{"isVisibleOnAdminUi":true,"stepImage":"https://d3ks0ngva6go34.cloudfront.net/giftBox/infused-drinks.myshopify.com/1722595532622.png","products":[{"productId":"9606005457162","graphqlId":"gid://shopify/Product/9606005457162","handle":"iced-latte-shaker","variants":[{"variantId":"49703086620938","variantGraphqlId":"gid://shopify/ProductVariant/49703086620938","inventoryQuantity":1000,"price":"8.90","id":"gid://shopify/ProductVariant/49703086620938","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/1_0235a51d-31b2-470f-8dd6-6bf02973b532.png?v=1722572502"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/2_98c06c95-34c7-41c7-924e-57d320d7bab0.png?v=1722572515"}],"title":"Iced Latte Shaker","tags":"","updated_at":"2024-09-16T09:05:57+02:00","id":"gid://shopify/Product/9606005457162"}],"sortBy":{"isSortByEnabled":true,"categories":{"alphabeticalAToZ":{"id":"alphabeticalAToZ","label":"Alphabetical, A-Z","isEnabled":true},"alphabeticalZToA":{"id":"alphabeticalZToA","label":"Alphabetical, Z-A","isEnabled":true},"priceHighToLow":{"id":"priceHighToLow","label":"Price, High to Low","isEnabled":false},"priceLowToHigh":{"id":"priceLowToHigh","label":"Price, Low to High","isEnabled":false}}},"search":{"isSearchEnabled":true},"filterTypes":{"isFiltersEnabled":true,"categories":{},"filterRule":"OR","filterRuleAcrossCategory":"OR"},"productPageStepText":"Zubehör","productPageSubtext":"","productPageKey":"productsData2","autoNextStepOnConditionMet":false,"conditions":[],"displayVariantsAsIndividualProducts":false,"filterBySearch":{"isSearchEnabled":false,"searchQuery":{"searchField":"title","searchFieldType":"String"}},"isProductsEnabled":true,"pageBanners":{"mobileBanner":"https://d3ks0ngva6go34.cloudfront.net/giftBox/infused-drinks.myshopify.com/1722931302175.png","desktopBanner":"https://d3ks0ngva6go34.cloudfront.net/giftBox/infused-drinks.myshopify.com/1722929612894.png"},"uniqueProductsData":[{"productId":"9606005457162","graphqlId":"gid://shopify/Product/9606005457162","handle":"iced-latte-shaker","variants":[{"variantId":"49703086620938","variantGraphqlId":"gid://shopify/ProductVariant/49703086620938","inventoryQuantity":1000,"price":"8.90","id":"gid://shopify/ProductVariant/49703086620938","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/1_0235a51d-31b2-470f-8dd6-6bf02973b532.png?v=1722572502"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0093/9704/3260/files/2_98c06c95-34c7-41c7-924e-57d320d7bab0.png?v=1722572515"}],"title":"Iced Latte Shaker","tags":"","updated_at":"2024-09-16T09:05:57+02:00","id":"gid://shopify/Product/9606005457162"}]},"bundleImg":"https://d3ks0ngva6go34.cloudfront.net/public/icons/link_bundle.png","bundleLink":"https://infused-drinks.myshopify.com/apps/gbb/easybundle/5","bundleUpsellConfig":{"isEnabled":false,"showOnAllBundleProducts":true,"selectedProducts":[],"showOnSpecificProductPages":[],"collectionsSelectedData":[],"showOnSpecificCollectionPages":[],"bundleWidgetText":"Save More With Bundle","bundleWidgetRedirectText":"Redirecting","useLinkProductAsDefaultProduct":false},"productsForBundleLink":[],"selectedProductsForBundleLink":[],"setBundleLink":true,"isProductSlotsEnabled":false,"bundleType":"FULLPAGE_BUNDLE","isStepAdded":true},"discountsData":{"_id":"66ac684167ad78da1962d9bc","bundleId":"5","shopName":"infused-drinks.myshopify.com","__v":0,"createdAt":"2024-08-02T05:01:53.457Z","discountMode":"PERCENTAGE","discountTextBody":{"percentageAndFixed":{"rule1":{"text":"Dir fehlen noch ##discountConditionDiff####discountUnit## um ##discountValue####discountValueUnit## Rabatt zu erhalten."},"rule2":{"text":"Congrats🎉 Add ##discountConditionDiff####discountUnit## more to get ##discountValue####discountValueUnit## discount!"},"rule3":{"text":"Congrats🎉 Add ##discountConditionDiff####discountUnit## more to get ##discountValue####discountValueUnit## discount!"},"rule4":{"text":"Congrats🎉 Add ##discountConditionDiff####discountUnit## more to get ##discountValue####discountValueUnit## discount!"},"rule5":{"text":" Congrats🎉 Add ##discountConditionDiff####discountUnit## more to get ##discountValue####discountValueUnit## discount!"},"rule6":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get ##discountValue####discountValueUnit## discount!"},"rule7":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get ##discountValue####discountValueUnit## discount!"},"rule8":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get ##discountValue####discountValueUnit## discount!"},"rule9":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get ##discountValue####discountValueUnit## discount!"},"rule10":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get ##discountValue####discountValueUnit## discount!"}},"fixedBundlePrice":{"rule1":{"text":"Add ##discountConditionDiff## product(s) to get the bundle at ##discountValueUnit####discountValue##"},"rule2":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule3":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule4":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule5":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule6":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule7":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule8":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule9":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule10":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"}}},"discountTextForSuccess":{"value":"Geschafft 🍃🚀 Du hast dir den höchsten Rabatt freigeschaltet!"},"isDeleted":false,"isDiscountEnabled":true,"isDiscountProgressBarEnabled":false,"isKiteIntegrationEnabled":false,"isShowDiscountsEnabled":true,"rules":[{"discountValue":"25","value":"30","type":"amount","discountCodePrefix":"EasyBundle"}],"type":"amount","updateMultiLanguage":false,"updatedAt":"2025-01-01T10:06:27.157Z","isKiteDiscountMessagingEnabled":false,"kiteDiscountMessaging":{"rules":[],"discountMode":"FIXED","type":"quantity","discountTextBody":{"percentageAndFixed":{"rule1":{"text":"Add ##discountConditionDiff## product(s) to get ##discountValue####discountValueUnit## discount!"},"rule2":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get ##discountValue####discountValueUnit## discount!"},"rule3":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get ##discountValue####discountValueUnit## discount!"},"rule4":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get ##discountValue####discountValueUnit## discount!"},"rule5":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get ##discountValue####discountValueUnit## discount!"},"rule6":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get ##discountValue####discountValueUnit## discount!"},"rule7":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get ##discountValue####discountValueUnit## discount!"},"rule8":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get ##discountValue####discountValueUnit## discount!"},"rule9":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get ##discountValue####discountValueUnit## discount!"},"rule10":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get ##discountValue####discountValueUnit## discount!"}},"fixedBundlePrice":{"rule1":{"text":"Add ##discountConditionDiff## product(s) to get the bundle at ##discountValueUnit####discountValue##"},"rule2":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule3":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule4":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule5":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule6":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule7":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule8":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule9":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule10":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"}}},"discountTextForSuccess":{"value":"Congratulations 🎊 you have gotten the best offer on your bundle!"}}}}</script>
    <script>// comment at the first line of the file dec2024
let DEFAULT_addToCartBtnSelectorsApp4 = 'input[name="add"], button[name="add"], form[action*="/cart/add"] input[type="submit"], form[action*="/cart/add"] button[type="submit"], form[action*="/cart/add"] button:not([type="button"]), form[action*="/cart/add"] .gbb__add-to-cart';
let DEFAULT_checkoutBtnSelectorsApp4 = 'button[name="checkout"], input[name="checkout"], form[action*="/cart"] a[href="/checkout"], a[href="/checkout"], form[action="/cart"] input[type="submit"][name="checkout"], form[action="/cart"] button[type="submit"][name="checkout"]';
let DEFAULT_quantityBtnSelectorsApp4 = '.ajaxcart__qty,quantity-input .quantity,.product-form__input, .product-form__quantity ';
let DEFAULT_sideCartSelectorsApp4 = '.cart-notification,cart-notification,.cart-notification-wrapper,#cart-notification, #CartDrawer, .drawer, .drawer-cover, .Drawer';
let DEFAULT_buyNowBtnApp4 = '.shopify-payment-button__button, .shopify-payment-button__button--unbranded';
let DEFAULT_cartFormApp4 = 'form[action="/cart"], form[action="/cart/"], form[action="cart"]';

let DEFAULT_BUNDLE_IMAGE = "https://gift-box-builder-app4.s3.us-east-2.amazonaws.com/public/default_bundle_image.jpg"

let DEFAULT_scheduleDeliveryPickerSelector = ".gbbSummaryPageDeliverOrderDetailsDiv"
let DEFAULT_EMPTY_REVIEWPAGE_TEXT = "It's Lonely in here 😔"
let DEFAULT_EMPTY_REVIEWPAGE_SUBTEXT = "Tap the button to add products"
let DEFAULT_EMPTY_REVIEWPAGE_BANNER = "https://gift-box-builder-app4.s3.us-east-2.amazonaws.com/public/Empty+Gift.png"
let DEFAULT_EMPTY_REVIEWPAGE_BUTTONTEXT = "Go back to the bundle flow"

// const DEFAULT_BODY_OVERFLOW_VALUE = "";
let DEFAULT_BODY_OVERFLOW_VALUE = "";

let CONSTANT_IMAGES_DROPDOWN_BUTTON = "https://d3ks0ngva6go34.cloudfront.net/public/Keyboard+arrow+up.svg";
let CONSTANT_IMAGES_CALENDAR_ICON = "https://d3ks0ngva6go34.cloudfront.net/public/calendar.svg";
let CONSTATNT_IMAGES_FILTER_ICON = "https://gift-box-builder-app4.s3.us-east-2.amazonaws.com/public/filters_icon.png";


const ADDPRODUCT_PAGES_LIST = ["addProductsPage1", "addProductsPage2", "addProductsPage3", "addProductsPage4", "addProductsPage5", "addProductsPage6", "addProductsPage7", "addProductsPage8", "addProductsPage9", "addProductsPage10", "addProductsPage11", "addProductsPage12"]
let CONSTANT_SVG_CIRCLE = `<svg xmlns="http://www.w3.org/2000/svg"xmlns:xlink="http://www.w3.org/1999/xlink"><circle style="stroke:#006600; fill:white" cx="20" cy="20" r="12"></circle></svg>`
const STEP_SVG = ` <svg width="32" height="36" viewBox="0 0 32 36" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M17.5934 34.5608C16.8036 35.1751 15.6978 35.1751 14.9081 34.5608L1.48121 24.1177C0.519403 23.3697 0.528664 21.9129 1.4999 21.1772C2.16804 20.671 3.09271 20.6762 3.75509 21.1899L16.2507 30.8804L28.7464 21.1899C29.4087 20.6762 30.3334 20.671 31.0015 21.1772C31.9728 21.913 31.982 23.3697 31.0202 24.1177L17.5934 34.5608ZM16.2507 26.2483L1.79469 15.0047C0.668966 14.1292 0.668969 12.4277 1.79469 11.5522L14.9081 1.35288C15.6978 0.738648 16.8037 0.738649 17.5934 1.35289L30.7068 11.5522C31.8325 12.4277 31.8325 14.1292 30.7068 15.0047L16.2507 26.2483ZM16.2507 21.5236L26.9045 13.2785L16.2507 5.03333L5.59691 13.2785L16.2507 21.5236Z" fill="#232323" />
    </svg>`
const CONSTANT_ARROW_SVG = `<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
        width="24px" height="24px" viewBox="0 0 512.000000 512.000000"
        preserveAspectRatio="xMidYMid meet">
       <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
       fill="#000000" stroke="none">
       <path d="M2265 5109 c-592 -71 -1125 -334 -1540 -760 -375 -385 -598 -825
       -696 -1374 -21 -116 -24 -161 -24 -415 0 -254 3 -299 24 -415 101 -569 343
       -1031 742 -1420 385 -375 825 -598 1374 -696 116 -21 161 -24 415 -24 254 0
       299 3 415 24 276 49 483 116 720 231 246 121 448 264 654 465 399 389 641 851
       742 1420 21 116 24 161 24 415 0 254 -3 299 -24 415 -49 276 -116 483 -231
       720 -121 246 -264 448 -465 654 -389 399 -852 641 -1420 742 -97 17 -169 22
       -375 25 -140 1 -291 -2 -335 -7z m651 -1430 c36 -13 86 -62 105 -104 24 -51
       24 -109 0 -160 -11 -26 -158 -184 -415 -449 l-397 -410 109 -110 c515 -525
       687 -705 703 -741 51 -111 -16 -244 -138 -275 -36 -9 -55 -8 -98 5 -52 15 -72
       33 -535 507 -265 270 -490 509 -501 529 -22 45 -25 116 -5 162 13 33 942 999
       990 1031 49 32 120 38 182 15z"/>
       </g>
       </svg>`;

const ARROW_DOWN_SVG = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 128 128" fill="none">
<path fill-rule="evenodd" clip-rule="evenodd" d="M35.006 49.4059C36.8805 47.5314 39.9197 47.5314 41.7942 49.4059L64.0001 71.6118L86.206 49.4059C88.0805 47.5314 91.1197 47.5314 92.9942 49.4059C94.8687 51.2804 94.8687 54.3196 92.9942 56.1941L67.3942 81.7941C65.5197 83.6686 62.4805 83.6686 60.606 81.7941L35.006 56.1941C33.1315 54.3196 33.1315 51.2804 35.006 49.4059Z" fill="#4A4A4A"/>
</svg>`;

const CART_SVG = `<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M3 4.50059C3 4.00353 3.40294 3.60059 3.9 3.60059H5.83438C6.88071 3.60059 7.76448 4.37015 7.91285 5.40059H19.5C19.7507 5.40059 19.99 5.50514 20.1604 5.68908C20.3307 5.87302 20.4166 6.11966 20.3974 6.36961L19.9678 11.9537C19.8356 13.673 18.4019 15.0006 16.6775 15.0006H9.05636L9.16772 15.936C9.18568 16.087 9.31365 16.2006 9.46562 16.2006H17.1C17.5971 16.2006 18 16.6035 18 17.1006C18 17.5976 17.5971 18.0006 17.1 18.0006H9.46562C8.40184 18.0006 7.50609 17.2051 7.38034 16.1488L6.13228 5.66512C6.11432 5.51422 5.98635 5.40059 5.83438 5.40059H3.9C3.40294 5.40059 3 4.99764 3 4.50059ZM8.84207 13.2006H16.6775C17.4613 13.2006 18.113 12.5971 18.1731 11.8156L18.5281 7.20059H8.12778L8.84207 13.2006ZM12 20.4006C12 21.0633 11.4627 21.6006 10.8 21.6006C10.1373 21.6006 9.6 21.0633 9.6 20.4006C9.6 19.7378 10.1373 19.2006 10.8 19.2006C11.4627 19.2006 12 19.7378 12 20.4006ZM18 20.4006C18 21.0633 17.4627 21.6006 16.8 21.6006C16.1373 21.6006 15.6 21.0633 15.6 20.4006C15.6 19.7378 16.1373 19.2006 16.8 19.2006C17.4627 19.2006 18 19.7378 18 20.4006Z" fill="${window.tmpCartSettings2?.pageCustomizationData?.cartFooter?.cartFooterNextButtonTextColor || "#ffffff"}"/>
</svg>`

const CONSTANT_CLOSE_ICON_SVG = `<svg fill="${window.tmpCartSettings2?.pageCustomizationData?.generalSettings?.icon?.iconBgColor || "black"}" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 26 26" width="16px" height="16px"
style="background: ${window.tmpCartSettings2?.pageCustomizationData?.generalSettings?.icon?.iconTextColor || "white"}; border-radius: 50%; "><path d="M 13 0.1875 C 5.925781 0.1875 0.1875 5.925781 0.1875 13 C 0.1875 20.074219 5.925781 25.8125 13 25.8125 C 20.074219 25.8125 25.8125 20.074219 25.8125 13 C 25.8125 5.925781 20.074219 0.1875 13 0.1875 Z M 18.78125 17.394531 L 17.390625 18.78125 C 17.136719 19.035156 16.722656 19.035156 16.46875 18.78125 L 13 15.3125 L 9.53125 18.78125 C 9.277344 19.035156 8.863281 19.035156 8.609375 18.777344 L 7.21875 17.394531 C 6.96875 17.136719 6.96875 16.726563 7.21875 16.46875 L 10.6875 13 L 7.222656 9.535156 C 6.96875 9.277344 6.96875 8.863281 7.222656 8.609375 L 8.609375 7.222656 C 8.863281 6.964844 9.28125 6.964844 9.535156 7.222656 L 13 10.6875 L 16.46875 7.222656 C 16.722656 6.964844 17.140625 6.964844 17.390625 7.222656 L 18.78125 8.605469 C 19.035156 8.863281 19.035156 9.277344 18.78125 9.535156 L 15.3125 13 L 18.78125 16.46875 C 19.03125 16.726563 19.03125 17.136719 18.78125 17.394531 Z"/></svg>`

const SEARCH_ICON_SVG = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M9.5 3C11.2239 3 12.8772 3.68482 14.0962 4.90381C15.3152 6.12279 16 7.77609 16 9.5C16 11.11 15.41 12.59 14.44 13.73L14.71 14H15.5L20.5 19L19 20.5L14 15.5V14.71L13.73 14.44C12.5504 15.4465 11.0506 15.9996 9.5 16C7.77609 16 6.12279 15.3152 4.90381 14.0962C3.68482 12.8772 3 11.2239 3 9.5C3 7.77609 3.68482 6.12279 4.90381 4.90381C6.12279 3.68482 7.77609 3 9.5 3ZM9.5 5C7 5 5 7 5 9.5C5 12 7 14 9.5 14C12 14 14 12 14 9.5C14 7 12 5 9.5 5Z" fill="black"/>`

const PLAIN_CHEVRON_UP_SVG = `<svg width="25" height="25" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M6.23966 11.7996C6.5432 12.0814 7.01775 12.0639 7.2996 11.7603L10 8.85221L12.7004 11.7603C12.9823 12.0639 13.4568 12.0814 13.7603 11.7996C14.0639 11.5177 14.0815 11.0432 13.7996 10.7397L10.5496 7.23966C10.4077 7.08683 10.2086 7 10 7C9.79145 7 9.59232 7.08683 9.45041 7.23966L6.20041 10.7397C5.91856 11.0432 5.93613 11.5177 6.23966 11.7996Z" fill="#4A4A4A"/>
</svg>`

var gbbUtils = {
    f: {}
}
window.gbbUtils = gbbUtils;
//console.log


/*
*fn(param1, param2) =>
*param1 is url of script that we suppose to load
*param2 is function that should be called after script is loaded
*/


gbbUtils.f.loadScript = function (a, b) {
    var c = document.createElement("script");
    c.type = "text/javascript";
    c.src = a;
    document.getElementsByTagName("head")[0].appendChild(c)
    c.onload = function () { b() };
};

/*
* we changed loadScript function - if else block for onload is removed as it was not making sense
*fn(param1) =>
*param1 - represents function that should be executed once jquery is loaded
*https://www.w3schools.com/jquery/jquery_noconflict.asp
*/

gbbUtils.f.loadJquery = function (b) {
    gbb.utility.debugConsole("Load JQuery");
    let flag = false;
    if ("undefined" === typeof jQuery || 3.1 > parseFloat(jQuery.fn.jquery)) {
        flag = true;
    }
    if ("undefined" != typeof jQuery && jQuery.post == undefined) {
        flag = true;
    }

    if (flag) {
        gbbUtils.f.loadScript("https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js", function () {
            gbbJquery = jQuery.noConflict(!0);
            b(gbbJquery)
        })
    } else {
        b(jQuery);
    }
};


var gbb = {
    debug: [],
    version: 1.2,
    state: {
        cachedProductData: new Map(),
        cachedProductDataGraphql: new Map(),
        bundleId: "",
        bundleName: "",
        activeBoxId: "",
        submitted: "",
        product_added: "",
        page_type: "",
        insertWrapperOnPage: [],
        cartData: undefined,
        isOverWriteBuyNowBtnTriggered: false,
        timer: undefined,
        freeGiftcardPopupModalTriggered: false,
        atleastOneProduct: {},
        pageHistory: [],
        greetingCardActiveImageSrc: "",
        navigationItems: [],
        currentPageId: "",
        giftBoxCartData: undefined,
        currentFilteredProducts: [], //products state of filteredProducts
        currentChooseGiftBoxProductsState: [],
        scrollPoisitionAfterPageChange: 70,
        gbbUrl: "gbb",
        addProductsFilters: {
            isFiltersActive: false,
            activatedFilters: [],
            allFilters: [],
            priceFilterActive: false,
            minPriceValue: "",
            maxPriceValue: ""
        },
        addProductsSortBy: {
            isSortByEnabled: false,
            sortByCategories: [],
            sortByValue: ""
        },
        setInfiniteScrollTrackerForProducts: true,
        navItemsViewPerPage: 5,
        // productsPerBatch : 300, //used in prefetch
        currentFlow: "",
        variantCustomProperties: {},
        storeCurrencySymbol: undefined,
        currentModalProductData: {},
        CONSTANT_DEBUG_FLAG: undefined,
        languageMode: "",
        giftMessageProductInActiveSession: [],
    },
    constants: {
        themesIds: {
            DAWN_THEME: 887,
            VENTURE_THEME: 775,
            EXPRESS_THEME: 885,
            CRAVE_THEME: 1363,
            SENSE_THEME: 1356,
            CRAFT_THEME: 1368,
        }
    },
    importExternalScript: async function (scriptName) {
        let scriptUrl = "";
        switch (scriptName) {
            case "date-flatpickr":
                scriptUrl = "https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.js"
                break;
            case "selfHosted-date-flatpickr":
                scriptUrl = "https://d3ks0ngva6go34.cloudfront.net/storefront/S3-flatpickr.min.js";
                break;
        }
        await new Promise(function (resolve, reject) {
            try {
                // document.body.appendChild(document.createElement('script')).src = url;
                const script = document.createElement('script');
                script.src = scriptUrl;
                console.time(`${scriptName}-onLoad`)
                // script.async = true;
                //attach a link tag for css
                // var link = document.createElement('link');
                // link.rel = 'stylesheet';
                // link.href = 'https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css';
                // document.head.appendChild(link);
                //delay the resolve by 1 second
                //resolve after it has been loaded
                script.onload = function () {
                    console.timeEnd(`${scriptName}-onLoad`)
                    gbb.utility.debugConsole(scriptName, "loaded");
                    gbb.utility.debugConsole("FlatPickrObj", flatpickr);
                    resolve();
                }
                document.body.appendChild(script);
            } catch (e) {
                gbb.utility.triggerSlackNotification(e);
                gbb.utility.debugConsole(scriptName, "error in importing", e);
                reject();
            }
        });
    },
    settings: {}, //object from function
    selectors: {},
    cartInterval: "",
    productinterval: "",
    f: {
        bootstrap: function (settings) {
            gbb.utility.debugConsole("bootstap?");
            gbb.f.initThemeCSS();
            gbb.f.globalListener(settings)
        },
        initThemeCSS: function () {
            // gbb.utility.debugConsole("initThemeCSS?", gbb.selectors.addToCart);
            let addToCartBtnEle = gbb.$(document).find(gbb.selectors.addToCart)
            let checkoutBtnEle = gbb.$(document).find(gbb.selectors.checkoutBtn)

            let buttonToOverRide = gbb.$(addToCartBtnEle).length > 0 ? addToCartBtnEle : checkoutBtnEle;

            if (gbb.settings.app.themeFontFamily == "" && gbb.$("body").length > 0) {
                gbb.settings.app.themeFontFamily = gbb.$("body").css("font-family");
                gbb.$(".gbbPageBody").css("font-family", gbb.settings.app.themeFontFamily);
            }

            if (gbb.settings.app.themeFontFamily && gbb.$("body").length > 0) {
                gbb.$(".gbbPageBody").css("font-family", gbb.settings.app.themeFontFamily);
            }
            //find the font color of the theme
            if (gbb.settings.app.themeFontColor == "" && gbb.$("p").length > 0) {
                gbb.settings.app.themeFontColor = gbb.$("p").css("color");
            }
            //theme background color
            if (gbb.settings.app.themeBackgroundColor == "" && gbb.$("body").length > 0) {
                gbb.settings.app.themeBackgroundColor = gbb.$("body").css("background-color");
            }
            if (gbb.settings.app.themeLabelFontColor == "" && gbb.$("label").length > 0) {
                gbb.settings.app.themeLabelFontColor = gbb.$("label").css("color");
            }
            // themeLabelFontFamily
            if (gbb.settings.app.themeLabelFontFamily == "" && gbb.$("label").length > 0) {
                gbb.settings.app.themeLabelFontFamily = gbb.$("label").css("font-family");
            }
            if (gbb.settings.app.themeButtonBackgroundColor == "" && gbb.$(buttonToOverRide).length > 0) {
                gbb.settings.app.themeButtonBackgroundColor = gbb.$(buttonToOverRide).css("background-color");
            }
            if (gbb.settings.app.themButtonTextColor == "" && gbb.$(buttonToOverRide).length > 0) {
                gbb.settings.app.themButtonTextColor = gbb.$(buttonToOverRide).css("color");
            }
            if (gbb.settings.app.themeButtonBorderColor == "" && gbb.$(buttonToOverRide).length > 0) {
                gbb.settings.app.themeButtonBorderColor = gbb.$(buttonToOverRide).css("border-color");
            }
            //box shadow
            if (gbb.settings.app.themeButtonBoxShadow == "" && gbb.$(buttonToOverRide).length > 0) {
                gbb.settings.app.themeButtonBoxShadow = gbb.$(buttonToOverRide).css("box-shadow");
            }
            // button font family
            if (gbb.settings.app.themeButtonFontFamily == "" && gbb.$(buttonToOverRide).length > 0) {
                gbb.settings.app.themeButtonFontFamily = gbb.$(buttonToOverRide).css("font-family");
            }
            if (gbb.settings.app.themeHeaderFontFamily == "" && gbb.$("h1").length > 0) {
                gbb.settings.app.themeHeaderFontFamily = gbb.$("h1").css("font-family");
            }
            if (gbb.settings.app.themeHeaderFontColor == "" && gbb.$("h1").length > 0) {
                gbb.settings.app.themeHeaderFontColor = gbb.$("h1").css("color");
            }

        },

        applyFontToProductPopupCard: function () {
            if (gbb.settings.app.themeFontFamily == "" && gbb.$("body").length > 0) {
                gbb.settings.app.themeFontFamily = gbb.$("body").css("font-family");
                gbb.$(".gbbProductVariantModalContainer").css("font-family", gbb.settings.app.themeFontFamily);
            }
            if (gbb.settings.app.themeFontFamily && gbb.$("body").length > 0) {
                gbb.$(".gbbProductVariantModalContainer").css("font-family", gbb.settings.app.themeFontFamily);
            }
        },
        applyFontToFiltersSidebar: function () {
            if (gbb.settings.app.themeFontFamily == "" && gbb.$("body").length > 0) {
                gbb.settings.app.themeFontFamily = gbb.$("body").css("font-family");
                gbb.$(".gbbProductsFiltersContainer").css("font-family", gbb.settings.app.themeFontFamily);
            }

            if (gbb.settings.app.themeFontFamily && gbb.$("body").length > 0) {
                gbb.$(".gbbProductsFiltersContainer").css("font-family", gbb.settings.app.themeFontFamily);
            }
        },
        applyFontToFooterCartPopup: function () {
            if (gbb.settings.app.themeFontFamily == "" && gbb.$("body").length > 0) {
                gbb.settings.app.themeFontFamily = gbb.$("body").css("font-family");
                gbb.$(".gbbCartProductsContainerModal").css("font-family", gbb.settings.app.themeFontFamily);
            }

            if (gbb.settings.app.themeFontFamily && gbb.$("body").length > 0) {
                gbb.$(".gbbCartProductsContainerModal").css("font-family", gbb.settings.app.themeFontFamily);
            }
        },
        applyFontToPreparingBundlePopup: function () {
            if (gbb.settings.app.themeFontFamily && gbb.$("body").length > 0) {
                gbb.$(".gbbPreparingBundleContainerModal").css("font-family", gbb.settings.app.themeFontFamily);
            }
        },
        applyFontToUnavailableProductsPopup: function () {
            if (gbb.settings.app.themeFontFamily && gbb.$("body").length > 0) {
                gbb.$(".gbbUnavailableProductsContainerModal").css("font-family", gbb.settings.app.themeFontFamily);
            }
        },
        getSettings: async function () {

            try {
                //promise

                //find the / next to apps from the url

                let url = window.location.href;
                let pathname = window.location.pathname;

                // extract the variable after apps in the url
                try {
                    if (url) {
                        let gbbUrl = url?.split("/apps/")[1];

                        //split it by the next /
                        gbbUrl = gbbUrl.split("/")[0];

                        if (pathname) {
                            //last ele of pathname
                            let eleArr = pathname.split("/");
                            if (eleArr.length > 0) {
                                let lastEle = eleArr[eleArr.length - 1];
                                gbb.state.bundleId = lastEle;
                            }
                        }


                        gbb.state.gbbUrl = gbbUrl;
                    }

                } catch (e) {
                    gbb.utility.debugError(e);
                }

                if (!gbb.state.bundleId) {
                    // lets read it from the query params
                    // from the query params, the key is going to be 
                    // easybundle=1;
                    //and gbbId = gbb or gbb-1 or gbb-2
                    let urlParams = new URLSearchParams(window.location.search);

                    let bundleId = urlParams.get('easybundle');
                    let gbbUrl = urlParams.get('gbbId') || "gbb"

                    if (bundleId && gbbUrl) {
                        gbb.state.bundleId = bundleId;
                        gbb.state.gbbUrl = gbbUrl
                    }

                }


                // gbb.utility.debugConsole("GET setting of giftlab pro fired")
                // return new Promise(function (resolve, reject) {
                //     //  fetch("https://gift101.pagekite.me/api/cartSettings/get?shopName=abhishek-devlopment-store.myshopify.com",{
                // 	// fetch("https://gbb104.pagekite.me/api/cartSettings/get?shopName=staging-testing-107.myshopify.com",{
                // 	// fetch("https://zurakite.pagekite.me/api/cartSettings/get?shopName=rafaths-dev-store.myshopify.com",

                //     // fetch(`apps/${gbbUrl}/getGlobalData`,{


                // })
                if (window.tmpCartSettings2) {
                    return window.tmpCartSettings2 //TBD
                } else {
                    gbb.utility.debugConsole("tmpCartSettings2 not found");
                    let promiseData = await new Promise((resolve, reject) => {

                        fetch(`/apps/${gbb.state.gbbUrl}/getGlobalData?bundleId=${gbb.state.bundleId}`, {
                            method: 'GET',
                        })
                            .then(response => response.json())
                            .then(success => {
                                if (success.responseCode === 200) {
                                    gbb.utility.debugConsole("success-data:", success.data);
                                    resolve(success.data);
                                } else {
                                    reject(new Error("Unexpected response code."));
                                }
                            })
                            .catch(error => {
                                gbb.utility.debugError(error);
                                reject(error);
                            });
                    });
                    return promiseData;
                }
            } catch (e) {
                gbb.utility.debugError(e);
            }


        },
        pageCustomizationInit: function (tmpCartSettings) {
            try {
                let pageCustomizationData = {
                    banners: {
                        landingPageImageSrc: tmpCartSettings.pageCustomizationData.banners.landingPageImageSrc || "https://d3ks0ngva6go34.cloudfront.net/public/banners/landing_page_banner.jpg",
                        pageBannerImageSrc: tmpCartSettings.pageCustomizationData.banners.pageBannerImageSrc || "https://d3ks0ngva6go34.cloudfront.net/public/banners/page_banner.png",
                        productReviewImageSrc: tmpCartSettings.pageCustomizationData.banners.productReviewImageSrc || "https://d3ks0ngva6go34.cloudfront.net/public/banners/review-page_banner.jpg",
                    },
                    colors: {
                        "primaryColor": tmpCartSettings.pageCustomizationData.colors.primaryColor,
                        "secondaryColor": tmpCartSettings.pageCustomizationData.colors.secondaryColor,
                        "textColor": tmpCartSettings.pageCustomizationData.colors.textColor,
                        "disabledColor": tmpCartSettings.pageCustomizationData.colors.disabledColor,
                        "productBox": tmpCartSettings.pageCustomizationData.colors.productBox,
                    },
                    primaryFont: tmpCartSettings.pageCustomizationData.primaryFont,
                    landingPage: {
                        landingPageTextColor: tmpCartSettings.pageCustomizationData.landingPage.landingPageTextColor,
                        landingPageButtonBgColor: tmpCartSettings.pageCustomizationData.landingPage.landingPageButtonBgColor,
                        landingPageButtonTextColor: tmpCartSettings.pageCustomizationData.landingPage.landingPageButtonTextColor,
                    },
                    cartFooter: {
                        cartFooterBgColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterBgColor,
                        cartFooterButtonsContainerBgColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterButtonsContainerBgColor,
                        cartFooterBorderRadius: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterBorderRadius,
                        cartFooterProductImageBorderRadius: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterProductImageBorderRadius,
                        cartFooterButtonsContainerBorderRadius: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterButtonsContainerBorderRadius,
                        cartFooterShowHidePrices: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterShowHidePrices == "Hide" ? "hidden" : "visible",
                        cartFooterTextColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterTextColor,
                        cartFooterStrikethroughPriceColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterDiscountedPriceColor,
                        cartFooterFinalPriceFontColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterFinalPriceFontColor,
                        cartFooterFinalPriceFontThickness: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterFinalPriceFontThickness,
                        cartFooterStrikethroughPriceFontThickness: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterStrikethroughPriceFontThickness,
                        cartFooterBackButtonColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterBackButtonColor,
                        cartFooterBackButtonTextColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterBackButtonTextColor,
                        cartFooterBackButtonBorderColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterBackButtonBorderColor,
                        cartFooterBackButtonBorderThickness: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterBackButtonBorderThickness,
                        cartFooterNextButtonTextColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterNextButtonTextColor,
                        cartFooterNextButtonColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterNextButtonColor,
                        cartFooterNextButtonBorderColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterNextButtonBorderColor,
                        cartFooterNextButtonBorderThickness: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterNextButtonBorderThickness,
                        cartFooterButtonsBorderRadius: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterButtonsBorderRadius,
                        cartFooterButtonsPadding: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterButtonsPadding,
                        cartFooterDiscountTextColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterDiscountTextColor,
                        cartFooterDiscountProgressBarEmptyColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterDiscountProgressBarEmptyColor,
                        cartFooterDiscountProgressBarFilledColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterDiscountProgressBarFilledColor,
                        cartFooterButtonsContainerBgColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterButtonsContainerBgColor,
                        cartFooterDiscountTextVisibility: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterDiscountTextVisibility == "Hide" ? "hidden" : "visible",
                        cartFooterTotalLabelColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterTotalLabelColor,
                    },
                    productCard: {
                        productCardBgColor: tmpCartSettings?.pageCustomizationData?.productCard?.productCardBgColor,
                        productCardBorderRadius: tmpCartSettings?.pageCustomizationData?.productCard?.cardBorderRadius,
                        productCardImageBorderRadius: tmpCartSettings?.pageCustomizationData?.productCard?.cardImageBorderRadius,
                        productCardImageFit: tmpCartSettings?.pageCustomizationData?.productCard?.productImageFit,
                        productCardPerRowXtraLargeScreen: tmpCartSettings?.pageCustomizationData?.productCard?.cardsPerRowXL,
                        productCardPerRowLargeScreen: tmpCartSettings?.pageCustomizationData?.productCard?.cardsPerRowL,
                        productCardTextColor: tmpCartSettings?.pageCustomizationData?.productCard?.productCardTextColor,
                        productCardTitleFontSize: tmpCartSettings?.pageCustomizationData?.productCard?.productTitleFontSize,
                        productCardTitleFontWeight: tmpCartSettings?.pageCustomizationData?.productCard?.productTitleFontWeight,
                        productCardFinalPriceVisibility: tmpCartSettings?.pageCustomizationData?.productCard?.productPriceVisibility == "Hide" ? "none" : "block",
                        productCardCompareAtPriceFontColor: tmpCartSettings?.pageCustomizationData?.productCard?.compareAtPriceColor,
                        productCardCompareAtPriceFontSize: tmpCartSettings?.pageCustomizationData?.productCard?.compareAtPriceFontSize,
                        productCardCompareAtPriceFontWeight: tmpCartSettings?.pageCustomizationData?.productCard?.compareAtPriceFontWeight,
                        productCardCompareAtPriceVisibility: tmpCartSettings?.pageCustomizationData?.productCard?.compareAtPriceVisibility == "Hide" ? "none" : "block",
                        productCardFinalPriceFontSize: tmpCartSettings?.pageCustomizationData?.productCard?.finalPriceFontSize,
                        productCardFinalPriceFontColor: tmpCartSettings?.pageCustomizationData?.productCard?.finalPriceFontColor,
                        productCardFinalPriceFontWeight: tmpCartSettings?.pageCustomizationData?.productCard?.finalPriceFontWeight,
                        productCardButtonColor: tmpCartSettings?.pageCustomizationData?.productCard?.productCardButtonColor,
                        productCardButtonTextColor: tmpCartSettings?.pageCustomizationData?.productCard?.productCardButtonTextColor,
                        productCardButtonBorderRadius: tmpCartSettings?.pageCustomizationData?.productCard?.buttonBorderRadius,
                        productCardAllowOnlyOneQuantity: !tmpCartSettings?.pageCustomizationData?.productCard?.allowOnlyOneQuantity ? "block" : "none",
                        productCardQuantitySelectorBgColor: tmpCartSettings?.pageCustomizationData?.productCard?.productCardQuantitySelectorBgColor,// btns wrapper color
                        productCardQuantitySelectorBtnsBgColor: tmpCartSettings?.pageCustomizationData?.productCard?.quantitySelectorBgColor, // btns color
                        productCardQuantitySelectorButtonTextColor: tmpCartSettings?.pageCustomizationData?.productCard?.quantitySelectorButtonTextColor,
                        productCardQuantitySelectorTextColor: tmpCartSettings?.pageCustomizationData?.productCard?.quantitySelectorTextColor,
                        productCardQuantitySelectorBorderRadius: tmpCartSettings?.pageCustomizationData?.productCard?.quantitySelectorButtonBorderRadius,
                    },
                    previewPage: {
                        bannerTextColor: tmpCartSettings?.pageCustomizationData?.productCard?.bannerTextColor,
                    },
                    navigationBanner: {
                        navigationBannerTitleColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerTitleColor,
                        navigationBannerTextColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerTextColor,
                        navigationBannerStepCompletionColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepCompletionColor,
                        navigationBannerStepDoneColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepDoneColor,
                        navigationBannerStepTextColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepTextColor || "",
                        navigationBannerStepProgressBarFilledColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepProgressBarFilledColor,
                        navigationBannerStepProgressBarEmptyColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepProgressBarEmptyColor,
                        navigationBannerStepTextFontSize: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepFontSize,
                        navigationBannerCheckColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationCheckColor,
                        navigationBannerStepCompletedBorderColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepCompletedBorderColor,
                        navigationBannerStepCompletedBorderWidth: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepCompletedBorderWidth,
                        navigationBannerStepIncompleteBgColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepIncompleteBgColor,
                        navigationBannerStepIncompleteBorderColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepIncompleteBorderColor,
                        navigationBannerStepIncompleteBorderWidth: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepIncompleteBorderWidth,
                        navigationBannerTabsActiveBgColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsActiveBgColor,
                        navigationBannerTabsActiveTextColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsActiveTextColor,
                        navigationBannerTabsInactiveBgColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsInactiveBgColor,
                        navigationBannerTabsInactiveTextColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsInactiveTextColor,
                        navigationBannerTabsBorderColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsBorderColor,
                        navigationBannerTabsCornerRadius: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsCornerRadius
                    },
                    summaryBlock: {
                        summaryBlockBgColor: tmpCartSettings.pageCustomizationData.summaryBlock.summaryBlockBgColor,
                        summaryBlockTextColor: tmpCartSettings.pageCustomizationData.summaryBlock.summaryBlockTextColor,
                        summaryBlockAddToCartButtonColor: tmpCartSettings.pageCustomizationData.summaryBlock.summaryBlockAddToCartButtonColor,
                        summaryBlockAddToCartButtonTextColor: tmpCartSettings.pageCustomizationData.summaryBlock.summaryBlockAddToCartButtonTextColor,
                        summaryBlockBackButtonColor: tmpCartSettings.pageCustomizationData.summaryBlock.summaryBlockBackButtonColor,
                        summaryBlockBackButtonTextColor: tmpCartSettings.pageCustomizationData.summaryBlock.summaryBlockBackButtonTextColor,
                    },
                    categoryBlock: {
                        categoryBgColor: tmpCartSettings.pageCustomizationData?.categoryBlock?.categoryBgColor,
                        tabActiveBgColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsActiveBgColor || tmpCartSettings.pageCustomizationData?.categoryBlock?.tabActiveBgColor,
                        tabActiveTextColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsActiveTextColor || tmpCartSettings.pageCustomizationData?.categoryBlock?.tabActiveTextColor,
                        tabInactiveBgColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsInactiveBgColor || tmpCartSettings.pageCustomizationData?.categoryBlock?.tabInactiveBgColor,
                        tabInactiveTextColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsInactiveTextColor || tmpCartSettings.pageCustomizationData?.categoryBlock?.tabInactiveTextColor,
                    },
                    quickSettings: {
                        isQuickSettingsEnabled: true,
                        colors: {
                            primaryColor: tmpCartSettings.pageCustomizationData?.quickSettings?.colors?.primaryColor,
                            buttonBgColor: tmpCartSettings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor,
                            buttonTextColor: tmpCartSettings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor,
                        }
                    },
                    generalSettings: {
                        conditionToast: {
                            conditionToastBgColor: tmpCartSettings.pageCustomizationData?.generalSettings?.conditionToastBgColor || tmpCartSettings.pageCustomizationData?.generalSettings?.conditionToast?.conditionToastBgColor,
                            conditionToastTextColor: tmpCartSettings.pageCustomizationData?.generalSettings?.conditionToastTextColor || tmpCartSettings.pageCustomizationData?.generalSettings?.conditionToast?.conditionToastTextColor,
                        },
                        scrollBar: {
                            scrollBarColor: tmpCartSettings.pageCustomizationData?.generalSettings?.scrollBarColor || tmpCartSettings.pageCustomizationData?.generalSettings?.scrollBar?.scrollBarColor || "black",
                        },
                        icon: {
                            iconTextColor: tmpCartSettings.pageCustomizationData?.generalSettings?.iconTextColor || tmpCartSettings.pageCustomizationData?.generalSettings?.icon?.iconTextColor || false,
                            iconBgColor: tmpCartSettings.pageCustomizationData?.generalSettings?.iconBgColor || tmpCartSettings.pageCustomizationData?.generalSettings?.icon?.iconBgColor || false,
                            iconColor: tmpCartSettings.pageCustomizationData?.generalSettings?.iconColor || tmpCartSettings.pageCustomizationData?.generalSettings?.icon?.iconColor || false
                        },
                        productPage: {
                            productPageTitleColor: tmpCartSettings.pageCustomizationData?.generalSettings?.productPageTitleColor || tmpCartSettings.pageCustomizationData?.generalSettings?.productPage?.productPageTitleColor || ""
                        },
                        bundle: {
                            bundleBgColor: tmpCartSettings.pageCustomizationData?.generalSettings?.bundleBgColor || tmpCartSettings.pageCustomizationData?.generalSettings?.bundle?.bundleBgColor || null,
                            applyNewPageCustomization: tmpCartSettings.pageCustomizationData?.generalSettings?.applyNewPageCustomization || false
                        }

                    },

                }
                return pageCustomizationData
            } catch (error) {
                gbb.utility.debugError("error in pageCustomizationInit", error);
            }
        },
        setSettings: function (tmpCartSettings) {

            tmpCartSettings = gbb.f.modifySettings(tmpCartSettings)

            var cart_settings = {
                pageCustomizationData: gbb.f.pageCustomizationInit(tmpCartSettings),
                giftwrap: {
                    isGiftWrapEnabled: tmpCartSettings.stepsConfigurationData?.personalizationData?.giftwrap?.isGiftWrapEnabled || false,
                    isGiftWrapEnabledOnPage: tmpCartSettings.stepsConfigurationData?.personalizationData?.giftwrap?.isGiftWrapEnabledOnPage || false,
                    productId: tmpCartSettings.stepsConfigurationData.personalizationData?.giftwrap?.giftwrapProduct?.productId || "",
                    productHandle: tmpCartSettings.stepsConfigurationData.personalizationData?.giftwrap?.giftwrapProduct?.handle || "",
                    productVariants: tmpCartSettings.stepsConfigurationData.personalizationData?.giftwrap?.giftwrapProduct?.variants || [],
                    giftWrapShopifyImgUrl: tmpCartSettings.stepsConfigurationData.personalizationData?.giftwrap?.giftwrapProduct?.images[0]?.src,
                },
                greetingCard: {
                    isGreetingCardEnabled: tmpCartSettings.stepsConfigurationData.personalizationData?.greetingCard?.isGreetingCardEnabled || false,
                    greetingCardProducts: tmpCartSettings.stepsConfigurationData.personalizationData?.greetingCard?.products || [],
                    productId: tmpCartSettings.stepsConfigurationData.personalizationData?.greetingCard?.greetingCardProduct?.productId || "",
                    productHandle: tmpCartSettings.stepsConfigurationData.personalizationData?.greetingCard?.greetingCardProduct?.handle || "",
                    productVariants: tmpCartSettings.stepsConfigurationData.personalizationData?.greetingCard?.greetingCardProduct?.variants || {},
                },
                giftMessage: tmpCartSettings.stepsConfigurationData.personalizationData?.giftMessage || {},
                customerUploads: tmpCartSettings.stepsConfigurationData.personalizationData?.customerUploads || {},
                videoMessage: tmpCartSettings.stepsConfigurationData.personalizationData?.giftMessage || {},
                giftAddons: tmpCartSettings.stepsConfigurationData.personalizationData?.giftAddons || {},
                scheduleDelivery: tmpCartSettings.stepsConfigurationData.personalizationData?.scheduleDelivery || {},
                addonProducts:gbb.gbbAddonProducts.f.addonProductsInit(tmpCartSettings),
                // deliveryScheduler: tmpCartSettings.stepsConfigurationData.personalizationData?.deliveryScheduler || {},

                stepsConfigurationData: tmpCartSettings.stepsConfigurationData || {},
                discountsData: tmpCartSettings.discountsData || {},
                //TODO: remove server url from here and also remove http in fetch call
                SERVER_URL: tmpCartSettings?.userData.SERVER_URL || "localhost:3001",
                app: {
                    disableApp: tmpCartSettings.userData.customSettings.disableApp || false,
                    disableSideCart: tmpCartSettings.userData.customSettings.disableSideCart || false,
                    refreshProductPageOnGiftWrap: tmpCartSettings.userData.customSettings.refreshProductPageOnGiftWrap || false,
                    addToCartBtnSelectors: tmpCartSettings.userData.customSettings.addToCartBtnSelectors || DEFAULT_addToCartBtnSelectorsApp4,
                    checkoutBtnSelectors: tmpCartSettings.userData.customSettings.checkoutBtnSelectors || DEFAULT_checkoutBtnSelectorsApp4,
                    quantityBtnSelectors: tmpCartSettings.userData.customSettings.quantityBtnSelectors || DEFAULT_quantityBtnSelectorsApp4,
                    sideCartSelectors: tmpCartSettings.userData.customSettings.sideCartSelectors || DEFAULT_sideCartSelectorsApp4,
                    themeBackgroundColor: tmpCartSettings.userData.customSettings.themeBackgroundColor || "",

                    //themeFontFamily: tmpCartSettings.userData.customSettings.themeFontFamily || "",
                    themeFontFamily: tmpCartSettings.pageCustomizationData.primaryFont || "",
                    themeFontColor: tmpCartSettings.userData.customSettings.themeFontColor || "",

                    themeButtonBackgroundColor: tmpCartSettings.userData.customSettings.themeButtonBackgroundColor || "",
                    themButtonTextColor: tmpCartSettings.userData.customSettings.themButtonTextColor || "",
                    themeButtonBorderColor: tmpCartSettings.userData.customSettings.themeButtonBorderColor || "",
                    themeButtonBoxShadow: tmpCartSettings.userData.customSettings.themeButtonBoxShadow || "",
                    //button font family
                    themeButtonFontFamily: tmpCartSettings.userData.customSettings.themeButtonFontFamily || "",

                    themeHeaderFontFamily: tmpCartSettings.userData.customSettings.themeHeaderFontFamily || "",
                    themeHeaderFontColor: tmpCartSettings.userData.customSettings.themeHeaderFontColor || "",

                    themeLabelFontColor: tmpCartSettings.userData.customSettings.themeLabelFontColor || "",
                    themeLabelFontFamily: tmpCartSettings.userData.customSettings.themeLabelFontFamily || "",

                    buyNowBtn: tmpCartSettings.userData.customSettings.buyNowBtn || DEFAULT_buyNowBtnApp4,
                    cartForm: tmpCartSettings.userData.customSettings.cartForm || DEFAULT_cartFormApp4,
                    addAfterAddTocartBtn: tmpCartSettings.userData.customSettings.addAfterAddTocartBtn || false,
                    addAftercheckoutBtn: tmpCartSettings.userData.customSettings.addAftercheckoutBtn || false,
                    customStyle: tmpCartSettings.userData.customSettings.customStyle || null,

                    scheduleDeliveryPickerSelector: tmpCartSettings.userData.customSettings.scheduleDeliveryPickerSelector || DEFAULT_scheduleDeliveryPickerSelector,

                    redirectUrlForCheckoutBtn: tmpCartSettings.userData?.customSettings?.redirectUrlForCheckoutBtn ? window.location.origin + tmpCartSettings.userData.customSettings.redirectUrlForCheckoutBtn : window.location.origin + "/cart/checkout",
                    redirectToScript: tmpCartSettings.userData?.customSettings?.redirectToScript ? tmpCartSettings.userData.customSettings.redirectToScript : "",
                    redirectToCheckoutEnabled: tmpCartSettings.userData?.customSettings?.redirectToCheckoutEnabled ? tmpCartSettings.userData.customSettings.redirectToCheckoutEnabled : false,
                    redirectToCartEnabled: tmpCartSettings.userData?.customSettings?.redirectToCartEnabled ? tmpCartSettings.userData.customSettings.redirectToCartEnabled : false,

                    loadingBgColor: tmpCartSettings.userData?.customSettings?.loadingBgColor ? tmpCartSettings.userData.customSettings.loadingBgColor : "#ffffff",
                    stackDiscounts: tmpCartSettings.userData?.customSettings?.stackDiscounts ? tmpCartSettings.userData.customSettings.stackDiscounts : false,
                    // isInfiniteScrollEnabled: tmpCartSettings.userData?.customSettings?.isInfiniteScrollEnabled ? tmpCartSettings.userData.customSettings.isInfiniteScrollEnabled : false,
                    isInfiniteScrollEnabled: true,
                    // conditionalLogicFilterOnFirstPageAswell: tmp
                    productHandlesAreTranslated: tmpCartSettings.userData?.customSettings?.productHandlesAreTranslated ? tmpCartSettings.userData.customSettings.productHandlesAreTranslated : false,
                    addGiftMessageToNote: tmpCartSettings.userData?.customSettings?.addGiftMessageToNote ? tmpCartSettings.userData.customSettings.addGiftMessageToNote : false,
                    addBoxQuantityToProperties: tmpCartSettings.userData?.customSettings?.addBoxQuantityToProperties ? tmpCartSettings.userData.customSettings.addBoxQuantityToProperties : false,
                    enableStoreFrontGQLAPI: localStorage?.getItem("enableSF") || tmpCartSettings.userData?.customSettings?.enableStoreFrontGQLAPI || false,
                    dynamicScriptForHTMLContent: tmpCartSettings.userData?.customSettings?.dynamicScriptForHTMLContent || "",
                    integrations: {
                        judgeme: {
                            isEnabled: tmpCartSettings.userData.customSettings?.integrations?.judgeme?.isEnabled || false,
                            public_token: tmpCartSettings.userData.customSettings?.integrations?.judgeme?.public_token || "",
                        }
                    },
                },
                bundleSettings: {
                    ...tmpCartSettings.userData.bundleSettings,
                    metafieldNameSpaceAndKeys: tmpCartSettings.userData.bundleSettings?.metafieldNameSpaceAndKeys || [],
                    conditionalLogicFilterOnFirstPageAswell: tmpCartSettings.userData.bundleSettings?.conditionalLogicFilterOnFirstPageAswell || false,
                    builderPageSeoData: tmpCartSettings.userData.bundleSettings?.builderPageSeoData || [],
                    removeUnUsedVariantImages: tmpCartSettings.userData?.bundleSettings?.removeUnUsedVariantImages ? tmpCartSettings.userData.bundleSettings.removeUnUsedVariantImages : false,
                    isGiftMessageVirtualProduct: tmpCartSettings.userData.bundleSettings?.isGiftMessageVirtualProduct || false,
                    isValidateInventoryEnabled: tmpCartSettings.userData.bundleSettings?.isValidateInventoryEnabled || false,
                    showCategoryNamesInLineItem: tmpCartSettings.userData.bundleSettings?.showCategoryNamesInLineItem || false
                },
                merchantInfo: tmpCartSettings.userData,
                languageData: tmpCartSettings.languageData,
                STOREFRONT_ACCESS_TOKEN: tmpCartSettings.userData.storefrontAccessToken,
                gbbKiteData: tmpCartSettings.gbbKiteData || null
            }



            gbb.settings = cart_settings
            gbb.state.bundleName = gbb.settings.stepsConfigurationData?.bundleName || ""
            // gbb.utility.debugConsole("settings assigned")
            gbb.f.initializeQtyIncrementDecrement()
        },
        initializeQtyIncrementDecrement: function () {
            try {
                const { stepsConfigurationData, bundleSettings } = gbb.settings || {};
                const state = gbb.gbbAddProductsPage.state;

                if (stepsConfigurationData && stepsConfigurationData.incrementProductQtyBy > 0 && stepsConfigurationData.decrementProductQtyBy > 0) {
                    state.incrementProductQtyBy = stepsConfigurationData.incrementProductQtyBy;
                    state.decrementProductQtyBy = stepsConfigurationData.decrementProductQtyBy;
                } else if (bundleSettings && bundleSettings.incrementProductQtyBy > 0 && bundleSettings.decrementProductQtyBy > 0) {
                    state.incrementProductQtyBy = bundleSettings.incrementProductQtyBy;
                    state.decrementProductQtyBy = bundleSettings.decrementProductQtyBy;
                }
            } catch (error) {
                gbb.utility.debugError("error in initializeQtyIncrementDecrement", error);
            }
        },
        prefetchData: async function () {
            // gbb.utility.debugConsole("prefetchData")
            console.time("prefetchData")
            gbb.settings.shopifyData = {};
            //fetch data from shopify which will use handle to fetch data
            const settings = gbb.settings;
            let greetingCardProductPromise, giftWrapProductPromise, giftMessagePromise, productsDataPromise, productsData1Promise, productsData2Promise, productsData3Promise, productsData4Promise, giftAddonsProductsPromise, multipleCategoriesPromise, defaultProductsDataPromise, addonProductsPromise;
            //greetingCard.greetingCardProduct -> isGreetingCardEnabled
            //fetch data from shopify for greeting card product which will be called only if isGreetingCardEnabled is true
            if (gbb.settings.greetingCard.isGreetingCardEnabled) {
                const products = gbb.settings.greetingCard.greetingCardProducts ? gbb.settings.greetingCard.greetingCardProducts : [];
                const listOfHandles = products.map(product => product.handle);
                let listOfProductIds = products.map(product => product.productId);
                let fetchOptions = { listOfProductIds }

                greetingCardProductPromise = gbb.utility.getProductsBulkForRelevantVariants(listOfHandles, products, fetchOptions);
            }

            if (gbb.settings.giftMessage.messageProduct?.isMessageProductEnabled) {
                giftMessagePromise = gbb.utility.getProductDataV2(settings.giftMessage.messageProduct?.product?.handle || settings.giftMessage?.messageProduct?.product?.productHandle)
            }


            // giftwrap.giftwrapProduct -> isGiftWrapEnabled

            if (gbb.settings.giftwrap.isGiftWrapEnabled) {
                giftWrapProductPromise = gbb.utility.getProductDataV2(settings.giftwrap.giftwrapProduct?.handle || settings.giftwrap.productHandle)
            }

            // giftAddons.addOnProducts[] -> isGiftAddonsEnabled




            if (gbb.settings?.giftAddons?.isGiftAddonsEnabled) {
                const products = gbb.settings.giftAddons.addOnProducts;
                const listOfHandles = products.map(product => product.handle);
                let listOfProductIds = products.map(product => product.productId);
                let fetchOptions = { listOfProductIds }

                giftAddonsProductsPromise = gbb.utility.getProductsBulkForRelevantVariants(listOfHandles, products, fetchOptions);
                //giftAddonsProductsPromise = gbb.utility.getProductsBulk(settings.giftAddons.addOnProducts.map(product => product.handle))
            }

            //insert here
            if (gbb.settings?.stepsConfigurationData?.defaultProductsData?.isDefaultProductsEnabled && gbb.settings?.stepsConfigurationData?.defaultProductsData?.products?.length > 0) {
                const products = gbb.settings?.stepsConfigurationData?.defaultProductsData?.products;
                const listOfHandles = products.map(product => product.handle);
                let listOfProductIds = products.map(product => product.productId);
                let fetchOptions = { listOfProductIds }

                defaultProductsDataPromise = gbb.utility.getProductsBulkForRelevantVariants(listOfHandles, products, fetchOptions);
            }

            let fetchsixtyProductsEachStep = []
            let fetchsixtyProductsEachStepByProductId = [];
            if (gbb.settings.stepsConfigurationData?.productsData1?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData1?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData1?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData1?.uniqueProductsData

                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData1?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)
                }
            }

            if (gbb.settings.stepsConfigurationData?.productsData2?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData2?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData2?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData2?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData2?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)

                }
            }
            if (gbb.settings.stepsConfigurationData?.productsData3?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData3?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData3?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData3?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData3?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)
                }
            }
            if (gbb.settings.stepsConfigurationData?.productsData4?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData4?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData4?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData4?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData4?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)
                }
            }
            if (gbb.settings.stepsConfigurationData?.productsData5?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData5?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData5?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData5?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData5?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)

                }
            }
            if (gbb.settings.stepsConfigurationData?.productsData6?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData6?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData6?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData6?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData6?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)

                }
            }
            if (gbb.settings.stepsConfigurationData?.productsData7?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData7?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData7?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData7?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData7?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)

                }
            }
            if (gbb.settings.stepsConfigurationData?.productsData8?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData8?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData8?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData8?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData8?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)

                }
            }
            if (gbb.settings.stepsConfigurationData?.productsData9?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData9?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData9?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData9?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData9?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)

                }
            }

            if (gbb.settings.stepsConfigurationData?.productsData10?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData10?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData10?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData10?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData10?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)

                }
            }

            if (gbb.settings.stepsConfigurationData?.productsData11?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData11?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData11?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData11?.uniqueProductsData

                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData11?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)

                }
            }
            if (gbb.settings.stepsConfigurationData?.productsData12?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData12?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData12?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData12?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData12?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)

                }
            }


            if (gbb.settings.app.enableStoreFrontGQLAPI) {
                // gbb.utility.getcachedProductDataForGraphql(fetchsixtyProductsEachStepByProductId);
            } else {
                gbb.utility.getcachedProductData(fetchsixtyProductsEachStep)
            }


            if (gbb.settings?.stepsConfigurationData?.multipleCategoriesData?.isMultipleCategoriesEnabled && gbb.settings?.stepsConfigurationData?.multipleCategoriesData?.categories) {
                gbb.settings.stepsConfigurationData.multipleCategoriesData.categories = Object.values(gbb.settings?.stepsConfigurationData?.multipleCategoriesData?.categories)

                for (let i = 0; i < gbb.settings?.stepsConfigurationData?.multipleCategoriesData?.categories.length; i++) {
                    const item = gbb.settings?.stepsConfigurationData?.multipleCategoriesData?.categories[i];
                    let products = item.products
                    let tempArr = [];
                    let additionalProducts = [];
                    let resObj = await gbb.utility.getProductsFromCollections(item.collectionsData);
                    if (resObj && resObj.length > 0) {
                        additionalProducts = resObj;
                    }
                    if (additionalProducts && additionalProducts.length > 0) {
                        products.push(...additionalProducts);
                    }
                    products = products.filter((product) => {
                        if (product) {
                            return product;
                        }
                    })
                    let listOfHandles = products.map(product => product.handle)
                    let listOfProductIds = products.map(product => product.productId)
                    let fetchOptions = { listOfProductIds }

                    tempArr.push(gbb.utility.getProductsBulkForRelevantVariants(listOfHandles, products, fetchOptions));

                    let allData = await Promise.all(tempArr)
                    allData = Object.values(allData[0]);

                    gbb.utility.setMapForVariantId(allData);


                    gbb.settings.stepsConfigurationData.multipleCategoriesData.categories[i].dataFromShopify = [
                        ...allData
                    ]
                }
            }

            // addon code changes - Dec '24 
            if (gbb.settings.addonProducts?.isEnabled) {
                let productHandlesArray = []
                let productIdsArray = []
                let products = []
                let tiersToMap = gbb.settings.addonProducts?.tiers || []
                for (let i = 0; i < tiersToMap.length; i++) {
                    let currentTier = tiersToMap[i]
                    let selectedAddonProducts = currentTier.selectedAddonProducts || []
                    selectedAddonProducts.forEach((addonProduct) => {
                        // making this extensive where we are avoiding duplicates
                        if (productHandlesArray.includes(addonProduct.handle)) {
                            //skip -
                            // continue the loop 
                            return
                        }
                        products.push(addonProduct)
                        productHandlesArray.push(addonProduct.handle)
                        productIdsArray.push(addonProduct.productId || addonProduct.id)
                    })
                }
                let fetchOptions = { listOfProductIds: productIdsArray }
                addonProductsPromise = gbb.utility.getProductsBulkForRelevantVariants(productHandlesArray, products, fetchOptions);//remove await 
            }

            let [greetingCardData, giftWrapData, giftMessageData,
                giftAddonsData, multipleCategoriesData, defaultProductsData, addonProductsData]
                =
                await Promise.all([greetingCardProductPromise, giftWrapProductPromise, giftMessagePromise, giftAddonsProductsPromise,
                    multipleCategoriesPromise, defaultProductsDataPromise, addonProductsPromise]);

            //assign data to global variable
            gbb.settings.shopifyData = {
                ...gbb.settings.shopifyData,
                greetingCardData: greetingCardData,
                giftWrapData: giftWrapData,
                giftMessageData: giftMessageData,
                giftAddonsData: giftAddonsData,
                multipleCategoriesData: gbb.settings?.stepsConfigurationData?.multipleCategoriesData,
                defaultProductsData: defaultProductsData,
                addonProductsData: addonProductsData
            }
            if (addonProductsData) {
                gbb.gbbAddonProducts.f.setPrefetchedAddonsData(addonProductsData)
                gbb.gbbAddonProducts.state.productsShopifyData = addonProductsData
                // gbb.utility.setMapForVariantId(addonProductsData);
                gbb.gbbAddonProducts.f.setMapForVariantId_addons(addonProductsData)
            }
            if (greetingCardData) {
                let extraInfo = {
                    shouldVariantTitleBeConvertedToProductTitle: false
                }
                gbb.utility.setMapForVariantId(greetingCardData, extraInfo);
            }

            if (giftWrapData) {
                let giftWrapDataObj = {};
                giftWrapDataObj[giftWrapData.handle] = giftWrapData;
                gbb.utility.setMapForVariantId(giftWrapDataObj);
            }

            if (giftMessageData) {
                //convert the giftMessageData to an object
                //with the key as the handle
                let giftMessageDataObj = {};
                giftMessageDataObj[giftMessageData.handle] = giftMessageData;
                gbb.utility.setMapForVariantId(giftMessageDataObj);
            }

            // if (giftAddonsData) {
            //     gbb.utility.setMapForVariantId(giftAddonsData);
            // }

            if (defaultProductsData) {
                gbb.utility.setMapForVariantId(defaultProductsData);
            }


            console.timeEnd("prefetchData")

        },
        setNavigationItems: function () {
            let navigationItems = [];
            if (gbb.settings?.stepsConfigurationData?.landingPageData?.isLandingPageEnabled) {
                navigationItems.push({
                    "id": "landingPage",
                    "rank": 1,
                    "text": "Landing Page",
                    "isActive": false,
                    "src": "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbLandingPage.init,
                    "isNavBarItem": false
                    // "showFn": glpro.glproGiftWrap.action.show,
                    // "hideFn": glpro.glproGiftWrap.action.hide,
                })
            }
            //only push this in router pages
            if (gbb.settings?.stepsConfigurationData?.productsData1?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage1",
                    "rank": 2,
                    "text": gbb.settings?.stepsConfigurationData?.productsData1?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData1?.stepImage ? gbb.settings?.stepsConfigurationData.productsData1?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage1,
                    "showFn": gbb.gbbAddProductsPage.action.showPage1,
                    "prefetchFn": gbb.gbbAddProductsPage.prefetchDataPage1,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                }
                navigationItems.push(navigationItem)
            }
            if (gbb.settings?.stepsConfigurationData?.productsData2?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage2",
                    "rank": 3,
                    "text": gbb.settings?.stepsConfigurationData?.productsData2?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData2?.stepImage ? gbb.settings?.stepsConfigurationData.productsData2?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage2,
                    "prefetchFn": gbb.gbbAddProductsPage.prefetchDataPage2,
                    "intialFetchFn": gbb.gbbAddProductsPage.intialFetchForPage2,
                    "showFn": gbb.gbbAddProductsPage.action.showPage2,

                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                    // "initFn": glpro.glproGiftWrap.init,
                    // "showFn": glpro.glproGiftWrap.action.show,
                    // "hideFn": glpro.glproGiftWrap.action.hide,
                }
                navigationItems.push(navigationItem)
            }
            // if (gbb.settings?.stepsConfigurationData?.multipleCategoriesData?.isMultipleCategoriesEnabled) {
            //     let navigationItem = {
            //         "id": "multipleCategoriesPage",
            //         "rank": 4,
            //         "text": gbb.settings?.stepsConfigurationData?.multipleCategoriesData?.multipleCategoriesStepText || "",
            //         "isActive": false,
            //         "src": gbb.settings.stepsConfigurationData.multipleCategoriesData?.stepImage ? gbb.settings?.stepsConfigurationData?.multipleCategoriesData?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
            //         "isCompleted": false,
            //         "initFn": gbb.gbbMultipleCategoriesPage.init,
            //         "isNavBarItem": true,
            //         "updatePageStatusFn": gbb.gbbMultipleCategoriesPage.updatePageStatus,
            //         // "initFn": glpro.glproGiftWrap.init,
            //         "showFn": gbb.gbbMultipleCategoriesPage.action.showMultipleCategoriesPage,
            //         // "hideFn": glpro.glproGiftWrap.action.hide,
            //     }
            //     navigationItems.push(navigationItem)
            // }
            if (gbb.settings?.stepsConfigurationData?.productsData3?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage3",
                    "rank": 5,
                    "text": gbb.settings?.stepsConfigurationData?.productsData3?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData3?.stepImage ? gbb.settings?.stepsConfigurationData.productsData3?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage3,
                    "prefetchFn": gbb.gbbAddProductsPage.prefetchDataPage3,
                    "intialFetchFn": gbb.gbbAddProductsPage.intialFetchForPage3,
                    "showFn": gbb.gbbAddProductsPage.action.showPage3,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                    // "initFn": glpro.glproGiftWrap.init,
                    // "showFn": glpro.glproGiftWrap.action.show,
                    // "hideFn": glpro.glproGiftWrap.action.hide,
                }
                navigationItems.push(navigationItem)
            }
            if (gbb.settings?.stepsConfigurationData?.productsData4?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage4",
                    "rank": 6,
                    "text": gbb.settings?.stepsConfigurationData?.productsData4?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData4?.stepImage ? gbb.settings?.stepsConfigurationData.productsData4?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage4,
                    "showFn": gbb.gbbAddProductsPage.action.showPage4,
                    "prefetchFn": gbb.gbbAddProductsPage.prefetchDataPage4,
                    "intialFetchFn": gbb.gbbAddProductsPage.intialFetchForPage4,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                    // "initFn": glpro.glproGiftWrap.init,
                    // "showFn": glpro.glproGiftWrap.action.show,
                    // "hideFn": glpro.glproGiftWrap.action.hide,
                }
                navigationItems.push(navigationItem)
            }

            if (gbb.settings?.stepsConfigurationData?.productsData5?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage5",
                    "rank": 7,
                    "text": gbb.settings?.stepsConfigurationData?.productsData5?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData5?.stepImage ? gbb.settings?.stepsConfigurationData.productsData5?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage5,
                    "showFn": gbb.gbbAddProductsPage.action.showPage5,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                }
                navigationItems.push(navigationItem)
            }

            if (gbb.settings?.stepsConfigurationData?.productsData6?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage6",
                    "rank": 8,
                    "text": gbb.settings?.stepsConfigurationData?.productsData6?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData6?.stepImage ? gbb.settings?.stepsConfigurationData.productsData6?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage6,
                    "showFn": gbb.gbbAddProductsPage.action.showPage6,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                }
                navigationItems.push(navigationItem)
            }

            if (gbb.settings?.stepsConfigurationData?.productsData7?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage7",
                    "rank": 9,
                    "text": gbb.settings?.stepsConfigurationData?.productsData7?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData7?.stepImage ? gbb.settings?.stepsConfigurationData.productsData7?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage7,
                    "showFn": gbb.gbbAddProductsPage.action.showPage7,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                }
                navigationItems.push(navigationItem)
            }

            if (gbb.settings?.stepsConfigurationData?.productsData8?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage8",
                    "rank": 10,
                    "text": gbb.settings?.stepsConfigurationData?.productsData8?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData8?.stepImage ? gbb.settings?.stepsConfigurationData.productsData8?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage8,
                    "showFn": gbb.gbbAddProductsPage.action.showPage8,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                }
                navigationItems.push(navigationItem)
            }

            if (gbb.settings?.stepsConfigurationData?.productsData9?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage9",
                    "rank": 11,
                    "text": gbb.settings?.stepsConfigurationData?.productsData9?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData9?.stepImage ? gbb.settings?.stepsConfigurationData.productsData9?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage9,
                    "showFn": gbb.gbbAddProductsPage.action.showPage9,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                }
                navigationItems.push(navigationItem)
            }

            if (gbb.settings?.stepsConfigurationData?.productsData10?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage10",
                    "rank": 12,
                    "text": gbb.settings?.stepsConfigurationData?.productsData10?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData10?.stepImage ? gbb.settings?.stepsConfigurationData.productsData10?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage10,
                    "showFn": gbb.gbbAddProductsPage.action.showPage10,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                }
                navigationItems.push(navigationItem)
            }

            if (gbb.settings?.stepsConfigurationData?.productsData11?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage11",
                    "rank": 13,
                    "text": gbb.settings?.stepsConfigurationData?.productsData11?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData11?.stepImage ? gbb.settings?.stepsConfigurationData.productsData11?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage11,
                    "showFn": gbb.gbbAddProductsPage.action.showPage11,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                }
                navigationItems.push(navigationItem)
            }
            if (gbb.settings?.stepsConfigurationData?.productsData12?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage12",
                    "rank": 14,
                    "text": gbb.settings?.stepsConfigurationData?.productsData12?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData12?.stepImage ? gbb.settings?.stepsConfigurationData.productsData12?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage12,
                    "showFn": gbb.gbbAddProductsPage.action.showPage12,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                }
                navigationItems.push(navigationItem)
            }

            if (gbb.settings?.stepsConfigurationData?.personalizationData?.isPersonalizationEnabled) {
                let navigationItem = {
                    "id": "personalizationPage",
                    "rank": 7,
                    "text": gbb.settings?.stepsConfigurationData?.personalizationData?.personalizeStepText,
                    "isActive": false,
                    "src": gbb.settings.stepsConfigurationData.personalizationData?.stepImage ? gbb.settings?.stepsConfigurationData?.personalizationData?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbPersonalizePage.init,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbPersonalizePage.updatePageStatus,
                    // "initFn": glpro.glproGiftWrap.init,
                    "showFn": gbb.gbbPersonalizePage.action.showPersonalizationPage,
                    // "hideFn": glpro.glproGiftWrap.action.hide,
                }
                navigationItems.push(navigationItem)
            }
            if (gbb.settings?.stepsConfigurationData?.summaryPageData?.isSummaryPageEnabled) {
                navigationItems.push({
                    "id": "reviewPage",
                    "rank": 8,
                    "text": "Review Page",
                    "isActive": false,
                    "src": "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbReviewPage.init,
                    "isNavBarItem": false
                    // "showFn": glpro.glproGiftWrap.action.show,
                    // "hideFn": glpro.glproGiftWrap.action.hide,
                })
            }
            //add more pages to routerPages
            // gbb.utility.debugConsole("navigationItems:", navigationItems);
            return navigationItems;
        },
        getNavItem: function (id) {
            let navigationItems = gbb.state.navigationItems;
            let navigationItem = navigationItems.filter(function (item) {
                return item.id === id;
            })
            return navigationItem[0];
        },
        getNextNavigationItem: function () {

            let navigationItems = gbb.state.navigationItems;
            let currentPageId = gbb.state.currentPageId;

            let currentPageItem = gbb.f.getNavItem(currentPageId);

            // find the index of the current navigation item
            let currentPageIndex = navigationItems.indexOf(currentPageItem);
            // gbb.utility.debugConsole(currentPageIndex);
            // get the next navigation item making sure its not the last one, if its then return null
            if (currentPageIndex === navigationItems.length - 1) {
                return null;
            }
            else {
                return navigationItems[currentPageIndex + 1];
            }
        },
        getPreviousNavigationItem: function () {

            let navigationItems = gbb.state.navigationItems;
            let currentPageId = gbb.state.currentPageId;

            let currentPageItem = gbb.f.getNavItem(currentPageId);

            // find the index of the current navigation item
            let currentPageIndex = navigationItems.indexOf(currentPageItem);
            // gbb.utility.debugConsole(currentPageIndex);
            if (currentPageIndex == 0) {
                return null;
            }
            return navigationItems[currentPageIndex - 1];
        },
        // Assuming stepsConfiguration has the required data
        cacheAllProductsData: async function () {
            try {
                let allProducts = [];
                let productPages = [
                    gbb.settings.stepsConfigurationData?.productsData1,
                    gbb.settings.stepsConfigurationData?.productsData2,
                    gbb.settings.stepsConfigurationData?.productsData3,
                    gbb.settings.stepsConfigurationData?.productsData4,
                    gbb.settings.stepsConfigurationData?.productsData5,
                    gbb.settings.stepsConfigurationData?.productsData6,
                    gbb.settings.stepsConfigurationData?.productsData7,
                    gbb.settings.stepsConfigurationData?.productsData8,
                    gbb.settings.stepsConfigurationData?.productsData9,
                    gbb.settings.stepsConfigurationData?.productsData10,
                    gbb.settings.stepsConfigurationData?.productsData11,
                    gbb.settings.stepsConfigurationData?.productsData12
                ];

                // Loop through all product data pages
                for (let i = 0; i < productPages.length; i++) {
                    const productsData = productPages[i];
                    if (productsData && productsData.isProductsEnabled && productsData.uniqueProductsData) {
                        // Get product handles and IDs
                        let productHandles = productsData.uniqueProductsData.map(product => product.handle);
                        let productIds = productsData.uniqueProductsData.map(product => product.productId);

                        // Fetch data for each product
                        for (let j = 0; j < productHandles.length; j++) {
                            let handle = productHandles[j];
                            let productId = productIds[j];

                            // Check if it's already in the cache
                            if (!gbb.state.cachedProductData.has(productId)) {
                                // Fetch product data using utility functions
                                let productData = await gbb.utility.getProductDataV2(handle);

                                // Cache the product data
                                gbb.state.cachedProductData.set(productId, productData);
                                allProducts.push(productData);
                            }
                        }
                    }
                }

                gbb.utility.debugConsole('All products have been fetched and cached:', gbb.state.cachedProductData);
            } catch (error) {
                console.error('Error while caching products data:', error);
            }
        },

        updateNavigationsItems: function (stepId, isStatusActive, isStepCompleted) {
            gbb.state.navigationItems.find((item) => {
                if (item.id == stepId) {
                    if (isStatusActive && isStatusActive == true) {
                        item.isActive = true;
                    } else {
                        item.isActive = false;
                    }
                    if (isStepCompleted && isStepCompleted == true) {
                        item.isCompleted = true;
                    } else {
                        item.isCompleted = false;
                    }
                }
            })
        },
        markPreviousNavigationItemsAsCompleted: function (currentNavItem) {
            let navigationItems = [...gbb.state.navigationItems];
            let currentPageId = currentNavItem.id;

            //split the navigation items into two arrays, one before the current page and one after

            let currentPageIndex = navigationItems.indexOf(currentNavItem);
            let navigationItemsBeforeCurrentPage = navigationItems.slice(0, currentPageIndex);
            let navigationItemsAfterCurrentPage = navigationItems.slice(currentPageIndex + 1, navigationItems.length);

            //mark all the navigation items before the current page as completed
            navigationItemsBeforeCurrentPage.forEach(function (item) {
                gbb.f.updateNavigationsItems(item.id, false, true);
            })
            //mark all the navigation items after the current page as not completed
            navigationItemsAfterCurrentPage.forEach(function (item) {
                gbb.f.updateNavigationsItems(item.id, false, false);
            })

            gbb.f.updateNavigationsItems(currentPageId, true, false);


        },
        getNavigationItemsToDisplay: function (startFromNavItemId) {
            // let navigationItems =JSON.parse(JSON.stringify(gbb.state.navigationItems));
            // gbb.utility.debugConsole("before: gbb.state.navigationItems.length:", gbb.state.navigationItems.length)
            let navigationItems = [...gbb.state.navigationItems];


            let blackListedNavigationItems = ["landingPage", "reviewPage"];

            navigationItems = navigationItems.filter(function (item) {
                return !blackListedNavigationItems.includes(item.id);
            })

            // startFromNavItemId = "landingPage" when user is on landing page
            // Q: why does getNavigationItemsToDisplay get fired at all when user is on landing page?

            // A: because we also display navigation items on landing page
            // so to solve this, we just set startFromNavItemId to the first navigation item

            if (startFromNavItemId == "landingPage") {
                startFromNavItemId = navigationItems[0].id;
            }
            gbb.state.navigationItemsToRender = navigationItems;

            // if screen is less than 768px, then change gbb.state.navItemsViewPerPage to 4
            if (window.innerWidth < 768) {
                gbb.state.navItemsViewPerPage = 4
            }

            let navItem = gbb.f.getNavItem(startFromNavItemId);

            // find the index of the current navigation item
            let navItemIndex = gbb.state.navigationItemsToRender.indexOf(navItem);

            let startIndex = navItemIndex;
            if (startIndex + gbb.state.navItemsViewPerPage > navigationItems.length) {
                startIndex = navigationItems.length - gbb.state.navItemsViewPerPage;
                if (startIndex < 0) {
                    startIndex = 0;
                }
            }

            let endIndex = Math.min(startIndex + gbb.state.navItemsViewPerPage, navigationItems.length);
            let navigationItemsToDisplay = navigationItems.slice(startIndex, endIndex);


            return navigationItemsToDisplay;

        },
        insertDiscountProgressBar: async function () {

            gbb.state.giftBoxCartData = await gbb.utility.getGiftBoxProductsFromCart()


            //check if gbbDiscountProgressBar is enabled
            if (gbb.settings.discountsData.isDiscountEnabled) {
                //check if element exists
                if (gbb.$('.gbbDiscountComponent').length == 0) {
                    gbb.gbbDiscountComponent.init(gbb.settings)
                }
                //update the discount progress bar relative to the current cartTotal
                gbb.gbbDiscountComponent.f.updateCurrentDiscountRule();
            }
        },
        renderTagsPillsHTML: function (product, noteAttribute, category) {
            try {
                const tagsArray = product.tags;

                // const pillHTML 
                const userObjectForTagsAndPills = gbb.state.tagsPillsData || [];
                let tagsAndPillHTMLContainer = gbb.$("<div>").addClass("gbbTagsAndPillHTMLContainer")
                if (userObjectForTagsAndPills && userObjectForTagsAndPills.length < 1) {
                    return "";
                } else if (userObjectForTagsAndPills && userObjectForTagsAndPills.length > 0) {
                    for (let i = 0; i < userObjectForTagsAndPills.length; i++) {
                        const item = userObjectForTagsAndPills[i];
                        const currentKey = item.tagKey;
                        let tagsAndPillHTML = gbb.$("<div>").addClass("gbbTagsAndPillHTML")
                        const currentValueHtml = item.tagValueHTML;
                        // item.tagText
                        if (tagsArray.includes(currentKey)) {
                            tagsAndPillHTML.html(currentValueHtml);
                            tagsAndPillHTMLContainer.append(tagsAndPillHTML);
                        }
                    }
                }
                return tagsAndPillHTMLContainer;

            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        setSelectors: function () {
            let settings = gbb.settings
            gbb.selectors = {
                addToCart: settings.app.addToCartBtnSelectors,
                checkoutBtn: settings.app.checkoutBtnSelectors,
                sideCartSelectors: settings.app.sideCartSelectors,
                buyNowBtn: settings.app.buyNowBtn,
                cartForm: settings.app.cartForm,
                productPageWrapperV2: '.gbbProductPageWrapperV2',
                cartPageWrapperV2: '.gbbCartPageWrapperV2',
                quantityBtnSelectors: settings.app.quantityBtnSelectors,
                scheduleDeliveryPickerSelector: settings.app.scheduleDeliveryPickerSelector,
            }
        },
        setDefaultThemeStyles: function () {
            try {
                DEFAULT_BODY_OVERFLOW_VALUE = gbb.$('body').css('overflow-y');
                return;
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        setCustomStyling: function () {
            let customStyle = gbb.settings.app.customStyle
            if (customStyle) {
                var styleSheet = document.createElement("style")
                styleSheet.innerText = customStyle
                document.body.appendChild(styleSheet)

            }
        },
        getPageType: function () {
            var pageType = "";
            if (window.location.pathname.includes("/cart") && !window.location.pathname.includes("/products")) {
                pageType = "cart";
            } else if (window.location.pathname.includes("/products")) {
                pageType = "product";
            } else if (window.location.pathname.includes("/collections")) {
                pageType = "COLLECTION";
            } else if (window.location.pathname.includes("/")) {
                pageType = "HOME";
            } else if ("undefined" != typeof Shopify && "undefined" != typeof Shopify.Checkout) {
                pageType = "CHECKOUT";
            } else {
                pageType = "PAGE_NOT_FOUND";
            }
            return pageType;
        },
        getProductPageHandle: function () {
            if ("product" === gbb.state.page_type && shopifyLiquidValuesApp4.product.handle) {
                // let pattern = /(?<=\\/products\\/)((?!\\?|\\$).)+/g
                // if(window && window.location && window.location.href){
                //     return window.location.href.match(pattern)[0]
                // }
                return shopifyLiquidValuesApp4.product.handle
            }
            return "undefined"
        },
        applyButtonCSS: function (element) {

            //apply gbb.settings.app.themButtonTextColor themeButtonBackgroundColor themeButtonBorderColor to the button
            if (gbb.settings.app.themButtonTextColor != "") {
                element.css("color", gbb.settings.app.themButtonTextColor);
            }
            if (gbb.settings.app.themeButtonBackgroundColor != "") {
                element.css("background-color", gbb.settings.app.themeButtonBackgroundColor);
            }
            if (gbb.settings.app.themeButtonBorderColor != "") {
                element.css("border", "1px solid")
                element.css("border-color", gbb.settings.app.themeButtonBorderColor);
            }
            // box shadow
            if (gbb.settings.app.themeButtonBoxShadow != "") {
                element.css("box-shadow", gbb.settings.app.themeButtonBoxShadow);
            }
            //themeButtonFontFamily
            if (gbb.settings.app.themeButtonFontFamily != "") {
                element.css("font-family", gbb.settings.app.themeButtonFontFamily);
            }


        },
        resetButtonCSS: function (element) {
            //reset the button css
            element.css("color", "");
            element.css("background-color", "");
            element.css("border", "");
            element.css("border-color", "");
            element.css("box-shadow", "");
        },
        applyHeaderCSS: function (element) {
            //apply gbb.settings.app.themeFontFamily themeFontColor to the header
            if (gbb.settings.app.themeHeaderFontFamily != "") {
                element.css("font-family", gbb.settings.app.themeHeaderFontFamily);
            }
            if (gbb.settings.app.themeHeaderFontColor != "") {
                element.css("color", gbb.settings.app.themeHeaderFontColor);
            }
        },
        applyLabelCSS: function (element) {
            //apply gbb.settings.app.themeLabelFontColor to the label
            if (gbb.settings.app.themeLabelFontColor != "") {
                element.css("color", gbb.settings.app.themeLabelFontColor);
            }
            if (gbb.settings.app.themeLabelFontFamily != "") {
                element.css("font-family", "inherit");
            }
        },
        applyBackgroundColorCss: function (element) {

        },
        applyTextColorCss: function (element) {

        },
        applyPrimaryColorCss: function (element) {
            element.css("background", gbb.settings.pageCustomizationData.colors.primaryColor);
        },
        applySecondaryColorCss: function (element) {
            element.css("background", gbb.settings.pageCustomizationData.colors.secondaryColor);
        },
        applyTextColorCss: function (element) {
            element.css("color", gbb.settings.pageCustomizationData.colors.textColor);
        },
        applyDisabledColorCss: function (element) {
            element.css("color", gbb.settings.pageCustomizationData.colors.disabledColor);
        },
        applyActiveImageStyle: function (element) {
            element.css("border", `2px solid ${gbb.settings?.pageCustomizationData?.productCard.productCardButtonColor}`)
        },
        removeActiveImageStyle: function (element) {
            element.css("border", "none")
        },
        applySelectedVariantStyle: function (element) {
            element.css("background", gbb.settings?.pageCustomizationData?.productCard.productCardButtonColor);
            element.css("color", gbb.settings.pageCustomizationData.productCard.productCardButtonTextColor)
        },
        removeSelectedVariantStyle: function (element) {
            element.css("background", "#f1f2f3")
            element.css("color", "#000000")
        },
        getSelectedVariant: function () {
            if ("product" === gbb.state.page_type) {
                if (ShopifyAnalytics && ShopifyAnalytics.meta && ShopifyAnalytics.meta.selectedVariantId) {
                    return ShopifyAnalytics.meta.selectedVariantId
                }
                if (document.querySelector('[name="id"]') && document.querySelector('[name="id"]').value) {
                    return document.querySelector('[name="id"]').value
                }
                return undefined
            }
        },
        getElements: function (settings) {
            return {
                gbbHTMLWrapperParent: gbb.$(gbb.$.parseHTML('<div class="gbbHTMLWrapper"></div>')),
                gbbHeaderWrapperParent: gbb.$(gbb.$.parseHTML('<div class="gbbHeaderWrapper"></div>')),
                gbbBodyWrapperParent: gbb.$(gbb.$.parseHTML('<div class="gbbBodyWrapper"></div>')),
                //change this for sidebar position
                gbbFooterWrapperParent: gbb.$(gbb.$.parseHTML('<div class="gbbFooterWrapper"></div>')),

                addToCartBtn: gbb.$(document).find(gbb.selectors.addToCart),
                addToCartButtonCloned: undefined,
                checkoutBtn: gbb.$(document).find(gbb.selectors.checkoutBtn),
                cartForm: gbb.$(document).find(gbb.selectors.cartForm),
                productPageWrapperV2: gbb.$(gbb.$.parseHTML('<div class="gbbPageWrapper gbbProductPageWrapperV2"> <div class="gbbGiftOptionsPageEleWrapper"></div>  <div class="gbbLandingPageWrapper"></div><div class="gwmGiftMessageWrapper"></div> </div>')),
                cartPageWrapperV2: gbb.$(gbb.$.parseHTML('<div class="gbbPageWrapper gbbCartPageWrapperV2"> <div class="gbbCartGiftOptionsPageEleWrapper"></div><div class="gwmCartGiftMsgAndWrapWrapper"></div><div class="gwmCartGiftMessageWrapper"></div></div>')),
                buyNowBtn: gbb.$(document).find(gbb.selectors.buyNowBtn)
            }
        },
        renderNavigationHTML: function (parentHTML, noteAttribute, navigationItems) {
            let navigationHTML = gbb.$("<div>").addClass("gbbNavigationItemsContainer");


            let navigationArrowsContainer = gbb.$("<div>").addClass("gbbNavigationArrowsContainer");
            // let navigationItems = gbb.gbbModal.setNavigationItems();
            // let navigationItems = gbb.state.navigationItems;

            // navigationItems = gbb.f.getNextFiveNavigationItems(navigationItems);


            let stepsCount = 0;
            navigationItems = navigationItems.filter((element) => {
                if (element.isNavBarItem && element.isNavBarItem == true) {
                    stepsCount++;
                    return element;
                }
            })

            let navigationItemHTML = gbb.$("<div>").addClass("gbbNavigationItem");
            //run a for loop with each navigation item with the following properties text, onclick function, isActive

            if (stepsCount == 1) {
                return;
            } else {
                if (parentHTML && stepsCount == 2) {
                    if (noteAttribute == "landingPage") {
                        parentHTML.css("margin", "0% 15%");
                    } else {
                        parentHTML.css("margin", "0% 0%");
                    }

                    if (window.innerWidth > 600) {
                        if (noteAttribute != "landingPage") {
                            parentHTML.css("margin", "0% 0%");
                        }

                    }
                }
                for (let i = 0; i < navigationItems.length; i++) {
                    let navigationItemContainer = navigationItemHTML.clone();
                    let _navigationImageContainer = gbb.$("<div>").addClass("gbbNavigationStepImgContainer");

                    let _navigationImage = gbb.$("<img>").addClass("gbbNavigationImage");
                    let item = navigationItems[i];
                    if (stepsCount == 2 && item.id != "personalizationPage") {
                        // _navigationImageContainer.css("justify-self", "start");
                    }

                    if (item.isActive) {
                        let borderWidth = gbb.settings.pageCustomizationData.navigationBanner.navigationBannerStepCompletedBorderWidth || "4px";
                        _navigationImageContainer.addClass("gbbNavigationStepImgContainerActive");
                        _navigationImageContainer.css("border", `${borderWidth} solid ${gbb.settings.pageCustomizationData.navigationBanner.navigationBannerStepCompletionColor}`);
                    } else {
                        _navigationImageContainer.removeClass("gbbNavigationStepImgContainerActive");
                    }

                    if (item.isCompleted) {
                        let divToBeInserted;
                        // gbb.settings.pageCustomizationData.customImage = "https://gift-box-builder-app4.s3.us-east-2.amazonaws.com/public/icons/Deafult+Image.png"
                        if (gbb.settings.merchantInfo?.customSettings?.navCompletedImage) {
                            let tickMarkImg = gbb.$("<img>").addClass("gbbtickMarkImg").addClass("gbbNavigationImage")
                            tickMarkImg.attr("src", gbb.settings.merchantInfo?.customSettings?.navCompletedImage);
                            divToBeInserted = tickMarkImg;
                        } else {
                            let tickMarkDiv = gbb.$("<div>").addClass("gbbtickMark");

                            tickMarkDiv.append(`<svg width="30" height="30" viewBox="0 0 74 74" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M29.4459 54.1897C29.0348 54.1897 28.6494 54.1249 28.2897 53.9954C27.93 53.868 27.5959 53.6501 27.2876 53.3417L14.0293 40.0834C13.464 39.5181 13.1937 38.7853 13.2183 37.885C13.2451 36.9867 13.5411 36.2549 14.1063 35.6896C14.6716 35.1244 15.3911 34.8417 16.2647 34.8417C17.1383 34.8417 17.8577 35.1244 18.423 35.6896L29.4459 46.7126L55.5772 20.5813C56.1425 20.016 56.8753 19.7334 57.7756 19.7334C58.6739 19.7334 59.4057 20.016 59.9709 20.5813C60.5362 21.1466 60.8188 21.8784 60.8188 22.7766C60.8188 23.677 60.5362 24.4098 59.9709 24.9751L31.6043 53.3417C31.2959 53.6501 30.9619 53.868 30.6022 53.9954C30.2425 54.1249 29.857 54.1897 29.4459 54.1897Z" fill=${gbb.settings.pageCustomizationData.navigationBanner.navigationBannerStepDoneColor || "#ffffff"} ></svg>`);
                            let tickMarkPseudo = gbb.$("<div>").addClass("gbbtickMarkPseudo");

                            tickMarkDiv.css("border", "none");

                            tickMarkPseudo.css("background-color", gbb.settings.pageCustomizationData.navigationBanner.navigationBannerStepDoneColor || "#ffffff");
                            //tickMarkDiv.addClass("gbbtickMarkPseudo");

                            _navigationImageContainer.css("border", "none");

                            _navigationImageContainer.css("background-color", gbb.settings.pageCustomizationData.navigationBanner.navigationBannerStepCompletionColor);
                            divToBeInserted = tickMarkDiv;
                        }
                        _navigationImageContainer.html(divToBeInserted);
                        //item.src = "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/step_completed.png"
                    } else {
                        _navigationImage.attr("src", item.src);
                        _navigationImageContainer.append(_navigationImage);
                    }
                    let _navigationTitleContainer = gbb.$("<div>").addClass("gbbNavigationTitleContainer");
                    let _navigationTitle = gbb.$("<p>").addClass("gbbNavigationTitle");
                    // _navigationTitle.css("color", gbb.settings.pageCustomizationData?.navigationBanner?.navigationBannerTextColor);

                    navigationItemContainer.attr("id", item.id);

                    //TODO: allowNavigationClick flag to be added in the future
                    if (true || gbb.settings.stepsConfigurationData.allowNavigationClick) {
                        navigationItemContainer.on("click", item.showFn)
                    }

                    _navigationTitle.text(item.text || "");
                    _navigationTitle.css("color", gbb.settings.pageCustomizationData?.navigationBanner?.navigationBannerStepTextColor || "black");


                    _navigationTitleContainer.append(_navigationTitle);
                    navigationItemContainer.append(_navigationImageContainer);
                    navigationItemContainer.append(_navigationTitleContainer);

                    // navigationItemContainer.append()
                    navigationHTML.append(navigationItemContainer);
                }

                // gbb.utility.debugConsole("navigationItems", navigationItems)

                let currentNavigationItemIndex = gbb.state.navigationItemsToRender.findIndex((item) => {
                    return item.id == navigationItems[0].id
                })

                // gbb.utility.debugConsole("currentNavigationItemIndex", currentNavigationItemIndex);

                if (currentNavigationItemIndex > -1) {

                    let previousNavigationItemsButton = gbb.$("<div>").addClass("gbbPreviousNavigationItemsButton")
                    previousNavigationItemsButton.append(CONSTANT_ARROW_SVG);
                    previousNavigationItemsButton.find("g").css("fill", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconTextColor || "black");

                    previousNavigationItemsButton.css("background", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconBgColor || "white");

                    let currentIndex = currentNavigationItemIndex

                    let nextStartIndex = Math.max(currentIndex - gbb.state.navItemsViewPerPage, 0);

                    let previousItem = gbb.state.navigationItemsToRender[nextStartIndex];

                    //now fetch the previous 5 items if they exist
                    previousNavigationItemsButton.on("click", () => {
                        const navItems = gbb.f.getNavigationItemsToDisplay(previousItem.id)
                        // gbb.utility.debugConsole(navItems);
                        gbb.$(".gbbNavigationItemsContainer").replaceWith(gbb.f.renderNavigationHTML("", gbb.state.currentPageId, navItems));
                    })

                    if (gbb.state.navigationItemsToRender.length > gbb.state.navItemsViewPerPage) {
                        navigationHTML.append(previousNavigationItemsButton);
                    }

                }

                if (currentNavigationItemIndex < gbb.state.navigationItemsToRender.length - 1) {
                    let nextNavigationItemsButton = gbb.$("<div>").addClass("gbbNextNavigationItemsButton")
                    nextNavigationItemsButton.append(CONSTANT_ARROW_SVG);
                    nextNavigationItemsButton.find("g").css("fill", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconTextColor || "black");
                    nextNavigationItemsButton.css("background", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconBgColor || "white");

                    let currentIndex = currentNavigationItemIndex

                    let nextIndex = currentIndex + gbb.state.navItemsViewPerPage;

                    if (nextIndex > gbb.state.navigationItemsToRender.length - 1) {
                        nextIndex = gbb.state.navigationItemsToRender.length - 1;
                    }

                    let nextItem = gbb.state.navigationItemsToRender[nextIndex];


                    nextNavigationItemsButton.on("click", () => {
                        const navItems = gbb.f.getNavigationItemsToDisplay(nextItem.id)
                        // gbb.utility.debugConsole("next navItems are",navItems);
                        gbb.$(".gbbNavigationItemsContainer").replaceWith(gbb.f.renderNavigationHTML("", gbb.state.currentPageId, navItems));
                    })

                    if (gbb.state.navigationItemsToRender.length > gbb.state.navItemsViewPerPage) {
                        navigationHTML.append(nextNavigationItemsButton);
                    }

                }


                if (navigationItems.length > 0 && gbb.$('.gbbProductsCardLayoutV2').length > 0) {
                    // render steps progress bar
                    setTimeout(() => {
                        gbb.$('.gbbNavigationItemsContainer').css('::before', {
                            'content': 'none'
                        })
                        let stepsProgressBarHTML = gbb.f.renderStepsProgressBar()

                        //calculate the width for progressbar
                        let navItems = gbb.$('.gbbNavigationItem');

                        let startColumn = navItems.first();
                        let endColumn = navItems.last();

                        let startCenter = startColumn.offset().left + startColumn.width() / 2;
                        let endCenter = endColumn.offset().left + endColumn.width() / 2;

                        let progressBarWidth = endCenter - startCenter;
                        stepsProgressBarHTML.css('width', progressBarWidth);
                        // ================================================ //

                        // calculate the filled progressbar width
                        // 1st step to the last step completed 
                        let activeStepIndex = 0
                        let lastCompletedStepIndex = 0
                        for (let i = 0; i < navigationItems.length; i++) {
                            let step = navigationItems[i]
                            if (step.isNavBarItem && step.isActive) {
                                activeStepIndex = i;
                            }
                            if (step.isNavBarItem && step.isCompleted) {
                                lastCompletedStepIndex = i;
                            }
                        }
                        if (activeStepIndex == 0 && lastCompletedStepIndex != 0) {
                            activeStepIndex = lastCompletedStepIndex;
                        }// when you have more than navItemsViewPerPage navItems 
                        /*
                        for eg : you have 10 steps 
                        so in step navigations we will have pagination // TO BE DONE @mufadal
                         */
                        let lastCompletedStep = navItems.eq(activeStepIndex);
                        let lastCompletedStepCenter = lastCompletedStep.offset().left + lastCompletedStep.width() / 2;

                        let filledProgressBarWidth = lastCompletedStepCenter - startCenter;
                        stepsProgressBarHTML.find('.gbbStepsProgressBarFilled').css('width', filledProgressBarWidth);

                        navigationHTML.append(stepsProgressBarHTML)
                    }, 100)
                }
                // navigationHTML.append(navigationArrowsContainer);
                //navigationHTML.append(navigationImages);
                return navigationHTML;
            }
        },
        renderStepsProgressBar: function (parentHTML, noteAttribute, navigationItems) {
            let stepsProgressBarHTML = gbb.$("<div>").addClass("gbbStepsProgressBarContainer");
            let stepsProgressBar = gbb.$("<div>").addClass("gbbStepsProgressBar");
            stepsProgressBar.css('background', gbb.settings.pageCustomizationData.navigationBanner.navigationBannerStepProgressBarEmptyColor || '#eeeeee')
            let stepsProgressBarFilled = gbb.$("<div>").addClass("gbbStepsProgressBarFilled");
            stepsProgressBarFilled.css('background', gbb.settings.pageCustomizationData.navigationBanner.navigationBannerStepProgressBarFilledColor || '#1E1E1E')
            stepsProgressBar.append(stepsProgressBarFilled)
            stepsProgressBarHTML.append(stepsProgressBar);
            return stepsProgressBarHTML;
        },
        addParamsToUrl: function (key, value) {
            // get the navigation item and attach it to the url params
            let urlParams = new URLSearchParams(window.location.search);
            urlParams.set(key, value);
            window.history.replaceState({}, "", `${window.location.pathname}?${urlParams.toString()}`);
        },
        getParamValueFromUrl: function (key) {
            // get the navigation item from the url params
            let urlParams = new URLSearchParams(window.location.search);
            let value = urlParams.get(key);
            // gbb.utility.debugConsole("getParamValueFromUrl:", value);
            return value;
        },


        processAdditionalLogicAsPerUseCase: function () {
            try {
                // check localStorage for extraInfoFromLinkDummyProductPage
                let extraInfoFromLinkDummyProductPage = sessionStorage.getItem("extraInfoFromLinkDummyProductPage");
                let linkProductSetting = gbb.settings.stepsConfigurationData.useLinkProductAsDefaultProduct;

                if (typeof linkProductSetting == "undefined") {
                    //this is a fallback because we have customer who have
                    // this flag on user level but not bundle level
                    linkProductSetting = true;
                }

                if (linkProductSetting == false) {
                    //should we also clear the sessionStorage here?
                    sessionStorage.removeItem("extraInfoFromLinkDummyProductPage");
                    return;
                }
                if (extraInfoFromLinkDummyProductPage) {
                    extraInfoFromLinkDummyProductPage = JSON.parse(extraInfoFromLinkDummyProductPage);
                    if (extraInfoFromLinkDummyProductPage?.addDummyProductToDefaultProducts == true) {
                        // add the dummy product to the default products
                        let dummyProductsData = extraInfoFromLinkDummyProductPage?.dummyProductsData.length > 0 ? extraInfoFromLinkDummyProductPage?.dummyProductsData : null;
                        for (let i = 0; i < dummyProductsData?.length; i++) {
                            let dummyProduct = dummyProductsData[i];
                            if (dummyProduct) {
                                let defaultProductsData = gbb.settings.stepsConfigurationData.defaultProductsData || { products: [], isDefaultProductsEnabled: false };
                                defaultProductsData.products.push(dummyProduct);
                                defaultProductsData.isDefaultProductsEnabled = true;
                                gbb.settings.stepsConfigurationData.defaultProductsData = defaultProductsData;
                            }
                        }
                    }
                }
            } catch (e) {
                gbb.utility.debugConsole("error in processAdditionalLogicAsPerUseCase:", e)
            }
        },

        renderFiltersSearchSortHeaderHTML: function (noteAttribute) {
            let gbbFiltersSearchSortHeader = gbb.$("<div>").addClass("gbbFiltersSearchSortHeader");

            let gbbFiltersMainButtonWrapper = gbb.$("<div>").addClass("gbbFiltersMainButtonWrapper");
            let gbbFiltersCheckboxLabel = gbb.$("<div>").addClass("gbbFiltersCheckboxLabel");

            let activatedFiltersCount = gbb.utility.getActivatedFilters(noteAttribute).length > 0 ? " ( " + gbb.utility.getActivatedFilters(noteAttribute).length + " )" : ""
            gbbFiltersCheckboxLabel.text((gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.filtersLabel) || "Filters1") + activatedFiltersCount);

            let gbbFiltersDropDownButton = gbb.$("<div>").addClass("gbbFiltersDropDownButton");
            // gbbFiltersDropDownButton.css("background", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconBgColor || "white");
            gbbFiltersDropDownButton.css("color", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconTextColor || "#000000");

            // gbbFiltersDropDownButton.append(`<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
            //         width="auto" height="30px" viewBox="0 0 512.000000 512.000000"
            //         preserveAspectRatio="xMidYMid meet">
            //        <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
            //        fill=${gbb.settings.pageCustomizationData.quickSettings.colors.primaryColor || "#000000"} stroke="none">
            //        <path d="M893 4335 c-154 -42 -300 -175 -349 -318 l-16 -46 -221 -3 c-213 -3
            //        -223 -4 -254 -26 -67 -48 -67 -156 0 -204 31 -22 41 -23 254 -26 l221 -3 16
            //        -46 c22 -65 68 -133 129 -190 162 -154 382 -186 586 -87 101 49 223 193 251
            //        294 l6 25 1760 5 1759 5 32 23 c67 48 67 156 0 204 l-32 23 -1759 5 -1760 5
            //        -6 25 c-28 101 -150 245 -251 294 -115 56 -253 71 -366 41z m232 -260 c45 -18
            //        92 -62 123 -114 23 -39 27 -57 27 -121 0 -64 -4 -82 -27 -121 -32 -54 -78 -96
            //        -128 -117 -45 -19 -145 -19 -191 1 -92 38 -159 137 -159 237 0 87 39 156 123
            //        220 49 37 161 44 232 15z"/>
            //        <path d="M3976 3059 c-156 -37 -327 -194 -365 -338 l-7 -26 -1760 -5 -1759 -5
            //        -32 -23 c-67 -48 -67 -156 0 -204 l32 -23 1759 -5 1760 -5 6 -25 c28 -101 150
            //        -245 251 -294 155 -75 323 -75 471 0 99 50 209 175 244 277 l16 46 221 3 c213
            //        3 223 4 254 26 67 48 67 156 0 204 -31 22 -41 23 -254 26 l-221 3 -16 46 c-50
            //        145 -196 277 -353 318 -62 16 -186 18 -247 4z m220 -264 c49 -20 105 -76 130
            //        -130 60 -128 -3 -287 -135 -342 -46 -20 -146 -20 -191 -1 -84 35 -148 121
            //        -157 210 -20 194 172 337 353 263z"/>
            //        <path d="M2433 1775 c-144 -39 -267 -139 -328 -266 -19 -41 -35 -79 -35 -86 0
            //        -10 -201 -13 -992 -15 l-993 -3 -32 -23 c-67 -48 -67 -156 0 -204 l32 -23 993
            //        -3 c791 -2 992 -5 992 -15 0 -7 16 -45 35 -86 148 -309 575 -377 818 -128 54
            //        54 127 178 127 214 0 10 201 13 993 15 l992 3 32 23 c67 48 67 156 0 204 l-32
            //        23 -992 3 c-792 2 -993 5 -993 15 0 7 -16 46 -35 86 -101 210 -356 326 -582
            //        266z m247 -273 c179 -89 178 -354 -3 -446 -153 -78 -330 6 -366 174 -28 131
            //        53 260 187 296 60 17 113 10 182 -24z"/>
            //        </g>
            //        </svg>`);
            gbbFiltersDropDownButton.append(`<svg width="20" height="19" viewBox="0 0 20 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0 5.58863H15.2086V3.47401H0V5.58863ZM17.9738 0C17.2102 0 16.5912 0.676247 16.5912 1.51044V7.5522C16.5912 8.3864 17.2102 9.06264 17.9738 9.06264C18.7374 9.06264 19.3564 8.3864 19.3564 7.5522V1.51044C19.3564 0.676247 18.7374 0 17.9738 0ZM9.67822 12.5367V10.5731C9.67822 9.73889 9.05921 9.06264 8.29562 9.06264C7.53203 9.06264 6.91301 9.73889 6.91301 10.5731V16.6148C6.91301 17.449 7.53203 18.1253 8.29562 18.1253C9.05921 18.1253 9.67822 17.449 9.67822 16.6148V14.6513H19.3564V12.5367H9.67822ZM0 14.6513H5.53041V12.5367H0V14.6513Z" fill="#1E1E1E"}/>
                    </svg>`)
            gbbFiltersMainButtonWrapper.append(gbbFiltersDropDownButton);
            gbbFiltersMainButtonWrapper.append(gbbFiltersCheckboxLabel);

            gbbFiltersMainButtonWrapper.on("click", () => {
                gbb.utility.toggleFiltersSideBar(noteAttribute);
                if (gbb.utility.getFiltersState(noteAttribute)) {
                    // let gbbFiltersSideBarContainer = gbb.$("<div>").addClass("gbbFiltersSideBarContainer").addClass("gbbFiltersSideBarContainerSlideIn");
                    // gbbFiltersSideBarContainer.append(gbb.f.renderFiltersSideBarHTML(noteAttribute));
                    // gbb.$(".gbbPageBody").append(gbbFiltersSideBarContainer);
                    gbb.$("body").append(gbb.f.renderFiltersSideBarHTML(noteAttribute));
                    gbb.f.applyFontToFiltersSidebar();
                } else {
                    gbb.$("body").find(".gbbFiltersSideBarContainer").remove()
                }
            })

            let gbbSearchBarMainWrapper = gbb.$("<div>").addClass("gbbSearchBarMainWrapper");


            let gbbSortByMainWrapper = gbb.$("<div>").addClass("gbbSortByMainWrapper");
            gbbSortByMainWrapper.text("Sort By");

            let filtersInfo = gbb.utility.getFiltersInfo(noteAttribute)
            if (filtersInfo?.isFiltersEnabled && filtersInfo?.categories?.length > 0) {
                gbbFiltersSearchSortHeader.append(gbbFiltersMainButtonWrapper);
            }
            //gbbFiltersSearchSortHeader.append(gbbSearchBarMainWrapper);
            // gbbFiltersSearchSortHeader.append(gbb.f.renderSortByHTML(noteAttribute));
            if (gbb.gbbAddProductsPage?.state?.filterBySearch?.isSearchEnabled) {
                gbbFiltersSearchSortHeader.append(gbb.f.renderSearchBoxHTML(noteAttribute));
            }
            return gbbFiltersSearchSortHeader;
        },
        renderSortByHTML: function (noteAttribute) {
            const gbbSortByDropDownContainer = gbb.$("<div>").addClass("gbbSortByDropDownContainer");
            const gbbSortByDropDownSelect = gbb.$("<select>").addClass("gbbSortByDropDownSelect");

            let sortBy = gbb.utility.getSortByValues(noteAttribute);
            if (!sortBy.isSortByEnabled) {
                return;
            }
            let sortByCategories = [];
            Object.keys(sortBy?.sortByCategories).forEach((element) => {
                sortByCategories.push(sortBy?.sortByCategories[element])
            });



            sortByCategories?.forEach((category, index) => {
                if (index == 0) {
                    let optionEle = gbb.$("<option>").attr("value", "featured")
                        .text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.sortBy.featured) || "Featured");
                    gbbSortByDropDownSelect.append(optionEle);
                }
                if (category.id != "priceHighToLow" && category.id != "priceLowToHigh" && category.isEnabled) {
                    let optionEle = gbb.$("<option>").attr("value", category.id)
                        .text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.sortBy[category.id])); //add code for multi language here
                    //choose this value as default if value found sortBy.sortByValue
                    if (category.id === sortBy?.sortByValue) {
                        optionEle.attr("selected", "selected");
                    }

                    gbbSortByDropDownSelect.append(optionEle);

                }
            });
            gbbSortByDropDownSelect.change(async (event) => {
                gbb.utility.setSortByValues(noteAttribute, event.target.value);
                let products = await gbb.utility.getFilteredSortedProductsData(noteAttribute);
            })
            gbbSortByDropDownContainer.append(gbbSortByDropDownSelect);
            return gbbSortByDropDownContainer;
        },
        renderSearchBoxHTML: function (noteAttribute) {
            try {
                let gbbSearchBarMainWrapper = gbb.$("<div>").addClass("gbbSearchBarMainWrapper");
                let gbbSearchBarInput = gbb.$("<input>").addClass("gbbSearchBarInput").attr("type", "text").attr("placeholder", gbb.utility.renderLanguageValue(gbb.settings.languageData.general.searchLabel) || 'Search1').attr('value', gbb.gbbAddProductsPage.state?.filterBySearch?.searchQuery?.searchText || '');
                let gbbSearchBarIcon = gbb.$("<div>").addClass("gbbSearchBarIcon");
                gbbSearchBarIcon.append(SEARCH_ICON_SVG)
                gbbSearchBarMainWrapper.append(gbbSearchBarIcon);
                gbbSearchBarMainWrapper.append(gbbSearchBarInput);
                gbbSearchBarInput.on("input", async (event) => {
                    let searchedValue = event.target.value
                    let searchedProducts = await gbb.gbbAddProductsPage.f.handleSearchBundleInput(searchedValue, noteAttribute);
                    let activeCategory = gbb.gbbMultipleCategoriesPage.state.currentCategoryId;
                    await gbb.gbbAddProductsPage.f.renderProductsCardContainer(searchedProducts, noteAttribute, 'searchProductsFlow', activeCategory)
                })
                return gbbSearchBarMainWrapper;
            } catch (error) {
                gbb.utility.debugConsole("error in renderSearchBoxHTML", error)
            }
        },
        renderFiltersSideBarHTML: function (noteAttribute) {
            //contains entire filter sidebar
            let gbbProductsFiltersMainContainer = gbb.$("<div>").addClass("gbbProductsFiltersMainContainer");
            let gbbProductsFiltersContainer = gbb.$("<div>").addClass("gbbProductsFiltersContainer");

            let gbbProductsFiltersContainerHeader = gbb.$("<div>").addClass("gbbProductsFiltersContainerHeader");
            let gbbProductsFiltersContainerHeaderLabels = gbb.$("<div>").addClass("gbbProductsFiltersContainerHeaderLabels");

            let gbbProductsFiltersContainerLabel = gbb.$("<div>").addClass("gbbProductsFiltersContainerLabel");
            gbbProductsFiltersContainerLabel.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.filtersLabel) || "Filters1");
            let gbbProductsFiltersClearLabel = gbb.$("<div>").addClass("gbbProductsFiltersClearLabel");
            gbbProductsFiltersClearLabel.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.clearSelection) || "Clear Selection1");

            gbbProductsFiltersClearLabel.on("click", async (event) => {
                gbb.gbbAddProductsPage.f.resetSearchTextValue()
                gbb.utility.clearAllFilters(noteAttribute);

                let filteredProducts = await gbb.utility.getFilteredSortedProductsData(noteAttribute)
                // currentPageHTML.html(gbb.f.renderProductsHTML(filteredProducts, noteAttribute))
                gbb.utility.toggleFiltersSideBar(noteAttribute);
                setTimeout(() => {
                    gbbProductsFiltersContainer.addClass("gbbFiltersSideBarContainerSlideOut")
                    gbb.$("body").find(".gbbProductsFiltersMainContainer").remove()
                }, 500)
            })
            const gbbFilterModalClose = gbb.$("<div>").addClass("gbbFilterModalClose");
            gbbFilterModalClose.text("+");
            gbbFilterModalClose.on("click", () => {
                gbbProductsFiltersContainer.addClass("gbbFiltersSideBarContainerSlideOut")
                gbb.utility.toggleFiltersSideBar(noteAttribute);
                gbb.$("body").find(".gbbProductsFiltersMainContainer").remove()
            })

            gbbProductsFiltersMainContainer.on('click', function (event) {
                if (!gbb.$(event.target).closest(gbbProductsFiltersContainer).length) {
                    gbbProductsFiltersContainer.addClass("gbbFiltersSideBarContainerSlideOut")
                    gbb.utility.toggleFiltersSideBar(noteAttribute);
                    gbb.$("body").find(".gbbProductsFiltersMainContainer").remove()
                }
            });

            gbbProductsFiltersContainerHeaderLabels.append(gbbProductsFiltersContainerLabel);
            gbbProductsFiltersContainerHeaderLabels.append(gbbProductsFiltersClearLabel);

            gbbProductsFiltersContainerHeader.append(gbbProductsFiltersContainerHeaderLabels);
            gbbProductsFiltersContainerHeader.append(gbbFilterModalClose);
            gbbProductsFiltersContainer.append(gbbProductsFiltersContainerHeader);
            //contains one particular filter
            let gbbFiltersInfo = gbb.utility.getFiltersInfo(noteAttribute);
            //TODO
            // if(!gbbFiltersInfo.isFiltersEnabled) {
            //     return;
            // }
            if (gbbFiltersInfo.categories == 0) {
                let gbbProductsNoFilters = gbb.$("<div>").addClass("gbbProductsNoFilters");
                gbbProductsNoFilters.text("No filters have been added");
                gbbProductsFiltersContainer.append(gbbProductsNoFilters);
                gbbProductsFiltersMainContainer.append(gbbProductsFiltersContainer);
                return gbbProductsFiltersMainContainer;
            }
            gbbFiltersInfo.categories.forEach((filterCategory, index) => {

                let isFilterTagsVisible = gbb.utility.getActivatedCategoriesForFilters(noteAttribute, filterCategory);

                let gbbFilterContainer = gbb.$("<div>").attr("data-gbbFilterContainer", index).addClass("gbbFilterContainer");
                let gbbFiltersDropDownWrapper = gbb.$("<div>").attr("data-gbbFiltersDropDownWrapper", index).attr("data-role", "collapsible")
                    .addClass("gbbFiltersDropDownWrapper")
                    .addClass("gbbFiltersDropDownWrapper" + index);
                let gbbFilterLabel = gbb.$("<div>").attr("data-gbbFilterLabel", index).addClass("gbbFilterLabel").text(filterCategory.title);
                let gbbFilterDropDownButton = gbb.$("<img>").attr("data-gbbFilterDropDownButton", index).addClass("gbbFilterDropDownButton").addClass("gbbFilterDropDownButton" + index);
                gbbFilterDropDownButton.attr("src", CONSTANT_IMAGES_DROPDOWN_BUTTON);

                gbbFiltersDropDownWrapper.append(gbbFilterLabel);
                gbbFiltersDropDownWrapper.append(gbbFilterDropDownButton);

                gbbFilterContainer.append(gbbFiltersDropDownWrapper);
                if (filterCategory.type == "price") {
                    return;
                    let showPriceFilter = true;
                    gbbFilterDropDownButton.css("transform", "rotate(360deg)");
                    let gbbFilterPriceContainer = gbb.$("<div>").addClass("gbbFilterPriceContainer");
                    let gbbPriceFieldContainer = gbb.$("<div>").addClass("gbbPriceFieldContainer");
                    let gbbPriceFieldLower = gbb.$("<input>")
                        .addClass("gbbPriceFieldLower")
                        .attr("type", "range")
                        .attr("min", filterCategory.minValue)
                        .attr("max", filterCategory.maxValue)
                        .attr("value", gbb.utility.getPriceFilterValues(noteAttribute)?.minValue);


                    let gbbPriceFieldUpper = gbb.$("<input>")
                        .addClass("gbbPriceFieldUpper")
                        .attr("type", "range")
                        .attr("min", filterCategory.minValue)
                        .attr("max", filterCategory.maxValue)
                        .attr("value", gbb.utility.getPriceFilterValues(noteAttribute)?.maxValue);

                    let lowerVal = parseInt(gbbPriceFieldLower[0].value);
                    let upperVal = parseInt(gbbPriceFieldUpper[0].value);


                    gbbPriceFieldContainer.append(gbbPriceFieldLower);
                    gbbPriceFieldContainer.append(gbbPriceFieldUpper);

                    let gbbPriceTextWrap = gbb.$("<div>").addClass("gbbPriceTextWrap");

                    let gbbPriceWrap1 = gbb.$("<div>").addClass("gbbPriceWrap1");
                    //let gbbPriceWrap1Input = gbb.$("<input>").addClass("gbbPriceWrap1Input");
                    gbb.utility.debugConsole("here ar price:", gbb.utility.getPriceFilterValues(noteAttribute)?.minValue)
                    let gbbPriceWrap1Label = gbb.$("<div>").addClass("gbbPriceWrap1Label").text(gbb.utility.getCurrencySymbol() + " " + gbb.utility.getPriceFilterValues(noteAttribute)?.minValue);
                    //gbbPriceWrap1.append(gbbPriceWrap1Input);
                    gbbPriceWrap1.append(gbbPriceWrap1Label);

                    let gbbPriceWrap2 = gbb.$("<div>").addClass("gbbPriceWrap2");
                    //let gbbPriceWrap2Input = gbb.$("<input>").addClass("gbbPriceWrap2Input");
                    let gbbPriceWrap2Label = gbb.$("<div>").addClass("gbbPriceWrap2Label").text(gbb.utility.getCurrencySymbol() + " " + gbb.utility.getPriceFilterValues(noteAttribute)?.maxValue);
                    //gbbPriceWrap2.append(gbbPriceWrap2Input);
                    gbbPriceWrap2.append(gbbPriceWrap2Label);

                    gbbPriceTextWrap.append(gbbPriceWrap1);
                    gbbPriceTextWrap.append(gbbPriceWrap2);

                    gbbPriceFieldLower.on("input", (event) => {
                        lowerVal = parseInt(gbbPriceFieldLower[0].value);
                        upperVal = parseInt(gbbPriceFieldUpper[0].value);
                        if (lowerVal >= upperVal - 4) {
                            gbbPriceFieldUpper[0].value = lowerVal + 4;
                            if (upperVal == gbbPriceFieldUpper[0].max) {
                                gbbPriceFieldLower[0].value = parseInt(gbbPriceFieldUpper[0].max) - 4;
                            }
                        }
                        if (filterCategory?.minValue == lowerVal
                            && filterCategory?.maxValue == upperVal) {
                            gbb.utility.setActivatePriceFilters(noteAttribute, false);
                        } else {
                            gbb.utility.setActivatePriceFilters(noteAttribute, true);
                        }
                        gbbPriceWrap1Label.text(gbb.utility.getCurrencySymbol() + " " + event.target.value);
                        gbbPriceWrap2Label.text(gbb.utility.getCurrencySymbol() + " " + upperVal);
                        gbb.utility.setPriceFilterValues(noteAttribute, lowerVal, upperVal);
                    })

                    gbbPriceFieldLower.mouseup((event) => {
                        let filteredProducts = gbb.utility.getFilteredSortedProductsData(noteAttribute)
                        gbb.utility.toggleFiltersSideBar(noteAttribute);
                        setTimeout(() => {
                            gbb.$("body").find(".gbbProductsFiltersMainContainer").remove()
                        }, 500)
                    })

                    gbbPriceFieldUpper.on("input", (event) => {
                        lowerVal = parseInt(gbbPriceFieldLower[0].value);
                        upperVal = parseInt(gbbPriceFieldUpper[0].value);
                        if (upperVal < lowerVal + 4) {
                            gbbPriceFieldLower[0].value = upperVal - 4;
                            if (lowerVal == gbbPriceFieldLower[0].min) {
                                gbbPriceFieldUpper[0].value = 4;
                            }
                        }

                        if (filterCategory?.minValue == lowerVal && filterCategory?.maxValue == upperVal) {
                            gbb.utility.setActivatePriceFilters(noteAttribute, false);
                        } else {
                            gbb.utility.setActivatePriceFilters(noteAttribute, true);
                        }

                        gbbPriceWrap2Label.text(gbb.utility.getCurrencySymbol() + " " + event.target.value);
                        gbbPriceWrap1Label.text(gbb.utility.getCurrencySymbol() + " " + lowerVal);

                        gbb.utility.setPriceFilterValues(noteAttribute, lowerVal, upperVal);
                    })

                    gbbPriceFieldUpper.mouseup((event) => {
                        let filteredProducts = gbb.utility.getFilteredSortedProductsData(noteAttribute)
                        gbb.utility.toggleFiltersSideBar(noteAttribute);
                        setTimeout(() => {
                            gbb.$("body").find(".gbbProductsFiltersMainContainer").remove()
                        }, 500)
                    })


                    gbbFiltersDropDownWrapper.on("click", () => {
                        if (!showPriceFilter) {
                            gbb.$(".gbbFilterDropDownButton" + index).css("transform", "rotate(360deg)");
                            gbbFilterPriceContainer.show();
                        } else {
                            gbb.$(".gbbFilterDropDownButton" + index).css("transform", "rotate(180deg)");
                            gbbFilterPriceContainer.hide();
                        }
                        showPriceFilter = !showPriceFilter
                    })

                    gbbFilterPriceContainer.append(gbbPriceFieldContainer);
                    gbbFilterPriceContainer.append(gbbPriceTextWrap);

                    gbbFilterContainer.append(gbbFilterPriceContainer);
                    // if(isFilterTagsVisible) {
                    //     gbbFilterPriceContainer.show();
                    // } else {
                    //     gbbFilterPriceContainer.hide();
                    // }
                    // gbbFiltersDropDownWrapper.on("click",()=>{
                    //     if(isFilterTagsVisible) {
                    //         gbb.$(".gbbFilterDropDownButton"+index).css("transform", "rotate(180deg)");
                    //         gbbFilterTagsContainer.hide();
                    //     } else {
                    //         gbb.$(".gbbFilterDropDownButton"+index).css("transform", "rotate(360deg)");
                    //         gbbFilterTagsContainer.show();
                    //     }
                    //     isFilterTagsVisible = !isFilterTagsVisible;
                    // })

                } else {
                    let gbbFilterTagsContainer = gbb.$("<div>").addClass("gbbFilterTagsContainer").addClass("gbbFilterTagsContainer" + index);

                    filterCategory.tags.forEach((tag, tagIndex) => {
                        //add event listener to tagcontainer
                        let gbbProductsFilterTagContainer = gbb.$("<div>").addClass("gbbProductsFilterTagContainer");
                        let gbbProductsFilterTagCheckbox = gbb.$("<input>").addClass("gbbProductsFilterTagCheckbox").attr("type", "checkbox").attr("val", tag.value);
                        if (gbb.utility.getActivatedFilters(noteAttribute).findIndex(e => e.label == tag.label) != -1) {
                            gbbProductsFilterTagCheckbox.prop("checked", true);
                        }
                        const filterClicked = async () => {
                            gbb.gbbAddProductsPage.f.resetSearchTextValue()
                            if (gbb.utility.getActivatedFilters(noteAttribute).findIndex(e => e.label == tag.label) == -1) {
                                gbb.utility.setActivatedFilters(tag, noteAttribute, "add", filterCategory);
                            } else {
                                gbb.utility.setActivatedFilters(tag, noteAttribute, "remove", filterCategory);
                            }
                            // @ashfaq
                            let filteredProducts = await gbb.utility.getFilteredSortedProductsData(noteAttribute)

                            gbb.utility.toggleFiltersSideBar(noteAttribute);
                            // setTimeout(() => {
                            //     gbb.$("body").find(".gbbProductsFiltersMainContainer").remove()
                            // }, 500)
                        }
                        gbbProductsFilterTagCheckbox.on("click", (event) => {
                            // event.preventDefault();
                            // event.stopPropagation();
                            filterClicked()
                        })

                        let gbbProductsFilterTagLabel = gbb.$("<div>").addClass("gbbProductsFilterTagLabel").text(tag.label);

                        gbbProductsFilterTagLabel.on("click", (event) => {
                            event.preventDefault();
                            event.stopPropagation();
                            if (gbbProductsFilterTagCheckbox.prop("checked")) {
                                gbbProductsFilterTagCheckbox.prop("checked", false);
                            } else {
                                gbbProductsFilterTagCheckbox.prop("checked", true);
                            }
                            filterClicked()
                        })
                        gbbProductsFilterTagContainer.append(gbbProductsFilterTagCheckbox);
                        gbbProductsFilterTagContainer.append(gbbProductsFilterTagLabel);

                        gbbFilterTagsContainer.append(gbbProductsFilterTagContainer);
                    })

                    if (isFilterTagsVisible) {
                        gbbFilterTagsContainer.show();
                    } else {
                        gbbFilterTagsContainer.hide();
                    }
                    gbbFiltersDropDownWrapper.on("click", () => {
                        if (isFilterTagsVisible) {
                            gbb.$(".gbbFilterDropDownButton" + index).css("transform", "rotate(180deg)");
                            gbbFilterTagsContainer.hide();
                        } else {
                            gbb.$(".gbbFilterDropDownButton" + index).css("transform", "rotate(360deg)");
                            gbbFilterTagsContainer.show();
                        }
                        isFilterTagsVisible = !isFilterTagsVisible;
                    })
                    gbbFilterContainer.append(gbbFilterTagsContainer);
                }
                gbbProductsFiltersContainer.append(gbbFilterContainer);
            })
            gbbProductsFiltersMainContainer.append(gbbProductsFiltersContainer);
            return gbbProductsFiltersMainContainer;
        },
        renderProductsHTML: function (products, noteAttribute, category) {

            // products 
            products = JSON.parse(JSON.stringify(products))
            // products?.variants?.length>1 ?alert("multiple variants")
            const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()
            const gbbProductsContainer = gbb.$("<div>").addClass("gbbProductsContainer");
            const gbbProductsLabel = gbb.$("<p>").addClass("gbbProductsLabel");
            let gbbProductsItemsContainer = gbb.$("<div>").addClass("gbbProductsItemsContainer");
            const gbbProductsItemsArray = [];
            let addProductsPageArr = ADDPRODUCT_PAGES_LIST
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                gbbProductsLabel.text(gbb.utility.renderLanguageValue(gbb.settings.languageData.productPage.selectProductsLabel));
            } else if (noteAttribute == "reviewPage") {
                gbbProductsLabel.text(gbb.utility.renderLanguageValue(gbb.settings.languageData.reviewPage.addOnsLabel));
            }
            if (!products || products.length == 0) {
                if (noteAttribute == "reviewPage") { //no need to show no products label when on review page
                    return;
                }
                // else {
                //     const gbbProductsNotAvailable = gbb.$("<p>").addClass("gbbProductsNotAvailable");
                //     gbbProductsNotAvailable.text(gbb.utility.renderLanguageValue(gbb.settings.languageData.general.noProductsAvailable));

                //     //replace gbbProductsNotAvailable class if available
                //     if (gbb.$(".gbbProductsNotAvailable").length > 0) {
                //         gbb.$(".gbbProductsNotAvailable").replaceWith(gbbProductsNotAvailable);
                //     } else {
                //         gbbProductsItemsContainer.append(gbbProductsNotAvailable);
                //     }
                //     return gbbProductsContainer;
                // }  not in use @mufadal
            } else {
                // gbb.utility.debugConsole("Products here is", products)
                //  gbbProductsItemsContainer = gbb.$("<div>").addClass("gbbProductsItemsContainer");
                products = products?.filter((product) => {
                    return product.available == true;
                });

                products.forEach((product, index) => {
                    let currentProductPersonalization = gbb.utility.getCurrentProductPersonalization(product);
                    let doesThisProductHavePersonalization = currentProductPersonalization.isProductPersonalizationEnabled || false;

                    if (doesThisProductHavePersonalization) {
                        product.renderChooseOptionsButton_forcefully = true;
                    }


                    const gbbProductItem = gbb.$("<div>").addClass("gbbProductItem").clone();
                    gbbProductItem.css("background", gbb.settings.pageCustomizationData.productCard.productCardBgColor);
                    gbbProductItem.css("color", gbb.settings.pageCustomizationData.productCard.productCardTextColor);


                    const gbbProductTextContainer = gbb.$("<div>").addClass("gbbProductTextContainer");

                    const gbbProductDynamicContentContainer = gbb.$("<div>").addClass("gbbProductDynamicContentContainer");

                    gbbProductDynamicContentContainer.html(gbb.gbbAddProductsPage.f.renderProductDynamicContent(product,'PRODUCT_CARD'));

                    const gbbProductItemTitle = gbb.$("<div>").addClass("gbbProductItemTitle").css("cursor", "pointer");
                    const gbbProductActionContainer = gbb.$("<div>").addClass("gbbProductActionContainer");
                    const gbbProductReadMore = gbb.$("<div>").addClass("gbbProductReadMore").text("Read More >>");
                    const gbbProductItemPricesContainer = gbb.$("<div>").addClass("gbbProductItemPricesContainer");
                    const gbbProductItemPrice = gbb.$("<div>").addClass("gbbProductItemPrice");
                    const gbbProductItemCompareAtPrice = gbb.$("<div>").addClass("gbbProductItemCompareAtPrice");
                    const gbbProductButtonWrapper = gbb.$("<div>").addClass("gbbProductButtonWrapper");
                    // const gbbProductButton = gbb.$("<button>").addClass("gbbProductAddButton");
                    const gbbProductButton = gbb.$("<div>").addClass("gbbProductAddButton");

                    const gbbProductImageContainer = gbb.$("<div>").addClass("gbbProductImageContainer")
                    const gbbProductImage = gbb.$("<img>").addClass("gbbProductImage");
                    const gbbProductItemOverLay = gbb.$("<div>").addClass("gbbProductItemOverLay");
                    const gbbOverLayIconContainer = gbb.$("<div>").addClass("gbbOverLayIconContainer");

                    gbbProductItem.attr("productId", product?.id)
                    let firstvariantid = product.variants.length > 0 ? product?.variants[0]?.id : "";
                    gbbProductItem.attr("firstvariantid", firstvariantid);
                    if (product.customProductAttribute) {
                        gbbProductItem.attr('custom-product-attribute', product.customProductAttribute)
                    }
                    // gbb.utility.debugConsole("product details array", product.title, index)

                    for (let i = 0; i < product.images.length; i++) {
                        let image = product.images[i];
                        if (!image) {
                            continue;
                        }
                        if (image) {
                            gbbProductImageContainer.append(gbb.$("<img>").addClass('gbbProductImageContainerImg' + i).addClass("gbbProductImageContainerImg").addClass("gbbFade"))
                            gbbProductImageContainer.find('.gbbProductImageContainerImg' + i).attr('src', image).css('display', 'none')
                        }
                        if (i == 0) {
                            gbbProductImageContainer.find('.gbbProductImageContainerImg' + i).css('display', 'block').on("click", () => {
                                gbb.utility.debugConsole("triggering showProductVariantsModal from image click", product.title)
                                event.preventDefault();
                                event.stopPropagation();
                                gbb.f.showProductVariantsModal(product, gbbProductButton, noteAttribute, category)
                            })
                        }
                        if (image) {
                            break;
                        }
                    }
                    //push an anchor tag
                    if (product.images.length > 1) {
                        //let gbbProductSliderNavigatior = gbb.$("<div>").addClass('gbbProductSliderNavigatior')
                        gbbProductImageContainer.append(gbb.$("<a>").addClass('gbbPrevImage'))
                        gbbProductImageContainer.find('.gbbPrevImage').html("&#10094;");
                        //add an onclick event to the anchor tag
                        gbbProductImageContainer.append(gbb.$("<a>").addClass('gbbNextImage'))
                        gbbProductImageContainer.find('.gbbNextImage').html("&#10095;");

                        gbbProductImageContainer.find('.gbbPrevImage').click(function () {
                            gbb.utility.slider.plusSlides(gbbProductImageContainer, 1)
                        })
                        gbbProductImageContainer.find('.gbbNextImage').click(function () {
                            gbb.utility.slider.minusSlides(gbbProductImageContainer, 1)
                        })
                        //gbbProductImageContainer.append(gbbProductImageContainer);
                        //hide the arrows
                        gbbProductImageContainer.find('.gbbPrevImage').css("display", "none");
                        gbbProductImageContainer.find('.gbbNextImage').css("display", "none");
                    }

                    gbbProductImageContainer.append(gbb.f.renderTagsPillsHTML(product, noteAttribute, category));
                    gbbProductItem.append(gbbProductImageContainer);

                    // gbbProductItem.append(gbb.f.renderTagsPillsHTML(product, noteAttribute, category));


                    gbbProductItemTitle.on("click", () => {
                        gbb.f.showProductVariantsModal(product, gbbProductButton, noteAttribute, category)
                    })

                    gbbProductItemOverLay.on("click", () => {
                        gbb.f.showProductVariantsModal(product, gbbProductButton, noteAttribute, category)
                    })





                    // gbbProductReadMore.on("click",()=>{
                    //     gbb.f.showProductVariantsModal(product, gbbProductButton, noteAttribute, category)
                    // })
                    //gbbProductButton.css("background", gbb.settings.pageCustomizationData.productCard.productCardButtonColor);
                    //gbbProductButton.css("color", gbb.settings.pageCustomizationData.productCard.productCardButtonTextColor);

                   

                    let _productPrice = product.price
                    let _compareAtPrice = product.compare_at_price
                    if (isPurchaseTypeSubscription) {
                        _productPrice = gbb.gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId(product.variants[0].id);
                        _compareAtPrice = product.price
                    }
                    if (gbb.settings?.merchantInfo?.bundleSettings?.showCompareAtPrice == true && _compareAtPrice && (isPurchaseTypeSubscription || _compareAtPrice > product.price)) {
                        gbbProductItemCompareAtPrice.text(gbb.utility.formatPrice(_compareAtPrice));
                    }
                    gbbProductItemPrice.text(gbb.utility.formatPrice(_productPrice));
                    gbbProductItemPricesContainer.append(gbbProductItemCompareAtPrice);
                    gbbProductItemPricesContainer.append(gbbProductItemPrice);

                    if (product.variants?.length == 1 && product.available == true && product.renderChooseOptionsButton_forcefully != true) {
                        let argsObj = {
                            variantId: product.variants[0].id,
                            productData: product,
                        }
                        let uniqueItemKey = gbb.utility.getUniqueIdForVariant(argsObj);
                        // const isItemInCart = gbb.utility.checkIfItemPresentInGiftBoxCart(product.variants[0].id);
                        // gbb.utility.debugConsole("isItemInCart:", isItemInCart);
                        let data = {
                            productData: product,
                            variant: product.variants[0],
                            // _boxProduct: product?.properties["_boxProduct"],
                            // _Category: product?.properties["_Category"]
                        }
                        const isItemInCart = gbb.utility.checkIfItemPresentInGiftBoxCart(data?.variant?.id, { uniqueItemKey });
                        let typeOfProduct = "singleVariant";
                        //price of the first variant
                        let price = product.variants[0].price;
                        let compareAtPrice = product.variants[0]?.compare_at_price || null
                        compareAtPrice = compareAtPrice > price ? compareAtPrice : null;

                        if (isPurchaseTypeSubscription) {
                            price = gbb.gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId(product.variants[0].id);
                            compareAtPrice = product.variants[0].price
                        }
                        if (gbb?.settings?.merchantInfo?.bundleSettings?.showCompareAtPrice && compareAtPrice && (isPurchaseTypeSubscription || compareAtPrice > 0)) {
                            gbbProductItemCompareAtPrice.text(gbb.utility.formatPrice(compareAtPrice));
                        } else if (!compareAtPrice) {
                            gbbProductItemCompareAtPrice.text("");
                        }

                        
                        gbbProductItemPrice.text(gbb.utility.formatPrice(price));
                        if (isItemInCart) {
                            //activate quantity button
                            gbb.utility.activateQuantityButtons(gbbProductButton, data, noteAttribute, typeOfProduct, category);
                        } else {
                            gbb.utility.activateAddButton(gbbProductButton, data, noteAttribute, typeOfProduct, category);
                        }
                    } else if (product.renderChooseOptionsButton_forcefully == true || product.variants?.length > 1 && product.available == true) {
                        let variantProduct = gbb.utility.getTheVariantProductPresentInCart(product);
                        let data = {
                            productData: product,
                            variant: variantProduct
                        }
                        let typeOfProduct = "multipleVariants";
                        if (variantProduct && Object.keys(variantProduct).length > 0) {
                            let variantPrice = variantProduct.price
                            if (isPurchaseTypeSubscription) {
                                variantPrice = gbb.gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId(variantProduct.id);
                            }
                            gbb.utility.activateQuantityButtons(gbbProductButton, data, noteAttribute, typeOfProduct, category);
                            gbbProductItemPrice.text(gbb.utility.formatPrice(variantPrice));
                        } else {
                            gbb.utility.activateAddButton(gbbProductButton, data, noteAttribute, typeOfProduct, category);
                        }

                    } else {
                    }

                    // if(product.variants.length == 1 ){
                    //     // gbbProductItemTitle.text(`${product.variants[0].title} (${product?.options[0]?.name})`);
                    //     gbbProductItemTitle.text(`${product.variants[0].title}`);
                    // }else{
                    //     gbbProductItemTitle.text(product.title);
                    // }
                    let gbbProductTitleOnly = gbb.$("<div>").addClass("gbbProductTitleOnly").text(product.title)
                    let gbbVariantTitle = gbb.$("<div>").addClass("gbbVariantTitle").text(product?.variantName);
                    let divsForTitle = [];
                    divsForTitle.push(gbbProductTitleOnly);
                    divsForTitle.push(gbbVariantTitle);

                    gbbProductItemOverLay.append(gbbOverLayIconContainer)
                    // gbbProductItemTitle.text(product.title);
                    gbbProductItemTitle.html(divsForTitle);

                    gbbProductTextContainer.append(gbbProductItemTitle);
                    gbbProductButtonWrapper.append(gbbProductButton);
                    gbbProductActionContainer.append(gbbProductItemPricesContainer);
                    gbbProductActionContainer.append(gbbProductButtonWrapper);
                    gbbProductImageContainer.append(gbbProductItemOverLay);

                    gbbProductItem.append(gbbProductTextContainer);
                    if (gbb.settings?.app?.integrations?.judgeme?.isEnabled) {
                        let starsHTML = gbb.gbbIntegrations?.judgeme?.f?.getStarsHTMLByProductId(product.id);
                        if (starsHTML) {
                            let reviewStarsContainer = gbb.$("<div>").addClass("gbbReviewStarsContainer");
                            let reviewStars = gbb.$("<div>").addClass("gbbReviewStars");
                            reviewStars.html(starsHTML);
                            reviewStarsContainer.append(reviewStars);
                            let appendTo = gbb.$('.gbbProductsCardLayoutV2').length > 0 ? gbbProductItem : gbbProductTextContainer;
                            appendTo.append(reviewStarsContainer);
                        }
                    }
                    if (gbb.settings.bundleSettings?.metafieldNameSpaceAndKeys.length > 0 || gbb.settings.app?.dynamicScriptForHTMLContent) {
                        gbbProductItem.append(gbbProductDynamicContentContainer)
                    }
                    gbbProductItem.append(gbbProductActionContainer);
                    // gbbProductItem.append(gbbProductReadMore);

                    if (isPurchaseTypeSubscription && gbb.gbbSubscriptionProductsPage.state.showDiscountOnProductCards) {
                        const discountRibbon = gbb.gbbSubscriptionProductsPage.f.prepareSubscriptionProductDiscountRibbonUI(product.variants[0])
                        if (discountRibbon) {
                            gbbProductItem.append(discountRibbon)
                        }
                    }
                    if (gbb.state.currentPageId == "personalizationPage" && gbb.gbbAddonProducts.state.isEnabled) {
                        let {type,value,discountText:addonsDiscountRibbonContent} = gbb.gbbAddonProducts.f.prepareDiscountRibbonContentForProductAddons()
                        if (addonsDiscountRibbonContent) {
                            let isFreeProduct = value == 100 // in future for discountType based on amount calculate product price and discounted price for calculatng isFreeProduct
                            if (isFreeProduct) {
                                gbbProductItem.attr("free-addon-product",true)
                            }
                            let ribbonUIOptions = {
                                ribbonContent: addonsDiscountRibbonContent,
                                ribbonClassName: "gbbAddonDiscountRibbon",
                            }
                            let addonDiscountsRibbonHTML = gbb.utility.prepareProductCardRibbonUI(ribbonUIOptions)
                            gbbProductItem.append(addonDiscountsRibbonHTML)
                        }
                    }
                    gbbProductsItemsContainer.append(gbbProductItem);
                    gbbProductsItemsArray.push(gbbProductItem);
                })


                //in gbbProductItemsArray, just figure out the -15 index and loadMoreIndicator as the tag
                let totalNumberOfItemsInArray = gbbProductsItemsArray.length;
                let loadMoreIndicatorItem;

                //attach loadMoreIndicator in the 70% of the array
                if (totalNumberOfItemsInArray > 0) {
                    let indexToAttachLoadMoreIndicator = Math.floor(totalNumberOfItemsInArray * 0.7);
                    loadMoreIndicatorItem = gbbProductsItemsArray[indexToAttachLoadMoreIndicator];
                    //add the data attribute to the loadMoreIndicatorItem
                    loadMoreIndicatorItem.attr("data-load-more-indicator-status", "active");
                }

                //gbbProductsContainer.append(gbbProductsLabel);
                // gbbProductsContainer.append(gbbProductsItemsContainer);
                // gbb.gbbAddProductsPage.f.hideExcessProducts(gbbProductsContainer);
                return gbbProductsItemsArray;
                // return gbbProductsItemsContainer;
            }
        },

        renderFooterButtons: function (noteAttribute, gbbFooterNextButton, renderNewTemplateDesign = false) {

            const gbbFooterButtonsWrapper = gbb.$("<div>").addClass("gbbFooterButtonsWrapper");
            if (renderNewTemplateDesign || gbb.f.getPreviousNavigationItem()) {
                // const gbbFooterBackButton = gbb.$("<button>").addClass("gbbFooterBackButton");
                const gbbFooterBackButton = gbb.$("<div>").addClass("gbbFooterBackButton");
                gbbFooterBackButton.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.general.backButtonText));
                gbbFooterBackButton.css("background", gbb.settings.pageCustomizationData.cartFooter.cartFooterBackButtonColor);
                gbbFooterBackButton.css("color", gbb.settings.pageCustomizationData.cartFooter.cartFooterBackButtonTextColor);
                if (renderNewTemplateDesign && !gbb.f.getPreviousNavigationItem()) {
                    //disable the button
                    gbbFooterBackButton.addClass("gbbDisabled");
                }
                gbbFooterBackButton.on("click", function () {
                    gbb.utility.renderTemporaryLoadingSpinner("show")
                    gbb.giftboxbuilderPage.action.onPrevNavigationBYOB();
                    //add the gbbDisabled class to button
                    gbb.utility.disableElement(gbbFooterBackButton, 1000);
                    gbb.gbbBrowser.emitCustomEvent({
                        eventName: "gbb-back-button-click",
                        attachEventTo: gbbFooterBackButton[0]
                    })
                })
                gbbFooterButtonsWrapper.append(gbbFooterBackButton);
            }
            if (renderNewTemplateDesign) {
                gbbFooterButtonsWrapper.append(gbb.f.renderFooterTotalContainer());
            }
            // const gbbFooterNextButton = gbb.$("<button>").addClass("gbbFooterNextButton");
            //gbbFooterNextButton = gbb.$("<div>").addClass("gbbFooterNextButton");
            gbbFooterNextButton.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.general.nextButtonText));
            gbbFooterNextButton.css("background", gbb.settings.pageCustomizationData.cartFooter.cartFooterNextButtonColor);
            gbbFooterNextButton.css("color", gbb.settings.pageCustomizationData.cartFooter.cartFooterNextButtonTextColor);
            gbbFooterNextButton.on("click", async function () {
                await gbb.utility.checkConditionsAndProceedToNextPage(noteAttribute, gbbFooterNextButton);
                gbb.gbbBrowser.emitCustomEvent({
                    eventName: "gbb-next-button-click",
                    attachEventTo: gbbFooterNextButton[0]
                })
            })
            gbbFooterButtonsWrapper.append(gbbFooterNextButton);
            return gbbFooterButtonsWrapper;
        },

        renderCartProductsFooterHTMLForMobile: function (noteAttribute, gbbProductsFooterHTML, gbbPageFooterHTML, updateFooterFlow) {
            let renderAddonsMessaging  = gbb.gbbAddonProducts.f.checkIfAddonsMessagingNeeded()
            let renderNewTemplateDesign = gbb.$('.gbbProductsCardLayoutV2').length > 0
            let renderProductSlotsFooter = gbb.settings.stepsConfigurationData?.isProductSlotsEnabled && gbb.gbbAddProductsPage?.state?.isEveryConditionHaveTypeQuantity;
            const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()

            gbbProductsFooterHTML.css("grid-template-columns", "1fr");
            gbbProductsFooterHTML.addClass("gbbProductsFooterHTMLForMobile")
            let _boxData = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
            let products = _boxData?.items || [];
            let gbbViewProductsLabelAndTotalContainer = gbb.$("<div>").addClass("gbbViewProductsLabelAndTotalContainer");

            const gbbFooterTotalContainer = gbb.f.renderFooterTotalContainer();

            let gbbViewCartProductsLink = gbb.$("<div>").addClass("gbbViewCartProductsLink");
            gbbViewCartProductsLink.text(gbb?.settings?.languageData?.general?.viewCartProductsLabel?.value || "View Selected Products");
            gbbViewCartProductsLink.append(" ").append(`(${_boxData.item_count})`)
            gbbViewCartProductsLink.on("click", () => {
                gbb.f.renderCartProductsModal(noteAttribute);
            })

            gbbViewProductsLabelAndTotalContainer.append(gbbViewCartProductsLink);
            gbbViewProductsLabelAndTotalContainer.append(gbbFooterTotalContainer);

            let gbbFooterNextButton = gbb.$("<div>").addClass("gbbFooterNextButton");
            const gbbFooterButtonsWrapper = gbb.f.renderFooterButtons(noteAttribute, gbbFooterNextButton, renderNewTemplateDesign);
            let gbbFooterButtonsContainer = gbb.$(`<div>`).addClass('gbbFooterButtonsContainer')
            const gbbFooterProductsContainer = gbb.$("<div>").addClass("gbbFooterProductsContainer");
            if (renderNewTemplateDesign) {
                if (products.length == 0) {
                    gbb.$('body').css("overflow-y", DEFAULT_BODY_OVERFLOW_VALUE)
                    gbb.gbbAddProductsPage.state.showBoxProductsInFooter = false;
                }// reset drawer values
                products.forEach((product) => {
                    const gbbFooterProductContainer = gbb.$("<div>").addClass("gbbFooterProductContainer");
                    // gbb.utility.debugConsole("product:", product)
                    //attach a data attriute to the product container
                    gbbFooterProductContainer.attr("productId", product?.product_id);
                    gbbFooterProductContainer.attr("variantId", product?.variant_id)

                    gbbFooterProductContainer.attr("_boxProduct", product?.properties["_boxProduct"]);
                    gbbFooterProductContainer.attr("_Category", product?.properties["_Category"]);

                    let argsObj = {
                        variantId: product.variant_id,
                        productData: product,
                    }


                    let uniqueGbbItemKey = gbb.utility.getUniqueIdForVariant(argsObj)
                    gbbFooterProductContainer.attr("_uniqueGbbItemKey", uniqueGbbItemKey);




                    const gbbFooterProductImageContainer = gbb.$("<div>").addClass("gbbFooterProductImageContainer");
                    const gbbFooterProductImage = gbb.$("<img>").addClass("gbbFooterProductImage");
                    gbbFooterProductImage.attr("src", product.image);
                    const gbbFooterProductTextContainer = gbb.$("<div>").addClass("gbbFooterProductTextContainer");
                    const gbbFooterProductTitle = gbb.$("<div>").addClass("gbbFooterProductTitle");
                    const gbbFooterProductQtyPriceContainer = gbb.$("<div>").addClass("gbbFooterProductQtyPriceContainer");
                    const gbbFooterProductPrice = gbb.$("<div>").addClass("gbbFooterProductPrice");
                    const gbbFooterProductQuantity = gbb.$("<div>").addClass("gbbFooterProductQuantity");


                    //a button to remove the product from the cart
                    const gbbFooterProductRemoveButton = gbb.$("<div>").addClass("gbbFooterProductRemoveButton");
                    // x icon for the remove button
                    const gbbFooterProductRemoveButtonIcon = gbb.$("<div>").addClass("gbbFooterProductRemoveButtonIcon");


                    // gbbFooterProductRemoveButtonIcon.css("color", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconTextColor);
                    // gbbFooterProductRemoveButton.css("background", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconBgColor)
                    gbbFooterProductRemoveButtonIcon.append(CONSTANT_CLOSE_ICON_SVG);
                    gbbFooterProductRemoveButton.append(gbbFooterProductRemoveButtonIcon)
                    gbbFooterProductRemoveButton.on("click", async () => {
                        //    await gbb.f.removeProductFromCart({id: product.variant_id});
                        let variant = {
                            id: product.variant_id,
                            _boxProduct: product?.properties["_boxProduct"],
                            _Category: product?.properties["_Category"],
                            _uniqueGbbItemKey: uniqueGbbItemKey
                            // _uniqueGbbItemKey : gbbFooterProductContainer.attr("_uniqueGbbItemKey")
                        }
                        if (gbb.settings.giftMessage.messageProduct && gbb.settings.giftMessage.messageProduct.product && gbb.settings.giftMessage.messageProduct.product.variants) {
                            const variantIdForMessage = gbb.settings.giftMessage.messageProduct.product.variants[0].id;
                            if (variantIdForMessage == product.variant_id) {
                                gbb.gbbPersonalizePage.state.customerUploadsResponse = {};
                            }
                        }
                        await gbb.utility.removeFromCart({ variant: variant });
                        gbb.gbbAddProductsPage.f.updateProductCard(product.product_id, variant.id);
                        gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
                    })

                    gbbFooterProductTitle.text(product.title);
                    let _productPrice = product.price
                    if (isPurchaseTypeSubscription) {
                        _productPrice = gbb.gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId(product?.variant_id);
                    }
                    gbbFooterProductPrice.text(gbb.utility.formatPrice(_productPrice));
                    gbbFooterProductQuantity.text("x" + product.quantity);
                    gbbFooterProductImageContainer.append(gbbFooterProductImage);

                    gbbFooterProductTextContainer.append(gbbFooterProductTitle);
                    gbbFooterProductQtyPriceContainer.append(gbbFooterProductPrice);
                    gbbFooterProductQtyPriceContainer.append(gbbFooterProductQuantity);
                    gbbFooterProductTextContainer.append(gbbFooterProductQtyPriceContainer);

                    let pageIdTheProductWasAddedFrom = product?.properties["_boxProduct"]
                    // @ashfaq append commented
                    if (gbb.utility.checkIfRemoveButtonShouldBeAppended(product?.variant_id, pageIdTheProductWasAddedFrom)) {
                        gbbFooterProductContainer.append(gbbFooterProductRemoveButton);
                    }

                    gbbFooterProductContainer.append(gbbFooterProductImageContainer);
                    gbbFooterProductContainer.append(gbbFooterProductTextContainer);
                    gbbFooterProductsContainer.append(gbbFooterProductContainer);
                })
                let displayValue = gbb.gbbAddProductsPage.state.showBoxProductsInFooter ? 'grid' : 'none'
                gbbFooterButtonsContainer.css("background", gbb.settings.pageCustomizationData?.cartFooter?.cartFooterButtonsContainerBgColor || '#f6f6f6')
                gbbFooterButtonsContainer.append(gbbFooterButtonsWrapper);
                gbbFooterProductsContainer.css('display', displayValue)
                gbbProductsFooterHTML.append(gbbFooterProductsContainer);
                if (gbbPageFooterHTML.find('.gbbDiscountFooterHTML').length <= 0) {
                    gbbPageFooterHTML.append(gbb.gbbAddProductsPage.f.renderShowBoxProductsInFooterHTML())
                } // if discount is not enable then will show selected products
            }
            else if (products.length > 0) {
                gbbProductsFooterHTML.append(gbbViewProductsLabelAndTotalContainer);
            }
            let footerButtonsContainerForMobile = renderNewTemplateDesign ? gbbFooterButtonsContainer : gbbFooterButtonsWrapper
            if (renderProductSlotsFooter) {
                let gbbSlotFooterProductsContainer = gbb.f.renderProductSlotsFooterHTML(noteAttribute);
                let isDrawerOpen = gbb.gbbAddProductsPage?.state?.showBoxProductsInFooter || false
                if (isDrawerOpen) {
                    gbbSlotFooterProductsContainer.css("display", "none")
                }

                if (updateFooterFlow == "updateFooterWithoutAppending" && gbb.$(".gbbSlotFooterProductsContainerWrapper").length > 0) {
                    if (!isDrawerOpen && products?.length == 0 && !gbb.$(".gbbSlotFooterProductsContainer").is(":visible")) {
                        gbb.$(".gbbSlotFooterProductsContainerWrapper").slideDown(100)
                    }
                    let productsContainer = gbbSlotFooterProductsContainer.find(".gbbSlotFooterProductContainer")
                    gbb.$(".gbbSlotFooterProductsContainer").html(productsContainer)
                    gbb.$(".gbbFooterProductsContainer").replaceWith(gbbFooterProductsContainer)
                    gbb.gbbAddProductsPage.f.autoScrollSlots()
                    gbb.$(".gbbFooterButtonsWrapper").replaceWith(gbbFooterButtonsWrapper)
                    gbb.$(".gbbCartIconWithQuantityContainer").html(gbb.gbbAddProductsPage.f.renderCartIconWithQuantityHTML())
                    let gbbPageFooterHTML = gbb.$(".gbbPageFooterHTML")
                    if (renderAddonsMessaging || gbb.settings?.discountsData?.isDiscountEnabled && gbb.settings?.discountsData?.isShowDiscountsEnabled && gbb.settings?.discountsData?.rules?.length > 0) {
                        let discountFooterHTML = gbb.gbbDiscountComponent.f.discountStatusFooterHTML()
                        discountFooterHTML.find(".gbbDiscountMessageContainer").on("click", gbb.gbbAddProductsPage.f.toggleBoxProductsDisplayFooter)
                        gbb.$(".gbbDiscountFooterHTML").html(discountFooterHTML)
                    }
                    // gbbPageFooterHTML.find(".gbbDiscountMessageContainer").on("click", gbb.gbbAddProductsPage.f.toggleBoxProductsDisplayFooter)
                    return gbbPageFooterHTML
                } else {
                    gbbProductsFooterHTML.append(gbbSlotFooterProductsContainer);
                }
            }
            gbbProductsFooterHTML.append(footerButtonsContainerForMobile);
            gbbPageFooterHTML.append(gbbProductsFooterHTML);
            if (renderNewTemplateDesign) {
                let gbbCartIconWithQuantityContainer = gbb.gbbAddProductsPage.f.renderCartIconWithQuantityHTML()

                gbbCartIconWithQuantityContainer.click(gbb.gbbAddProductsPage.f.toggleBoxProductsDisplayFooter)

                gbbPageFooterHTML.append(gbbCartIconWithQuantityContainer)
                gbbPageFooterHTML.find(".gbbDiscountMessageContainer").on("click", gbb.gbbAddProductsPage.f.toggleBoxProductsDisplayFooter)
            }
            if (gbb.utility.checkIfBrandingShouldBeVisible()) {
                gbbPageFooterHTML.append(gbb.utility.renderPoweredByLabel());
            }
            return gbbPageFooterHTML;
        },
        renderFooterTotalContainer: function () {
            const gbbFooterTotalContainer = gbb.$("<div>").addClass("gbbFooterTotalContainer");
            let totalLabelTextColor = gbb.settings.pageCustomizationData.cartFooter.cartFooterTotalLabelColor || gbb.settings.pageCustomizationData.cartFooter.cartFooterTextColor;
            const gbbFooterTotalLabel = gbb.$("<div>").addClass("gbbFooterTotalLabel").css("color", totalLabelTextColor)
            const gbbFooterTotalValueContainer = gbb.$("<div>").addClass("gbbFooterTotalValueContainer").css("color", gbb.settings.pageCustomizationData?.cartFooter?.cartFooterTextColor)

            // const gbbFooterOriginalTotalValue = gbb.$("<div>").addClass("gbbFooterOriginalTotalValue").css("color", "#625f5f");
            const gbbFooterOriginalTotalValue = gbb.$("<div>").addClass("gbbFooterOriginalTotalValue").addClass("gbbFooterOriginalTotalValue")
            gbbFooterTotalLabel.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.reviewPage.totalLabel) || "Total");
            gbbFooterOriginalTotalValue.append(gbb.utility.getGiftBoxProductsTotalWithCurrency());

            const gbbFooterDiscountedTotalValue = gbb.$("<div>");
            let finalPriceFontColor = gbb.settings.pageCustomizationData?.cartFooter?.cartFooterFinalPriceFontColor || gbb.settings.pageCustomizationData?.cartFooter?.cartFooterTextColor;
            if (gbb.settings?.discountsData?.isDiscountEnabled && gbb.settings?.discountsData?.isShowDiscountsEnabled) {
                gbbFooterDiscountedTotalValue.addClass("gbbFooterDiscountedTotalValue").css("color", finalPriceFontColor)
            } else {
                gbbFooterDiscountedTotalValue.addClass("gbbFooterTotalValue").css("color", finalPriceFontColor)
            }
            gbbFooterTotalLabel.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.reviewPage.totalLabel) || "Total");

            let originalTotal = gbb.state.giftBoxCartData
            // originalTotal = parseInt(originalTotal.total_price / 100);
            originalTotal = parseFloat(originalTotal.total_price / 100);

            let discountedTotal = gbb.utility.getGiftBoxProductsDiscountedTotal();
            let formattedDiscountedPrice = gbb.utility.getGiftBoxProductsTotalWithCurrency();

            if (gbb.settings?.discountsData?.isDiscountEnabled && gbb.settings?.discountsData?.isShowDiscountsEnabled && gbb.utility.getGiftBoxProductsDiscountedTotal() != originalTotal) {
                discountedTotal = gbb.utility.getGiftBoxProductsDiscountedTotal();
                // formattedDiscountedPrice = gbb.utility.getCurrencySymbol() + "" + parseFloat(discountedTotal).toFixed(2);
                let discountedTotalInShopifyFormat = discountedTotal * 100;
                formattedDiscountedPrice = gbb.utility.formatPrice(discountedTotalInShopifyFormat)
                gbbFooterTotalValueContainer.append(gbbFooterOriginalTotalValue);
            }
            gbbFooterDiscountedTotalValue.append(formattedDiscountedPrice);

            gbbFooterTotalValueContainer.append(gbbFooterDiscountedTotalValue)

            gbbFooterTotalContainer.append(gbbFooterTotalLabel);
            gbbFooterTotalContainer.append(gbbFooterTotalValueContainer);
            return gbbFooterTotalContainer;
        },
        renderProductSlotsFooterHTML: function (noteAttribute) {
            try {
                let gbbSlotFooterProductsContainerWrapper = gbb.$("<div>").addClass("gbbSlotFooterProductsContainerWrapper");
                let gbbSlotFooterProductsContainer = gbb.$("<div>").addClass("gbbSlotFooterProductsContainer");
                let totalNoOfSlotsRequired = gbb.gbbAddProductsPage?.state?.totalProductSlotsRequired || 0;
                let boxData = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
                let boxProducts = boxData?.items || [];
                boxProducts.forEach((product) => {
                    let gbbSlotFooterProductContainer = gbb.$("<div>").addClass("gbbSlotFooterProductContainer");
                    gbbSlotFooterProductContainer.attr("productId", product?.product_id);
                    gbbSlotFooterProductContainer.attr("variantId", product?.variant_id)

                    gbbSlotFooterProductContainer.attr("_boxProduct", product?.properties["_boxProduct"]);
                    gbbSlotFooterProductContainer.attr("_Category", product?.properties["_Category"]);

                    let argsObj = {
                        variantId: product.variant_id,
                        productData: product,
                    }

                    let uniqueGbbItemKey = gbb.utility.getUniqueIdForVariant(argsObj)
                    gbbSlotFooterProductContainer.attr("_uniqueGbbItemKey", uniqueGbbItemKey);

                    const gbbSlotFooterProductImageContainer = gbb.$("<div>").addClass("gbbSlotFooterProductImageContainer");
                    const gbbSlotFooterProductImage = gbb.$("<img>").addClass("gbbSlotFooterProductImage");
                    gbbSlotFooterProductImage.attr("src", product.image);

                    //a button to remove the product from the cart
                    const gbbSlotFooterProductRemoveButton = gbb.$("<div>").addClass("gbbSlotFooterProductRemoveButton");
                    // x icon for the remove button
                    const gbbSlotFooterProductRemoveButtonIcon = gbb.$("<div>").addClass("gbbSlotFooterProductRemoveButtonIcon");

                    const gbbSlotFooterProductQuantity = gbb.$("<div>").addClass("gbbSlotFooterProductQuantity");
                    gbbSlotFooterProductQuantity.text("x" + product.quantity);
                    gbbSlotFooterProductRemoveButtonIcon.append(CONSTANT_CLOSE_ICON_SVG);
                    gbbSlotFooterProductRemoveButton.append(gbbSlotFooterProductRemoveButtonIcon)
                    gbbSlotFooterProductRemoveButton.on("click", async () => {
                        //    await gbb.f.removeProductFromCart({id: product.variant_id});
                        let variant = {
                            id: product.variant_id,
                            _boxProduct: product?.properties["_boxProduct"],
                            _Category: product?.properties["_Category"],
                            _uniqueGbbItemKey: uniqueGbbItemKey
                            // _uniqueGbbItemKey : gbbSlotFooterProductContainer.attr("_uniqueGbbItemKey")
                        }
                        if (gbb.settings.giftMessage.messageProduct && gbb.settings.giftMessage.messageProduct.product && gbb.settings.giftMessage.messageProduct.product.variants) {
                            const variantIdForMessage = gbb.settings.giftMessage.messageProduct.product.variants[0].id;
                            if (variantIdForMessage == product.variant_id) {
                                gbb.gbbPersonalizePage.state.customerUploadsResponse = {};
                            }
                        }
                        await gbb.utility.removeFromCart({ variant: variant });
                        gbb.gbbAddProductsPage.f.updateProductCard(product.product_id, variant.id);
                        gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
                    })

                    gbbSlotFooterProductImageContainer.append(gbbSlotFooterProductImage);

                    let pageIdTheProductWasAddedFrom = product?.properties["_boxProduct"]
                    if (gbb.utility.checkIfRemoveButtonShouldBeAppended(product?.variant_id, pageIdTheProductWasAddedFrom)) {
                        gbbSlotFooterProductContainer.append(gbbSlotFooterProductRemoveButton);
                    }

                    gbbSlotFooterProductContainer.append(gbbSlotFooterProductImageContainer);
                    if (product.quantity > 1) {
                        gbbSlotFooterProductContainer.append(gbbSlotFooterProductQuantity);
                    }
                    gbbSlotFooterProductsContainer.append(gbbSlotFooterProductContainer);
                })

                // render empty slots 
                let totalItemCount = boxData?.item_count || 0;
                for (let startIdx = totalItemCount; startIdx < totalNoOfSlotsRequired; startIdx++) {
                    let gbbSlotFooterProductContainer = gbb.$("<div>").addClass("gbbSlotFooterProductContainer");
                    gbbSlotFooterProductContainer.addClass("gbbSlotFooterProductContainerEmpty");
                    gbbSlotFooterProductContainer.text(`${startIdx + 1}`);
                    gbbSlotFooterProductsContainer.append(gbbSlotFooterProductContainer);
                }
                gbbSlotFooterProductsContainerWrapper.append(gbbSlotFooterProductsContainer);
                return gbbSlotFooterProductsContainerWrapper;
            } catch (error) {
                gbb.utility.debugConsole("error in renderProductSlotsFooterHTML:", error);
            }
        },
        renderCartProductsFooterHTML: function (noteAttribute, options) {
            try {
                let updateFooterFlow = options?.flow
                let renderProductSlotsFooter = gbb.settings.stepsConfigurationData?.isProductSlotsEnabled && gbb.gbbAddProductsPage?.state?.isEveryConditionHaveTypeQuantity;
                const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()
                const renderAddonsMessaging = gbb.gbbAddonProducts.f.checkIfAddonsMessagingNeeded()
                const renderNewTemplateDesign = gbb.$('.gbbProductsCardLayoutV2').length > 0
                //gbb.state.cartData = await gbb.utility.getCart();
                let gbbPageFooterHTML = gbb.$("<div>").addClass("gbbPageFooterHTML");

                let gbbBoxIdContainer = gbb.$("<div>").addClass("gbbPageFooterHTML");
                //gbbBoxIdContainer.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.reviewPage?.boxNumberLabel) || "Box Number:").append(gbb.state?.activeBoxId?.split("box")[1]|| 1);
                //gbbPageFooterHTML.append(gbbBoxIdContainer);

                let gbbProductsFooterHTML;
                gbbProductsFooterHTML = gbb.$("<div>").addClass("gbbProductsFooterHTML");

                gbbProductsFooterHTML.css("background", gbb.settings.pageCustomizationData.cartFooter.cartFooterBgColor)
                gbbProductsFooterHTML.css("color", gbb.settings.pageCustomizationData.cartFooter.cartFooterTextColor)

                if (renderAddonsMessaging || gbb.settings?.discountsData?.isDiscountEnabled && gbb.settings?.discountsData?.isShowDiscountsEnabled && gbb.settings?.discountsData?.rules?.length > 0) {
                    gbbPageFooterHTML.append(gbb.gbbDiscountComponent.f.discountStatusFooterHTML())
                }

                if (window.innerWidth < 600) {
                    return gbb.f.renderCartProductsFooterHTMLForMobile(noteAttribute, gbbProductsFooterHTML, gbbPageFooterHTML, updateFooterFlow);
                }
                const gbbFooterProductsContainer = gbb.$("<div>").addClass("gbbFooterProductsContainer");
                let gbbFooterTotalContainer = gbb.$("<div>");
                let products = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
                products = products?.items || [];
                // products = products?.item_count
                products.forEach((product) => {
                    const gbbFooterProductContainer = gbb.$("<div>").addClass("gbbFooterProductContainer");
                    // gbb.utility.debugConsole("product:", product)
                    //attach a data attriute to the product container
                    gbbFooterProductContainer.attr("productId", product?.product_id);
                    gbbFooterProductContainer.attr("variantId", product?.variant_id)

                    gbbFooterProductContainer.attr("_boxProduct", product?.properties["_boxProduct"]);
                    gbbFooterProductContainer.attr("_Category", product?.properties["_Category"]);

                    let argsObj = {
                        variantId: product.variant_id,
                        productData: product,
                    }


                    let uniqueGbbItemKey = gbb.utility.getUniqueIdForVariant(argsObj)
                    gbbFooterProductContainer.attr("_uniqueGbbItemKey", uniqueGbbItemKey);




                    const gbbFooterProductImageContainer = gbb.$("<div>").addClass("gbbFooterProductImageContainer");
                    const gbbFooterProductImage = gbb.$("<img>").addClass("gbbFooterProductImage");
                    gbbFooterProductImage.attr("src", product.image);
                    const gbbFooterProductTextContainer = gbb.$("<div>").addClass("gbbFooterProductTextContainer");
                    const gbbFooterProductTitle = gbb.$("<div>").addClass("gbbFooterProductTitle");
                    const gbbFooterProductQtyPriceContainer = gbb.$("<div>").addClass("gbbFooterProductQtyPriceContainer");
                    const gbbFooterProductPrice = gbb.$("<div>").addClass("gbbFooterProductPrice");
                    const gbbFooterProductQuantity = gbb.$("<div>").addClass("gbbFooterProductQuantity");


                    //a button to remove the product from the cart
                    const gbbFooterProductRemoveButton = gbb.$("<div>").addClass("gbbFooterProductRemoveButton");
                    // x icon for the remove button
                    const gbbFooterProductRemoveButtonIcon = gbb.$("<div>").addClass("gbbFooterProductRemoveButtonIcon");


                    // gbbFooterProductRemoveButtonIcon.css("color", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconTextColor);
                    // gbbFooterProductRemoveButton.css("background", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconBgColor)
                    gbbFooterProductRemoveButtonIcon.append(CONSTANT_CLOSE_ICON_SVG);
                    gbbFooterProductRemoveButton.append(gbbFooterProductRemoveButtonIcon)
                    gbbFooterProductRemoveButton.on("click", async () => {
                        //    await gbb.f.removeProductFromCart({id: product.variant_id});
                        let variant = {
                            id: product.variant_id,
                            _boxProduct: product?.properties["_boxProduct"],
                            _Category: product?.properties["_Category"],
                            _uniqueGbbItemKey: uniqueGbbItemKey
                            // _uniqueGbbItemKey : gbbFooterProductContainer.attr("_uniqueGbbItemKey")
                        }
                        if (gbb.settings.giftMessage.messageProduct && gbb.settings.giftMessage.messageProduct.product && gbb.settings.giftMessage.messageProduct.product.variants) {
                            const variantIdForMessage = gbb.settings.giftMessage.messageProduct.product.variants[0].id;
                            if (variantIdForMessage == product.variant_id) {
                                gbb.gbbPersonalizePage.state.customerUploadsResponse = {};
                            }
                        }
                        await gbb.utility.removeFromCart({ variant: variant });
                        gbb.gbbAddProductsPage.f.updateProductCard(product.product_id, variant.id);
                        gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
                    })

                    gbbFooterProductTitle.text(product.title);
                    let _productPrice = product.price;
                    if (isPurchaseTypeSubscription) {
                        _productPrice = gbb.gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId(product?.variant_id)
                    }
                    gbbFooterProductPrice.text(gbb.utility.formatPrice(_productPrice));
                    gbbFooterProductQuantity.text("x" + product.quantity);
                    gbbFooterProductImageContainer.append(gbbFooterProductImage);

                    gbbFooterProductTextContainer.append(gbbFooterProductTitle);
                    gbbFooterProductQtyPriceContainer.append(gbbFooterProductPrice);
                    gbbFooterProductQtyPriceContainer.append(gbbFooterProductQuantity);
                    gbbFooterProductTextContainer.append(gbbFooterProductQtyPriceContainer);

                    let pageIdTheProductWasAddedFrom = product?.properties["_boxProduct"]
                    // @ashfaq append commented
                    if (gbb.utility.checkIfRemoveButtonShouldBeAppended(product?.variant_id, pageIdTheProductWasAddedFrom)) {
                        gbbFooterProductContainer.append(gbbFooterProductRemoveButton);
                    }

                    gbbFooterProductContainer.append(gbbFooterProductImageContainer);
                    gbbFooterProductContainer.append(gbbFooterProductTextContainer);
                    gbbFooterProductsContainer.append(gbbFooterProductContainer);
                })
                let gbbFooterNextButton = gbb.$("<div>").addClass("gbbFooterNextButton");
                const gbbFooterButtonsWrapper = gbb.f.renderFooterButtons(noteAttribute, gbbFooterNextButton, renderNewTemplateDesign); // passing renderNewTemplateDesign to change the layout of footer vuttons

                if (renderNewTemplateDesign) {
                    // let displayValue = gbb.gbbAddProductsPage.state.showBoxProductsInFooter ? 'grid' : 'none'
                    // gbbFooterProductsContainer.css('display', displayValue)
                    // for every re-render we checking do we need to keep the secion open or closed
                    gbbFooterTotalContainer.addClass('gbbFooterButtonsContainer')
                    gbbFooterTotalContainer.css("background", gbb.settings.pageCustomizationData?.cartFooter?.cartFooterButtonsContainerBgColor || '#f6f6f6')
                    // gbbFooterProductsContainer.on("wheel", (event) => {
                    //     event.preventDefault();
                    //     // Detecting the direction of the scroll
                    //     if (event.originalEvent.deltaY < 0) {
                    //         // Scrolling up
                    //         gbb.$(".gbbFooterProductsContainer").scrollLeft(gbb.$(".gbbFooterProductsContainer").scrollLeft() - 50); // Scroll left
                    //     } else {
                    //         // Scrolling down
                    //         gbb.$(".gbbFooterProductsContainer").scrollLeft(gbb.$(".gbbFooterProductsContainer").scrollLeft() + 50); // Scroll right
                    //     }
                    // }) TBD @mufadal
                }
                if (products.length > 0) {
                    if (!renderProductSlotsFooter) {
                        gbbProductsFooterHTML.append(gbbFooterProductsContainer);
                    }
                    if (!renderNewTemplateDesign) {
                        gbbFooterTotalContainer.html(gbb.f.renderFooterTotalContainer())
                    }
                    // In new template design we dont need total price there we have this in renderFooterButtons
                    if (false && renderNewTemplateDesign && gbbPageFooterHTML.find('.gbbDiscountFooterHTML').length <= 0) {
                        gbbPageFooterHTML.append(gbb.gbbAddProductsPage.f.renderShowBoxProductsInFooterHTML())
                    } // if discount is not enable then will show selected products
                } else {
                    gbbProductsFooterHTML.css("grid-template-columns", "1fr");
                    !renderNewTemplateDesign && gbbFooterButtonsWrapper.css("grid-template-columns", "auto 1fr auto");
                    // changing layout for new template design
                    gbbFooterNextButton.css("grid-column", "3/3");
                }

                if (renderProductSlotsFooter) {
                    let productSlotsFooter = gbb.f.renderProductSlotsFooterHTML(noteAttribute)
                    if (updateFooterFlow == "updateFooterWithoutAppending" && gbb.$(".gbbSlotFooterProductsContainerWrapper").length > 0) {
                        let productsContainer = productSlotsFooter.find(".gbbSlotFooterProductContainer")
                        gbb.$(".gbbSlotFooterProductsContainer").html(productsContainer)
                        gbb.$(".gbbFooterButtonsWrapper").replaceWith(gbbFooterButtonsWrapper)
                        gbb.gbbAddProductsPage.f.autoScrollSlots()
                        gbb.$(".gbbCartIconWithQuantityContainer").replaceWith(gbb.gbbAddProductsPage.f.renderCartIconWithQuantityHTML())

                        let gbbPageFooterHTML = gbb.$(".gbbPageFooterHTML")
                        if (renderAddonsMessaging || gbb.settings?.discountsData?.isDiscountEnabled && gbb.settings?.discountsData?.isShowDiscountsEnabled && gbb.settings?.discountsData?.rules?.length > 0) {
                            // remove existing discountfooter and append new one 

                            gbb.$(".gbbDiscountFooterHTML").html(gbb.gbbDiscountComponent.f.discountStatusFooterHTML())
                        }
                        return gbbPageFooterHTML
                    } else {
                        gbbProductsFooterHTML.append(productSlotsFooter)
                    }
                }
                gbbFooterTotalContainer.append(gbbFooterButtonsWrapper);
                gbbProductsFooterHTML.append(gbbFooterTotalContainer);
                gbbPageFooterHTML.append(gbbProductsFooterHTML);
                if (renderNewTemplateDesign) {
                    gbbPageFooterHTML.append(gbb.gbbAddProductsPage.f.renderCartIconWithQuantityHTML())
                }
                if (gbb.utility.checkIfBrandingShouldBeVisible()) {
                    gbbPageFooterHTML.append(gbb.utility.renderPoweredByLabel());
                }
                return gbbPageFooterHTML;
            } catch (error) {
                gbb.utility.debugConsole("error in renderCartProductsFooterHTML", error);
            }
        },
        renderCartProductsModal: function (noteAttribute) {
            const gbbCartProductsMainContainer = gbb.$("<div>").addClass("gbbCartProductsMainContainer");
            const gbbCartProductsContainerModal = gbb.$("<div>").addClass("gbbCartProductsContainerModal");

            const gbbCartProductsContainerHeader = gbb.$("<div>").addClass("gbbCartProductsContainerHeader");
            const gbbCartProductsContainerHeaderLabel = gbb.$("<div>").addClass("gbbCartProductsContainerHeaderLabel").text(gbb.settings?.languageData?.general?.selectedProductsLabel?.value || "Selected Products");
            const gbbCartProductsModalClose = gbb.$("<div>").addClass("gbbCartProductsModalClose");
            gbbCartProductsModalClose.text("+");
            gbbCartProductsModalClose.on("click", () => {
                gbb.$("body").find(".gbbCartProductsMainContainer").remove()
                gbb.$("body").css("overflow-y", DEFAULT_BODY_OVERFLOW_VALUE);
            })

            const gbbCartProductsContainerBody = gbb.$("<div>").addClass("gbbCartProductsContainerBody");

            const gbbCartModalProductsContainer = gbb.$("<div>").addClass("gbbCartModalProductsContainer");
            let products = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
            products = products?.items || [];
            products.forEach((product) => {
                const gbbCartModalProductContainer = gbb.$("<div>").addClass("gbbCartModalProductContainer");
                //attach a data attriute to the product container
                gbbCartModalProductContainer.attr("productId", product?.product_id);
                gbbCartModalProductContainer.attr("variantId", product?.variant_id)

                const gbbCartProductImageContainer = gbb.$("<div>").addClass("gbbCartProductImageContainer");
                const gbbCartModalProductImage = gbb.$("<img>").addClass("gbbCartModalProductImage");
                gbbCartModalProductImage.attr("src", product.image);
                const gbbCartModalProductTextContainer = gbb.$("<div>").addClass("gbbCartModalProductTextContainer");

                const gbbCartModalProductTitleContainer = gbb.$("<div>").addClass("gbbCartModalProductTitleContainer");
                const gbbCartModalProductTitle = gbb.$("<div>").addClass("gbbCartModalProductTitle");
                const gbbCartModalProductQuantity = gbb.$("<div>").addClass("gbbCartModalProductQuantity");

                const gbbCartModalProductPriceQtyContainer = gbb.$("<div>").addClass("gbbCartModalProductPriceQtyContainer");
                const gbbCartModalProductPrice = gbb.$("<div>").addClass("gbbCartModalProductPrice");
                //a button to remove the product from the cart
                const gbbCartModalProductRemoveButton = gbb.$("<div>").addClass("gbbCartModalProductRemoveButton");
                // x icon for the remove button
                const gbbCartModalProductRemoveButtonIcon = gbb.$("<div>").addClass("gbbCartModalProductRemoveButtonIcon");

                gbbCartModalProductRemoveButtonIcon.append(CONSTANT_CLOSE_ICON_SVG);


                gbbCartModalProductRemoveButton.append(gbbCartModalProductRemoveButtonIcon)


                gbbCartModalProductRemoveButton.on("click", async () => {
                    //    await gbb.f.removeProductFromCart({id: product.variant_id});
                    let variant = {
                        id: product.variant_id,
                        _boxProduct: product?.properties["_boxProduct"],
                        _Category: product?.properties["_Category"],
                        _uniqueGbbItemKey: gbb.utility.getUniqueIdForVariant({ productData: product })
                    }
                    await gbb.utility.removeFromCart({ variant: variant });
                    gbb.gbbAddProductsPage.f.updateProductCard(product.product_id, variant.id);
                    gbb.$(".gbbCartProductsMainContainer").replaceWith(gbb.f.renderCartProductsModal(noteAttribute));
                    gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
                })

                gbbCartModalProductTitle.text(product.title);
                gbbCartModalProductPrice.text(gbb.utility.formatPrice(product.price));
                gbbCartModalProductQuantity.text("x" + product.quantity);
                gbbCartProductImageContainer.append(gbbCartModalProductImage);

                gbbCartModalProductTitleContainer.append(gbbCartModalProductTitle);
                //gbbCartModalProductTitleContainer.append(gbbCartModalProductQuantity);

                gbbCartModalProductTextContainer.append(gbbCartModalProductTitleContainer);
                gbbCartModalProductPriceQtyContainer.append(gbbCartModalProductQuantity);
                gbbCartModalProductPriceQtyContainer.append(gbbCartModalProductPrice);
                gbbCartModalProductTextContainer.append(gbbCartModalProductPriceQtyContainer);

                let pageIdTheProductWasAddedFrom = product?.properties["_boxProduct"]

                // @ashfaq append commented
                if (gbb.utility.checkIfRemoveButtonShouldBeAppended(product?.variant_id, pageIdTheProductWasAddedFrom)) {
                    gbbCartModalProductContainer.append(gbbCartModalProductRemoveButton);
                }

                gbbCartModalProductContainer.append(gbbCartProductImageContainer);
                gbbCartModalProductContainer.append(gbbCartModalProductTextContainer);
                gbbCartModalProductsContainer.append(gbbCartModalProductContainer);
            })

            gbbCartProductsContainerHeader.append(gbbCartProductsContainerHeaderLabel);
            gbbCartProductsContainerHeader.append(gbbCartProductsModalClose);

            gbbCartProductsContainerBody.append(gbbCartModalProductsContainer);

            const gbbModalTotalContainer = gbb.f.renderFooterTotalContainer();
            gbbModalTotalContainer.addClass("gbbModalTotalContainer");

            gbbCartProductsContainerModal.append(gbbCartProductsContainerHeader);
            gbbCartProductsContainerModal.append(gbbCartProductsContainerBody);
            gbbCartProductsContainerModal.append(gbbModalTotalContainer);

            gbbCartProductsMainContainer.append(gbbCartProductsContainerModal);
            gbb.$("body").append(gbbCartProductsMainContainer);
            gbb.$("body").css("overflow-y", "hidden");
            gbb.utility.debugConsole("dummy commit");
            gbb.f.applyFontToFooterCartPopup();
        },
        showProductVariantsModal: async function (product, buttonEle, noteAttribute, category) {
            let selectedVariantsCombination = {};
            gbb.state.currentModalProductData = product || {};
            let addProductsPageArr = ADDPRODUCT_PAGES_LIST
            const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()


            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            //gbb.$(".gbbHTMLWrapper").addClass('gbbDisabled');
            let currentProductPersonalization = gbb.utility.getCurrentProductPersonalization(product);
            let doesThisProductHavePersonalization = currentProductPersonalization.isProductPersonalizationEnabled || false;
            let isValidateInventoryEnabled = gbb.settings?.bundleSettings?.isValidateInventoryEnabled || false;
            let allowQuantityInput = gbb.settings?.bundleSettings?.allowQuantityInput || false;
            let incrementProductQtyBy = gbb.gbbAddProductsPage.state.incrementProductQtyBy || 1
            let decrementProductQtyBy = gbb.gbbAddProductsPage.state.decrementProductQtyBy || 1




            const gbbProductVariantModalMainContainer = gbb.$("<div>").addClass("gbbProductVariantModalMainContainer");
            if (gbb.$('.gbbProductsCardLayoutV2').length > 0) {
                gbbProductVariantModalMainContainer.addClass("gbbProductVariantModalLayoutV2");
            }
            if (gbb.$(".gbbNewPageCustomization").length > 0) {
                gbbProductVariantModalMainContainer.addClass("gbbNewPageCustomization");
            }
            const gbbProductVariantModalContainer = gbb.$("<div>").addClass("gbbProductVariantModalContainer");

            // gbbProductVariantModalContainer.addClass
            const gbbProductVariantModalContentContainer = gbb.$("<div>").addClass("gbbProductVariantModalContentContainer");

            gbbProductVariantModalContainer.attr("productId", product?.id);

            // gbbProductVariantModalContainer.attr("")
            let firstvariantid = product.variants.length > 0 ? product?.variants[0]?.id : "";
            gbbProductVariantModalContainer.attr("firstvariantid", firstvariantid);


            const gbbProductVariantModalBodyContainer = gbb.$("<div>").addClass("gbbProductVariantModalBodyContainer");


            const gbbProductVariantModalImageTitleContainer = gbb.$("<div>").addClass("gbbProductVariantModalImageTitleContainer");
            const gbbProductVariantModalDetailsContainer = gbb.$("<div>").addClass("gbbProductVariantModalDetailsContainer");

            const gbbProductVariantModalHeader = gbb.$("<div>").addClass("gbbProductVariantModalHeader");
            const gbbProductVariantModalClose = gbb.$("<div>").addClass("gbbProductVariantModalClose");
            gbbProductVariantModalClose.text("+");

            gbbProductVariantModalClose.on("click", (event) => {
                gbb.utility.closeVariantsModal()
            })
            //add product image and description here
            const gbbProductTextContainer = gbb.$("<div>").addClass("gbbProductCardTextContainer");
            const gbbProductItemTitle = gbb.$("<div>").addClass("gbbProductItemTitle");
            const gbbProductItemPricesContainer = gbb.$("<div>").addClass("gbbProductItemPricesContainer");
            const gbbProductItemCompareAtPrice = gbb.$("<div>").addClass("gbbProductItemCompareAtPrice");
            const gbbProductItemPrice = gbb.$("<div>").addClass("gbbProductItemPrice");

            if (product.compare_at_price && product.compare_at_price > product.price) {
                gbbProductItemCompareAtPrice.text(gbb.utility.formatPrice(product.compare_at_price));
            }
            gbbProductItemPrice.text(gbb.utility.formatPrice(product.price));
            if (product.variants?.length == 1 && product.available == true) {
                let variantPrice = product.variants[0].price;
                let variantCompareAtPrice = product.variants[0].compare_at_price
                if (isPurchaseTypeSubscription) {
                    variantCompareAtPrice = product.variants[0].price;
                    variantPrice = gbb.gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId(product.variants[0].id)
                }
                gbbProductItemPrice.text(gbb.utility.formatPrice(variantPrice));
                if (variantCompareAtPrice) {
                    gbbProductItemCompareAtPrice.text(gbb.utility.formatPrice(variantCompareAtPrice));
                }
            }
            else if (product.variants?.length > 1 && product.available == true) {
                let variantPrice = product.variants[0].price;
                let variantCompareAtPrice = product.variants[0].compare_at_price
                if (isPurchaseTypeSubscription) {
                    variantCompareAtPrice = product.variants[0].price
                    variantPrice = gbb.gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId(product.variants[0].id)
                }
                gbbProductItemPrice.text(gbb.utility.formatPrice(variantPrice));
                if (isPurchaseTypeSubscription || variantCompareAtPrice > product.variants[0].price) {
                    gbbProductItemCompareAtPrice.text(gbb.utility.formatPrice(variantCompareAtPrice));
                }
            }
            // else if (product.variants?.length > 1 && product.available == true) {
            //     gbbProductItemPrice.text(gbb.utility.formatPrice(product.price));
            //     if(product.compare_at_price  && product.compare_at_price > product.price){
            //         gbbProductItemCompareAtPrice.text(gbb.utility.formatPrice(product.compare_at_price));
            //     }
            // }

            const gbbProductDescriptionContainer = gbb.$("<div>").addClass("gbbProductDescriptionContainer");
            const gbbProductDescriptionText = gbb.$("<div>").addClass("gbbProductDescriptionText");

            const gbbProductDynamicContentContainer = gbb.$("<div>").addClass("gbbProductDynamicContentContainer");
            gbbProductDynamicContentContainer.html(gbb.gbbAddProductsPage.f.renderProductDynamicContent(product,'PRODUCT_VARIANTS_MODAL'));


            let description = product?.descriptionHtml?.toString() || product?.description?.toString() || "";  //?.replace(/<[^>]+>/g, '') || ""; //used to remove all HTML tags from a string
            description = description.replace(/\\n/g, "<br>");
            description = gbb.utility.removeIframeTagsFromHtml(description);
            description = gbb.utility.adjustImageTagsInProductDescriptionHtml(description);
            gbbProductDescriptionText.html(description);
            gbbProductDescriptionContainer.append(gbbProductDescriptionText);

            const gbbProductImageContainer = gbb.$("<div>").addClass("gbbProductImageContainer");
            const gbbProductAllImagesContainer = gbb.$("<div>").addClass("gbbProductAllImagesContainer");
            const gbbProductImage = gbb.$("<img>").addClass("gbbProductImage");
            let defaultMedia = {
                src: "https://db07ji0eqime4.cloudfront.net/redeemPage/giftcard/default-no-logo.jpg",
                media_type: "image",
                id: 3656456476
            }
            product.media = product.media ? product.media : [defaultMedia];
            for (let i = 0; i < product.media.length; i++) {
                let media = product.media[i];
                if (!media || !media.src) {
                    continue;
                }
                if (media.src) {
                    gbbProductImageContainer.append(gbb.$("<img>").addClass('gbbProductImageContainerImg' + i).addClass("gbbProductImageContainerImg").addClass("gbbFade"))
                    gbbProductImageContainer.find('.gbbProductImageContainerImg' + i).attr('src', media.src).css('display', 'none')
                }
                if (i == 0) {
                    gbbProductImageContainer.find('.gbbProductImageContainerImg' + i).css('display', 'block')
                }
            }
            //push an anchor tag
            if (product.media.length > 1) {
                //let gbbProductSliderNavigatior = gbb.$("<div>").addClass('gbbProductSliderNavigatior')
                gbbProductImageContainer.append(gbb.$("<a>").addClass('gbbPrevImage'))
                gbbProductImageContainer.find('.gbbPrevImage').html("&#10094;");
                //add an onclick event to the anchor tag
                gbbProductImageContainer.append(gbb.$("<a>").addClass('gbbNextImage'))
                gbbProductImageContainer.find('.gbbNextImage').html("&#10095;");

                gbbProductImageContainer.find('.gbbPrevImage').click(function (event) {
                    event.stopPropagation();
                    event.preventDefault();
                    gbb.utility.slider.minusSlides(gbbProductImageContainer, 1)

                    let prevActiveImage = gbbProductAllImagesContainer.find(".gbbActiveImage")
                    gbb.f.removeActiveImageStyle(prevActiveImage)
                    prevActiveImage.removeClass("gbbActiveImage")

                    let activeImage = gbbProductAllImagesContainer.find(`[imageIndex = ${gbb.utility.slider.state.slideIndex - 1}]`)
                    activeImage.addClass("gbbActiveImage")
                    gbb.f.applyActiveImageStyle(activeImage)
                })
                gbbProductImageContainer.find('.gbbNextImage').click(function (event) {
                    event.stopPropagation();
                    event.preventDefault();
                    gbb.utility.slider.plusSlides(gbbProductImageContainer, 1)

                    gbb.f.removeActiveImageStyle(gbbProductAllImagesContainer.find(".gbbActiveImage"))
                    gbbProductAllImagesContainer.find(".gbbActiveImage").removeClass("gbbActiveImage")

                    let activeImage = gbbProductAllImagesContainer.find(`[imageIndex = ${gbb.utility.slider.state.slideIndex - 1}]`)
                    activeImage.addClass("gbbActiveImage")
                    gbb.f.applyActiveImageStyle(activeImage)
                })
                //gbbProductImageContainer.append(gbbProductImageContainer);
            }

            for (let i = 0; i < product.media.length; i++) {
                let media = product.media[i];
                if (!media || !media.src) {
                    continue;
                }
                if (media.src) {
                    let gbbProductTabImageContainer = gbb.$("<div>").addClass("gbbProductTabImageContainer");
                    gbbProductTabImageContainer.append(gbb.$("<img>")
                        .attr('src', media.src)
                        .attr('imageIndex', i)
                        .attr('mediaId', media.id)
                        .addClass('gbbProducTabImage'))
                    gbbProductTabImageContainer.on("click", (event) => {
                        event.stopPropagation()
                        event.preventDefault()
                        gbb.f.removeActiveImageStyle(gbbProductAllImagesContainer.find(".gbbActiveImage"))
                        gbbProductAllImagesContainer.find(".gbbActiveImage").removeClass("gbbActiveImage")

                        gbbProductTabImageContainer.addClass("gbbActiveImage");
                        let changedVariantDiv = gbbProductAllImagesContainer.find(`[mediaId=${media.id}]`);
                        // let changedVariantDivIndex = parseInt(changedVariantDiv.attr("imageIndex"))
                        let changedVariantDivIndex = parseInt(changedVariantDiv?.parent()?.index())
                        changedVariantDivIndex += 1;

                        gbb.f.applyActiveImageStyle(gbbProductTabImageContainer)
                        gbb.utility.slider.state.slideIndex = changedVariantDivIndex;
                        gbb.utility.slider.showSlides(gbbProductImageContainer, gbb.utility.slider.state.slideIndex)
                    })
                    gbbProductAllImagesContainer.append(gbbProductTabImageContainer)
                }
            }
            let productFormDiv = null;
            if (doesThisProductHavePersonalization) {
                gbbProductVariantModalContainer.addClass("gbbProductVariantModalContainerWithPersonalization");
                productFormDiv = gbb.gbbProductFormStep.f.prepareFormToBeRenderedHTML(currentProductPersonalization, product);
            }


            if (gbb?.settings?.merchantInfo?.bundleSettings?.showCompareAtPrice) {
                gbbProductItemPricesContainer.append(gbbProductItemCompareAtPrice);
            }
            gbbProductItemPricesContainer.append(gbbProductItemPrice);

            // gbbProductItemTitle.text(product.title);
            if (product.variants.length == 1 && gbb.gbbAddProductsPage.state.displayVariantsAsIndividualProducts) {
                // gbbProductItemTitle.text(`${product.variants[0].title} (${product?.options[0]?.name})`);
                gbbProductItemTitle.text(`${product.variants[0].title}`);

            } else {
                gbbProductItemTitle.text(product.title);
            }
            gbbProductTextContainer.append(gbbProductItemTitle);
            if (gbb.settings?.app?.integrations?.judgeme?.isEnabled) {
                let starsHTML = gbb.gbbIntegrations?.judgeme?.f?.getStarsHTMLByProductId(product.id);
                if (starsHTML) {
                    let reviewStarsContainer = gbb.$("<div>").addClass("gbbReviewStarsContainer");
                    let reviewStars = gbb.$("<div>").addClass("gbbReviewStars");
                    reviewStars.html(starsHTML);
                    reviewStarsContainer.append(reviewStars);
                    gbbProductTextContainer.append(reviewStarsContainer);
                }
            }
            gbbProductTextContainer.append(gbbProductItemPricesContainer);
            if (isValidateInventoryEnabled) {
                let gbbVariantInventoryContainer = gbb.$("<div>").addClass("gbbVariantInventoryContainer");
                let activeVariantInfo = gbb.utility.checkIfSelectedVariantCombinationIsAvailable(product, selectedVariantsCombination);
                let totalInventory = activeVariantInfo[0]?.quantityAvailable || 0;
                let inventoryText = gbb.$("<div>").addClass("gbbInventoryText");
                inventoryText.text((`${totalInventory} ${gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.inventoryInStockText) || "in Stock1"}`));
                if (totalInventory > 0) {
                    gbbVariantInventoryContainer.append(inventoryText);
                    gbbProductTextContainer.append(gbbVariantInventoryContainer);
                }
            }
            gbbProductTextContainer.append(gbbProductDescriptionContainer);
            // if (gbb.settings.bundleSettings?.metafieldNameSpaceAndKeys.length > 0) {
            //     gbbProductTextContainer.append(gbbProductDynamicContentContainer);
            // }
            if (gbb.settings.bundleSettings?.metafieldNameSpaceAndKeys.length > 0 || gbb.settings.app?.dynamicScriptForHTMLContent) {
                gbbProductTextContainer.append(gbbProductDynamicContentContainer)
            }


            gbbProductAllImagesContainer.find(`[imageIndex = ${0}]`).addClass("gbbActiveImage")
            gbb.f.applyActiveImageStyle(gbbProductAllImagesContainer.find(`[imageIndex = ${0}]`))
            gbbProductVariantModalImageTitleContainer.append(gbbProductImageContainer);
            // gbbProductVariantModalImageTitleContainer.append(gbbProductAllImagesContainer); // HEREr
            gbbProductVariantModalHeader.append(gbbProductVariantModalClose)
            gbbProductVariantModalContentContainer.append(gbbProductVariantModalHeader);

            gbbProductVariantModalDetailsContainer.append(gbbProductTextContainer);


            if (false && gbbProductVariantModalMainContainer.hasClass("gbbProductVariantModalLayoutV2")) {
                const imageSliderContainer = gbb.$("<div>").addClass("gbbImageSliderContainer");
                const prevBtnContainer = gbb.$("<div>").addClass("gbbPrevBtnContainer");
                const nextBtnContainer = gbb.$("<div>").addClass("gbbNextBtnContainer");
                const prevBtn = gbb.$("<div>").addClass("gbbPrevBtn").html("&#x25B2;");
                const nextBtn = gbb.$("<div>").addClass("gbbNextBtn").html("&#x25BC;");
                prevBtnContainer.append(prevBtn);
                nextBtnContainer.append(nextBtn);
                imageSliderContainer.append(prevBtnContainer);
                imageSliderContainer.append(gbbProductAllImagesContainer);
                imageSliderContainer.append(nextBtnContainer);
                gbbProductVariantModalBodyContainer.append(imageSliderContainer)
                gbbProductVariantModalBodyContainer.append(gbbProductVariantModalImageTitleContainer);
            } else {
                gbbProductVariantModalImageTitleContainer.append(gbbProductAllImagesContainer);
                gbbProductVariantModalBodyContainer.append(gbbProductVariantModalImageTitleContainer);
            }

            let variantQuantity = incrementProductQtyBy;

            let gbbProductQuantityHTMLContainer = gbb.$("<div>").addClass("gbbProductQuantityHTMLContainer");
            let gbbProductQuantityHTML = gbb.$("<div>").addClass("gbbProductQuantityHTML");

            let gbbProductQuantityHeading = gbb.$("<div>").addClass("gbbProductQuantityHeading")
            let productCardPageCustomization = gbb.settings.pageCustomizationData?.productCard
            let buttonTextColor = productCardPageCustomization.productCardQuantitySelectorButtonTextColor || productCardPageCustomization.productCardButtonTextColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor
            // let gbbProductQuantityAddButton = gbb.$("<button>").addClass("gbbProductQuantityAddButton")
            let gbbProductQuantityAddButton = gbb.$("<div>").addClass("gbbProductQuantityAddButton")
                // .css("background", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                // .css("color", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
                .css("background", gbb.settings.pageCustomizationData?.productCard?.productCardButtonColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                .css("color", productCardPageCustomization.productCardButtonTextColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
            // let gbbProductQuantityRemoveButton = gbb.$("<button>").addClass("gbbProductQuantityRemoveButton")

            let gbbProductQuantityRemoveButton = gbb.$("<div>").addClass("gbbProductQuantityRemoveButton")
                // .css("background", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                // .css("color", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
                .css("background", gbb.settings.pageCustomizationData?.productCard?.productCardButtonColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                .css("color", productCardPageCustomization.productCardButtonTextColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
            let gbbProductQuantityLabel = gbb.$("<div>").addClass("gbbProductQuantityLabel");

            let gbbProductQuantityInput = gbb.$("<input>").addClass("gbbProductQuantityInput").attr("type", "number").attr("min", 0);

            gbbProductQuantityAddButton.append(gbb.$("<div>").addClass("gbbProductQuantityAddButtonWrapper").html("+"));
            gbbProductQuantityRemoveButton.append(gbb.$("<div>").addClass("gbbProductQuantityRemoveButtonWrapper").html("-"));

            gbbProductQuantityAddButton.on("click", async (event) => {
                variantQuantity += incrementProductQtyBy;
                gbbProductQuantityLabel.text(variantQuantity);
                gbbProductQuantityInput.val(variantQuantity);
                if (isValidateInventoryEnabled) {
                    let validationOptions = {
                        product: product,
                        selectedVariantsCombination: selectedVariantsCombination,
                        variantQuantity: variantQuantity + incrementProductQtyBy,
                        gbbProductQuantityAddButton: gbbProductQuantityAddButton
                    }
                    gbb.utility.validateProductQuantityAddButton(validationOptions);
                }
            })

            gbbProductQuantityRemoveButton.on("click", async (event) => {
                if (variantQuantity > 0) {
                    variantQuantity -= decrementProductQtyBy;
                    variantQuantity = variantQuantity < 0 ? 0 : variantQuantity;
                    gbbProductQuantityLabel.text(variantQuantity);
                    gbbProductQuantityInput.val(variantQuantity);
                    if (isValidateInventoryEnabled) {
                        let validationOptions = {
                            product: product,
                            selectedVariantsCombination: selectedVariantsCombination,
                            variantQuantity: variantQuantity + incrementProductQtyBy,
                            gbbProductQuantityAddButton: gbbProductQuantityAddButton
                        }
                        gbb.utility.validateProductQuantityAddButton(validationOptions);
                    }
                }
            })

            gbbProductQuantityInput.on("change", (event) => {
                let value = parseInt(event.target.value);
                if (value < 0) {
                    value = 0;
                }
                variantQuantity = value;
                gbbProductQuantityLabel.text(variantQuantity);
                gbbProductQuantityInput.val(variantQuantity);
            })

            gbbProductQuantityLabel.text(variantQuantity);
            gbbProductQuantityInput.val(variantQuantity);

            gbbProductQuantityHeading.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.general.quantity) || "Quantity");

            gbbProductQuantityHTML.append(gbbProductQuantityRemoveButton)

            if (allowQuantityInput) {
                gbbProductQuantityHTML.append(gbbProductQuantityInput);
            } else {

                gbbProductQuantityHTML.append(gbbProductQuantityLabel);
            }

            gbbProductQuantityHTML.append(gbbProductQuantityAddButton);

            gbbProductQuantityHTMLContainer.append(gbbProductQuantityHeading);
            gbbProductQuantityHTMLContainer.append(gbbProductQuantityHTML);
            gbbProductVariantModalDetailsContainer.append(gbbProductQuantityHTMLContainer)

            const gbbProductActionContainer = gbb.$("<div>").addClass("gbbProductCardActionContainer");
            const gbbProductButtonWrapper = gbb.$("<div>").addClass("gbbProductButtonWrapper").html("  ");
            if (product.variants?.length == 1 && product.available == true && product.renderChooseOptionsButton_forcefully != true) {

                if (product.options.length > 0 && product.options[0].name && product.variants[0]?.options?.length > 0) {
                    let options = product.options 
                    options.forEach((option, index) => {
                        selectedVariantsCombination[option.name] = product.variants[0]?.options[index]
                        gbb.utility.debugConsole(selectedVariantsCombination)
                    })
                } 

                // const gbbProductButton = gbb.$("<button>").addClass("gbbProductAddButton");
                const gbbProductButton = gbb.$("<div>").addClass("gbbProductVariantAddButton")
                    // .css("background", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                    // .css("color", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
                    .css("background", gbb.settings.pageCustomizationData?.productCard?.productCardButtonColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                    .css("color", gbb.settings.pageCustomizationData?.productCard?.productCardButtonTextColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);

                if (addProductsPageArr.includes(noteAttribute)) {
                    gbbProductButton.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.general.addToBoxButtonText));
                } else {
                    gbbProductButton.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.general.addButtonText));
                }

                let argsObj = {
                    productData: product,
                    variantId: product.variants[0].id,
                }

                let uniqueItemKey = gbb.utility.getUniqueIdForVariant(argsObj);

                const isItemInCart = gbb.utility.checkIfItemPresentInGiftBoxCart(product.variants[0].id, { uniqueItemKey });

                // const isItemInCart = gbb.utility.checkIfItemPresentInGiftBoxCart(product.variants[0].id);
                let data = {
                    productData: product,
                    variant: product.variants[0]
                }
                gbbProductButton.on("click", async () => {
                    gbbProductButton.addClass("gbbDisabled");
                    setTimeout(function () {
                        gbbProductButton.prop('disabled', false);
                        gbbProductButton.removeClass("gbbDisabled");
                    }, 500);
                    // { productAmount, category, productQuantity}
                    // data?.variant?.price, category, variantQuantity
                    let options = {
                        productAmount: data?.variant?.price,
                        category: category,
                        productQuantity: variantQuantity,
                        productWeight: data?.variant?.weight,
                        productVariantData: data?.variant
                    }
                    let condition = await gbb.utility.checkStepConditions(noteAttribute, options);

                    let formValidationForProduct = gbb.gbbProductFormStep.f.checkFormValidationForProduct(product);
                    if (!formValidationForProduct) {
                        gbb.gbbProductFormStep.f.displayRequiredFieldMessage();
                        return;
                    } else if (formValidationForProduct) {
                        gbb.utility.addPersonalizationDataToProductProperties();
                    }

                    let typeOfProduct = "singleVariant";
                    if (gbb.settings?.bundleSettings?.isValidateInventoryEnabled && !gbb.utility.allowATCBasedOnProductInventory(data?.variant?.id, variantQuantity)) {
                        gbb.utility.closeVariantsModal()
                        gbb.f.renderConditionNotificationToast((gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.inventoryLimitReachedText) || "No More Stock1"))
                        return
                    }
                    if (condition.isConditionMet) {
                        if (isItemInCart && isItemInCart.quantity) {
                            variantQuantity += isItemInCart.quantity
                        }
                        data.qty = variantQuantity;
                        try {
                            let _noteAttribute = product?.customProductAttribute || noteAttribute
                            await gbb.utility.addToCart(data, _noteAttribute, category);
                            await gbb.utility.getGiftBoxProductsFromCart();
                        } catch (e) {
                            // gbb.utility.debugConsole("error generated is", e);
                        }
                        gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
                        // gbb.gbbAddProductsPage.f.autoScrollSlotsBasedOnATC("addToCart")
                        if (noteAttribute == "reviewPage") {
                            gbb.gbbReviewPage.init(gbb.settings, "SUMMARY_PAGE");
                        }

                        let newProductItemHTML = gbb.f.renderProductsHTML([product], noteAttribute, category);
                        // gbb.$(".gbbPageBody").find(`[productId='${product.id}']`).replaceWith(newProductItemHTML);
                        let productCardRef = gbb.$(".gbbProductsContainer").find(`[productId='${product.id}']`);
                        // productCard = find the product that has firstvariantid as variantId
                        if (productCardRef.length > 1) {
                            productCardRef = gbb.$(".gbbProductsContainer").find(`[firstvariantid='${product.variants[0].id}']`);

                            //the below code works but is commented because of 
                            // - we dont use filter a lot, especially in case of jquery objects.
                            // - the above code is more readable, understandable and also faster (surprisingly)
                            // @ashfaq benchmarked it
                            // productCardRef = productCardRef.filter(`[firstvariantid='${product.variants[0].id}']`);
                        }

                        productCardRef.replaceWith(newProductItemHTML);

                        gbb.utility.closeVariantsModal()
                        //TODO: handleAutoNextStep
                        await gbb.gbbAddProductsPage.f.handleAutoNextStep();
                    } else {
                        gbb.utility.closeVariantsModal()
                    }
                })

                //gbbProductButtonWrapper.append(gbbProductButton);
                gbbProductActionContainer.append(gbbProductButtonWrapper);
                gbbProductActionContainer.append(gbbProductButton);
                let isThisNewDesign = gbbProductVariantModalMainContainer.hasClass("gbbProductVariantModalLayoutV2")
                if (isThisNewDesign) {
                    gbbProductVariantModalDetailsContainer.append(gbbProductActionContainer)
                }
                gbbProductVariantModalBodyContainer.append(gbbProductVariantModalDetailsContainer);
                gbbProductVariantModalContentContainer.append(gbbProductVariantModalBodyContainer);
                if (isThisNewDesign != true) { // repeating this if block logic coz both have different placements
                    gbbProductVariantModalContentContainer.append(gbbProductActionContainer);
                }
                if (window.innerWidth < 600) {
                    gbbProductVariantModalContentContainer.append(gbbProductDescriptionContainer);
                }

            } else {
                const gbbProductVariantNotAvailableWarning = gbb.$("<div>").addClass("gbbProductVariantNotAvailableWarning");
                // const gbbProductVariantAddButton = gbb.$("<button>").addClass("gbbProductVariantAddButton")
                const gbbProductVariantAddButton = gbb
                    .$("<div>")
                    .addClass("gbbProductVariantAddButton")
                    // .css("background", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                    // .css("color", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
                    .css("background", gbb.settings?.pageCustomizationData.productCard?.productCardButtonColor || gbb.settings.pageCustomizationData.quickSettings.colors.buttonBgColor)
                    .css("color", gbb.settings?.pageCustomizationData.productCard?.productCardButtonTextColor || gbb.settings.pageCustomizationData.quickSettings.colors.buttonTextColor);

                if (addProductsPageArr.includes(noteAttribute)) {
                    gbbProductVariantAddButton.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.general.addToBoxButtonText));
                } else {
                    gbbProductVariantAddButton.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.general.addButtonText));
                }

                gbbProductVariantAddButton.on("click", (event) => {
                    gbbProductVariantAddButton.addClass("gbbDisabled");
                    setTimeout(function () {
                        gbbProductVariantAddButton.prop("disabled", false);
                        gbbProductVariantAddButton.removeClass("gbbDisabled");
                    }, 500);
                    gbb.utility.addVariantProductToCart(gbbProductVariantNotAvailableWarning, product, selectedVariantsCombination, noteAttribute, buttonEle, category, variantQuantity);

                });

                gbbProductVariantNotAvailableWarning.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.combinationNotAvailable));

                const gbbProductVariantOptionsContainer = gbb.$("<div>").addClass("gbbProductVariantOptionsContainer");
                gbbProductVariantOptionsContainer.append(gbbProductVariantNotAvailableWarning);

                if (gbb?.settings?.merchantInfo?.customSettings?.showOnlyAdminSelectedVariants) {
                    product.options = gbb.utility.returnOnlyAdminSelectedVariantOptions(product);
                }

                product.options?.forEach((option, index) => {
                    let name = option?.name || "";
                    let nameToCompare = name.replace(new RegExp("'", "g"), "");
                    const gbbProductVariantOptionContainer = gbb.$("<div>").addClass("gbbProductVariantOptionContainer").attr("optionId", nameToCompare);
                    const gbbProductVariantOptionLabel = gbb.$("<div>").addClass("gbbProductVariantOptionLabel");
                    gbbProductVariantOptionLabel.text(option.name);
                    gbbProductVariantOptionContainer.append(gbbProductVariantOptionLabel);
                    const gbbProductVariantOptionValuesContainer = gbb.$("<div>").addClass("gbbProductVariantOptionValuesContainer");

                    //set initial selection to the options of first variant product
                    selectedVariantsCombination[option.name] = product.variants[0].options[index];

                    option.values?.forEach((value, index) => {
                        let valueToCompare = value.replace(new RegExp("'", "g"), "");
                        // const gbbProductVariantOptionValue = gbb.$("<button>")
                        const gbbProductVariantOptionValue = gbb.$("<div>").addClass("gbbProductVariantOptionValue").attr("optionValueId", valueToCompare);
                        //.css("background",gbb.settings.pageCustomizationData?.quickSettings?.colors?.primaryColor)
                        //gbbProductVariantOptionValue.attr("optionValueId"+ value)
                        gbbProductVariantOptionValue.text(value);
                        if (option.values.length == 1 && value == "Default Title") {
                            gbbProductVariantOptionContainer.addClass("gbbProductVariantOptionContainerHidden");
                        }

                        gbbProductVariantOptionValuesContainer.append(gbbProductVariantOptionValue);

                        gbbProductVariantOptionValue.on("click", (event) => {
                            event.preventDefault();
                            let activeVariant = gbbProductVariantOptionContainer.find(".gbbActiveVariant");
                            gbb.f.removeSelectedVariantStyle(activeVariant);
                            activeVariant.removeClass("gbbActiveVariant");

                            gbbProductVariantOptionValue.addClass("gbbActiveVariant");
                            gbb.f.applySelectedVariantStyle(gbbProductVariantOptionValue);
                            selectedVariantsCombination[option.name] = value;

                            if (isValidateInventoryEnabled) {
                                gbb.utility.validateATCAndVariantQuantityAddButton({ product, selectedVariantsCombination, variantQuantity, gbbProductQuantityAddButton, gbbProductVariantModalContainer })
                                let activeVariantInfo = gbb.utility.checkIfSelectedVariantCombinationIsAvailable(product, selectedVariantsCombination);
                                let totalInventory = activeVariantInfo[0]?.quantityAvailable || 0;
                                if (totalInventory > 0) {
                                    gbb.$(".gbbVariantInventoryContainer").show();
                                    gbb.$(".gbbInventoryText").text((`${totalInventory} ${gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.inventoryInStockText) || "in Stock1"}`));
                                } else {
                                    gbb.$(".gbbVariantInventoryContainer").hide();
                                }
                            }

                            gbb.utility.handleVariantSelection(
                                gbbProductVariantNotAvailableWarning,
                                product,
                                selectedVariantsCombination,
                                gbbProductVariantAddButton,
                                gbbProductAllImagesContainer,
                                gbbProductImageContainer
                            );
                        });
                    });

                    gbbProductVariantOptionContainer.append(gbbProductVariantOptionValuesContainer);
                    gbbProductVariantOptionsContainer.append(gbbProductVariantOptionContainer);

                    let valueToCompare = product.variants[0].options[index];
                    valueToCompare = valueToCompare.replace(new RegExp("'", "g"), "");

                    let activeVariant = gbbProductVariantOptionsContainer.find(`[optionId='${nameToCompare}']`).find(`[optionValueId='${valueToCompare}']`);
                    activeVariant.addClass("gbbActiveVariant");
                    gbb.f.applySelectedVariantStyle(activeVariant);
                });
                gbbProductActionContainer.append(gbbProductButtonWrapper);
                gbbProductActionContainer.append(gbbProductVariantAddButton);

                let isThisNewDesign = gbbProductVariantModalMainContainer.hasClass("gbbProductVariantModalLayoutV2")
                gbbProductVariantModalDetailsContainer.append(gbbProductVariantOptionsContainer);
                if (isThisNewDesign) {
                    gbbProductVariantModalDetailsContainer.append(gbbProductActionContainer)
                }
                gbbProductVariantModalBodyContainer.append(gbbProductVariantModalDetailsContainer);
                gbbProductVariantModalContentContainer.append(gbbProductVariantModalBodyContainer);




                if (isThisNewDesign != true) { // repeating this block coz both conditions have different placements in the design structure
                    gbbProductVariantModalContentContainer.append(gbbProductActionContainer);
                }
                if (window.innerWidth < 600) {
                    gbbProductVariantModalContentContainer.append(gbbProductDescriptionContainer);
                }
            }

            if (window.innerWidth < 600) {
                gbbProductButtonWrapper.css("display", "none");
                gbbProductActionContainer.css("grid-template-columns", "1fr")
            }

            if (productFormDiv) {
                gbbProductVariantModalDetailsContainer.append(productFormDiv);
            }

            if (isValidateInventoryEnabled) {
                gbb.utility.validateATCAndVariantQuantityAddButton({ product, selectedVariantsCombination, variantQuantity, gbbProductQuantityAddButton, gbbProductVariantModalContainer })
            }
            gbbProductVariantModalContainer.append(gbbProductVariantModalContentContainer);
            gbbProductVariantModalMainContainer.append(gbbProductVariantModalContainer);
            gbb.$("body").append(gbbProductVariantModalMainContainer);
            gbb.$("body").css("overflow-y", "hidden");
            gbb.f.applyFontToProductPopupCard();
            gbb.gbbBrowser.emitCustomEvent({
                eventName: "gbb-variants-modal-open",
            })
        },
        renderConditionNotificationToast: function (conditionMessage, categoryTitle) {
            const gbbConditionNotificationToastMainContainer = gbb.$("<div>").addClass("gbbConditionNotificationToastMainContainer");
            const gbbConditionNotificationToast = gbb.$("<div>").addClass("gbbConditionNotificationToast");
            const gbbConditionNotificationMessage = gbb.$("<div>").addClass("gbbConditionNotificationMessage");
            const gbbConditionNotificationClose = gbb.$("<div>").addClass("gbbConditionNotificationClose");
            gbbConditionNotificationClose.text("+")
            gbbConditionNotificationClose.on("click", () => {
                gbb.$(".gbbPageFooterHTML").find(".gbbConditionNotificationToast").remove()
            })
            if (categoryTitle) {
                conditionMessage = categoryTitle + " : " + conditionMessage
            }
            gbbConditionNotificationMessage.text(conditionMessage);
            gbbConditionNotificationToast.css("background", gbb.settings?.pageCustomizationData?.generalSettings?.conditionToast?.conditionToastBgColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)

            gbbConditionNotificationToast.css("color", gbb.settings?.pageCustomizationData?.generalSettings?.conditionToast?.conditionToastTextColor || "#ffffff")
            gbbConditionNotificationClose.css("color", gbb.settings?.pageCustomizationData?.generalSettings?.conditionToast?.conditionToastTextColor || "#ffffff")

            gbbConditionNotificationToast.append(gbbConditionNotificationMessage);
            gbbConditionNotificationToast.append(gbbConditionNotificationClose);

            //gbbConditionNotificationToastMainContainer.append(gbbConditionNotificationToast);
            gbb.$(".gbbPageFooterHTML").append(gbbConditionNotificationToast);
            setTimeout(() => {
                gbb.$(".gbbPageFooterHTML").find(".gbbConditionNotificationToast").remove()
            }, 6000)
        },

        getVisibilityMaps: function (data, cartData) {
            try {
                let visibilityMaps = {};

                const updateVisibility = (mapKey, type, id, value) => {
                    if (!visibilityMaps[mapKey][type]) {
                        visibilityMaps[mapKey][type] = {};
                    }
                    visibilityMaps[mapKey][type][id] = {
                        ...visibilityMaps[mapKey][type][id],
                        visibility: value
                    };
                };

                data.rules.forEach((rule, index) => {
                    const ruleKey = `r${index + 1}`; // Dynamic rule key (e.g., r1, r2, ...)
                    visibilityMaps[ruleKey] = {};

                    const actionType = rule.action.actionType; // "hide" or "show"
                    const isHideRule = actionType === "hide";

                    const conditionOperator = "OR" || "AND";

                    let cartProductIds = cartData.items.map((item) => String(item.product_id));
                    let cartTags = cartData.items.flatMap((item) => item.productTags || []);

                    let cartVariantTitles = cartData.items.flatMap((item) => item.options);


                    // Apply the rule to the specified products or tags
                    rule.trigger.selectionValues.forEach((selection) => {

                        // strip gid and stuff productId if exists;
                        if (selection.id && !selection.productId) {
                            selection.productId = selection.id.split("gid://shopify/Product/")[1];
                        }


                        let isVariantTitlePartOfCart = cartVariantTitles.filter(item => item.includes(selection.value)).length > 0;
                        let isAnyOfTheSelectionInCart = isVariantTitlePartOfCart || cartProductIds.includes(selection.productId) || cartTags.includes(selection.value);

                        if (conditionOperator == "AND" && !isAnyOfTheSelectionInCart) {
                            visibilityMaps[ruleKey] = {};
                            return;
                        }

                        if (conditionOperator == "OR" && !isAnyOfTheSelectionInCart) {
                            return;
                        }

                        let isActionBasedOnTag = rule.action.selectionType === "productTags";
                        let isActionBasedOnProduct = rule.action.selectionType === "products";
                        let isActionBasedOnVariantTitle = rule.action.selectionType === "variantTitle";
                        // Apply actions based on the rule
                        rule.action.selectionValues.forEach((actionSelection) => {
                            const visibilityValue = isHideRule ? -1 : 1;

                            if (actionSelection.id && !actionSelection.productId) {
                                actionSelection.productId = actionSelection.id.split("gid://shopify/Product/")[1];
                            }

                            if (isActionBasedOnTag) {
                                updateVisibility(ruleKey, 'tags', actionSelection.value, visibilityValue);
                            } else if (isActionBasedOnProduct) {
                                updateVisibility(ruleKey, 'products', actionSelection.productId, visibilityValue);
                            } else if (isActionBasedOnVariantTitle) {
                                updateVisibility(ruleKey, 'variantTitle', actionSelection.value, visibilityValue);
                            }
                        });
                    });
                });

                return visibilityMaps;
            } catch (error) {
                gbb.utility.debugConsole("error in getVisibilityMaps", error);
            }
        },

        applyVisibilityRulesToProducts: function (uniqueProductsByIds, visibilityMapsData, extraOptions) {
            try {
                let isPageTypeMultiCategory = extraOptions?.pageType == "MULTI_CATEGORY"

                let onlyShownProductIds = [];
                let onlyShownVariantIds = [];
                let productShownByRuleKey = {};
                let productHiddenByRuleKey = {};

                Object.keys(visibilityMapsData).forEach((ruleKey) => {
                    let rule = visibilityMapsData[ruleKey];

                    // Apply product visibility rules
                    Object.keys(rule.products || {}).forEach((productId) => {
                        let visibility = rule.products[productId].visibility;
                        if (visibility === 1) {
                            onlyShownProductIds.push(productId);
                        } else if (visibility === -1 && uniqueProductsByIds[productId]) {
                            uniqueProductsByIds[productId].available = false; // Hide the product
                            // product.available = false; // Hide the product based on tag
                            // product.available = false; // Hide the product based on tag
                        }
                    });

                    // Apply tag visibility rules
                    Object.keys(rule.tags || {}).forEach((tag) => {
                        let visibility = rule.tags[tag].visibility;
                        Object.values(uniqueProductsByIds).forEach((product) => {
                            if (product.tags && product.tags.includes(tag)) {
                                // If the product has the tag
                                if (visibility === 1 && !onlyShownProductIds.includes(product.productId)) {
                                    onlyShownProductIds.push(product.productId);
                                } else if (visibility === -1) {
                                    product.available = false; // Hide the product based on tag
                                }
                            } else {
                                // If the product doesn't have the tag
                                if (visibility === 1) {
                                    // Visibility is 1, but the product doesn't have the tag - ensure it's visible
                                    product.available = false; // Make sure the product is available
                                } else if (visibility === -1) {
                                    // Visibility is -1, but the product doesn't have the tag - hide the product
                                    // product.available = true; // Hide the product since the tag isn't present
                                }
                            }
                        });
                    });


                    // Step 1: Apply visibility rules and populate productVisibilityByRuleKey
                    Object.keys(rule.variantTitle || {}).forEach((itemTitle) => {
                        let visibility = rule.variantTitle[itemTitle].visibility;

                        Object.keys(uniqueProductsByIds).forEach((productId) => {
                            let product = uniqueProductsByIds[productId];
                            let onlyVariantsVisibleForThisProduct = [];

                            if (visibility === 1) {
                                if (!productShownByRuleKey[ruleKey]) productShownByRuleKey[ruleKey] = {};
                            } else if (visibility === -1) {
                                if (!productHiddenByRuleKey[ruleKey]) productHiddenByRuleKey[ruleKey] = {};
                            }

                            if (product.variants && product.variants.length > 0) {
                                product.variants.forEach((variant) => {
                                    let variantTitleOptionArray = variant.variantTitle?.split(" / ") || [];

                                    // Match rule logic (AND/OR)
                                    let matchResults = Object.keys(rule.variantTitle).map((ruleItemTitle) => {
                                        return variantTitleOptionArray.some((variantTitle) => ruleItemTitle.trim().toLowerCase() === variantTitle.trim().toLowerCase());
                                    });

                                    let operationType = "AND";
                                    let checkIfMatchFound;

                                    if (operationType === "AND") {
                                        checkIfMatchFound = matchResults.every((result) => result === true);
                                    } else if (operationType === "OR") {
                                        checkIfMatchFound = matchResults.some((result) => result === true);
                                    }

                                    // Apply visibility based on match results
                                    if (checkIfMatchFound) {
                                        if (visibility === 1) {
                                            productShownByRuleKey[ruleKey][productId] = productShownByRuleKey[ruleKey][productId] || { productId: productId, variants: [] };
                                            productShownByRuleKey[ruleKey][productId].variants.push(variant.variantId);
                                        } else if (visibility === -1) {
                                            productHiddenByRuleKey[ruleKey][productId] = productHiddenByRuleKey[ruleKey][productId] || { productId: productId, variants: [] };
                                            productHiddenByRuleKey[ruleKey][productId].variants.push(variant.variantId);
                                        }
                                    }
                                });
                            }
                        });
                    });

                });


                // Step 2: Update uniqueProductsByIds based on merged results
                let finalShownProducts = {};
                let validProductsToShowFromUniqueProducts;
                // Merge all productShownByRuleKey entries
                Object.keys(productShownByRuleKey).forEach((ruleKey) => {
                    Object.assign(finalShownProducts, productShownByRuleKey[ruleKey]);
                });

                // Apply visibility from the merged shown products
                Object.keys(finalShownProducts).forEach((productId) => {
                    let visibilityData = finalShownProducts[productId];
                    let product = uniqueProductsByIds[productId];

                    if (product) {
                        product.variants = product.variants.filter((variant) => visibilityData.variants.includes(variant.variantId));
                        product.available = product.variants.length > 0;
                    }
                });

                // Apply hidden rules
                Object.keys(productHiddenByRuleKey).forEach((ruleKey) => {
                    Object.keys(productHiddenByRuleKey[ruleKey]).forEach((productId) => {
                        if (uniqueProductsByIds[productId]) {
                            // Remove the variants that should be hidden based on the visibilityData
                            uniqueProductsByIds[productId].variants = uniqueProductsByIds[productId].variants.filter((variant) => {
                                if (productHiddenByRuleKey[ruleKey][productId].variants.includes(variant.variantId)) {
                                    return false; // Remove this variant
                                } else {
                                    variant.available = true; // Keep this variant and mark it as available
                                    return true;
                                }
                            });

                            // If all variants are hidden, mark the product as unavailable
                            if (uniqueProductsByIds[productId].variants && uniqueProductsByIds[productId].variants.length > 0) {
                                let allVariantsAreHidden = uniqueProductsByIds[productId].variants.every((variant) => variant.available === false);
                                if (allVariantsAreHidden) {
                                    uniqueProductsByIds[productId].available = false;
                                }
                            } else {
                                uniqueProductsByIds[productId].available = false; // If no variants remain, mark the product as unavailable
                            }
                        }
                    });
                });


                // Collect product IDs and variant IDs that are set to be shown
                let productIdsToBeShown = Object.keys(uniqueProductsByIds).filter((productId) => uniqueProductsByIds[productId].available);




                onlyShownVariantIds = productIdsToBeShown.reduce((variantIds, productId) => {
                    let product = uniqueProductsByIds[productId];
                    variantIds.push(...product.variants.map((variant) => variant.variantId));
                    return variantIds;
                }, []);

                // Final result
                return { onlyShownProductIds, uniqueProductsByIds, onlyShownVariantIds };

                // The final result
                //   return { onlyShownProductIds, uniqueProductsByIds, onlyShownVariantIds };
            } catch (error) {
                gbb.utility.debugConsole("error applyVisibilityRulesToProducts", error);
            }

        },


        filterOutBasedOnConditionalLogic: function (allProducts) {
            try {
                let cartData = gbb.state.giftBoxCartData;
                let conditionalLogic = gbb.settings.stepsConfigurationData?.conditionalLogic;

                if (!conditionalLogic || !conditionalLogic.isEnabled || conditionalLogic.rules.length < 1) {
                    return allProducts;
                }

                let visibilityMapsData = gbb.f.getVisibilityMaps(conditionalLogic, cartData);

                let uniqueProducts = JSON.parse(JSON.stringify(allProducts));
                let uniqueProductsByIds = gbb.utility.convertArrayToObject(uniqueProducts, "productId");


                let applyVisibilityRulesResult = gbb.f.applyVisibilityRulesToProducts(uniqueProductsByIds, visibilityMapsData);

                // let { onlyShownProductIds, uniqueProductsByIds: updatedProductsByIds } = 
                let onlyShownProductIds = applyVisibilityRulesResult.onlyShownProductIds || [];
                let onlyShownVariantIds = applyVisibilityRulesResult.onlyShownVariantIds || [];
                uniqueProductsByIds = applyVisibilityRulesResult.uniqueProductsByIds


                let resultFilteredArrayOfUniqueProducts;
                if (onlyShownProductIds.length > 0) {
                    resultFilteredArrayOfUniqueProducts = onlyShownProductIds.map(itemId => uniqueProductsByIds[itemId]);
                } else {
                    resultFilteredArrayOfUniqueProducts = Object.values(uniqueProductsByIds).filter(product => product.available !== false);
                }

                // clean undefined and null values
                resultFilteredArrayOfUniqueProducts = resultFilteredArrayOfUniqueProducts.filter(item => item);

                if (resultFilteredArrayOfUniqueProducts.length < 1) {
                    return allProducts;
                }


                return resultFilteredArrayOfUniqueProducts;

            } catch (err) {
                gbb.utility.debugConsole("error came", err);
                return allProducts;
            }
        },


        filterOutBasedOnConditionalLogic_MultipleCategories: function (allCategories) {
            try {
                let cartData = gbb.state.giftBoxCartData;
                let conditionalLogic = gbb.settings.stepsConfigurationData?.conditionalLogic;

                if (!conditionalLogic.isEnabled || conditionalLogic.rules.length < 1) {
                    return allCategories;
                }

                let visibilityMapsData = gbb.f.getVisibilityMaps(conditionalLogic, cartData);

                Object.keys(allCategories).forEach(categoryKey => {
                    let category = allCategories[categoryKey];
                    let uniqueProducts = category.uniqueProductsData;
                    let uniqueProductsByIds = gbb.utility.convertArrayToObject(uniqueProducts, "productId");

                    let extraOptions = {
                        pageType: "MULTIPLE_CATEGORY"
                    }
                    let applyVisibilityRulesResult = gbb.f.applyVisibilityRulesToProducts(uniqueProductsByIds, visibilityMapsData, extraOptions);
                    // applyVisibilityRulesResult = gbb.f.applyVisibilityRulesToVariants(uniqueProductsByIds, visibilityMapsData);
                    let onlyShownProductIds = applyVisibilityRulesResult.onlyShownProductIds || [];
                    uniqueProductsByIds = applyVisibilityRulesResult.uniqueProductsByIds
                    let onlyShownVariantIds = applyVisibilityRulesResult.onlyShownVariantIds || [];


                    let tempValue;
                    if (onlyShownProductIds.length > 0 || onlyShownVariantIds.length > 0) {
                        tempValue = onlyShownProductIds.map(productId => uniqueProductsByIds[productId])
                        // .filter(product => product && product.available !== false);
                    }
                    //  else if (onlyShownProductIds.length < 1 && onlyShownVariantIds.length < 1) {
                    //     tempValue = [];
                    // }
                    else {
                        tempValue = Object.values(uniqueProductsByIds).filter(product => product && product.available !== false);
                    }

                    // when the end result will contain no product, we will just return all the data
                    // earlier we used to return all the data. now we dont
                    tempValue = tempValue.filter(item => item);
                    if (tempValue.length > 0) {
                        category.uniqueProductsData = tempValue;
                    } else {

                        category.categoryVisibility = {
                            hide: true,
                            "reason": "NO_PRODUCTS_MEET_CONDITION_LOGIC"
                        }

                    }

                });

                // just before returning check 
                // if all the categories have category.categoryVisibility.hide as true
                // if at least one of them has not hide as true 
                //then just delete all the others
                let allCategoriesVisibilityHidden = Object.values(allCategories).map((category) => {
                    return category.categoryVisibility?.hide || false
                });

                // allCategoriesVisibility =   if 
                if (allCategoriesVisibilityHidden.includes(false)) {
                    // allCategories = allCategories.filter((category)=>{
                    //     return category.categoryVisibility?.hide == false
                    // })
                    Object.keys(allCategories).forEach((categoryKey) => {
                        if (allCategories[categoryKey].categoryVisibility?.hide == true) {
                            delete allCategories[categoryKey]
                        }
                    })
                }


                return allCategories;
            } catch (err) {
                console.error("Error occurred:", err);
                return allCategories;
            }
        },




        filterOutBasedOnConditionalLogic2: function (allProducts) {
            try {
                let cartData = gbb.state.giftBoxCartData;

                let conditionalLogic = gbb.settings.stepsConfigurationData?.conditionalLogic;


                if (!conditionalLogic.isEnabled || conditionalLogic.length < 1) {
                    return allProducts;
                }



                let visibilityMapsData = gbb.f.getVisibilityMaps(conditionalLogic, cartData);

                let visibilityMapForProducts = visibilityMapsData.visibilityMapForProducts;
                let visibilityMapForTags = visibilityMapsData.visibilityMapForTags



                let uniqueProducts = JSON.parse(JSON.stringify(allProducts));


                let rulesVisibilityArrayForProducts = gbb.utility.convertObjectToArray(visibilityMapForProducts);
                let rulesVisibilityArrayForTags = gbb.utility.convertObjectToArray(visibilityMapForTags);

                let uniqueProductsByIds = gbb.utility.convertArrayToObject(uniqueProducts, "productId");

                let onlyShownProducts = [];




                let resultFilteredArrayOfUniqueProducts = [];

                for (let i = 0; i < rulesVisibilityArrayForProducts.length; i++) {
                    let rule = rulesVisibilityArrayForProducts[i];

                    // if we find 1;
                    Object.keys(rule).forEach(item => {
                        if (rule[item] == 1) {
                            onlyShownProducts.push(item)
                        }

                        if (rule[item] == -1 && uniqueProductsByIds[item]) {
                            // hide the product
                            uniqueProductsByIds[item]["available"] = false
                            // uniqueProductsById
                        }
                    });
                }


                for (let i = 0; i < rulesVisibilityArrayForTags.length; i++) {
                    let rule = rulesVisibilityArrayForTags[i];


                    Object.keys(rule).forEach(item => {
                        let isInternalOperator = "OR";
                        let currentMatchedItems;
                        if (isInternalOperator == "OR") {
                            currentMatchedItems = uniqueProducts.filter((product) => {
                                if (product.tags.includes(item)) {
                                    return product;
                                }

                            })
                        } else if (isInternalOperator == "AND") {
                            //  write an operator similar to above but with AND
                            let currentMatchedItems = uniqueProducts.filter((product) => {
                                // if every 
                                // rule is an object so we cant use includes



                            })

                        }

                        // clean currentMatchedItems to not return undefined


                        if (rule[item] == 1) {
                            currentMatchedItems.forEach((product) => {
                                if (product?.productId) {
                                    onlyShownProducts.push(product?.productId)
                                }
                            })
                        }

                        if (rule[item] == -1) {
                            // hide the product
                            // find the detail in uniqueProductsByIds and set available to false
                            let findSameTagValue = uniqueProducts.find((product) => {
                                return product.tags.includes(item)
                            })

                            if (findSameTagValue && uniqueProductsByIds[findSameTagValue.productId]) {
                                uniqueProductsByIds[findSameTagValue.productId]["available"] = false
                            }
                        }
                    });

                }

                if (onlyShownProducts.length > 0) {
                    let onlyShownProductsData = onlyShownProducts.map((item) => {
                        return uniqueProductsByIds[item]
                    });

                    // return onlyShownProductsData;
                    resultFilteredArrayOfUniqueProducts = onlyShownProductsData;
                } else {
                    Object.keys(uniqueProductsByIds).forEach(item => {
                        if (uniqueProductsByIds[item]["available"] == false) {
                            delete uniqueProductsByIds[item]
                        }
                    });

                    let uniqueProductsArray = gbb.utility.convertObjectToArray(uniqueProductsByIds);
                    // return uniqueProductsArray
                    resultFilteredArrayOfUniqueProducts = uniqueProductsArray
                }


                return resultFilteredArrayOfUniqueProducts;

            } catch (err) {
                gbb.utility.debugConsole("error came", err)
                return allProducts;
            }
        },
        filterOutBasedOnConditionalLogic_MultipleCategories2: function (allCategories) {
            try {
                let cartData = gbb.state.giftBoxCartData;
                let conditionalLogic = gbb.settings.stepsConfigurationData?.conditionalLogic;

                // let allCategories = gbb.gbbAddProductsPage.state.productPageData.categories;
                if (!conditionalLogic.isEnabled || conditionalLogic.length < 1) {
                    return allCategories;
                }

                let visibilityMapsData = gbb.f.getVisibilityMaps(conditionalLogic, cartData);

                let visibilityMapForProducts = visibilityMapsData.visibilityMapForProducts;
                let visibilityMapForTags = visibilityMapsData.visibilityMapForTags;

                Object.keys(allCategories).forEach(categoryKey => {
                    let category = allCategories[categoryKey];
                    let uniqueProducts = category.uniqueProductsData;

                    let uniqueProductsByIds = gbb.utility.convertArrayToObject(uniqueProducts, "productId");

                    let rulesVisibilityArrayForProducts = gbb.utility.convertObjectToArray(visibilityMapForProducts);
                    let rulesVisibilityArrayForTags = gbb.utility.convertObjectToArray(visibilityMapForTags);

                    let onlyShownProducts = [];

                    rulesVisibilityArrayForProducts.forEach(rule => {
                        Object.keys(rule).forEach(productId => {
                            if (rule[productId] == 1 && uniqueProductsByIds[productId]) {
                                onlyShownProducts.push(productId);
                            } else if (rule[productId] == -1 && uniqueProductsByIds[productId]) {
                                uniqueProductsByIds[productId]["available"] = false;
                            }
                        });
                    });

                    for (let i = 0; i < rulesVisibilityArrayForTags.length; i++) {
                        let rule = rulesVisibilityArrayForTags[i];

                        let operator = "OR";
                        let currentMatchedItems;
                        if (operator == "OR") {
                            Object.keys(rule).forEach(item => {
                                currentMatchedItems = uniqueProducts.filter((product) => {
                                    if (product.tags.includes(item)) {
                                        return product;
                                    }
                                })



                                // clean currentMatchedItems to not return undefined


                                if (rule[item] == 1) {
                                    currentMatchedItems.forEach((product) => {
                                        if (product?.productId) {
                                            onlyShownProducts.push(product?.productId)
                                        }
                                    })
                                }

                                if (rule[item] == -1) {
                                    // hide the product
                                    // find the detail in uniqueProductsByIds and set available to false
                                    let findSameTagValue = uniqueProducts.find((product) => {
                                        return product.tags.includes(item)
                                    })

                                    if (findSameTagValue && uniqueProductsByIds[findSameTagValue.productId]) {
                                        uniqueProductsByIds[findSameTagValue.productId]["available"] = false
                                    }
                                }
                            });
                        } else {
                            let isMatchedItemForEveryRule;




                        }

                    }

                    let categoryUniqueProductsData;
                    if (onlyShownProducts.length > 0) {
                        category.uniqueProductsData = onlyShownProducts.map(productId => uniqueProductsByIds[productId]).filter(product => product.available !== false);
                    } else {
                        category.uniqueProductsData = Object.values(uniqueProductsByIds).filter(product => product.available !== false);

                    }
                });

                return allCategories;
            } catch (err) {
                console.error("Error occurred:", err);
                // It seems there's a missing definition for allCategories here in the catch block. Assuming it should return an empty object or similar fallback.
                return {}; // or perhaps return the input unmodified or as best fits your error handling strategy
            }
        },
        convertCamelCaseToKebabCase: function (str) {
            try {
                return str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();

            } catch (error) {
                gbb.utility.debugError("error in convertCamelCaseToKebabCase", error);
            }
        },
        setCustomDesignConfigurationValues: function () {
            try {
                let root = document.documentElement;
                let pageCustomizationData = gbb.settings.pageCustomizationData || {}
                const keysToMap = ["productCard", "navigationBanner", "cartFooter"]
                keysToMap.forEach((key) => {
                    let currentKey = pageCustomizationData[key] || {}
                    Object.keys(currentKey).forEach((key) => {
                        let value = currentKey[key];
                        if (value) {
                            let _key = gbb.f.convertCamelCaseToKebabCase(key);
                            root.style.setProperty(`--gbb-${_key}`, value);
                        }

                    })
                })

            } catch (error) {
                gbb.utility.debugConsole("error in setCustomDesignConfigurationValues", error);
            }
        },
        initialize: async function (jQuery) {
            //renderLandingPage(); ->

            //show a loading screen
            gbb.$(".gbbPageFooterHTML").html("<div class='gbbLoadingScreen'><div class='gbbLoadingScreenSpinner'>    </div></div>");
            gbb.$(".gbbLoadingScreen").css("background", gbb?.settings?.app?.loadingBgColor);
            //TODO uncomment
            let tmpCartSettings = await gbb.f.getSettings();
            // tmpCartSettings = gbb.f.modifySettings(tmpCartSettings);
            gbb.f.setSettings(tmpCartSettings)
            gbb.f.setCustomDesignConfigurationValues();
            gbb.f.setSelectors()
            gbb.f.setDefaultThemeStyles();
            // gbb.f.setCustomStyling()
            // gbb.state.page_type = gbb.f.getPageType();
            gbb.elements = gbb.f.getElements(gbb.settings);
            // if ("" === gbb.state.page_type) return false;
            gbb.utility.setLanguageLocale();
            gbb.utility.gbbMultiLangOverrider();
            return gbb.f.bootstrap(gbb.settings);
        },
        globalListener: async function (settings) {
            let isIntervalActive = false
            //if app is disabled reurn
            if (settings?.app?.disableApp) {
                return "<div>App is unavailable</div>"
            } else {
                //gbb.gbbPage.init();
                // initialization will call get settings
                // and therefore we will have the data globally
                //
                gbb.state.cartData = await gbb.utility.getCart()

                // gbb.gbbMainPage.init();
                // gbb.gbbFooter.init();
                // gbb.utility.debugConsole(gbb.settings.languageData);

                gbb.giftboxbuilderPage.init();
            }
        },

        modifySettings: function (settings) {
            try {
                let currentBundleTemplate = settings.stepsConfigurationData.bundleDesignTemplate;

                //    let oldSettings = JSON.parse(JSON.stringify(settings))

                if (currentBundleTemplate && settings.pageCustomizationData?.templateLevelConfig) {
                    settings.pageCustomizationData = settings.pageCustomizationData?.templateLevelConfig[currentBundleTemplate] || settings.pageCustomizationData
                }



                return settings;
            } catch (e) {
                gbb.utility.debugConsole("error in modifySettings", e)
                return settings;
            }
        },
    },
    utility: {
        getcachedProductData: async function (fetchsixtyProductsEachStep) {
            // convert map to array 
            // let cachedProductData = Array.from(gbb.state.cachedProductData.entries());
            // call getProductDataV2 data in batch of 20
            setTimeout(async () => {
                // gbb.utility.debugConsole("getcachedProductData")
                while (fetchsixtyProductsEachStep.length > 0) {
                    let batch = fetchsixtyProductsEachStep.splice(0, 20)
                    let apiCalls = []
                    for (let i = 0; i < batch.length; i++) {
                        apiCalls.push(gbb.utility.getProductDataV2(batch[i]))
                    }
                    await Promise.all(apiCalls)
                }
            },
                1000)

        },
        getcachedProductDataForGraphql: async function (fetchsixtyProductsEachStep) {
            if (gbb.settings.merchantInfo.storefrontAccessToken) {

                // fetchsixtyProductsEachStep.forEach(item=> {
                //     item = "gid://Product/"+ item
                // });

                for (let i = 0; i < fetchsixtyProductsEachStep.length; i++) {
                    let item = fetchsixtyProductsEachStep[i];
                    fetchsixtyProductsEachStep[i] = "gid://shopify/Product/" + item
                    // "gid://shopify/Product/9170602688797"
                }

                let graphQLProductsData = [];

                setTimeout(async () => {
                    // gbb.utility.debugConsole("getcachedProductData")
                    while (fetchsixtyProductsEachStep.length > 0) {
                        let batch = fetchsixtyProductsEachStep.splice(0, 20)
                        // let starttime = 
                        // console.time("fetch-1");
                        let graphQLFetchedData = await gbb.graphQlUtility.getProductsDataByIds(fetchsixtyProductsEachStep.splice(0, 20))
                        graphQLProductsData.push(...graphQLFetchedData)
                        // console.timeEnd("fetch-1")

                        // let apiCalls = []
                        // for (let i = 0; i < batch.length; i++) {
                        //     // apiCalls.push(gbb.utility.getProductDataV2(batch[i]))
                        //     apiCalls.push(gbb.graphQlUtility.getProductsDataByIds(batch[i]))
                        // }
                        // console.time("fetch-2-sync");
                        // await Promise.all(apiCalls)
                        // console.timeEnd("fetch-2-sync");



                    }

                },
                    1000)
            }
            // convert map to array 
            // let cachedProductData = Array.from(gbb.state.cachedProductData.entries());
            // call getProductDataV2 data in batch of 20

        },
        getDynamicDiscountCode: async function () {
            // gbb.utility.getCartDataAfterDiscount()
            // gbb.utility.debugConsole('dyamic called')


            // if kite integration is enabeld then also retyrn early

            let discountData = gbb.settings.discountsData || {}
            if (discountData?.discountMode == 'PRODUCT_SPECIFIC_DISCOUNT' && discountsData?.isKiteIntegrationEnabled) {
                //no need to compute code, just send it back early
                return
            }
            

            if (!gbb.gbbDiscountComponent.state.isAtleastOneDiscountActive) {
                return;
            }

            // let cartData = gbb.gbbDiscountComponent.f.discountEligibleCartData();
            // const bundleQuantity = cartData.bundleQuantity;

            // let cartData = gbb.state.giftBoxCartData;
            // const productIdsPresentInCart = cartData?.items?.map((item) => {
            //     return item?.product_id
            // })


            let bundleDataObj = gbb.utility.calculateCartDiscount();

            const productIdsPresentInCart = bundleDataObj?.cartProductListForDiscounts.map(item => parseInt(item))
            const variantIdsPresentInCart = bundleDataObj?.cartVariantListForDiscounts.map(item => parseInt(item))
            let VariantListPricePresentInCart = bundleDataObj?.cartVarientPriceListForDiscounts;

            let activeCurrencyRate = gbb.utility.getActiveCurrencyRate();
            // let cartTotalAmount = bundleDataObj.cartTotalAmount;
            let cartSubtotalAmount = bundleDataObj.cartSubTotal;

            VariantListPricePresentInCart = VariantListPricePresentInCart.map((price) => {
                return price / parseFloat(activeCurrencyRate)
            })



            let cartValue = cartSubtotalAmount / 100;
            let convertCartValueToStoreCurrencyValue = cartValue / activeCurrencyRate

            let cartDiscount = bundleDataObj.cartDiscount / parseFloat(activeCurrencyRate)
            let cartTotalQty = bundleDataObj.cartTotalQty;
            let discountAmountToBeApplied = cartDiscount / 100;

            if (discountAmountToBeApplied > 0 == false) {
                // gbb.utility.debugConsole("discountAmountToBeApplied is 0")
                return;
            }

            let discountsPerBoxWithCorrectedPrices = {}
            for (let i = 0; i < Object.keys(bundleDataObj?.discountsPerBox).length; i++) {
                let _boxKey = Object.keys(bundleDataObj.discountsPerBox)[i];
                let _boxValue = JSON.parse(JSON.stringify(bundleDataObj.discountsPerBox[_boxKey]));
                _boxValue.boxDiscount = (_boxValue.boxDiscount / 100) / activeCurrencyRate
                _boxValue.boxSubTotal = (_boxValue.boxSubTotal / 100) / activeCurrencyRate
                _boxValue.boxTotalAmount = (_boxValue.boxTotalAmount / 100) / activeCurrencyRate

                discountsPerBoxWithCorrectedPrices[_boxKey] = _boxValue;
            }


            let bodyToBePassed = {
                type: "quantity",
                currency: activeCurrencyRate,
                cartValue: convertCartValueToStoreCurrencyValue,
                bundleId: gbb.state.bundleId,
                discountsPerBox: discountsPerBoxWithCorrectedPrices,
                cartQuantity: cartTotalQty,
                productIds: productIdsPresentInCart,
                variantIds: variantIdsPresentInCart,
                productHandles: bundleDataObj?.cartProductHandlesForDiscounts,
                variantListPrice: VariantListPricePresentInCart,
                discountValue: discountAmountToBeApplied,
                discountCodePrefix: gbb.gbbDiscountComponent.state.discountCodePrefix,
                deviceDetails: navigator && navigator.userAgent ? navigator.userAgent : "Couldnt find device details"
            }

            if (gbb.settings.discountsData.discountMode === "FIXED_BUNDLE_PRICE") {
                bodyToBePassed["type"] = "quantity"
            }
            else if (gbb.gbbDiscountComponent.state.currentDiscountRule?.type === "quantity") {
                bodyToBePassed["type"] = gbb.gbbDiscountComponent.state.currentDiscountRule.type
            } else if (gbb.gbbDiscountComponent.state.currentDiscountRule?.type === "amount") {
                bodyToBePassed["type"] = gbb.gbbDiscountComponent.state.currentDiscountRule.type
            } else {
                bodyToBePassed["type"] = "amount"
            }

            let endPoint = "/dynamicDiscountCodeV2";
            const subscriptionPlanExists = gbb.gbbReviewPage.f.checkIfSubscriptionPlanExists();
            if (subscriptionPlanExists && gbb.gbbBrowser.getSubscriptionType() == "saveSubscription") {
                bodyToBePassed["enableRecurringDiscounts"] = gbb.settings?.stepsConfigurationData?.enableRecurringDiscounts || false;
                bodyToBePassed["subscriptionDiscount"] = true;
                endPoint = "/dynamicDiscountCodeV2"
            }
            const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()
            if (isPurchaseTypeSubscription) {
                bodyToBePassed["enableRecurringDiscounts"] = gbb.settings?.stepsConfigurationData?.enableRecurringDiscounts || false;
                bodyToBePassed["subscriptionDiscount"] = true;
                endPoint = "/dynamicDiscountCodeV2"
            }
            await fetch("/apps/" + gbb.state.gbbUrl + `${endPoint}?bundleId=${gbb.state.bundleId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(bodyToBePassed)
            }).then((response) => {
                return response.json();
            }).then((data) => {
                if (data) {
                    gbb.utility.debugConsole("discount code", data.data.code);
                    gbb.gbbDiscountComponent.state.discountCode = data.data.code;
                }
            }).catch((error) => {
                gbb.utility.debugConsole(error);
            });
        },
        setCachedGraphqlData: function (data) {
            try {
                // TODO: graphql or REST
                // cachedProductDataGraphql or cachedProductData..... confused
                let cachedProductData = gbb.state.cachedProductDataGraphql;

                for (let i = 0; i < data.length; i++) {
                    let item = data[i];
                    let productId = item?.id;
                    let productData = item;
                    cachedProductData.set(productId, productData)
                }
            } catch (e) {
                gbb.utility.debugConsole("error in setCachedGraphqlData", e)
            }
        },
        getLocale: function () {
            if (window.Shopify && window.Shopify.locale) {
                return window.Shopify.locale
            } else {
                return "en"
            }
        },
        getCountry: function () {
            if (window.Shopify && window.Shopify.country) {
                return Shopify.country
            }
        },
        setLanguageLocale: function () {
            let locale = gbb.utility.getLocale()
            gbb.state.languageMode = gbb.settings.languageData.languageMode
            if (gbb.settings.languageData && gbb.settings.languageData.languageMode == "SINGLE") {
                locale = "en"
            }

            if (!gbb.settings.languageData[locale]) {
                locale = "en"
            }
            gbb.settings.languageData = gbb.settings.languageData[locale]
        },
        getNavItem: function (id) {
            let navigationItems = gbb.state.navigationItems;
            let navigationItem = navigationItems.filter(function (item) {
                return item.id === id;
            })
            return navigationItem[0];
        },
        disableElement: function (element, timeInMs) {
            //use this function to disable element for a specific time,
            // most likely to prevent double click
            element.prop("disabled", true);
            element.addClass("gbbDisabled");
            if (timeInMs >= 0) {
                setTimeout(function () {
                    element.prop("disabled", false);
                    element.removeClass("gbbDisabled");
                }, timeInMs);
            }
        },
        getNextNavigationItem: function () {

            let navigationItems = gbb.gbbModal.state.navigationItems;
            let currentNavigationId = gbb.gbbModal.state.currentNavigationId;

            let currentNavigationItem = gbb.gbbModal.f.getNavItem(currentNavigationId);

            // find the index of the current navigation item
            let currentNavigationIndex = navigationItems.indexOf(currentNavigationItem);
            // gbb.utility.debugConsole(currentNavigationIndex);
            // get the next navigation item making sure its not the last one, if its then return null
            if (currentNavigationIndex === navigationItems.length - 1) {
                return null;
            }
            else {
                return navigationItems[currentNavigationIndex + 1];
            }
        },
        isNavElementLast: function (id) {
            // if it is last then return null
            let navigationItems = gbb.gbbModal.state.navigationItems;
            let currentNavigationId = id;

            //check if the passed id is the last one
            let currentNavigationItem = gbb.gbbModal.f.getNavItem(currentNavigationId);
            let currentNavigationIndex = navigationItems.indexOf(currentNavigationItem);
            if (currentNavigationIndex === navigationItems.length - 1) {
                return true;
            }
            else {
                return false;
            }
        },
        getDate: function (date) {
            let d = new Date(date);
            let month = "" + (d.getMonth() + 1);
            let day = "" + d.getDate();
            let year = d.getFullYear();

            if (month.length < 2) month = "0" + month;
            if (day.length < 2) day = "0" + day;

            return [year, month, day].join("-");
        },
        addToCart: async function ({ variant, parent, qty = 1 }, noteAttribute, category = undefined, defaultProduct = undefined) {
            try {
                if (qty == 0) {
                    return
                }
                let data = {
                    updates: { [variant.id]: qty },
                    attributes: {
                        [variant.id]: noteAttribute,
                    }
                }

                if (category && category != "") {
                    data.attributes.category = category
                    data.attributes.categoryName = gbb.gbbAddProductsPage?.state?.productPageData?.categories[category].title || category
                }

                if (defaultProduct && defaultProduct != "") {
                    data.attributes.defaultProduct = true
                }


                // if properties and variant ids are the same then just add their quantities respective



                await gbb.utility.updateCartV2(data)
                if (false && gbb.$(".gbbProductsCardLayoutV2").length > 0) {
                    let isCurrentPageExhausedATCFooterAnimation = gbb?.gbbAddProductsPage?.state?.pagesWhichHaveExhaustedATCFooterAnimation?.includes(gbb?.state?.currentPageId);
                    //true replace true with actual toggle key when implemented from admin
                    let isATCAnimationEnabled = gbb?.gbbAddProductsPage?.state?.isAnimateFooterOnATCEnabled
                    let isAddingFirstProductToCart = gbb?.state?.giftBoxCartData?.items?.length == 1 && gbb?.state?.giftBoxCartData?.items[0]?.quantity == 1
                    if (isATCAnimationEnabled && (isAddingFirstProductToCart || !isCurrentPageExhausedATCFooterAnimation)) {
                        let currentPageId = gbb?.state?.currentPageId;
                        setTimeout(() => {
                            let isFooterOpen = gbb?.gbbAddProductsPage?.state?.showBoxProductsInFooter || false
                            if (!isFooterOpen) {
                                gbb.gbbAddProductsPage.f.toggleBoxProductsDisplayFooter()
                                !isCurrentPageExhausedATCFooterAnimation && gbb?.gbbAddProductsPage?.state?.pagesWhichHaveExhaustedATCFooterAnimation?.push(currentPageId)
                                setTimeout(() => gbb.gbbAddProductsPage.f.toggleBoxProductsDisplayFooter(), 3000)
                            }
                        }, 100)// doing this cause once file is loaded then will can get smooth animation without setTimeout its rendering the open footer direct
                    }
                }
            } catch (error) {
                gbb.utility.debugError("gbb-utility-addToCart");
                gbb.utility.debugError(error);
                return false
            }
        },
        updateCart: async function (data) {
            try {
                let result = await gbb.$.ajax({
                    type: "POST",
                    url: "/cart/update.js",
                    data: data,
                    dataType: "json",
                });
                return result
            } catch (error) {
                gbb.utility.debugError("gbb-utility-updateCart");
                gbb.utility.debugError(error);
                return false
            }
        },
        updateCartV2: async function (data, noteAttribute) {
            try {

                let variantId = Object.keys(data.updates)[0];

                let quantity = data.updates[variantId];

                let originForVariantDetails = data.attributes[variantId] == "addonProduct" ? "addonProducts" :null
                let productItem = gbb.utility.getVariantDetailsFromCurrentProductsDataSet(variantId, originForVariantDetails) || {};

                if (productItem && productItem != "undefined") {
                }
                else {
                    // gbb.utility.debugConsole("variantId is undefined");
                    // return;
                }

                let result;
                //in data.attributes we get key value pair, but we only need the value
                let attributes = data?.attributes || {}
                // let additionalProperties = {}
                let _properties = {
                    "_boxProduct": data?.attributes[variantId],
                    // "_Bundle ID": gbb.state.bundleId,
                    "Bundle": gbb.settings?.stepsConfigurationData?.bundleName || "",
                    "Box ID": gbb.state?.activeBoxId?.split("box")[1] || 1,

                    "_uniqueGbbItemKey": data?.additionalInfo?._uniqueGbbItemKey || gbb.utility.getUniqueIdForVariant({ variantId, attributes: data.attributes }),
                    ...gbb.state.variantCustomProperties
                }
                if (data?.attributes[variantId] == 'addonProduct') { 
                    _properties["_addon_product"] = true;
                    // _properties["_addon_offer_id"] = gbb.gbbAddonProducts.state.offerId
                }
                //this is for storing the  category name on multiple categories step
                if (data?.attributes.category) {
                    _properties["_Category"] = data?.attributes.category;
                    _properties["_CategoryName"] = data?.attributes.categoryName;
                }

                if (data?.attributes.defaultProduct) {
                    _properties["_DefaultProduct"] = "Yes";
                }

                if (data?.attributes[variantId] == "giftMessage") {
                    let msgAttributes = gbb.utility.prepareMsgAttributesForCart();
                    if (msgAttributes.message) {
                        _properties["Message"] = msgAttributes.message
                    }

                    if (msgAttributes.recipientName) {
                        _properties["Recipient Name"] = msgAttributes.recipientName
                    }

                    if (msgAttributes.senderName) {
                        _properties["Sender Name"] = msgAttributes.senderName
                    }

                    if (msgAttributes.email) {
                        _properties["Recipient Email"] = msgAttributes.email
                    }
                    if (msgAttributes._videoMsgId) {
                        _properties["_videoMsgId"] = msgAttributes._videoMsgId
                        _properties["Video Recorded"] = msgAttributes._videoMsgId ? "yes" : "";
                    }
                    if (msgAttributes._gbbEmailDeliveryDate) {
                        _properties["_gbbEmailDeliveryDate"] = msgAttributes._gbbEmailDeliveryDate;
                    }
                    if (msgAttributes._gbbEmailDeliveryOption) {
                        _properties["_gbbEmailDeliveryOption"] = msgAttributes._gbbEmailDeliveryOption;
                    }

                    // if(msgAttributes.customerUploads){
                    //     _properties["Customer Uploads"] = msgAttributes.customerUploads;
                    // }

                    if (msgAttributes.customerUploads) {
                        //use spread operator and add the customerUploads property to the _properties object
                        _properties = { ..._properties, ...msgAttributes.customerUploads }
                    }

                }
                let argsObj = {
                    properties: _properties,
                    variantId: variantId,
                }

                let uniqueItemKey = _properties?._uniqueGbbItemKey || gbb.utility.getUniqueIdForVariant(argsObj);
                const item = gbb.utility.checkIfItemPresentInGiftBoxCart(variantId, { uniqueItemKey });

                if (item) {
                    // if item is present in cart then update the qty using the change attribute method
                    let _data = {
                        id: item.key || item.id,
                        quantity: quantity,
                        properties: {
                            ...item.properties,
                            ..._properties
                        }
                    }
                    result = await gbb.utility.changeCart(_data);
                }
                else {
                    // if item is not present in cart then add it using the add attribute method
                    let _data = {
                        id: variantId,
                        quantity: quantity,
                        properties: _properties
                    }
                    if (_data.quantity != 0) {
                        gbb.gbbBrowser.addItemToCartSessionStorage({ ..._data, ...productItem });
                    }
                }

                gbb.state.giftBoxCartData = await gbb.utility.getGiftBoxProductsFromCart()
                gbb.gbbDiscountComponent.f.updateCurrentDiscountRule();
                gbb.gbbAddonProducts.f.calculateEligibleAddonProductsTier()
                gbb.gbbBrowser.emitCustomEvent({
                    eventName: "gbb-cart-update",
                    detail: {
                        variantId: variantId,
                        // quantity: item - quantity,
                    }
                })
                return result
            } catch (error) {
                gbb.utility.debugError("gbb-utility-updateCartV2");
                gbb.utility.debugError(error);
                return false
            }
        },
        changeCart: async function (data) {
            try {
                return gbb.gbbBrowser.updateCartItemQuantityAndProperty(data.id, data.quantity, data.properties);
                let result = await gbb.$.ajax({
                    type: "POST",
                    url: "/cart/change.js",
                    data: data,
                    dataType: "json",
                });
                return true
            } catch (error) {
                gbb.utility.debugError("gbb-utility-changeCart");
                gbb.utility.debugError(error);
                return false
            }
        },
        getAttributValueFromCart: function (attributeName) {
            if (gbb.state.giftBoxCartData && gbb.state.giftBoxCartData.attributes && gbb.state.giftBoxCartData.attributes[attributeName] && gbb.state.giftBoxCartData.attributes[attributeName] != "") {
                return gbb.state.giftBoxCartData.attributes[attributeName]
            } else {
                return null
            }
        },
        getProductsInDefaultView: function () {
            return gbb.gbbAddProductsPage.state.uniqueProductsData;
        },
        getCurrencySymbolByCode: function (code) {
            try {
                let merchantCurrencies = gbb?.settings?.merchantInfo?.multipleCurrenciesInfo;
                if (merchantCurrencies.hasOwnProperty(code)) {
                    return merchantCurrencies[code]?.symbol;
                }
                return "";
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        setStoreCurrenyStateFromCart: async function () {
            try {
                if (gbb.state.storeCurrencySymbol) {
                    return;
                } else {
                    if (window && window.Shopify && window.Shopify.currency && window.Shopify.currency.active) {
                        gbb.state.storeCurrencySymbol = gbb.utility.getCurrencySymbol();
                    } else {
                        let _shopifyCartData = await gbb.shopifyUtility.getCart();
                        gbb.state.storeCurrencySymbol = gbb.utility.getCurrencySymbolByCode(_shopifyCartData?.currency);
                    }
                }
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        formatPrice: function (price) {
            if (window && window.Shopify && window.Shopify.currency && window.Shopify.currency.active) {
                //find the currency symbol from  gbb.settings.merchantInfo.multipleCurrencies[window.Shopify.currency.active] get the symbol
                let currencySymbol = gbb.utility.getCurrencySymbol();
                return currencySymbol + "" + parseFloat(price / 100).toFixed(2)
            } else {
                return gbb.state.storeCurrencySymbol + "" + parseFloat(price / 100).toFixed(2)
            }
        },
        formatPriceWithoutSymbol: function (price) {
            if (window && window.Shopify && window.Shopify.currency && window.Shopify.currency.active) {
                //find the currency symbol from  gbb.settings.merchantInfo.multipleCurrencies[window.Shopify.currency.active] get the symbol
                return parseFloat(price / 100).toFixed(2)
            } else {
                return parseFloat(price / 100).toFixed(2)
            }
        },

        //calculate cartDiscount uses getCartDataFromSessionStorage, gets the entire data.
        //then we loop on boxes object and inside each object we use
        //we have discountValue as a variable stored in it,
        // depending on the discountMode we will calculate the discount we have to offer
        //we will multiply the discountValue by boxQuantity and also multiply the quantity of each product by boxQuantity
        // the values returned are cartSubTotal: - 1900
        // cartDiscount: - 520
        // cartTotalAmount - 1380
        // cartTotalqty -
        // cartProductListForDiscounts: []
        calculateCartDiscount: function (cartData) {
            if (!cartData) {
                cartData = gbb.gbbBrowser.getCartDataFromSessionStorage({ forSubscription: true });
            }
            // let cartData = gbb.gbbBrowser.getCartDataFromSessionStorage();

            //all the prices in this function are in shopify formats. 
            //.i.e. 100 = 1.00

            let cartSubTotal = 0;
            let cartDiscount = 0;
            let cartTotalAmount = 0;
            let cartTotalQty = 0;
            let cartBlacklistedItemsTotal = 0;
            let cartProductListForDiscounts = [];
            let cartProductHandlesForDiscounts = [];
            let cartVariantListForDiscounts = [];
            let cartVarientPriceListForDiscounts = [];
            let discountMode = gbb.settings.discountsData.discountMode
            let discountsPerBox = {}

            if (gbb.settings.discountsData.isKiteDiscountMessagingEnabled){
                discountMode = gbb.settings.discountsData.kiteDiscountMessaging.discountMode;
            }

            if (cartData && cartData.boxes) {
                Object.keys(cartData.boxes).forEach((item) => {
                    let box = cartData.boxes[item];
                    box = gbb.gbbDiscountComponent.f.discountEligibleCartData(box);
                    //let discountValue = gbb.gbbDiscountComponent.state.currentDiscountRule[box.boxId]?.discountValue || box.discountValue;
                    let discountValue = gbb.gbbDiscountComponent.state.currentDiscountRule[box.boxId]?.discountValue;
                    discountValue = parseFloat(discountValue);
                    let discountValueIsNumber = !isNaN(discountValue) && typeof discountValue == "number";

                    if (discountValueIsNumber && discountMode == "FIXED" || discountMode == "FIXED_BUNDLE_PRICE") {
                        discountValue = parseFloat(discountValue) * 100;
                        let activeCurrencyRate = gbb.utility.getActiveCurrencyRate();
                        discountValue = discountValue * activeCurrencyRate;
                    }


                    let boxQuantity = box.boxQuantity;
                    let boxItemCount = box.item_count;
                    let boxPrice = box.total_price;
                    let boxDiscount = 0;
                    let boxTotalAmount = box.total_price * boxQuantity;
                    let boxTotalQty = box.boxQuantity;

                    let boxProductList = [];
                    let boxProductHandleList = [];
                    let boxVariantList = [];
                    let boxVarientPriceList = [];
                    //check if discountValue in not Nan, or undefinded, or null, check the type of discountValue
                    if (discountValueIsNumber) {
                        if (discountMode == "FIXED") {
                            boxDiscount = discountValue * boxQuantity;
                            boxTotalAmount = ((boxPrice * boxQuantity) - boxDiscount)
                            boxTotalQty = boxQuantity;
                        } else if (discountMode == "PERCENTAGE") {
                            boxDiscount = ((boxPrice * discountValue) / 100) * boxQuantity;
                            boxTotalAmount = ((boxPrice * boxQuantity) - boxDiscount);
                            boxTotalQty = boxQuantity;
                        } else if (discountMode == "FIXED_BUNDLE_PRICE") {
                            boxDiscount = (boxPrice - discountValue) * boxQuantity;

                            //this is written because a floating point error came
                            // boxPrice = 3980
                            // discountValue =3979.9999995
                            if (boxDiscount > 0.0001) {
                                boxDiscount = boxDiscount;
                            } else {
                                boxDiscount = 0;
                            }

                            boxTotalAmount = discountValue * boxQuantity;
                            boxTotalQty = boxQuantity;
                        }
                    }
                    cartSubTotal += boxPrice * boxQuantity;
                    cartDiscount += boxDiscount;
                    cartTotalAmount += boxTotalAmount;
                    cartTotalQty += (boxTotalQty * boxItemCount);


                    if (isNaN(box.blackListedItemsTotalPrice)) {
                        box.blackListedItemsTotalPrice = 0;
                    }

                    cartBlacklistedItemsTotal += box.blackListedItemsTotalPrice;
                    discountsPerBox[box.boxId] = {
                        boxDiscount: boxDiscount,
                        boxSubTotal: boxPrice * boxQuantity,
                        boxTotalAmount: boxTotalAmount,
                        boxTotalQty: boxTotalQty * boxItemCount,
                        boxQuantity: boxQuantity,
                        blackListedItemsTotalPrice: box.blackListedItemsTotalPrice,
                    }
                    // boxProductList = box.products.map((product) => 
                    //push the product.id in the boxProductList
                    box.items.forEach((product) => {
                        if (product.price > 0) {
                            boxProductHandleList.push(product.productHandle)
                            boxProductList.push(product.product_id)
                        }
                    })
                    box.items.forEach((product) => {
                        if (product.price > 0) {
                            boxVariantList.push(product.id)
                            boxVarientPriceList.push(product.price / 100)
                        }
                    })
                    cartProductListForDiscounts.push(boxProductList)
                    cartProductHandlesForDiscounts.push(boxProductHandleList)
                    cartVariantListForDiscounts.push(boxVariantList)
                    cartVarientPriceListForDiscounts.push(boxVarientPriceList)
                })
            }

            //if either of the number is not a number, then return 0
            if (isNaN(cartSubTotal)) {
                cartSubTotal = 0;
            }
            if (isNaN(cartDiscount)) {
                cartDiscount = 0;
            }
            if (isNaN(cartTotalAmount)) {
                cartTotalAmount = 0;
            }
            if (isNaN(cartTotalQty)) {
                cartTotalQty = 0;
            }
            if (isNaN(cartBlacklistedItemsTotal)) {
                cartBlacklistedItemsTotal = 0;
            }


            return {
                cartSubTotal: cartSubTotal,
                cartBlacklistedItemsTotal: cartBlacklistedItemsTotal,
                cartDiscount: cartDiscount,
                cartTotalAmount: cartTotalAmount,
                cartTotalQty: cartTotalQty,
                cartProductListForDiscounts: cartProductListForDiscounts.flat(),
                cartProductHandlesForDiscounts: cartProductHandlesForDiscounts.flat(),
                cartVariantListForDiscounts: cartVariantListForDiscounts.flat(),
                cartVarientPriceListForDiscounts: cartVarientPriceListForDiscounts.flat(),
                discountsPerBox: discountsPerBox,
            }
        },
        removeUnUsedVariantImages: function (product) {
            try {
                const usedMediaIds = new Set();
                product.variants.forEach(variant => {
                    if (variant.featured_media) {
                        usedMediaIds.add(variant.featured_media.id);
                    }
                });

                let allMediasSortedByAltKey = gbb.utility.convertArrayToObjectWithArrays(product.media, "alt");



                // this issue arises whe we find that 
                // not all variants have an image associated with it
                // in that case, all images are product base images
                if (usedMediaIds.size < 1) {
                    return product;
                }

                product.media = product.media.filter(media => usedMediaIds.has(media.id));


                // use the alt key present in the media object to get the media object from allMediasSortedByAltKey
                // and then push it to product.media

                let filteredMedia = JSON.parse(JSON.stringify(product.media));

                filteredMedia.forEach(media => {
                    if (!media.alt){
                        media.alt = media?.id;
                    }
                    let _media = allMediasSortedByAltKey[media.alt];

                    if (_media) {
                        if (_media.length) {
                            product.media.push(..._media);
                        }
                    }
                });

                // sort media by position
                product.media.sort((a, b) => a.position - b.position);
                //  remove duplicates after sorting
                product.media = product.media.filter((media, index, self) =>
                    index === self.findIndex((t) => (
                        t.id === media.id
                    ))
                )



                const usedImageUrls = new Set(product.media.map(media => media.src));

                product.images = product.images.filter(imageUrl => {
                    const httpsImageUrl = imageUrl.startsWith('//') ? 'https:' + imageUrl : imageUrl;
                    return usedImageUrls.has(httpsImageUrl);
                });


                return product;
            } catch (error) {
                gbb.utility.debugConsole("error in removeUnUsedVariantImages", error)
            }
        },

        shiftFirstVariantMedia_toFirstIndexInMediaObj: function (product) {
            try {
                product = JSON.parse(JSON.stringify(product));
                if (product.variants.length > 0) {
                    let firstVariant = product.variants[0];
                    if (firstVariant.featured_media) {
                        let featuredMedia = firstVariant.featured_media;
                        let featuredMediaIndex = product.media.findIndex(media => media.id == featuredMedia.id);
                        if (featuredMediaIndex > -1) {
                            let featuredMedia = product.media.splice(featuredMediaIndex, 1);
                            product.media.unshift(featuredMedia[0]);
                        }
                    }
                }
                return product;
            } catch (error) {
                gbb.utility.debugConsole("error in shiftFirstVariantMedia_toFirstIndexInMediaObj", error)
            }
        },


        getProductData_AfterRemovingUnavailableVariantsAndOptions: function (product) {
            try {
                let productData = JSON.parse(JSON.stringify(product));
                productData.variants = productData?.variants?.filter(variant => variant.available);

                productData.options = productData.options.map(option => {
                    // For each option, filter the values that are included
                    //  in at least one of the variant
                    let values = option.values.filter(value => {
                        for (let variant of productData.variants) {
                            // If the variant's options include the value, 
                            // return true to include it in the filter
                            if (variant.options.includes(value)) {
                                return true;
                            }
                        }
                        // If the value is not found in any variant's options,
                        // return false to exclude it from the filter
                        return false;
                    });

                    // Return the new option object, spreading the previous option 
                    //properties and replacing the 'values' with the filtered ones
                    return {
                        ...option,
                        values
                    };
                })

                //check if productData.variants and productData.options are the same as product.variants and product.options
                //if yes, then return productData : with a removedVariantsAndOptions flag
                if (productData.variants.length != product.variants.length || productData.options.length != product.options.length) {
                    // productData.removedVariantsAndOptions = true;
                    productData.renderChooseOptionsButton_forcefully = true;
                } else {
                    productData.renderChooseOptionsButton_forcefully = false;
                }

                // productData.price = productData.variants[0].price || productData.price
                if (productData.variants && productData.variants.length > 0) {
                    productData.price = productData.variants[0].price || productData.price
                    productData.compare_at_price = productData.variants[0].compare_at_price || productData.compare_at_price
                }

                return productData;
            } catch (error) {
                gbb.utility.debugConsole("error in getProductData_AfterRemovingUnavailableVariantsAndOptions", error)
            }
        },
        getCurrencySymbol: function () {
            if (window && window.Shopify && window.Shopify.currency && window.Shopify.currency.active) {
                let symbol = gbb.settings.merchantInfo.multipleCurrenciesInfo[window.Shopify.currency.active]?.symbol || Shopify.currency.active;
                return symbol;
            } else {
                return gbb.state.storeCurrencySymbol;
            }
        },
        getStoreCurrencySymbol: function () {
            return gbb.settings.merchantInfo.currencyInfo.symbol;
        },

        getProductDataV2: function (productName, options) {
            try {
                let languageValue = window?.Shopify?.routes?.root ? window.Shopify.routes.root : "/"
                return new Promise(async (res, rej) => {
                    if (gbb.state.cachedProductData.has(productName)) {
                        res(gbb.state.cachedProductData.get(productName));
                    } else {
                        let productHandlesAreTranslated = gbb.settings.app.productHandlesAreTranslated || false;
                        let flowForFetch;

                        if (productHandlesAreTranslated && options?.dontRetry != true) {
                            flowForFetch = "HANDLE_TRANSLATED_HANDLES";
                        } else {
                            flowForFetch = "FETCH_DEFAULT_HANDLES";
                        }

                        if (flowForFetch === "FETCH_DEFAULT_HANDLES") {
                            gbb.$.getJSON(languageValue + "products/" + productName + ".js", function (product) {
                                product = gbb.gbbKite.f.modifyProductDataWithDiscountedPrice(product);
                                gbb.state.cachedProductData.set(productName, product);
                                res(product);
                            }).fail(function () {
                                gbb.utility.debugConsole("fail-productName: ", productName);
                                gbb.state.cachedProductData.set(productName, false);
                                res(false);
                            });
                        } else if (flowForFetch === "HANDLE_TRANSLATED_HANDLES") {
                            let _updated = await gbb.utility.getProductDataForTranslatedHandles(productName, languageValue);
                            res(_updated);
                        }
                    }
                });

                return result;
            } catch (error) {
                gbb.utility.debugError("gbb-utility-getProductDataV2");
                gbb.utility.debugError(error);
                return false
            }
        },
            getProductDataForTranslatedHandles: function (productName, languageValue) {
            return new Promise((res, rej) => {
                fetch(languageValue + "products/" + productName)
                    .then(async (response) => {
                        if (!response.ok) throw new Error("Network response was not ok");
                        gbb.utility.debugConsole("Final URL:", response.url); // Log the final redirected URL
                        // response.url = response.url.trim().endsWith("/") ? response.url.slice(0, -1) : response.url;
                        let urlReturned = response.url;

                        // Remove the last character if it is a '/'
                        if (urlReturned[urlReturned.length - 1] === "/") {
                            urlReturned = urlReturned.substring(0, urlReturned.length - 1);
                        }
                        gbb.utility.debugConsole("urlReturned", urlReturned);

                        // Extract the last path segment and get the string before the first '.'
                        let newHandle = urlReturned.split("/").pop().split(".")[0];

                        // console.log("newHandle", newHandle);
                        gbb.utility.debugConsole("newHandle", newHandle);

                        // now call productDataV2 with the final url
                        return await gbb.utility.getProductDataV2(newHandle, { dontRetry: true });
                    })
                    .then(product => {
                        gbb.utility.debugConsole("Product Data:", product);
                        res(product); // resolve the outer promise with the product data
                    })
                    .catch(error => {
                        gbb.utility.debugConsole("fail", error);
                        res(false);
                        // rej(error); // reject the outer promise with the error
                    });
            });
        },
        renderTemporaryLoadingSpinner: function (loaderState) {

            // gbb.$(".gbbPageBody").append(gbb.$("<div>").addClass("gbbEmptyDivWithMaxHeight"));

            //loaderState = "show" => show loader
            //loaderState = "hide" => hide loader
            //loaderState = (empty params) => toggle loader with a timeout 700ms.
            //check switch case for more render details
            if (!loaderState) {
                loaderState = "autoToggle"
            }

            let defaultLoadingGif = "https://gift-box-builder-app4.s3.us-east-2.amazonaws.com/storefront/loading-gif.gif";

            // "https://c.tenor.com/n4w0VzWFbtgAAAAC/loading.gif"

            let loadingGif = gbb.settings.merchantInfo?.customSettings?.loadingGif || "";

            if (loadingGif) {
                defaultLoadingGif = loadingGif;
            }

            let loadingScreenDiv = gbb.$("<div>").addClass("gbbLoadingScreen").css("background", gbb?.settings?.app?.loadingBgColor);
            // let loadingScreenDiv =  gbb.$("<img>").addClass("gbbLoadingScreenSpinner").attr("src",defaultLoadingGif );
            // let loadingScreenSpinner = gbb.$("<div>").addClass("gbbLoadingScreenSpinner");

            // let loadingSpinnerGIF = gbb.$("<img>").attr("src", gbb.utility.getAssetUrl("loading.gif"));
            let loadingSpinnerGIF = gbb.$("<img>").addClass("gbbLoadingSpinnerGIF").attr("src", defaultLoadingGif);




            // loadingScreenDiv.append(loadingScreenSpinner);
            loadingScreenDiv.append(loadingSpinnerGIF);
            // loadingScreenDiv.append(loadingSkeleon);
            switch (loaderState) {
                case "show":
                    if (gbb.$(".gbbLoadingScreen").length < 1) {
                        gbb.$(".gbbPageBody").append(loadingScreenDiv);
                        gbb.$("body").addClass("gbbHideScrollBar");
                    }
                    break;
                case "hide":
                    if (gbb.$(".gbbLoadingScreen").length > 0) {
                        setTimeout(function () {
                            gbb.$(".gbbLoadingScreen").remove();
                            gbb.$("body").removeClass("gbbHideScrollBar");
                        }, 500)


                    }
                    break;
                case "autoToggle":
                    if (gbb.$(".gbbLoadingScreen").length > 0) {
                        return
                    }
                    else {
                        gbb.$(".gbbPageBody").append(loadingScreenDiv);
                    }
                    setTimeout(function () {
                        gbb.$(".gbbLoadingScreen").remove();
                    }, 700)
                    break;
                    return;
            }
        },
        getProductsBulk: async function (listOfHandles) {
            try {
                // fire an api call for each product and store it corresponding to its handle/title
                let promises = []
                for (let i = 0; i < listOfHandles.length; i++) {
                    promises.push(gbb.utility.getProductDataV2(listOfHandles[i]))
                }
                let data = await Promise.all(promises)
                //return the data but in for of array of object which title as key

                let result = {}
                for (let i = 0; i < data.length; i++) {
                    result[data[i].handle] = data[i]
                }
                return result;
            } catch (error) {
                gbb.utility.debugError("gbb-utility-getProductsBulk");
                gbb.utility.debugError(error);
                return false
            }
        },
        getProductsBulkForRelevantVariants: async function (listOfHandles, productsData, options) {
            try {
                // fire an api call for each product and store it corresponding to its handle/title



                let promises = [], idsOfVariants = [];
                for (let i = 0; i < productsData.length; i++) {
                    idsOfVariants?.push(productsData[i]?.variants?.map(variant => variant.variantId))
                }

                idsOfVariants = idsOfVariants?.flat()

                let data;

                if (gbb.settings.app.enableStoreFrontGQLAPI) {
                    data = await gbb.graphQlUtility.getProductsDataByIds(options.listOfProductIds)
                    // promises.push(await gbb.graphQlUtility.getProductsDataByIds(options.listOfProductIds))
                } else {

                    for (let i = 0; i < listOfHandles.length; i++) {

                        // TODO: SF API Check
                        // if(storeFrontapi token pres)
                        // 
                        // {
                        // if ( false && options && options.listOfProductIds){

                        promises.push(gbb.utility.getProductDataV2(listOfHandles[i]))


                        // }

                    }
                    data = await Promise.all(promises)
                }


                //remove the data element which are false
                data = data.filter(element => element)

                //return the data but in for of array of object which title as key
                let result = {}
                for (let i = 0; i < data.length; i++) {
                    //getproductdata based on data[i].id
                    let productdata = productsData.find((item) => item.productId == data[i].id)
                    data[i] = gbb.utility.getProductData_AfterRemovingUnavailableVariantsAndOptions(data[i]);

                    let hasTheUserSelectedOnlyOneVariant = productdata?.variants?.length == 1 ? true : false;
                    if (hasTheUserSelectedOnlyOneVariant) {
                        data[i].renderChooseOptionsButton_forcefully = false;
                    }




                    if (productdata && productdata.variants) {
                        let variants = data[i].variants?.filter(variant => idsOfVariants.includes(String(variant.id)));
                        data[i].variants = variants;


                        if (data[i].variants.length < 1) {
                            continue;
                        }

                        data[i].price = data[i].variants[0]?.price || data[i].price
                        data[i].compare_at_price = data[i].variants[0]?.compare_at_price || data[i].compare_at_price



                        if (gbb.settings.bundleSettings.removeUnUsedVariantImages) {
                            data[i] = gbb.utility.removeUnUsedVariantImages(data[i])
                        }

                        result[data[i].handle] = {
                            ...data[i],
                            variants,
                            requiredQuantity: productdata?.requiredQuantity ? productdata?.requiredQuantity : null //used in case of default products only
                        };
                    } else {
                        let variants = data[i].variants
                        data[i].variants = variants;
                        if (gbb.settings.bundleSettings.removeUnUsedVariantImages) {
                            data[i] = gbb.utility.removeUnUsedVariantImages(data[i])
                        }


                        result[data[i].handle] = {
                            ...data[i],
                            variants,
                            requiredQuantity: productdata?.requiredQuantity ? productdata?.requiredQuantity : null
                        }

                    }

                }
                return result;
            } catch (error) {
                gbb.utility.debugError("gbb-utility-getProductsBulkForRelevantVariants");
                gbb.utility.debugError(error);
                return false
            }
        },
        getProductsFromCollections: function (data) {
            try {
                let resObj = []
                for (let i = 0; i < data.length; i++) {
                    let collection = data[i]
                    if (collection && collection.productList.length > 0) {
                        resObj.push(...collection.productList)
                    }

                }
                return resObj
            } catch (error) {
                gbb.utility.debugError("gbb-utility-getProductsFromCollections");
                gbb.utility.debugError(error);
                return false
            }
        },
        removeFromCartBulk: async function (variantIdList, noteAttribute) {
            try {

                // run a for loop to create promises to remove
                // items from the cart in bulk
                for (let i = 0; i < variantIdList.length; i++) {
                    let variant = { id: variantIdList[i] }
                    await gbb.utility.removeFromCart({ variant }, noteAttribute);
                }
                // wait for all promises to resolve
                return true;
            }
            catch (error) {
                gbb.utility.debugError("gbb-utility-removeFromCartBulk");
                gbb.utility.debugError(error);
                return false
            }
        },
        addToCartV2: function (data) {
            try {
                return new Promise((res, rej) => {
                    gbb.$.post('/cart/add.js', data)
                        .done(function () { gbb.utility.debugConsole("success-/cart/add.js': "); res(true) })
                        .fail(function () { gbb.utility.debugConsole("fail-/cart/add.js"); res(false) })
                })
                return result;
            } catch (error) {
                gbb.utility.debugError("gbb-utility-addToCartV2");
                gbb.utility.debugError(error);
                return false
            }
        },
        clearCart: function (data) {
            try {
                return new Promise((res, rej) => {
                    gbb.$.post('/cart/clear.js', data)
                        .done(function () { gbb.utility.debugConsole("success-/cart/clear.js': "); res(true) })
                        .fail(function () { gbb.utility.debugConsole("fail-/cart/clear.js"); res(false) })
                })
                return result;
            } catch (error) {
                gbb.utility.debugError("gbb-utility-clearCart");
                gbb.utility.debugError(error);
                return false
            }
        },
        getCart: async function (data) {
            try {
                const subscriptionPlanExists = gbb.gbbReviewPage.f.checkIfSubscriptionPlanExists();
                if (subscriptionPlanExists && gbb.gbbBrowser?.getSubscriptionType() == "saveSubscription") {
                    return gbb.gbbBrowser.getCartDataForSubscription();
                }
                return gbb.gbbBrowser.getCartDataFromSessionStorage();
                let result = await gbb.$.ajax({
                    type: "GET",
                    url: "/cart.js",
                    dataType: "json",
                });
                return result
            } catch (error) {
                gbb.utility.debugError("gbb-utility-getCart");
                gbb.utility.debugError(error);
                return false
            }
        },

        getGiftBoxProductsFromCart: async function (data) {
            try {
                let data = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(gbb.state.activeBoxId); //change it to -> getRelevantBoxDataFromSessionStorage
                gbb.state.giftBoxCartData = data
                gbb.gbbDiscountComponent.f.updateCurrentDiscountRule();
                return data

            } catch (error) {
                gbb.utility.debugError("gbb-utility-getCart");
                gbb.utility.debugError(error);
                return false
            }
        },
        getGiftBoxProductsTotalWithCurrency: function (data) {
            try {
                //getGiftBoxProductsFromCart
                // gbb.state.giftBoxCartData = await gbb.utility.getGiftBoxProductsFromCart()
                data = gbb.state.giftBoxCartData
                // if(data.currency){
                // return gbb.utility.getCurrencySymbol() + "" + parseFloat(data.total_price / 100).toFixed(2)
                return gbb.utility.formatPrice(data.total_price)
                // }else{
                // if(Shopify && Shopify.currency && Shopify.currency.active){
                //     return "0.0"+ " " +Shopify.currency.active
                // }else{
                //     return "0.0"
                // }

                // }
            } catch (error) {
                gbb.utility.debugError("gbb-utility-getCart");
                gbb.utility.debugError(error);
                return "0.0"
            }
        },
        getGiftBoxProductsDiscountedTotal: function (boxId) {
            try {
                if (!boxId) {
                    boxId = gbb.state.activeBoxId || "box1";
                }
                let allDiscountsData = gbb.utility.calculateCartDiscount();
                let currentBoxDiscountData = allDiscountsData?.discountsPerBox[boxId];

                if (!currentBoxDiscountData) {
                    return "0.0";
                }

                let discountedTotal = currentBoxDiscountData.boxTotalAmount + currentBoxDiscountData.blackListedItemsTotalPrice || 0;
                discountedTotal = discountedTotal / currentBoxDiscountData.boxQuantity;
                //    let discountedTotal =
                //    return parseInt(discountedTotal / 100);
                //@ashfaq
                return parseFloat(discountedTotal / 100);
            } catch (error) {
                gbb.utility.debugError("gbb-utility-getCart");
                gbb.utility.debugError(error);
                return "0.0"
            }
        },
        getGiftBoxProductsTotalWithCurrency_multipliedByBundleQuantity: function (data) {
            try {
                data = gbb.gbbBrowser.getCartDataFromSessionStorage()
                // data.bundleQuantity = data.bundleQuantity || 1
                return gbb.utility.getCurrencySymbol() + "" + parseFloat(data.total_price * data.bundleQuantity / 100).toFixed(2)
            } catch (error) {
                gbb.utility.debugError("gbb-utility-getCart");
                gbb.utility.debugError(error);
                return "0.0"
            }
        },
        convertArrayToObject: function (array, key) {
            try {
                let obj = {};
                for (let i = 0; i < array.length; i++) {
                    obj[array[i][key]] = array[i];
                }
                return obj;
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        convertArrayToObjectWithArrays: function (array, key) {
            try {
                let obj = {};
                for (let i = 0; i < array.length; i++) {
                    if (!obj[array[i][key]]) {
                        obj[array[i][key]] = [];
                    }
                    obj[array[i][key]].push(array[i]);
                }
                return obj;
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        getCartTotalQuantity: async function () {
            try {
                let total = 0
                let cartData = await gbb.$.ajax({
                    type: "GET",
                    url: "/cart.js",
                    dataType: "json",
                });
                for (var item of cartData['items']) {
                    total += item["quantity"]
                }
                return total
            } catch (error) {
                gbb.utility.debugError("gbb-utility-getCart");
                gbb.utility.debugError(error);
                return false
            }
        },
        getProductQuantityFromCart: async function ({ variant, parent }) {
            let item = gbb.utility.checkIfItemPresentInGiftBoxCart(variant.id);
            if (!item) {
                return gbb.gbbAddProductsPage.state.incrementProductQtyBy;
            } else {
                return item.quantity;
            }
        },
        checkIfItemPresentInCart: function (searchedVariantId) {
            if (gbb.state.cartData && gbb.state.cartData.items && gbb.state.cartData.items.length && gbb.state.cartData.items.length > 0) {
                for (let i = 0; i < gbb.state.cartData.items.length; i++) {
                    let item = gbb.state.cartData.items[i]
                    if (item && item.variant_id && item.variant_id == searchedVariantId) {
                        return item
                    }
                }
                return false
            } else {
                return false
            }
        },
        checkIfItemPresentInGiftBoxCart: function (searchedVariantId, options) {

            const boxProductValuesInPersonalizationPage = ["giftWrap", "giftMessage", "greetingCard","addonProduct"];

            let uniqueItemKey
            if (options) {
                uniqueItemKey = options.uniqueItemKey
            }

            if (gbb.state.giftBoxCartData && gbb.state.giftBoxCartData.items && gbb.state.giftBoxCartData.items.length && gbb.state.giftBoxCartData.items.length > 0) {

                if (uniqueItemKey) {
                    for (let i = 0; i < gbb.state.giftBoxCartData.items.length; i++) {
                        let item = gbb.state.giftBoxCartData.items[i]
                        if (item && item.properties && item.properties["_uniqueGbbItemKey"] && item.properties["_uniqueGbbItemKey"] == uniqueItemKey) {
                            return item
                        }
                    }

                }

                for (let i = 0; i < gbb.state.giftBoxCartData.items.length; i++) {
                    let item = gbb.state.giftBoxCartData.items[i]
                    let findingByVariantId = item && item.variant_id && item.variant_id == searchedVariantId;
                    let findingByLineItemKey = item && item.key && item.key.includes(searchedVariantId);
                    let isProductAddedFromThisPage = item.properties["_boxProduct"] == gbb.state.currentPageId;

                    let isProductFromThisCategory;
                    if (item.properties["_Category"]) {
                        // isProductFromThisCategory
                        isProductFromThisCategory = item.properties["_Category"] == gbb.gbbMultipleCategoriesPage.state.currentCategoryId;
                        if (isProductFromThisCategory) {
                            isProductAddedFromThisPage = true;
                        } else {
                            isProductAddedFromThisPage = false
                        }
                    }

                    // if boxProduct is giftWrap/giftmessage and "greetingCard" then check if gbb.state.currentPageId personalizationPage

                    if (gbb.state.currentPageId == "personalizationPage") {
                        // Check if the _boxProduct is one of the boxProductValuesInPersonalizationPage
                        if (boxProductValuesInPersonalizationPage.includes(item.properties["_boxProduct"])) {
                            isProductAddedFromThisPage = true;
                        }
                    }


                    if (isProductAddedFromThisPage) {
                        if (findingByVariantId || findingByLineItemKey) {
                            return item
                        }
                    }
                }
                return false
            } else {
                return false
            }
        },
        getUniqueIdForVariant: function ({ productData, variantId, attributes }) {
            try {

                let uniqueId
                if (!variantId) {
                    variantId = String(productData.variant_id);
                }

                uniqueId = variantId;


                if (attributes && Object.keys(attributes)) {
                    // uniqueId = concat attributes._Category
                    attributes.pageId = attributes[variantId];
                    if (attributes.pageId) {
                        uniqueId = uniqueId + "_" + "pageId:" + attributes.pageId;
                    }

                    if (attributes.category) {
                        uniqueId = uniqueId + "_" + "categoryId:" + attributes.category;
                    }

                } else if (productData && productData.properties) {
                    if (productData.properties["_boxProduct"]) {
                        uniqueId = uniqueId + "_" + "pageId:" + productData.properties["_boxProduct"];
                    }

                    if (productData.properties["_Category"]) {
                        uniqueId = uniqueId + "_" + "categoryId:" + productData.properties["_Category"];
                    }
                } else {
                    if (gbb.state.currentPageId) {
                        uniqueId = uniqueId + "_" + "pageId:" + gbb.state.currentPageId;
                    }

                    if (gbb.gbbMultipleCategoriesPage.state.currentCategoryId) {
                        uniqueId = uniqueId + "_" + "categoryId:" + gbb.gbbMultipleCategoriesPage.state.currentCategoryId;
                    }
                }

                return uniqueId;

                // _properties["_uniqueGbbItemKey"] + "_" + data?.attributes.category;

            } catch (e) {
                gbb.utility.debugConsole(e);
            }
        },
        checkIfProductPresentInCart: function (searchedProductId) {
            if (gbb.state.cartData && gbb.state.cartData.items && gbb.state.cartData.items.length && gbb.state.cartData.items.length > 0) {
                for (let i = 0; i < gbb.state.cartData.items.length; i++) {
                    // gbb.utility.debugConsole("cjeckIfProductPresentInCart: ", gbb.state.cartData.items[i])
                    let item = gbb.state.cartData.items[i]
                    if (item && item.id && item.id == searchedProductId) {
                        return item
                    }
                }

                return false
            } else {
                return false
            }
        },
        checkIfGiftOptionsInCart: async function () {
            let isGiftWrapPresent = false, isGreetingPresent = false, isGiftNotePresent = false, iseDeliveryPresent = false, isGiftAddonPresent = false


            let giftWrapVariants = [], greetingCardVariants = [], giftAddonVariants = []
            if (gbb.settings && gbb.settings.giftwrap && gbb.settings.giftwrap.isGiftWrapEnabled && gbb.settings.giftwrap.productVariants) {
                gbb.settings.giftwrap.productVariants?.forEach(item => giftWrapVariants.push(item.id))
            }

            if (gbb.settings && gbb.settings.greetingCard && gbb.settings.greetingCard.isGreetingCardEnabled && gbb.settings.greetingCard.productVariants) {
                gbb.settings.greetingCard.productVariants.forEach(item => greetingCardVariants.push(item.id))
            }

            if (gbb.settings && gbb.settings.giftAddons && gbb.settings.giftAddons.isGiftAddonsEnabled && gbb.settings.giftAddons.addOnProducts && gbb.settings.giftAddons.addOnProducts.length && gbb.settings.giftAddons.addOnProducts.length > 0) {
                for (let i = 0; i < gbb.settings.giftAddons.addOnProducts.length; i++) {
                    let addOnProduct = gbb.settings.giftAddons.addOnProducts[i]
                    addOnProduct.variants?.forEach(item => giftAddonVariants.push(parseInt(item.variantId)))
                }
            }

            if (gbb.state.cartData && gbb.state.cartData.attributes) {
                if (gbb.state.cartData.attributes.gbbGiftMessage) {
                    return true
                }

                if (gbb.state.cartData.attributes.gbbScheduleDelivery) {
                    return true
                }
            }

            if (gbb.state.cartData && gbb.state.cartData.items && gbb.state.cartData.items.length && gbb.state.cartData.items.length > 0) {
                for (let i = 0; i < gbb.state.cartData.items.length; i++) {
                    let item = gbb.state.cartData.items[i]
                    if (item && item.variant_id && item.variant_id) {

                        if (giftWrapVariants.includes(item.variant_id)) {
                            isGiftWrapPresent = true
                        }
                        if (greetingCardVariants.includes(item.variant_id)) {
                            isGreetingPresent = true
                        }
                        if (giftAddonVariants.includes(item.variant_id)) {
                            isGiftAddonPresent = true
                        }
                    }
                }

                if (isGiftWrapPresent || isGreetingPresent || isGiftNotePresent || iseDeliveryPresent || isGiftAddonPresent) {
                    return true
                } else {
                    return false
                }

            } else {
                return false
            }



        },
        convertObjectToArray: function (obj) {
            let arr = []
            for (let key in obj) {
                arr.push(obj[key])
            }
            return arr
        },
        getNoteFromCart: function () {

            if (gbb && gbb.state && gbb.state.giftBoxCartData) {
                // return
                const messageProduct = gbb.state.giftBoxCartData.items.find(item => item.id == gbb.settings.shopifyData?.giftMessageData?.variants[0]?.id);
                if (messageProduct) {
                    return messageProduct.properties["Message"]
                }
            }

        },
        getAttributValueFromMessageItem: function (attributeName) {
            if (gbb && gbb.state && gbb.state.giftBoxCartData && gbb.settings.shopifyData?.giftMessageData && gbb.settings.shopifyData?.giftMessageData?.variants && gbb.settings.shopifyData?.giftMessageData?.variants[0]?.id) {
                // return
                const messageProduct = gbb.state.giftBoxCartData.items.find(item => item.id == gbb.settings.shopifyData?.giftMessageData?.variants[0]?.id);
                if (messageProduct) {
                    return messageProduct.properties[attributeName]
                }
            } else {
                return null
            }
        },
        isCartTotalMoreThan: async function (value) {
            gbb.state.cartData = await gbb.utility.getCart()

            if (gbb.state.cartData && gbb.state.cartData.total_price && ((gbb.state.cartData.total_price) / 100 >= parseFloat(value))) {
                gbb.utility.debugConsole("isCartTotalMoreThan: ", gbb.state.cartData.total_price)
                return true
            } else {
                return false
            }
        },
        isCartEmpty: function () {
            if (gbb.state.cartData && gbb.state.cartData.items.length <= 0) {
                return true;

            } else {
                return false
            }
        },
        setMapForVariantId: function (productsObj, extraInfo) {
            try {
                let data = gbb.utility.productDetailsWith_VariantId_Or_ProductIdAsKey(productsObj, extraInfo)
                gbb.state.currentProductsDataSetForVariants = { ...gbb.state.currentProductsDataSetForVariants, ...data };
            }
            catch (e) {
                gbb.utility.debugError("setMapForVariantId", e)
            }

        },

        cloneAddToCartBtn: function () {
        },
        overWriteBuyNowBtn: function () {

            let buyNowBtnEle = gbb.$(document).find(gbb.selectors.buyNowBtn)

            if (buyNowBtnEle && buyNowBtnEle.length > 0 && gbb.$(document).find(".gbb-overwrite-buy-now-btn").length == 0) {
                buyNowBtnEle.show()
                buyNowBtnEle.unbind().unbind("click").off().off("click");
                newBuyNowBtnEle = buyNowBtnEle.clone()
                buyNowBtnEle.after(newBuyNowBtnEle)
                buyNowBtnEle.hide()
                newBuyNowBtnEle.addClass("gbb-overwrite-buy-now-btn")


                newBuyNowBtnEle.on("click", function (event) {
                    event.preventDefault();
                    event.stopPropagation();
                    gbb.$(this).attr("disabled", true);
                    newBuyNowBtnEle.text("loading checkout...");
                    setTimeout(() => { gbb.$(this).attr("disabled", false) }, 3000)
                    addToCartBtnEle = gbb.$(document).find(gbb.selectors.addToCart)
                    sideCartEle = gbb.$(document).find(gbb.selectors.sideCartSelectors)

                    // gbb.$(document).find("body").addClass("loadingCheckoutPage")
                    // gbb.$(document).find("body").text("loading checkout...")

                    if (sideCartEle && sideCartEle.length > 0) {
                        sideCartEle.css("display", "none")
                    }

                    if (addToCartBtnEle && addToCartBtnEle.length > 0) {
                        addToCartBtnEle.trigger("click")
                    }
                    setTimeout(() => {
                        window.location.href = window.location.origin + "/cart/checkout"
                    }, 1000)

                })

            }
        },
        overWriteCheckoutBtn: function () {

            let checkoutBtnEle = gbb.$(document).find(gbb.selectors.checkoutBtnEle)
            if (checkoutBtnEle && checkoutBtnEle.length > 0 && gbb.$(document).find(".gbb-overwrite-checkout-btn").length == 0) {
                checkoutBtnEle.show()
                checkoutBtnEle.unbind().unbind("click").off().off("click");
                let newcheckoutBtnEle = checkoutBtnEle.clone()
                checkoutBtnEle.after(newcheckoutBtnEle)
                checkoutBtnEle.hide()
                newcheckoutBtnEle.addClass("gbb-overwrite-buy-now-btn")


                newcheckoutBtnEle.on("click", function (event) {
                    event.preventDefault();
                    event.stopPropagation();
                    gbb.$(this).attr("disabled", true);
                    newcheckoutBtnEle.text("loading checkout...");
                    setTimeout(() => { gbb.$(this).attr("disabled", false) }, 3000)
                    addToCartBtnEle = gbb.$(document).find(gbb.selectors.addToCart)
                    sideCartEle = gbb.$(document).find(gbb.selectors.sideCartSelectors)

                    // gbb.$(document).find("body").addClass("loadingCheckoutPage")
                    // gbb.$(document).find("body").text("loading checkout...")

                    if (sideCartEle && sideCartEle.length > 0) {
                        sideCartEle.css("display", "none")
                    }

                    if (addToCartBtnEle && addToCartBtnEle.length > 0) {
                        addToCartBtnEle.trigger("click")
                    }
                    setTimeout(() => {
                        let properties = gbbExt.state.cartData.properties;
                        window.location.href = window.location.origin + "/cart/checkout"
                    }, 1000)

                })

            }
        },
        emailValidation: function (emailString) {
            var atSymbol = emailString.indexOf("@");
            if (atSymbol < 1) return false;

            var dot = emailString.lastIndexOf(".");
            if (dot <= atSymbol + 2) return false;

            // check that the dot is not at the end
            if (dot === emailString.length - 1) return false;

            return true;
        },
        renderLanguageValue: function (parent) {
            if (parent) {
                return parent.value;
            }
            return;
        },
        slider: {
            state: {
                slideIndex: 1,
            },
            plusSlides: function (selector, n) {
                this.showSlides(selector, this.state.slideIndex += n);
            },
            //minusSlides
            minusSlides: function (selector, n) {
                this.showSlides(selector, this.state.slideIndex -= n);
            },
            showSlides: function (selector, n) {
                var i;
                var slides = selector.find(".gbbProductImageContainerImg"); //takes the entire container so has refernce to all the images inside that container
                if (slides && slides.length) {
                    //     slides = JSON.parse(slides);
                    // }


                    if (n > slides.length) { this.state.slideIndex = 1 }
                    if (n < 1) { this.state.slideIndex = slides.length }
                    for (i = 0; i < slides.length; i++) {
                        slides[i].style.display = "none";
                    }
                    slides[this.state.slideIndex - 1].style.display = "block";
                    //   plusSlides(1)
                }
                // setTimeout(function () { plusSlides(n + 1) }, 2000);
            },
        },
        getAllFilterTagsForProducts: (products, noteAttribute) => {
            let filterTags = []

            products.forEach((element) => {
                let productTags = element.tags ? element.tags : []
                productTags.forEach((tag) => {
                    if (!filterTags.includes(tag)) {
                        filterTags.push(tag);
                    }
                })
            })
            return filterTags;
        },
        getFiltersInAndCondition: ({ allFiltersValue, productTagsSet, product }) => {
            let isAndProductAdded = false;
            let productCollectionNames = product.collectionNames ? product.collectionNames : [];
            for (let i = 0; i < allFiltersValue.length; i++) {
                let filterValue = allFiltersValue[i];
                if (productTagsSet.has(filterValue) || productCollectionNames.includes(filterValue)) {
                    isAndProductAdded = true;
                } else {
                    isAndProductAdded = false;
                    break;
                }
            }
            return isAndProductAdded;
        },

        getFiltersInOrCondition: ({ filters, product, productTagsSet, productTagsString }) => {
            let isProductAdded = false;
            for (let i = 0; i < filters.length; i++) {
                let filter = filters[i];
                for (let j = 0; j < filter.rules.length; j++) {
                    let rule = filter.rules[j];
                    let isThisFilterForCollections = rule.type == "collectionTag" ? true : false;
                    if (isThisFilterForCollections) {
                        if (rule.operatorType == "isEqualTo" || rule.operatorType == "contains") {
                            let selectedCollectionName = rule.tagValue;
                            if (product.collectionNames && product.collectionNames.includes(selectedCollectionName)) {
                                isProductAdded = true;
                                break;
                            }
                        }
                    } else {
                        if (rule.operatorType == "isEqualTo") {
                            if (productTagsSet.has(rule.tagValue)) {
                                isProductAdded = true;
                                break;
                            }
                        } else if (rule.operatorType == "contains") {
                            if (productTagsString.includes(rule.tagValue)) {
                                isProductAdded = true;
                                break;
                            }
                        }
                    }
                }
                if (isProductAdded) {
                    break;
                }
            }
            return isProductAdded;
        },
        getFilteredSortedProductsData: async (noteAttribute, origin) => {
            let products = gbb.utility.getSortedProducts(noteAttribute);
            gbb.state.setInfiniteScrollTrackerForProducts = true;
            let filters = gbb.utility.getActivatedFilters(noteAttribute);
            let filteredProducts = [];
            let minValue = gbb.utility.getPriceFilterValues(noteAttribute).minValue;
            let maxValue = gbb.utility.getPriceFilterValues(noteAttribute).maxValue;
            let filtersInfo = gbb.utility.getFiltersInfo(noteAttribute);


            let filterBasedOnFilterIdOperator = filtersInfo?.filterRuleAcrossCategory;
            let result = [];
            let allFiltersValue = [];
            let totalProducts = [];
            // let uniqueFilterIds = [];
            let filterIdsMap = {};
            filters.forEach((filter) => {

                if (filterIdsMap[filter.filterId]) {
                    filterIdsMap[filter.filterId].push(filter);
                } else {
                    filterIdsMap[filter.filterId] = [filter];
                }


                filter.rules.forEach((rule) => {
                    if (true || rule.type === "productTag") {
                        allFiltersValue.push(rule.tagValue);
                    }
                });

            });
            let filterIdsKeys = Object.keys(filterIdsMap);
            let allEligibleFilters = [];
            let productsToBeFutherFiltered = null;
            filterIdsKeys.forEach((filterIdKey) => {
                productsToBeFutherFiltered = productsToBeFutherFiltered ? productsToBeFutherFiltered : products;
                let filters = filterIdsMap[filterIdKey];
                if (filterBasedOnFilterIdOperator == "OR") {
                    // if (filters.length > 0) {
                    //     allEligibleFilters.push(...filters)
                    // }
                    totalProducts = [...totalProducts, ...calculateProductsToBeFiltered({ allEligibleFilters: filters })];
                    // allEligibleFilters = [...allEligibleFilters,...filters]   
                } else if (filterBasedOnFilterIdOperator == "AND") {
                    allEligibleFilters = [...filters]
                    // when it is and, then we will have to call the calculateProductsToBeFiltered function with the same existing products again and again
                    // so we will have to store the products in a variable and then pass it to the function
                    // productsToBeFutherFiltered
                    productsToBeFutherFiltered = calculateProductsToBeFiltered({ allEligibleFilters, productsToBeFutherFiltered });
                }
            });

            if (filterBasedOnFilterIdOperator == "OR") {
                totalProducts = [...new Set(totalProducts)];
            } else {
                // totalProducts = [...calculateProductsToBeFiltered(allEligibleFilters)];
                // productsToBeFutherFiltered is not iteratable error

                totalProducts = productsToBeFutherFiltered?.length > 0 ? [...productsToBeFutherFiltered] : []
            }

            function calculateProductsToBeFiltered(options) {
                filteredProducts = [];


                if (filtersInfo?.filterRuleAcrossCategory == "OR") {
                    allFiltersValue = [];
                    let filterArr = options.allEligibleFilters;
                    filterArr.forEach((filter) =>
                        filter.rules.forEach((rule) => {
                            if (true || rule.type === "productTag") {
                                allFiltersValue.push(rule.tagValue);
                            }
                        })
                    );
                }

                if (filtersInfo?.filterRuleAcrossCategory == "AND") {
                    let filterArr = options.allEligibleFilters;
                    let productsToBeFutherFiltered = options.productsToBeFutherFiltered;
                    products = productsToBeFutherFiltered;
                    filters = filterArr;
                }



                if (filters.length == 0) {
                    filteredProducts = gbb.utility.getSortedProducts(noteAttribute);
                } else {
                    products.forEach((product) => {
                        let productTags = product.tags;
                        let productTagsSet = new Set(productTags);
                        let productTagsString = productTags.toString();
                        let filterConditionRule = filtersInfo?.filterRule ? filtersInfo.filterRule : "OR";

                        switch (filterConditionRule) {
                            case "AND":
                                let isProductToBeAddedForAnd = false;
                                isProductToBeAddedForAnd = gbb.utility.getFiltersInAndCondition({ allFiltersValue, productTagsSet, product });
                                if (isProductToBeAddedForAnd) {
                                    filteredProducts.push(product);
                                }
                                break;
                            case "OR":
                                let isProductToBeAdded = false;
                                isProductToBeAdded = gbb.utility.getFiltersInOrCondition({ filters, product, productTagsSet, productTagsString });
                                if (isProductToBeAdded) {
                                    filteredProducts.push(product);
                                }
                                break;

                            default:
                                break;
                        }
                    });
                }

                if (minValue && maxValue) {
                    filteredProducts.forEach((product) => {
                        let productPrice = gbb.utility.formatPriceWithoutSymbol(product.price);
                        productPrice = parseFloat(productPrice);
                        if (productPrice >= minValue && productPrice <= maxValue) {
                            result.push(product);
                        }
                    });
                    filteredProducts = result;
                }
                return filteredProducts;
            };

            if (filters.length == 0) {
                totalProducts = gbb.utility.getSortedProducts(noteAttribute);
            }

            // gbb.gbbAddProductsPage.f.renderProductsCardContainer(filteredProducts, noteAttribute);
            if (!origin || origin != 'searchProductsFlow') {
                let activeCategoryId = gbb.gbbMultipleCategoriesPage.state.currentCategoryId;
                await gbb.gbbAddProductsPage.f.renderProductsCardContainer(totalProducts, noteAttribute, "filtersFlow", activeCategoryId);
            }
            // return filteredProducts;
            return totalProducts;
        },

        OldgetFilteredSortedProductsData: (noteAttribute) => {
            let products = gbb.utility.getSortedProducts(noteAttribute);
            let filters = gbb.utility.getActivatedFilters(noteAttribute);
            let filteredProducts = [];
            let minValue = gbb.utility.getPriceFilterValues(noteAttribute).minValue;
            let maxValue = gbb.utility.getPriceFilterValues(noteAttribute).maxValue;
            let result = [];
            let allFiltersValue = [];
            filters.forEach((filter) => {
                filter.rules.forEach((rule) => {
                    if (true || rule.type === "productTag") {
                        allFiltersValue.push(rule.tagValue);
                    }
                });
            });
            if (filters.length == 0) {
                filteredProducts = products;
            } else {
                products.forEach((product) => {
                    let productTags = product.tags;
                    let productTagsSet = new Set(productTags);
                    let productTagsString = productTags.toString();


                    // now check that product.tags[] contains all the values in allFiltersValue
                    let isAndProductAdded = false;
                    for (let i = 0; i < allFiltersValue.length; i++) {
                        let filterValue = allFiltersValue[i];
                        if (productTagsSet.has(filterValue)) {
                            isAndProductAdded = true;
                        } else {
                            isAndProductAdded = false;
                            break;
                        }
                    }

                    if (isAndProductAdded) {
                        filteredProducts.push(product);
                    }

                    //below part in another function

                    for (i = 0; i < filters.length; i++) {
                        let filter = filters[i];
                        filter
                        let isProductAdded = false;
                        for (let j = 0; j < filter.rules.length; j++) {
                            let rule = filter.rules[j];
                            let isThisFilterForCollections = rule.type == "collectionTag" ? true : false;
                            if (isThisFilterForCollections) {
                                if (rule.operatorType == "isEqualTo" || rule.operatorType == "contains") {
                                    // if product.collectionName == rule.tagValue
                                    let selectedCollectionName = rule.tagValue;
                                    if (product.collectionNames && product.collectionNames.includes(selectedCollectionName)) {
                                        filteredProducts.push(product);
                                        isProductAdded = true;
                                        break;
                                    }
                                    // if(product.collectionIds && product.collectionIds.includes(rule.tagValue)){
                                    //     filteredProducts.push(product);
                                    //     isProductAdded = true;
                                    //     break;
                                    // }
                                }
                            } else if (!isThisFilterForCollections) {
                                if (rule.operatorType == "isEqualTo") {
                                    if (productTagsSet.has(rule.tagValue)) {
                                        filteredProducts.push(product);
                                        isProductAdded = true;
                                        break;
                                    }
                                } else if (rule.operatorType == "contains") {
                                    if (productTagsString.includes(rule.tagValue)) {
                                        filteredProducts.push(product);
                                        isProductAdded = true;
                                        break;
                                    }
                                }
                            }
                        }
                        if (isProductAdded) {
                            break;
                        }

                    }
                })
            }
            if (minValue && maxValue) {
                filteredProducts?.forEach((product) => {
                    let productPrice = gbb.utility.formatPriceWithoutSymbol(product.price)
                    productPrice = parseFloat(productPrice);
                    if (productPrice >= minValue && productPrice <= maxValue) {
                        result.push(product);
                    }
                })
                filteredProducts = result;
            }
            //let filterAndSortedData = apply filter on sorteduniqueProductsData
            //RenderProductCartcontainer(filterAndSortedData)
            gbb.gbbAddProductsPage.f.renderProductsCardContainer(filteredProducts, noteAttribute)
            return filteredProducts;
        },
        clearAllFilters: (noteAttribute) => {
            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            if (addProductsPageArr.includes(noteAttribute)) {
                gbb.state.addProductsFilters.isFiltersActive = false;
                gbb.state.addProductsFilters.activatedFilters = [];
            }
        },

        checkIfSelectedVariantCombinationIsAvailable: function (product, selectedVariantsCombination) {
            try{

            
            let availableVariant = [];
            let productVariants = product?.variants;

            // Helper function to check if all selected variants are in options
            function allSelectedVariantsAreInOptions(selectedVariants, options) {
                return selectedVariants.every(value => options.includes(value));
            }

            // Helper function to check if there are no extra options outside the selected variants
            function noExtraOptionsInVariantOptions(selectedVariants, options) {
                return options.every(option => selectedVariants.includes(option));
            }

            // Extract the selected values from the combination object
            const selectedValues = Object.values(selectedVariantsCombination);

            for (let index = 0; index < productVariants.length; index++) {
                let variantOptions = productVariants[index]['options'] ? productVariants[index]['options'] : [];

                // Check if both conditions are met
                let isAllselectedVariantsAreInOptions = allSelectedVariantsAreInOptions(selectedValues, variantOptions)
                let isNoExtraOptionsInVariantOptions = noExtraOptionsInVariantOptions(selectedValues, variantOptions); 
                if (selectedValues?.length <=0) { // for the first 
                    isNoExtraOptionsInVariantOptions = true
                }
                const isVariantPresent = 
                    isAllselectedVariantsAreInOptions &&
                    isNoExtraOptionsInVariantOptions

                if (isVariantPresent && productVariants[index]['available'] == true) {
                    availableVariant.push(productVariants[index]);
                    break;
                }
            }
            return availableVariant;
            }catch(e){
                gbb.utility.debugConsole("error in e",e)
            }
        },
        checkIfSelectedVariantCombinationIsAvailableV2: function (product, selectedVariantsCombination) {
            let isVariantPresent = false;
            let availableVariant = [];
            let productVariants = product?.variants; // [black/sage,sage/sage]- [sage/sage] -> [black/sage]
            for (let index = 0; index < productVariants.length; index++) {
                let variantOptions = productVariants[index]['options'] ? productVariants[index]['options'] : [];
                isVariantPresent = Object.keys(selectedVariantsCombination).every((element, index) => {
                    // sage -> 
                    return variantOptions.includes(selectedVariantsCombination[element]);
                })
                if (isVariantPresent && productVariants[index]['available'] == true) {
                    availableVariant.push(productVariants[index]);
                    break;
                }
            }
            return availableVariant;
        },
        removeFromCart: async function ({ variant, parent, qty = 0 }, noteAttribute, category) {


            let data = { updates: { [variant.id]: qty }, attributes: { [variant.id]: noteAttribute } }

            data.additionalInfo = { ...variant }


            if (category && category != "") {
                data.attributes.category = category
            }
            await gbb.utility.updateCartV2(data)
            gbb.state.giftBoxCartData = await gbb.utility.getGiftBoxProductsFromCart()
            gbb.gbbDiscountComponent.f.updateCurrentDiscountRule();

        },
        activateAddButton: function (buttonEle, data, noteAttribute, typeOfProduct, category) {
            let incrementProductQtyBy = gbb.gbbAddProductsPage.state.incrementProductQtyBy || 1;
            buttonEle.css("background", gbb.settings.pageCustomizationData.productCard.productCardButtonColor);
            buttonEle.css("color", gbb.settings.pageCustomizationData.productCard.productCardButtonTextColor);
            const isMultipleVariants = (typeOfProduct == "multipleVariants" ? true : false);

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                if (isMultipleVariants) {
                    buttonEle.text(gbb.utility.renderLanguageValue(gbb.settings.languageData.general.chooseOptionsButtonText) || "Choose Options1");
                }
                else {
                    buttonEle.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.addToBoxButtonText) || "Add To Box1");
                }
            } else if (noteAttribute == "reviewPage") {
                if (isMultipleVariants) {
                    buttonEle.text(gbb.utility.renderLanguageValue(gbb.settings.languageData.general.chooseOptionsButtonText) || "Choose Options1");
                }
                else {
                    buttonEle.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.addButtonText) || "Add1");
                }
            } else {
                if (isMultipleVariants) {
                    buttonEle.text(gbb.utility.renderLanguageValue(gbb.settings.languageData.general.chooseOptionsButtonText) || "Choose Options1");
                }
                else {
                    buttonEle.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.addToCartButtonText) || "Add To Cart1");
                }
            }
            //buttonEle.removeClass("gbbProductRemoveButton")
            buttonEle.off("click")
            buttonEle.on("click", async function (event) {
                // buttonEle.prop('disabled', true);
                // buttonEle.addClass("gbbDisabled");
                // setTimeout(function () {
                //     gbb.utility.debugConsole("after timeeout")
                //     buttonEle.prop('disabled', false);
                //     buttonEle.removeClass("gbbDisabled");
                // }, 500);
                gbb.utility.debugConsole("add button clicked")
                //activate quantity buttons
                //TODO
                if (!event) {
                    return
                }
                // window.event11 = event;
                buttonEle = gbb.$(event.currentTarget);
                if (typeOfProduct == "multipleVariants") {
                    gbb.f.showProductVariantsModal(data.productData, buttonEle, noteAttribute, category)
                    return;
                } else {
                    let options = {
                        productAmount: data?.variant?.price,
                        category: category,
                        productWeight: data?.variant?.weight,
                        productVariantData: data?.variant,
                        productQuantity: incrementProductQtyBy,
                    }
                    if (gbb.settings?.bundleSettings?.isValidateInventoryEnabled && !gbb.utility.allowATCBasedOnProductInventory(data?.variant?.id, incrementProductQtyBy)) {
                        gbb.f.renderConditionNotificationToast((gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.inventoryLimitReachedText) || "No More Stock1"))
                        return
                    }
                    let condition = await gbb.utility.checkStepConditions(noteAttribute, options);
                    if (condition.isConditionMet) {
                        if (!data.qty || data.qty == 0) {
                            data.qty = incrementProductQtyBy;
                        }
                        //TODO: migration addButtonLoadingText
                        // buttonEle.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.addButtonLoadingText) || "Adding...");
                        gbb.utility.activateQuantityButtons(buttonEle, data, noteAttribute, typeOfProduct, category);
                        try {
                            let _noteAttribute = data?.productData?.customProductAttribute || noteAttribute
                            await gbb.utility.addToCart(data, _noteAttribute, category);
                            await gbb.utility.getGiftBoxProductsFromCart();
                        } catch (e) {
                            gbb.utility.debugConsole("error generated is", e);
                        }



                        await gbb.gbbAddProductsPage.f.handleAutoNextStep();


                        gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
                        // gbb.gbbAddProductsPage.f.autoScrollSlotsBasedOnATC("addToCart")
                        gbb.utility.showAddedToCartText(buttonEle);
                        if (noteAttribute == "reviewPage") {
                            gbb.gbbReviewPage.init(gbb.settings, "SUMMARY_PAGE");
                        }
                    }
                }
            })
        },
        activateQuantityButtons: async function (buttonEle, data, noteAttribute, typeOfProduct, category) {
            let allowQuantityInput = gbb.settings?.bundleSettings?.allowQuantityInput || false;
            let incrementProductQtyBy = gbb.gbbAddProductsPage.state.incrementProductQtyBy || 1;
            let decrementProductQtyBy = gbb.gbbAddProductsPage.state.decrementProductQtyBy || 1;
            let gbbProductQuantityHTML = gbb.$("<div>").addClass("gbbProductQuantityHTML");
            if (gbb.$('.gbbProductsCardLayoutV2').length > 0) {
                gbbProductQuantityHTML.css("background", gbb.settings.pageCustomizationData?.productCard?.productCardQuantitySelectorBgColor)
            }
            // let gbbProductQuantityAddButton = gbb.$("<button>").addClass("gbbProductQuantityAddButton")
            let productCardPageCustomization = gbb.settings.pageCustomizationData?.productCard
            let buttonTextColor = productCardPageCustomization.productCardQuantitySelectorButtonTextColor || productCardPageCustomization.productCardButtonTextColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor
            let gbbProductQuantityAddButton = gbb.$("<div>").addClass("gbbProductQuantityAddButton")
                // .css("background", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                // .css("color", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
                .css("background", gbb.settings.pageCustomizationData?.productCard?.productCardButtonColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                .css("color", productCardPageCustomization.productCardButtonTextColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
            // let gbbProductQuantityRemoveButton = gbb.$("<button>").addClass("gbbProductQuantityRemoveButton")
            let gbbProductQuantityRemoveButton = gbb.$("<div>").addClass("gbbProductQuantityRemoveButton")
                // .css("background", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                // .css("color", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
                .css("background", gbb.settings.pageCustomizationData?.productCard?.productCardButtonColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                .css("color", productCardPageCustomization.productCardButtonTextColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
            let gbbProductQuantityLabel = gbb.$("<div>").addClass("gbbProductQuantityLabel");

            let gbbProductQuantityInput = gbb.$("<input>").addClass("gbbProductQuantityInput").attr("type", "number").attr("min", 0);

            let currentQuantity = await gbb.utility.getProductQuantityFromCart(data);

            gbbProductQuantityAddButton.append(gbb.$("<div>").addClass("gbbProductQuantityAddButtonWrapper").html("+"));
            gbbProductQuantityRemoveButton.append(gbb.$("<div>").addClass("gbbProductQuantityRemoveButtonWrapper").html("-"));
            gbbProductQuantityLabel.text(currentQuantity);
            gbbProductQuantityInput.val(currentQuantity);

            // add data attribute to gbbProductQuantityInputContainer of previous qty currentQty
            gbbProductQuantityInput.attr("data-previous-qty", currentQuantity);

            const gbbProductQuantityAddButtonFunction = async (event) => {
                let options = {
                    productAmount: data?.variant?.price,
                    category: category,
                    productWeight: data?.variant?.weight,
                    productVariantData: data?.variant,
                    productQuantity: incrementProductQtyBy
                }
                let product = data.productData;
                let formValidationForProduct = gbb.gbbProductFormStep.f.checkFormValidationForProduct(product);
                if (!formValidationForProduct) {
                    gbb.gbbProductFormStep.f.displayRequiredFieldMessage();
                    return;
                } else if (formValidationForProduct) {
                    gbb.utility.addPersonalizationDataToProductProperties();
                }
                if (gbb.settings?.bundleSettings?.isValidateInventoryEnabled && !gbb.utility.allowATCBasedOnProductInventory(data?.variant?.id, incrementProductQtyBy)) {
                    gbb.f.renderConditionNotificationToast((gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.inventoryLimitReachedText) || "No More Stock1"))
                    return
                }
                let condition = await gbb.utility.checkStepConditions(noteAttribute, options);
                // CHECK_INVENTORY
                if (condition.isConditionMet) {
                    currentQuantity += incrementProductQtyBy;
                    data.qty = currentQuantity
                    gbbProductQuantityHTML = gbb.$(event.currentTarget.parentElement)
                    gbbProductQuantityLabel = gbbProductQuantityHTML.find(".gbbProductQuantityLabel");
                    gbbProductQuantityLabel.text(currentQuantity);
                    gbbProductQuantityInput.val(currentQuantity);
                    gbbProductQuantityInput.attr("data-previous-qty", currentQuantity);
                    // gbb.utility.disableElement(gbbProductQuantityAddButton);
                    let _noteAttribute = product?.customProductAttribute || noteAttribute
                    await gbb.utility.addToCart(data, _noteAttribute, category);
                    await gbb.utility.getGiftBoxProductsFromCart()
                    // gbb.utility.disableElement(gbbProductQuantityAddButton,0);


                    await gbb.gbbAddProductsPage.f.handleAutoNextStep();

                    gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
                    // gbb.gbbAddProductsPage.f.autoScrollSlotsBasedOnATC("addToCart")
                    gbb.utility.showAddedToCartText(buttonEle);
                    if (noteAttribute == "reviewPage") {
                        gbb.gbbReviewPage.init(gbb.settings, "SUMMARY_PAGE");
                    }
                }
            }

            const gbbProductQuantitySubstractButtonFunction = async (event) => {

                if (!event) {
                    return
                } else {
                    // window.event1 = event;
                }
                gbbProductQuantityRemoveButton.prop('disabled', true);
                //add a disabled class
                gbbProductQuantityRemoveButton.addClass("gbbDisabled");

                if (currentQuantity <= 0 || currentQuantity <= decrementProductQtyBy) {
                    currentQuantity = 0
                } else {
                    currentQuantity -= decrementProductQtyBy;
                }

                data.qty = currentQuantity
                let _noteAttribute = data.productData.customProductAttribute || noteAttribute
                await gbb.utility.removeFromCart(data, _noteAttribute, category);
                gbbProductQuantityRemoveButton.prop('disabled', false);
                gbbProductQuantityRemoveButton.removeClass("gbbDisabled");
                // let addButtonEle = gbb.$("<button>").addClass("gbbProductAddButton");
                let addButtonEle = gbb.$("<div>").addClass("gbbProductAddButton");
                // window.gbbProductQuantityHTML = gbbProductQuantityHTML;
                gbbProductQuantityHTML = gbb.$(event.currentTarget.parentElement)
                if (currentQuantity <= 0) {
                    gbbProductQuantityHTML.replaceWith(addButtonEle);
                    gbbProductQuantityInput.val(0);
                    gbbProductQuantityInput.attr("data-previous-qty", currentQuantity);
                    gbb.utility.activateAddButton(addButtonEle, data, noteAttribute, typeOfProduct, category)
                } else {
                    gbbProductQuantityLabel = gbbProductQuantityHTML.find(".gbbProductQuantityLabel");
                    gbbProductQuantityLabel.text(currentQuantity);
                    gbbProductQuantityInput.val(currentQuantity);
                    gbbProductQuantityInput.attr("data-previous-qty", currentQuantity);
                }
                await gbb.utility.getGiftBoxProductsFromCart()
                gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
                // gbb.gbbAddProductsPage.f.autoScrollSlotsBasedOnATC("removeFromCart")

                if (noteAttribute == "reviewPage") {
                    gbb.gbbReviewPage.init(gbb.settings, "SUMMARY_PAGE");
                }
            }

            gbbProductQuantityAddButton.on("click", async (event) => {
                //get current quantity -> do +1 and update cart
                gbb.utility.debugConsole("add button clicked")
                gbbProductQuantityAddButtonFunction(event);
            })

            gbbProductQuantityInput.on("change", async (event) => {
                let previousValue = parseInt(gbbProductQuantityInput.attr("data-previous-qty"));
                let currentValue = parseInt(gbbProductQuantityInput.val());

                let differenceInValues = currentValue - previousValue;
                if (differenceInValues > 0) {
                    for (let i = 0; i < differenceInValues; i++) {
                        await gbbProductQuantityAddButtonFunction(event);
                    }
                } else if (differenceInValues < 0) {
                    for (let i = 0; i < Math.abs(differenceInValues); i++) {
                        await gbbProductQuantitySubstractButtonFunction(event);
                    }
                }

            })

            // gbbProductQuantityInput.on("input", async (event) => {
            //     let previousValue = parseInt(gbbProductQuantityInput.attr("data-previous-qty"));
            //     let currentValue = parseInt(gbbProductQuantityInput.val());

            //     let differenceInValues = currentValue - previousValue;
            //     if (differenceInValues > 0) {
            //         for (let i = 0; i < differenceInValues; i++) {
            //             await gbbProductQuantityAddButtonFunction(event);
            //         }
            //     } else if (differenceInValues < 0) {
            //         for (let i = 0; i < Math.abs(differenceInValues); i++) {
            //             await gbbProductQuantitySubstractButtonFunction(event);
            //         }
            //     }

            //     // Update the previous value to the current value

            // });


            gbbProductQuantityRemoveButton.on("click", async (event) => {
                //get current quantity ->  do -1 and update cart
                //if quantity becomes zero after previous step
                //activate add button
                await gbbProductQuantitySubstractButtonFunction(event);

                //disable button after on click for 500ms
                // let btnElements = {gbbProductQuantityRemoveButton, gbbProductQuantityLabel, gbbProductQuantityHTML};
                // let dataToBePassedToActivateAddButton = {data, noteAttribute, category, typeOfProduct};
                // gbb.utility.handleQuantityRemoveButton(btnElements, dataToBePassedToActivateAddButton);
            })


            gbbProductQuantityHTML.append(gbbProductQuantityRemoveButton)

            if (allowQuantityInput) {
                gbbProductQuantityHTML.append(gbbProductQuantityInput);
            } else {
                gbbProductQuantityHTML.append(gbbProductQuantityLabel);
            }

            gbbProductQuantityHTML.append(gbbProductQuantityAddButton);

            buttonEle.replaceWith(gbbProductQuantityHTML);
        },
        handleQuantityRemoveButton: async function (btnElements, dataToBePassedToActivateAddButton) {
            let { gbbProductQuantityRemoveButton, gbbProductQuantityLabel, gbbProductQuantityHTML } = btnElements;
            let { data, noteAttribute, category, typeOfProduct } = dataToBePassedToActivateAddButton;
            gbbProductQuantityRemoveButton.prop('disabled', true);
            //add a disabled class
            gbbProductQuantityRemoveButton.addClass("gbbDisabled");
            currentQuantity -= 1;
            data.qty = currentQuantity
            await gbb.utility.removeFromCart(data, noteAttribute);
            gbbProductQuantityRemoveButton.prop('disabled', false);
            gbbProductQuantityRemoveButton.removeClass("gbbDisabled");
            // let addButtonEle = gbb.$("<button>").addClass("gbbProductAddButton");
            let addButtonEle = gbb.$("<div>").addClass("gbbProductAddButton");
            if (currentQuantity <= 0) {
                gbbProductQuantityHTML.replaceWith(addButtonEle);
                gbb.utility.activateAddButton(addButtonEle, data, noteAttribute, typeOfProduct, category)
            } else {
                gbbProductQuantityLabel.text(currentQuantity);
            }
            await gbb.utility.getGiftBoxProductsFromCart()
            gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
            if (noteAttribute == "reviewPage") {
                gbb.gbbReviewPage.init(gbb.settings, "SUMMARY_PAGE");
            }
        },
        activateSoldOutButton: function (buttonEle, data, noteAttribute) {
            let { variant, parent } = data;
            buttonEle.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.soldOut) || "Sold Out")
            buttonEle.addClass("gbbProductSoldOutButton")
            buttonEle.off("click")
        },
        handleVariantSelection: function (warningElement, product, selectedVariantsCombination, productButtonElement, gbbProductAllImagesContainer, gbbProductImageContainer) {
            try {
                let availableVariant = gbb.utility.checkIfSelectedVariantCombinationIsAvailable(product, selectedVariantsCombination);
                const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()

                const modalRef = gbb.$(".gbbProductVariantModalContainer")
                if (availableVariant.length == 0) {
                    productButtonElement.addClass('gbbDisabled');
                    warningElement.css('display', 'block');

                    //select the image
                } else {
                    productButtonElement.removeClass('gbbDisabled');
                    warningElement.css('display', 'none');
                    modalRef.find(".gbbProductItemCompareAtPrice").text("");
                    if (availableVariant[0]?.compare_at_price && availableVariant[0]?.compare_at_price > availableVariant[0]?.price) {
                        modalRef.find(".gbbProductItemCompareAtPrice").text(gbb.utility.formatPrice(availableVariant[0]?.compare_at_price));
                    }
                    let productPrice = availableVariant[0]?.price
                    if (isPurchaseTypeSubscription) {
                        productPrice = gbb.gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId(availableVariant[0]?.id)
                    }
                    modalRef.find(".gbbProductItemPrice").text(gbb.utility.formatPrice(productPrice));
                    //if the image is not already selected
                    let mediaId;
                    if (availableVariant[0].featured_media && availableVariant[0].featured_media?.id) {
                        mediaId = availableVariant[0].featured_media.id;
                        //find the active class image and check it's media id
                        let activeImage = gbbProductAllImagesContainer.find(".gbbActiveImage");
                        let activeImageIndex = activeImage.attr("imageIndex");
                        let activeImageMediaId = activeImage.attr("mediaId");

                        //find the div of the new variant through mediaId and then assign it slide index
                        let changedVariantDiv = gbbProductAllImagesContainer.find(`[mediaId=${mediaId}]`);
                        // let changedVariantDivIndex = parseInt(changedVariantDiv.attr("imageIndex"))
                        let changedVariantDivIndex = parseInt(changedVariantDiv?.parent()?.index())
                        changedVariantDivIndex += 1;

                        if (activeImageMediaId != mediaId && gbb.utility.slider.state.slideIndex != changedVariantDivIndex) {

                            gbb.utility.slider.state.slideIndex = changedVariantDivIndex//current changes image index;
                            // gbb.utility.slider.state.slideIndex = activeImageIndex//current changes image index;
                            gbb.utility.slider.showSlides(gbbProductImageContainer, gbb.utility.slider.state.slideIndex)
                            // gbb.utility.slider.showSlides(gbbProductImageContainer, gbb.utility.slider.state.slideIndex)

                            gbb.f.removeActiveImageStyle(gbbProductAllImagesContainer.find(".gbbActiveImage"))
                            gbbProductAllImagesContainer.find(".gbbActiveImage").removeClass("gbbActiveImage")

                            gbb.f.applyActiveImageStyle(gbbProductAllImagesContainer.find(`[mediaId=${mediaId}]`))
                            gbbProductAllImagesContainer.find(`[mediaId=${mediaId}]`).addClass("gbbActiveImage")
                        }
                    }
                }
            } catch (error) {
                gbb.utility.debugConsole("Error in handleVariantSelection", error)
            }
        },
        addPersonalizationDataToProductProperties: function (product) {

            let formSubmissionObj = JSON.parse(JSON.stringify(gbb.gbbProductFormStep.state.formSubmissionData));
            let resultKeyValuePair = {};
            let formSubmissionObjKeys = Object.keys(formSubmissionObj);
            //iterate and just copy the values
            formSubmissionObjKeys.forEach((key) => {
                if (formSubmissionObj[key].value) {
                    resultKeyValuePair[key] = formSubmissionObj[key].value;
                }
            });
            let productPersonalizationMetaData = formSubmissionObj;
            gbb.state.variantCustomProperties = { ...gbb.state.variantCustomProperties, ...resultKeyValuePair, productPersonalizationMetaData };

        },
        addVariantProductToCart: async function (warningElement, product, selectedVariantsCombination, noteAttribute, buttonEle, category, quantity = 1) {
            let availableVariant = gbb.utility.checkIfSelectedVariantCombinationIsAvailable(product, selectedVariantsCombination);
            if (availableVariant.length == 0) {
                warningElement.css('display', 'block');
            } else {
                let data = {
                    productData: product,
                    variant: availableVariant[0]
                }
                warningElement.css('display', 'none');
                let productData = data.productData;
                let uniqueItemKey = gbb.utility.getUniqueIdForVariant({ productData, variantId: data?.variant?.id })
                const isItemInCart = gbb.utility.checkIfItemPresentInGiftBoxCart(data?.variant?.id, { uniqueItemKey });
                // if (isItemInCart && isItemInCart.quantity) {
                //     quantity += isItemInCart.quantity
                //     data.qty = quantity
                // } else {
                //     data.qty = quantity
                // }
                let options = {
                    productAmount: data?.variant?.price,
                    category: category,
                    productQuantity: quantity,
                    productWeight: data?.variant?.weight,
                    productVariantData: data?.variant

                }
                if (gbb.settings?.bundleSettings?.isValidateInventoryEnabled && !gbb.utility.allowATCBasedOnProductInventory(data?.variant?.id, quantity)) {
                    // gbb.utility.closeVariantsModal()
                    gbb.f.renderConditionNotificationToast((gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.inventoryLimitReachedText) || "No More Stock1"))
                    return
                }
                let condition = await gbb.utility.checkStepConditions(noteAttribute, options);
                let formValidationForProduct = gbb.gbbProductFormStep.f.checkFormValidationForProduct(product);
                if (!formValidationForProduct) {
                    gbb.gbbProductFormStep.f.displayRequiredFieldMessage();
                    return;
                } else if (formValidationForProduct) {
                    gbb.utility.addPersonalizationDataToProductProperties();
                }

                if (condition.isConditionMet) {
                    if (isItemInCart && isItemInCart.quantity) {
                        quantity += isItemInCart.quantity
                    }
                    data.qty = quantity;
                    let _noteAttribute = product?.customProductAttribute || noteAttribute
                    await gbb.utility.addToCart(data, _noteAttribute, category)
                    let newProductItemHTML = gbb.f.renderProductsHTML([product], noteAttribute, category);
                    // gbb.$(".gbbPageBody").find(`[productId='${product.id}']`).replaceWith(newProductItemHTML);
                    let productCardRef = gbb.$(".gbbProductsContainer").find(`[productId='${product.id}']`);

                    if (productCardRef.length > 1) {
                        productCardRef = gbb.$(".gbbProductsContainer").find(`[firstvariantid='${data.variant.id}']`);
                    }
                    productCardRef.replaceWith(newProductItemHTML);

                    // if (condition.isConditionMet) {
                    //     gbb.utility.debugConsole("condition is met")
                    //     console.log("conditions", condition.conditions);
                    //     debugger
                    //     let argOptions = {
                    //         // conditions : condition.conditions,
                    //         condition: condition
                    //         // categoryId: category,
                    //         // pageType,
                    //     };
                    // }

                    await gbb.gbbAddProductsPage.f.handleAutoNextStep();



                    //gbb.utility.activateQuantityButtons(buttonEle, data, noteAttribute, "multipleVariants", category)
                    //buttonEle.addClass("gbbProductRemoveButton")
                    gbb.utility.closeVariantsModal()
                    gbb.$(".gbbHTMLWrapper").removeClass('gbbDisabled');
                    gbb.utility.showAddedToCartText(buttonEle);
                    await gbb.utility.getGiftBoxProductsFromCart()
                    gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
                    if (noteAttribute == "reviewPage") {
                        gbb.gbbReviewPage.init(gbb.settings, "SUMMARY_PAGE");
                    }



                } else {
                    gbb.utility.closeVariantsModal()
                }
            }
        },
        activateAFilter: function () {
        },
        removeAFilter: function () {

        },
        getTheVariantProductPresentInCart: function (product) {
            let variantPresent;
            let productVariants = product.variants;
            for (let index = 0; index < productVariants.length; index++) {
                variantPresent = gbb.utility.checkIfItemPresentInGiftBoxCart(productVariants[index].id);
                if (variantPresent) {
                    return variantPresent;
                }
            }
            // product.variants.forEach((variant) => {
            //     variantPresent = gbb.utility.checkIfItemPresentInGiftBoxCart(variant.id);
            //     if(variantPresent) {
            //         return variantPresent;
            //     }
            // })
            return false;
        },
        showAddedToCartText: function (buttonEle) {
            // add a new element next to the buttonEle and show the text
            let addedToCartText = gbb.$("<div>").addClass("gbbAddedToCartText").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.addedText) || "Added")
            buttonEle.after(addedToCartText)
            setTimeout(function () {
                addedToCartText.remove();
            }, 2000)
        },
        getCurrentPageSelectedProducts: function (noteAttribute) {
            let products = [];

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                // products = gbb.state.currentFilteredProducts[keyAttribute];
                products = gbb.state.currentFilteredProducts;
            } else {
                products = [];
            }

            return products;
        },
        setProductsToOriginalState: function (noteAttribute) {
            let tempProductsArr = [];

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            let data;
            if (noteAttribute == "addProductsPage1") {
                data = gbb.settings.stepsConfigurationData.productsData1.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage2") {
                data = gbb.settings.stepsConfigurationData.productsData2.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage3") {
                data = gbb.settings.stepsConfigurationData.productsData3.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage4") {
                data = gbb.settings.stepsConfigurationData.productsData4.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage5") {
                data = gbb.settings.stepsConfigurationData.productsData5.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage6") {
                data = gbb.settings.stepsConfigurationData.productsData6.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage7") {
                data = gbb.settings.stepsConfigurationData.productsData7.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage8") {
                data = gbb.settings.stepsConfigurationData.productsData8.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage9") {
                data = gbb.settings.stepsConfigurationData.productsData9.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage10") {
                data = gbb.settings.stepsConfigurationData.productsData10.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage11") {
                data = gbb.settings.stepsConfigurationData.productsData11.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage12") {
                data = gbb.settings.stepsConfigurationData.productsData12.uniqueProductsData;
            }
            if (data) {
                Object.keys(data).forEach((product) => {
                    tempProductsArr.push(data[product])
                });
            }
            gbb.state.currentFilteredProducts = tempProductsArr;
            return tempProductsArr;
        },
        getOriginalStateProducts: function (noteAttribute) {
            let tempProductsArr = [];

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                let data = gbb.settings.shopifyData[keyAttribute]
                if (data) {
                    Object.keys(data).forEach((product) => {
                        tempProductsArr.push(data[product])
                    });
                }
            }
            return tempProductsArr;
        },
        initializeFiltersInfo: function (productPageKey) {
            gbb.state.addProductsFilters.isFiltersEnabledByAdmin = gbb.settings.stepsConfigurationData[productPageKey].filterTypes?.isFiltersEnabled || false
            let categories = Object.values(gbb.settings.stepsConfigurationData[productPageKey].filterTypes?.categories || {});
            gbb.state.addProductsFilters.allFilters = categories || [];
            categories?.forEach((category) => {
                if (category.type == "price") {
                    gbb.state.addProductsFilters.minPriceValue = category.minValue;
                    gbb.state.addProductsFilters.maxPriceValue = category.maxValue;
                }
            })

        },
        getFiltersInfo: function (noteAttribute) {
            let filtersInfo = {
                isFiltersEnabled: false,
                categories: {},
                filterRule: "OR",
                filterRuleAcrossCategory: "OR"
            };


            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                filtersInfo.isFiltersEnabled = gbb.settings.stepsConfigurationData[keyAttribute]?.filterTypes?.isFiltersEnabled;
                filtersInfo.filterRule = gbb.settings.stepsConfigurationData[keyAttribute]?.filterTypes?.filterRule || "OR";
                filtersInfo.filterRuleAcrossCategory = gbb.settings.stepsConfigurationData[keyAttribute]?.filterTypes?.filterRuleAcrossCategory || filtersInfo.filterRule;
                filtersInfo.categories = gbb.state.addProductsFilters.allFilters;
            }

            return filtersInfo;
        },
        setPriceFilterValues: function (noteAttribute, minValue, maxValue) {


            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                gbb.state.addProductsFilters.minPriceValue = minValue;
                gbb.state.addProductsFilters.maxPriceValue = maxValue;
            }


            return;
        },
        getPriceFilterValues: function (noteAttribute) {
            let values = {};


            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                values.minValue = gbb.state.addProductsFilters.minPriceValue;
                values.maxValue = gbb.state.addProductsFilters.maxPriceValue;
            }
            return values;
        },
        toggleFiltersSideBar: function (noteAttribute) {


            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                gbb.state.addProductsFilters.isFiltersActive = !gbb.state.addProductsFilters.isFiltersActive
            }

            return;
        },
        getFiltersState: function (noteAttribute) {
            let isActive = false;

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                isActive = gbb.state.addProductsFilters.isFiltersActive
            }
            return isActive;
        },
        setActivatedFilters: function (filterTag, noteAttribute, operation, category) {

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey;
            if (category) {
                filterTag.category = category
                filterTag.filterId = category?.filterId || "123"
            }
            if (addProductsPageArr.includes(noteAttribute)) {
                let activatedFilters = gbb.state.addProductsFilters.activatedFilters;
                if (operation == "add") {
                    if (activatedFilters.findIndex(e => e.label == filterTag.label) == -1) {
                        activatedFilters.push(filterTag);
                    }
                } else {
                    activatedFilters = activatedFilters.filter((element) => {
                        return element.label != filterTag.label
                    })
                }
                gbb.state.addProductsFilters.activatedFilters = activatedFilters;

            }
        },
        setActivatePriceFilters: function (noteAttribute, value) {

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                gbb.state.addProductsFilters.priceFilterActive = value;
            }
            return;
        },
        getIsPriceFilterActive: function (noteAttribute) {
            let isPriceFilterActive = false;


            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                isPriceFilterActive = gbb.state.addProductsFilters.priceFilterActive
            }
            return isPriceFilterActive;
        },
        getActivatedFilters: function (noteAttribute) {
            let activatedFilters = [];

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                activatedFilters = gbb.state.addProductsFilters.activatedFilters
            }

            return activatedFilters;
        },
        getActivatedCategoriesForFilters: function (noteAttribute, filterCategory) {
            try {
                let activatedFilters = gbb.utility.getActivatedFilters(noteAttribute);
                for (let i = 0; i < activatedFilters.length; i++) {
                    let activatedFilter = activatedFilters[i];
                    if (activatedFilter?.category && activatedFilter.category == filterCategory) {
                        return true;
                    }
                }
                return false;
            } catch (err) {
                gbb.utility.debugConsole(err + "inside getActivatedCategoryForFilters");
            }

        },
        getCurrentPageHTML: function (noteAttribute) {
            let currentPageHTML = "";
            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                currentPageHTML = gbb.$(".gbbPageBody").find(".gbbAddProductsContainerHTML");
            }

            return currentPageHTML;
        },
        setSortByValues: function (noteAttribute, sortByValue) {


            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                gbb.state.addProductsSortBy.isSortByEnabled = gbb.settings.stepsConfigurationData[keyAttribute].sortBy?.isSortByEnabled || false;
                gbb.state.addProductsSortBy.sortByCategories = gbb.settings.stepsConfigurationData[keyAttribute].sortBy?.categories || [];
                gbb.state.addProductsSortBy.sortByValue = sortByValue || "";
            }



            return;
        },
        getSortByValues: function (noteAttribute) {
            let sortBy = {};

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                sortBy.isSortByEnabled = gbb.state.addProductsSortBy?.isSortByEnabled || false;
                sortBy.sortByCategories = gbb.state.addProductsSortBy?.sortByCategories || [];
                sortBy.sortByValue = gbb.state.addProductsSortBy?.sortByValue || "";
            }

            return sortBy;
        },
        sortAscending: function (arr, key) {
            return arr.sort(function (a, b) {
                var x = a[key];
                var y = b[key];

                if (typeof x == "string") {
                    x = ("" + x).toLowerCase();
                }
                if (typeof y == "string") {
                    y = ("" + y).toLowerCase();
                }

                return ((x < y) ? -1 : ((x > y) ? 1 : 0));
            });
        },
        sortDescending: function (arr, key) {
            return arr.sort(function (a, b) {
                var x = a[key];
                var y = b[key];

                if (typeof x == "string") {
                    x = ("" + x).toLowerCase();
                }
                if (typeof y == "string") {
                    y = ("" + y).toLowerCase();
                }

                return ((x > y) ? -1 : ((x < y) ? 1 : 0));
            });
        },
        getSortedProducts: function (noteAttribute) {
            let result = gbb.utility.getSortByValues(noteAttribute);
            let activeCategoryId = gbb.gbbMultipleCategoriesPage.state.currentCategoryId;
            let totalProducts = []
            if (activeCategoryId) { // changing filter search DB for multicategory -> to get only the products of the active category
                totalProducts = gbb.gbbAddProductsPage.state.productPageData.categories[activeCategoryId].uniqueProductsData
            }
            else {
                totalProducts = gbb.gbbAddProductsPage.state.uniqueProductsData;
            }
            // let products = JSON.parse(JSON.stringify(gbb.gbbAddProductsPage.state.uniqueProductsData));
            let products = JSON.parse(JSON.stringify(totalProducts));


            if (result?.isSortByEnabled) {
                if (result.sortByValue == "alphabeticalAToZ") {
                    products = gbb.utility.sortAscending(products, "title")
                } else if (result.sortByValue == "alphabeticalZToA") {
                    products = gbb.utility.sortDescending(products, "title")
                } else if (result.sortByValue == "priceLowToHigh") {
                    products = gbb.utility.sortAscending(products, "price")
                } else if (result.sortByValue == "priceHighToLow") {
                    products = gbb.utility.sortDescending(products, "price")
                }
            }
            return products;
        },
        /**
         * Generates a stylesheet string based on the settings 
         * and appends it to the head of the HTML document.
         * @returns {string} The generated style string.
         */
        getActiveVariantStyle: function () {
            let style =
                `<style>
                    .gbbActiveVariant {
                            background: ${gbb.settings?.pageCustomizationData?.productCard.productCardButtonColor} !important;
                            color:${gbb.settings.pageCustomizationData.productCard.productCardButtonTextColor} !important;
                        }
                    .gbbActiveImage {
                            border: 2px solid ${gbb.settings?.pageCustomizationData?.productCard.productCardButtonColor} !important;
                    }    
                    .gbbBodyWrapper ::-webkit-scrollbar-thumb{
                        background: ${gbb.settings?.pageCustomizationData?.generalSettings?.scrollBar?.scrollBarColor || "#000000"} !important;
                    }    
                    .gbbActiveMsgDeliveryOptions {
                        border: 1px solid #A2A2A2 !important;
                        background-color: rgb(255, 255, 255) !important;
                    }      
                    .gbbCustomerUploadButton{
                        background-color: ${gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor};
                        color: ${gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor};
                    }      
                    </style>`
            gbb.$('html > head').append(style);
            return style;
        },
        getConditionMessage: function (type, condition) {
            let result = gbb.settings?.languageData?.conditions;
            if (type == "amount") {
                result = result.amount;
            } else if (type == "quantity") {
                result = result.quantity;
            } else if (type == "weight") {
                result = result.weight;
            }
            result = result[condition];
            result = result["value"]
            return result;
        },
        checkConditions: function (value, element, goToNextStep) {
            let result = true;
            // let conditions = additionalInfo.conditions || [];
            let elementMaxValue = element.maxValue || element.value
            switch (element.condition) {
                case "lessThanOrEqualTo": {
                    result = value <= element.value ? true : false;
                    break;
                }
                case "equalTo": {
                    if (!goToNextStep) {
                        result = value <= elementMaxValue ? true : false;
                    } else {
                        // result = value == element.value ? true : false;
                        result = value - element.value >= 0 ? true : false;
                    }
                    break;
                }
                case "greaterThanOrEqualTo": {
                    if (goToNextStep) {
                        result = value >= element.value ? true : false;
                    }
                    break;
                }
            }
            return result;
        },
        checkConditionsAndProceedToNextPage: async function (noteAttribute, gbbFooterNextButton) {
            try {
                let result = await gbb.utility.checkConditionsOnNext(noteAttribute, gbbFooterNextButton);
                if (result.isConditionMet) {
                    gbb.utility.renderTemporaryLoadingSpinner("show");
                    gbb.giftboxbuilderPage.action.onNextNavigationBYOB();
                    let isRenderSlotFooterEnable = gbb.settings.stepsConfigurationData?.isProductSlotsEnabled && gbb.gbbAddProductsPage?.state?.isEveryConditionHaveTypeQuantity
                    if (isRenderSlotFooterEnable) {
                        setTimeout(() => {
                            gbb.gbbAddProductsPage.f.autoScrollSlotsOnNavigation()
                        }, 1000)
                    }
                    gbb.utility.disableElement(gbbFooterNextButton, 1000);
                    return true;
                } else {
                    return false;
                }
            } catch (e) {
                gbb.utility.debugConsole(e);
            }
        },
        checkStepConditions: async function (noteAttribute, { productAmount, category, productQuantity, productWeight }) {
            //this function recognizes what kind of page type it is
            //single category page -> fire checkSingleCategoryPageConditions function
            //multiple category page ->
            //->check if page level conditions are enabled
            //if not enabled-> fire checkMultipleCategoryPageCondition function
            //else -> fire checkSingleCategoryPageConditions function
            // let productAmount = 
            let conditionResult;
            let pageType = gbb?.gbbAddProductsPage?.state?.productPageData?.pageType
            if (gbb.state.currentPageId == 'personalizationPage') {
                let options = {
                    productQtyToAdd : productQuantity
                }
                conditionResult = gbb.gbbAddonProducts.f.checkMaxAddonProductsConditions(options)
            } else if (pageType && pageType == "MULTIPLE_CATEGORY") {
                let globalConditions = gbb.gbbAddProductsPage.state.productPageData?.isPageConditionsEnabled;
                if (!globalConditions) {
                    // let options = {productAmount, goToNextStep, category, checkConditionsForOneCategoryOnNext, productQuantity}  
                    let options = {
                        productAmount: productAmount,
                        goToNextStep: false,
                        category: category,
                        checkConditionsForOneCategoryOnNext: false,
                        productQuantity: productQuantity,
                        productWeight: productWeight
                    }
                    conditionResult = await gbb.utility.checkMultipleCategoryPageCondition(noteAttribute, options);
                } else {
                    let options = {
                        productAmount: productAmount,
                        productQuantity: productQuantity,
                        goToNextStep: false,
                        productWeight: productWeight
                    }

                    conditionResult = await gbb.utility.checkSingleCategoryPageConditions(noteAttribute, options);
                }
            } else {
                let options = {
                    productAmount: productAmount,
                    productQuantity: productQuantity,
                    goToNextStep: false,
                    productWeight: productWeight
                }
                // conditionResult = await gbb.utility.checkSingleCategoryPageConditions(noteAttribute, productAmount, productQuantity, false);
                conditionResult = await gbb.utility.checkSingleCategoryPageConditions(noteAttribute, options);
            }

            return conditionResult;
        },
        checkMultipleCategoryPageConditionOnNext: async function (noteAttribute, categoriesData) {
            //this function is fired when we're trying to go from a "multiple category" page to next page and "pagelevel" conditions are not enabled on this page
            let result;

            let categories = JSON.parse(JSON.stringify(categoriesData));
            //sort the checkMultipleCategoryPageConditionOnNext and place the current category at the first

            let currentCategory = gbb.gbbMultipleCategoriesPage.state.currentCategoryId;

            categories = categories.sort((a, b) => {
                if (a.categoryId == currentCategory) {
                    return -1;
                } else {
                    return 1;
                }
            });



            for (let index = 0; index < categories.length; index++) {
                // let options = {productAmount, goToNextStep, category, checkConditionsForOneCategoryOnNext, productQuantity}
                let options = {
                    productAmount: "",
                    goToNextStep: true,
                    category: categories[index]["categoryId"],
                    checkConditionsForOneCategoryOnNext: true,
                    productQuantity: ""
                }
                // result = await gbb.utility.checkMultipleCategoryPageCondition(noteAttribute, "", true, categories[index]["categoryId"], true, "");
                result = await gbb.utility.checkMultipleCategoryPageCondition(noteAttribute, options);
                if (!result.isConditionMet) {
                    break;
                }
            }
            return result;
        },
        checkMultipleCategoryPageCondition: async function (noteAttribute, { productAmount, goToNextStep, category, checkConditionsForOneCategoryOnNext, productQuantity, productWeight }) {
            //this function tells us if the conditions on multiple category page is satisfied
            //goToNextStep determines if productAmount or productQuantity values should be modified or not
            let categoryTitle;
            let categories = undefined
            categories = gbb.gbbAddProductsPage.state.productPageData.categories;
            categories = gbb.utility.convertObjectToArray(categories)

            if (goToNextStep && !checkConditionsForOneCategoryOnNext) {
                return gbb.utility.checkMultipleCategoryPageConditionOnNext(noteAttribute, categories);
            }
            let conditionResult = gbb.utility.getStepConditionsForMultipleCategoriesPage(categories, category);
            conditions = conditionResult.conditions;
            let categoryData = {
                categoryTitle: conditionResult.categoryTitle,
                categoryId: category
            }

            productAmount = gbb.utility.formatPriceWithoutSymbol(productAmount);
            let cartAmount, cartQuantity, cartResult;

            let pageType = "MULTIPLE_CATEGORY"
            let options = {
                productAmount: productAmount,
                productQuantity: productQuantity,
                goToNextStep: goToNextStep,
                category: category,
                pageType: pageType,
                productWeight: productWeight
            }
            let modifiedValues = await gbb.utility.modifyProductValuesToCheckCondiitons(noteAttribute, options)
            cartAmount = modifiedValues.result.cartAmount;
            cartQuantity = modifiedValues.result.cartQuantity;
            cartResult = modifiedValues.result.cartResult;
            cartWeight = modifiedValues.result.cartWeight;

            let dataForConditionsCheck = {
                conditions: conditions,
                cartAmount: cartAmount,
                cartQuantity: cartQuantity,
                cartResult: cartResult,
                goToNextStep: goToNextStep,
                categoryData: categoryData,
                cartWeight: cartWeight
            }

            let result = gbb.utility.loopThroughEachConditionAndCheck(conditions, dataForConditionsCheck);
            // result = {
            //     ...result,
            //     conditions: conditions
            // }
            return result;
        },
        checkSingleCategoryPageConditions: async function (noteAttribute, { productAmount, productQuantity, goToNextStep, productWeight }) {
            //this function tells us if the conditions on page is satisfied
            //goToNextStep determines if productAmount or productQuantity values should be modified or not
            let conditions = gbb.utility.getStepCondtions(noteAttribute);
            productAmount = gbb.utility.formatPriceWithoutSymbol(productAmount);
            let cartAmount, cartQuantity, cartResult, cartWeight;
            let options = {
                productAmount: productAmount,
                productQuantity: productQuantity,
                goToNextStep: goToNextStep,
                productWeight: productWeight
            }
            let modifiedValues = await gbb.utility.modifyProductValuesToCheckCondiitons(noteAttribute, options)
            cartAmount = modifiedValues.result.cartAmount;
            cartQuantity = modifiedValues.result.cartQuantity;
            cartResult = modifiedValues.result.cartResult;
            cartWeight = modifiedValues.result.cartWeight;
            let dataForConditionsCheck = {
                conditions: conditions,
                cartAmount: cartAmount,
                cartQuantity: cartQuantity,
                cartResult: cartResult,
                cartWeight: cartWeight,
                goToNextStep: goToNextStep
            }
            let result = gbb.utility.loopThroughEachConditionAndCheck(conditions, dataForConditionsCheck)
            // result = {
            //     ...result,
            //     conditions: conditions
            // }
            return result;
        },
        modifyProductValuesToCheckCondiitons: async function (noteAttribute, { productAmount, productQuantity, category, pageType, goToNextStep, productWeight }) {
            let cartResult = await gbb.utility.getStepCartData(noteAttribute, category, pageType);
            let cartQuantity = cartResult.quantity;
            let cartAmount = cartResult.amount;
            let cartWeight = cartResult.weight;
            gbb.utility.debugConsole("cartResult", cartResult);
            gbb.utility.debugConsole("ccartResult cartWeight", cartWeight);
            productAmount = parseInt(productAmount);
            if (!goToNextStep) {
                if (productQuantity) {
                    cartQuantity += productQuantity; //new cart quantity
                    productAmount = productAmount * productQuantity
                    productWeight = productWeight * productQuantity
                } else {
                    cartQuantity += gbb.gbbAddProductsPage.state.incrementProductQtyBy || 1;
                }
                cartAmount += productAmount;
                cartWeight += productWeight;
            }
            return { result: { cartAmount, cartQuantity, cartResult, cartWeight } };
        },
        loopThroughEachConditionAndCheck: function (conditions, { cartAmount, cartQuantity, cartResult, goToNextStep, categoryData, cartWeight }) {
            let categoryTitle = categoryData?.categoryTitle;
            let categoryId = categoryData?.categoryId;
            let pageType = gbb?.gbbAddProductsPage?.state?.productPageData?.pageType
            let result = {
                isConditionMet: true,
                message: "",
                conditions: conditions
            }

            let maxValue = 0;

            for (let j = 0; j < conditions.length; j++) {
                let currentCondtion = conditions[j]
                if (currentCondtion && currentCondtion.customValue){ // outdoor-dog-supply.com -> when merchant wants to handle conditions dynamically based on some custom logic 
                    // currentCondtion.customValue = "window.customStepCondition"
                    let customConditionValue = eval(currentCondtion.customValue) || currentCondtion.value
                    currentCondtion.value = customConditionValue
                }
                // get maxValue from the conditions array in the value field
                if (parseInt(conditions[j].value) > maxValue) {
                    maxValue = parseInt(conditions[j].value)
                }

                if (conditions[j].condition == "greaterThanOrEqualTo") {
                    maxValue = Number.MAX_SAFE_INTEGER;
                    break;
                }
            }



            for (let index = 0; index < conditions.length; index++) {
                let element = JSON.parse(JSON.stringify(conditions[index]));

                let allValuesFromConditions = conditions.map((condition) => {
                    return parseInt(condition.value)
                });
                element.maxValue = maxValue;

                let isThisLastElement = index - (conditions.length - 1) == 0 ? true : false
                let additionalInfo = {
                    conditions: conditions
                }
                if (element.type == "quantity") {
                    result.isConditionMet = gbb.utility.checkConditions(cartQuantity, element, goToNextStep);

                } else if (element.type == "amount") {
                    result.isConditionMet = gbb.utility.checkConditions(cartAmount, element, goToNextStep);
                } else if (element.type == "weight") {
                    //conver element value to grams
                    let weightValueInGrams = gbb.utility.convertToGrams(element.value, element.unit);
                    let weightConditionObject = {
                        ...element,
                        value: weightValueInGrams
                    }
                    result.isConditionMet = gbb.utility.checkConditions(cartWeight, weightConditionObject, goToNextStep);
                }

                let isAtleastOneTierSatisifed = false;
                if (element.condition == "equalTo") {
                    switch (element.type) {
                        case "quantity":
                            isAtleastOneTierSatisifed = allValuesFromConditions.includes(parseInt(cartQuantity))
                            break;
                        case "amount":
                            isAtleastOneTierSatisifed = allValuesFromConditions.includes(parseInt(cartAmount))
                            break;
                        case "weight":
                            isAtleastOneTierSatisifed = allValuesFromConditions.includes(parseInt(cartWeight))
                            break;
                    }
                }


                if (isAtleastOneTierSatisifed) {
                    result.isConditionMet = true;
                    break;
                }


                if (!result.isConditionMet) {
                    result.message = gbb.utility.getConditionMessage(element.type, element.condition);
                    let quantityVariables = gbb.utility.getQuantityVariables(element, cartResult, additionalInfo);
                    let amountVariables = gbb.utility.getAmountVariables(element, cartResult, additionalInfo);
                    let weightVariables = gbb.utility.getWeightVariables(element, cartResult, additionalInfo);
                    let message = gbb.utility.replaceConditionVariables(result.message, quantityVariables, amountVariables, weightVariables);
                    if (pageType && pageType == "MULTIPLE_CATEGORY") {
                        // scroll to categoryId
                        // write after clicking on category
                        // -100 for the top
                        // dont click on category if it's already clicked
                        if (gbb.utility.isCategoryOpen(categoryId)) {
                            gbb.utility.debugConsole("category already open")
                        } else {
                            gbb.$(`div[categoryId='${categoryId}']`).click()
                        }
                        // gbb.utility.scrollToCategory(categoryId, -100)

                        gbb.f.renderConditionNotificationToast(message, categoryTitle);
                    } else {
                        gbb.f.renderConditionNotificationToast(message);
                    }
                    break;
                }
            }
            return result;
        },
        getPageRankByPageId: function (pageId) {
            try {
                let navigationItems = gbb.state.navigationItems || [];
                let item = navigationItems.find(item => item?.id == pageId);
                return item?.rank;
            } catch (error) {
                gbb.utility.debugConsole("error in getPageRankByPageId", error)
            }
        },
        checkConditionsOnNext: async function (noteAttribute) {
            //this function is fired when we're going from current page to next page
            //if it's a single catgory page -> fire checkSingleCategoryPageConditions function
            //multiple category page ->
            //->check if page level conditions are enabled
            //if not enabled-> fire checkMultipleCategoryPageCondition function
            //else -> fire checkSingleCategoryPageConditions function
            //personalization page -> relevant conditions
            let condition;
            let pageType = gbb?.gbbAddProductsPage?.state?.productPageData?.pageType
            let options = {
                productAmount: "",
                productQuantity: "",
                goToNextStep: true
            }
            if (noteAttribute == "personalizePage" || gbb.state.currentPageId == 'personalizationPage') {
                condition = gbb.utility.checkPersonalizePageConditions();

            } else if (pageType && pageType == "MULTIPLE_CATEGORY") {
                let globalConditions = gbb.gbbAddProductsPage.state.productPageData?.isPageConditionsEnabled;
                if (!globalConditions) {
                    let categories = gbb.gbbAddProductsPage.state.productPageData.categories;
                    categories = gbb.utility.convertObjectToArray(categories)
                    condition = await gbb.utility.checkMultipleCategoryPageConditionOnNext(noteAttribute, categories);
                } else {
                    // condition = await gbb.utility.checkSingleCategoryPageConditions(noteAttribute, "", "", true);
                    condition = await gbb.utility.checkSingleCategoryPageConditions(noteAttribute, options);
                }

            } else {
                // condition = await gbb.utility.checkSingleCategoryPageConditions(noteAttribute, "", "", true);
                condition = await gbb.utility.checkSingleCategoryPageConditions(noteAttribute, options);
            }
            return condition;
        },
        checkPersonalizePageConditions: function () {
            let result = {
                isConditionMet: true, //because if text message and video message are both disabled -> isConditionMet should be true
                message: ""
            }
            if (gbb?.settings?.giftMessage?.isGiftMessageMandatory && (!gbb.gbbPersonalizePage.state?.giftMessage || gbb.gbbPersonalizePage.state?.giftMessage?.trim().length == 0)) {
                let warningMsg = gbb.$(".gbbPageBody").find(".gbbGiftMessageV2RequiredWarning");
                warningMsg.css("display", "block")
                result.isConditionMet = false;
                return result;
            } else {
                let warningMsg = gbb.$(".gbbPageBody").find(".gbbGiftMessageV2RequiredWarning");
                warningMsg.css("display", "none")
                result.isConditionMet = true;
            }

            let isEmailInfoValid = gbb.gbbPersonalizePage.f.verifyEmailFields();
            if (!isEmailInfoValid) {
                result.isConditionMet = false
            }
            let isAddonEnabled = gbb.gbbAddonProducts.state.isEnabled 
            if (isAddonEnabled) {
                let isAddonPageConditionMet = gbb.gbbAddonProducts.f.checkAddonsConditionsOnNext();
                if (!isAddonPageConditionMet) {
                    result.isConditionMet = false;
                    let message = gbb.utility.renderLanguageValue(gbb.settings?.languageData?.addons?.addonProductsMandatory) || "Please add atleast one product1"
                    gbb.f.renderConditionNotificationToast(message)
                }

            }
            return result;
        },
        getQuantityVariables: function (element, cartResult, additionalInfo) {
            let quantityVariables = {};

            let conditions = additionalInfo?.conditions || [];
            let isNextValueSet = false;

            if (element.condition == "equalTo") {
                for (let j = 0; j < conditions.length; j++) {
                    let item = conditions[j];
                    if ((parseInt(item.value) >= parseInt(cartResult.quantity)) && !isNextValueSet) {
                        // nextConditionalQuantity = item.value;
                        isNextValueSet = true;
                        element.value = item.value
                    }
                }
            }

            quantityVariables.currentQuantity = cartResult.quantity;
            quantityVariables.conditionQuantity = element.value;
            quantityVariables.remainingQuantity = Math.abs(quantityVariables.currentQuantity - quantityVariables.conditionQuantity);
            return quantityVariables;
        },
        getAmountVariables: function (element, cartResult, additionalInfo) {
            let amountVariables = {};
            let conditions = additionalInfo?.conditions || [];
            let isNextValueSet = false;

            if (element.condition == "equalTo") {
                for (let j = 0; j < conditions.length; j++) {
                    let item = conditions[j];
                    if ((parseInt(item.value) >= parseInt(cartResult.amount)) && !isNextValueSet) {
                        element.value = item.value
                        isNextValueSet = true;
                    }
                }
            }
            amountVariables.currentAmount = cartResult.amount;
            amountVariables.conditionAmount = element.value;
            amountVariables.remainingAmount = Math.abs(amountVariables.currentAmount - amountVariables.conditionAmount);
            return amountVariables;
        },
        getWeightVariables: function (element, cartResult, additionalInfo) {
            let weightVariables = {};

            let conditions = additionalInfo?.conditions || [];
            let isNextValueSet = false;

            if (element.condition == "equalTo") {
                for (let j = 0; j < conditions.length; j++) {
                    let item = conditions[j];
                    if ((parseInt(item.value) >= parseInt(cartResult.weight)) && !isNextValueSet) {
                        element.value = item.value
                        isNextValueSet = true;
                    }
                }
            }

            weightVariables.currentWeight = cartResult.weight;
            weightVariables.conditionWeight = element.value + String(element.unit);
            weightVariables.remainingWeight = Math.abs(weightVariables.currentWeight - weightVariables.conditionWeight) + String(element.unit);
            return weightVariables;
        },
        replaceConditionVariables: function (message, quantityVariables, amountVariables, weightVariables) {
            for (let [key, value] of Object.entries(quantityVariables)) {
                if (!value) {
                    value = ""
                }
                let VariableName = "##" + key + "##"
                //let VariableName = JSON.stringify(`}`)
                message = message.replace(new RegExp(`${VariableName}`, 'g'), value);
            }
            for (let [key, value] of Object.entries(amountVariables)) {
                if (!value) {
                    value = ""
                }
                let VariableName = "##" + key + "##"
                value = gbb.utility.getCurrencySymbol() + "" + value;
                message = message.replace(new RegExp(`${VariableName}`, 'g'), value);
            }
            for (let [key, value] of Object.entries(weightVariables)) {
                if (!value) {
                    value = ""
                }
                let VariableName = "##" + key + "##"
                message = message.replace(new RegExp(`${VariableName}`, 'g'), value);
            }
            return message;
        },
        getStepCondtions: function (noteAttribute) {
            let conditions = [];

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey

            // convert this to if else
            if (addProductsPageArr.includes(noteAttribute)) {
                conditions = gbb.settings.stepsConfigurationData[keyAttribute].conditions || [];
            }

            return conditions;
        },
        getStepConditionsForMultipleCategoriesPage: function (categories, category) {
            let result = {
                categoryTitle: "",
                conditions: []
            }
            for (let index = 0; index < categories.length; index++) {
                let ele = categories[index];
                if (ele.categoryId == category) {
                    result.conditions = ele.conditions;
                    result.categoryTitle = ele.title || ""
                    break;
                }
            }
            return result;
        },
        getStepCartData: async function (noteAttribute, category, pageType) { //gets the total amount of the products added in a specific step
            let result = {
                amount: 0,
                quantity: 0,
                weight: 0
            }
            let cartData = await gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage() //if we should use the cart state

            let items = cartData.items;
            for (let index = 0; index < items.length; index++) {

                let item = items[index];
                if (item && item.properties && item.properties._boxProduct == noteAttribute) {

                    if (pageType && pageType == "MULTIPLE_CATEGORY") {
                        //document - metch category if MULTIPLE_CATEGORY page, 
                        if (item.properties._Category != category) {
                            continue
                        }
                    }

                    let amount = gbb.utility.formatPriceWithoutSymbol(item.price);
                    amount = amount * item.quantity;
                    result.amount += amount;
                    result.quantity += item.quantity
                    result.weight += item.weight * item.quantity
                }
            }
            return result;
        },
        executeRedirectAction: function () {
            try {

                let regionalLocale = gbb.utility.getRegionalLocaleFromUrl();
                if (gbb.settings.app.stackDiscounts) {
                    let discountString = gbb.gbbBrowser.prepareDiscountString();
                    if (discountString) {
                        gbb.gbbDiscountComponent.state.discountCode = discountString;
                    }
                }

                if (gbb.settings.app.redirectToScript && gbb.settings.app.redirectToScript?.trim()?.length != 0) {
                    const codeString = gbb.settings.app.redirectToScript;
                    eval(codeString);
                } else if (gbb.settings.app.redirectToCheckoutEnabled) {
                    if (gbb.gbbDiscountComponent.state.discountCode) {
                        // https://{domain}/discount/{discountCode}?redirect=/checkout
                        window.location.href = window.location.origin + regionalLocale + "/cart/checkout?discount=" + gbb.gbbDiscountComponent.state.discountCode;
                        // window.location.href =  window.location.origin + "/discount/" + gbb.gbbDiscountComponent.state.discountCode+"?redirect=/checkout";
                    }
                    else {
                        window.location.href = window.location.origin + regionalLocale + "/cart/checkout";
                    }
                } else if (gbb.settings.app.redirectToCartEnabled) {
                    window.location.href = window.location.origin + regionalLocale + "/cart/";
                } else {
                    if (gbb.gbbDiscountComponent.state.discountCode) {
                        window.location.href = window.location.origin + regionalLocale + "/cart/checkout?discount=" + gbb.gbbDiscountComponent.state.discountCode;
                        // window.location.href =  window.location.origin + "/discount/" + gbb.gbbDiscountComponent.state.discountCode+"?redirect=/checkout";
                    }
                    else {
                        window.location.href = window.location.origin + regionalLocale + "/cart/checkout";
                    }
                }
            } catch (err) {
                gbb.utility.debugConsole(err + "inside executeRedirectAction");
            }
        },

        loadCheckoutPage: async function () {

            if (gbb.state.giftBoxCartData?.items?.length > 0 && gbb.settings?.discountsData?.isDiscountEnabled && gbb.gbbDiscountComponent?.state?.discountCode) {
                // window.location.href = window.location.origin + "/discount/" + gbb.gbbDiscountComponent.state.discountCode + "?redirect=" + window.location.pathname
                // const discountResp = await fetch("/discount/" + gbb.gbbDiscountComponent.state.discountCode);
                // if (response.status == 200) {
                // window.location.href = window.location.origin + "/cart/checkout"
                // gbb.utility.executeRedirectAction();
                // }

                await fetch("/discount/" + gbb.gbbDiscountComponent.state.discountCode)
                    .then(resp => resp.json())
                    .then((response) => {
                        //response.data
                        if (response.data.isAutomatic) {
                            setTimeout(() => {
                                gbb.utility.executeRedirectAction();
                            }, 1000);
                        } else {
                            gbb.utility.executeRedirectAction();
                        }
                    }).catch((err) => {
                        gbb.utility.debugConsole(err);
                        gbb.utility.executeRedirectAction();
                    })

                return;
            }

            gbb.utility.executeRedirectAction();
        },
        getVariantDetailsFromCurrentProductsDataSet: function (variantId,origin) { 
            try {
                let variantDetails = gbb.state.currentProductsDataSetForVariants[variantId];
                if (origin == 'addonProducts') {
                    variantDetails = gbb.gbbAddonProducts.state.currentProductsDataSetForVariants_addons[variantId]
                }
                return variantDetails;
            } catch (error) {
                gbb.utility.debugError("error in getVariantDetailsFromCurrentProductsDataSet",error)
            }
        },
        getProductDetailsFromState: function (productId, variantId) {
            let productDetails = {};
            let productsDbToSearchIn = gbb.gbbAddProductsPage.state.currentProductsDataset
            let addonProductsState = gbb.gbbAddonProducts.state
            let isAddonProductDataSetExists = addonProductsState?.addonProductsDataSet?.length > 0
            let isCurrentPageTypePersonalization = gbb.state.currentPageId == 'personalizationPage'
            let eligibleTierForAddons = addonProductsState?.eligibleTierForAddons || {}

            if (isCurrentPageTypePersonalization && Object.keys(eligibleTierForAddons).length>0 && isAddonProductDataSetExists) {
                productsDbToSearchIn = addonProductsState?.addonProductsDataSet
            }

            for (let i = 0; i < productsDbToSearchIn?.length; i++) {
                let product = productsDbToSearchIn[i];
                if (product.id == productId) {
                    let variantDetails;
                    productDetails = product;
                    let isDisplayVariantsAsIndividualProductsEnabled = gbb.gbbAddProductsPage.state.displayVariantsAsIndividualProducts

                    if (isCurrentPageTypePersonalization) {
                        let activeTierIndex = eligibleTierForAddons?.tierIndex
                        isDisplayVariantsAsIndividualProductsEnabled = addonProductsState.tiers[activeTierIndex]?.displayVariantsAsIndividualProducts_addons// read from addon
                    }

                    if (variantId && isDisplayVariantsAsIndividualProductsEnabled) {
                        let origin = isCurrentPageTypePersonalization ? "addonProducts": null
                        variantDetails = gbb.utility.getVariantDetailsFromCurrentProductsDataSet(variantId, origin)
                        gbb.utility.debugConsole("variants name is ", variantDetails.title);
                        product.variants = [variantDetails];
                        product = gbb.gbbAddProductsPage.f.updateProductDataWithFirstVariantData(product);
                        productDetails = product;
                        break;  // Exit the loop once we found the product
                    }
                }
            }
            return productDetails;
        },
        closeVariantsModal: function () {
            try {
                gbb.utility.slider.state.slideIndex = 1;
                gbb.state.variantCustomProperties = {};
                gbb.state.currentModalProductData = {};
                gbb.gbbProductFormStep.state.formSubmissionData = {};
                // gbb.$("body").css("overflow-y", "auto");
                gbb.$("body").find(".gbbProductVariantModalContainer").remove()
                gbb.$("body").find(".gbbProductVariantModalMainContainer").remove()
                gbb.$("body").css("overflow-y", DEFAULT_BODY_OVERFLOW_VALUE);
                gbb.gbbBrowser.emitCustomEvent({
                    eventName: "gbb-variants-modal-close",
                })
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        productDetailsWith_VariantId_Or_ProductIdAsKey: function (products, extraInfo) {
            //products is an objects with product handle as key
            //this function returns an object with product id as key
            let productsWithIdAsKey = {};
            for (let [key, value] of Object.entries(products)) {
                let product = value
                //if product has variants
                if (product.variants.length > 0) {

                    // if product.variants.length == 1;
                    // change product.featured_image to product.variants[0].image

                    //if there is only one variant in the product
                    // then change the product.featured_image to an image
                    // using product.media[]
                    if (product.variants.length == 1) {
                        let getNewImageAndMediaObjectWhenOnlyOneVariant = gbb.utility.getNewImageAndMediaObjectWhenOnlyOneVariant(product);
                        product.featured_image = getNewImageAndMediaObjectWhenOnlyOneVariant.newFeaturedImage;
                        product.media = getNewImageAndMediaObjectWhenOnlyOneVariant.newMedia;
                        product.images = getNewImageAndMediaObjectWhenOnlyOneVariant.newImages
                    }

                    for (let i = 0; i < product.variants.length; i++) {
                        product.variants[i]["productTags"] = product.tags;
                        product.variants[i].variant_id = product.variants[i].id;
                        product.variants[i].image = product.variants[i].featured_image?.src;
                        if (!product.variants[i].image) {
                            product.variants[i].image = product.featured_image
                        }

                        if (extraInfo == undefined || product.variants[i].title == "" || product?.variants?.length == 1) {
                            product.variants[i].title = product.variants[i].name
                        } else if (!extraInfo.shouldVariantTitleBeConvertedToProductTitle) {
                            product.variants[i].title = product.variants[i].title
                        }
                        product.variants[i].product_id = product.id
                        product.variants[i].productHandle = product.handle;
                        if (product.selling_plan_groups) {
                            //product.variants[i].sellingPlanDetails = gbb.utility.getSellingPlanDetailsForVariant(product?.selling_plan_groups, product.variants[i]?.selling_plan_allocations)
                            product.variants[i].selling_plan_groups = product.selling_plan_groups || [];
                            product.variants[i].selling_plan_allocations = product?.variants[i]?.selling_plan_allocations || [];
                        }
                        productsWithIdAsKey[product.variants[i].id] = product.variants[i];

                    }
                }

                //if product has no variants
                else {
                    productsWithIdAsKey[product.id] = product;
                }
            }

            return productsWithIdAsKey;
        },
        doesThisProductHaveConditions: function (currentProductProperties) {
            // const pagesWhichHaveConditionsOnPages = 
            const categoriesWhichHaveConditions = gbb.gbbAddProductsPage.state.categoriesWhichHaveConditions;
            const pagesWhichHaveConditionsOnPages = gbb.gbbAddProductsPage.state.pagesWhichHaveConditionsOnPages;
            if (pagesWhichHaveConditionsOnPages.includes(currentProductProperties._boxProduct) || categoriesWhichHaveConditions.includes(currentProductProperties._Category)) {
                return true;
            } else {
                return false;
            }

        },
        prepareMsgAttributesForCart: function () {
            try {
                let videoRecordId;
                let videoToggle = gbb.$(".gbbVideoMsgCheckboxField").is(":checked")
                if (videoToggle == false) {
                    videoRecordId = "";
                    gbb.gbbVideoMsg.state.uploadedVideoId = ""
                } else {
                    videoRecordId = gbb.gbbVideoMsg?.state?.uploadedVideoId;
                }

                gbb.gbbVideoMsg.state.uploadedVideoId = videoRecordId;

                if (!gbb.gbbPersonalizePage.state.giftMessage && !gbb.gbbVideoMsg.state.uploadedVideoId) {
                    quantity = 0;
                }



                return {
                    message: gbb.gbbPersonalizePage.state.giftMessage,
                    recipientName: gbb.gbbPersonalizePage.state.recipientName,
                    senderName: gbb.gbbPersonalizePage.state.senderName,
                    customerUploads: gbb.gbbPersonalizePage.state.customerUploadsResponse,
                    _videoMsgId: videoRecordId ? videoRecordId : null,
                    email: gbb.gbbVideoMsg?.state?.emailId,
                    _gbbEmailDeliveryOption: gbb?.gbbPersonalizePage?.state?.emailDeliveryOption,
                    _gbbEmailDeliveryDate: gbb?.gbbPersonalizePage?.state?.emailDatePicker ? gbb?.gbbPersonalizePage?.state?.emailDatePicker?.val() : "",
                }
            } catch (e) {
                gbb.utility.debugConsole(e)
                return false
            }
        },
        getActiveCurrencyRate: function () {
            let currencyRate = 1;
            if (window.Shopify && window.Shopify.currency && window.Shopify.currency.rate) {
                currencyRate = window.Shopify.currency.rate;
            }
            return currencyRate;
        },
        multiplyByBundleQuantity: function (cartData) {
            let cart = { ...cartData }
            cartData.bundleQuantity = cartData.boxQuantity || 1;
            let bundleQuantity = cartData?.bundleQuantity || 1;

            if (bundleQuantity > 1) {
                cart.items.forEach((item) => {
                    item.quantity = item.quantity * bundleQuantity;
                });
                cart.item_count = cart.item_count * bundleQuantity;
                cart.total_price = cart.total_price * bundleQuantity;
            }
            return cart;
        },
        applySellingPlanToAllCartItems: function (cartData) {
            let subscriptionPlan = gbb.gbbBrowser.getSubscriptionPlan();
            if (subscriptionPlan) {
                for (let i = 0; i < cartData.items.length; i++) {
                    delete cartData.items[i]?.selling_plan_allocations;
                    delete cartData.items[i]?.selling_plan_groups;
                    delete cartData.items[i]?.sellingPlanDetails;
                    cartData.items[i].selling_plan = parseInt(subscriptionPlan);
                }
            }
            return cartData;
        },
        applySellingPlanToAllCartItemsV2: function (cartData) {
            let activeSellingPlanId = gbb.gbbSubscriptionProductsPage.state.activeSellingPlanId
            if (activeSellingPlanId) {
                for (let i = 0; i < cartData.items.length; i++) {
                    delete cartData.items[i]?.selling_plan_allocations;
                    delete cartData.items[i]?.selling_plan_groups;
                    delete cartData.items[i]?.sellingPlanDetails;
                    cartData.items[i].selling_plan = parseInt(activeSellingPlanId);
                }
            }
            return cartData
        },
        checkIfBrandingShouldBeVisible: function (type) {
            try {

                // createdAt is more than 2months;
                let todayDate = new Date();
                let createdAt = new Date(gbb.settings.merchantInfo.createdAt);

                let storeIsOld = false;
                let diffTime = Math.abs(todayDate - createdAt);

                let diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays > 14) {
                    storeIsOld = true
                }

                if (!gbb.settings.merchantInfo?.isSubscription && storeIsOld) {
                    return false;
                }

                if (!gbb.settings?.merchantInfo?.isSubscription) {
                    return true;
                }
                if (gbb.settings?.merchantInfo?.isSubscription && gbb.settings?.merchantInfo?.isSubscription.name.search('Free') !== -1 && !type && type !== 'checkout') {
                    return true;
                }
                return false;
            } catch (error) {
                gbb.utility.debugConsole("error in checkIfBrandingShouldBeVisible", error);
                return false;
            }
        },
        renderPoweredByLabel: function () {
            let gbbPoweredByLabel = gbb.$("<a>")
                .attr("href", "https://apps.shopify.com/bundle-builder").attr("target", "_blank")
                .css("text-align", "end").css("display", "block").css("color", "black").css("font-size", "14px").css("text-decoration", "none");
            gbbPoweredByLabel.text("✨Powered By Easy Bundles✨");
            return gbbPoweredByLabel;
        },
        triggerSlackNotification: function (jsonBody) {
            jsonBody = jsonBody || {};

            gbb.utility.debugConsole("jsonBody", jsonBody)
            jsonBody = {
                errorStack: jsonBody?.stack || jsonBody?.error?.stack,
                errorName: jsonBody?.name || jsonBody?.error?.name,
                errorMessage: jsonBody?.message || jsonBody?.error?.message,
                sessionStorage: gbb.gbbBrowser.getCartDataFromSessionStorage(),
                ...jsonBody
            }

            const tempObj = {
                url: window.location.href,
                function: arguments?.callee?.caller?.name || "unknown",
                error: JSON.stringify(jsonBody)
            }


            let url = gbb.settings.SERVER_URL + "/api/utility/slackNotification";
            fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(tempObj),
            }).then((response) => {
                gbb.utility.debugConsole("response", response)
            }).catch((error) => {
                gbb.utility.debugConsole("error", error)
            })

        },
        /** overwrites particular html tags 
        * example: overwrite tab/document name
        * @returns void 
        */
        setBuilderPageHTMLData_SEO: function () {
            try {
                // page
                let seoData = gbb.settings?.bundleSettings.builderPageSeoData || [];

                // 
                // example
                // [{
                //     target: "title",
                //     value: "Bundle Builder"
                //     // attributeToOverwrite field is not needed as attribute to overwrite as it's a text
                // },
                // {
                //     target: "meta[name='description']",
                //     value: "Bundle Builder",
                //     attributeToOverwrite: "content"
                // }]

                seoData.forEach((data) => {
                    if (data.attributeToOverwrite && data.target && data.value) {
                        // gbb.$(data.target).attr("content", data.value);
                        gbb.$(data.target).attr(data.attributeToOverwrite, data.value);
                    }
                    else if (data.target && data.value) {
                        gbb.$(data.target).text(data.value);
                    }
                })

            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        stringifyError: function (error) {
            const properties = Object.getOwnPropertyNames(error);
            const stringifiedError = JSON.stringify(
                (function () {
                    const obj = {};
                    for (let i = 0; i < properties.length; i++) {
                        const prop = properties[i];
                        obj[prop] = error[prop];
                    }
                    return obj;
                })()
            );
            return stringifiedError;
        },
        cleanUpProperties: function (cart) {
            let cartData = { ...cart }
            let propertiesToRemove = ["addProductsPage", "categoryId", "_Category", "category", "_boxProduct", "productPersonalizationMetaData", "_uniqueGbbItemKey"]
            let conditionalPropertiesToRemove = [];
            if (!gbb?.settings?.bundleSettings?.showCategoryNamesInLineItem) {
                conditionalPropertiesToRemove.push("_CategoryName");
                // propertiesToRemove.push("discount")
            }

            // now lets combine 
            propertiesToRemove = [...propertiesToRemove, ...conditionalPropertiesToRemove];

            cartData.items.forEach((item) => {
                propertiesToRemove.forEach((property) => {
                    if (item.properties && item.properties[property]) {
                        delete item.properties[property];
                    }
                });
            })
            return cartData;
        },
        addCustomProperties: function (cartData, propertiesToAdd,addQtyOfProduct=false) {
            try {
                cartData.items.forEach((item) => {
                    for (let [key, value] of Object.entries(propertiesToAdd)) {
                        let valueToAdd = addQtyOfProduct ? `${value}_${item.quantity}` : value;
                        item.properties[key] = valueToAdd
                    }
                })
                return cartData
            } catch (error) {
                gbb.utility.debugConsole('error in addCustomProperties',error)
            }
        },
        checkIfRemoveButtonShouldBeAppended: function (variantId, pageIdTheProductWasAddedFrom) {
            try {
                let boxCartDataInSessionStorage = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
                if (boxCartDataInSessionStorage) {
                    let items = boxCartDataInSessionStorage.items || [];
                    let currentItem = items.find((item) => item.variant_id == variantId && pageIdTheProductWasAddedFrom == item.properties["_boxProduct"]);
                    // let currentite,
                    if (currentItem) {
                        let item = { ...currentItem };
                        let properties = Object.keys(item.properties) || [];
                        if (properties.includes("_DefaultProduct")) {
                            return false;
                        }

                        if (item.properties._boxProduct == "giftMessage" && gbb.state.currentPageId !== "personalizationPage") {
                            if (gbb.settings.stepsConfigurationData.personalizationData.giftMessage.isGiftMessageMandatory) {
                                return false;
                            } else {
                                return true;
                            }
                        }
                        if (gbb.state.currentPageId == 'personalizationPage' && item.properties._boxProduct == 'addonProduct'){
                            return true;
                        }
                        if (pageIdTheProductWasAddedFrom == gbb.state.currentPageId) {
                            if (item.properties && item.properties._boxProduct != gbb.state.currentPageId) {
                                // now check if this doesThisProductHaveConditions
                                let doesThisProductHaveConditions = gbb.utility.doesThisProductHaveConditions(item.properties);
                                let isConditionalProductFilteringEnabled = gbb.settings.stepsConfigurationData.conditionalLogic.isEnabled || gbb.settings.stepsConfigurationData.conditionalLogic.rules.length > 0
                                gbb.utility.debugConsole("doesThisProductHaveConditions", doesThisProductHaveConditions)
                                if (doesThisProductHaveConditions || isConditionalProductFilteringEnabled) {
                                    return false;
                                } else {
                                    return true;
                                }
                            } else {
                                return true;
                            }
                        } else {
                            return false;
                        }
                    }
                }
                return true;
            } catch (err) {
                gbb.utility.debugConsole(err + "inside checkIfRemoveButtonShouldBeAppended");
            }
        },
        updateBoxIdInCartData: function (cartData) {
            try {

                let currentBoxIdFromCart = gbb.gbbBrowser.state.boxIdOffset || 0;
                if (currentBoxIdFromCart == 0) {
                    gbb.utility.debugConsole("Adding to cart....")
                    return cartData;
                } else {
                    gbb.utility.debugConsole("Aheem. Looks like theres already a box in the cart.")
                    gbb.utility.debugConsole("next boxId starts from->", currentBoxIdFromCart + 1)
                    let cartDataUpdated = { ...cartData };

                    let boxKeys = Object.keys(cartDataUpdated?.boxes) || [];

                    for (let i = 0; i < boxKeys.length; i++) {
                        let boxItem = cartDataUpdated.boxes[boxKeys[i]];

                        boxItem.items.forEach(item => {
                            const existingBoxID = item.properties["Box ID"];
                            item.properties["Box ID"] = parseInt(existingBoxID) + currentBoxIdFromCart;
                        });
                    }
                    return cartDataUpdated;
                }
            } catch (error) {
                gbb.utility.debugConsole("error in updateBoxIdInCartData", error)
                return cartData;
            }
        },
        removeAlreadyAddedProductsFromShopifyCart: async function () {
            try {
                let bundleName = gbb?.settings?.stepsConfigurationData?.bundleName;
                let boxIdOffset = parseInt(gbb.gbbBrowser.state.boxIdOffset);
                let qty = 0;
                let data = { updates: {} };
                let result = true;
                if (bundleName) {
                    let shopifyCartItems = await gbb.shopifyUtility.getCart();
                    shopifyCartItems = shopifyCartItems.items;
                    if (shopifyCartItems.length > 0) {
                        for (let i = 0; i < shopifyCartItems.length; i++) {
                            let item = shopifyCartItems[i];
                            let itemBundleName = item.properties["Bundle"];
                            let itemBoxId = parseInt(item.properties["Box ID"]);
                            if (itemBundleName && itemBundleName == bundleName && itemBoxId > boxIdOffset) { //tbd more conditions?
                                data.updates[shopifyCartItems[i]["key"]] = qty;
                            }
                        }
                        if (Object.keys(data?.updates)?.length > 0) {
                            result = await gbb.shopifyUtility.updateCart(data);
                        }
                    }
                }
                return result;
            } catch (err) {
                gbb.utility.debugConsole(err);
                return false;
            }
        },

        renderPreparingBundleModal: function () {
            try {
                const gbbPreparingBundleMainContainer = gbb.$("<div>").addClass("gbbPreparingBundleMainContainer");
                const gbbPreparingBundleContainerModal = gbb.$("<div>").addClass("gbbPreparingBundleContainerModal");

                const gbbPreparingBundleHeader = gbb.$("<div>").addClass("gbbPreparingBundleHeader");
                gbbPreparingBundleHeader.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.preparingBundleText) || "Preparing Bundle...");

                let preparingBundleGif = gbb.settings.merchantInfo?.customSettings?.preparingBundleGif || "https://d3ks0ngva6go34.cloudfront.net/public/packagingbundle.gif";
                const gbbPreparingBundleGifContainer = gbb.$("<div>").addClass("gbbPreparingBundleGifContainer");
                const gbbPreparingBundleGif = gbb.$("<img>").addClass("gbbPreparingBundleGif").attr("src", preparingBundleGif);

                gbbPreparingBundleGifContainer.append(gbbPreparingBundleGif);

                gbbPreparingBundleContainerModal.append(gbbPreparingBundleHeader);
                gbbPreparingBundleContainerModal.append(gbbPreparingBundleGifContainer);
                gbbPreparingBundleMainContainer.append(gbbPreparingBundleContainerModal);
                gbb.$("body").append(gbbPreparingBundleMainContainer);
                gbb.f.applyFontToPreparingBundlePopup();
            } catch (err) {
                gbb.utility.debugConsole("error inside renderPreparingBundleModal:", err);
            }
        },

        renderUnavaibleProductsModal: async function (products) {
            const gbbUnavailableProductsMainContainer = gbb.$("<div>").addClass("gbbUnavailableProductsMainContainer");
            const gbbUnavailableProductsContainerModal = gbb.$("<div>").addClass("gbbUnavailableProductsContainerModal");

            const gbbCartProductsContainerHeader = gbb.$("<div>").addClass("gbbCartProductsContainerHeader");
            const gbbCartProductsContainerHeaderLabel = gbb.$("<div>").addClass("gbbCartProductsContainerHeaderLabel").text(gbb.settings?.languageData?.general?.productsNotAvailableText?.value || "Oops! Some products are not availble..");

            const gbbCartProductsContainerBody = gbb.$("<div>").addClass("gbbCartProductsContainerBody");

            const gbbCartModalProductsContainer = gbb.$("<div>").addClass("gbbCartModalProductsContainer");


            products.forEach((product) => {
                const gbbCartModalProductContainer = gbb.$("<div>").addClass("gbbCartModalProductContainer");
                //attach a data attriute to the product container
                gbbCartModalProductContainer.attr("productId", product?.product_id);
                gbbCartModalProductContainer.attr("variantId", product?.variant_id)

                const gbbCartProductImageContainer = gbb.$("<div>").addClass("gbbCartProductImageContainer");
                const gbbCartModalProductImage = gbb.$("<img>").addClass("gbbCartModalProductImage");
                gbbCartModalProductImage.attr("src", product.image);
                const gbbCartModalProductTextContainer = gbb.$("<div>").addClass("gbbCartModalProductTextContainer");

                const gbbCartModalProductTitleContainer = gbb.$("<div>").addClass("gbbCartModalProductTitleContainer");
                const gbbCartModalProductTitle = gbb.$("<div>").addClass("gbbCartModalProductTitle");
                const gbbCartModalProductQuantity = gbb.$("<div>").addClass("gbbCartModalProductQuantity");

                const gbbCartModalProductPriceQtyContainer = gbb.$("<div>").addClass("gbbCartModalProductPriceQtyContainer");
                const gbbCartModalProductPrice = gbb.$("<div>").addClass("gbbCartModalProductPrice");
                //a button to remove the product from the cart

                gbbCartModalProductTitle.text(product.title);
                gbbCartModalProductPrice.text(gbb.utility.formatPrice(product.price));
                gbbCartModalProductQuantity.text("x" + product.quantity);
                gbbCartProductImageContainer.append(gbbCartModalProductImage);

                gbbCartModalProductTitleContainer.append(gbbCartModalProductTitle);
                //gbbCartModalProductTitleContainer.append(gbbCartModalProductQuantity);

                gbbCartModalProductTextContainer.append(gbbCartModalProductTitleContainer);
                gbbCartModalProductPriceQtyContainer.append(gbbCartModalProductQuantity);
                gbbCartModalProductPriceQtyContainer.append(gbbCartModalProductPrice);
                gbbCartModalProductTextContainer.append(gbbCartModalProductPriceQtyContainer);

                gbbCartModalProductContainer.append(gbbCartProductImageContainer);
                gbbCartModalProductContainer.append(gbbCartModalProductTextContainer);
                gbbCartModalProductsContainer.append(gbbCartModalProductContainer);
            })

            gbbCartProductsContainerHeader.append(gbbCartProductsContainerHeaderLabel);

            gbbCartProductsContainerBody.append(gbbCartModalProductsContainer);

            let checkoutButtonText = gbb?.settings?.languageData?.general?.checkoutButtonText?.value || "Checkout";

            if (gbb.settings.app.redirectToCartEnabled && !gbb.settings.app.redirectToCheckoutEnabled) {
                checkoutButtonText = gbb?.settings?.languageData?.general?.addToCartButtonText?.value || "Add to Cart";
            }
            const gbbUnavailableProductsModalFooter = gbb.$("<div>").addClass("gbbUnavailableProductsModalFooter");
            const gbbUnavailableProductsModalFooterBackBtn = gbb.$("<div>").addClass("gbbUnavailableProductsModalFooterBackBtn");
            gbbUnavailableProductsModalFooterBackBtn.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.backButtonText) || "Back to Bundle")
            gbbUnavailableProductsModalFooterBackBtn.css("background", gbb.settings.pageCustomizationData.cartFooter.cartFooterBackButtonColor);
            gbbUnavailableProductsModalFooterBackBtn.css("color", gbb.settings.pageCustomizationData.cartFooter.cartFooterBackButtonTextColor);
            gbbUnavailableProductsModalFooterBackBtn.on("click", async () => {
                gbbUnavailableProductsModalFooterBackBtn.addClass("gbbDisabled")
                gbbUnavailableProductsModalFooterCheckoutBtn.addClass("gbbDisabled")
                let removeProducts = await gbb.utility.removeAlreadyAddedProductsFromShopifyCart();
                gbbUnavailableProductsModalFooterBackBtn.removeClass("gbbDisabled")
                gbbUnavailableProductsModalFooterCheckoutBtn.removeClass("gbbDisabled")
                if (removeProducts) {
                    gbb.$("body").find(".gbbUnavailableProductsMainContainer").remove()
                }
                gbb.$("body").find(".gbbSummaryPageCheckoutButton").removeClass("gbbDisabled")

                gbb.$("body").find(".gbbSummaryPageCheckoutButton").text(checkoutButtonText);
                gbb.$("body").find(".gbbSummaryPageCreateNewBoxButton").removeClass("gbbDisabled")
            })

            const gbbUnavailableProductsModalFooterCheckoutBtn = gbb.$("<div>").addClass("gbbUnavailableProductsModalFooterCheckoutBtn");
            gbbUnavailableProductsModalFooterCheckoutBtn.text(checkoutButtonText)
            gbbUnavailableProductsModalFooterCheckoutBtn.css("background", gbb.settings.pageCustomizationData.summaryBlock.summaryBlockAddToCartButtonColor)
            gbbUnavailableProductsModalFooterCheckoutBtn.css("color", gbb.settings.pageCustomizationData.summaryBlock.summaryBlockAddToCartButtonTextColor)
            gbbUnavailableProductsModalFooterCheckoutBtn.on("click", async (event) => {
                event.preventDefault();
                event.stopPropagation();
                gbbUnavailableProductsModalFooterBackBtn.addClass("gbbDisabled")
                gbbUnavailableProductsModalFooterCheckoutBtn.addClass("gbbDisabled")
                gbbUnavailableProductsModalFooterCheckoutBtn.text(gbb.settings.languageData.general?.loadingCheckoutButtonText?.value || "Loading ...1")
                await gbb.utility.applyDiscountOnCheckout();
                gbb.gbbBrowser.clearCartDataFromSessionStorage();
                setTimeout(() => {
                    gbb.$("body").find(".gbbUnavailableProductsMainContainer").remove()
                }, 5000)
                await gbb.utility.loadCheckoutPage();
            })

            gbbUnavailableProductsModalFooter.append(gbbUnavailableProductsModalFooterBackBtn);
            gbbUnavailableProductsModalFooter.append(gbbUnavailableProductsModalFooterCheckoutBtn);

            const gbbUnavailableProductsModalDiscountsMayNotApplyText = gbb.$("<div>").addClass("gbbUnavailableProductsModalDiscountsMayNotApplyText");
            gbbUnavailableProductsModalDiscountsMayNotApplyText.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.discountsMayNotApplyText) || "discounts may not be applied")

            gbbUnavailableProductsContainerModal.append(gbbCartProductsContainerHeader);
            gbbUnavailableProductsContainerModal.append(gbbCartProductsContainerBody);
            gbbUnavailableProductsContainerModal.append(gbbUnavailableProductsModalFooter);
            gbbUnavailableProductsContainerModal.append(gbbUnavailableProductsModalDiscountsMayNotApplyText);


            gbbUnavailableProductsMainContainer.append(gbbUnavailableProductsContainerModal);
            gbb.$("body").append(gbbUnavailableProductsMainContainer);
            gbb.f.applyFontToUnavailableProductsPopup();
        },

        handleBackButtonReload : function () {
            try {
                window.addEventListener("pageshow", function (event) {
                    var historyTraversal = event.persisted ||
                        (typeof window.performance != "undefined" &&
                            window.performance.navigation.type === 2);
                    if (historyTraversal) {
                        // Handle page restore.
                        //or just move the user to the first page of the app
                        // alert("historyTraversal")
                        //   gbb.gbbBrowser.redirectToFirstProductPage();
                        window.location.reload();
                    }
                });
            } catch (err) {
                gbb.utility.debugConsole("error inside handleBackButtonReload", err);
            }
        },

        renderActivatePricingPopup: function () {
            try {
                const gbbActivatePricingMainContainer = gbb.$("<div>").addClass("gbbActivatePricingMainContainer");
                const gbbActivatePricingContainerModal = gbb.$("<div>").addClass("gbbActivatePricingContainerModal");

                const gbbActivatePricingHeader = gbb.$("<div>").addClass("gbbActivatePricingHeader");
                const headerHtml = "<span>Oops! Seems like the bundle plan <br/> isn't setup correctly!</span>";
                gbbActivatePricingHeader.html(headerHtml);

                const gbbActivatePricingDescription = gbb.$("<div>").addClass("gbbActivatePricingDescription");
                const descriptionHtml = "<span>Please contact the merchant to complete <br/> your bundle purchase.</span>";
                gbbActivatePricingDescription.html(descriptionHtml);

                const gbbActivatePricingImgContainer = gbb.$("<div>").addClass("gbbActivatePricingImgContainer");
                const gbbActivatePricingImg = gbb.$("<img>").addClass("gbbActivatePricingImg").attr("src", "https://gift-box-builder-app4.s3.us-east-2.amazonaws.com/public/icons/activate_pricing_popup_image.png");

                const gbbActivatePricingButtonContainer = gbb.$("<div>").addClass("gbbActivatePricingButtonContainer");
                const gbbActivatePricingButton = gbb.$("<button>").addClass("gbbActivatePricingButton");
                gbbActivatePricingButton.text('Complete the setup');
                gbbActivatePricingButtonContainer.append(gbbActivatePricingButton);

                gbbActivatePricingButton.on("click", async () => {
                    window.open(`https://${gbb?.settings?.merchantInfo?.shopName}/admin/apps/10b4272bede142b02924feec498b4009/pricing`, "_blank");
                })

                const gbbActivatePricingPoweredByContainer = gbb.$("<div>").addClass("gbbActivatePricingPoweredByContainer");
                const poweredByLabelHtml = "<span>✨Powered by <b>EasyBundles</b>✨</span>";
                gbbActivatePricingPoweredByContainer.html(poweredByLabelHtml);

                const gbbActivatePricingNoteContainer = gbb.$("<div>").addClass("gbbActivatePricingNoteContainer");
                const noteLabelHtml = "<span>NOTE: Once the pricing is activated, refresh this page.</span>";
                gbbActivatePricingNoteContainer.html(noteLabelHtml);

                gbbActivatePricingImgContainer.append(gbbActivatePricingImg);
                gbbActivatePricingContainerModal.append(gbbActivatePricingImgContainer);
                gbbActivatePricingContainerModal.append(gbbActivatePricingHeader);
                gbbActivatePricingContainerModal.append(gbbActivatePricingDescription);
                gbbActivatePricingContainerModal.append(gbbActivatePricingButtonContainer);
                gbbActivatePricingContainerModal.append(gbbActivatePricingNoteContainer);
                gbbActivatePricingContainerModal.append(gbbActivatePricingPoweredByContainer);
                gbbActivatePricingMainContainer.append(gbbActivatePricingContainerModal);
                gbb.$("body").append(gbbActivatePricingMainContainer);

            } catch (err) {
                gbb.utility.debugConsole("error inside renderActivatePricingPopup", err);
            }
        },

        handleCheckoutClick: async function () {
            try {
                // if(gbb.utility.checkIfBrandingShouldBeVisible('checkout')) {
                //     gbb.utility.renderActivatePricingPopup();
                //     return;
                // }
                gbb.gbbBrowser.emitCustomEvent({
                    eventName: "gbb-checkout-initiated",
                })
                gbb.utility.handleBackButtonReload();

                await gbb.utility.removeZeroPriceBoxes();
                let cartData = gbb.gbbBrowser.getCartDataFromSessionStorage();
                if (!cartData || Object.keys(cartData?.boxes)?.length == 0) {
                    await gbb.utility.loadCheckoutPage();
                    return;
                }
                let isGiftMessageVirtualProduct = gbb.settings.bundleSettings?.isGiftMessageVirtualProduct || false;
                if (isGiftMessageVirtualProduct) {
                    // giftMessageNotAsProduct
                    // remove giftMessageProduct from cartData, and create a new array for it
                    // save this new cartData in session storage
                    // save new array with giftMessage in state
                    gbb.gbbPersonalizePage.f.removeGiftMessageFromSessionStorage(cartData);
                }

                gbb.utility.renderPreparingBundleModal();

                let addGiftMessageToNote = gbb.settings.app.addGiftMessageToNote;

                setTimeout(() => {
                    gbb.$("body").find(".gbbPreparingBundleMainContainer").remove()
                }, 6000)
                let addToCartResult = await gbb.gbbBrowser.addItemsToCart();


                if (addGiftMessageToNote) {
                    let getUpdatedCart = await gbb.shopifyUtility.getCart();
                    let messageToAppend = gbb.utility.extractGiftMessageFromCartItems(getUpdatedCart);
                    await gbb.shopifyUtility.updateCart({ note: messageToAppend })
                }

                
                // setTimeout(() => {
                //     // gbb.utility.renderPreparingBundleModal();
                //     gbb.$("body").find(".gbbPreparingBundleMainContainer").remove()
                // }, 1000)


                if (addToCartResult.data) {
                    await gbb.utility.applyDiscountOnCheckout();
                    gbb.gbbBrowser.clearCartDataFromSessionStorage();
                    setTimeout(() => {
                    // gbb.utility.renderPreparingBundleModal();
                        gbb.$("body").find(".gbbPreparingBundleMainContainer").remove()
                    }, 1000)
                    await gbb.utility.loadCheckoutPage();
                    gbb.gbbBrowser.emitCustomEvent({
                        eventName: "gbb-checkout-success",
                    })
                } else if (!addToCartResult.data && addToCartResult?.failedProductsArr?.length > 0) {
                    //failedProductsArr
                    gbb.utility.renderTemporaryLoadingSpinner("hide")
                    gbb.$("body").find(".gbbPreparingBundleMainContainer").remove()
                    await gbb.utility.renderUnavaibleProductsModal(addToCartResult.failedProductsArr);
                    gbb.gbbBrowser.emitCustomEvent({
                        eventName: "gbb-checkout-failed",
                        detail: {
                            failedProducts: addToCartResult.failedProductsArr
                        }
                    })
                }
                // else {
                //     await gbb.utility.loadCheckoutPage();
                // }

                

            } catch (err) {
                gbb.utility.debugConsole("error inside handleCheckoutClick:", err);
            }
        },

        applyDiscountOnCheckout: async function () {
            try {
                let cartData = gbb.gbbBrowser.getCartDataFromSessionStorage();
                if (gbb.gbbDiscountComponent.state.isAtleastOneDiscountActive) {
                    await gbb.utility.getDynamicDiscountCode()
                    // await gbb.utility.updateCart({ attributes: { ["gbbDiscountCode"]: gbb.gbbDiscountComponent.state.discountCode} });
                }
                cartData.attributes = {
                    ...cartData.attributes,
                    // "gbbDiscountCode": gbb.gbbDiscountComponent.state.isAtleastOneDiscountActive.discountCode
                    // "gbbDiscountCode":  gbb.gbbDiscountComponent.state.discountCode
                }

                cartData.attributes[`gbbDiscountCode-${gbb.state.bundleName}`] = gbb.gbbDiscountComponent.state.discountCode

                // updateCartAttributes
                if (cartData.attributes) {
                    await gbb.shopifyUtility.updateCart({ attributes: cartData.attributes });
                    gbb.gbbBrowser.emitCustomEvent({
                        eventName: "gbb-bundle-discount-applied",
                    })
                }
            } catch (err) {
                gbb.utility.debugConsole("err inside applyDiscountOnCheckout:", err);
            }
        },
        extractGiftMessageFromCartItems: function (updatedCart) {
            try {
                let cartItems = updatedCart.items;
                // gbb.utility.debugConsole("cartItems", cartItems)
                let messagesPresentInCart = [];
                let messageToAppend = "";
                let isGiftMessageVirtualProduct = gbb.settings.bundleSettings?.isGiftMessageVirtualProduct || false;
                // decision on giftMessageAsProduct
                if (!isGiftMessageVirtualProduct) {
                    for (let i = 0; i < cartItems.length; i++) {
                        let item = cartItems[i];
                        // go deep and check if there are properties to the product
                        // if there is a property, then check if it has a gift message
                        // properties.Message
                        if (item.properties && item.properties.Message) {
                            messagesPresentInCart.push({ "Box ID": item.properties["Box ID"], "Message": item.properties.Message, "To": item.properties["Recipient Name"], "From": item.properties["Sender Name"] })
                        }
                    }

                }

                if (isGiftMessageVirtualProduct) {

                    let items = gbb.state.giftMessageProductInActiveSession || [];
                    if (items) {
                        messagesPresentInCart = items;
                    }

                    // from notes
                    let existingCartNotes = updatedCart?.note || "";
                    messageToAppend += existingCartNotes;
                }

                //sort the messagesPresentInCart by Box ID
                messagesPresentInCart = messagesPresentInCart.sort((a, b) => {
                    return a["Box ID"] - b["Box ID"]
                })
                //now append the message with a ":" separator in between

                if (messageToAppend != "" && messagesPresentInCart.length > 0) {
                    messageToAppend += "|| "
                }

                for (let i = 0; i < messagesPresentInCart.length; i++) {
                    let item = messagesPresentInCart[i];
                    // messageToAppend += `${item["Box ID"]}: ${item.Message} | `

                    if (isGiftMessageVirtualProduct) { // condition for gift message not as product
                        // has a bug, which says same box ID
                        // if(item['Box ID']){
                        //     messageToAppend += `Box Id: ${item["Box ID"]}\n`
                        // }
                        if (item["Bundle Name"]) {
                            messageToAppend += `Bundle Name: ${item["Bundle Name"]}\n`
                        }
                    }

                    if (item.To) {
                        messageToAppend += `To ${item.To},\n`
                    }

                    messageToAppend += `${item.Message}.`

                    if (item.From) {
                        messageToAppend += `\nFrom ${item.From}.`
                    }


                    if (i != messagesPresentInCart.length - 1 && messagesPresentInCart.length > 1) {
                        messageToAppend += `|| `
                    }

                }

                return messageToAppend;
            } catch (err) {
                gbb.utility.debugConsole("error inside extractGiftMessageFromCartItems", err);
            }
        },
        isElementVisible: function (element) {
            try {
                const vanillaJsElement = gbb.$(element)[0];
                if (!vanillaJsElement) {
                    return false;
                }
                const rect = vanillaJsElement.getBoundingClientRect();
                // gbb.utility.debugConsole("isElementVisible rect", rect)
                const viewHeight = Math.max(document.documentElement.clientHeight, window.innerHeight);
                // gbb.utility.debugConsole("isElementVisible viewheight",viewHeight)
                return !(rect.bottom < 0 || rect.top - viewHeight >= 0);
            } catch (err) {
                gbb.utility.debugConsole("error inside isElementVisible", err);
            }
        },
        removeFirstCharacterIfUnderscore: function (str) {
            try {
                if (str.charAt(0) === '_') {
                    str = str.slice(1);
                }
                return str;
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        returnOnlyAdminSelectedVariantOptions: function (product) {
            try {
                let result = [];
                const validValues = new Set();
                for (const variant of product?.variants) {
                    if (variant?.option1) {
                        validValues.add(variant.option1);
                    }
                    if (variant?.option2) {
                        validValues.add(variant.option2);
                    }
                    if (variant?.option3) {
                        validValues.add(variant.option3);
                    }
                }
                gbb.utility.debugConsole("validValues:", validValues);
                for (let i = 0; i < product?.options?.length; i++) {
                    let option = product?.options[i];
                    if (option) {
                        gbb.utility.debugConsole("option:", option);
                        const invalidValues = [];
                        for (let j = 0; j < option?.values?.length; j++) {
                            let value = option?.values[j] || "";
                            if (value && !validValues.has(value)) {
                                invalidValues.push(value);
                            }
                            gbb.utility.debugConsole("invalid values:", invalidValues)
                        }
                        product.options[i].values = product?.options[i]?.values?.filter((value) => !invalidValues.includes(value));
                    }
                }
                result = product.options;
                return result;
            } catch (err) {
                gbb.utility.debugConsole(err)
            }
        },
        convertFromStoreCurrencyToCustomer: function (amount) {
            try {
                let activeCurrencyRate = gbb.utility.getActiveCurrencyRate();
                let convertedAmount = parseFloat(amount * activeCurrencyRate).toFixed(2);
                return convertedAmount;
            } catch (err) {
                gbb.utility.debugConsole(err)
            }
        },
        convertFromCustomerCurrencyToStore: function (amount) {
            try {
                let activeCurrencyRate = gbb.utility.getActiveCurrencyRate();
                let convertedAmount = parseFloat(amount / activeCurrencyRate).toFixed(2);
                return convertedAmount;
            } catch (err) {
                gbb.utility.debugConsole(err)
            }
        },
        removeZeroPriceBoxes: async function () {
            try {
                let cartData = gbb.gbbBrowser.getCartDataFromSessionStorage();
                for (const boxId in cartData.boxes) {
                    const box = cartData.boxes[boxId];
                    if (box.total_price == 0) {
                        await gbb.gbbBrowser.clearRelevantBoxFromSessionStorage(boxId);
                    }
                }
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        removeIframeTagsFromHtml: function (html) {
            try {
                let parser = new DOMParser();
                let doc = parser?.parseFromString(html, 'text/html');
                let iframeElements = doc?.getElementsByTagName('iframe');
                if (!iframeElements || iframeElements.length === 0) {
                    return html; // No <video> tags found, return the original HTML
                }
                for (let i = iframeElements.length - 1; i >= 0; i--) {
                    let iframeElement = iframeElements[i];
                    iframeElement.parentNode.removeChild(iframeElement);
                }
                let modifiedHtml = new XMLSerializer().serializeToString(doc);
                return modifiedHtml;
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        adjustImageTagsInProductDescriptionHtml: function (html) {
            try {
                const parser = new DOMParser();
                const doc = parser?.parseFromString(html, 'text/html');

                const imgElements = doc?.getElementsByTagName('img');
                if (!imgElements || imgElements.length === 0) {
                    return html; // No <img> tags found, return the original HTML
                }

                for (let i = 0; i < imgElements.length; i++) {
                    const imgElement = imgElements[i];
                    imgElement.setAttribute('width', '100px');
                    imgElement.setAttribute('height', '100px');
                    imgElement.style.objectFit = 'contain';
                }

                const modifiedHtml = new XMLSerializer().serializeToString(doc);
                return modifiedHtml;
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        getNewImageAndMediaObjectWhenOnlyOneVariant: function (product) {
            // return an object know as newFeaturedImage, newMedia,newImages
            try {
                //setting defaults
                let newFeaturedImage = product?.featured_image;
                let newMedia = product.media
                let newImages = product?.images;
                let theresAnImageOrMediaToVariant = product.variants[0]?.image || product.variants[0]?.featured_media?.id || product.variants[0]?.featured_media?.src ? true : false;
                if (product?.variants?.length === 1 && theresAnImageOrMediaToVariant) {
                    //reset the featured image to this variant's featured image
                    newFeaturedImage = product?.variants[0]?.image || product.variants[0]?.featured_image?.src;
                    // change the order of the media but mapping the src to the variant's featured image
                    let indexofNewImage = product?.media.findIndex((media) => media?.src === newFeaturedImage);
                    if (indexofNewImage > -1) {
                        // shuffle the array, so that the ovject with the new featured image is at the front of the array]
                        newMedia = product?.media;
                        let newMediaObject = newMedia.splice(indexofNewImage, 1)[0];
                        newMedia.unshift(newMediaObject);
                    }

                    // change the order of the images but mapping the src to the variant's featured image
                    indexOfImageInImagesArr = product?.images.findIndex((image) => newFeaturedImage.includes(image));
                    if (indexOfImageInImagesArr > -1) {
                        newImages = product?.images;
                        // newImages[indexOfImageInImagesArr] = product?.variants[0]?.image;
                        // unshift the new featured image to the front of the array
                        newImages.unshift(newFeaturedImage);
                    }
                }
                return {
                    newFeaturedImage,
                    newMedia,
                    newImages
                }

            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        isCategoryOpen: function (categoryId) {
            try {
                // Get the parent element
                const parentElement = gbb.$(".gbbCategoryBodyContainer" + categoryId);

                // Check if it exists and has children
                if (parentElement.length > 0) {
                    // Check if gbbProductsContainer is one of the children
                    const gbbProductsItemsContainer = parentElement.find(".gbbProductsItemsContainer");

                    if (gbbProductsItemsContainer.length > 0) {
                        // gbbProductsContainer is not empty
                        gbb.utility.debugConsole("category is open")
                        return true;
                    } else {
                        // gbbProductsContainer is empty
                        gbb.utility.debugConsole("category is not open")
                        return false;
                    }
                } else {
                    // The parent element doesn't exist or has no children
                    gbb.utility.debugConsole("couldnt find category")
                    return false;
                }
            } catch (err) {
                gbb.utility.debugConsole(err, "error in isCategoryOpen");
            }
        },
        convertToGrams: function (weight, weightUnit) {
            try {
                let weightInGrams = 0;
                let weightValue = JSON.parse(JSON.stringify(weight))
                switch (weightUnit) {
                    case "kg":
                    case "KILOGRAMS":
                        weightInGrams = weightValue * 1000;
                        break;
                    case "g":
                    case "GRAMS":
                        weightInGrams = weightValue;
                        break;
                    case "lb":
                    case "POUNDS":
                        weightInGrams = weightValue * 453.592;
                        //round it off
                        weightInGrams = Math.round(weightInGrams);
                        break;
                    case "oz":
                    case "OUNCES":
                        weightInGrams = weightValue * 28.3495;
                        //round it off
                        weightInGrams = Math.round(weightInGrams);
                        break;
                    default:
                        weightInGrams = weightValue;
                        break;
                }
                return weightInGrams;
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        getCurrentProductPersonalization: function (product) {
            try {
                let isProductPersonalizationEnabled = gbb?.gbbAddProductsPage?.state?.productPersonalizationMap && gbb.gbbAddProductsPage.state.productPersonalizationMap[product.id] ? true : false;
                // gbb.gbbAddProductsPage.state.productPersonalizationData
                let productPersonalizationData = gbb?.gbbAddProductsPage?.state?.productPersonalizationMap && gbb.gbbAddProductsPage.state.productPersonalizationMap[product.id] ? gbb.gbbAddProductsPage.state.productPersonalizationMap[product.id] : {};
                return {
                    isProductPersonalizationEnabled,
                    productPersonalizationData
                }
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        getRegionalLocaleFromUrl: function () {
            let localePresentInUrl = window.location.pathname.split("/") || "";
            // now get locale from Shopify.locale   
            let currentShopifyLocale = Shopify.locale || "";

            let regionalLocale = "";

            if (currentShopifyLocale && currentShopifyLocale != "" && localePresentInUrl) {
                // check if both are same
                if (currentShopifyLocale == localePresentInUrl[1]) {
                    regionalLocale = `/${currentShopifyLocale}`
                } else {
                }
            }

            return regionalLocale;
        },
        debugConsole: function (...messages) {
            try {
                let flag = gbb.state.CONSTANT_DEBUG_FLAG;
                if (flag == false) {
                    return;
                }
                if (flag == true) {
                    for (let message of messages) {
                        console.log(message);
                    }
                    return;
                }
                let isDebug = localStorage.getItem("debug");
                if (isDebug) {
                    for (let message of messages) {
                        console.log(message);
                    }
                    gbb.state.CONSTANT_DEBUG_FLAG = true
                } else {
                    gbb.state.CONSTANT_DEBUG_FLAG = false
                }
            } catch (err) {
                console.error('error inside debugConsole ->', err)
            }
        },
        debugError: function (...messages) {
            try {
                let flag = gbb.state.CONSTANT_DEBUG_FLAG;
                if (flag == false) {
                    return;
                }
                if (flag == true) {
                    for (let message of messages) {
                        console.error(message);
                    }
                    return;
                }
                let isDebug = localStorage.getItem("debug");
                if (isDebug) {
                    gbb.state.CONSTANT_DEBUG_FLAG = true;
                    for (let message of messages) {
                        console.error(message);
                    }
                } else {
                    gbb.state.CONSTANT_DEBUG_FLAG = false
                }
            } catch (err) {
                console.error('error inside the debugError function ->', err)
            }
        },
        gbbMultiLangOverrider: function () {
            try {
                let languageMode = gbb.state.languageMode;
                let languageData = gbb.utility.getLocale();
                if (languageMode != "SINGLE") {

                    gbb.utility.gbbMultiLangDiscountOverrider(languageData)
                    gbb.utility.gbbMultiLangBundleDataOverriding(languageData)
                    gbb.utility.gbbMultiLangPersonalizationOverrider(languageData)
                    gbb.utility.gbbMultiLangSummaryPageOverrider(languageData);
                }
            } catch (error) {
                gbb.utility.debugError("error in gbbMultiLangOverrider", error)
            }
        },
        gbbMultiLangDiscountOverrider: function (languageData) {
            try {
                if (gbb.settings.discountsData != {}) {
                    let discountsData = gbb.settings.discountsData;
                    if (discountsData.multiLangData.hasOwnProperty(languageData)) {
                        discountsData.discountTextBody = discountsData.multiLangData[languageData].discountTextBody;
                        discountsData.discountTextForSuccess = discountsData.multiLangData[languageData].discountTextForSuccess || "";
                    }
                }
            } catch (error) {
                gbb.utility.debugError("error in gbbMultiLangDiscountOverrider", error);
            }
        },
        gbbMultiLangBundleDataOverriding: function (languageData) {
            try {
                let stepsConfigurationData = gbb.settings.stepsConfigurationData;
                for (const key in stepsConfigurationData) {
                    if (key.startsWith("productsData")) {
                        const productData = stepsConfigurationData[key];
                        if (productData && productData.multiLangData && productData?.multiLangData.hasOwnProperty(languageData)) {
                            productData.productPageStepText = productData.multiLangData[languageData].productPageStepText;
                            productData.productPageSubtext = productData.multiLangData[languageData].productPageSubtext;
                        }
                        // Iterate over categories and update titles
                        if (productData && productData.categories) {
                            for (const categoryKey in productData.categories) {
                                const category = productData.categories[categoryKey];
                                if (category.multiLangData && category.multiLangData.hasOwnProperty(languageData)) {
                                    category.title = category.multiLangData[languageData].categoryTitle;
                                    category.subTitle = category.multiLangData[languageData].categorySubtitle;
                                }
                            }
                        }
                    }
                }

            } catch (error) {
                gbb.utility.debugError("error in gbbMultiLangBundleDataOverriding", error);
            }
        },
        gbbMultiLangPersonalizationOverrider: function (languageData) {
            try {
                let personalizationData = gbb.settings.stepsConfigurationData.personalizationData;
                //stepsConfigurationData?.personalizationData?.personalizeStepText
                if (personalizationData && personalizationData.isPersonalizationEnabled && personalizationData.multiLangData && personalizationData?.multiLangData.hasOwnProperty(languageData) || false) {
                    personalizationData.personalizeStepText = personalizationData.multiLangData[languageData].personalizeStepText;
                    personalizationData.personalizePageSubtext = personalizationData.multiLangData[languageData].personalizePageSubtext;
                }

            } catch (error) {
                gbb.utility.debugError("error in gbbMultiLangPersonalizationOverrider", error);
            }
        },
        gbbMultiLangSummaryPageOverrider: function (languageData) {
            try {
                let summaryPageData = gbb.settings.stepsConfigurationData.summaryPageData;
                // gbb.settings?.stepsConfigurationData?.summaryPageData
                //stepsConfigurationData?.summaryPageData?.personalizeStepText
                if (summaryPageData && summaryPageData.isSummaryPageEnabled && summaryPageData.multiLangData && summaryPageData?.multiLangData.hasOwnProperty(languageData) || false) {
                    // reviewPageBannerSubtext
                    // : 
                    // "Review your bundle and proceed to checkout ar"
                    // reviewPageBannerText
                    // : 
                    // "You’ve made the  Right Choice! ar"
                    // reviewPageEmptyStateBannerButtonText
                    // : 
                    // "Go back to the bundle flow"
                    // reviewPageEmptyStateBannerSubText
                    // : 
                    // ""
                    // reviewPageEmptyStateBannerText

                    summaryPageData.reviewPageBannerSubtext = summaryPageData.multiLangData[languageData].reviewPageBannerSubtext;
                    summaryPageData.reviewPageBannerText = summaryPageData.multiLangData[languageData].reviewPageBannerText;
                    summaryPageData.reviewPageEmptyStateBannerButtonText = summaryPageData.multiLangData[languageData].reviewPageEmptyStateBannerButtonText;
                    summaryPageData.reviewPageEmptyStateBannerSubText = summaryPageData.multiLangData[languageData].reviewPageEmptyStateBannerSubText;
                    summaryPageData.reviewPageEmptyStateBannerText = summaryPageData.multiLangData[languageData].reviewPageEmptyStateBannerText;



                }

            } catch (error) {
                gbb.utility.debugError("error in gbbMultiLangPersonalizationOverrider", error);
            }
        },
        groupCartDataBasedOnId_and_Properties: function (items) {
            try {
                function consolidateProducts(products) {
                    const consolidated = [];

                    // Function to check if two properties objects are the same
                    function arePropertiesEqual(props1, props2) {
                        const keys1 = Object.keys(props1);
                        const keys2 = Object.keys(props2);
                        if (keys1.length !== keys2.length) return false;
                        return keys1.every(key => props1[key] === props2[key]);
                    }

                    // Iterate through each product in the input array
                    products.forEach(product => {
                        // Find an existing product in the consolidated array that matches the current product
                        // const existingProduct = consolidated.find(consProduct =>
                        //     consProduct.id === product.id && arePropertiesEqual(consProduct.properties, product.properties)
                        // );

                        // check if products have properties
                        let existingProduct;
                        if (product.properties && Object.keys(product.properties).length > 0) {
                            existingProduct = consolidated.find(consProduct =>
                                consProduct.id === product.id && arePropertiesEqual(consProduct.properties, product.properties));
                        } else {
                            existingProduct = consolidated.find(consProduct => consProduct.id === product.id);
                        }






                        if (existingProduct) {
                            // If found, add the quantity of the current product to the existing one
                            existingProduct.quantity += product.quantity || 1;
                        } else {
                            // If not found, add the current product to the consolidated array
                            consolidated.push({ ...product });
                        }
                    });

                    return consolidated;
                }

                // Example usage
                const products = JSON.parse(JSON.stringify(items));
                const result = consolidateProducts(products);
                // return 
                // console.log(consolidatedProducts);
                return result;
            } catch (e) {
                gbb.utility.debugConsole("error occured in groupCartDataBasedOnId_and_Properties", e)
                return items;
            }

        },
        debounceWrapper: function (callbackFn, delay = 500) {
            gbb.utility.debugConsole('INSIDE DEBOUNCE WRAPPER');
            let timeoutId;
            let lastResult;

            return function (...args) {
                if (timeoutId) {
                    clearTimeout(timeoutId);
                }

                return new Promise((resolve, reject) => {
                    timeoutId = setTimeout(() => {
                        try {
                            lastResult = callbackFn.apply(this, args);
                            resolve(lastResult);
                        } catch (error) {
                            reject(error);
                        }
                    }, delay);
                });
            }
        },
        allowATCBasedOnProductInventory: function (variantId, quantityToAdd = 1) {
            try {
                let qtyAlreadyInCart = 0;
                let cartData = gbb.state?.giftBoxCartData?.items || []
                let isATCAllowed = true
                let originForVariantDetails = gbb.state.currentPageId == 'personalizationPage' ? "addonProducts": null
                let variantDetails = gbb.utility.getVariantDetailsFromCurrentProductsDataSet(variantId, originForVariantDetails) || null
                if (!variantDetails) {
                    gbb.utility.debugConsole("variant details not found : allowATCBasedOnProductInventory")
                    isATCAllowed = false
                    return isATCAllowed;
                }
                if (variantDetails.currentlyNotInStock) { // digital product
                    isATCAllowed = true
                    return isATCAllowed
                }
                // check if variant present alreadyInCart
                if (cartData.length > 0) {
                    for (let i = 0; i < cartData.length; i++) {
                        if (cartData[i].id == variantId) {
                            qtyAlreadyInCart += cartData[i].quantity;
                        }
                    }
                }
                let totalQty = qtyAlreadyInCart + quantityToAdd;
                if (totalQty > variantDetails.quantityAvailable) {
                    isATCAllowed = false
                    return isATCAllowed
                }

                return isATCAllowed

            } catch (error) {
                gbb.utility.debugConsole("error in allowATCBasedOnProductInventory", error)
            }
        },
        isCurrentActiveVariantAllowedToAdd: function ({ product, selectedVariantsCombination, variantQuantity }) {
            try {
                let activeVariantInfo = gbb.utility.checkIfSelectedVariantCombinationIsAvailable(product, selectedVariantsCombination);
                let variantId = activeVariantInfo[0]?.id;
                let isInventoryAvailable = gbb.utility.allowATCBasedOnProductInventory(variantId, variantQuantity);
                return isInventoryAvailable
            } catch (error) {
                gbb.utility.debugConsole("error in isCurrentActiveVariantAllowedToAdd", error)
            }
        },
        validateProductQuantityAddButton: function ({ product, selectedVariantsCombination, variantQuantity, gbbProductQuantityAddButton }) {
            try {
                let isInventoryAvailable = gbb.utility.isCurrentActiveVariantAllowedToAdd({ product, selectedVariantsCombination, variantQuantity });
                if (isInventoryAvailable != true) {
                    gbbProductQuantityAddButton.addClass("gbbVariantInventoryNotAvailable")
                    gbbProductQuantityAddButton.addClass("gbbDisabled")
                } else if (
                    isInventoryAvailable == true &&
                    gbbProductQuantityAddButton.hasClass("gbbVariantInventoryNotAvailable")
                ) {
                    gbbProductQuantityAddButton.removeClass("gbbVariantInventoryNotAvailable")
                    gbbProductQuantityAddButton.removeClass("gbbDisabled")
                }
            } catch (error) {
                gbb.utility.debugConsole("error in validateProductQuantityAddButton", error)
            }
        },
        validateATCAndVariantQuantityAddButton: function ({ product, selectedVariantsCombination, variantQuantity, gbbProductQuantityAddButton, gbbProductVariantModalContainer }) {
            try {
                let validationOptions = {
                    product: product,
                    selectedVariantsCombination: selectedVariantsCombination,
                    variantQuantity: variantQuantity + gbb.gbbAddProductsPage.state.incrementProductQtyBy || 1,// adding 1 to check if we can add 1 more product or not 
                    gbbProductQuantityAddButton: gbbProductQuantityAddButton
                }
                gbb.utility.validateProductQuantityAddButton(validationOptions);
                let currentQty = variantQuantity;
                let isVariantWithCurrentQtyAllowedToAdd = gbb.utility.isCurrentActiveVariantAllowedToAdd({ ...validationOptions, variantQuantity: currentQty })
                if (isVariantWithCurrentQtyAllowedToAdd != true) {
                    gbbProductVariantModalContainer.addClass("gbbVariantInventoryNotAvailable")
                } else {
                    gbbProductVariantModalContainer.removeClass("gbbVariantInventoryNotAvailable")
                }
            } catch (error) {
                gbb.utility.debugConsole("error in validateATCAndVariantQuantityAddButton", error)
            }
        },
        extractIdsFromGraphQlId: function (id) {
            try {
                return Number(id.split("/").pop())
            } catch (error) {
                gbb.utility.debugConsole("error in extractIdsFromGraphQlId", error)
            }
        },
        generateSellingPlanGroupIdByName: function (groupName) {
            try {
                let base64Str = btoa(encodeURIComponent(groupName));
                return "EB_" + base64Str;
            } catch (error) {
                gbb.utility.debugConsole('error in generateSellingPlanGroupIdByName', error)
            }
        },
        prepareProductCardRibbonUI: function ({ ribbonContent, ribbonClassName }) {
            try {
                const gbbDiscountRibbon = gbb.$('<div>').addClass('gbbDiscountRibbon')
                if (ribbonClassName) {
                    gbbDiscountRibbon.addClass(ribbonClassName)
                }
                const gbbDiscountRibbonContent = gbb.$('<div>').addClass('gbbDiscountRibbonContent')
                if (ribbonContent) {
                    gbbDiscountRibbonContent.text(ribbonContent)
                    gbbDiscountRibbon.append(gbbDiscountRibbonContent)
                    return gbbDiscountRibbon
                }
            } catch (error) {
                gbb.utility.debugError('error in prepareProductCardRibbonUI', error)
            }
        }
    },
    shopifyUtility: {
        addToCart: async function (cartData) {
            try {
                let result = await gbb.$.ajax({
                    url: "/cart/add.js",
                    data: cartData,
                    type: "POST",
                    dataType: "json",
                })
                return result;
            } catch (error) {
                gbb.utility.debugConsole("error in shopifyUtility.addToCart", error)
                // throw error
                return false
            }
        },
        updateCart: async function (cartData) {
            try {
                let result = await gbb.$.ajax({
                    url: "/cart/update.js",
                    data: cartData,
                    type: "POST",
                    dataType: "json",
                })
                return result;
            } catch (error) {
                gbb.utility.debugConsole("error in shopifyUtility.updateCart", error)
                // throw error
                return false
            }
        },
        getCart: async function () {
            try {
                let result = await gbb.$.ajax({
                    url: "/cart.js",
                    type: "GET",
                    dataType: "json",
                })
                return result;
            } catch (error) {
                gbb.utility.debugConsole("error in shopifyUtility.getCart", error)
                // throw error
                return false
            }
        },
        changeCart: async function (data) {
            try {
                let result = await glpro.$.ajax({
                    type: "POST",
                    url: "/cart/change.js",
                    data: data,
                    dataType: "json",
                });
                return true
            } catch (error) {
                gbb.utility.debugError("glpro-utility-changeCart");
                gbb.utility.debugError(error);
                return false
            }
        },
    },
    graphQlUtility: {
        graphQlAPIWrapper: async function (query, variables) {
            try {
                let shopDomain = window.Shopify.shop;
                let storefrontAccessToken = gbb.state.storefrontAccessToken || gbb.settings.STOREFRONT_ACCESS_TOKEN;

                // debugger;
                // if (gbb.state.cachedProductDataGraphql.has(variables.ids[0])){
                //     return gbb.state.cachedProductDataGraphql.get(variables.ids[0]);
                // }

                const res = await fetch(`https://${shopDomain}/api/2023-10/graphql.json`, {
                    // const res = await fetch(`https://gift-kart-test-01.myshopify.com/api/2024-01/graphql.json`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Shopify-Storefront-Access-Token': storefrontAccessToken,
                    },
                    body: JSON.stringify({ query, variables }),
                })



                const data = await res.json();
                return data;

            } catch (error) {
                gbb.utility.debugConsole("error in graphQlAPIWrapper =>", error);
            }
        },
        gbbCleaningAndArrangingData: function (data) {
            try {
                let cleanedData = gbb.graphQlUtility.flattenGraphQLResponse(data);
                gbb.utility.debugConsole("cleanedData before processing =========>:", cleanedData);

                // remove null, undefined and missing values from the array
                cleanedData = cleanedData.filter(item => item != null && item != undefined);

                cleanedData = gbb.graphQlUtility.dataMappingFromGraphQL(cleanedData);

                return cleanedData;
            } catch (err) {
                gbb.utility.debugConsole("err in gbbCleaningAndArrangingData => ", err);
            }
        },
        dataMappingFromGraphQL: function (cleanedData) {
            try {

                const convertPlanNameToId = (planName) => {
                    let base64Str = btoa(encodeURIComponent(planName));
                    let id = "EB_" + base64Str;
                    return id;
                }

                const getAllMetafieldValuesInArray = (productData) => {
                    // productData.forEach(node => {
                    const metafields = [];
                    Object.keys(productData).forEach(key => {
                        if (key.startsWith('metafield_')) {
                            metafields.push(productData[key]);
                        }
                    });
                    return metafields;
                }

                const transformSellingPlans = (sellingPlanGroups) => {

                    let sellingPlanGroupsFlattened = []

                    let tempArray = []
                    let flattendData = gbb.graphQlUtility.flattenGraphQLResponse({ data: { nodes: sellingPlanGroups } });
                    tempArray = flattendData.map(item => {
                        return {
                            id: convertPlanNameToId(item.name),
                            name: item.name,
                            description: null,
                            options: item.options.map((option, index) => ({
                                name: option.name,
                                position: index + 1,
                                value: option.value
                            })),
                            selling_plans: item.sellingPlans?.map((plan) => {
                                return {
                                    id: parseInt(plan?.id?.split('/').pop()),
                                    gid: plan?.id,
                                    option: plan?.option,
                                    name: plan?.name,
                                    price_adjustments: plan?.priceAdjustments?.map((element, index) => {
                                        let adjustmentType = element?.adjustmentValue?.price ? 'price' : element?.adjustmentValue?.adjustmentAmount ? 'fixed_amount' : 'percentage'
                                        let _adjustmentValue = adjustmentType == 'percentage' ? element?.adjustmentValue?.adjustmentPercentage : adjustmentType == 'price' ? element?.adjustmentValue?.price?.amount : element?.adjustmentValue?.adjustmentAmount?.amount
                                        return {
                                            orderCount: element.orderCount,
                                            position: index + 1,
                                            value_type: adjustmentType,
                                            value: adjustmentType == 'percentage' ? parseFloat(_adjustmentValue) : parseFloat(_adjustmentValue) * 100
                                        }
                                    })
                                }
                            }),
                            recurring_deliveries: item.recurringDeliveries,
                        };
                    });

                    sellingPlanGroupsFlattened.push(tempArray);

                    return sellingPlanGroupsFlattened.flat();
                };
                const getSellingPlansGroupId = (sellingPlansGroup, sellingPlanId) => {
                    for (let i = 0; i < sellingPlansGroup?.length; i++) {
                        let currGroupData = sellingPlansGroup[i];
                        let foundSellingPlan = currGroupData?.selling_plans?.find((sellingPlan) => sellingPlan?.id == sellingPlanId);
                        if (foundSellingPlan) {
                            return currGroupData?.id;
                        }
                    }
                }
                const transformSellingPlanAllocation = (sellingPlanAllocations, sellingPlansGroup, variantDetails) => {
                    let response = gbb.graphQlUtility.flattenGraphQLResponse(sellingPlanAllocations);
                    response = response.map((el) => {
                        let sellingPlanId = parseInt(el?.node?.sellingPlan?.id?.split('/').pop())
                        let _price = parseFloat(variantDetails?.price?.amount) * 100 // read product's price 
                        let _per_delivery_price = _price
                        let priceAdjustmentArray = el?.node?.priceAdjustments || []
                        if (priceAdjustmentArray.length > 0) {
                            _price = parseFloat(priceAdjustmentArray[0]?.price?.amount) * 100
                            _per_delivery_price = parseFloat(priceAdjustmentArray[0]?.perDeliveryPrice?.amount) * 100
                        }
                        return {
                            compare_at_price: parseFloat(el?.node?.priceAdjustments[0]?.compareAtPrice?.amount) * 100,
                            per_delivery_price: _per_delivery_price,
                            price: _price,
                            selling_plan_id: sellingPlanId,
                            selling_plan_group_id: getSellingPlansGroupId(sellingPlansGroup, sellingPlanId) || null,
                            price_adjustments: [{ position: 1, price: _price }]
                        }
                    })
                    return response;
                };
                let newProductArray = JSON.parse(JSON.stringify(cleanedData));
                let returningArray = [];
                for (let i = 0; i < newProductArray.length; i++) {

                    let currProduct = newProductArray[i];
                    let originalProduct = cleanedData[i];

                    currProduct.available = originalProduct.availableForSale;
                    currProduct.featured_image = originalProduct?.featuredImage?.originalSrc;
                    let variantData = currProduct.variants;
                    let ogVariants = originalProduct.variants;
                    // productId
                    let splitProductId = originalProduct.id.split('/');
                    let pureProductId = parseInt(splitProductId[splitProductId.length - 1])

                    currProduct.productId = pureProductId;
                    currProduct.type = originalProduct.productType;
                    currProduct.id = pureProductId
                    currProduct.metafieldsData = getAllMetafieldValuesInArray(originalProduct);

                    currProduct.images = originalProduct?.images?.map(item => item?.originalSrc);

                    //   currProduct.media = originalProduct?.media?.map((item, index) moving to images from media coz we dont get variant media from shopify
                    currProduct.media = originalProduct?.images?.map((item, index) => {
                        return {
                            alt: item.alt,
                            computedPosition: index + 1,
                            gid: item.id,
                            id: item.id?.split('/').pop(),
                            // position: index+1, // since shopify SF Api doesnt provide position
                            src: item?.originalSrc
                        }
                    })

                    currProduct.compare_at_price = originalProduct?.compareAtPriceRange?.maxVariantPrice?.amount || originalProduct?.compareAtPriceRange?.minVariantPrice?.amount
                    currProduct.price = originalProduct?.priceRange?.maxVariantPrice?.amount || originalProduct.priceRange.minVariantPrice.amount

                    currProduct.compare_at_price = currProduct.compare_at_price > 0 ? currProduct.compare_at_price * 100 : null
                    currProduct.price = currProduct.price * 100

                    //   forEach originalProduct
                    //   let productSellingPlans = gbb.graphQlUtility.flattenGraphQLResponse(originalProduct.selling)
                    currProduct.selling_plan_groups = transformSellingPlans(originalProduct?.sellingPlanGroups)
                    // for variants
                    for (let j = 0; j < variantData.length; j++) {
                        variantData[j].available = ogVariants[j].availableForSale
                        variantData[j].image = ogVariants[j]?.image?.url || ogVariants[j]?.image?.originalSrc
                        variantData[j].price = parseFloat(variantData[j].price.amount) * 100;
                        let tempOptions = ogVariants[j]?.selectedOptions;
                        variantData[j].options = tempOptions.map(item => item.value);
                        // variantData[j].op
                        // variantData[]    
                        // derive option1,option2 and option3 values

                        if (tempOptions.length > 0) variantData[j].option1 = tempOptions[0].value;
                        if (tempOptions.length > 1) variantData[j].option2 = tempOptions[1].value;
                        if (tempOptions.length > 2) variantData[j].option3 = tempOptions[2].value;
                        // fixing variantId;
                        // variantData[j].id = variantData[j].variantId;
                        let spliVariantId = variantData[j].id.split('/');
                        let variantId = parseInt(spliVariantId[spliVariantId.length - 1])
                        variantData[j].variantId = variantId;
                        variantData[j].variant_id = variantId;
                        variantData[j].id = variantId
                        // variantData[j].public_title = (concat options by /)
                        variantData[j].public_title = tempOptions.map(item => item.value).join(' / ');
                        // publicTitle????
                        // variantData[j].name = currProduct.title +  " - " + ogVariants[j].title;
                        variantData[j].name = ogVariants[j].title == "Default Title" ? currProduct.title : currProduct.title + " - " + ogVariants[j].title;

                        variantData[j].featured_image = {
                            gid: ogVariants[j]?.image?.id,
                            id: ogVariants[j]?.image?.id?.split('/').pop(),
                            src: ogVariants[j]?.image?.originalSrc
                        }
                        variantData[j].featured_media = {
                            gid: ogVariants[j]?.image?.id,
                            id: ogVariants[j]?.image?.id?.split('/').pop(),
                            src: ogVariants[j]?.image?.originalSrc
                        }
                        variantData[j].compare_at_price = ogVariants[j].compareAtPrice ? parseFloat(ogVariants[j].compareAtPrice.amount) * 100 : null

                        variantData[j].weight = gbb.utility.convertToGrams(variantData[j].weight, variantData[j].weightUnit);
                        variantData[j].weightConvertedToGrams = true

                        variantData[j].selling_plan_allocations = transformSellingPlanAllocation(ogVariants[j]?.sellingPlanAllocations, currProduct.selling_plan_groups, ogVariants[j])



                    }
                    currProduct.variants = variantData;
                    currProduct = gbb.gbbKite.f.modifyProductDataWithDiscountedPrice(currProduct);
                    returningArray.push(currProduct);
                }

                return returningArray;

            } catch (error) {
                gbb.utility.debugConsole("error in dataMappingFromGraphQL ", error);
            }
        },
        flattenGraphQLResponse: function (response) {
            // console.log("response", response);
            const nodes = response.data ? response.data.nodes : [];
            const edges = response.edges ? response.edges : [];

            const flattenNodesOrEdges = (items) => {
                return items.map((item) => {
                    if (item) {
                        const flattenedItem = {};

                        Object.keys(item).forEach((key) => {
                            const value = item[key];
                            if (value && typeof value === "object") {
                                if (value.edges) {
                                    flattenedItem[key] = value.edges.map((edge) => edge.node);
                                } else if (value.node) {
                                    flattenedItem[key] = value.node;
                                } else {
                                    flattenedItem[key] = value;
                                }
                            } else {
                                flattenedItem[key] = value;
                            }
                        });

                        // console.log("flattenedItem", flattenedItem);
                        return flattenedItem;
                    }
                });
            };


            let flattenedNodes = []
            if (nodes.length > 0) {
                flattenedNodes = flattenNodesOrEdges(nodes);
            } else if (edges.length > 0) {
                flattenedNodes = flattenNodesOrEdges(edges);
            }

            // console.log("flattened-nodes", nodes);
            // console.log("flattened-edges", edges);


            // console.log("flattenedNodes", flattenedNodes);

            return flattenedNodes;
        },
        generateMetafieldQueries: function (metafields) {
            return metafields.map(metafield => {
                const { key, namespace } = metafield;
                return `metafield_${namespace}_${key}: metafield(key:"${key}", namespace:"${namespace}"){ 
                    id 
                    key
                    value
                    description
                    type
                }`;
            }).join(' ');
        },

        getProductsDataByIds: async function (productIds) {
            try {


                const metafields = gbb.settings.bundleSettings.metafieldNameSpaceAndKeys

                // const metafields = [
                //     { key: "test", namespace: "gbbNameSpace" },
                //     { key: "test2", namespace: "gbbNameSpace" },
                //     // Add more metafields as needed
                //     ];
                //  gbb.settings.bundleSettings.


                const metafieldQueries = gbb.graphQlUtility.generateMetafieldQueries(metafields);
                const query = `query test($ids: [ID!]!, $countryCode: CountryCode!, $languageCode: LanguageCode!) @inContext(country: $countryCode, language: $languageCode) {    
                nodes(ids: $ids) {
                ... on Product{
                  id
                  availableForSale
                  title
                  handle
                  createdAt
                  description
                  descriptionHtml
                  productType
                  ${metafieldQueries}
                  onlineStoreUrl
                  options{
                    id
                    name
                    values
                  }
                  featuredImage{
                    id
                    originalSrc
                    transformedSrc(maxWidth: 800, maxHeight: 800, crop: CENTER)
                  }
                 updatedAt
                tags
                totalInventory
                vendor
                requiresSellingPlan
                compareAtPriceRange{
                    maxVariantPrice{
                        amount
                        currencyCode
                    }
                    minVariantPrice{
                        amount
                        currencyCode
                    }
                }
                priceRange{
                    maxVariantPrice{
                        amount
                        currencyCode
                    }
                    minVariantPrice{
                        amount
                        currencyCode
                    }
                }
                media(first:100){
                    edges{
                        node{
                            id
                            alt
                            previewImage{
                                url
                                id
                            } 
                            
                        }
                    }

                }
                images(first:100){
                    edges{
                        node{
                            id
                            originalSrc
                            transformedSrc(maxWidth: 800, maxHeight: 800, crop: CENTER)
                        }
                    }
                }
                sellingPlanGroups(first: 100) {
                    edges{
                        node{
                            name
                            appName
                            options{
                                name
                                values
                            }
                            sellingPlans (first:100){
                                edges{
                                    node{
                                        id
                                        name
                                        recurringDeliveries
                                        priceAdjustments {
                                            adjustmentValue {
                                            ... on SellingPlanFixedAmountPriceAdjustment{
                                                adjustmentAmount{
                                                amount
                                                currencyCode
                                                }
                                                }
                                            ... on SellingPlanFixedPriceAdjustment{
                                                 price{
                                                    amount
                                                    currencyCode
                                                    }
                                                 }
                                            ... on SellingPlanPercentagePriceAdjustment{
                                                adjustmentPercentage
                                                }
                                            }
                                            orderCount
                                        }
                                        options{
                                            name
                                            value
                                        }

                                    }
                                }
                            }
                        }
                    }
                }
                variants(first: 100) {
                    edges {
                      node {
                        id
                        sku
                        title
                        price{
                          amount
                          currencyCode
                        }
                        weight
                        weightUnit
                        requiresShipping
                        currentlyNotInStock 
                        compareAtPrice{
                          amount
                          currencyCode
                        }
                        quantityAvailable
                        selectedOptions{
                            name
                            value
                        }
                       
                        availableForSale
                        image {
                          id
                          originalSrc
                          transformedSrc(maxWidth: 800, maxHeight: 800, crop: CENTER)
                        }
                        sellingPlanAllocations(first:100){
                            edges{
                                node{
                                     sellingPlan{
                                         id
                                         name
                                     }
                                    priceAdjustments{
                                        compareAtPrice{
                                            amount
                                            currencyCode
                                        }
                                        perDeliveryPrice{
                                            amount 
                                            currencyCode
                                        }
                                        price{
                                            amount
                                            currencyCode
                                        }
                                        unitPrice{
                                            amount
                                            currencyCode
                                        }
                                    }
                                }
                            }
                        }
                      }
                    }
                  }
                }
              }
              }`;

                
                 
                // remove the product ids that are already present
                let cachedProductData = []
                productIds = productIds.filter((id) => {
                    if (gbb.state.cachedProductDataGraphql.has(+id)) {
                        cachedProductData.push(gbb.state.cachedProductDataGraphql.get(+id))
                    }
                    else return id
                })

                for (let i = 0; i < productIds.length; i++) {
                    let item = productIds[i];
                    if (!String(item).includes("gid")) {
                        productIds[i] = "gid://shopify/Product/" + productIds[i]
                    }
                }




                const variables = {
                    ids: productIds,
                    // countryCode: "IN"  || variables.countryCode,
                    countryCode: gbb.utility.getCountry(),
                    languageCode: gbb.utility.getLocale().toUpperCase().split("-")[0]
                    // languageCode: "EN" || variables.languageCode.toUpperCase()
                };

                let response = []
                let failedProductsData = []

                if (productIds?.length > 0) {
                    response = await gbb.graphQlUtility.graphQlAPIWrapper(query, variables)

                    response?.data?.nodes?.forEach((item, idx) => {
                        if (!item) {
                            failedProductsData.push({
                                id: gbb.utility.extractIdsFromGraphQlId(productIds[idx]),
                                failedToFetch: true
                            })
                        }
                    });

                    response = gbb.graphQlUtility.gbbCleaningAndArrangingData(response);
                    response = [...cachedProductData, ...response, ...failedProductsData]
                    gbb.utility.setCachedGraphqlData(response);
                } else {
                    response = cachedProductData
                }

                response = response.filter(product => !product.failedToFetch)
                return response;

            } catch (error) {
                console.error('error in getProductDataByIds ', error)
            }
        },
    },
    gbbBrowser: {
        state: {
            boxIdOffset: 0,
            gbbDiscountsAlreadyPresentInCart: {},
        },
        addDefaultProductsToBox: function (boxId) {
            try {
                if (!boxId) {
                    boxId = gbb.state.activeBoxId || "box1";
                }
                gbb.state.activeBoxId = boxId;
                let defaultProducts = Object.values(gbb?.settings?.shopifyData?.defaultProductsData);

                for (let i = 0; i < defaultProducts.length; i++) {
                    let currentProduct = defaultProducts[i];
                    for (let j = 0; j < currentProduct.variants?.length; j++) {
                        let currentVariant = currentProduct.variants[j];
                        let quantity = currentProduct?.requiredQuantity || 1;
                        let data = {
                            variant: { id: currentVariant.id },
                            qty: quantity,
                        }
                        gbb.utility.addToCart(data, "defaultProduct", undefined, "defaultProduct");
                    }
                }

            } catch (err) {
                gbb.utility.debugConsole(err + "inside addDefaultProductsToTheCart");
            }
        },
        getRelevantGiftBoxProductsTotalWithCurrency: function (boxId) {
            try {
                //getGiftBoxProductsFromCart
                let boxCartDataInSessionStorage = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(boxId);
                // gbb.state.giftBoxCartData = await gbb.utility.getGiftBoxProductsFromCart()
                let data = boxCartDataInSessionStorage
                // if(data.currency){
                return gbb.utility.getCurrencySymbol() + "" + parseFloat(data.total_price / 100).toFixed(2)
                // }else{
                // if(Shopify && Shopify.currency && Shopify.currency.active){
                //     return "0.0"+ " " +Shopify.currency.active
                // }else{
                //     return "0.0"
                // }

                // }
            } catch (error) {
                gbb.utility.debugError("getRelevantGiftBoxProductsTotalWithCurrency");
                gbb.utility.debugError(error);
                return "0.0"
            }
        },
        getProductsFromAllBoxesFromCart: function (cartDataFromSessionStorage) {
            try {
                let allCartItems = [];
                let addBoxQuantityToProperties = gbb.settings.app.addBoxQuantityToProperties || false;
                if (!cartDataFromSessionStorage) {
                    cartDataFromSessionStorage = sessionStorage.getItem(`gbb-cart-${gbb.state.bundleId}`);
                    cartDataFromSessionStorage = JSON.parse(cartDataFromSessionStorage);
                }
                if (cartDataFromSessionStorage && cartDataFromSessionStorage.boxes) {
                    Object.keys(cartDataFromSessionStorage?.boxes)?.forEach((box) => {
                        let tempArr = cartDataFromSessionStorage?.boxes[box]["items"] || [];
                        if (addBoxQuantityToProperties) {
                            tempArr.forEach((item) => {
                                item.properties["_Box Quantity"] = cartDataFromSessionStorage?.boxes[box]["boxQuantity"] || 1;
                            })
                        }
                        allCartItems.push(...tempArr)
                    })
                }
                return allCartItems;
            } catch (err) {
                gbb.utility.debugError(err + "getProductsFromAllBoxesFromCart");
            }
        },
        setRelevantBoxDataToSessionStorage: function (boxData, boxId) {
            try {
                const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()// for subscription bundles only

                if (!boxId) {
                    boxId = gbb.state.activeBoxId;
                }
                boxData.items = boxData.items.map((item) => {
                    let productPrice = item.price
                    let originForVariantDetails = item?.properties?._boxProduct == 'addonProduct' ? "addonProducts": null
                    let variantInfo = gbb.utility.getVariantDetailsFromCurrentProductsDataSet(item.variant_id, originForVariantDetails)
                    if (variantInfo) {
                        productPrice = variantInfo.price
                    }
                    if (isPurchaseTypeSubscription) {
                        productPrice = gbb.gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId(item.variant_id)
                    }
                    return {
                        ...item,
                        price: productPrice
                    }
                })
                gbb.state.giftBoxCartData = boxData;

                // // update discount rule
                gbb.gbbDiscountComponent.f.updateCurrentDiscountRule();

                // @rafath why not call getCartDataFromSessionStorage here?
                let cartDataFromSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
                if (cartDataFromSessionStorage) {
                    if (gbb.gbbDiscountComponent.state.currentDiscountRule[gbb.state.activeBoxId]) {
                        boxData["discountValue"] = gbb.gbbDiscountComponent.state.currentDiscountRule[gbb.state.activeBoxId]["discountValue"];
                    } else {
                        boxData["discountValue"] = null;
                    }
                    cartDataFromSessionStorage.boxes[boxId] = boxData;
                    gbb.gbbDiscountComponent.f.updateCurrentDiscountRule();
                    sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataFromSessionStorage));
                }
            } catch (err) {
                gbb.utility.debugError(err + "setRelevantBoxDataToSessionStorage");
            }
        },
        addItemToCartSessionStorage: function (itemData) {
            try {
                // if(item && item.quantity == 0){
                //     return 
                // }
                let boxCartDataInSessionStorage = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
                let currentBoxId = gbb.state.activeBoxId;
                if (boxCartDataInSessionStorage && boxCartDataInSessionStorage.items) {
                    boxCartDataInSessionStorage.items.push(itemData);
                    gbb.gbbBrowser.setRelevantBoxDataToSessionStorage(boxCartDataInSessionStorage, currentBoxId);
                }
                else {
                    gbb.utility.debugConsole("no items in session storage")
                }
                gbb.gbbBrowser.updateTotalPriceInSessionStorage()
                gbb.gbbBrowser.updateTotalofRelevantBoxPriceInSessionStorage()

            } catch (e) {
                gbb.utility.debugError("addItemToCartSessionStorage", e)
                gbb.utility.triggerSlackNotification(e)
            }

        },

        getCartDataFromSessionStorage: function (options) {
            try {

                const subscriptionPlanExists = gbb.gbbReviewPage.f.checkIfSubscriptionPlanExists();

                if (subscriptionPlanExists && options && options?.forSubscription && gbb.gbbBrowser?.getSubscriptionType() == "saveSubscription") {
                    return gbb.gbbBrowser.getCartDataForSubscription();
                }

                let cart = sessionStorage.getItem(`gbb-cart-${gbb.state.bundleId}`);
                cart = JSON.parse(cart);
                if (cart) { //&& cart.items
                    // gbb.state.giftBoxCartData = cart;
                    return cart;
                }
                else {
                    //return { items: [], attributes: {}, bundleQuantity: 1 };
                }

            } catch (error) {
                gbb.utility.debugError("getCartDataFromSessionStorage", error)
            }
        },
        getRelevantBoxDataFromSessionStorage: function (boxId) {
            try {

                // if(!boxId) {
                //     if(!gbb.state.activeBoxId) {
                //         gbb.state.activeBoxId = "box1"
                //     }
                //     boxId = gbb.state.activeBoxId;


                // }

                // let bundleCartData;
                // bundleCartData = sessionStorage.getItem(`gbb-cart-${gbb.state.bundleId}`);
                // bundleCartData = JSON.parse(bundleCartData);

                let bundleCartData;
                bundleCartData = sessionStorage.getItem(`gbb-cart-${gbb.state.bundleId}`);
                bundleCartData = JSON.parse(bundleCartData);

                if (!boxId) {
                    if (!gbb.state.activeBoxId) {
                        gbb.state.activeBoxId = "box1";
                    }
                    boxId = gbb.state.activeBoxId;
                    //find the isBoxActive box and set that as the active box
                    if (bundleCartData && bundleCartData.boxes) {
                        Object.keys(bundleCartData.boxes).forEach((box) => {
                            if (bundleCartData.boxes[box].isBoxActive) {
                                gbb.state.activeBoxId = box;
                                boxId = gbb.state.activeBoxId;
                            }
                        });
                    }
                }



                if (bundleCartData) {
                    let currentBoxData = bundleCartData?.boxes[boxId] || {};
                    if (currentBoxData && currentBoxData.items) {
                        gbb.state.giftBoxCartData = currentBoxData;
                        return currentBoxData;
                    }
                } else {
                    //initialization of the item session storage item happens here
                    bundleCartData = {
                        bundleId: gbb.state.bundleId,
                        attributes: {},
                        boxes: {
                            box1: {
                                boxId: "box1",
                                boxName: "Box - 1",
                                items: [],
                                boxQuantity: 1,
                                isBoxActive: true,
                                total_price: 0
                            }
                        }
                    }
                    gbb.state.activeBoxId = "box1";
                    gbb.state.giftBoxCartData = bundleCartData.boxes["box1"];
                    sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(bundleCartData));
                    if (gbb?.settings?.stepsConfigurationData?.defaultProductsData?.isDefaultProductsEnabled) {
                        gbb.gbbBrowser.addDefaultProductsToBox();
                    }
                }
                return bundleCartData;
            } catch (error) {
                gbb.utility.debugError("getRelevantBoxDataFromSessionStorage", error)
            }
        },
        updateTotalofRelevantBoxPriceInSessionStorage: function (boxId) {
            try {
                if (!boxId) {
                    boxId = gbb.state.activeBoxId
                }
                let boxCartDataInSessionStorage = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(boxId);
                if (boxCartDataInSessionStorage && boxCartDataInSessionStorage.items) {
                    let totalPrice = 0;
                    let totalQuantity = 0;
                    boxCartDataInSessionStorage.items.forEach((item) => {
                        totalPrice += item.price * item.quantity;
                        totalQuantity += item.quantity;
                    })
                    boxCartDataInSessionStorage.total_price = totalPrice;
                    boxCartDataInSessionStorage.item_count = totalQuantity;
                    gbb.gbbBrowser.setRelevantBoxDataToSessionStorage(boxCartDataInSessionStorage, boxId);
                    //sessionStorage.setItem(`gbb-cart-${gbb.state.boxId}`, JSON.stringify(cartDataInSessionStorage));
                }
            } catch (err) {
                gbb.utility.debugConsole(err + "at updateTotalofRelevantBoxPriceInSessionStorage");
            }
        },
        updateTotalPriceInSessionStorage: function () {
            try {
                let cartDataInSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
                if (cartDataInSessionStorage && cartDataInSessionStorage.boxes) {
                    let totalPrice = 0;
                    let totalQuantity = 0;
                    Object.keys(cartDataInSessionStorage.boxes).forEach((box) => {
                        let boxItem = cartDataInSessionStorage.boxes[box];
                        boxItem.items.forEach((item) => {
                            totalPrice += item.price * item.quantity;
                            totalQuantity += item.quantity;
                        })
                    })
                    cartDataInSessionStorage.total_price = totalPrice;
                    cartDataInSessionStorage.item_count = totalQuantity;
                    sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataInSessionStorage));
                }
            } catch (e) {
                gbb.utility.debugError("updateTotalPriceInSessionStorage", e)
            }
        },
        updateCartItemQuantityAndProperty: function (variantId, quantity, properties, boxId) {
            try {
                if (!boxId) {
                    boxId = gbb.state.activeBoxId;
                }
                let boxCartDataInSessionStorage = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(boxId);


                // in properties there is _uniqueGbbItemkey;
                // let boxCartDataInSessionStorageIndex = boxCartDataInSessionStorage.items.findIndex((cart) => cart.id == variantId);

                let boxCartDataInSessionStorageIndex = boxCartDataInSessionStorage.items.findIndex(cart => {
                    if (cart.properties && cart.properties["_uniqueGbbItemKey"]) {
                        return cart.properties["_uniqueGbbItemKey"] == properties["_uniqueGbbItemKey"];
                    } else {
                        return cart.id == variantId;
                    }
                });
                boxCartDataInSessionStorage.items[boxCartDataInSessionStorageIndex].quantity = quantity;
                boxCartDataInSessionStorage.items[boxCartDataInSessionStorageIndex].properties = properties;

                //  if quantity is 0 then remove the item from cart
                if (quantity == 0 && boxCartDataInSessionStorageIndex > -1) {
                    boxCartDataInSessionStorage.items.splice(boxCartDataInSessionStorageIndex, 1);
                }

                gbb.gbbBrowser.setRelevantBoxDataToSessionStorage(boxCartDataInSessionStorage)
                //sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(boxCartDataInSessionStorage));
                gbb.gbbBrowser.updateTotalPriceInSessionStorage()
                gbb.gbbBrowser.updateTotalofRelevantBoxPriceInSessionStorage()
                return boxCartDataInSessionStorage;
            }
            catch (e) {
                gbb.utility.debugError("updateCartItemQuantityAndProperty", e)
            }
        },

        getCartDataForSubscription: function () {
            try {
                //gbb.state.giftboxCartData 
                // gbb.utility.debugConsole("inside getCartDataForSubscription");
                let cart = gbb.gbbBrowser.getCartDataFromSessionStorage();
                cart.total_price = 0;
                cart.item_count = 0;
                Object.keys(cart.boxes).forEach((box) => {
                    let boxItem = cart.boxes[box];
                    boxItem.total_price = 0;
                    boxItem.item_count = 0;
                    boxItem.items.forEach((item) => {
                        let sellingPlanDetails = item.sellingPlanDetails;
                        if (sellingPlanDetails) {
                            let planItem = sellingPlanDetails[cart?.subscriptionPlan];
                            // total_price += (item.quantity) * (item?.price - planItem?.price);
                            // item.price = planItem?.price || planItem?.perDeliveryPrice;
                            item.price = planItem?.price;
                        }
                        boxItem.total_price += item.price * item.quantity;
                        boxItem.item_count += item.quantity;
                    })
                    cart.total_price += boxItem.total_price;
                    cart.item_count += boxItem.item_count;
                    //setRelevantBoxDataToSessionStorage
                    // gbb.gbbBrowser.setRelevantBoxDataToSessionStorage(boxItem, box);
                })

                // gbb.gbbBrowser.updateSubscriptionTotal(cart.total_price)   

                gbb.gbbBrowser.updateTotalPriceInSessionStorage()

                return cart;

            } catch (e) {
                gbb.utility.debugError("getCartDataForSubscription", e)
            }
        },

        updateCartItemSellingDetails: function (variantId, sellingPlanDetails = []) {
            try {
                let cartDataInSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
                let boxDataInSessionStorageIndex;
                let boxItem;
                let allBoxesKeys = Object.keys(cartDataInSessionStorage?.boxes)

                for (let i = 0; i < allBoxesKeys.length; i++) {
                    boxItem = cartDataInSessionStorage.boxes[allBoxesKeys[i]];
                    boxDataInSessionStorageIndex = boxItem.items.findIndex((cart) => cart.id == variantId)
                    if (boxDataInSessionStorageIndex != -1) {
                        boxItem.items[boxDataInSessionStorageIndex].sellingPlanDetails = sellingPlanDetails;
                        break;
                    }
                }
                cartDataInSessionStorage.boxes[boxItem.boxId] = boxItem;
                sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataInSessionStorage));

                gbb.gbbBrowser.updateTotalPriceInSessionStorage()
                gbb.gbbBrowser.updateTotalofRelevantBoxPriceInSessionStorage(boxItem.boxId)

                return cartDataInSessionStorage;
            }
            catch (e) {
                gbb.utility.debugError("updateCartItemSellingDetails", e)
            }
        },
        updateCartAttributes: function (attributesvalues) {
            try {
                let cartDataInSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();

                //loop cartDataInSessionStorage attributes and update one by one
                for (let [key, value] of Object.entries(attributesvalues)) {
                    cartDataInSessionStorage.attributes[key] = value;
                }
                sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataInSessionStorage));

                gbb.gbbBrowser.updateTotalPriceInSessionStorage();
                //gbb.gbbBrowser.updateTotalofRelevantBoxPriceInSessionStorage() #TBD
                return cartDataInSessionStorage;
            }
            catch (e) {
                gbb.utility.debugError("updateCartAttributes", e)
            }
        },
        deleteCartAttributes: function (attributes) {
            try {
                let cartDataInSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
                let attributesKeys = Object.keys(cartDataInSessionStorage.attributes);
                for (let i = 0; i < attributesKeys.length; i++) {
                    if (attributes.includes(attributesKeys[i])) {
                        delete cartDataInSessionStorage.attributes[attributesKeys[i]];
                    }
                }
                sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataInSessionStorage));
                gbb.gbbBrowser.updateTotalPriceInSessionStorage();
                //gbb.gbbBrowser.updateTotalofRelevantBoxPriceInSessionStorage() #TBD
                return cartDataInSessionStorage;
            } catch (e) {
                gbb.utility.debugError("deleteCartAttributes", e)
            }
        },

        clearRelevantBoxFromSessionStorage: async function (boxId) {
            try {
                let cartDataInSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();

                //ex:allBoxesKeys = [box1, box2, box3, box4]
                let allBoxesKeys = Object.keys(cartDataInSessionStorage?.boxes) || [];
                gbb.gbbDiscountComponent.state.currentDiscountRule[boxId] = null;

                let currentBoxNo = parseInt(boxId.split("box")[1]);

                let lastBoxNo = parseInt(allBoxesKeys[allBoxesKeys.length - 1].split("box")[1]);

                let allBoxesData = JSON.parse(JSON.stringify(cartDataInSessionStorage.boxes));
                let tempAllBoxesData = JSON.parse(JSON.stringify(cartDataInSessionStorage.boxes));


                //allBoxesKeys = [box1, box2, box3, box4]
                for (let index = currentBoxNo; index < lastBoxNo; index++) {
                    let nextBoxIndex = index + 1;
                    let tempCopiedProductsDataObject = JSON.parse(JSON.stringify(tempAllBoxesData["box" + nextBoxIndex]))
                    allBoxesData[`box${index}`] = tempCopiedProductsDataObject;
                    allBoxesData[`box${index}`]["boxName"] = "Box - " + index;
                    allBoxesData[`box${index}`]["boxId"] = "box" + index;
                }
                delete allBoxesData["box" + allBoxesKeys.length];

                cartDataInSessionStorage.boxes = allBoxesData;

                sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataInSessionStorage));

                //update item properties for all boxes
                let newAllBoxesKeys = Object.keys(cartDataInSessionStorage?.boxes) || [];
                for (let i = 0; i < newAllBoxesKeys.length; i++) {
                    let boxItem = cartDataInSessionStorage.boxes[allBoxesKeys[i]];
                    let items = boxItem.items || [];
                    for (let i = 0; i < items.length; i++) {
                        let item = items[i];
                        let _data = {
                            id: item.key || item.id,
                            quantity: item.quantity,
                            properties: {
                                ...item.properties,
                                "Box ID": boxItem?.boxId?.split("box")[1] || 1
                            }
                        }
                        gbb.state.activeBoxId = boxItem.boxId;
                        await gbb.utility.changeCart(_data);
                    }
                }

                gbb.gbbBrowser.updateSubscriptionType("oneTimeSubscription");
                gbb.gbbBrowser.removeSubscriptionPlan();
                if (!cartDataInSessionStorage.boxes || Object.keys(cartDataInSessionStorage.boxes).length == 0) {
                    gbb.gbbBrowser.clearCartDataFromSessionStorage();
                }
                gbb.gbbReviewPage.init();
            } catch (err) {
                gbb.utility.debugConsole(err + "clearRelevantBoxFromSessionStorage");
            }
        },
        clearCartDataFromSessionStorage: function () {
            try {
                gbb.state.activeBoxId = null;
                sessionStorage.removeItem(`gbb-cart-${gbb.state.bundleId}`);
                let isEligibleTierForAddonsExists = gbb.storage.getItem(`eligible-tiers-for-addons-${gbb.state.bundleId}`)
                if (isEligibleTierForAddonsExists) {
                    sessionStorage.removeItem(`eligible-tiers-for-addons-${gbb.state.bundleId}`)
                }
            } catch (e) {
                gbb.utility.debugError("clearCartDataFromSessionStorage", e)
            }
        },
        addItemsToCart: async function () {
            try {
                const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()

                //perform ajax calls and add items to cart, then return the cart data
                //get the bundleQuantity from cartData
                // cartData = gbb.utility.multiplyByBundleQuantity(cartData)
                let cartData = gbb.gbbBrowser.getCartDataFromSessionStorage();
                let result = {
                    data: false,
                    failedProductsArr: []
                };
                //for loop and multiply quantity of items by boxQuantity
                for (let boxId in cartData.boxes) {
                    let boxCartData = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(boxId);
                    cartData.boxes[boxId] = gbb.utility.multiplyByBundleQuantity(boxCartData)
                }

                //now traverse the cartData and remove all items from cart

                let allItems = gbb.gbbBrowser.getProductsFromAllBoxesFromCart(cartData);

                cartData.items = allItems;

                cartData = gbb.utility.cleanUpProperties(cartData);

                if (gbb.gbbAddonProducts.state.isEnabled) {
                    // check if cart contains addon products 
                    let isAddonProductPresentInCart = cartData.items.find(item => item.properties.hasOwnProperty("_addon_product"))
                    if (isAddonProductPresentInCart) {
                        let propertiesToAdd = {
                            _addon_offer_id:gbb.gbbAddonProducts.state.offerId
                        }
                        let addQtyToProducts = true
                        gbb.utility.addCustomProperties(cartData, propertiesToAdd, addQtyToProducts)
                    }
                }

                if (gbb.gbbBrowser.getSubscriptionType() == "saveSubscription" && gbb.gbbBrowser.getSubscriptionPlan()) {
                    cartData = gbb.utility.applySellingPlanToAllCartItems(cartData);
                }

                if (isPurchaseTypeSubscription) {
                    cartData = gbb.utility.applySellingPlanToAllCartItemsV2(cartData);
                }

                let cartDataWithBoxIdCorrected = gbb.utility.updateBoxIdInCartData(cartData);

                // if more than 
                // if ()

                cartDataWithBoxIdCorrected.items = gbb.utility.groupCartDataBasedOnId_and_Properties(cartDataWithBoxIdCorrected.items)


                result.data = await gbb.shopifyUtility.addToCart(cartDataWithBoxIdCorrected)

                if (!result.data) {
                    let response = await gbb.gbbBrowser.addIndividualItemsToCart(cartDataWithBoxIdCorrected);
                    result.data = response.data;
                    result.failedProductsArr = response.failedProductsArr;
                    gbb.gbbBrowser.emitCustomEvent({
                        eventName: "gbb-add-bundle-to-cart-failed",
                        detail: {
                            failedProducts:response.failedProductsArr || []
                        }
                    })
                } else {
                    result.data = true;
                    gbb.gbbBrowser.emitCustomEvent({
                        eventName: "gbb-add-bundle-to-cart-success",
                    })
                }
                // if (result.data) {
                //     gbb.gbbBrowser.clearCartDataFromSessionStorage()
                // }
                return result;
            } catch (error) {
                gbb.utility.debugConsole("error in gbbBrowser.addItemsToCart", error)
                return false
            }
        },
        addIndividualItemsToCart: async function (cartData) {
            let currentProduct;
            let result = {
                data: false,
                failedProductsArr: []
            }
            try {
                //individual ajax calls for each item
                let items = cartData.items;
                let apiResponse = [];
                for (let i = 0; i < items.length; i++) {
                    currentProduct = items[i];
                    let resp = await gbb.shopifyUtility.addToCart(items[i]);
                    apiResponse.push(resp)
                    if (resp && result.data) {
                        result.data = true;
                    }
                    if (!resp) {
                        result.data = false;
                        result.failedProductsArr.push(currentProduct);
                    }
                }
                return result;
            } catch (error) {
                // result.data = false;
                gbb.utility.debugConsole("error in gbbBrowser.addIndividualItemsToCart", error)
                return result;
            }
        },
        initializeRelevantBoxQuantity: function () {
            if (!gbb.gbbBrowser.getRelevantBoxQuantity()) {
                gbb.gbbBrowser.updateRelevantBoxQuantity(1);
            }
        },
        updateRelevantBoxQuantity: function (value, boxId) {
            if (!boxId) {
                boxId = gbb.state.activeBoxId
            }
            let boxCartDataInSessionStorage = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(boxId);
            boxCartDataInSessionStorage.boxQuantity = value;
            // if(gbb.state.giftBoxCartData){ //TBD
            //     gbb.state.giftBoxCartData["bundleQuantity"] = value;
            // }
            gbb.gbbBrowser.setRelevantBoxDataToSessionStorage(boxCartDataInSessionStorage, boxId);
            return boxCartDataInSessionStorage.boxQuantity;
        },
        getRelevantBoxQuantity: function (boxId) {
            if (!boxId) {
                boxId = gbb.state.activeBoxId
            }
            let boxCartDataInSessionStorage = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(boxId)
            if (boxCartDataInSessionStorage) {
                return boxCartDataInSessionStorage.boxQuantity;
            }
            return 0;
        },
        getSubscriptionType: function () {
            let cart = sessionStorage.getItem(`gbb-cart-${gbb.state.bundleId}`);
            cart = JSON.parse(cart);
            if (cart && cart.subscriptionType) {
                return cart.subscriptionType;
            }
            return 0;
        },
        updateSubscriptionType: function (value) {
            let cartDataInSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
            cartDataInSessionStorage.subscriptionType = value;
            if (gbb.state.giftBoxCartData) {
                gbb.state.giftBoxCartData["subscriptionType"] = value;
            }
            sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataInSessionStorage));
            return cartDataInSessionStorage.subscriptionType;
        },
        getSubscriptionPlan: function () {
            let cart = sessionStorage.getItem(`gbb-cart-${gbb.state.bundleId}`);
            cart = JSON.parse(cart);
            if (cart && cart.subscriptionPlan) {
                return cart.subscriptionPlan;
            }
            return 0;
        },
        updateSubscriptionPlan: function (value) {
            let cartDataInSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
            cartDataInSessionStorage.subscriptionPlan = value;
            if (cartDataInSessionStorage["subscriptionTotal"]) {
                delete cartDataInSessionStorage["subscriptionTotal"];
            }
            if (gbb.state.giftBoxCartData) {
                gbb.state.giftBoxCartData["subscriptionPlan"] = value;
            }
            sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataInSessionStorage));
            return cartDataInSessionStorage.subscriptionPlan;
        },
        prepareDiscountString: function () {
            let getAllDiscountsToApply = gbb.gbbBrowser.state.gbbDiscountsAlreadyPresentInCart;

            let bundleName = gbb.state.bundleName;


            if (gbb.gbbDiscountComponent.state.discountCode) {
                getAllDiscountsToApply = { ...getAllDiscountsToApply, [`gbbDiscountCode-${bundleName}`]: gbb.gbbDiscountComponent.state.discountCode };
            }
            let discountCodeString;
            // {"gbbDiscountCode-1": 'teeboxblandselv-42609929',"gbbDiscountCode-2": 'teeboxblandselv-42609929'}
            if (getAllDiscountsToApply) {
                //convert them to teeboxblandselv-42609929,teeboxblandselv-42609929
                discountCodeString = Object.values(getAllDiscountsToApply).join(",");
            }
            if (discountCodeString) {
                gbb.gbbDiscountComponent.state.discountCode = gbb.gbbDiscountComponent.state.discountCode + "," + discountCodeString;
            }

            return discountCodeString;
        },
        updateSubscriptionTotal: function (value) {
            let cartDataInSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
            cartDataInSessionStorage.subscriptionTotal = value;
            if (gbb.state.giftBoxCartData) {
                gbb.state.giftBoxCartData["subscriptionTotal"] = value;
            }
            sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataInSessionStorage));
            return cartDataInSessionStorage.subscriptionTotal;
        },
        removeSubscriptionPlan: function () {
            let cartDataInSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
            delete cartDataInSessionStorage.subscriptionPlan;
            sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataInSessionStorage));
            return cartDataInSessionStorage.subscriptionPlan;
        },
        createNewBoxInSessionStorage: function (isRedirectAllowed) {
            try {
                let cartDataFromSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
                let boxKeys = Object.keys(cartDataFromSessionStorage?.boxes) || [];
                let maxBoxKey = 0;
                for (let i = 0; i < boxKeys.length; i++) {
                    let tempBoxKeyNo = parseInt(boxKeys[i]?.split("box")[1]);
                    if (tempBoxKeyNo > maxBoxKey) {
                        maxBoxKey = tempBoxKeyNo;
                    }
                }
                maxBoxKey = maxBoxKey + 1;
                let newBoxId = "box" + maxBoxKey
                let newBox = {
                    boxId: newBoxId,
                    boxName: "Box - " + maxBoxKey,
                    items: [],
                    boxQuantity: 1,
                    isBoxActive: true,
                    total_price: 0
                }

                gbb.gbbPersonalizePage.state.customerUploadsErrors = null;
                gbb.gbbPersonalizePage.state.customerUploadsResponse = null;

                // gbb.gbbBrowser.activateRelevantBoxInSessionStorage(newBoxId,{redirectToFirstProductPage:isRedirectAllowed});
                cartDataFromSessionStorage = gbb.gbbBrowser.activateRelevantBoxInSessionStorage(newBoxId, { redirectToFirstProductPage: isRedirectAllowed });

                gbb.gbbDiscountComponent.state.currentDiscountRule[gbb.state.activeBoxId] = null;
                cartDataFromSessionStorage.boxes[newBoxId] = newBox;
                sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataFromSessionStorage));

                if (gbb?.settings?.stepsConfigurationData?.defaultProductsData?.isDefaultProductsEnabled) {
                    gbb.gbbBrowser.addDefaultProductsToBox();
                }
                let isEligibleTierForAddonsExists = gbb.storage.getItem(`eligible-tiers-for-addons-${gbb.state.bundleId}`)
                if (isEligibleTierForAddonsExists) { 
                    sessionStorage.removeItem(`eligible-tiers-for-addons-${gbb.state.bundleId}`)
                }
                return cartDataFromSessionStorage;
            } catch (err) {
                gbb.utility.debugError(err);
            }
        },
        redirectToFirstProductPage: function () {
            try {
                let firstItem = gbb.state.navigationItems[0];
                if (firstItem.id == "landingPage") {
                    firstItem = gbb.state.navigationItems[1];
                }
                firstItem.initFn();
                gbb.f.addParamsToUrl("page", firstItem.id)
            } catch (err) {
                gbb.utility.debugError(err);
            }
        },

        activateRelevantBoxInSessionStorage: function (boxId, options) {
            // options = {redirectToFirstProductPage:true/false}
            try {
                gbb.state.activeBoxId = boxId;
                let cartDataFromSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
                let boxKeys = Object.keys(cartDataFromSessionStorage?.boxes) || [];
                for (let i = 0; i < boxKeys.length; i++) {
                    let boxItem = cartDataFromSessionStorage.boxes[boxKeys[i]];
                    if (boxItem.isBoxActive) {
                        boxItem.isBoxActive = false;
                        break;
                    }
                }
                for (let i = 0; i < boxKeys.length; i++) {
                    let boxItem = cartDataFromSessionStorage.boxes[boxKeys[i]];
                    if (boxItem.boxId == boxId) {
                        boxItem.isBoxActive = true;
                        break;
                    }
                }
                if (options?.redirectToFirstProductPage) {
                    gbb.gbbBrowser.redirectToFirstProductPage();
                }
                gbb.gbbPersonalizePage.state.customerUploadsResponse = null;
                sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataFromSessionStorage));
                return cartDataFromSessionStorage;
            } catch (err) {
                gbb.utility.debugError(err);
            }
        },
        getCartDataFromShopify: async function () {
            try {
                const cartData = await gbb.shopifyUtility.getCart();
                //now loop through items and check if theres any property on known as Box ID
                // if yes, then save that BoxId as gbb.gbbBrowser.state.boxIdOffset
                let boxIdOffset = 0;
                let listOfBundleNamesPresentInCart = [];
                cartData.items.forEach(item => {
                    if (item.properties["Box ID"]) {
                        //  boxIdOffset = parseInt(item.properties["Box ID"]);
                        boxIdOffset = Math.max(boxIdOffset, parseInt(item.properties["Box ID"]));
                        // this will append duplicate box names, but its not gonna harm or cause a problem, so its fine
                        listOfBundleNamesPresentInCart.push(item.properties["Bundle"]);
                    }
                });

                listOfBundleNamesPresentInCart = [...new Set(listOfBundleNamesPresentInCart)];

                //              cartData.attributes
                // {gbbDiscountCode-1: 'teeboxblandselv-42609929'}

                let gbbDiscountsAlreadyPresentInCart = Object.keys(cartData.attributes).filter(key => key.includes("gbbDiscountCode-"));

                if (gbbDiscountsAlreadyPresentInCart.length > 0) {
                    gbbDiscountsAlreadyPresentInCart.forEach(discountCodeKey => {
                        let discountCode = cartData.attributes[discountCodeKey];
                        // check if this discountCodeKey is present in listOfBundleNamesPresentInCart
                        let discountCodeKeyBoxName = discountCodeKey.split("gbbDiscountCode-")[1];

                        //is discountCodeKeyBoxName present in listOfBundleNamesPresentInCart
                        if (discountCodeKeyBoxName && listOfBundleNamesPresentInCart.includes(discountCodeKeyBoxName)) {
                            // if yes, then add this discountCode to gbb.gbbBrowser.state.gbbDiscountsAlreadyPresentInCart
                            gbb.gbbBrowser.state.gbbDiscountsAlreadyPresentInCart[discountCodeKey] = discountCode;
                        }
                    })
                }

                gbb.gbbBrowser.state.cartDataFromShopifyBeforeLastPage = cartData;

                gbb.utility.debugConsole("boxIdOffset-> set as", boxIdOffset)
                gbb.gbbBrowser.state.boxIdOffset = boxIdOffset;
                return cartData;
            } catch (error) {
                gbb.utility.debugError(error);
                return;
            }
        },
        setSubscriptionBundleDataInSessionStorage: function (payload) {
            try {
                // set payload in session storage with bundleId
                sessionStorage.setItem(`gbb-subscription-bundle-${gbb.state.bundleId}`, JSON.stringify(payload));

            } catch (error) {
                gbb.utility.debugError('error in setSubscriptionBundleDataInSessionStorage', error)
            }
        },
        emitCustomEvent: function ({
            eventName,
            attachEventTo = document,
            detail = '',
            bubbles = true,
            cancelable = false
        }) {
            try {
                gbb.utility.debugConsole("customEvent:",{
                    eventName,
                    attachEventTo,
                    detail,
                });
                let event = new CustomEvent(eventName, {
                    detail: detail, // extra information that can be accessed via e.detail.message
                    bubbles: bubbles,    // Allow event propagation through the DOM if needed
                    // cancelable: cancelable, // we dont want to give other dev power to interrupt our execution / operations
                });
                // Dispatch the event on the specified element (default is document)
                attachEventTo.dispatchEvent(event);
                return attachEventTo
            } catch (error) {
                gbb.utility.debugError(`Error in emitCustomEvent for event: ${eventName}`, error);
            }
        }
    },
    storage: {

        setItem: function (field, value) {
            sessionStorage.setItem(field, value)
        },
        getItem: function (field) {
            return sessionStorage.getItem(field)
        }
    },
    themeSpecificCode: {
        init: function (settings) {
            gbb.themeSpecificCode.f.ventureTheme(settings)
        },

        f: {
            ventureTheme: function () {
                if (window.Shopify && window.Shopify.theme && window.Shopify.theme.theme_store_id && window.Shopify.theme.theme_store_id == gbb.constants.themesIds.VENTURE_THEME) {
                    // reload on save
                    gbb.selectors.sideCartDrawerOverlay = ""
                }
            }
        }
    },
    giftboxbuilderPage: {
        //init, selectGiftBoxPage, AddProductsPage, personalizePage, reviewPage,
        init: async function (settings) {
            gbb.giftboxbuilderPage.initialize(settings)
        },
        initialize: async function (settings) {
            // gbb.giftboxbuilderPage.init(settings)

            // gbb.state.cartData = await gbb.utility.getCart()

            gbb.utility.debugConsole("dummy commit");
            //initialize active variant class
            gbb.utility.getActiveVariantStyle();
            await gbb.utility.setStoreCurrenyStateFromCart();

            gbb.utility.setBuilderPageHTMLData_SEO()

            let navigationItems = gbb.f.setNavigationItems();

            if (gbb.settings.stepsConfigurationData.bundleStatus == "PAUSED") {
                navigationItems = [];
            }

            gbb.state.navigationItems = navigationItems
            let currentNavigationItem;

            gbb.giftboxbuilderPage.f.insertWrapperIntoBody();

            gbb.gbbAddProductsPage.f.createArraysOfPageWhichHaveConditions();

            if (gbb.settings?.stepsConfigurationData?.isProductSlotsEnabled) {
                gbb.gbbAddProductsPage.f.calculateProductSlotsData()
            }
            // document.title = "Easy Bundles"

            gbb.gbbDiscountComponent.f.updateCurrentDiscountRule()
            gbb.gbbKite.init();
            // currentPageId
            //  check the url params and see if there is ?page field

            let navId = gbb.f.getParamValueFromUrl("page")
            let currentFlow = gbb.f.getParamValueFromUrl("currentFlow")
            //check if landing page is enabled or not that's it
            let isLandingPageEnabled = gbb.settings?.stepsConfigurationData?.landingPageData?.isLandingPageEnabled
            if (isLandingPageEnabled && (navId == null || typeof navId == "undefined" || navId == "landingPage")) {
                gbb.gbbLandingPage.init(settings, "GIFTBOXBUILDER_PAGE")
                gbb.utility.renderTemporaryLoadingSpinner("hide")
                //prefetchFn of the next page to be loaded, figure out from navigationitems
                let nextNavigationItem = gbb.f.getNextNavigationItem();
                if (nextNavigationItem) {

                    if (nextNavigationItem.intialFetchFn) {
                        nextNavigationItem.intialFetchFn()
                    }
                }
            } else {
                gbb.utility.renderTemporaryLoadingSpinner("show")
            }


            // initialize all these fns after calling
            // prefetching the data from shopify

            // extract extra info from localStorage extraInfoFromLinkDummyProductPage
            gbb.f.processAdditionalLogicAsPerUseCase();

            const getProductsData = await gbb.f.prefetchData(settings)
            gbb.gbbBrowser.initializeRelevantBoxQuantity();
            const directlyLoadCheckoutPage = gbb.state.navigationItems.length < 1 ? true : false;
            if (directlyLoadCheckoutPage) {
                await gbb.gbbBrowser.getCartDataFromShopify();
                await gbb.utility.handleCheckoutClick();
                return;
            }

            if (navId != null && navId != "landingPage" && typeof navId != "undefined") {
                //find the current navigationItem
                currentNavigationItem = gbb.f.getNavItem(navId);
                gbb.state.currentPageId = currentNavigationItem.id
                //call the initFn
                gbb.f.markPreviousNavigationItemsAsCompleted(currentNavigationItem)
                await currentNavigationItem.initFn()
                gbb.utility.renderTemporaryLoadingSpinner("hide")
            } else {
                //call the initFn of the first item
                let firstItem = gbb.state.navigationItems[0];
                gbb.f.addParamsToUrl("page", firstItem.id)
                gbb.f.addParamsToUrl("currentFlow", "byob")
                gbb.f.markPreviousNavigationItemsAsCompleted(firstItem)

                if (firstItem.id != "landingPage") {
                    await firstItem.initFn()
                    gbb.utility.renderTemporaryLoadingSpinner("hide")
                }
            }

            gbb.utility.renderTemporaryLoadingSpinner("hide")

            await gbb.f.insertDiscountProgressBar();

            let isThisLastNavigationItem = gbb.state.navigationItems.indexOf(currentNavigationItem) == gbb.state.navigationItems.length - 1
            let isThisTheOnlyNavigationItem = gbb.state.navigationItems.length == 1

            if (isThisLastNavigationItem || isThisTheOnlyNavigationItem) {
                gbb.gbbBrowser.getCartDataFromShopify();
            }

            // gbb.giftboxbuilderPage.f.scrollIntoBundleViewForIndependentPage();

        },
        f: {
            applyCustomizationClassToBodyIfNeeded: function (body) {
                try {
                    let applyNewCustomization = gbb.settings.pageCustomizationData?.generalSettings?.bundle?.applyNewPageCustomization;

                    // If customization flag is not set, check against the version release date
                    if (!applyNewCustomization) {
                        let userCreatedAt = gbb.settings.merchantInfo.createdAt;
                        const versionReleaseDate = new Date('2024-09-19T00:00:00Z'); // 19th September 2024

                        applyNewCustomization = new Date(userCreatedAt) >= versionReleaseDate;
                    }

                    // Add class if customization is applicable
                    if (applyNewCustomization) {
                        gbb.$(body).addClass('gbbNewPageCustomization');
                    }
                } catch (error) {
                    gbb.utility.debugError("applyCustomizationClassToBodyIfNeeded", error);
                }
            },
            insertWrapperIntoBody: function () {
                let currentBundleDesignTemplate = gbb.settings.stepsConfigurationData.bundleDesignTemplate
                const gbbHTMLWrapper = gbb.elements.gbbHTMLWrapperParent;
                const gbbBodyWrapper = gbb.elements.gbbBodyWrapperParent;
                gbbHTMLWrapper.append(gbbBodyWrapper);
                gbb.$(".gbbPageBody").html(gbbHTMLWrapper);

                //attach bundle-number  to the html tag
                gbb.$("html").addClass(`bundle-${gbb.state.bundleId}`)
                gbb.$("html").addClass(`gbbBundle-HTML`)


                // add an id too
                if (currentBundleDesignTemplate == 'BUILD_FROM_SCRATCH_NEWPRODUCTCARD') {
                    gbb.$(".gbbPageBody").addClass('gbbProductsCardLayoutV2')
                }
                gbb.giftboxbuilderPage.f.applyCustomizationClassToBodyIfNeeded('.gbbPageBody')
                // if(gbb.settings.pageCustomizationData.)
                gbb.$(".gbbPageBody").attr("id", "gbbBundle")
                gbb.$(".gbbPageBody").addClass(`bundle-${gbb.state.bundleId}`)
                if (gbb.settings.pageCustomizationData.generalSettings.bundle.bundleBgColor) {
                    gbb.$(".gbbPageBody").css("background-color", gbb.settings.pageCustomizationData.generalSettings.bundle.bundleBgColor)
                }
            },
            scrollIntoBundleViewForIndependentPage: function () {
                try {
                    let gbbBundleElement = gbb.$("#gbbBundle").length > 0 && window.easyBundlesConfig;

                    if (gbbBundleElement) {
                        // gbbBundleElement[0].scrollIntoView({ behavior: "smooth", block: "start" });

                        // scroll with some  margin of top 20px;

                        let topPos = gbb.$("#gbbBundle").offset().top - 20;

                        // scroll into it;
                        gbb.$('html, body').animate({
                            scrollTop: topPos
                        }, 1000);
                    }
                } catch (e) {
                    gbb.utility.debugError("error in scrollIntoBundleViewForIndependentPage", e)
                }
            }
        },
        action: {
            onPrevNavigationBYOB: async function () {
                let currentPageItem = gbb.f.getNavItem(gbb.state.currentPageId);
                let scrollPoisitionAfterPageChange = gbb.state.scrollPoisitionAfterPageChange;

                let prevNavigationItem = gbb.f.getPreviousNavigationItem();
                gbb.state.navigationItems.forEach(function (item) {
                    if (item.id == currentPageItem.id) {
                        item.isActive = false;
                    }
                })
                gbb.state.navigationItems.forEach(function (item) {
                    if (item.id == prevNavigationItem.id) {
                        item.isActive = true;
                    }
                })
                //check if its the last navigation item
                if (prevNavigationItem) {

                    gbb.f.markPreviousNavigationItemsAsCompleted(prevNavigationItem)
                    await prevNavigationItem.initFn();

                    gbb.f.addParamsToUrl("page", prevNavigationItem.id)
                    setTimeout(() => {
                        window.scrollTo(0, scrollPoisitionAfterPageChange);
                    }, 700)
                }
                else {
                    gbb.utility.debugConsole("Welcome to the first page bro")
                    // gbb.gbbModal.action.onModalClose();
                }

            },
            onNextNavigationBYOB: async function (nextPageId) {
                // type -> back or next

                //next button click on path 2 -> create your own gift box

                // gbb.giftboxbuilderPage.f.onFooterNextButtonClick(settings)
                // if(nextNavigationItem.updatePageStatusFn){
                // nextNavigationItem
                // }
                // todo,
                let currentPageValidationPassed = true;
                let currentPageItem = gbb.f.getNavItem(gbb.state.currentPageId);
                let nextNavigationItem;

                if (nextPageId) {
                    nextNavigationItem = gbb.f.getNavItem(nextPageId);
                } else {
                    nextNavigationItem = gbb.f.getNextNavigationItem();
                }

                if (currentPageItem.updatePageStatusFn) {
                    currentPageValidationPassed = await currentPageItem.updatePageStatusFn();
                }

                //make next navigation item active
                if (nextNavigationItem) {
                    gbb.state.navigationItems.forEach(function (item) {
                        if (item.id == nextNavigationItem.id) {
                            item.isActive = true;
                        }
                    })
                }

                //is this nextNavigationItem is the last navigation item then call shopifyAddToCart
                let isThisLastNavigationItem = gbb.state.navigationItems.indexOf(nextNavigationItem) == gbb.state.navigationItems.length - 1
                let scrollPoisitionAfterPageChange = gbb.state.scrollPoisitionAfterPageChange;
                //check if its the last navigation item
                if (nextNavigationItem && currentPageValidationPassed) {
                    await nextNavigationItem.initFn();
                    gbb.f.addParamsToUrl("page", nextNavigationItem.id)
                    setTimeout(() => {
                        window.scrollTo(0, scrollPoisitionAfterPageChange);
                        // window.scrollTo(0, 70);
                    }, 700)

                }

                if (isThisLastNavigationItem) {
                    gbb.gbbBrowser.getCartDataFromShopify();
                }

                else if (!nextNavigationItem) {
                    gbb.utility.debugConsole("Welcome to the end bro")
                    let cartData = await gbb.utility.getCart();
                    gbb.state.giftBoxCartData = cartData;
                    await gbb.utility.handleCheckoutClick();
                    // gbb.gbbModal.action.onModalClose();
                }

                // gbbBundle scroll to gbbBundle id attribute
                gbb.giftboxbuilderPage.f.scrollIntoBundleViewForIndependentPage();

            }
        }

    },
    gbbLandingPage: {
        state: {
            buildBoxButtonAction: undefined,
            // giftBoxData: null,
        },
        init: async function (settings, parent) {
            gbb.state.navigationItems = gbb.f.setNavigationItems();
            gbb.state.currentPageId = "landingPage";
            if (gbb?.gbbAddProductsPage?.state?.productPageData) {
                gbb.gbbAddProductsPage.state.productPageData = undefined
            }
            let navItem = gbb.utility.getNavItem(gbb.state.currentPageId)
            gbb.f.markPreviousNavigationItemsAsCompleted(navItem)
            gbb.gbbLandingPage.initialize(settings, parent)
            gbb.gbbLandingPage.f.registerEvents(settings)
            gbb.utility.renderTemporaryLoadingSpinner("hide")

            // gbb.gbbModel.init(settings)
        },
        initialize: function (settings, parent) {

            // gbb.utility.debugConsole("settings:",settings.giftwrap);

            // let {isEnabledOnProductPage, isEnabledOnCartPage} = gbb.gbbLandingPage.f.checkifGiftWrapEnabled(settings.giftwrap, productHandle, parent)
            // if (isEnabledOnProductPage) {
            let gbbLandingPageWrapper = gbb.$("<div>").addClass("gbbLandingPageWrapper");
            const gbbLandingPageHeaderHTML = gbb.gbbLandingPage.f.prepareHeader();
            const gbbLandingPageBodyHTML = gbb.gbbLandingPage.f.prepareUI();
            const gbbLandingPageFooterHTML = gbb.gbbLandingPage.f.prepareFooter();

            gbbLandingPageWrapper.append(gbbLandingPageHeaderHTML);
            gbbLandingPageWrapper.append(gbbLandingPageBodyHTML);
            gbbLandingPageWrapper.append(gbbLandingPageFooterHTML);

            gbb.$("body").attr("data-page", gbb.state.currentPageId)
            gbb.state.landingPageBody = gbbLandingPageWrapper;
            gbb.gbbLandingPage.f.insertIntoMainPageWrapper();
        },
        f: {

            prepareHeader: function () {
                //this is a header
                const gbbLandingPageHeaderHTML = gbb.$("<div>").addClass("gbbLandingPageHeader");
                // gbbLandingPageHeaderHTML.append("<div> <h1> Header Gift Box Builder</h1> </div>");
                // return gbbLandingPageHeaderHTML;
            },
            prepareUI: function () {

                let scrollPoisitionAfterPageChange = gbb.state.scrollPoisitionAfterPageChange;

                window.scrollTo(0, scrollPoisitionAfterPageChange);

                // window.scrollTo(0, 70);
                let gbbLandingPageHTML;

                //gbbLandingPageHTMLContent = create divs with classNams
                gbbLandingPageHTML = gbb.$("<div>").addClass("gbbLandingPageHTMLContent");
                //one image div, 2 text divs, 1 button div and one label div and 1 cards main div
                const landingPageBanner = gbb.$("<div>").addClass("gbbLandingPageBanner");
                //all the text and button goes in this div
                const landingPageBannerImage = gbb.$("<img>").addClass("gbbLandingPageBannerImage");
                const gbbLandingPageBannerTextWrapper = gbb.$("<div>").addClass("gbbLandingPageBannerTextWrapper");
                const landingPageBannerText = gbb.$("<div>").addClass("gbbLandingPageBannerText");
                //subtext
                const landingPageBannerSubText = gbb.$("<div>").addClass("gbbLandingPageBannerSubText");
                //create a button
                const gbbLandingPageBannerButtonWrapper = gbb.$("<div>").addClass("gbbLandingPageBannerButtonWrapper");
                // const gbbLandingPageBannerButton = gbb.$("<button>").addClass("landingPageBannerButton");
                const gbbLandingPageBannerButton = gbb.$("<div>").addClass("landingPageBannerButton");

                landingPageBannerImage.attr("src", gbb.settings.stepsConfigurationData.landingPageData.stepImage);


                landingPageBannerText.text(gbb.settings?.stepsConfigurationData?.landingPageData?.bannerText);
                landingPageBannerSubText.text(gbb.settings?.stepsConfigurationData?.landingPageData?.bannerSubtext);

                landingPageBannerText.css("color", gbb.settings.pageCustomizationData.landingPage.landingPageTextColor);
                landingPageBannerSubText.css("color", gbb.settings.pageCustomizationData.landingPage.landingPageTextColor);

                gbbLandingPageBannerButton.css("background", gbb.settings.pageCustomizationData.landingPage.landingPageButtonBgColor);
                gbbLandingPageBannerButton.css("color", gbb.settings.pageCustomizationData.landingPage.landingPageButtonTextColor);
                gbbLandingPageBannerButton.on("click", function () {
                    gbb.state.currentFlow = "byob";
                    //add params to url
                    gbb.f.addParamsToUrl("currentFlow", "byob")
                    gbb.giftboxbuilderPage.action.onNextNavigationBYOB()
                    // add pointer events none to none
                    // setTimeout(() => {
                    // gbb.utility.renderTemporaryLoadingSpinner();
                    // }, 100)
                    gbbLandingPageBannerButton.css("pointer-events", "none");
                    setTimeout(() => {
                        gbbLandingPageBannerButton.css("pointer-events", "auto");
                    }, 1000)

                    //gbb.gbbReviewPage.init(gbb.settings, "SUMMARY_PAGE")
                    //gbb.gbbAddProductsPage.init(gbb.settings, "ADD_PRODUCTS_PAGE");
                    //gbb.gbbAddProductsPage.f.insertIntoMainPageWrapper();
                });
                gbbLandingPageBannerButton.text(gbb.settings?.stepsConfigurationData?.landingPageData?.bannerButtonText);

                //gbbLandingPageBannerTextWrapper.append(landingPageBannerText);
                //gbbLandingPageBannerTextWrapper.append(landingPageBannerSubText);
                gbbLandingPageBannerButtonWrapper.append(gbbLandingPageBannerButton);
                //gbb.f.applyPrimaryColorCss(gbbLandingPageBannerButton);
                gbbLandingPageBannerTextWrapper.append(gbbLandingPageBannerButtonWrapper.clone());

                //Navigation items container
                const landingPageNavigationItemsContainer = gbb.$("<div>").addClass("gbbLandingPageNavigationItemsContainer");




                landingPageBanner.append(landingPageBannerImage);
                let nextNavigationItems = gbb.f.getNavigationItemsToDisplay(gbb.state.currentPageId);
                landingPageNavigationItemsContainer.append(gbb.f.renderNavigationHTML(landingPageNavigationItemsContainer, "landingPage", nextNavigationItems));




                gbbLandingPageHTML.append(landingPageBanner);
                gbbLandingPageHTML.append(landingPageBannerText);
                gbbLandingPageHTML.append(landingPageNavigationItemsContainer);
                gbbLandingPageHTML.append(gbbLandingPageBannerButtonWrapper);



                return gbbLandingPageHTML;

            },
            prepareFooter: function () {
                //this is a footer
                const gbbLandingPageFooterHTML = gbb.$("<div>").addClass("gbbLandingPageFooter");
                // gbbLandingPageFooterHTML.append("<div> <h1>Footer Gift Box Builder</h1> </div>");
                // return gbbLandingPageFooterHTML;
            },
            insertIntoMainPageWrapper: function () {

                gbb.$(".gbbBodyWrapper").html(gbb.state.landingPageBody);
                gbb.$(".gbbBodyWrapper").addClass(`bundle-${gbb.state.bundleId}`);
                gbb.$(".gbbBodyWrapper").children().first().hide();
                gbb.$(".gbbBodyWrapper").children().first().fadeIn(700);

            },
            registerEvents: function (settings) {
                gbb.gbbLandingPage.state.buildBoxButtonAction = function () {
                    gbb.utility.debugConsole("build box button clicked");
                    // window.alert("build box button clicked");
                };
            }

        },
        events: function (settings) {
        },
        action: {
        }
    },
    gbbAddProductsPage: {
        state: {
            buildBoxButtonAction: undefined,
            productPageKey: "",
            //TODO: @abhishek change it here
            fetchCountPerBatch: 24,
            fetchBatchStartIndex: 0,
            uniqueProductsData: [],
            currentProductsDataset: [],
            pagesWhichHaveConditionsOnPages: [],
            categoriesWhichHaveConditions: [],
            displayVariantsAsIndividualProducts: false,
            dataForInfiniteScroll: {
                noteAttribute: "",
                allProductsData: null,
                categoryId: "",
            },
            filterBySearch: {
                isSearchEnabled: false,
                searchQuery: {
                    searchField: 'title',
                    searchFieldType: String,
                    searchText: '',
                }
            },
            showBoxProductsInFooter: false,
            autoNextStepOnConditionMet: false,
            pagesWhichHaveExhaustedATCFooterAnimation: [],
            isAnimateFooterOnATCEnabled: false,
            lastClearedDiscountProgressBarValue: 0,
            totalProductSlotsRequired: 0,
            productSlotsCalculationData: [],
            isEveryConditionHaveTypeQuantity: null,
            incrementProductQtyBy: 1,
            decrementProductQtyBy: 1,
            // giftBoxData: null,
        },
        initPageX: async function (pageNumber, settings, parent) {
            // Construct the dynamic parts of the state based on the page number
            const pageId = `addProductsPage${pageNumber}`;
            const productPageKey = `productsData${pageNumber}`;
            const productsData = JSON.parse((JSON.stringify(gbb.settings.stepsConfigurationData[productPageKey])))

            if (true || pageId !== gbb.state.currentPageId) {
                gbb.gbbBrowser.emitCustomEvent({
                    eventName: "gbb-page-init",
                    detail: {
                        activePageId: pageId,
                        prevPageId: gbb.state.currentPageId,
                    }
                })
            }

            // Set the global state for the current page
            gbb.state.currentPageId = pageId;
            gbb.gbbMultipleCategoriesPage.state.currentCategoryId = undefined;
            gbb.gbbMultipleCategoriesPage.currentIndex = undefined;
            gbb.gbbAddProductsPage.state.productPageKey = productPageKey;
            gbb.gbbMultipleCategoriesPage.state.currentCategory = undefined;



            // Check if we need to use the filter logic or not
            let uniqueProductsData = productsData.uniqueProductsData;



            // get first page from the array of navigationItems.
            let navigationItems = [...gbb.state.navigationItems];


            let blackListedNavigationItems = ["landingPage", "reviewPage"];

            navigationItems = navigationItems.filter(function (item) {
                return !blackListedNavigationItems.includes(item.id);
            })


            let skipConditionalLogicFiltering = navigationItems[0].id == pageId || productsData?.skipConditionalLogicFiltering || gbb.settings.bundleSettings.conditionalLogicFilterOnFirstPageAswell || false;

            if (skipConditionalLogicFiltering == false) {
                if (productsData.pageType == "MULTIPLE_CATEGORY") {
                    let allCategoriesData = gbb.f.filterOutBasedOnConditionalLogic_MultipleCategories(productsData.categories)

                    productsData.categories = allCategoriesData;
                    // uniqueProductsData = gbb.f.filterOutBasedOnConditionalLogic(productsData.uniqueProductsData);
                } else {
                    // uniqueProductsData = productsData.uniqueProductsData; // Or some default value or logic
                    uniqueProductsData = gbb.f.filterOutBasedOnConditionalLogic(productsData.uniqueProductsData);
                }
            }


            gbb.gbbAddProductsPage.state.productPageData = productsData;
            gbb.gbbAddProductsPage.state.uniqueProductsData = uniqueProductsData;

            // reset search value
            gbb.gbbAddProductsPage.state.filterBySearch.isSearchEnabled = productsData?.filterBySearch?.isSearchEnabled || false
            gbb.gbbAddProductsPage.state.filterBySearch.searchQuery.searchFieldType = productsData?.filterBySearch?.searchFieldType || `String`
            gbb.gbbAddProductsPage.f.resetSearchTextValue()
            gbb.gbbAddProductsPage.state.dataForInfiniteScroll = {
                noteAttribute: undefined,
                allProductsData: undefined,
                categoryId: undefined,
            }
            if (gbb.settings?.app?.integrations?.judgeme?.isEnabled) {
                await gbb.gbbIntegrations?.judgeme?.init(uniqueProductsData)
            }
            gbb.gbbAddProductsPage.state.showBoxProductsInFooter = false
            // Initialize the page
            if (gbb.$("body").hasClass("gbbBodyOverflowHidden")) {  // when drawer is open and user navigates to another page in that case we will close the footer drawer
                gbb.$("body").removeClass("gbbBodyOverflowHidden")
                // gbb.$("body").css("overflow",DEFAULT_BODY_OVERFLOW_VALUE)
            }
            let bundleType = gbb.settings?.stepsConfigurationData?.bundleType || ''
            let isSubscriptionBundle = bundleType == 'SUBSCRIPTION_BUNDLE'
            if (isSubscriptionBundle) {
                let subscriptionBundlesData = gbb.settings?.stepsConfigurationData?.subscriptionBundlesData || {}
                gbb.gbbSubscriptionProductsPage.f.subscriptionBundlesInit(subscriptionBundlesData)
            }
            await gbb.gbbAddProductsPage.init(settings, parent);
            if (isSubscriptionBundle) {
                gbb.gbbSubscriptionProductsPage.f.autoScrollToActiveSellingPlanNavigation()
             }
        },
        initPage1: async function (settings, parent) {

            await gbb.gbbAddProductsPage.initPageX(1, settings, parent)
            // gbb.state.currentPageId = "addProductsPage1"
            // gbb.gbbAddProductsPage.state.productPageKey = "productsData1"
            // gbb.gbbAddProductsPage.state.productPageData = gbb.settings.stepsConfigurationData.productsData1
            // gbb.gbbAddProductsPage.state.uniqueProductsData = gbb.settings.stepsConfigurationData.productsData1.uniqueProductsData
            // await gbb.gbbAddProductsPage.init(settings, parent)
        },
        initPage2: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(2, settings, parent)
        },
        initPage3: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(3, settings, parent);
        },
        initPage4: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(4, settings, parent);
        },
        initPage5: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(5, settings, parent);
        },
        initPage6: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(6, settings, parent);
        },
        initPage7: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(7, settings, parent);
        },
        initPage8: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(8, settings, parent);
        },
        initPage9: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(9, settings, parent);
        },
        initPage10: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(10, settings, parent);
        },
        initPage11: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(11, settings, parent);
        },
        initPage12: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(12, settings, parent);
        },
        init: async function (settings, parent) {
            // gbb.utility.debugConsole("INSIDE INIT");
            //clear the dom reference for gbb
            // add the data-page attribute to it as well and attach it on body

            // let productsData = await gbb.utility.getFilteredSortedProductsData(gbb.gbbAddProductsPage.state.uniqueProductsData);
            gbb.gbbAddProductsPage.f.resetFiltersInfo();
            await gbb.utility.getGiftBoxProductsFromCart()
            gbb.gbbAddProductsPage.state.fetchBatchStartIndex = 0
            let navItem = gbb.utility.getNavItem(gbb.state.currentPageId)
            gbb.f.markPreviousNavigationItemsAsCompleted(navItem)
            gbb.$("body").attr("data-page", gbb.state.currentPageId)
            //documentation: gbb.gbbAddProductsPage.state.productPageKey can be productsData1,productsData2, productsData3
            gbb.utility.initializeFiltersInfo(gbb.gbbAddProductsPage.state.productPageKey);

            //documentation: currentPageId  - addProductsPage1, addProductsPage2, addProductsPage3, addProductsPage4
            gbb.utility.setSortByValues(gbb.state.currentPageId);
            gbb.gbbAddProductsPage.f.setMapForProductsThatHavePersonalization();

            await gbb.gbbAddProductsPage.initialize(settings, parent)
            gbb.gbbAddProductsPage.f.registerEvents(settings)
            gbb.utility.renderTemporaryLoadingSpinner("hide")

            gbb.state.setInfiniteScrollTrackerForProducts = true;

            // activate this only on scroll event of page
            if (gbb.settings.app.isInfiniteScrollEnabled) {
                gbb.$(window).on('scroll', gbb.gbbAddProductsPage.events.activateInfiniteScrollForProducts);
            }
        },


        initialFetch: async function (noteAttribute, productsData) {
            //the task of the page is to get uniqueProductsDat from gbb.settings.stepsConfiguration 
            // at a given time only gbb.addProductsPage.state.fetchCountPerBatch
            // and fetch them from shopify  using  getProductsBulk (helpfull methods are present in  gbb.utility)
            //  once fetched they should all be saved in currentPageSelectedProducts for the initFn to render
            let originalProductsData = [...productsData]
            gbb.gbbAddProductsPage.state.currentProductsDataset = [];
            let response;
            // gbb.utility.debugConsole('fetching...')

            //fetchCountPerBatch 24
            //0-24
            //
            let productsToFetch = null
            try {
                //splice and fetch products from uniqueProductsData from gbb.settings.stepsConfiguration
                productsToFetch = originalProductsData.slice(0, gbb.gbbAddProductsPage.state.fetchCountPerBatch)
            } catch (e) {
                gbb.utility.debugError(e)
            }
            if (productsToFetch) {
                let listOfHandles = productsToFetch.map((product) => product.handle);
                let listOfProductIds = productsToFetch.map((product) => product.productId);
                gbb.gbbAddProductsPage.state.fetchBatchStartIndex = gbb.gbbAddProductsPage.state.fetchCountPerBatch;

                //   TOOD: SF API conditional check
                let fetchOptions = { listOfProductIds }
                response = await gbb.utility.getProductsBulkForRelevantVariants(listOfHandles, productsToFetch, fetchOptions);



                // gbb.utility.debugConsole("fetched products", response)
                gbb.utility.setMapForVariantId(response);
                response = gbb.utility.convertObjectToArray(response);

                if (gbb.gbbAddProductsPage.state.displayVariantsAsIndividualProducts) {
                    //  products has something known as variants[];
                    // now duplicate entries if theres more than one variant.
                    //use a for loop
                    // function flattenVariants(products) {
                    const flattened = [];
                    response.forEach((product) => {

                        const { variants, ...productAttrs } = product; // Extract variants and keep the rest of the product attributes

                        variants.forEach((variant) => {
                            let merged = { ...productAttrs, compare_at_price: variant.compare_at_price, variants: [variant] }; // Merge product attributes with variant attributes
                            merged = gbb.gbbAddProductsPage.f.updateProductDataWithFirstVariantData(merged)
                            flattened.push(merged);
                        });
                    });
                    response = flattened;
                    // return flattened;
                    // }
                }
            }
            if (response) {
                return response;
            }
        },

        fetchNextProductsBatch: async function (noteAttribute, allProductsData) {
            try {
                let dataFromDB;
                let resp;
                // let currentCount = gbb.gbbAddProductsPage.state.currentProductsDataset.length
                let currentCount = gbb.gbbAddProductsPage.state.fetchBatchStartIndex;

                //: remove this switch case and put just uniqueProductsData state as dependency
                dataFromDB = allProductsData;

                // if(gbb.state.addProductsFilters.activatedFilters.length>0){
                //     dataFromDB = gbb.state.currentFilteredProducts
                // }

                let productsToFetch = null;
                try {
                    productsToFetch = dataFromDB.slice(currentCount, currentCount + gbb.gbbAddProductsPage.state.fetchCountPerBatch);
                } catch (e) {
                    gbb.utility.debugError(e);
                }
                if (productsToFetch) {
                    // gbb.utility.debugConsole("products to fetch,", productsToFetch)
                    let listOfHandles = productsToFetch.map((product) => product.handle);
                    let listOfProductIds = productsToFetch.map((product) => product.productId);
                    gbb.gbbAddProductsPage.state.fetchBatchStartIndex = gbb.gbbAddProductsPage.state.fetchBatchStartIndex + gbb.gbbAddProductsPage.state.fetchCountPerBatch;
                    let fetchOptions = { listOfProductIds }

                    resp = await gbb.utility.getProductsBulkForRelevantVariants(listOfHandles, productsToFetch, fetchOptions);
                    gbb.utility.debugConsole("fetched products");
                    resp = gbb.utility.convertObjectToArray(resp);
                    gbb.utility.setMapForVariantId(resp);
                    if (gbb.gbbAddProductsPage.state.displayVariantsAsIndividualProducts) {
                        //  products has something known as variants[];
                        // now duplicate entries if theres more than one variant.
                        //use a for loop
                        // function flattenVariants(products) {
                        const flattened = [];
                        resp.forEach((product) => {
                            const { variants, ...productAttrs } = product; // Extract variants and keep the rest of the product attributes

                            variants.forEach((variant) => {
                                let merged = { ...productAttrs, variants: [variant] }; // Merge product attributes with variant attributes
                                merged = gbb.gbbAddProductsPage.f.updateProductDataWithFirstVariantData(merged);
                                flattened.push(merged);
                            });
                        });
                        resp = flattened;
                        // return flattened;
                        // }
                    }

                    //addProductsPage1Data is now currentProducts
                    gbb.gbbAddProductsPage.state.currentProductsDataset = [...gbb.gbbAddProductsPage.state.currentProductsDataset, ...resp];
                }
                // gbb.utility.debugConsole(currentCount, "/", dataFromDB.length)
                if (dataFromDB.length > currentCount) {
                    //activateLoadMore Button
                    // gbb.gbbAddProductsPage.f.activateLoadMoreButton(noteAttribute);
                } else {
                    // gbb.gbbAddProductsPage.f.deactivateLoadMoreButton()
                    gbb.gbbAddProductsPage.f.hideLoadMoreButton();
                }
                return resp;
            } catch (e) {
                gbb.utility.debugError(e);
            }
        },
        updatePageStatus: function () {
            // check the currentPageId



            const listOfPageIds = ADDPRODUCT_PAGES_LIST

            if (listOfPageIds.includes(gbb.state.currentPageId) == false) {
                return;
            }
            let navItem = gbb.f.getNavItem(gbb.state.currentPageId);
            if (navItem) {
                // navItem.addClass("gbbNavItemActive");
                navItem.isCompleted = true;
                navItem.isActive = false

                //if cart items have the values, then mark complete, else mark incomplete
            }

            //update the navigationItems  by filtering the array gbb.state.navigationItems using id
            gbb.state.navigationItems.forEach(function (item) {
                if (item.id == gbb.state.currentPageId) {
                    item = {
                        ...item,
                        navItem
                    }
                }
            })
            return true;

            // if it is addProductsPage, then find the item in the navigation list
            // and set the class to active
            // else set the class to inactive

        },
        initialize: async function (settings, parent) {
            try {
                let productPageData = gbb.gbbAddProductsPage.state.productPageData
                let isTabBasedUIEnabled = gbb.gbbAddProductsPage.state.productPageData?.isMultiCategoryTabBasedUIEnabled || false;
                gbb.gbbAddProductsPage.state.displayVariantsAsIndividualProducts = productPageData.displayVariantsAsIndividualProducts || false

                if (gbb.$(".gbbAddGiftBoxPageWrapper") && gbb.$(".gbbAddGiftBoxPageWrapper").length > 0) {
                    gbb.$(".gbbAddGiftBoxPageWrapper").remove();
                }
                let gbbAddProductsPageWrapper = gbb.$("<div>").addClass("gbbAddGiftBoxPageWrapper");

                let gbbAddProductsPageBodyHTML = ""

                if (productPageData?.pageType == "MULTIPLE_CATEGORY") {
                    if (isTabBasedUIEnabled) {
                        gbbAddProductsPageBodyHTML = await gbb.gbbMultipleCategoriesPage.f.prepareUIV2TabUI(productPageData)
                    } else {
                        gbbAddProductsPageBodyHTML = await gbb.gbbMultipleCategoriesPage.f.prepareUIV2(productPageData)
                    }
                } else {
                    gbbAddProductsPageBodyHTML = await gbb.gbbAddProductsPage.f.prepareUI();
                }





                const gbbAddProductPageSubtextWrapper = gbb.$("<div>").addClass("gbbAddProductPageSubtextWrapper");
                const gbbAddProductPageSubtext = gbb.$("<div>").addClass("gbbAddProductPageSubtext");
                const gbbDiscountComponent = gbb.$("<div>").addClass("gbbDiscountComponent");
                const gbbAddProductPageBanners = gbb.$("<div>").addClass("gbbAddProductPageBanners")


                gbbAddProductPageSubtext.html(productPageData?.productPageSubtext);
                gbbAddProductPageSubtext.css("color", gbb.settings?.pageCustomizationData?.generalSettings?.productPage?.productPageTitleColor || "black");


                if (productPageData?.pageBanners) {
                    if (productPageData.pageBanners?.mobileBanner) {
                        let mobileBanner = gbb.$("<img>").addClass("gbbMobileImageBanner")
                        mobileBanner.attr('src', productPageData.pageBanners?.mobileBanner)
                        gbbAddProductPageBanners.append(mobileBanner);
                    }
                    if (productPageData.pageBanners?.desktopBanner) {
                        let desktopBanner = gbb.$("<img>").addClass("gbbDesktopImageBanner")
                        desktopBanner.attr('src', productPageData.pageBanners?.desktopBanner)
                        gbbAddProductPageBanners.append(desktopBanner);
                    }
                }

                gbbAddProductPageSubtextWrapper.append(gbbAddProductPageSubtext);
                gbbAddProductPageSubtextWrapper.append(gbbAddProductPageBanners);
                const gbbAddProductsPageFooterHTML = gbb.gbbAddProductsPage.f.prepareFooter();
                const gbbAddProductsPageHeaderHTML = gbb.gbbAddProductsPage.f.prepareHeader();

                // if(isTabBasedUIEnabled){
                //     gbbAddProductsPageFooterHTML.addClass("tabBasedUIFooter");
                // }


                gbbAddProductsPageFooterHTML.css("background", gbb.settings.pageCustomizationData.cartFooter.cartFooterBgColor)
                gbbAddProductsPageFooterHTML.css("color", gbb.settings.pageCustomizationData.cartFooter.cartFooterTextColor)


                gbbAddProductsPageWrapper.append(gbbAddProductsPageHeaderHTML);
                gbbAddProductsPageWrapper.append(gbbAddProductPageSubtextWrapper);
                gbbAddProductsPageWrapper.append(gbbDiscountComponent);

                // ask ashfaq
                // if(isTabBasedUIEnabled){
                //     gbbAddProductsPageBodyHTML.append(gbbAddProductsPageFooterHTML);
                //     gbbAddProductsPageWrapper.append(gbbAddProductsPageBodyHTML);
                // }else{
                gbbAddProductsPageWrapper.append(gbbAddProductsPageBodyHTML);
                gbbAddProductsPageWrapper.append(gbbAddProductsPageFooterHTML);
                // }


                gbb.state.addProductsBody = gbbAddProductsPageWrapper;
                gbb.gbbAddProductsPage.f.insertIntoMainPageWrapper();
            } catch (e) {
                gbb.utility.debugConsole("error in gbbAddProductsPage init", e)
            }
        },
        f: {

            prepareHeader: function () {
                //this is a header
                let bundleType = gbb.settings?.stepsConfigurationData?.bundleType || '';
                let isSubscriptionBundle = bundleType == 'SUBSCRIPTION_BUNDLE'
                const gbbAddProductsPageHeaderHTML = gbb.$("<div>").addClass("gbbAddProductsPageHeader");
                let gbbPageHeader = gbb.$("<div>").addClass("gbbPageHeader");
                let gbbPageHeaderText = gbb.$("<div>").addClass("gbbPageHeaderText");
                gbbPageHeaderText.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.landingPage.bannerText));

                let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
                let currentPage = gbb.state.currentPageId;

                const gbbAddProductsPageBannerImage = gbb.$("<img>").addClass("gbbPageBannerImage");
                gbbAddProductsPageBannerImage.attr("src", gbb.settings.pageCustomizationData.banners.pageBannerImageSrc)
                let navigationItems = gbb.state.navigationItems;
                let stepsCount = 0;
                navigationItems = navigationItems.filter((element) => {
                    if (element.isNavBarItem && element.isNavBarItem == true) {
                        stepsCount++;
                        return element;
                    }
                })
                if (stepsCount == 1) {
                    gbbPageHeader.addClass("gbbPageHeaderWithoutLine");
                }
                const gbbAddProductsPageNavigationContainer = gbb.$("<div>").addClass("gbbAddProductsPageNavigationContainer");
                //gbbPageHeader.append(gbbPageHeaderText);

                let nextNavigationItems = gbb.f.getNavigationItemsToDisplay(gbb.state.currentPageId);

                gbbAddProductsPageNavigationContainer.append(gbb.f.renderNavigationHTML(gbbAddProductsPageNavigationContainer, currentPage, nextNavigationItems));

                // STEP PROGRESS BAR

                gbbAddProductsPageHeaderHTML.append(gbbPageHeader);
                if (isSubscriptionBundle) {
                    let subscriptionBundleWrapper = gbb.gbbSubscriptionProductsPage.f.prepareSubscriptionHeaderHTML()
                    gbbAddProductsPageHeaderHTML.append(subscriptionBundleWrapper)
                }
                gbbAddProductsPageHeaderHTML.append(gbbAddProductsPageNavigationContainer)
                return gbbAddProductsPageHeaderHTML;
            },
            prepareUI: async function () {
                let gbbAddProductsPageHTML = gbb.$("<div>").addClass("gbbAddProductsPageHTML");
                let noteAttribute = gbb.state.currentPageId;
                gbb.utility.setSortByValues(noteAttribute, "featured");

                productsData = gbb.utility.getProductsInDefaultView()
                gbbAddProductsPageHTML.append(await gbb.gbbAddProductsPage.f.renderProductsCardContainer(productsData, noteAttribute, "initFlow"));

                //no navigation will be available if there is only one step enabled - adjust the positioning
                let navigationItems = gbb.state.navigationItems;
                let stepsCount = 0;
                navigationItems = navigationItems.filter((element) => {
                    if (element.isNavBarItem && element.isNavBarItem == true) {
                        stepsCount++;
                        return element;
                    }
                })

                return gbbAddProductsPageHTML;
            },
            prepareFooter: function () {
                const gbbAddProductsPageFooterHTML = gbb.$("<div>").addClass("gbbAddProductsPageFooterHTML");
                let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
                const currentPage = gbb.state.currentPageId
                gbbAddProductsPageFooterHTML.append(gbb.f.renderCartProductsFooterHTML(currentPage));
                return gbbAddProductsPageFooterHTML;
            },
            prepare_and_updateProductsCardContainerHTML: async function ({ allProductsData, noteAttribute, origin, categoryId }) {
                try {
                    let gbbAddProductsContainerHTML
                    let gbbProductsContainer
                    gbb.gbbAddProductsPage.f.setMapForProductsThatHavePersonalization({ categoryId: categoryId });
                    if (origin == "initFlow") {
                        gbbAddProductsContainerHTML = gbb.$("<div>").addClass("gbbAddProductsContainerHTML");
                    } else {
                        gbbAddProductsContainerHTML = gbb.utility.getCurrentPageHTML(noteAttribute);
                    }

                    let productsDataFirstBatch = await gbb.gbbAddProductsPage.initialFetch(noteAttribute, allProductsData);

                    gbb.gbbAddProductsPage.state.currentProductsDataset = productsDataFirstBatch;


                    let parentProductsContainerSelector = categoryId ? '.gbbMultipleCategoryBody' : '.gbbAddProductsContainerHTML'
                    let isProductContainerExists = gbb.$(parentProductsContainerSelector).find('.gbbProductsContainer').length > 0;
                    let productsCardHTML = gbb.f.renderProductsHTML(productsDataFirstBatch, noteAttribute, categoryId);
                    let gbbProductsItemsContainer = gbb.$("<div>").addClass("gbbProductsItemsContainer");
                    if (isProductContainerExists) {
                        gbbProductsContainer = gbb.$(".gbbProductsContainer");
                        // gbbProductsItemsContainer = gbbProductsItemsContainer.html(productsCardHTML);
                        gbbProductsItemsContainer.html(productsCardHTML);
                        gbbProductsContainer.html(gbbProductsItemsContainer)
                    } else {
                        gbbProductsContainer = gbb.$("<div>").addClass("gbbProductsContainer");

                        gbbProductsItemsContainer.append(productsCardHTML);
                        gbbProductsContainer.append(gbbProductsItemsContainer);
                    }
                    if (productsCardHTML && productsCardHTML.length <= 4) {
                        gbbProductsItemsContainer.addClass("gbbProductsItemsContainerLessProducts");
                    }
                    gbbProductsItemsContainer.attr('total-products', productsCardHTML?.length || 0)
                    // add no products available card
                    if (productsDataFirstBatch.length <= 0 && noteAttribute !== 'reviewPage') {

                        const gbbProductsNotAvailable = gbb.$("<div>").addClass("gbbProductsNotAvailable");
                        gbbProductsNotAvailable.text(gbb.utility.renderLanguageValue(gbb.settings.languageData.general.noProductsAvailable) || 'No Products Found1');

                        //replace gbbProductsNotAvailable class if available
                        if (gbb.$(".gbbProductsNotAvailable").length > 0) {
                            gbb.$(".gbbProductsNotAvailable").replaceWith(gbbProductsNotAvailable);
                        } else {
                            gbbProductsContainer.append(gbbProductsNotAvailable);
                        }
                    }

                    return {
                        gbbAddProductsContainerHTML,
                        gbbProductsContainer,
                    }
                } catch (error) {
                    gbb.utility.debugConsole("error in prepare_and_updateProductsCardContainerHTML", error)

                }

            },
            renderProductsCardContainer: async function (allProductsData, noteAttribute, origin, categoryId) {
                try {
                    let divsArray = [];
                    let { gbbAddProductsContainerHTML, gbbProductsContainer } = await gbb.gbbAddProductsPage.f.prepare_and_updateProductsCardContainerHTML({ allProductsData, noteAttribute, origin, categoryId });

                    let gbbProductsFilterTags = gbb.utility.getAllFilterTagsForProducts(allProductsData, noteAttribute);
                    if (origin == 'initFlow' || !origin) {
                        if (!categoryId) {
                            let filterSearchHeaderHTML = gbb.f.renderFiltersSearchSortHeaderHTML(noteAttribute);
                            divsArray.push(filterSearchHeaderHTML)
                        }
                        divsArray.push(gbbProductsContainer);
                        gbbAddProductsContainerHTML.html(divsArray);
                    } else if (origin == 'filtersFlow') {
                        let filterSearchHeaderHTML = gbb.f.renderFiltersSearchSortHeaderHTML(noteAttribute);
                        gbb.$('.gbbFiltersSearchSortHeader').replaceWith(filterSearchHeaderHTML);
                    }
                    const isLoadMoreButtonRequired = allProductsData.length > gbb.gbbAddProductsPage.state.fetchBatchStartIndex
                    //showLoadMoreButton needed
                    if (isLoadMoreButtonRequired) {
                        origin = origin == 'filtersFlow' ? 'resetLoadMoreRef' : origin;
                        gbb.gbbAddProductsPage.f.activateLoadMoreButton(noteAttribute, gbbAddProductsContainerHTML, allProductsData, categoryId, origin);
                    } else {
                        gbb.gbbAddProductsPage.f.hideLoadMoreButton();
                    }

                    return gbbAddProductsContainerHTML;
                } catch (error) {
                    gbb.utility.debugConsole("error in renderProductsCardContainer", error)
                }
            },
            insertIntoMainPageWrapper: function () {

                gbb.$(".gbbBodyWrapper").html(gbb.state.addProductsBody);
                //find the first child of gbbBodyWrapper and hide it in ui for 700ms
                gbb.$(".gbbBodyWrapper").children().first().hide();
                gbb.$(".gbbBodyWrapper").children().first().fadeIn(700);

                //gbb.$(".gbbNavigationItemsContainer").replaceWith(gbb.f.renderNavigationHTML())
            },
            updateProductCard: function (productId, variantId) {

                let productItem = gbb.$(".gbbProductsContainer").find(`[productId='${productId}']`);

                // now filter based on firstvariantid as well 
                if (variantId) {
                    let productItem_temp = gbb.$(".gbbProductsContainer").find(`[productId='${productId}'][firstvariantid='${variantId}']`);
                    // gbb.utility.debugConsole("productItems array length",productItem.length)
                    // productItem = 
                    if (productItem_temp.length > 0) {
                        productItem = productItem_temp;
                    }

                    // productItem = gbb.$(".gbbProductsContainer").find(``);
                }
                let categoryId = (productItem).parents(".gbbCategoryContainer").attr("categoryid");
                let product = gbb.utility.getProductDetailsFromState(productId, variantId);

                let noteAttribute = gbb.state.currentPageId;

                let newProductItemHTML = gbb.f.renderProductsHTML([product], noteAttribute, categoryId);
                // gbb.$(".gbbPageBody").find(`[productId='${productId}']`).replaceWith(newProductItemHTML);
                productItem.replaceWith(newProductItemHTML);

            },
            resetFiltersInfo: function () {
                // gbb.state.addProductsFilters.isFiltersActive
                // gbb.state.addProductsFilters.activatedFilters
                // gbb.state.addProductsFilters.priceFilterActive
                // gbb.state.addProductsFilters.addProductsActivatedFilters;
                gbb.state.addProductsFilters = {
                    isFiltersActive: false,
                    activatedFilters: [],
                    priceFilterActive: false,
                    addProductsActivatedFilters: []
                }

            },
            resetSearchTextValue: function () {
                gbb.gbbAddProductsPage.state.filterBySearch.searchQuery.searchText = '';
            },
            hideExcessProducts: function (gbbAddProductsContainerHTML) {
                let productsCount = gbbAddProductsContainerHTML.find(".gbbProductItem").length;
                if (productsCount > (gbb.gbbAddProductsPage.state.fetchCountPerBatch)) {
                    gbbAddProductsContainerHTML.find(".gbbProductItem").each(function (index) {
                        if (index >= (gbb.gbbAddProductsPage.state.fetchCountPerBatch)) {
                            gbb.$(this).hide();
                        }
                    })
                    // commenting out (no use case for this as of now)
                    // gbb.gbbAddProductsPage.f.activateLoadMoreButton();
                }
            },
            loadMoreProducts: async function (noteAttribute, allProductsData, categoryId) {

                // gbb.utility.debugConsole("")

                if (categoryId) {
                    gbb.utility.debugConsole("fetching products from category: ", categoryId)
                }
                let productItemsHTML = gbb.$(".gbbProductItem")
                //find the productItems that are not hidden
                let currentProductItems = gbb.gbbAddProductsPage.state.currentProductsDataset;


                let productsCount = currentProductItems.length;
                let productsToShow = gbb.gbbAddProductsPage.state.fetchCountPerBatch;
                //: this condition is not in shape
                if (true) {

                    let startIndex = productsCount - 1;
                    gbb.utility.debugConsole("fetching starts.. in loadMoreProducts")
                    const productsData = await gbb.gbbAddProductsPage.fetchNextProductsBatch(noteAttribute, allProductsData)
                    if (productsData && productsData.length > 0) {
                        let productItems = gbb.f.renderProductsHTML(productsData, noteAttribute, categoryId);
                        if (productItems && productItems.length > 0) {
                            gbb.$(".gbbProductsItemsContainer").append(productItems);
                        }
                    }

                    //append product items to the container

                    let dbDataCount = allProductsData.length
                    let fetchBatchStartIndex = gbb.gbbAddProductsPage.state.fetchBatchStartIndex
                    if (fetchBatchStartIndex >= dbDataCount) {
                        //scrollBarListener is disabled
                        gbb.utility.debugConsole("scrollBarListener is disabled from loadMoreProductsFn:")
                        gbb.state.setInfiniteScrollTrackerForProducts = false;
                        gbb.$(".gbbLoadMoreProductsButton").hide();
                    }
                }
            },
            activateLoadMoreButton: function (noteAttribute, parentEle, allProductsData, categoryId, origin) {

                // if already present
                if (origin == 'resetLoadMoreRef' || gbb.gbbAddProductsPage.state.filterBySearch?.searchQuery?.searchText?.length > 0) {
                    // continue processing
                }
                else if (!categoryId) {
                    if (gbb.$(".gbbLoadMoreProductsButton").length > 0) {
                        // alert("already found load more btuton")
                        return;
                    }
                }

                let attachButtonTo = parentEle || gbb.$(".gbbLoadMoreProductsButton").parent();
                gbb.gbbAddProductsPage.state.dataForInfiniteScroll = {
                    noteAttribute: noteAttribute,
                    allProductsData: allProductsData,
                    categoryId: categoryId
                }

                let loadMoreButton = gbb.$("<div>").addClass("gbbLoadMoreProductsButton");
                loadMoreButton.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.loadMoreProductsButtonText) || "Load More Products1");
                loadMoreButton.on("click", async function () {
                    gbb.utility.disableElement(loadMoreButton, 500);
                    await gbb.gbbAddProductsPage.f.loadMoreProducts(noteAttribute, allProductsData, categoryId);
                })
                // if (gbb.$(".gbbLoadMoreProductsButton").length <= 0) {
                //     gbb.$(attachButtonTo).append(loadMoreButton);
                // } else {
                //     let loadMoreBtn = gbb.$(".gbbLoadMoreProductsButton")
                //     loadMoreBtn.text('REPLACED')
                //     loadMoreBtn.replaceWith(loadMoreButton)
                // } In multicategory we were updating dom -> then we were updating parentEle container -> here we were loosing load more btn ref
                if (gbb.$(".gbbLoadMoreProductsButton").length > 0) {
                    gbb.$(".gbbLoadMoreProductsButton").remove()
                }
                gbb.$(attachButtonTo).append(loadMoreButton);

                return loadMoreButton

            },
            hideLoadMoreButton: function () {
                //scrollBarListener is disabled
                gbb.utility.debugConsole("scrollBarListener is disabled from hideLoadMoreButton:")
                gbb.state.setInfiniteScrollTrackerForProducts = false;
                gbb.$(".gbbLoadMoreProductsButton").hide();
            },
            registerEvents: function (settings) {
                gbb.gbbAddProductsPage.state.buildBoxButtonAction = function () {
                    gbb.utility.debugConsole("build box button clicked");
                };
            },
            renderNextPage: async function (pageId) {
               try {
                   let noteAttribute = gbb.state.currentPageId
                   let currentPageRank = gbb.utility.getPageRankByPageId(noteAttribute)
                   let pageToRenderRank = gbb.utility.getPageRankByPageId(pageId)
                   let renderPrevStep = pageToRenderRank < currentPageRank
                   let condition = !renderPrevStep && await gbb.utility.checkConditionsOnNext(noteAttribute, "", true);
                   if (renderPrevStep || condition.isConditionMet) {
                       gbb.utility.renderTemporaryLoadingSpinner("show")
                       gbb.giftboxbuilderPage.action.onNextNavigationBYOB(pageId);
                   }
               } catch (error) {
                    gbb.utility.debugConsole("error in renderNextPage", error)
               }
            },
            createArraysOfPageWhichHaveConditions: function () {

                // each of these fields has an array of conditions, if empty then check if they have an object with key as "categories"
                // if they have an object with key as "categories" then check if the objects keys have a conditions array
                // if they have a conditions array then check if the conditions array is empty
                // if not empty then copy the category id and push to the array 
                let pagesWhichHaveConditionsOnPages = [];
                let pagesWhichHaveConditionOnCategories = [];
                let categoriesWhichHaveConditions = [];

                // so in gbb.settings.stepsConfigurationData
                // there are fields such as productsData1 ...... till 12.
                for (let i = 0; i < Object.keys(gbb.settings.stepsConfigurationData).length; i++) {
                    // object keys are productsData1, productsData2, productsData3, productsData4, productsData5, productsData6, productsData7, productsData8, productsData9, productsData10, productsData11, productsData12
                    // so we are looping through each of these keys
                    let _key = Object.keys(gbb.settings.stepsConfigurationData)[i];
                    let currData = gbb.settings.stepsConfigurationData[_key];
                    _key = String(_key)
                    if (_key.includes("productsData")) {
                        //now check if the productsData has a conditions array
                        if (currData?.conditions?.length > 0) {
                            // if it has a conditions array then push the page name to the pagesWhichHaveConditionsOnPages array
                            pagesWhichHaveConditionsOnPages.push(_key);
                        } else {
                            // currData
                            //check if the productsData has a categories object
                            if (currData?.categories) {
                                // if it has a categories object then loop through the categories object
                                for (let [key, value] of Object.entries(currData.categories)) {
                                    // if the categories object has a conditions array then push the page name to the pagesWhichHaveConditionOnCategories array
                                    if (value?.conditions?.length > 0) {
                                        pagesWhichHaveConditionOnCategories.push(_key);
                                        categoriesWhichHaveConditions.push(key);
                                    }
                                }
                            }
                        }
                    }
                }

                // now we have an array of pages which have conditions on pages and pages which have conditions on categories
                // we also have an array of categories which have conditions
                // now we need to check if the current product has any of the categories which have conditions
                // if it does then we need to check if the current product has any of the conditions

                // in the pagesWhichHaveCondtionOnCategories array we have the page names. change the page number from productsData1 to addProductsPage1
                // and similarly

                pagesWhichHaveConditionsOnPages.forEach((page, index) => {
                    pagesWhichHaveConditionsOnPages[index] = page.replace("productsData", "addProductsPage");
                })

                gbb.gbbAddProductsPage.state.pagesWhichHaveConditionsOnPages = pagesWhichHaveConditionsOnPages;
                gbb.gbbAddProductsPage.state.categoriesWhichHaveConditions = categoriesWhichHaveConditions;

            },
            setMapForProductsThatHavePersonalization: function (options = {}) {
                try {
                    let map = {};
                    let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey;
                    let currentProductsData = JSON.parse(JSON.stringify(gbb.settings.stepsConfigurationData[keyAttribute]));
                    let categoryProductsData;

                    if (currentProductsData && currentProductsData.pageType == "MULTIPLE_CATEGORY") {
                        // gbb.utility.debugConsole("multiple category page")
                        //create a map for each
                        //object.keys(currentProductsData.categories).forEach((category) => {

                        let categoryIds = Object.keys(currentProductsData.categories);

                        options.categoryId = options.categoryId || currentProductsData?.categories[categoryIds[0]]?.categoryId;
                        categoryProductsData = currentProductsData.categories[options.categoryId];

                        currentProductsData = categoryProductsData;
                    }
                    let productFormData = currentProductsData.productPersonalization;
                    if (productFormData && productFormData.isProductPersonalizationEnabled == true) {
                        if (productFormData?.isEnabledForSelectedProducts == true) {
                            productFormData.selectedProducts.forEach((product) => {
                                map[product.productId] = { formBlocks: productFormData.formBlocks };
                            });
                        } else if (productFormData?.isEnabledForAllProducts == true) {
                            // create a map out of  this data but select only productId
                            currentProductsData.uniqueProductsData.forEach((product) => {
                                map[product.productId] = { formBlocks: productFormData.formBlocks };
                            });
                        } else {
                            // none; no map needed
                        }

                        gbb.gbbAddProductsPage.state.productPersonalizationData = productFormData;
                        gbb.gbbAddProductsPage.state.productPersonalizationMap = map;
                    } else {
                        gbb.gbbAddProductsPage.state.productPersonalizationData = null;
                        gbb.gbbAddProductsPage.state.productPersonalizationMap = null;
                    }
                } catch (error) {
                    gbb.utility.debugConsole("error in setMapForProductsThatHavePersonalization", error);
                }
            },
            updateProductDataWithFirstVariantData: function (productData) {
                try {
                    let firstVariantData = productData.variants[0];
                    // productData.title = firstVariantData.name || productData.title;
                    productData.title = productData.title;
                    productData.variantName = firstVariantData.public_title == "Default Title" ? "" : firstVariantData.public_title;
                    productData.renderChooseOptionsButton_forcefully = false
                    productData.featured_image = firstVariantData.image || productData.featured_image;
                    // push the firstVariantData.image into the product.images. but the firstVariantData.image should be the first element
                    productData.images = [firstVariantData.image, ...productData.images];
                    if (gbb?.settings?.bundleSettings?.removeUnUsedVariantImages) {
                        productData = gbb.utility.removeUnUsedVariantImages(productData)
                    }
                    productData = gbb.utility.shiftFirstVariantMedia_toFirstIndexInMediaObj(productData);
                    //find the "https://cdn.shopify.com/s/files/1/0603/6874/8751/products/Candle_UH_Back.png?v=1639895559"
                    // in the 
                    // productData.media = [... new Set(firstVariantData.featured_image, ...productData.media)]
                    return productData;
                } catch (error) {
                    gbb.utility.debugConsole("error in updateProductDataWithFirstfirstVariantDataData", error)
                }
            },
            handleAutoNextStep: async function (options) {
                try {
                    // return;
                    // let conditionRules = options.condition.conditions;
                    // let condition = options.condition;
                    let currentPageId = gbb.state.currentPageId;
                    // 

                    let activeConditionConfig = gbb.gbbAddProductsPage.f.getConditionConfig_basedOnCurrentPageOrCategory(gbb.state.currentPageId);

                    let validConditionTypesForAutoNext = ["equalTo"]

                    let conditionRules = activeConditionConfig.conditions;

                    if (conditionRules && conditionRules.length > 0 && conditionRules.length == 1
                        && validConditionTypesForAutoNext.includes(conditionRules[0].condition)
                        && activeConditionConfig.autoNextStepOnConditionMet == true) {
                        await gbb.utility.checkConditionsAndProceedToNextPage(currentPageId);
                    }


                } catch (error) {
                    gbb.utility.debugConsole("error in handleAutoNextStep", error)
                }
            },
            getConditionConfig_basedOnCurrentPageOrCategory: function (pageId) {
                try {
                    // from active pageId, get if its a productPageData 
                    let currentPageData = gbb.gbbAddProductsPage.state.productPageData;
                    let result = {
                        conditions: [],
                        autoNextStepOnConditionMet: false
                    }
                    if (!currentPageData) {
                        return result
                    }
                    //give priorty to global config conditions
                    if (currentPageData.conditions && currentPageData.conditions.length > 0) {
                        //if present then return the conditions
                        result.conditions = currentPageData.conditions;
                        result.autoNextStepOnConditionMet = currentPageData.autoNextStepOnConditionMet;
                    }

                    if (currentPageData.pageType == "MULTIPLE_CATEGORY" && gbb.gbbAddProductsPage.state.productPageData.isPageConditionsEnabled != true) {
                        // get active category id
                        let currentCategoryId = gbb.gbbMultipleCategoriesPage.state.currentCategoryId;

                        // get conditions for the currentCategoryId
                        let categoryData = currentPageData.categories[currentCategoryId];
                        if (categoryData.conditions && categoryData.conditions.length > 0) {
                            result.conditions = categoryData.conditions;
                        }

                        result.autoNextStepOnConditionMet = categoryData.autoNextStepOnConditionMet;

                    }

                    return result;
                    //if MULTIPLE_CATEGORY then 
                    // get the currentCategoryId. 
                } catch (error) {
                    gbb.utility.debugConsole("error in getConditionConfig_basedOnCurrentPageOrCategory", error)
                }
            },
            prepareHTMLforProductMetafields: function (productData,origin) {
                try {
                    const metafieldNameSpaceAndKeys = gbb.settings.bundleSettings.metafieldNameSpaceAndKeys || []
                   
                    if (!metafieldNameSpaceAndKeys.length) return ''
                    // filter origin 
                    let metafieldWrapper = gbb.$("<div>").addClass('productsMetafieldWrapper')
                    const validMetafieldTypes = ["single_line_text_field","multi_line_text_field"] //only allow the type whose value we can get root level -- for eg : metafield.value 
                    for (let i = 0; i < metafieldNameSpaceAndKeys.length; i++){
                        let metafieldData = metafieldNameSpaceAndKeys[i]
                        if (metafieldData.hasOwnProperty("showOnProductCard") || metafieldData.hasOwnProperty("showOnModal")) { 
                            if (origin == 'PRODUCT_CARD' && !metafieldData.showOnProductCard) {
                                continue
                            }
                            else if (origin == 'PRODUCT_VARIANTS_MODAL' && !metafieldData.showOnModal) {
                                continue
                            } 
                        }
                        let productMetafieldAccessKey = `metafield_${metafieldData?.namespace}_${metafieldData?.key}`
                        let productMetafieldData = productData[productMetafieldAccessKey] || {}
                        if (validMetafieldTypes.includes(productMetafieldData?.type)) {
                            let divToAppend = gbb.$('<div>').addClass(`product_metafield_${metafieldData?.key}`).attr('metafield-key', metafieldData?.key)
                            divToAppend.text(productMetafieldData?.value)
                            metafieldWrapper.append(divToAppend)
                        }
                    }
                    return metafieldWrapper;
                } catch (error) {   
                    gbb.utility.debugConsole("error in prepareHTMLforProductMetafields", error)
                }
            },
            renderProductDynamicContent: function (productData,origin) {
                try {
                    // the value will be present in 
                    // let content = `<div>
                    //  ${productData?.metafield_gbbNameSpace_test?.value}
                    // </div>`
                    if(gbb.settings.app.dynamicScriptForHTMLContent){
                        return eval(gbb.settings.app.dynamicScriptForHTMLContent)
                    } else {
                        return gbb.gbbAddProductsPage.f.prepareHTMLforProductMetafields(productData,origin)
                    }
                   
                    // prodCard
                    // popup 
                    // dono dikhao
                    
                    // return content;
                    // return eval(gbb.settings.app.dynamicScriptForHTMLContent)

                    // gbb.settings.app.dynamicHTMLContent
                    // retu
                    // return gbb.settings.app.dynamicHTMLContent;

                } catch (e) {
                    gbb.utility.debugConsole("error in renderProductDynamicContent", e)
                }
            },
            getSearchedProductInBundlePage: function (query, productsData) {
                try {
                    // query -> contains the search params eg: {title:'val'} || {tags:'spo-default'}
                    // productsData is the array of products on which we will implement search functionality 
                    let searchKey = Object.keys(query)[0] || 'title';
                    let searchVal = query[searchKey] || '';
                    searchVal = searchVal?.toString()?.trim()?.toLowerCase();
                    let searchType = gbb.gbbAddProductsPage.state.filterBySearch.searchQuery.searchFieldType || 'String'
                    let searchedProducts = [];

                    switch (searchType) {
                        case 'String': {
                            searchedProducts = productsData?.filter((product) => {
                                return product[searchKey]?.toLowerCase()?.trim()?.includes(searchVal);
                            })
                            break
                        }
                        case 'Array': {
                            for (let i = 0; i < productsData.length; i++) {
                                let product = productsData[i];
                                // product[searchKey] => product[tags] = ['snow','sport'] => array
                                if (product[searchKey] && product[searchKey].length > 0) {
                                    for (let j = 0; j < product[searchKey].length; j++) {
                                        let arrayElement = product[searchKey][j]?.toString()?.toLowerCase()?.trim()
                                        if (arrayElement?.includes(searchVal)) {
                                            searchedProducts.push(product)
                                        }
                                    }
                                }
                            }
                            // searchedProducts = productsData?.filter((product) => {
                            //     if (product[searchKey] && product[searchKey].length > 0) { 
                            //         return product[searchKey]?.some((el) => {
                            //             let arrayElement = el?.toString()?.toLowerCase()?.trim()
                            //             return arrayElement?.includes(searchVal);
                            //         })
                            //     }
                            // })
                            break
                        }
                        default: {
                            searchedProducts = productsData
                        }
                    }
                    return searchedProducts;
                } catch (e) {
                    gbb.utility.debugConsole("error in getSearchedProductInBundlePage", e)

                }
            },
            handleSearchBundleInput: async function (value, noteAttribute) {
                try {
                    let isFilterActive = gbb.utility.getActivatedFilters(noteAttribute).length > 0
                    gbb.gbbAddProductsPage.state.filterBySearch.searchQuery.searchText = value
                    let pageType = gbb.gbbAddProductsPage.state.productPageData.pageType
                    let categoryId = gbb.gbbMultipleCategoriesPage.state.currentCategoryId

                    let totalProducts = pageType == 'MULTIPLE_CATEGORY' ? gbb.gbbAddProductsPage.state.productPageData.categories[categoryId].uniqueProductsData : gbb.gbbAddProductsPage.state.uniqueProductsData

                    if (isFilterActive) {
                        totalProducts = await gbb.utility.getFilteredSortedProductsData(noteAttribute, 'searchProductsFlow')
                    }
                    let keyToSearch = gbb.gbbAddProductsPage.state.filterBySearch.searchQuery.searchField || 'title';
                    let searchQueryParams = {
                        [keyToSearch]: gbb.gbbAddProductsPage.state.filterBySearch.searchQuery.searchText
                    }
                    // reset load more btn ref if search value is cleared 
                    // to load normal products with load more functionality
                    if (value.trim().length <= 0) {
                        let gbbAddProductsContainerHTML = gbb.$('.gbbAddProductsContainerHTML')
                        gbb.gbbAddProductsPage.f.activateLoadMoreButton(noteAttribute, gbbAddProductsContainerHTML, totalProducts, categoryId, 'resetLoadMoreRef');
                    }

                    let searchedProducts = gbb.gbbAddProductsPage.f.getSearchedProductInBundlePage(searchQueryParams, totalProducts)
                    gbb.state.setInfiniteScrollTrackerForProducts = true;

                    return searchedProducts
                } catch (error) {
                    gbb.utility.debugConsole("error in handleSearchBundleInput", error)
                }
            },
            renderShowBoxProductsToggleHTML: function () {
                try {
                    let gbbShowBoxProductsToggleContainer = gbb.$('<div>').addClass('gbbShowBoxProductsToggleContainer')
                    gbbShowBoxProductsToggleContainer.append(PLAIN_CHEVRON_UP_SVG)
                    if (gbb.gbbAddProductsPage.state.showBoxProductsInFooter) {
                        gbbShowBoxProductsToggleContainer.css('transform', 'rotate(180deg)');
                    }

                    if (gbb.state.giftBoxCartData?.items?.length <= 0) {
                        gbbShowBoxProductsToggleContainer.css('transform', 'rotate(0deg)');
                        gbb.gbbAddProductsPage.state.showBoxProductsInFooter = false;

                    }
                    return gbbShowBoxProductsToggleContainer;
                } catch (error) {
                    gbb.utility.debugConsole("error in renderShowBoxProductsToggleHTML", error)
                }
            },
            renderCartIconWithQuantityHTML: function () {
                try {
                    let _boxData = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
                    let cartIconWithQuantity = gbb.$('<div>').addClass('gbbCartIconWithQuantityContainer')
                    let cartIconWithQuantityText = gbb.$('<div>').addClass('gbbCartIconWithQuantityText')
                    let cartQuantity = gbb.$('<div>').addClass('gbbCartQuantity')
                    let cartQuantityValue = _boxData?.item_count || 0

                    cartIconWithQuantity.css('background', gbb.settings?.pageCustomizationData?.cartFooter?.cartFooterNextButtonColor || '#000000')
                    cartIconWithQuantity.css("color", gbb.settings?.pageCustomizationData?.cartFooter?.cartFooterNextButtonTextColor || '#ffffff')

                    // cartIconWithQuantity.click(gbb.gbbAddProductsPage.f.toggleBoxProductsDisplayFooter)

                    cartQuantity.text(cartQuantityValue)
                    cartIconWithQuantityText.append(cartQuantity)
                    cartIconWithQuantity.append(cartIconWithQuantityText)
                    cartIconWithQuantity.append(CART_SVG)
                    return cartIconWithQuantity;
                } catch (error) {
                    gbb.utility.debugConsole("error in renderCartIconWithQuantityHTML", error)
                }
            },
            toggleBoxProductsDisplayFooter: function () {
                if (gbb.state.giftBoxCartData?.items?.length <= 0) {
                    return
                }
                let isShowProductsActive = gbb.gbbAddProductsPage.state.showBoxProductsInFooter;
                let gbbFooterProductsContainer = gbb.$('.gbbFooterProductsContainer')
                let gbbSlotFooterProductsContainerWrapper = gbb.$(".gbbSlotFooterProductsContainerWrapper")
                // let gbbShowBoxProductsToggleContainer = gbb.$('.gbbShowBoxProductsToggleContainer')
                if (gbbFooterProductsContainer.is(':visible')) {
                    gbbFooterProductsContainer.slideUp(700); // Hide with animation
                    gbb.$("body").removeClass("gbbBodyOverflowHidden")
                    // gbbShowBoxProductsToggleContainer.css('transform', 'rotate(0deg)')
                    gbbSlotFooterProductsContainerWrapper && gbbSlotFooterProductsContainerWrapper.slideDown(700)
                    // gbb.$("body").css("overflow-y", DEFAULT_BODY_OVERFLOW_VALUE);
                } else {
                    gbbFooterProductsContainer.slideDown(700); // Show with animation
                    // gbb.$('body').css('overflow-y', 'hidden');
                    gbb.$("body").addClass("gbbBodyOverflowHidden")
                    gbbSlotFooterProductsContainerWrapper && gbbSlotFooterProductsContainerWrapper.slideUp(700)
                    // gbbShowBoxProductsToggleContainer.css('transform', 'rotate(180deg)');
                }
                gbb.gbbAddProductsPage.state.showBoxProductsInFooter = !isShowProductsActive;
            },
            renderShowBoxProductsInFooterHTML: function () {
                try {
                    let _boxData = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
                    let showBoxProductsInFooter = gbb.$('<div>').addClass('showBoxProductsInFooter')
                    let showBoxProductsInFooterText = gbb.$('<div>').addClass('showBoxProductsInFooterText')
                    showBoxProductsInFooterText.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.viewCartProductsLabel) || 'View Selected Products')
                    // showBoxProductsInFooterText.append(" ").append(`(${_boxData?.item_count})`)
                    // let toggleForDisplayProducts = gbb.gbbAddProductsPage.f.renderShowBoxProductsToggleHTML()
                    showBoxProductsInFooter.click(gbb.gbbAddProductsPage.f.toggleBoxProductsDisplayFooter)
                    showBoxProductsInFooter.append(showBoxProductsInFooterText)
                    return showBoxProductsInFooter
                } catch (e) {
                    gbb.utility.debugConsole("error in renderShowBoxProductsInFooterHTML", e)
                }

            },
            renderProgressBarHTML: function (configOptions) {
                try {
                    const { filledPercentage, filledColor, emptyColor } = configOptions
                    let progressBarContainer = gbb.$('<div>').addClass('progressBarContainer')
                    let progressBar = gbb.$('<div>').addClass('progressBar')
                    progressBar.css('background', emptyColor)
                    let progressBarFill = gbb.$('<div>').addClass('progressBarFill')
                    progressBarFill.css('background', filledColor)
                    let animationConfig = {
                        start: gbb?.gbbAddProductsPage?.state?.lastClearedDiscountProgressBarValue || 0,
                        end: filledPercentage
                    }
                    progressBarFill.css('width', animationConfig?.start + '%')
                    progressBarFill.animate({ width: animationConfig?.end + '%' }, 500)

                    progressBar.append(progressBarFill)
                    progressBarContainer.append(progressBar)
                    gbb.gbbAddProductsPage.state.lastClearedDiscountProgressBarValue = filledPercentage
                    return progressBarContainer;
                } catch (error) {
                    gbb.utility.debugConsole("error in renderProgressBarHTML", error)
                }
            },
            calculateProductSlotsData: function () {
                try {
                    let totalNoOfSlotsRequired = 0
                    let productSlotsCalculationArray = []
                    let stepsConfigurationData = gbb.settings?.stepsConfigurationData
                    for (let i = 1; i <= 12; i++) {// max page can be 12
                        let currentPageData = stepsConfigurationData[`productsData${i}`]
                        if (gbb.gbbAddProductsPage.state?.isEveryConditionHaveTypeQuantity == false) {
                            break
                        }
                        if (!currentPageData) { // if page 6 is not present then no point checking page 7,8,9....12
                            break
                        }
                        if (!currentPageData?.isProductsEnabled) {
                            continue
                        }
                        let isMultiCategory = currentPageData?.pageType == 'MULTIPLE_CATEGORY' ? true : false
                        if (isMultiCategory && currentPageData?.isPageConditionsEnabled != true) { // if pageLevel condition is false for multicategory then only we will check categories conditions else pagelevel conditions will be considered
                            for (let key in currentPageData?.categories) {
                                let currentCategoryData = currentPageData?.categories[key]
                                if (currentCategoryData?.conditions && currentCategoryData?.conditions?.length > 0) {
                                    let slotsRequiredForThisStep = gbb.gbbAddProductsPage.f.calculateNumberOfSlotsRequired(currentCategoryData?.conditions)
                                    totalNoOfSlotsRequired += slotsRequiredForThisStep
                                    productSlotsCalculationArray.push({
                                        pageId: `addProductsPage${i}`,
                                        categoryId: key,
                                        slotsRequired: slotsRequiredForThisStep
                                    })
                                }
                            }
                        } else {
                            if (currentPageData?.conditions && currentPageData?.conditions?.length > 0) {
                                let slotsRequiredForThisStep = gbb.gbbAddProductsPage.f.calculateNumberOfSlotsRequired(currentPageData?.conditions)
                                totalNoOfSlotsRequired += slotsRequiredForThisStep
                                productSlotsCalculationArray.push({
                                    pageId: `addProductsPage${i}`,
                                    categoryId: null,
                                    slotsRequired: slotsRequiredForThisStep
                                })
                            }
                        }
                        gbb.gbbAddProductsPage.state.productSlotsCalculationData = productSlotsCalculationArray
                        gbb.gbbAddProductsPage.state.totalProductSlotsRequired = totalNoOfSlotsRequired
                        if (gbb.gbbAddProductsPage?.state?.isEveryConditionHaveTypeQuantity == null) { // we change this flag to false if any of the condition does not have type as quantity ---- if this flag is null which means all conditions have type as quantity
                            gbb.gbbAddProductsPage.state.isEveryConditionHaveTypeQuantity = true
                        }
                    }
                } catch (error) {
                    gbb.utility.debugConsole("error in initializeProductSlotsData", error)
                }
            },
            calculateNumberOfSlotsRequired: function (conditionsArray) {
                try {
                    let slotsRequiredForThisStep = 0
                    let calculationRule = "Maximum"
                    let conditionTypesToExclude = []
                    let conditionValues = []
                    for (let i = 0; i < conditionsArray.length; i++) {
                        let currentCondition = conditionsArray[i]
                        if (currentCondition.type != 'quantity') {
                            gbb.gbbAddProductsPage.state.isEveryConditionHaveTypeQuantity = false
                            return 0
                        }
                        if (!conditionTypesToExclude.includes(currentCondition.condition)) {
                            conditionValues.push(+currentCondition.value)
                        }
                    }
                    if (conditionValues.length > 0) {
                        if (calculationRule == "Minimum") {
                            slotsRequiredForThisStep = Math.min(...conditionValues)
                        } else {
                            slotsRequiredForThisStep = Math.max(...conditionValues)
                        }
                    }
                    return slotsRequiredForThisStep
                } catch (error) {
                    gbb.utility.debugConsole("error in calculateNumberOfSlotsRequired", error)
                }
            },
            autoScrollSlotsOnNavigation: function () {
                try {
                    let productsContainer = gbb.$(".gbbSlotFooterProductsContainer")
                    let totalNoOfEmptySlots = productsContainer.find(".gbbSlotFooterProductContainerEmpty").length
                    let totalNoOfFilledSlots = productsContainer.find(".gbbSlotFooterProductContainer").not('.gbbSlotFooterProductContainerEmpty').length
                    // let totalNoOfSlotsToScroll = totalNoOfFilledSlots - 1

                    let minimumSlotsToScroll = -1 * Math.min(totalNoOfFilledSlots, 3)
                    let lastFilledCardToScroll = productsContainer.find(".gbbSlotFooterProductContainer").not(".gbbSlotFooterProductContainerEmpty").eq(minimumSlotsToScroll)
                    lastFilledCardToScroll.length > 0 && lastFilledCardToScroll[0].scrollIntoView({ behavior: "smooth", block: "nearest", inline: "start" });
                    // if (totalNoOfEmptySlots > 0) {
                    // let card = productsContainer.find('.gbbSlotFooterProductContainer');
                    // let cardWidth = card[0].offsetWidth
                    // let distanceToScroll = (totalNoOfSlotsToScroll * cardWidth) + (totalNoOfSlotsToScroll * 10)
                    // productsContainer.animate({
                    //     scrollLeft:distanceToScroll
                    // },300)
                    // } 

                } catch (error) {
                    gbb.utility.debugConsole("error in autoScrollSlotsOnNavigation", error)
                }
            },
            // autoScrollSlotsBasedOnATC: function (flow) {
            //     try {
            //         let gbbSlotFooterProductsContainerWrapper = gbb.$('.gbbSlotFooterProductsContainerWrapper')
            //         let visibleContentWidth = gbbSlotFooterProductsContainerWrapper.width()
            //         let containerLeft = gbbSlotFooterProductsContainerWrapper.scrollLeft();
            //         let distanceToScroll = 0 
            //         let productCardsContainer = gbb.$(".gbbSlotFooterProductsContainer")
            //         let emptyCardFound = false
            //         //  find the last child which has class gbbSlotFooterProductContainer and doesnt contain gbbSlotFooterProductContainerEmpty

            //         if (flow == "addToCart") {
            //             productCardsContainer.find(".gbbSlotFooterProductContainer").each(function (index) {
            //                 let productCard = gbb.$(this)

            //                 let isProductSlotEmpty = productCard.hasClass("gbbSlotFooterProductContainerEmpty")
            //                 if (isProductSlotEmpty) {
            //                     let productCardLeft =  productCard.position().left; 
            //                     let productCardRight = productCardLeft + productCard.width();

            //                     // Check if the card is already visible within the container's width
            //                     if (productCardLeft >= containerLeft && productCardRight <= visibleContentWidth) {
            //                         emptyCardFound = true;
            //                     } else {
            //                         let previousCardLeft = productCard.prev().position().left
            //                         distanceToScroll = previousCardLeft
            //                         // use scrollIntoView to scroll to the card 
            //                         previousCardLeft[0].scrollIntoView({ behavior: "smooth", block: "nearest", inline: "start" });
            //                         // gbb.$(".gbbSlotFooterProductsContainer").animate({
            //                         //     scrollLeft: productCard.prev()
            //                         //     }, 500)
            //                     }
            //                     return false; // Exit the loop once the first empty card is found
            //                 }
            //             })
            //             // Scroll to the first empty card if it is not visible
            //             // if (!emptyCardFound && distanceToScroll > 0) {
            //             //     gbb.$(".gbbSlotFooterProductsContainer").animate({
            //             //         scrollLeft:  distanceToScroll
            //             //     }, 500)
            //             // }
            //         } else if (flow == "removeFromCart") {
            //             let lastFilledCard = productCardsContainer.find(".gbbSlotFooterProductContainer").not(".gbbSlotFooterProductContainerEmpty").last()
            //             let lastFilledCardLeft = lastFilledCard?.position().left;
            //             // last filledCard is inside visbility then dont scroll 
            //             let lastFilledCardRight = lastFilledCardLeft + lastFilledCard.width();
            //             // if (lastFilledCardRight > visibleContentWidth) {
            //             //     distanceToScroll = lastFilledCardLeft - containerLeft;
            //             //     gbb.$(".gbbSlotFooterProductsContainer").animate({
            //             //         scrollLeft: lastFilledCardLeft
            //             //     }, 500)
            //             // }

            //             // lastFilledCard.scrollIntoView({ behavior: "smooth", block: "nearest", inline: "start" });
            //                 gbb.$(".gbbSlotFooterProductsContainer").animate({
            //                     scrollLeft: lastFilledCard
            //                 }, 500)
            //        }

            //     } catch (error) {
            //         gbb.utility.debugConsole("error in autoScrollSlotsBasedOnATC", error)
            //     }
            // },
            autoScrollSlots: function () {
                try {
                    let productsContainer = gbb.$(".gbbSlotFooterProductsContainer")
                    let totalNoOfFilledSlots = productsContainer.find(".gbbSlotFooterProductContainer").not(".gbbSlotFooterProductContainerEmpty").length
                    let productCard = productsContainer.find('.gbbSlotFooterProductContainer').eq(0)

                    let slotsFooterWrapperWidth = gbb.$('.gbbSlotFooterProductsContainerWrapper').width()
                    let gridGap = 10
                    let totalSizeTakenByFilledSlots = (totalNoOfFilledSlots * productCard.width()) + ((totalNoOfFilledSlots - 1) * gridGap)
                    let slideConditionPercentage = 0.6 // calculate 60% of the width of the container
                    let triggerAutoSlide = totalSizeTakenByFilledSlots > (slotsFooterWrapperWidth * slideConditionPercentage)
                    if (triggerAutoSlide) {
                        let thirdLastFilledProductCard = productsContainer.find(".gbbSlotFooterProductContainer").not(".gbbSlotFooterProductContainerEmpty").eq(-3)
                        if (thirdLastFilledProductCard?.length > 0) {
                            thirdLastFilledProductCard[0].scrollIntoView({ behavior: "smooth", block: "nearest", inline: "start" });
                        }
                    }
                } catch (err) {
                    gbb.utility.debugConsole("error in autoScrollSlots", err)
                }
            }
        },
        events: {
            activateInfiniteScrollForProducts: async function () {
                if (gbb.state.setInfiniteScrollTrackerForProducts == false) {
                    return;
                }
                const myElement = gbb.$('[data-load-more-indicator-status]');

                if (gbb.utility.isElementVisible(myElement)) {
                    if (myElement.attr("data-load-more-indicator-status") != "fetching") {
                        myElement.attr("data-load-more-indicator-status", "fetching")
                        let fetchInProgress;
                        if (!fetchInProgress) {
                            fetchInProgress = true;
                            setTimeout(async function () {
                                gbb.utility.debugConsole("fetching..in progress")
                                const noteAttribute = gbb.gbbAddProductsPage.state.dataForInfiniteScroll.noteAttribute
                                const allProductsData = gbb.gbbAddProductsPage.state.dataForInfiniteScroll.allProductsData
                                const categoryId = gbb.gbbAddProductsPage.state.dataForInfiniteScroll.categoryId
                                await gbb.gbbAddProductsPage.f.loadMoreProducts(noteAttribute, allProductsData, categoryId);
                                myElement.removeAttr("data-load-more-indicator-status")
                            }, 400)
                            gbb.utility.debugConsole("queued...in setTimeout");
                        }
                    } else {
                        // gbb.utility.debugConsole("fetching...from else if")
                    }
                } else {
                    // gbb.utility.debugConsole('Element is not visible');
                }
            }

        },
        action: {
            showPage1: async function () {
                //updatePageStatusFn
                // gbb.gbbAddProductsPage.state.updatePageStatusFn(1);
                let pageId = "addProductsPage1";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId);

            },
            showPage2: async function () {

                let pageId = "addProductsPage2";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId);
            },
            showPage3: async function () {
                let pageId = "addProductsPage3";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId);

            },

            showPage4: async function () {
                let pageId = "addProductsPage4";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            },

            showPage5: async function () {
                let pageId = "addProductsPage5";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            },

            showPage6: async function () {
                let pageId = "addProductsPage6";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            },

            showPage7: async function () {
                let pageId = "addProductsPage7";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            },

            showPage8: async function () {
                let pageId = "addProductsPage8";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            },

            showPage9: async function () {
                let pageId = "addProductsPage9";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            },

            showPage10: async function () {
                let pageId = "addProductsPage10";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            },

            showPage11: async function () {
                let pageId = "addProductsPage11";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            },

            showPage12: async function () {
                let pageId = "addProductsPage12";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            }
        },
    },
    gbbSubscriptionProductsPage: {
        state: {
            selectedSellingPlanGroup: null,
            activeSellingPlanId: null,
            activeSellingPlanDetails: null,
            selectedSellingPlanGroupId: null,
            sellingPlansArray: [],
            enableOneTimePurchase: false,
            showDiscountOnProductCards: false,
            purchaseType: null,
            constants: {
                ONE_TIME_PURCHASE: 'ONE_TIME_PURCHASE',
                SUBSCRIPTION_PURCHASE: 'SUBSCRIPTION_PURCHASE'
            },
            languageFields: {
                oneTimePurchaseLabel: "One time Purchase", // get it from multilang
                subscriptionPurchaseLabel: "Subscription Purchase",// get it from multilang
                frequencyLabel: "Frequency1",
                pageTitle: "Page Title1"
            },
        },
        settings: {
            pageCustomizationData: { // change values 
                header: {
                    purchaseOptionActiveColor: "#2B2B2B",
                    purchaseOptionActiveBgColor: "#FFFFFF",
                    purchaseOptionInActiveColor: "#888888",
                    purchaseOptionInActiveBgColor: "#F0F0F0",
                    purchaseOptionStrokeRadius: "8px",
                    purchaseOptionStrokeColor: "#D5D5D5",
                    purchaseOptionStrokeWidth: "2px",
                    sellingPlanNavigationActiveBgColor: "#FFFFFF",
                    sellingPlanNavigationActiveTitleColor: "#333333",
                    sellingPlanNavigationInActiveTitleColor: "#333333",
                    pageTitleColor: "#333333",
                    pageTitleFontWeight: "bold",
                    headerBgColor: "#EDEDED",
                    sellingPlanNavigationNextPrevIconBgColor: "#2B2B2B",
                    sellingPlanNavigationActiveDiscountPillBgColor: "#CAE983",
                    sellingPlanNavigationActiveDiscountPillTextColor: "#000000",
                    sellingPlanNavigationInActiveDiscountPillTextColor: "#000000",
                    sellingPlanNavigationInActiveDiscountPillBgColor: "#9D9D9D",
                    productDiscountRibbonBgColor: "#FF0000",
                    productDiscountRibbonTextColor: "#FFFFFF",
                    subscriptionFrequencyLabelTextColor: "#333333",
                    subscriptionFrequencyLabelFontWeight: "bold",
                    subscriptionPageTitleTextColor: "#000000",
                    subscriptionPageTitleFontWeight: "bold",
                    sellingPlansNavigationStrokeColor: "#B7B7B7",
                    sellingPlansNavigationStrokeWidth: "2px",
                    sellingPlansNavigationStrokeRadius: "10px"
                }
            }
        },
        f: {
            setCssVariablesForSubscriptionProductsPage: function () {
                try {
                    let root = document.documentElement;
                    let pageCustomizationData = gbb.gbbSubscriptionProductsPage.settings.pageCustomizationData || {}
                    const keysToMap = ['header']
                    keysToMap.forEach((key) => {
                        let currentKey = pageCustomizationData[key] || {}
                        Object.keys(currentKey).forEach((key) => {
                            let value = currentKey[key];
                            if (value) {
                                let _key = gbb.f.convertCamelCaseToKebabCase(key);
                                root.style.setProperty(`--gbb-gbbSubscriptionBundle-${_key}`, value);
                            }
                        })
                    })
                } catch (error) {
                    gbb.utility.debugError('error in setCssVariablesForSubscriptionProductsPage', error)
                }
            },
            checkIfPurchaseTypeIsSubscription: function () {
                try {
                    const { SUBSCRIPTION_PURCHASE } = gbb.gbbSubscriptionProductsPage.state.constants
                    const subscriptionDataFromSessionStorage = gbb.gbbSubscriptionProductsPage.f.getSubscriptionDataFromSessionStorage()
                    if (subscriptionDataFromSessionStorage && subscriptionDataFromSessionStorage.purchaseType) { 
                        return subscriptionDataFromSessionStorage.purchaseType == SUBSCRIPTION_PURCHASE
                    }
                    const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.state.purchaseType == SUBSCRIPTION_PURCHASE
                    return isPurchaseTypeSubscription
                } catch (error) {
                    gbb.utility.debugError('error in checkIfPurchaseTypeIsSubscription', error)
                }
            },
            updateSubscriptionDataInSessionStorage: function (data = {}) {
                try {
                    let { ONE_TIME_PURCHASE } = gbb.gbbSubscriptionProductsPage.state.constants
                    let dataToSet = {
                        activeSellingPlanId: gbb.gbbSubscriptionProductsPage.state.activeSellingPlanId,
                        activeSellingPlanDetails: gbb.gbbSubscriptionProductsPage.state.activeSellingPlanDetails,
                        purchaseType: gbb.gbbSubscriptionProductsPage.state.purchaseType,
                        selectedSellingPlanGroupId: gbb.gbbSubscriptionProductsPage.state.selectedSellingPlanGroupId,
                        enableOneTimePurchase: gbb.gbbSubscriptionProductsPage.state.enableOneTimePurchase,
                        sellingPlansArray: gbb.gbbSubscriptionProductsPage.state.sellingPlansArray,
                    }
                    dataToSet = { ...dataToSet, ...data }
                    if (dataToSet.purchaseType == ONE_TIME_PURCHASE) {
                        dataToSet['activeSellingPlanId'] = null
                        dataToSet['activeSellingPlanDetails'] = null
                    }
                    sessionStorage.setItem(`gbb-subscription-bundle-${gbb.state.bundleId}`, JSON.stringify(dataToSet));
                } catch (error) {
                    gbb.utility.debugError('error updateSubscriptionDataInsessionStorage', error)
                }
            },
            getSubscriptionDataFromSessionStorage: function () {
                try {
                    return JSON.parse(sessionStorage.getItem(`gbb-subscription-bundle-${gbb.state.bundleId}`))
                } catch (error) {
                    gbb.utility.debugError('error in getSubscriptionDataFromSessionStorage', error)
                }
            },
            checkIfPricingPoliciesChanged: function (sessionArray, settingsArray) {
                try {
                    for (const settingsItem of settingsArray) {
                        const sessionItem = sessionArray.find(item => item.id === settingsItem.id);
                        if (!sessionItem) return true;

                        const sessionPricingPolicies = sessionItem.pricingPolicies;
                        const settingsPricingPolicies = settingsItem.pricingPolicies;

                        if (sessionPricingPolicies.length !== settingsPricingPolicies.length) return true;

                        for (let j = 0; j < sessionPricingPolicies.length; j++) {
                            const sessionPolicy = sessionPricingPolicies[j];
                            const settingsPolicy = settingsPricingPolicies[j];

                            if (sessionPolicy.adjustmentType !== settingsPolicy.adjustmentType) return true;

                            const { adjustmentType } = sessionPolicy.adjustmentType;
                            const adjustmentValueSession = sessionPolicy.adjustmentValue;
                            const adjustmentValueSettings = settingsPolicy.adjustmentValue;

                            if (adjustmentType === 'PERCENTAGE') {
                                if (adjustmentValueSession.percentage !== adjustmentValueSettings.percentage) return true;
                            } else if (adjustmentType === 'PRICE' || adjustmentType === 'FIXED_AMOUNT') {
                                if (adjustmentValueSession.amount !== adjustmentValueSettings.amount) return true;
                            }
                        }
                    }
                    return false;
                } catch (error) {
                    gbb.utility.debugError('error in checkIfPricingPoliciesChanged', error);
                }
            },

            checkIfNameChanged: function (sessionArray, settingsArray) {
                try {
                    for (const settingsItem of settingsArray) {
                        const sessionItem = sessionArray.find(item => item.id === settingsItem.id);
                        if (!sessionItem) return true;

                        const keysToCheck = ['name', 'displayTitle', 'displayDiscountText'];
                        for (const key of keysToCheck) {
                            if (sessionItem[key] !== settingsItem[key]) return true;
                        }
                    }
                    return false;
                } catch (error) {
                    gbb.utility.debugError('error in checkIfNameChanged', error);
                }
            },

            hasSubscriptionDataChanged: function (dataToUpdate) {
                try {
                    const subscriptionDataFromSessionStorage = gbb.gbbSubscriptionProductsPage.f.getSubscriptionDataFromSessionStorage();
                    if (!subscriptionDataFromSessionStorage) return false;

                    const sellingPlanArrayFromSession = subscriptionDataFromSessionStorage.sellingPlansArray;
                    const sellingPlanArrayFromSettings = dataToUpdate.sellingPlansArray;

                    if (sellingPlanArrayFromSession.length !== sellingPlanArrayFromSettings.length) return true;

                    if (this.checkIfNameChanged(sellingPlanArrayFromSession, sellingPlanArrayFromSettings)) return true;
                    if (this.checkIfPricingPoliciesChanged(sellingPlanArrayFromSession, sellingPlanArrayFromSettings)) return true;

                    const keysToCompare = ['enableOneTimePurchase', 'selectedSellingPlanGroupId'];
                    for (const key of keysToCompare) {
                        if (dataToUpdate[key] !== subscriptionDataFromSessionStorage[key]) return true;
                    }

                    return false;
                } catch (error) {
                    gbb.utility.debugError('error in hasSubscriptionDataChanged', error);
                }
            },
            setSubscriptionBundlesLanguageFields: function (options) {
                try {
                    let languageFields = gbb.gbbSubscriptionProductsPage.state.languageFields
                    for (let key in options) {
                        if (key && languageFields.hasOwnProperty(key)) {
                            languageFields[key] = options[key]
                        }
                    }
                    gbb.gbbSubscriptionProductsPage.state.languageFields = languageFields
                } catch (error) {
                    gbb.utility.debugError('error in setSubscriptionBundlesLanguageFields', error)
                }
            },
            setSubscriptionBundlesSettings: async function (dataToSet) {
                try {
                    let { selectedSubscriptionGroup, enableOneTimePurchase, showDiscountOnProductCards, frequencyLabel, pageTitle, isDefaultPurchaseTypeSubscription = false } = dataToSet || {}
                    const { ONE_TIME_PURCHASE, SUBSCRIPTION_PURCHASE } = gbb.gbbSubscriptionProductsPage.state.constants
                    const purchaseType = (enableOneTimePurchase && isDefaultPurchaseTypeSubscription) || !enableOneTimePurchase ? SUBSCRIPTION_PURCHASE:ONE_TIME_PURCHASE
                    const activeSellingPlanData = selectedSubscriptionGroup?.sellingPlans[0] || {}
                    let groupId = gbb.utility.generateSellingPlanGroupIdByName(selectedSubscriptionGroup.name)
                    const updateStates = {
                        selectedSellingPlanGroup: selectedSubscriptionGroup,
                        selectedSellingPlanGroupId: groupId,
                        activeSellingPlanDetails: activeSellingPlanData,
                        activeSellingPlanId: gbb.utility.extractIdsFromGraphQlId(activeSellingPlanData?.id) || null,
                        sellingPlansArray: selectedSubscriptionGroup?.sellingPlans || [],
                        purchaseType: purchaseType,
                        enableOneTimePurchase: enableOneTimePurchase,
                        showDiscountOnProductCards: showDiscountOnProductCards,
                    }

                    const subscriptionDataFromSessionStorage = gbb.gbbSubscriptionProductsPage.f.getSubscriptionDataFromSessionStorage()

                    let isSessionDataChanged = gbb.gbbSubscriptionProductsPage.f.hasSubscriptionDataChanged(updateStates)

                    if (isSessionDataChanged || !subscriptionDataFromSessionStorage) {
                        let dataToSet = {
                            activeSellingPlanId: gbb.utility.extractIdsFromGraphQlId(activeSellingPlanData?.id),
                            activeSellingPlanDetails: activeSellingPlanData,
                            purchaseType: purchaseType,
                            selectedSellingPlanGroupId: groupId,
                            enableOneTimePurchase: enableOneTimePurchase,
                        }
                        gbb.gbbSubscriptionProductsPage.f.updateSubscriptionDataInSessionStorage(dataToSet)
                    }
                    else if (subscriptionDataFromSessionStorage) {
                        for (let key in subscriptionDataFromSessionStorage) {
                            if (key && updateStates.hasOwnProperty(key)) {
                                updateStates[key] = subscriptionDataFromSessionStorage[key]
                            }
                        }
                    }
                    gbb.gbbSubscriptionProductsPage.state = { ...gbb.gbbSubscriptionProductsPage.state, ...updateStates }
                    gbb.gbbSubscriptionProductsPage.f.setSubscriptionBundlesLanguageFields({ frequencyLabel, pageTitle })
                    if (isSessionDataChanged) {
                        await gbb.gbbSubscriptionProductsPage.f.resetProductsDataBasedOnActiveSellingPlan()
                    }
                } catch (error) {
                    gbb.utility.debugError("error in gbbSubscriptionProductsPage.f.setSubscriptionBundlesSettings", error)
                }
            },
            prepareSubscriptionHeaderHTML: function () {
                try {
                    const enableOneTimePurchase = gbb.gbbSubscriptionProductsPage.state.enableOneTimePurchase || false
                    const purchaseType = gbb.gbbSubscriptionProductsPage.state.purchaseType
                    const { SUBSCRIPTION_PURCHASE } = gbb.gbbSubscriptionProductsPage.state.constants

                    const gbbSubscriptionBundleWrapper = gbb.$('<div>').addClass('gbbSubscriptionBundleWrapper')
                    if (enableOneTimePurchase) {
                        let purchaseOptionsWrapperHTML = gbb.gbbSubscriptionProductsPage.f.preparePurchaseOptionsUI()
                        gbbSubscriptionBundleWrapper.append(purchaseOptionsWrapperHTML)
                    }
                    if (purchaseType == SUBSCRIPTION_PURCHASE) {
                        let sellingPlansNavigationHTML = gbb.gbbSubscriptionProductsPage.f.prepareSellingPlansNavigationUI()
                        gbbSubscriptionBundleWrapper.append(sellingPlansNavigationHTML)
                    }

                    return gbbSubscriptionBundleWrapper;
                } catch (error) {
                    gbb.utility.debugError('error in gbbSubscriptionProductsPage.f.prepareSubscriptionHeaderHTML', error)
                }
            },
            resetProductsDataBasedOnActiveSellingPlan: async function () {
                try {
                    gbb.gbbSubscriptionProductsPage.f.updateSubscriptionDataInSessionStorage()
                    let cartData = gbb.state.giftBoxCartData
                    gbb.gbbBrowser.setRelevantBoxDataToSessionStorage(cartData)
                    gbb.gbbBrowser.updateTotalPriceInSessionStorage()
                    gbb.gbbBrowser.updateTotalofRelevantBoxPriceInSessionStorage()
                    await gbb.gbbSubscriptionProductsPage.f.resetProductsCardContainerUI()
                    gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(gbb.state.currentPageId));
                } catch (error) {
                    gbb.utility.debugError('error in gbbSubscriptionProductsPage.f.resetProductsDataBasedOnActiveSellingPlan', error)
                }
            },
            handleChangeActiveSellingPlan: async function (event) {
                try {
                    let gbbSellingPlanNavigationTab = gbb.$(event.currentTarget)
                    if (gbbSellingPlanNavigationTab.hasClass("active")) {
                        return
                    }
                    let sellingPlanId = gbbSellingPlanNavigationTab.data('selling-plan-id')
                    let sellingPlanIdGid = `gid://shopify/SellingPlan/${sellingPlanId}`
                    let sellingPlansArray = gbb.gbbSubscriptionProductsPage.state.sellingPlansArray
                    let sellingPlan = sellingPlansArray.find((sellingPlan) => sellingPlan.id == sellingPlanIdGid)
                    gbb.$('.gbbSellingPlanNavigationTab').removeClass('active')
                    gbbSellingPlanNavigationTab.addClass('active')
                    gbb.gbbSubscriptionProductsPage.state.activeSellingPlanId = sellingPlanId
                    gbb.gbbSubscriptionProductsPage.state.activeSellingPlanDetails = sellingPlan
                    await gbb.gbbSubscriptionProductsPage.f.resetProductsDataBasedOnActiveSellingPlan()
                    return sellingPlanId
                } catch (error) {
                    gbb.utility.debugError('error in gbbSubscriptionProductsPage.f.handleChangeActiveSellingPlan', error)
                }
            },
            prepareIndividualSellingPlanNavigationTabHTML: function (sellingPlan) {
                try {
                    const activeSellingPlanId = gbb.gbbSubscriptionProductsPage.state.activeSellingPlanId
                    const gbbSellingPlanNavigationTab = gbb.$('<div>').addClass('gbbSellingPlanNavigationTab')
                    const gbbSellingPlanNavigationTabTitle = gbb.$('<div>').addClass('gbbSellingPlanNavigationTabTitle')
                    const gbbSellingPlanNavigationDiscountText = gbb.$('<div>').addClass('gbbSellingPlanNavigationDiscountText')
                    const sellingPlanId = gbb.utility.extractIdsFromGraphQlId(sellingPlan.id)
                    if (sellingPlanId == activeSellingPlanId) {
                        gbbSellingPlanNavigationTab.addClass("active")
                    }
                    gbbSellingPlanNavigationTab.attr('data-selling-plan-id', sellingPlanId)
                    gbbSellingPlanNavigationTabTitle.text(sellingPlan.displayTitle)
                    gbbSellingPlanNavigationDiscountText.text(sellingPlan.displayDiscountText)
                    gbbSellingPlanNavigationTab.append(gbbSellingPlanNavigationTabTitle)
                    gbbSellingPlanNavigationTab.append(gbbSellingPlanNavigationDiscountText)

                    gbbSellingPlanNavigationTab.on("click", gbb.gbbSubscriptionProductsPage.f.handleChangeActiveSellingPlan)
                    return gbbSellingPlanNavigationTab
                } catch (error) {
                    gbb.utility.debugError('error in gbbSubscriptionProductsPage.f.prepareIndividualSellingPlanNavigationTabHTML', error)
                }
            },
            prepareNextPrevNavigationsHTML: function () {
                try {
                    const nextNavigationIconHTML = gbb.$('<div>').addClass("gbbSellingPlanNextNavigationIconWrapper").append(CONSTANT_ARROW_SVG)
                    const prevNavigationIconHTML = gbb.$('<div>').addClass("gbbSellingPlanPrevNavigationIconWrapper").append(CONSTANT_ARROW_SVG)

                    return { nextNavigationIconHTML, prevNavigationIconHTML }
                } catch (error) {
                    gbb.utility.debugError('error in gbbSubscriptionProductsPage.f.prepareNextPrevNavigationsHTML', error)
                }
            },
            renderSellingPlansNavigationTabs: function (options) {
                try {
                    const { sellingPlansArray, gbbSellingPlansNavigationTabsContainer } = options
                    gbbSellingPlansNavigationTabsContainer.empty();  // Clear previous tabs

                    for (let i = 0; i < sellingPlansArray.length; i++) {
                        const sellingPlan = sellingPlansArray[i];
                        const navigationTab = gbb.gbbSubscriptionProductsPage.f.prepareIndividualSellingPlanNavigationTabHTML(sellingPlan);
                        gbbSellingPlansNavigationTabsContainer.append(navigationTab);
                    }
                    return gbbSellingPlansNavigationTabsContainer
                } catch (error) {
                    gbb.utility.debugError('error in renderSellingPlansNavigationTabs', error)
                }
            },
            handleNextPrevNavigationBtnClickV1: function ({ operation }) {
                try {
                    const navigationTabsContainer = gbb.$(".gbbSellingPlansNavigationTabsContainer").first();
                    const totalSellingPlans = gbb.gbbSubscriptionProductsPage.state.sellingPlansArray?.length || 0;
                    let isMobileView = false;

                    // Check if the navigation container exists
                    if (!navigationTabsContainer.length) return;

                    const navigationTabs = gbb.$(".gbbSellingPlanNavigationTab");
                    let slidesPerView = 4; // Default number of visible slides
                    if (window.innerWidth < 550) {
                        isMobileView = true;
                        slidesPerView = 1;  // Only 1 visible slide in mobile view
                    }

                    // Find the active element using the 'active' class
                    const $activeElement = navigationTabs.filter('.active').first();
                    const activeIndex = navigationTabs.index($activeElement);

                    let scrollToElementIndex;

                    // Calculate the new index to scroll to based on the "NEXT" or "PREV" operation
                    if (operation === "NEXT") {
                        scrollToElementIndex = Math.min(activeIndex + slidesPerView, totalSellingPlans - 1);
                    } else if (operation === "PREV") {
                        scrollToElementIndex = Math.max(activeIndex - slidesPerView, 0);
                    }

                    const $nextSlideElement = navigationTabs.eq(scrollToElementIndex).first();

                    // Make sure the next slide element exists
                    if (!$nextSlideElement.length) return;

                    const containerRect = navigationTabsContainer.get(0).getBoundingClientRect();
                    const nextSlideRect = $nextSlideElement.get(0).getBoundingClientRect();

                    // Calculate the scroll offset based on the active element and the next element
                    const offset = nextSlideRect.left - containerRect.left;

                    // Adjust scrolling direction based on operation
                    if (operation === "NEXT") {
                        navigationTabsContainer.animate({
                            scrollLeft: '+=' + offset
                        }, 500);
                    } else if (operation === "PREV") {
                        navigationTabsContainer.animate({
                            scrollLeft: '-=' + Math.abs(offset)
                        }, 500);
                    }

                    if (isMobileView) {
                        gbb.gbbSubscriptionProductsPage.f.handleChangeActiveSellingPlan({ currentTarget: $nextSlideElement });
                    }

                } catch (error) {
                    gbb.utility.debugError('Error in handleNextPrevNavigationBtnClick', error);
                }
            },
            autoScrollToActiveSellingPlanNavigation: function () {
                try {
                    const navigationTabsContainer = gbb.$(".gbbSellingPlansNavigationTabsContainer").first();
                    if (!navigationTabsContainer.length) return;
                    const navigationTabs = gbb.$(".gbbSellingPlanNavigationTab");
                    const totalSellingPlans = gbb.gbbSubscriptionProductsPage.state.sellingPlansArray?.length || 0;
                    const $activeElement = navigationTabs.filter('.active').first();
                    const activeIndex = navigationTabs.index($activeElement);
                    let scrollToElementIndex = Math.min(activeIndex, totalSellingPlans - 1);
                    
                    const $nextSlideElement = navigationTabs.eq(scrollToElementIndex).first();

                    if (!$nextSlideElement.length) return;

                    const containerRect = navigationTabsContainer.get(0).getBoundingClientRect();
                    const nextSlideRect = $nextSlideElement.get(0).getBoundingClientRect();

                    const offset = nextSlideRect.left - containerRect.left;
                        navigationTabsContainer.animate({
                            scrollLeft: '+=' + offset
                        }, 500);

                } catch (error) {
                    gbb.utility.debugError('error in autoScrollToActiveSellingPlanNavigation', error)
                }
            },
            handleNextPrevNavigationBtnClick: function ({ operation }) {
                try {
                    const navigationTabsContainer = gbb.$(".gbbSellingPlansNavigationTabsContainer").first();
                    const totalSellingPlans = gbb.gbbSubscriptionProductsPage.state.sellingPlansArray?.length || 0;
                    let isMobileView = window.innerWidth < 550; // Check if it's mobile view
                    let slidesPerView = isMobileView ? 1 : 4; // Set slides per view depending on screen size

                    // Check if the navigation container exists
                    if (!navigationTabsContainer.length) return;

                    const navigationTabs = gbb.$(".gbbSellingPlanNavigationTab");

                    let scrollToElementIndex;

                    if (isMobileView) {
                        const $activeElement = navigationTabs.filter('.active').first();
                        const activeIndex = navigationTabs.index($activeElement);

                        // Calculate the new index based on the operation
                        if (operation === "NEXT") {
                            scrollToElementIndex = Math.min(activeIndex + slidesPerView, totalSellingPlans - 1);
                        } else if (operation === "PREV") {
                            scrollToElementIndex = Math.max(activeIndex - slidesPerView, 0);
                        }

                    } else {
                        const containerRect = navigationTabsContainer.get(0).getBoundingClientRect();

                        // Find the index of the first visible element
                        let firstVisibleTabIndex = 0;
                        navigationTabs.each(function (index) {
                            const tabRect = gbb.$(this).get(0).getBoundingClientRect();
                            if (tabRect.left >= containerRect.left && tabRect.right <= containerRect.right) {
                                firstVisibleTabIndex = index;
                                return false; // Stop when first visible tab is found
                            }
                        });

                        // Calculate the new index based on the operation
                        if (operation === "NEXT") {
                            scrollToElementIndex = Math.min(firstVisibleTabIndex + slidesPerView, totalSellingPlans - 1);
                        } else if (operation === "PREV") {
                            scrollToElementIndex = Math.max(firstVisibleTabIndex - slidesPerView, 0);
                        }
                    }

                    const $nextSlideElement = navigationTabs.eq(scrollToElementIndex).first();

                    // Make sure the next slide element exists
                    if (!$nextSlideElement.length) return;

                    const containerRect = navigationTabsContainer.get(0).getBoundingClientRect();
                    const nextSlideRect = $nextSlideElement.get(0).getBoundingClientRect();

                    // Calculate the scroll offset
                    const offset = nextSlideRect.left - containerRect.left;

                    // Scroll to the next or previous element
                    if (operation === "NEXT") {
                        navigationTabsContainer.animate({
                            scrollLeft: '+=' + offset
                        }, 500);
                    } else if (operation === "PREV") {
                        navigationTabsContainer.animate({
                            scrollLeft: '-=' + Math.abs(offset)
                        }, 500);
                    }

                    if (isMobileView) {
                        gbb.gbbSubscriptionProductsPage.f.handleChangeActiveSellingPlan({ currentTarget: $nextSlideElement });
                    }

                } catch (error) {
                    gbb.utility.debugError('Error in handleNextPrevNavigationBtnClick', error);
                }
            },
            addPrevNextNavigationButtons: function ({
                gbbSellingPlansNavigationItemsWrapper,
                gbbSellingPlansNavigationTabsContainer,
            }) {
                try {
                    const { nextNavigationIconHTML, prevNavigationIconHTML } = gbb.gbbSubscriptionProductsPage.f.prepareNextPrevNavigationsHTML();

                    gbbSellingPlansNavigationItemsWrapper.append(prevNavigationIconHTML);
                    gbbSellingPlansNavigationItemsWrapper.append(gbbSellingPlansNavigationTabsContainer);
                    gbbSellingPlansNavigationItemsWrapper.append(nextNavigationIconHTML);
                    prevNavigationIconHTML.prop('disabled', true);

                    nextNavigationIconHTML.on('click', () => {
                        gbb.gbbSubscriptionProductsPage.f.handleNextPrevNavigationBtnClick({ operation: "NEXT" })
                    });

                    prevNavigationIconHTML.on('click', () => {
                        gbb.gbbSubscriptionProductsPage.f.handleNextPrevNavigationBtnClick({ operation: "PREV" })
                    });
                    return gbbSellingPlansNavigationItemsWrapper
                } catch (error) {
                    gbb.utility.debugError('error in addPrevNextNavigationButtons', error)
                }
            },
            prepareSellingPlansNavigationUI: function () {
                try {
                    const noOfTabsToRender = 4;//make it dynamic
                    const isMobileView = window.innerWidth < 500
                    const sellingPlansArray = gbb.gbbSubscriptionProductsPage.state.sellingPlansArray;
                    const numberOfSellingPlans = sellingPlansArray?.length;
                    const languageFields = gbb.gbbSubscriptionProductsPage.state.languageFields
                    const gbbSellingPlansNavigationWrapper = gbb.$('<div>').addClass('gbbSellingPlansNavigationWrapper');
                    const gbbSellingPlansNavigationItemsWrapper = gbb.$('<div>').addClass('gbbSellingPlansNavigationItemsWrapper');
                    const gbbSellingPlansNavigationTabsContainer = gbb.$('<div>').addClass('gbbSellingPlansNavigationTabsContainer');
                    gbbSellingPlansNavigationItemsWrapper.attr('data-total-selling-plans', numberOfSellingPlans);
                    const gbbSellingPlansNavigationTitle = gbb.$('<div>').addClass('gbbSellingPlansNavigationTitle');

                    gbbSellingPlansNavigationTitle.text(languageFields.pageTitle);

                    gbb.gbbSubscriptionProductsPage.f.renderSellingPlansNavigationTabs({ sellingPlansArray, gbbSellingPlansNavigationTabsContainer });

                    if (numberOfSellingPlans > noOfTabsToRender || isMobileView) {
                        gbb.gbbSubscriptionProductsPage.f.addPrevNextNavigationButtons({
                            gbbSellingPlansNavigationItemsWrapper,
                            gbbSellingPlansNavigationTabsContainer,
                        })
                    } else {
                        gbbSellingPlansNavigationItemsWrapper.append(gbbSellingPlansNavigationTabsContainer);
                    }

                    gbbSellingPlansNavigationWrapper.append(gbbSellingPlansNavigationTitle);
                    gbbSellingPlansNavigationWrapper.append(gbbSellingPlansNavigationItemsWrapper);

                    return gbbSellingPlansNavigationWrapper;
                } catch (error) {
                    gbb.utility.debugError('error in gbbSubscriptionProductsPage.f.prepareSellingPlansNavigationUI', error);
                }
            },
            resetProductsCardContainerUI: async function () {
                try {
                    let pageType = gbb.gbbAddProductsPage.state.productPageData.pageType
                    let categoryId = gbb.gbbMultipleCategoriesPage.state.currentCategoryId
                    let totalProducts = pageType == 'MULTIPLE_CATEGORY' ? gbb.gbbAddProductsPage.state.productPageData.categories[categoryId].uniqueProductsData : gbb.gbbAddProductsPage.state.uniqueProductsData
                    let noteAttribute = gbb.state.currentPageId;

                    let updatedProductsCardsContainer = await gbb.gbbAddProductsPage.f.renderProductsCardContainer(totalProducts, noteAttribute, 'resetProductCardsContainer', categoryId)

                    return updatedProductsCardsContainer
                } catch (error) {
                    gbb.utility.debugError("error in resetProductsCardContainerUI", error)
                }
            },
            handlePurchaseOptionClick: async function (event) {
                try {
                    let gbbPurchaseOption = gbb.$(event.currentTarget).first()
                    let optionValue = gbbPurchaseOption.attr('data-purchase-type')
                    const sellingPlansArray = gbb.gbbSubscriptionProductsPage.state.sellingPlansArray || []
                    const { ONE_TIME_PURCHASE } = gbb.gbbSubscriptionProductsPage.state.constants

                    if (gbbPurchaseOption.hasClass("active")) {
                        return
                    }
                    gbb.$('.gbbPurchaseOption').removeClass('active')
                    gbbPurchaseOption.addClass('active')
                    gbb.gbbSubscriptionProductsPage.state.purchaseType = optionValue
                    if (optionValue == ONE_TIME_PURCHASE) {
                        gbb.gbbSubscriptionProductsPage.state.activeSellingPlanId = null
                        gbb.gbbSubscriptionProductsPage.state.activeSellingPlanDetails = null
                    } else {
                        let sellingPlanToSetActive = sellingPlansArray[0] || {}
                        gbb.gbbSubscriptionProductsPage.state.activeSellingPlanId = gbb.utility.extractIdsFromGraphQlId(sellingPlanToSetActive?.id) || null
                        gbb.gbbSubscriptionProductsPage.state.activeSellingPlanDetails = sellingPlanToSetActive || null
                    }
                    let updatedPageHeader = gbb.gbbSubscriptionProductsPage.f.prepareSubscriptionHeaderHTML()
                    gbb.$(".gbbSubscriptionBundleWrapper").replaceWith(updatedPageHeader);
                    await gbb.gbbSubscriptionProductsPage.f.resetProductsDataBasedOnActiveSellingPlan()
                } catch (error) {
                    gbb.utility.debugError("error in handlePurchaseOptionClick", error)
                }
            },
            preparePurchaseOptionsUI: function () {
                try {
                    const activePurchaseType = gbb.gbbSubscriptionProductsPage.state.purchaseType
                    const languageFields = gbb.gbbSubscriptionProductsPage.state.languageFields
                    const { ONE_TIME_PURCHASE, SUBSCRIPTION_PURCHASE } = gbb.gbbSubscriptionProductsPage.state.constants
                    const options = [
                        {
                            label: languageFields.oneTimePurchaseLabel,
                            value: ONE_TIME_PURCHASE,
                            isActive: activePurchaseType == ONE_TIME_PURCHASE,
                        },
                        {
                            label: languageFields.subscriptionPurchaseLabel,
                            value: SUBSCRIPTION_PURCHASE,
                            isActive: activePurchaseType == SUBSCRIPTION_PURCHASE,
                        }
                    ]
                    let gbbPurchaseOptionsWrapper = gbb.$('<div>').addClass('gbbPurchaseOptionsWrapper')
                    let gbbPurchaseOptionsTitle = gbb.$('<div>').addClass("gbbPurchaseOptionsTitle")
                    let gbbPurchaseOptionsButtonWrapper = gbb.$('<div>').addClass('gbbPurchaseOptionsButtonWrapper')
                    gbbPurchaseOptionsTitle.text(gbb.gbbSubscriptionProductsPage.state.languageFields.frequencyLabel)

                    options.forEach((option) => {
                        let gbbPurchaseOption = gbb.$('<div>').addClass('gbbPurchaseOption')
                        let gbbPurchaseOptionTextContent = gbb.$("<div>").addClass('gbbPurchaseOptionTextContent')
                        gbbPurchaseOptionTextContent.text(option.label)
                        gbbPurchaseOption.attr('data-purchase-type', option.value)
                        if (option.isActive) {
                            gbbPurchaseOption.addClass('active')
                        }
                        gbbPurchaseOption.on("click", gbb.gbbSubscriptionProductsPage.f.handlePurchaseOptionClick)
                        gbbPurchaseOption.append(gbbPurchaseOptionTextContent)
                        gbbPurchaseOptionsButtonWrapper.append(gbbPurchaseOption)
                    })
                    gbbPurchaseOptionsWrapper.append(gbbPurchaseOptionsTitle)
                    gbbPurchaseOptionsWrapper.append(gbbPurchaseOptionsButtonWrapper)
                    return gbbPurchaseOptionsWrapper;
                } catch (error) {
                    gbb.utility.debugError('error in gbbSubscriptionProductsPage.f.preparePurchaseOptionsUI', error)
                }
            },
            subscriptionBundlesInit: function (subscriptionBundlesData) {
                try {
                    gbb.gbbSubscriptionProductsPage.f.setSubscriptionBundlesSettings(subscriptionBundlesData)
                    gbb.gbbSubscriptionProductsPage.f.setCssVariablesForSubscriptionProductsPage()
                } catch (error) {
                    gbb.utility.debugError("error in gbbSubscriptionProductsPage.f.subscriptionBundlesInit", error)
                }
            },
            calculateSubscriptionProductDiscountValue: function (variantInfo) {
                try {
                    const { activeSellingPlanDetails } = gbb.gbbSubscriptionProductsPage.state;
                    const pricingPolicies = activeSellingPlanDetails?.pricingPolicies || [];

                    if (!variantInfo || !activeSellingPlanDetails || pricingPolicies.length === 0) return 0;

                    const activePricingPolicy = pricingPolicies[0];
                    const { adjustmentType: discountType, adjustmentValue } = activePricingPolicy || {};
                    let discountValue = 0;

                    switch (discountType) {
                        case 'FIXED_AMOUNT':
                            discountValue = parseInt(adjustmentValue?.amount) * 100;
                            return discountValue > 0 ? gbb.utility.formatPrice(discountValue) : false;

                        case 'PRICE':
                            discountValue = parseInt(adjustmentValue?.amount);
                            const variantPrice = variantInfo.price / 100;
                            const calculateDiscountOn = variantPrice - discountValue;
                            const percentageDiscount = Math.max((calculateDiscountOn / variantPrice) * 100, 0);
                            return percentageDiscount > 0 ? Math.floor(percentageDiscount) + '%' : false;

                        case 'PERCENTAGE':
                            discountValue = adjustmentValue?.percentage;
                            return discountValue > 0 ? discountValue + '%' : false;

                        default:
                            return discountValue;
                    }
                } catch (error) {
                    gbb.utility.debugError('error in gbbSubscriptionProductsPage.f.calculateSubscriptionProductDiscountValue', error);
                }
            }
            ,
            prepareSubscriptionProductDiscountRibbonUI: function (variantDetails) {
                try {
                    const gbbSubscriptionDiscountRibbon = gbb.$('<div>').addClass('gbbSubscriptionDiscountRibbon')
                    const gbbSubscriptionDiscountContent = gbb.$('<div>').addClass('gbbSubscriptionDiscountContent')
                    const discountValue = gbb.gbbSubscriptionProductsPage.f.calculateSubscriptionProductDiscountValue(variantDetails)
                    if (discountValue) {
                        gbbSubscriptionDiscountContent.text(`-${discountValue}`)
                        gbbSubscriptionDiscountRibbon.append(gbbSubscriptionDiscountContent)
                        return gbbSubscriptionDiscountRibbon
                    }
                } catch (error) {
                    gbb.utility.debugError('error in gbbSubscriptionProductsPage.f.prepareSubscriptionProductDiscountRibbonUI', error)
                }
            },
            getSubscriptionPriceByVariantId: function (variantId) {
                try {
                    const variantData = gbb.utility.getVariantDetailsFromCurrentProductsDataSet(variantId)
                    const { selling_plan_allocations } = variantData
                    const activeSellingPlanId = gbb.gbbSubscriptionProductsPage.state.activeSellingPlanId
                    const groupId = gbb.gbbSubscriptionProductsPage.state.selectedSellingPlanGroupId
                    if (!variantData) return 0

                    if (!activeSellingPlanId || !selling_plan_allocations || selling_plan_allocations.length == 0) {
                        return variantData.price
                    }

                    const activeSellingPlanAllocation = selling_plan_allocations.find((allocation) => {
                        return allocation.selling_plan_id == activeSellingPlanId
                    })

                    if (!activeSellingPlanAllocation) {
                        return variantData.price
                    }

                    return activeSellingPlanAllocation.price

                } catch (error) {
                    gbb.utility.debugError("error in gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId", error)
                }
            }
        },

    },
    gbbAddonProducts: {
        f: {
            addonProductsInit: function (tmpCartSettings) {
                try {
                    let addonsData = tmpCartSettings.stepsConfigurationData.personalizationData.addonProducts || {}
                    if (Object.keys(addonsData).length > 0 && addonsData?.isEnabled) {
                        let eligibleTiersData = JSON.parse(gbb.storage.getItem(`eligible-tiers-for-addons-${gbb.state.bundleId}`))
                        let statesToUpdate = {
                            isEnabled: addonsData?.isEnabled,
                            tiers: addonsData?.tiers,
                            isSkippable: addonsData?.isSkippable,
                            title: addonsData?.title,
                            eligibleTierForAddons: eligibleTiersData || null,
                            offerId: addonsData?.offerId || null,
                            addonsMessaging : addonsData?.addonsMessaging,
                            displayVariantsAsIndividualProducts_addons: addonsData?.displayVariantsAsIndividualProducts_addons || false,
                        }
                        gbb.gbbAddonProducts.state = { ...gbb.gbbAddonProducts.state, ...statesToUpdate }
                        // gbb.gbbAddonProducts.f.calculateEligibleAddonProductsTier("personalizationPage") // forcefully calculate
                    }
                    return addonsData
                } catch (error) {
                    gbb.utility.debugError("error in gbbAddonProducts.f.addonProductsInit", error)
                }
            },
            getCartTotalItemsAndTotalPriceForAddons: function () {
                try {
                    let cartDataFromSession = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(gbb.state.activeBoxId)
                    let { items: cartItems } = cartDataFromSession || {}
                    let blackListedBoxProductKeys = ["greetingCard", "addonProduct", "giftMessage"]
                    let total_price = 0
                    let item_count = 0
                    cartItems?.forEach((item) => {
                        if (!blackListedBoxProductKeys.includes(item.properties._boxProduct)) {
                            total_price += item.price * item.quantity
                            item_count += item.quantity
                       }
                    })
                    return { total_price, item_count }
                } catch (error) {
                    gbb.utility.debugError("error in gbbAddonProducts.f.getCartTotalItemsAndTotalPriceForAddons", error)
                }
            },
            calculateEligibleAddonProductsTier: function (origin) {
                try {
                    let isAddonEnabled = gbb.gbbAddonProducts.state.isEnabled 
                    let isCurrentPageTypePersonalization = gbb.state.currentPageId == 'personalizationPage'
                    let qualifiedTierIndex = null
                    let tiers = gbb.gbbAddonProducts.state.tiers 

                    if (!origin && (!isAddonEnabled || isCurrentPageTypePersonalization)) {
                        return null
                    }

                    let { total_price, item_count } = gbb.gbbAddonProducts.f.getCartTotalItemsAndTotalPriceForAddons()
                    for (let idx = 0; idx < tiers.length; idx++) { 
                        let { type, value } = tiers[idx]?.condition
                        value = +value
                        total_price = total_price / 100 

                         if (type == "QUANTITY" && item_count>= value) {
                            qualifiedTierIndex = idx
                         } else if (type == 'AMOUNT' && total_price >= gbb.utility.convertFromStoreCurrencyToCustomer(value)) {
                            qualifiedTierIndex = idx
                        }
                    }

                    if (!qualifiedTierIndex && tiers[0]?.condition?.isValidateEligibilityConditionEnabled == false) {
                        qualifiedTierIndex = 0
                    }
                    let qualifiedTier = qualifiedTierIndex!==null ? tiers[qualifiedTierIndex] : null
                    
                    if (qualifiedTier) {
                        gbb.gbbAddonProducts.f.updateProductAndVariantPricesBasedOnAddonTier(qualifiedTier)
                        qualifiedTier.tierIndex = qualifiedTierIndex
                    } else {
                        gbb.gbbAddonProducts.f.removeAddonProductsFromCart()
                        let productsShopifyData = gbb.gbbAddonProducts?.state?.productsShopifyData || {}
                        gbb.gbbAddonProducts.f.setMapForVariantId_addons(productsShopifyData);
                    }
                    gbb.storage.setItem(`eligible-tiers-for-addons-${gbb.state.bundleId}`, JSON.stringify(qualifiedTier))
                    gbb.gbbAddonProducts.state.eligibleTierForAddons = qualifiedTier

                    return qualifiedTier

                } catch (error) {
                    gbb.utility.debugError("error in gbbAddonProducts.f.calculateEligibleAddonProductsTier", error)
                }
            },
            removeAddonProductsFromCart: async function () {
                try {
                    let { items } = gbb.state.giftBoxCartData || {}
                    let addonProducts = items.filter((item) => {
                        return item.properties._boxProduct == 'addonProduct'
                    })

                    for (let i = 0; i < addonProducts.length; i++){
                        let dataToSend = {
                            qty: 0,
                            variant:addonProducts[i]
                        }
                        await gbb.utility.removeFromCart(dataToSend,"addonProduct")
                    }

                    return addonProducts
                } catch (error) {
                    gbb.utility.debugError('error in removeAddonProductsFromCart', error)
                }
            },
            getAddonProductsToRender: function ({ selectedAddonProducts: qualifiedProducts, displayVariantsAsIndividualProducts_addons=false }){
                try {
                    let prefetchedProductsData = gbb.gbbAddonProducts.state.addonProductsDataByHandle || {}
                    let productsToRender = []
                    for (let product of qualifiedProducts) {
                        let currentProductData = prefetchedProductsData[product.handle]
                        if (displayVariantsAsIndividualProducts_addons) {
                            const { variants, ...productAttrs } = currentProductData;
                            variants.forEach((variant) => {
                                let merged = {
                                    ...productAttrs,
                                    compare_at_price: variant.compare_at_price,
                                    variants: [variant]
                                };
                                merged = gbb.gbbAddProductsPage.f.updateProductDataWithFirstVariantData(merged)
                                productsToRender.push(merged);
                            });
                        } else {
                            productsToRender.push(currentProductData)
                        }
                    } 
                    return productsToRender
                } catch (error) {
                    gbb.utility.debugError("error in gbbAddonProducts.f.getAddonProductsToRender", error)
                }
            },
            setPrefetchedAddonsData: function (addonProductsData) {
                try {
                    let productsDataById = {}
                    let productsDataSet = []
                    let productsDataByHandle ={}
                    for (let [key, value] of Object.entries(addonProductsData)) { 
                        let productData = value
                        productData.customProductAttribute = 'addonProduct'
                        productsDataById[productData.id] = productData
                        productsDataByHandle[productData.handle] = productData
                        productsDataSet.push(productData)
                    }
                    gbb.gbbAddonProducts.state.addonProductsDataByHandle = productsDataByHandle
                    gbb.gbbAddonProducts.state.addonProductsDataById = productsDataById
                    gbb.gbbAddonProducts.state.addonProductsDataSet = productsDataSet
                } catch (error) {
                    gbb.utility.debugError('error in gbbAddonProducts.f.setPrefetchedAddonsData')
                }
            },
            prepareAddonProductsUI: function () {
                try {
                    let gbbAddonProductsWrapper = gbb.$("<div>").addClass("gbbAddonProductsWrapper");
                    let gbbAddonProductsSectionTitle = gbb.$("<div>").addClass("gbbAddonProductsSectionTitle");
                    let gbbAddonProductsContainer = gbb.$("<div>").addClass("gbbProductsContainer");
                    gbbAddonProductsContainer.addClass("gbbProductsItemsContainer")
                    let eligibleTier = gbb.gbbAddonProducts.state.eligibleTierForAddons   
                    if (!eligibleTier) {
                        eligibleTier = gbb.gbbAddonProducts.state.tiers[0] || {}
                        gbbAddonProductsContainer.addClass("notEligibleForAddons")
                    }
                    gbb.gbbAddonProducts.f.updateProductAndVariantPricesBasedOnAddonTier(eligibleTier)
                    // let { selectedAddonProducts = [] } = eligibleTier

                    let productsDataToRender = gbb.gbbAddonProducts.f.getAddonProductsToRender(eligibleTier)
                    let productCardsHTML = gbb.f.renderProductsHTML(productsDataToRender,'personalizePage')
                    gbbAddonProductsSectionTitle.html(gbb.gbbAddonProducts.state.title)

                    gbbAddonProductsContainer.append(productCardsHTML)
                    gbbAddonProductsWrapper.append(gbbAddonProductsSectionTitle)
                    gbbAddonProductsWrapper.append(gbbAddonProductsContainer)
                    return gbbAddonProductsWrapper
                } catch (error) {
                    gbb.utility.debugError('error in prepareAddonProductsUI')
                }
            },
            prepareDiscountRibbonContentForProductAddons: function () {
                try {
                    let eligibleTier = gbb.gbbAddonProducts.state.eligibleTierForAddons

                    if (!eligibleTier) {
                        eligibleTier = gbb.gbbAddonProducts.state.tiers[0] || {} // for disable state
                    }

                    let { type, value} = eligibleTier?.discount || {}
                    let discountText = ''
                    if (value && +value > 0 && type == "PERCENTAGE") {
                        discountText = value == 100 ? "Free" : `${value}% off`
                    }

                    return {
                        type,
                        value,
                        discountText
                    }

                } catch (error) {
                    gbb.utility.debugError('error in prepareDiscountRibbonContentForProductAddons',error)
                }
            },
            checkAddonsConditionsOnNext: function () {
                try {
                    let result = true
                    let isAddonSkippable = gbb.gbbAddonProducts.state.isSkippable
                    let eligibleTierForAddons = gbb.gbbAddonProducts.state.eligibleTierForAddons || {}
                    let isEligibleForAddons = Object.keys(eligibleTierForAddons).length > 0
                    if (isEligibleForAddons && !isAddonSkippable) {
                        let cartDataItems = gbb.state.giftBoxCartData.items || []
                        // check if any of the items.properties._boxProduct - addonProduct
                        let isAddonProductExistInCart = cartDataItems.some((item) => {
                            return item.properties._boxProduct == "addonProduct"
                        })
                        result = isAddonProductExistInCart
                    }
                    return result
                } catch (error) {
                    gbb.utility.debugConsole('error in checkAddonsConditionsOnNext', error)
                }
            },
            checkMaxAddonProductsConditions: function ({productQtyToAdd}) {
                try {
                    let result = {
                        isConditionMet:true
                    }
                    let isAddonsEnabled = gbb.gbbAddonProducts.state.isEnabled 
                    let eligibleTiersData = gbb.gbbAddonProducts.state.eligibleTierForAddons
                    let cartItems = gbb.state.giftBoxCartData.items || []
                    let isEligibleForAddons = Object.keys(eligibleTiersData).length>0
                    if (!isAddonsEnabled || !isEligibleForAddons) return result
                    let maxAddonsAllowed = +eligibleTiersData.configurations.maxAddonProductsAllowed
                    let totalAddonsInCart = 0
                    cartItems.forEach((product, idx) => {
                        if (product.properties._boxProduct == 'addonProduct') {
                            totalAddonsInCart+=product.quantity 
                        }
                    })
                    if ((totalAddonsInCart + productQtyToAdd) > maxAddonsAllowed) {
                        result.isConditionMet = false
                        let message = gbb.settings?.languageData?.addons?.maxAddonProductsAllowed?.value 
                        // let message = `add maximum ##maxAllowedAddons## products to continue`
                        if (message) {
                            message = message.replace(new RegExp('##maxAllowedAddons##', 'g'), maxAddonsAllowed);
                        } else {
                            message = `1Only add upto ${maxAddonsAllowed}`
                        }
                        gbb.f.renderConditionNotificationToast(message)
                    }
                    
                    return result
                } catch (error) {
                    gbb.utility.debugConsole('error in checkMaxAddonProductsConditions',error)
                }
            },
            setMapForVariantId_addons: function (productsObj) {
                try {
                    if(Object.keys(productsObj).length == 0) return
                    let data = gbb.utility.productDetailsWith_VariantId_Or_ProductIdAsKey(productsObj)
                    gbb.gbbAddonProducts.state.currentProductsDataSetForVariants_addons = { ...gbb.gbbAddonProducts.state.currentProductsDataSetForVariants_addons, ...data };
                } catch (error) {
                    gbb.utility.debugError("error in setMapForVariantId_addons", error)
                }
            },
            updateProductAndVariantPricesBasedOnAddonTier: function (qualifiedTier) {
                try {
                    let discountValue = qualifiedTier?.discount?.value || 0
                    let products = JSON.parse(JSON.stringify(gbb.gbbAddonProducts.state.productsShopifyData))
                    const updateProductOrVariantPrice = (data) => {
                        let discountedPrice = data.price - (data.price * discountValue / 100)
                        let updatedCompareAtPrice = data.price
                        data.compare_at_price = updatedCompareAtPrice 
                        data.price = discountedPrice
                        return data
                    }
                    for (let [key, value] of Object.entries(products)) {
                        let currentProductDetails = value 
                        currentProductDetails = updateProductOrVariantPrice(currentProductDetails)
                        for (let variantIdx = 0; variantIdx < currentProductDetails.variants.length; variantIdx++) { 
                            let currentVariant = currentProductDetails.variants[variantIdx]
                            currentProductDetails.variants[variantIdx] = updateProductOrVariantPrice(currentVariant)
                        }
                        products[key] = currentProductDetails
                    }
                    gbb.gbbAddonProducts.f.setPrefetchedAddonsData(products)
                    gbb.gbbAddonProducts.f.setMapForVariantId_addons(products);

                    return products
                } catch (error) {
                    gbb.utility.debugError("error in gbbAddonProducts.f.updateProductAndVariantPricesBasedOnAddonTier",error)
                }
            },
            replaceIneligibleConditionVariables: function (message) {
                try {
                    let firstTierInfo = gbb.gbbAddonProducts.state.tiers[0] || {}
                    let { type, value } = firstTierInfo?.condition || {}
                    let { total_price, item_count } = gbb.gbbAddonProducts.f.getCartTotalItemsAndTotalPriceForAddons()

                    function calculateDiffValue(type, value, item_count, total_price) {
                        let diffValue = null
                        if (type === 'QUANTITY') {
                            diffValue = value - item_count;
                        } else if (type === 'AMOUNT') {
                            total_price = total_price / 100;
                            value = gbb.utility.convertFromStoreCurrencyToCustomer(value);
                            diffValue =  (value - total_price).toFixed(2);
                        }
                        return diffValue;
                    }

                    function replaceMessagePlaceholders(message, diffValue, type) {
                        message = message.replace("##AddonsConditionDiff##", diffValue);
                        if (type === 'AMOUNT') {
                            message = message.replace("##currencyUnit##", gbb.utility.getCurrencySymbol());
                        }
                        return message;
                    }

                    const diffValue = calculateDiffValue(type, value, item_count, total_price);
                    if (diffValue !== null) {
                        message = replaceMessagePlaceholders(message, diffValue, type);
                    }
                    return message
                } catch (error) {
                    gbb.utility.debugError("error in gbbAddonProducts.f.replaceIneligibleConditionVariables", error)
                }
            },
            getAddonsMessageToRender: function () {
                try {
                    let message = ""
                    let eligibleTier = gbb.gbbAddonProducts.state.eligibleTierForAddons
                    let addonsMessaging = gbb.gbbAddonProducts.state.addonsMessaging 
                    
                    if (!eligibleTier) {
                        let ineligibleMessaging = addonsMessaging?.ineligibleState
                        message = gbb.gbbAddonProducts.f.replaceIneligibleConditionVariables(ineligibleMessaging)
                    } else {
                        let activerTierIndex = eligibleTier?.tierIndex
                        if (activerTierIndex == null) return message;
                        message = addonsMessaging[`tier${activerTierIndex + 1}`]?.eligibleState
                    }

                    return message
                } catch (error) {
                    gbb.utility.debugError("error in getAddonsMessageToRender",error)
                }
            },
            checkIfAddonsMessagingNeeded: function () {
                try {
                    let isAddonsEnabled = gbb.gbbAddonProducts.state.isEnabled || false;
                    let isMessagingEnabled = gbb.gbbAddonProducts.state.addonsMessaging?.isEnabled || false;
                    let isCurrentPageTypePersonalization = gbb.state.currentPageId == "personalizationPage"
                    return isAddonsEnabled && isMessagingEnabled && isCurrentPageTypePersonalization
                } catch (error) {
                    gbb.utility.debugError("error in checkIfAddonsMessagingNeeded",error)
                }
            },

        },
        settings:{},
        state: {
            isEnabled: false,
            title: "",  
            isSkippable:true,
            tiers: [],
            activeTier:null,
            addonProductsDataByHandle: {},
            addonProductsDataById: {},
            addonProductsDataSet: [],
            eligibleTierForAddons:null,
            offerId: null,
            addonsMessaging: null
        },
        utility:{}
    },
    gbbMultipleCategoriesPage: {
        state: {
            buildBoxButtonAction: undefined,
            categoryStatus: {},
            currentCategory: undefined,
            currentIndex: undefined,
            currentCategoryId: undefined,
            // giftBoxData: null,
        },
        f: {
            prepareUIV2: async function (productPageData) {
                let gbbMultipleCategoriesPageHTML;
                let noteAttribute = gbb.state.currentPageId;
                let gbbMultipleCategoriesContainerHTML = gbb.$("<div>").addClass("gbbMultipleCategoriesContainerHTML");

                gbbMultipleCategoriesPageHTML = gbb.$("<div>").addClass("gbbMultipleCategoriesPageHTML");
                let categories = gbb.utility.convertObjectToArray(productPageData?.categories)
                for (let i = 0; i < categories.length; i++) {
                    // categories?.forEach(async (category, index) => {
                    let category = categories[i];
                    let index = i;
                    let gbbCategoryContainer = gbb.$("<div>").addClass("gbbCategoryContainer");
                    gbbCategoryContainer.css("background", gbb.settings.pageCustomizationData?.categoryBlock?.categoryBgColor || "#FFFFFF")
                    let gbbCategoryHeaderContainer = gbb.$("<div>").addClass("gbbCategoryHeaderContainer").attr("currentIndex", index).attr("categoryId", category.categoryId);
                    let gbbCategoryBodyContainer = gbb.$("<div>").addClass("gbbCategoryBodyContainer" + category.categoryId);

                    //data attribute to store the category id
                    gbbCategoryContainer.attr("categoryId", category.categoryId);

                    let gbbCategoryToggleButton = gbb.$("<img>").addClass("gbbCategoryToggleButton" + index);
                    gbbCategoryToggleButton.attr("src", CONSTANT_IMAGES_DROPDOWN_BUTTON);
                    gbbCategoryToggleButton.css("transform", "rotate(90deg)");

                    let gbbCategoryImage = gbb.$("<img>").addClass("gbbCategoryImage");
                    gbbCategoryImage.attr("src", category.categoryImg);


                    // let gbbCategoryBannerImage = gbb.$("<img>").addClass("gbbCategoryImage").addClass("gbbCategoryBanner")
                    // gbbCategoryBannerImage.attr("src", category?.categoryBanner);

                    if (category?.categoryBanner) {



                        gbbCategoryContainer.addClass("bannerAttached");

                        gbbCategoryImage.attr("src", category?.categoryBanner)
                        // let insertDynamicStyle = ``;

                        // gbb.$("head").append(`<style>${insertDynamicStyle}</style>`);
                    }

                    let gbbCategoryTitlesContainer = gbb.$("<div>").addClass("gbbCategoryTitlesContainer");
                    let gbbCategoryTitle = gbb.$("<div>").addClass("gbbCategoryTitle");
                    let gbbCategorySubTitle = gbb.$("<div>").addClass("gbbCategorySubTitle");

                    gbbCategoryTitle.text(category.title || "Category");
                    gbbCategorySubTitle.text(category.subTitle || "");

                    gbbCategoryTitlesContainer.append(gbbCategoryTitle)
                    gbbCategoryTitlesContainer.append(gbbCategorySubTitle)

                    gbbCategoryHeaderContainer.append(gbbCategoryToggleButton)
                    gbbCategoryHeaderContainer.append(gbbCategoryImage)
                    gbbCategoryHeaderContainer.append(gbbCategoryTitlesContainer)

                    let gbbProductsContainer = gbb.$("<div>").addClass("gbbProductsContainer");
                    // let gbbProductsItemsContainer = gbb.$("<div>").addClass("gbbProductsItemsContainer");
                    // gbbProductsItemsContainer.append(gbb.f.renderProductsHTML(category.dataFromShopify, noteAttribute, category.categoryId));

                    if (gbb.gbbMultipleCategoriesPage.currentIndex != undefined && gbb.gbbMultipleCategoriesPage.currentIndex == index) {
                        gbb.utility.debugConsole("prepareUiV2 for multipleCategories was called")
                        gbb.state.setInfiniteScrollTrackerForProducts = true;
                        gbb.gbbAddProductsPage.state.dataForInfiniteScroll = {
                            noteAttribute: noteAttribute,
                            categoryId: category.categoryId,
                            allProductsData: category.uniqueProductsData,
                        }
                        let renderData = await gbb.gbbAddProductsPage.f.renderProductsCardContainer(category.uniqueProductsData, noteAttribute, "initFlow", category.categoryId)
                        renderData.find(".gbbFiltersSearchSortHeader").remove()
                        gbbProductsContainer.append(renderData)
                        gbbCategoryToggleButton.css("transform", "rotate(360deg)");
                    } else {
                        gbbCategoryBodyContainer.hide();
                    }

                    // gbbProductsContainer.append(gbbProductsItemsContainer);

                    gbbCategoryBodyContainer.append(gbbProductsContainer);
                    gbbCategoryContainer.append(gbbCategoryHeaderContainer);
                    gbbCategoryContainer.append(gbbCategoryBodyContainer);



                    gbbCategoryHeaderContainer.on("click", async (event) => {
                        if (!event) {
                            return
                        }
                        let gbbMultipleCategoriesPageHTMLEle = gbb.$(".gbbAddGiftBoxPageWrapper").find(".gbbMultipleCategoriesPageHTML");
                        // gbb.gbbMultipleCategoriesPage.f.eventListenerForPrepareUIV2(event, gbbMultipleCategoriesPageHTMLEle, false, gbbCategoryHeaderContainer);
                        let categoryObjData = {
                            clickedIndex: event.currentTarget.attributes.currentIndex.value,
                            gbbMultipleCategoriesPageHTMLEle: gbbMultipleCategoriesPageHTMLEle,
                            isTabBasedUI: false,
                            clickedCategoryId: gbbCategoryHeaderContainer.attr('categoryId')
                        }
                        gbb.gbbMultipleCategoriesPage.f.eventListenerForPrepareUIV2(event, categoryObjData);

                        // let clickedIndex = event.currentTarget.attributes.currentIndex.value
                        // let currentIndex = gbb.gbbMultipleCategoriesPage.currentIndex
                        // gbb.$(".gbbAddGiftBoxPageWrapper").find("gbbMultipleCategoriesContainerHTML").css("pointer-events", "none")
                        // if (currentIndex != undefined && currentIndex == clickedIndex) {
                        //     gbb.gbbMultipleCategoriesPage.currentIndex = undefined;
                        //     gbbMultipleCategoriesPageHTMLEle.html(await gbb.gbbMultipleCategoriesPage.f.prepareUIV2(gbb.gbbAddProductsPage.state.productPageData))
                        // } else {
                        //     gbb.gbbMultipleCategoriesPage.currentIndex = event.currentTarget.attributes.currentIndex.value
                        //     gbbMultipleCategoriesPageHTMLEle.html(await gbb.gbbMultipleCategoriesPage.f.prepareUIV2(gbb.gbbAddProductsPage.state.productPageData))
                        //     let categoryId = gbbCategoryHeaderContainer.attr('categoryId');
                        //     gbb.utility.debugConsole(categoryId);
                        //     let selectedDiv = gbb.$(`div[categoryId='${categoryId}']`)
                        //     gbb.$('html, body').scrollTop(selectedDiv.offset().top-100);
                        //     // window.selectedDiv = selectedDiv;
                        // }
                        // isCategoryPrductsVisible = !isCategoryPrductsVisible
                    })



                    gbbMultipleCategoriesContainerHTML.append(gbbCategoryContainer);
                }
                //no navigation will be available if there is only one step enabled - adjust the positioning
                let navigationItems = gbb.state.navigationItems;


                //navigation icons not present

                //gbbAddProductsPageHTML.append(gbb.f.renderFiltersSideBarHTML(noteAttribute));
                gbbMultipleCategoriesPageHTML.append(gbbMultipleCategoriesContainerHTML);
                return gbbMultipleCategoriesPageHTML;

            },
            prepareUIV2TabUI: async function (productPageData) {
                try {
                    gbb.utility.debugConsole("inside tab ui");
                    let gbbMultipleCategoriesPageHTML;
                    let noteAttribute = gbb.state.currentPageId;
                    let gbbMultipleCategoriesContainerHTML = gbb.$("<div>").addClass("gbbMultipleCategoriesContainerHTMLForTabUI");
                    let categories = gbb.utility.convertObjectToArray(productPageData?.categories);
                    gbb.gbbMultipleCategoriesPage.f.setCurrentCategory(categories);
                    let activeCategory = gbb.gbbMultipleCategoriesPage.state.currentCategory;

                    gbbMultipleCategoriesPageHTML = gbb.$("<div>").addClass("gbbMultipleCategoriesPageHTMLForTabUI");
                    let gbbMultipleCategoriesRibbonContainer = gbb.$("<div>").addClass("gbbMultipleCategoriesRibbonContainer");
                    let gbbMultipleCategoriesDropdownContainer = gbb.$("<div>").addClass("gbbMultipleCategoriesDropdownContainer");
                    let gbbFilterSearchHTML = gbb.f.renderFiltersSearchSortHeaderHTML(noteAttribute)
                    gbb.$(gbbFilterSearchHTML).find('.gbbSearchBarMainWrapper').css('grid-column', 2)
                    // create a dropdown aswell
                    let gbbMutipleCategoriesDropdown = gbb.$("<select>").addClass("gbbMutipleCategoriesDropdown");
                    if (gbb.settings.pageCustomizationData?.categoryBlock?.tabActiveBgColor) {
                        gbbMutipleCategoriesDropdown.css("background", gbb.settings.pageCustomizationData?.categoryBlock?.tabActiveBgColor)
                    }
                    if (gbb.settings.pageCustomizationData?.categoryBlock?.tabActiveTextColor) {
                        gbbMutipleCategoriesDropdown.css('color', gbb.settings.pageCustomizationData?.categoryBlock?.tabActiveTextColor)
                    }
                    // let gbbMultipleCategoriesDropdownArrow = gbb.$("<img>").addClass("gbbMultipleCategoriesDropdownArrow");
                    // gbbMultipleCategoriesDropdownArrow.attr("src", ARROW_DOWN_SVG);
                    let gbbMultipleCategoriesDropdownArrow = gbb.$("<div>").addClass("gbbMultipleCategoriesDropdownArrow");
                    gbbMultipleCategoriesDropdownArrow.append(ARROW_DOWN_SVG);


                    let gbbMultipleCategoriesActiveCategorySubtitle = gbb.$("<div>").addClass("gbbMultipleCategoriesActiveCategorySubtitle");
                    for (let i = 0; i < categories.length; i++) {
                        let category = categories[i];
                        let index = i;
                        let gbbCategoryContainer = gbb.$("<div>").addClass("gbbCategoryContainer");
                        gbbCategoryContainer.addClass("gbbCategoryContainerTabUI")
                        if (gbb.settings.pageCustomizationData?.categoryBlock?.tabInactiveBgColor) {
                            gbbCategoryContainer.css("background", gbb.settings.pageCustomizationData?.categoryBlock?.tabInactiveBgColor)

                        }
                        if (gbb.settings.pageCustomizationData?.categoryBlock?.tabInactiveTextColor) {
                            gbbCategoryContainer.css('color', gbb.settings.pageCustomizationData?.categoryBlock?.tabInactiveTextColor)
                        }
                        // gbbCategoryContainer.css("background",gbb.settings.pageCustomizationData.colors.secondaryColor || "#FFFFFF").css("color",gbb.settings.pageCustomizationData.colors.textColor || "black" );
                        let optionValue = gbb.$("<option>").attr("value", category.categoryId).attr("categoryId", category.categoryId).text(category.title || "Category").attr("currentIndex", index)


                        // give active status to selected category
                        if (activeCategory != undefined && activeCategory.categoryId == category.categoryId) {
                            gbbCategoryContainer.addClass("gbbCategoryContainerTabUIActive");
                            optionValue.attr("selected", "selected")
                            // gbbCategoryContainer.css("background",gbb.settings.pageCustomizationData.colors.primaryColor || "#FFFFFF").css("color",gbb.settings.pageCustomizationData.colors.textColor || "black" );
                        }



                        // give active status to first category if no category is selected
                        if (activeCategory == undefined && index == 0) {
                            gbbCategoryContainer.addClass("gbbCategoryContainerTabUIActive");
                            activeCategory = category;
                            gbb.gbbMultipleCategoriesPage.state.currentCategoryId = category.categoryId;
                            gbb.gbbMultipleCategoriesPage.f.setCurrentCategory(categories);
                        }

                        if (gbbCategoryContainer.hasClass("gbbCategoryContainerTabUIActive")) {
                            if (gbb.settings.pageCustomizationData?.categoryBlock?.tabActiveBgColor) {
                                gbbCategoryContainer.css("background", gbb.settings.pageCustomizationData?.categoryBlock?.tabActiveBgColor)
                            }
                            if (gbb.settings.pageCustomizationData?.categoryBlock?.tabActiveTextColor) {
                                gbbCategoryContainer.css('color', gbb.settings.pageCustomizationData?.categoryBlock?.tabActiveTextColor)
                            }
                        }




                        // gbbCategoryContainer.css("background", gbb.settings.pageCustomizationData?.categoryBlock?.categoryBgColor || "#FFFFFF")
                        let gbbCategoryHeaderContainer = gbb.$("<div>").addClass("gbbCategoryHeaderContainer").attr("currentIndex", index).attr("categoryId", category.categoryId);
                        gbbCategoryHeaderContainer.addClass("gbbCategoryHeaderContainerTabUI")
                        gbbCategoryContainer.attr("categoryId", category.categoryId);

                        let gbbCategoryTitlesContainer = gbb.$("<div>").addClass("gbbCategoryTitlesContainer");
                        gbbCategoryTitlesContainer.addClass("gbbCategoryTitlesContainerForTabUI");
                        let gbbCategoryTitle = gbb.$("<div>").addClass("gbbCategoryTitle");
                        let gbbCategorySubTitle = gbb.$("<div>").addClass("gbbCategorySubTitleForTabUI");

                        gbbCategoryTitle.html(category.title || "Category");
                        gbbCategorySubTitle.html(category.subTitle || "");

                        let gbbCategoryImage = gbb.$("<img>").addClass("gbbCategoryImageForTabUI");
                        gbbCategoryImage.attr("src", category.categoryImg)

                        gbbCategoryTitlesContainer.append(gbbCategoryTitle);
                        // gbbCategoryTitlesContainer.append(gbbCategorySubTitle);



                        gbbMutipleCategoriesDropdown.append(optionValue)
                        gbbCategoryHeaderContainer.append(gbbCategoryTitlesContainer);
                        gbbCategoryHeaderContainer.append(gbbCategoryImage);
                        gbbCategoryContainer.append(gbbCategoryHeaderContainer);
                        gbbMultipleCategoriesRibbonContainer.append(gbbCategoryContainer);




                        // can we have onChange?
                        gbbMutipleCategoriesDropdown.off("change").on("change", async (event) => {
                            if (!event) {
                                return
                            }
                            // gbb.utility.clearAllFilters(noteAttribute);
                            gbb.utility.debugConsole("event", event);
                            // gbb.f
                            let optionValueClicked = gbb.$(event.currentTarget).find("option:selected");
                            gbb.utility.debugConsole("optionValueClicked", optionValueClicked);
                            let gbbMultipleCategoriesPageHTMLEle = gbb.$(".gbbAddGiftBoxPageWrapper").find(".gbbMultipleCategoriesPageHTMLForTabUI")
                            let categoryObjData = {
                                clickedIndex: optionValueClicked.attr("currentIndex"),
                                gbbMultipleCategoriesPageHTMLEle: gbbMultipleCategoriesPageHTMLEle,
                                isTabBasedUI: true,
                                clickedCategoryId: optionValueClicked.attr("categoryId")
                            }
                            // debugger;
                            gbb.gbbMultipleCategoriesPage.f.eventListenerForPrepareUIV2(event, categoryObjData);

                            // gbb.gbbMultipleCategoriesPage.f.eventListenerForPrepareUIV2(event, gbbMultipleCategoriesPageHTMLEle, true, optionValueClicked)
                        })



                        gbbCategoryHeaderContainer.on("click", async (event) => {
                            gbb.utility.debugConsole("opton value clicked")
                            if (!event) {
                                return
                            }
                            // gbb.utility.clearAllFilters(noteAttribute);
                            let gbbMultipleCategoriesPageHTMLEle = gbb.$(".gbbAddGiftBoxPageWrapper").find(".gbbMultipleCategoriesPageHTMLForTabUI")
                            let categoryObjData = {
                                clickedIndex: event.currentTarget.attributes.currentIndex.value,
                                gbbMultipleCategoriesPageHTMLEle: gbbMultipleCategoriesPageHTMLEle,
                                isTabBasedUI: true,
                                clickedCategoryId: gbbCategoryHeaderContainer.attr('categoryId')
                            }
                            // debugger;
                            gbb.gbbMultipleCategoriesPage.f.eventListenerForPrepareUIV2(event, categoryObjData);

                            // gbb.gbbMultipleCategoriesPage.f.eventListenerForPrepareUIV2(event, gbbMultipleCategoriesPageHTMLEle, true, gbbCategoryHeaderContainer)

                        })
                    }
                    //no navigation will be available if there is only one step enabled - adjust the positioning
                    let navigationItems = gbb.state.navigationItems;

                    // populate the body section
                    let gbbMultipleCategoryBodyContainer = gbb.$("<div>").addClass("gbbMultipleCategoryBodyContainer");
                    let gbbMultipleCategoryBody = gbb.$("<div>").addClass("gbbMultipleCategoryBody");
                    // debugger
                    let gbbProductsContainer = gbb.$("<div>").addClass("gbbMultiCategoryProductsContainer");


                    let renderData = await gbb.gbbMultipleCategoriesPage.f.renderProductsInTabUI(activeCategory, noteAttribute);
                    gbbMultipleCategoriesActiveCategorySubtitle.html(activeCategory.subTitle || "");



                    gbbProductsContainer.append(renderData);
                    gbbMultipleCategoryBody.append(gbbProductsContainer);
                    gbbMultipleCategoryBodyContainer.append(gbbMultipleCategoryBody);

                    //navigation icons not present


                    gbbMultipleCategoriesPageHTML.append(gbbFilterSearchHTML)
                    gbbMultipleCategoriesPageHTML.append(gbbMultipleCategoriesRibbonContainer);

                    gbbMultipleCategoriesDropdownContainer.append(gbbMutipleCategoriesDropdown);
                    // gbbMultipleCategoriesDropdownArrow
                    gbbMultipleCategoriesDropdownContainer.append(gbbMultipleCategoriesDropdownArrow);

                    gbbMultipleCategoriesPageHTML.append(gbbMultipleCategoriesDropdownContainer)
                    gbbMultipleCategoriesPageHTML.append(gbbMultipleCategoriesActiveCategorySubtitle);
                    gbbMultipleCategoriesPageHTML.append(gbbMultipleCategoryBodyContainer);


                    gbbMultipleCategoriesContainerHTML.append(gbbMultipleCategoriesPageHTML);




                    return gbbMultipleCategoriesContainerHTML;
                } catch (error) {
                    gbb.utility.debugConsole("error in prepareUIV2TabUI", error)
                }
            },
            renderProductsInTabUI: async function (activeCategory, noteAttribute) {
                gbb.state.setInfiniteScrollTrackerForProducts = true;
                gbb.gbbAddProductsPage.state.dataForInfiniteScroll = {
                    noteAttribute: noteAttribute,
                    categoryId: activeCategory.categoryId,
                    allProductsData: activeCategory.uniqueProductsData,
                }
                let totalProducts = activeCategory.uniqueProductsData

                // check if search or filter is active then change totalProducts data to render specific products
                let isFilterActive = gbb.utility.getActivatedFilters(noteAttribute).length > 0
                let isSearchActive = gbb.gbbAddProductsPage.state.filterBySearch.searchQuery.searchText.trim().length > 0
                if (isFilterActive) {
                    let filteredProducts = await gbb.utility.getFilteredSortedProductsData(noteAttribute, 'searchProductsFlow')
                    totalProducts = filteredProducts
                }
                if (isSearchActive) {
                    let searchValue = gbb.gbbAddProductsPage.state.filterBySearch.searchQuery.searchText
                    let searchedProducts = await gbb.gbbAddProductsPage.f.handleSearchBundleInput(searchValue, noteAttribute)
                    totalProducts = searchedProducts

                }
                let renderData = await gbb.gbbAddProductsPage.f.renderProductsCardContainer(totalProducts, noteAttribute, "initFlow", activeCategory.categoryId)
                // renderData.find(".gbbFiltersSearchSortHeader").remove() 

                return renderData;
            },
            setCurrentCategory: function (categories) {
                let currentCategoryId = gbb.gbbMultipleCategoriesPage.state.currentCategoryId;
                if (currentCategoryId) {
                    // find category with currentCategoryId
                    let currentCategory = categories.find((category) => {
                        return category.categoryId == currentCategoryId;
                    })
                    gbb.gbbMultipleCategoriesPage.state.currentCategory = currentCategory;
                }
            },
            eventListenerForPrepareUIV2: async function (event, categoryData) {
                // if (!event) {
                //     return
                // }

                let gbbMultipleCategoriesPageHTMLEle = categoryData.gbbMultipleCategoriesPageHTMLEle;
                let isTabBasedUI = categoryData.isTabBasedUI;
                let clickedIndex = categoryData.clickedIndex;
                let clickedCategoryId = categoryData.clickedCategoryId;
                //  gbbCategoryHeaderContainer
                if (clickedCategoryId !== gbb.gbbMultipleCategoriesPage.state.currentCategoryId) {
                    gbb.gbbBrowser.emitCustomEvent({
                        eventName: 'gbb-category-change',
                        detail: {
                            activeCategory: clickedCategoryId,
                            prevCategory: gbb.gbbMultipleCategoriesPage.state.currentCategoryId
                        }
                    })
                }
                gbb.utility.debugConsole("inside eventListenerForPrepareUI V2")

                // let clickedIndex = 
                let currentIndex = gbb.gbbMultipleCategoriesPage.currentIndex;
                gbb.$(".gbbAddGiftBoxPageWrapper").find("gbbMultipleCategoriesContainerHTML").css("pointer-events", "none")
                if (currentIndex != undefined && currentIndex == clickedIndex) {
                    gbb.gbbMultipleCategoriesPage.currentIndex = undefined;
                    gbb.gbbMultipleCategoriesPage.state.currentCategoryId = clickedCategoryId;

                    // firing function as per requirement
                    if (isTabBasedUI) {
                        // reset search value 
                        // gbb.gbbAddProductsPage.f.resetSearchTextValue()
                        gbbMultipleCategoriesPageHTMLEle.html(await gbb.gbbMultipleCategoriesPage.f.prepareUIV2TabUI(gbb.gbbAddProductsPage.state.productPageData));
                    } else {
                        gbbMultipleCategoriesPageHTMLEle.html(await gbb.gbbMultipleCategoriesPage.f.prepareUIV2(gbb.gbbAddProductsPage.state.productPageData))
                    }

                } else {
                    // gbb.gbbMultipleCategoriesPage.currentIndex = event.currentTarget.attributes.currentIndex.value
                    gbb.gbbMultipleCategoriesPage.currentIndex = clickedIndex;
                    // let categoryId = gbbCategoryHeaderContainer.attr('categoryId');
                    let categoryId = clickedCategoryId;
                    gbb.gbbMultipleCategoriesPage.state.currentCategoryId = categoryId;

                    // firing function as per requirement
                    if (isTabBasedUI) {
                        // reset search value 
                        // gbb.gbbAddProductsPage.f.resetSearchTextValue()

                        gbbMultipleCategoriesPageHTMLEle.html(await gbb.gbbMultipleCategoriesPage.f.prepareUIV2TabUI(gbb.gbbAddProductsPage.state.productPageData));
                        gbb.utility.debugConsole(categoryId);
                        let selectedDiv = gbb.$(`div[categoryId='${categoryId}']`)
                        // gbb.$('html, body').scrollTop(selectedDiv.offset().top-200);
                    } else {
                        gbbMultipleCategoriesPageHTMLEle.html(await gbb.gbbMultipleCategoriesPage.f.prepareUIV2(gbb.gbbAddProductsPage.state.productPageData))
                        gbb.utility.debugConsole(categoryId);
                        let selectedDiv = gbb.$(`div[categoryId='${categoryId}']`)
                        gbb.$('html, body').scrollTop(selectedDiv.offset().top - 100);
                    }
                    // window.selectedDiv = selectedDiv;
                }
                return;
            },
        },
    },
    gbbPersonalizePage: {
        state: {
            // buildBoxButtonAction: undefined,
            // giftBoxData: null,
            giftMessage: null,
            scheduleDeliveryDate: null,
            showAllGreetingCardImages: false,
            showAllGiftWrapImages: false,
            greetingCardActiveImageSrc: "",
            giftWrapActiveImageSrc: "",
            emailDeliveryOption: null,
            emailDatePicker: "",
            // senderNameIsChange:false,
            senderName: "",
            // recipientNameIsChange:false,
            recipientName: "",
            customerUploadsResponse: null, //this is an Object.
            customerUploadsErrors: {},
            // additionalGiftMessageInfoIsChange:false,
            // additionalGiftMessageInfo:""
        },
        init: async function (settings, parent) {
            if (true || gbb.state.currentPageId !== 'personalizationPage') {
                gbb.gbbBrowser.emitCustomEvent({
                    eventName: 'gbb-page-init',
                    detail: {
                        prevPageId: gbb.state.currentPageId,
                        activePageId: 'peronalizationPage'
                    }
                })
            }
            gbb.state.currentPageId = "personalizationPage"
            gbb.gbbMultipleCategoriesPage.state.currentCategory = undefined;
            gbb.gbbMultipleCategoriesPage.state.currentCategoryId = undefined
            gbb.gbbAddProductsPage.state.dataForInfiniteScroll = {
                noteAttribute: undefined,
                allProductsData: undefined,
                categoryId: undefined,
            }
            if (gbb?.gbbAddProductsPage?.state?.productPageData) {
                gbb.gbbAddProductsPage.state.productPageData = undefined
            }
            let navItem = gbb.utility.getNavItem(gbb.state.currentPageId)
            gbb.f.markPreviousNavigationItemsAsCompleted(navItem)
            await gbb.utility.getGiftBoxProductsFromCart()
            gbb.gbbPersonalizePage.initialize(settings, parent)
            gbb.gbbPersonalizePage.f.registerEvents(settings);
            gbb.utility.renderTemporaryLoadingSpinner("hide")
            //gbb.gbbPersonalizePage.f.insertIntoMainPageWrapper();
            // gbb.gbbModel.init(settings)
        },
        initialize: async function (settings, parent) {

            let gbbPersonalizePageWrapper = gbb.$("<div>").addClass("gbbPersonalizePageWrapper");
            const gbbPersonalizePageHeaderHTML = gbb.gbbPersonalizePage.f.prepareHeader();

            const gbbPersonalizePageSubtextWrapper = gbb.$("<div>").addClass("gbbPersonalizePageSubtextWrapper");
            const gbbDiscountComponent = gbb.$("<div>").addClass("gbbDiscountComponent");

            const gbbPersonalizePageSubtext = gbb.$("<div>").addClass("gbbPersonalizePageSubtext");
            gbbPersonalizePageSubtext.html(gbb.settings?.stepsConfigurationData?.personalizationData?.personalizePageSubtext)
            // gbbPersonalizePageSubtext.html("Hi")

            gbbPersonalizePageSubtextWrapper.append(gbbPersonalizePageSubtext);

            const gbbPersonalizePageBodyHTML = await gbb.gbbPersonalizePage.f.prepareUI();

            const gbbPersonalizePageFooterHTML = gbb.gbbPersonalizePage.f.prepareFooter();

            gbbPersonalizePageFooterHTML.css("background", gbb.settings.pageCustomizationData.cartFooter.cartFooterBgColor)
            gbbPersonalizePageFooterHTML.css("color", gbb.settings.pageCustomizationData.cartFooter.cartFooterTextColor)

            gbbPersonalizePageWrapper.append(gbbPersonalizePageHeaderHTML);
            gbbPersonalizePageWrapper.append(gbbPersonalizePageSubtextWrapper);
            gbbPersonalizePageWrapper.append(gbbDiscountComponent);
            gbbPersonalizePageWrapper.append(gbbPersonalizePageBodyHTML);
            gbbPersonalizePageWrapper.append(gbbPersonalizePageFooterHTML);

            gbb.state.personalizePageBody = gbbPersonalizePageWrapper;
            gbb.gbbPersonalizePage.f.insertIntoMainPageWrapper();
            gbb.gbbPersonalizePage.action.refreshCustomerUploadsList();


            // if(gbb.settings?.scheduleDelivery?.isScheduleDeliveryEnabled){
            //     gbb.gbbPersonalizePage.f.useDatePickerLibrary();
            // }


        },

        updatePageStatus: async function () {
            if (gbb.state.currentPageId != "personalizationPage") {
                return;
            }

            let isMessageProductExists = gbb.gbbPersonalizePage.f.checkIfMessageProductExistsInShopifyData();
            let qty = gbb.gbbPersonalizePage.f.getMessageProductQuantity();
            let isVirtualProduct = false;
            let virtualProduct;
            let isGiftMessageVirtualProduct = gbb.settings.bundleSettings.isGiftMessageVirtualProduct || false;
            if (isGiftMessageVirtualProduct) {
                isVirtualProduct = true;
                isMessageProductExists = true;


                if (gbb.settings && gbb.settings.shopifyData) {
                    gbb.settings.shopifyData.giftMessageData = gbb.settings.shopifyData.giftMessageData || {}; // Initialize giftMessageData as an empty array if it doesn't exist

                    gbb.settings.shopifyData.giftMessageData.variants = gbb.settings.shopifyData.giftMessageData.variants || []; // Initialize variants as an empty array if it doesn't exist
                    gbb.settings.shopifyData.giftMessageData.properties = gbb.settings.shopifyData.giftMessageData.properties || {};
                    let variantData = {
                        id: "1111",
                    }

                    let gifMesssageDataForVirtualProduct = {
                        "id": 1111,
                        "title": gbb.settings.giftMessage?.messageProduct?.product?.variants[0]?.option1 || "Message Product",
                        "option1": "Write your message to your loved one",
                        "available": true,
                        "name": "Message - Write your message",
                        "public_title": "Write your message",
                        "requires_selling_plan": false,
                        "variant_id": 1111,
                        "price": 0,
                        "weight": 0,
                        "compare_at_price": null,
                        "inventory_management": null,
                        // "image": "https://cdn.shopify.com/s/files/1/0680/3541/2253/files/1713126763137_8487c4ff-5454-41b7-b36e-ceced15ba145.png?v=1715596242",
                        // "image": "https://d3ks0ngva6go34.cloudfront.net/public/message_default.png",
                        "image": gbb.settings?.giftMessage?.messageProduct?.product?.variants[0]?.variantImage || "https://d3ks0ngva6go34.cloudfront.net/public/message_default.png",
                        "product_id": 1111,
                    }

                    gbb.settings.shopifyData.giftMessageData.variants.push(variantData);
                    let dummyMessageObject = JSON.parse(JSON.stringify(gifMesssageDataForVirtualProduct));

                    dummyMessageObject.variants = gbb.settings.shopifyData.giftMessageData.variants;

                    if (!gbb.state.currentProductsDataSetForVariants || Object.keys(gbb.state.currentProductsDataSetForVariants) < 1) {
                        gbb.state.currentProductsDataSetForVariants = {}
                    }

                    gbb.state.currentProductsDataSetForVariants[variantData.id] = dummyMessageObject;
                }
                qty = 1;
                let message = gbb.gbbPersonalizePage.state.giftMessage
                if (!message) {
                    qty = 0;
                    isMessageProductExists = false;
                }
            }
            // only sideeffect of this is that we are skipping gift message add to the cart.
            // but this is because we couldnt find any gift message product
            if (isMessageProductExists) {
                let data = {
                    variant: { id: gbb.settings?.shopifyData?.giftMessageData?.variants[0].id },
                    qty: qty,
                    //qty : 0 videoMessageDataHasBeenChanged || emailDataHasBeenChanged ? 0 : 1,
                }
                if (data.qty == 0) {
                    await gbb.utility.removeFromCart(data, "giftMessage");
                } else {
                    await gbb.utility.addToCart(data, "giftMessage");
                }
            }
            let navItem = gbb.f.getNavItem(gbb.state.currentPageId);
            if (navItem) {
                navItem.isCompleted = true;
                navItem.isActive = false
                //if cart items have the values, then mark complete, else mark incomplete
            }
            //update the navigationItems  by filtering the array gbb.state.navigationItems using id
            gbb.state.navigationItems.forEach(function (item) {
                if (item.id == gbb.state.currentPageId) {
                    item = {
                        ...item,
                        navItem
                    }
                }
            })
            return true;
        },
        f: {

            prepareHeader: function () {
                const gbbPersonalizePageHeaderHTML = gbb.$("<div>").addClass("gbbPersonalizePageHeader");
                let gbbPageHeader = gbb.$("<div>").addClass("gbbPageHeader");
                let navigationItems = gbb.state.navigationItems;
                let stepsCount = 0;
                navigationItems = navigationItems.filter((element) => {
                    if (element.isNavBarItem && element.isNavBarItem == true) {
                        stepsCount++;
                        return element;
                    }
                })
                if (stepsCount == 1) {
                    gbbPageHeader.addClass("gbbPageHeaderWithoutLine");
                }

                let gbbPageHeaderText = gbb.$("<div>").addClass("gbbPageHeaderText");

                const gbbPersonalizePageBannerImage = gbb.$("<img>").addClass("gbbPageBannerImage");
                gbbPersonalizePageBannerImage.attr("src", gbb.settings.pageCustomizationData.banners.pageBannerImageSrc)
                gbbPageHeader.append(gbbPersonalizePageBannerImage)
                //gbbPageHeader.append(gbbPageHeaderText);

                const gbbPersonalizePageNavigationContainer = gbb.$("<div>").addClass("gbbPersonalizePageNavigationContainer");

                gbbPageHeaderText.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.landingPage.bannerText));
                let nextNavigationItems = gbb.f.getNavigationItemsToDisplay(gbb.state.currentPageId);
                gbbPersonalizePageNavigationContainer.append(gbb.f.renderNavigationHTML(gbbPersonalizePageNavigationContainer, "personalizePage", nextNavigationItems));

                gbbPersonalizePageHeaderHTML.append(gbbPersonalizePageNavigationContainer)
                return gbbPersonalizePageHeaderHTML;
            },
            prepareUI: async function () {
                let settings = gbb.settings
                let gbbPersonalizePageHTML;

                gbbPersonalizePageHTML = gbb.$("<div>").addClass("gbbPersonalizePageHTMLContent");
                gbbPersonalizePageHTML = gbb.$("<div>").addClass("gbbPersonalizePageHTML");

                if (gbb.settings?.addonProducts?.isEnabled) {
                    let addonProductsHTML = gbb.gbbAddonProducts.f.prepareAddonProductsUI()
                    gbbPersonalizePageHTML.append(addonProductsHTML)
                }
                if (gbb.settings?.greetingCard?.isGreetingCardEnabled) {
                    let greetingCardHTML = gbb.gbbPersonalizePage.components.greetingCard();
                    gbbPersonalizePageHTML.append(greetingCardHTML);
                }

                if (gbb.settings?.giftMessage?.isGiftMessageEnabled) {
                    gbb.gbbPersonalizePage.state.giftMessage = gbb.utility.getAttributValueFromMessageItem("Message") //read from noteAttributes
                    let giftMessage = await gbb.gbbPersonalizePage.components.giftMessage();
                    gbbPersonalizePageHTML.append(giftMessage);
                }


                if (gbb.settings?.customerUploads?.isCustomerUploadsEnabled) {
                    let customerAttachmentHTML = gbb.gbbPersonalizePage.components.customerUploads();
                    gbbPersonalizePageHTML.append(customerAttachmentHTML);
                }


                if (gbb.settings.videoMessage.isVideoMessageEnabled) {
                    //read email Id and recordedId from noteAttributes
                    gbb.gbbVideoMsg.state.emailId = gbb.utility.getAttributValueFromMessageItem("Recipient Email");
                    gbb.gbbVideoMsg.state.uploadedVideoId = gbb.utility.getAttributValueFromMessageItem("_videoMsgId");
                    let videoMessageHTML = gbb.gbbPersonalizePage.components.videoMessage();
                    gbbPersonalizePageHTML.append(videoMessageHTML);
                }

                // if(gbb.settings?.scheduleDelivery?.isScheduleDeliveryEnabled){
                //     let scheduleDeliveryHTML = await gbb.gbbPersonalizePage.components.scheduleDelivery();
                //     gbbPersonalizePageHTML.append(scheduleDeliveryHTML);
                // }

                if (gbb.settings?.giftMessage?.isEmailEnabled) {
                    let emailAddressHTML = await gbb.gbbPersonalizePage.components.emailAddress();
                    gbbPersonalizePageHTML.append(emailAddressHTML);
                }

                if (gbb.settings?.giftMessage?.isGiftMessageEnabled || gbb.settings.videoMessage.isVideoMessageEnabled) {
                    if (gbb.settings?.giftMessage?.isEmailEnabled) {
                        let scheduleMessageDeliveryHTML = await gbb.gbbPersonalizePage.components.scheduleMessageDelivery();
                        gbbPersonalizePageHTML.append(scheduleMessageDeliveryHTML);
                    }
                }

                return gbbPersonalizePageHTML;

            },
            prepareFooter: function () {
                //this is a footer
                const gbbPersonalizePageFooterHTML = gbb.$("<div>").addClass("gbbPersonalizePageFooterHTML");
                gbbPersonalizePageFooterHTML.append(gbb.f.renderCartProductsFooterHTML("personalizePage"));
                return gbbPersonalizePageFooterHTML;
            },
            insertIntoMainPageWrapper: function () {

                gbb.$(".gbbBodyWrapper").html(gbb.state.personalizePageBody);

                gbb.$(".gbbBodyWrapper").children().first().hide();
                gbb.$(".gbbBodyWrapper").children().first().fadeIn(700);
            },
            calculateDaysFromToday: function (numberOfDays) {
                return new Date(Date.now() + parseInt(numberOfDays) * 24 * 60 * 60 * 1000)
            },
            useDatePickerLibrary: function () {
                try {
                    const minDate = gbb.gbbPersonalizePage.f.calculateDaysFromToday(gbb.settings.scheduleDelivery.leadTime);
                    let maxDate = gbb.gbbPersonalizePage.f.calculateDaysFromToday(gbb.settings.scheduleDelivery.maxDateInDays);
                    const disabledDates = gbb.settings.scheduleDelivery.disabledDates;
                    const disabledDays = gbb.settings.scheduleDelivery.disabledDaysOfWeek;
                    let datePicker = gbb.$(".gbbScheduleDeliveryDatePicker");
                    flatpickr(datePicker, {
                        // inline: true,
                        dateFormat: "d-m-Y",
                        time_24hr: true,
                        minDate: minDate,
                        maxDate: maxDate,
                        disable: [
                            function (date) {
                                // return true to disable
                                // let d = new Date(date+"Z");
                                let d = gbb.utility.getDate(date);

                                // d = (d.toISOString().split('T')[0]);
                                // return (date.getDay() === 0 || date.getDay() === 6);
                                if (disabledDates.includes(d) || disabledDays.includes(new Date(date).toLocaleString("en-us", { weekday: "long" }))) {
                                    return true;
                                }
                            },
                        ],
                        onChange: async function (selectedDates, dateStr, instance) {
                            gbb.utility.debugConsole("date changed");
                            gbb.utility.debugConsole({ dateStr });
                            gbb.gbbPersonalizePage.state.scheduleDeliveryDate = dateStr;
                            if (gbb.gbbPersonalizePage.state.scheduleDeliveryDate) {
                                // await gbb.utility.updateCart({ attributes: { ["gbbScheduleDelivery"]: gbb.gbbPersonalizePage.state.scheduleDeliveryDate } });
                                gbb.gbbBrowser.updateCartAttributes({ gbbScheduleDelivery: gbb.gbbPersonalizePage.state.scheduleDeliveryDate });
                            }

                            //
                        },
                        // appendTo: gbb.$(body)
                    });
                    if (gbb.utility.getAttributValueFromCart("gbbScheduleDelivery") != null) {
                        datePicker.val(gbb.utility.getAttributValueFromCart("gbbScheduleDelivery"));
                    }
                } catch (e) {
                    gbb.utility.debugConsole(e);

                    //gbbScheduleDeliveryHTML
                    //hide this component
                    gbb.$(".gbbScheduleDeliveryHTML").hide();
                }

            },
            activateClearSelectionButton: function (productType) {
                //create a new button
                // productType -> expected params are
                // "giftWrap" or "greetingCard"
                let clearSelectionButton = gbb.$("<div>").addClass("gbbClearSelectionButton");

                //: clear selection language
                clearSelectionButton.text(gbb.utility.renderLanguageValue(gbb.settings.languageData?.personalizePage?.clearSelectionButton) || "Clear Selection");
                clearSelectionButton.click(function () {
                    gbb.gbbPersonalizePage.action.onClearSelectionButtonClick(productType);
                });

                return clearSelectionButton;
            },
            registerEvents: function (settings) {
                gbb.gbbPersonalizePage.state.buildBoxButtonAction = function () {
                    gbb.utility.debugConsole("build box button clicked");
                    // window.alert("build box button clicked");
                };
            },
            renderGreetingCardImages: function (greetingCardData) {
                try {
                    // let imageList = greetingCardData.images;
                    if (true || imageList) {
                        let gbbGreetingCardImageList = [];
                        let greetingCardProducts = Object.values(greetingCardData) || [];
                        for (let i = 0; i < greetingCardProducts?.length; i++) {
                            let greetingCardProduct = greetingCardProducts[i];
                            for (let j = 0; j < greetingCardProduct?.variants?.length; j++) {
                                //: No Image found png
                                let _img = greetingCardProduct?.variants[j]?.featured_image?.src || greetingCardProduct?.featured_image || "No Image found png";
                                let variantId = greetingCardProduct?.variants[j]?.id;
                                // add an input event listener to each image of radio type
                                let variantTitle = gbb.$("<div>").addClass("gbbVariantTitle").append(greetingCardProduct?.variants[j]?.title);
                                let variantPrice = gbb.$("<span>").addClass("gbbVariantPrice").append(gbb.utility.formatPrice(greetingCardProduct?.variants[j]?.price));
                                let variantDetailsWrapper = gbb.$("<div>").addClass("gbbVariantDetailsWrapper");

                                variantDetailsWrapper.append(variantTitle);
                                variantDetailsWrapper.append(variantPrice);

                                imageInput = gbb.$("<input>").attr("type", "radio").attr("name", "greetingCardImage").attr("value", _img)
                                imageInput.addClass("greetingCardImageInput")
                                let imageAndDetailsWrapper = gbb.$("<div>").addClass("greetingCardImageAndDetailsWrapper");
                                let imageLabel = gbb.$("<label>").addClass('gbbGreetingCardImageLabel')
                                let image = gbb.$("<img>").addClass('greetingCardImage')

                                // imageLabel.on("click", gbb.gbbPersonalizePage.action.onGreetingCardImageClick)
                                imageLabel.on("click", gbb.gbbPersonalizePage.action.onGreetingCardImageClick)

                                let argsObj = {
                                    productData: greetingCardProduct,
                                    variantId: variantId.id,
                                }

                                let uniqueItemKey = gbb.utility.getUniqueIdForVariant(argsObj);


                                const isItemInCart = gbb.utility.checkIfItemPresentInGiftBoxCart(variantId, { uniqueItemKey });
                                if (isItemInCart) {
                                    gbb.gbbPersonalizePage.state.greetingCardActiveImageSrc = _img;
                                    gbb.gbbPersonalizePage.state.greetingCardTitle = isItemInCart.variant_title;
                                    gbb.gbbPersonalizePage.state.greetingCardPrice = isItemInCart.price;
                                } else {
                                    gbb.gbbPersonalizePage.state.greetingCardActiveImageSrc = null;
                                    gbb.gbbPersonalizePage.state.greetingCardTitle = null;
                                    gbb.gbbPersonalizePage.state.greetingCardPrice = null;
                                    imageInput.attr("checked", false)
                                    imageLabel.removeClass("gbbActiveGreetingCard")
                                    gbb.gbbPersonalizePage.action.removeCheckmarkDivsFromGreetingCards();
                                }

                                //if image is checked then attach gbbActiveGreetingCard css to it
                                if (gbb.gbbPersonalizePage.state.greetingCardActiveImageSrc == _img) {
                                    imageInput.attr("checked", true)
                                    imageLabel.addClass("gbbActiveGreetingCard")
                                    gbb.gbbPersonalizePage.action.addCheckMarkDivs(imageLabel);
                                } else {
                                    imageInput.attr("checked", false)
                                    imageLabel.removeClass("gbbActiveGreetingCard")
                                    gbb.gbbPersonalizePage.action.removeCheckmarkDivsFromGreetingCards();
                                }
                                image.attr("src", _img)

                                imageInput.attr("data-variant-id", variantId)
                                image.attr("data-variant-id", variantId)
                                imageLabel.attr("data-variant-id", variantId)

                                imageLabel.append(imageInput)
                                // imageLabel.append(variantTitle).append(variantPrice)
                                imageLabel.append(image)

                                imageAndDetailsWrapper.append(imageLabel);
                                imageAndDetailsWrapper.append(variantDetailsWrapper);
                                gbbGreetingCardImageList.push(imageAndDetailsWrapper)
                            }
                        }
                        // if gbbGreetingCardImageList has no elements then return that there are no Images to display
                        if (gbbGreetingCardImageList.length == 0) {
                            return gbb.$("<div>").addClass('gbbGreetingCardImageList').html("No products found" || gbb.utility.renderLanguageValue(gbb.settings.languageData.giftcardV2.purchasePageFields.noImagesAvailable))
                        }
                        return gbbGreetingCardImageList;
                    }
                } catch (e) {
                    gbb.utility.debugConsole("error occured in renderGreetingCardImages", e)
                }
            },
            renderGiftWrapImages: function (giftWrapData) {
                // let imageList = giftWrapData.images;
                if (true || imageList) {
                    let giftWrapImageList = [];
                    for (let i = 0; i < giftWrapData.variants?.length; i++) {
                        //: no images png
                        let _img = giftWrapData.variants[i]?.featured_image?.src || "No Image found png";
                        let variantId = giftWrapData.variants[i]?.id;

                        let variantTitle = gbb.$("<div>").addClass("gbbVariantTitle").append(giftWrapData.variants[i]?.title);
                        let variantPrice = gbb.$("<span>").addClass("gbbVariantPrice").append(gbb.utility.formatPrice(giftWrapData.variants[i]?.price));

                        let variantDetailsWrapper = gbb.$("<div>").addClass("gbbVariantDetailsWrapper");

                        variantDetailsWrapper.append(variantTitle);
                        variantDetailsWrapper.append(variantPrice);
                        // add an input event listener to each image of radio type
                        imageInput = gbb.$("<input>").attr("type", "radio").attr("name", "giftWrapImage").attr("value", _img)
                        imageInput.addClass("giftWrapImageInput")
                        let imageAndDetailsWrapper = gbb.$("<div>").addClass("greetingCardImageAndDetailsWrapper");
                        let imageLabel = gbb.$("<label>").addClass('giftWrapImageLabel')
                        let image = gbb.$("<img>").addClass('giftWrapImage')

                        //on click set the current item to the preview image as active image
                        // imageLabel.on("click", gbb.gbbPersonalizePage.action.onGiftWrapImageClick)
                        imageAndDetailsWrapper.on("click", gbb.gbbPersonalizePage.action.onGiftWrapImageClick)

                        const isItemInCart = gbb.utility.checkIfItemPresentInGiftBoxCart(variantId);

                        if (isItemInCart) {
                            gbb.gbbPersonalizePage.state.giftWrapActiveImageSrc = _img;
                            gbb.gbbPersonalizePage.state.giftWrapTitle = isItemInCart.variant_title;
                            gbb.gbbPersonalizePage.state.giftWrapPrice = gbb.utility.formatPrice(isItemInCart.price);
                        }

                        //if image is checked then attach activeGiftWrap css to it
                        if (gbb.gbbPersonalizePage.state.giftWrapActiveImageSrc == _img) {
                            imageInput.attr("checked", true)
                            imageLabel.addClass("activeGiftWrap")
                            gbb.gbbPersonalizePage.action.addCheckMarkDivs(imageLabel);
                        }
                        image.attr("src", _img)

                        imageInput.attr("data-variant-id", variantId)
                        image.attr("data-variant-id", variantId)
                        imageLabel.attr("data-variant-id", variantId)

                        imageLabel.append(imageInput)
                        // imageLabel.append(variantTitle).append(variantPrice)
                        imageLabel.append(image)
                        imageAndDetailsWrapper.append(imageLabel);
                        imageAndDetailsWrapper.append(variantDetailsWrapper);
                        giftWrapImageList.push(imageAndDetailsWrapper)
                    }
                    // if giftWrapImageList has no elements then return that there are no Images to display
                    if (giftWrapImageList.length == 0) {
                        return gbb.$("<div>").addClass('giftWrapImageList').html("No products found" || gbb.utility.renderLanguageValue(gbb.settings.languageData.giftcardV2.purchasePageFields.noImagesAvailable))
                    }
                    return giftWrapImageList;
                }

            },
            verifyEmailFields: function () {
                if (gbb.settings?.giftMessage?.isEmailEnabled) {
                    let email = gbb.gbbVideoMsg.state.emailId;
                    let emailValid;
                    let isEmailWarningMsgPresent = gbb.$(".gbbPageBody").find(".gbbEmailValidationError");
                    let emailValidationError = gbb.$("<div>").addClass("gbbEmailValidationError").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.generalSettings?.emailValidationError) || "Please enter a valid email address");
                    if (email && email.trim().length != 0) {//email is not empty -> it must be valid
                        //check for validation
                        emailValid = gbb.utility.emailValidation(email);
                        if (!emailValid) {
                            if (isEmailWarningMsgPresent.length == 0) {
                                gbb.$(".gbbEmailAddressWrapper").append(emailValidationError);
                            }
                            return false;
                        } else {
                            gbb.$(".gbbEmailValidationError").remove();
                            return true;
                        }
                    }
                    else if (!email || email?.trim().length == 0) {//email is empty -> check if video message exists, if it does -> email cannot be empty
                        if (gbb.gbbVideoMsg.state.uploadedVideoId || gbb.$(".gbbVideoMsgCheckboxField").is(":checked")) {
                            if (isEmailWarningMsgPresent.length == 0) {
                                gbb.$(".gbbEmailAddressWrapper").append(emailValidationError);
                            }
                            return false;
                        } else {
                            //if the video message is not checked then remove the error message
                            gbb.$(".gbbEmailValidationError").remove();
                            return true;
                        }
                    }
                } else {
                    return true;
                }
            },
            getMessageProductQuantity: function () { //if text message or video message is present -> then only quantity will be 1 otherwise 0
                let qty;
                let videoToggle = gbb.$(".gbbVideoMsgCheckboxField").is(":checked")
                if (!videoToggle) {
                    gbb.gbbVideoMsg.state.uploadedVideoId = null
                }
                if ((gbb.gbbPersonalizePage.state?.giftMessage && gbb.gbbPersonalizePage.state?.giftMessage?.trim().length != 0) || gbb.gbbVideoMsg.state.uploadedVideoId) {
                    qty = 1;
                } else if (gbb.gbbPersonalizePage.state.customerUploadsResponse && Object.keys(gbb.gbbPersonalizePage.state.customerUploadsResponse).length > 0) {
                    qty = 1;
                } else {
                    qty = 0;
                }
                return qty;
            },
            checkIfMessageProductExistsInShopifyData: function () { //check if we have a message product at all or not
                if (gbb.settings && gbb.settings.shopifyData && gbb.settings?.shopifyData?.giftMessageData
                    && gbb.settings?.shopifyData?.giftMessageData?.variants[0].id) {
                    return true;
                } else {
                    return false;
                }
            },
            deleteCustomerUploadsError: function (key) {
                if (gbb.gbbPersonalizePage.state.customerUploadsErrors != null && gbb.gbbPersonalizePage.state.customerUploadsErrors[key]) {
                    delete gbb.gbbPersonalizePage.state.customerUploadsErrors[key];
                }
            },
            deleteCustomerUploadsResponse: function (key) {
                if (gbb.gbbPersonalizePage.state.customerUploadsResponse != null && gbb.gbbPersonalizePage.state.customerUploadsResponse[key]) {
                    delete gbb.gbbPersonalizePage.state.customerUploadsResponse[key];
                }
            },
            removeGiftMessageFromSessionStorage: function (cartData) {
                try {
                    let boxes = Object.keys(cartData.boxes);
                    let giftMessageProductInSessionStorage = [];
                    let totalCount = 0;
                    for (let i = 0; i < boxes.length; i++) {
                        let box = cartData.boxes[boxes[i]];
                        let items = box.items;
                        for (let j = 0; j < items.length; j++) {
                            let item = items[j];
                            if (item.properties && item.properties.Message) {
                                giftMessageProductInSessionStorage.push({ "Box ID": item.properties["Box ID"], "Message": item.properties.Message, "To": item.properties["Recipient Name"], "From": item.properties["Sender Name"], "Bundle Name": item.properties.Bundle })

                                // remove this item from the cartData
                                items.splice(j, 1);
                                j--;
                            }
                        }
                    }
                    // update cartData in session storage
                    if (cartData) {
                        let bundleId = gbb.state.bundleId;
                        let sessionStorageKey = `gbb-cart-${bundleId}`;
                        sessionStorage.setItem(sessionStorageKey, JSON.stringify(cartData));
                    }

                    gbb.state.giftMessageProductInActiveSession = giftMessageProductInSessionStorage;
                    gbb.gbbBrowser.updateTotalPriceInSessionStorage();
                    gbb.gbbBrowser.updateTotalofRelevantBoxPriceInSessionStorage();
                } catch (err) {
                    gbb.utility.debugConsole("error inside removeGiftMessageFromSessionStorage", err);
                }
            }
        },
        events: {
            onCustomerUploadsFileChange: async function (event) {
                try {
                    let fileBlob = event.target.files[0];
                    gbb.utility.debugConsole(fileBlob, "file")

                    let fileAllowed = true;
                    if (fileBlob.type) {
                        const allowedExtensions = ['.xlsx', '.xls', '.pdf', '.jpeg', '.png', '.jpg', '.heif', '.heic'];
                        const extension = fileBlob.name.split('.').pop();

                        if (allowedExtensions.includes('.' + extension)) {
                            fileAllowed = true;
                        } else if (fileBlob.type.startsWith('video/')) {
                            fileAllowed = true;
                        } else {
                            fileAllowed = false;
                        }
                    }

                    if (!fileAllowed) {
                        let fieldKey = event.target.getAttribute("data-field-key");
                        gbb.gbbPersonalizePage.state.customerUploadsErrors[fieldKey] = { fileNotSupportedError: true };
                        gbb.gbbPersonalizePage.action.refreshCustomerUploadsErrorMessage()
                        return;
                    }

                    //fileSize limit is 5mbs
                    let fieldKey = event.target.getAttribute("data-field-key");

                    // gbbCustomerUploadsActionButton //disable this button
                    let buttonRef = gbb.$(".gbbCustomerUploadsListItem[data-field-key='" + fieldKey + "']").find(".gbbCustomerUploadsActionButton").children(0);

                    let customerUploadTextFields = gbb.settings.customerUploads.textFields || {};


                    buttonRef.text(customerUploadTextFields.uploadingText.value || "Uploading...")
                    buttonRef.addClass("gbbDisabled");

                    let reader = new FileReader();
                    try {
                        reader.onload = async function (event) {
                            if (fileBlob.size > 5000000) {
                                gbb.gbbPersonalizePage.state.customerUploadsErrors[fieldKey] = { fileSizeError: true };
                                gbb.gbbPersonalizePage.action.refreshCustomerUploadsErrorMessage()
                                buttonRef.removeClass("gbbDisabled");
                                buttonRef.text(customerUploadTextFields.uploadText.value || "Upload")
                                gbb.utility.debugConsole("file size is greater than 5mb")
                                return;
                            };

                            // let fileData = event.target.result;
                            let fileUploadData = await gbb.gbbPersonalizePage.action.uploadCustomerUploadsFile(fileBlob, fieldKey);
                            if (fileUploadData) {
                                const responseDataObject = fileUploadData.data;
                                let fileUrl = responseDataObject.url;
                                let fileName = responseDataObject.originalFileName;
                                let labelName = responseDataObject.fieldKey;
                                const fileDataObject = {
                                    fileUrl: fileUrl,
                                    fileName: fileName,
                                    labelName: labelName
                                }
                                gbb.gbbPersonalizePage.state.customerUploadsResponse = {
                                    ...gbb.gbbPersonalizePage.state.customerUploadsResponse,
                                    [fieldKey]: fileDataObject.fileUrl
                                }

                                gbb.gbbPersonalizePage.f.deleteCustomerUploadsError(fieldKey);

                                // gbb.gbbBrowser.updateCartAttributes(gbb.gbbPersonalizePage.state.customerUploadsResponse);
                                gbb.gbbPersonalizePage.action.refreshCustomerUploadsList();
                                gbb.gbbPersonalizePage.action.refreshCustomerUploadsErrorMessage();
                            } else {
                                gbb.utility.debugConsole("error in uploading file")
                                gbb.gbbPersonalizePage.state.customerUploadsErrors[fieldKey] = { fileUploadError: true };
                                gbb.gbbPersonalizePage.action.refreshCustomerUploadsErrorMessage()
                                buttonRef.removeClass("gbbDisabled");
                                buttonRef.text(customerUploadTextFields.uploadText.value || "Upload")
                            }
                        }
                        reader.readAsDataURL(fileBlob);

                        // we accept 


                    } catch (e) {
                        gbb.utility.debugConsole(e)
                        gbb.gbbPersonalizePage.state.customerUploadsErrors[fieldKey] = { fileUploadError: true };
                        gbb.gbbPersonalizePage.action.refreshCustomerUploadsErrorMessage()
                        buttonRef.removeClass("gbbDisabled");
                        buttonRef.text(customerUploadTextFields.uploadText.value || "Upload")
                        return;
                    }
                } catch (error) {
                    gbb.utility.debugConsole(error);
                    return false;
                }
            }
        },
        components: {
            greetingCard: function (settings) {

                let greetingCardContainer = gbb.$("<div>").addClass("gbbGreetingCardContainer")

                let greetingCardCheckboxLabel = gbb.$("<label>").addClass("gbbGreetingCardCheckboxLabel");
                let greetingCardCheckboxPrice = gbb.$("<label>").addClass("gbbGreetingCardCheckboxPrice");


                let greetingCardImg = gbb.$("<img>").addClass("gbbGreetingCardImg");
                let greetingCardImgWrapper = gbb.$("<div>").addClass("greetingCardImgWrapper");


                // 2.a. img for the greeting card
                let greetingCardWrapper = gbb.$("<div>").addClass("greetingCardWrapper");

                let products = gbb.state.giftBoxCartData.items;

                products.forEach((product) => {
                    //product.properties is an object
                    if (product.properties["_boxProduct"] == "greetingCard") {
                        gbb.gbbPersonalizePage.state.greetingCardTitle = product.variant_title;
                        gbb.gbbPersonalizePage.state.greetingCardPrice = gbb.utility.formatPrice(product.price);
                        gbb.gbbPersonalizePage.state.greetingCardActiveImageSrc = product.image;
                    }
                })
                greetingCardCheckboxLabel.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.personalizePage?.selectGreetingCardLabel) || "Greeting Card1");
                //modularize code from here onwards

                // 2. img container for the greeting card
                let greetingCardImageContainer = gbb.$("<div>").addClass("gbbGreetingCardImageContainer");
                let greetingCardDropDownWrapper = gbb.$("<div>").addClass("gbbGreetingCardDropDownWrapper");
                //: Button
                let greetingCardDropDownButton = gbb.$("<img>").addClass("gbbGreetingCardDropDownButton");
                greetingCardDropDownButton.attr("src", CONSTANT_IMAGES_DROPDOWN_BUTTON);
                let _button = gbb.gbbPersonalizePage.f.activateClearSelectionButton("greetingCard");


                // 2.b. container for all the greeting card options
                let greetingCardAllImagesContainer = gbb.$("<div>").addClass("greetingCardAllImagesContainer");
                let greetingCardAllImagesLabel = gbb.$("<div>").addClass("greetingCardAllImagesLabel");

                //: Language support
                greetingCardAllImagesLabel.text("Greeting Card");

                let greetingCardData = gbb.settings?.shopifyData?.greetingCardData;

                //  greetingCardDropDownWrapper.on("click", async function (event) {
                //  gbb.gbbPersonalizePage.action.handleShowAllGreetingCardImagesButtonEvent(event);
                if (true || gbb.gbbPersonalizePage.state.showAllGreetingCardImages == false) {
                    //if greetingCardData.images has only one element add a class to listwrapper that says gbbJustOneProduct
                    let gbbGreetingCardImageList = gbb.$("<div>").addClass("gbbGreetingCardImageList")
                    gbbGreetingCardImageList.html(gbb.gbbPersonalizePage.f.renderGreetingCardImages(greetingCardData));

                    let greetingCardProducts = Object.values(greetingCardData) || [];
                    let greetingCardVariants = greetingCardProducts[0]?.variants || [];
                    if (greetingCardVariants?.length == 1) {
                        gbbGreetingCardImageList.addClass("gbbJustOneProduct")
                    }


                    gbb.gbbPersonalizePage.state.showAllGreetingCardImages = true;

                    // gbb.$(".greetingCardWrapper").html(_button);
                    greetingCardWrapper.append(gbbGreetingCardImageList);
                    // gbb.$(".greetingCardWrapper").append(gbbGreetingCardImageList);

                    // await gbb.$(".greetingCardWrapper").append(gbb.gbbPersonalizePage.f.activateClearSelectionButton("greetingCard"));
                }
                else {
                    // remove the contents of greetingCardWraooer
                    if (gbb.gbbPersonalizePage.state.greetingCardActiveImageSrc) {
                        greetingCardImg.attr("src", gbb.gbbPersonalizePage.state.greetingCardActiveImageSrc);
                        greetingCardImgWrapper.append(greetingCardImg);
                        gbb.$(".greetingCardWrapper").html(greetingCardImgWrapper);
                    }
                    else {
                        greetingCardCheckboxLabel.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.personalizePage?.selectGreetingCardLabel) || "Greeting Card1");
                        greetingCardCheckboxPrice.text("");
                        gbb.$(".greetingCardWrapper").html("")
                    }
                    gbb.$(".gbbGreetingCardDropDownButton").css("transform", "rotate(180deg)");
                    gbb.gbbPersonalizePage.state.showAllGreetingCardImages = false;
                }
                //  });

                greetingCardImageContainer.append(greetingCardWrapper);
                //  greetingCardImageContainer.append(greetingCardShowAllImagesButtonWrapper);

                greetingCardDropDownWrapper.append(greetingCardCheckboxLabel);
                greetingCardDropDownWrapper.append(_button);


                if (false) {
                    greetingCardDropDownWrapper.append(greetingCardCheckboxPrice);
                    greetingCardDropDownWrapper.append(greetingCardDropDownButton);
                }


                greetingCardContainer.append(greetingCardDropDownWrapper);
                greetingCardContainer.append(greetingCardImageContainer);

                return greetingCardContainer;
            },
            giftWrap: function (settings) {
                // 1. checkbox for giftWrap
                let giftWrapContainer = gbb.$("<div>").addClass("gbbGiftWrapContainer");
                let giftWrapCheckboxLabel = gbb.$("<label>").addClass("gbbGiftWrapCheckboxLabel")
                let giftWrapCheckboxPrice = gbb.$("<label>").addClass("gbbGiftWrapCheckboxPrice")

                let products = gbb.state.giftBoxCartData.items;

                products.forEach((product) => {
                    //product.properties is an object
                    if (product.properties["_boxProduct"] == "giftWrap") {
                        gbb.gbbPersonalizePage.state.giftWrapTitle = product.variant_title;
                        gbb.gbbPersonalizePage.state.giftWrapPrice = gbb.utility.formatPrice(product.price);
                        gbb.gbbPersonalizePage.state.giftWrapActiveImageSrc = product.image;
                    }
                })

                //: Language support

                //modularize code from here onwards

                // 2. img container for the greeting card
                let giftWrapImageContainer = gbb.$("<div>").addClass("gbbGiftWrapImageContainer");

                let giftWrapDropDownWrapper = gbb.$("<div>").addClass("gbbGiftWrapDropDownWrapper");
                let giftWrapDropDownButton = gbb.$("<img>").addClass("gbbGiftWrapDropDownButton")
                giftWrapDropDownButton.attr("src", CONSTANT_IMAGES_DROPDOWN_BUTTON);
                // 2.a. img for the greeting card
                let giftWrapWrapper = gbb.$("<div>").addClass("giftWrapWrapper");
                let giftWrapImgWrapper = gbb.$("<div>").addClass("giftWrapImgWrapper");
                let giftWrapImg = gbb.$("<img>").addClass("gbbGiftWrapImg");

                // 2.b. container for all the greeting card options
                let giftWrapAllImagesContainer = gbb.$("<div>").addClass("giftWrapAllImagesContainer");

                //render all the images in an image tag in AllImagesContainer
                let giftWrapData = gbb.settings?.shopifyData?.giftWrapData;

                // [button] to show all the images
                //let giftWrapShowAllImagesButtonWrapper = gbb.$("<div>").addClass("gbbGreetingCardShowAllImagesButtonWrapper");

                //  selectGreetingCardLabel
                if (gbb.gbbPersonalizePage.state.giftWrapTitle) {
                    giftWrapCheckboxLabel.text(gbb.gbbPersonalizePage.state.giftWrapTitle)
                    giftWrapCheckboxPrice.text(gbb.gbbPersonalizePage.state.giftWrapPrice)
                    giftWrapImg.attr("src", gbb.gbbPersonalizePage.state.giftWrapActiveImageSrc);
                    giftWrapImgWrapper.append(giftWrapImg);

                    giftWrapWrapper.append(giftWrapImgWrapper);
                } else {
                    giftWrapCheckboxLabel.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.personalizePage?.giftWrapLabel) || "Select Wrap 1");
                }


                giftWrapDropDownWrapper.on("click", function (event) {
                    //  gbb.gbbPersonalizePage.action.handleShowAllGreetingCardImagesButtonEvent(event);
                    if (gbb.gbbPersonalizePage.state.showAllGiftWrapImages == false) {

                        gbb.$(".gbbGiftWrapDropDownButton").css("transform", "rotate(360deg)");

                        let giftWrapImageList = gbb.$("<div>").addClass("giftWrapImageList")
                        giftWrapImageList.html(gbb.gbbPersonalizePage.f.renderGiftWrapImages(giftWrapData));

                        if (giftWrapData.variants?.length == 1) {
                            giftWrapImageList.addClass("gbbJustOneProduct")
                        }

                        gbb.gbbPersonalizePage.state.showAllGiftWrapImages = true;

                        gbb.$(".giftWrapWrapper").html(gbb.gbbPersonalizePage.f.activateClearSelectionButton("giftWrap"));
                        gbb.$(".giftWrapWrapper").append(giftWrapImageList);
                    }
                    else {
                        if (gbb.gbbPersonalizePage.state.giftWrapActiveImageSrc) {
                            giftWrapImg.attr("src", gbb.gbbPersonalizePage.state.giftWrapActiveImageSrc);
                            giftWrapImgWrapper.append(giftWrapImg);
                            gbb.$(".giftWrapWrapper").html(giftWrapImgWrapper);
                        }
                        else {
                            giftWrapCheckboxLabel.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.personalizePage?.giftWrapLabel) || "Select Wrap 1");
                            giftWrapCheckboxPrice.text("");
                            gbb.$(".giftWrapWrapper").html("")
                        }

                        gbb.$(".gbbGiftWrapDropDownButton").css("transform", "rotate(180deg)");
                        gbb.gbbPersonalizePage.state.showAllGiftWrapImages = false;
                    }
                });

                //  giftWrapCheckboxLabel.text


                //  giftWrapShowAllImagesButtonWrapper.append(giftWrapShowAllImagesButton);

                giftWrapImageContainer.append(giftWrapWrapper);
                //  giftWrapImageContainer.append(giftWrapShowAllImagesButtonWrapper);


                //  giftWrapContainer.append(giftWrapCheckbox);
                giftWrapDropDownWrapper.append(giftWrapCheckboxLabel);
                giftWrapDropDownWrapper.append(giftWrapCheckboxPrice);
                giftWrapDropDownWrapper.append(giftWrapDropDownButton);
                giftWrapContainer.append(giftWrapDropDownWrapper);

                giftWrapContainer.append(giftWrapImageContainer);

                return giftWrapContainer;
            },
            giftMessage: function (settings) {
                let giftMessageV2MainContent = gbb.$("<div>").addClass("gbbGiftMessageV2MainContent");

                let gbbGiftMessageV2HTML = gbb.$("<div>").addClass('gbbGiftMessageV2HTML')


                let gbbGiftMessageV2ToFromContainer;
                if (gbb.settings?.giftMessage.isSenderAndRecipientNameEnabled == true) {
                    gbbGiftMessageV2ToFromContainer = gbb.gbbPersonalizePage.components.gbbGiftMessageV2ToFromUI();
                }
                // a label field
                let giftMessageV2PrepareUI;
                let gbbGiftMessageV2 = gbb.$("<div>").addClass('gbbGiftMessageV2')
                // a label field
                let gbbGiftMessageV2Label = gbb.$("<label>").addClass("gbbGiftMessageV2Label").attr("for", "gbbGiftMessageV2").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.personalizePage?.messageLabel) || "giftnote1 ");
                let gbbGiftMessageV2InputField = gbb.$("<textarea>").addClass("gbbGiftMessageV2InputField").attr("placeholder", gbb.utility.renderLanguageValue(gbb.settings?.languageData?.personalizePage?.messagePlaceholder) || "Placeholder1")
                let gbbGiftMessageV2RequiredWarning = gbb.$("<div>").addClass("gbbGiftMessageV2RequiredWarning").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.personalizePage?.messageIsRequiredError) || "Message is Required!")
                gbbGiftMessageV2RequiredWarning.css("display", "none");

                let gbbGiftMessageCounterEle = gbb.$("<div>").addClass("gbbGiftMessageCounterEle")


                let giftMessageCharacterLimit = gbb.settings.giftMessage.giftMessageCharacterLimit || "";
                giftMessageCharacterLimit = giftMessageCharacterLimit.trim() != "" && giftMessageCharacterLimit.trim() != "0" ? giftMessageCharacterLimit : "";

                if (giftMessageCharacterLimit) {
                    gbbGiftMessageV2InputField.attr("maxlength", giftMessageCharacterLimit)
                }
                // gbbGiftMessageV2MainContent
                ///save the input field values
                if (gbb.utility.getAttributValueFromMessageItem("Message")) {
                    let noteVal = gbb.utility.getAttributValueFromMessageItem("Message");
                    gbbGiftMessageV2InputField.val(noteVal)
                    gbb.gbbPersonalizePage.state.giftMessage = noteVal;
                    if (giftMessageCharacterLimit) {
                        const maxlength = gbbGiftMessageV2InputField.attr("maxlength");
                        const currentLength = gbbGiftMessageV2InputField.val().length;
                        gbbGiftMessageCounterEle.text(currentLength + "/" + maxlength);
                    }
                }

                gbbGiftMessageV2InputField.on("change", function (event) {
                    gbb.gbbPersonalizePage.state.giftMessage = gbbGiftMessageV2InputField.val();
                })

                if (giftMessageCharacterLimit) {
                    gbbGiftMessageV2InputField.on("input", ((e) => {
                        const target = e.target;
                        // Get the `maxlength` attribute
                        const maxLength = target.getAttribute('maxlength');
                        // Count the current number of characters
                        const currentLength = target.value.length;
                        gbbGiftMessageCounterEle.text(`${currentLength}/${maxLength}`);
                    }))
                }
                gbb.f.applyLabelCSS(gbbGiftMessageV2Label)

                // create an empty divider to separate the message and the video message button
                let gbbGiftMessageV2Divider = gbb.$("<div>").addClass("gbbGiftMessageV2Divider")

                let gbbGiftMessageV2InputFieldsDiv = gbb.$("<div>").addClass("gbbGiftMessageV2InputFieldsDiv")
                gbbGiftMessageV2InputFieldsDiv.append(gbbGiftMessageV2InputField).append(gbbGiftMessageV2RequiredWarning)

                if (giftMessageCharacterLimit) {
                    gbbGiftMessageV2InputFieldsDiv.append(gbbGiftMessageCounterEle)
                }

                gbbGiftMessageV2.append(gbbGiftMessageV2InputFieldsDiv)
                gbbGiftMessageV2.append(gbbGiftMessageV2Divider)
                // gbbGiftMessageV2.append(gbbVideoMsgButton)

                gbbGiftMessageV2HTML.append(gbbGiftMessageV2Label);
                if (gbbGiftMessageV2ToFromContainer) {
                    gbbGiftMessageV2HTML.append(gbbGiftMessageV2ToFromContainer);
                }
                gbbGiftMessageV2HTML.append(gbbGiftMessageV2);
                // gbb.$(".gbbModalContent").html(gbbGiftMessageV2HTML);

                giftMessageV2MainContent.append(gbbGiftMessageV2HTML);

                // let giftMessageV2Buttons = await gbb.gbbGiftMessageV2.f.renderButtons();

                return giftMessageV2MainContent;
            },
            gbbGiftMessageV2ToFromUI: function () {
                let gbbGiftMessageV2ToFromContainer = gbb.$("<div>").addClass("gbbGiftMessageV2ToFromContainer")
                let gbbGiftMessageV2ToField = gbb.$("<input>").addClass("gbbGiftMessageV2ToField").attr("placeholder", gbb.utility.renderLanguageValue(gbb.settings?.languageData?.personalizePage.recipientNamePlaceholder) || "To")
                let gbbGiftMessageV2FromField = gbb.$("<input>").addClass("gbbGiftMessageV2FromField").attr("placeholder", gbb.utility.renderLanguageValue(gbb.settings?.languageData?.personalizePage.senderNamePlaceholder) || "From")

                gbbGiftMessageV2ToFromContainer.append(gbbGiftMessageV2FromField);
                gbbGiftMessageV2ToFromContainer.append(gbbGiftMessageV2ToField)

                if (gbb.utility.getAttributValueFromMessageItem("Sender Name")) {
                    let noteVal = gbb.utility.getAttributValueFromMessageItem("Sender Name");
                    gbbGiftMessageV2FromField.val(noteVal);
                    gbb.gbbPersonalizePage.state.senderName = noteVal;
                }


                gbbGiftMessageV2FromField.on("change", function (event) {
                    gbb.gbbPersonalizePage.state.senderName = gbbGiftMessageV2FromField.val();
                })

                if (gbb.utility.getAttributValueFromMessageItem("Recipient Name")) {
                    let noteVal = gbb.utility.getAttributValueFromMessageItem("Recipient Name");
                    gbbGiftMessageV2ToField.val(noteVal);
                    gbb.gbbPersonalizePage.state.recipientName = noteVal;
                }

                gbbGiftMessageV2ToField.on("change", function (event) {
                    gbb.gbbPersonalizePage.state.recipientName = gbbGiftMessageV2ToField.val();
                })

                return gbbGiftMessageV2ToFromContainer;
            },
            customerUploads: function () {
                let gbbCustomerUploadsHTML = gbb.$("<div>").addClass("gbbCustomerUploadsHTML");
                let gbbCustomerUploadsDivider = gbb.$("<div>").addClass("gbbCustomerUploadsDivider")
                let customerUploadTextFields = gbb.settings.customerUploads.textFields || {};

                // customerUploadTextFields.mainText = "Upload your photos here";
                // customerUploadTextFields.subText = "Supported Formats mp4. Max file size 5MB";

                //let gbbCustomerUploadsMainText, subtext and then a list of dialog
                let gbbCustomerUploadsMainText = gbb.$("<div>").addClass("gbbCustomerUploadsMainText").text(customerUploadTextFields.mainText.value);

                gbb.f.applyLabelCSS(gbbCustomerUploadsMainText)


                let gbbCustomerUploadsSubText = gbb.$("<div>").addClass("gbbCustomerUploadsSubText").text(customerUploadTextFields.subText.value);

                let gbbCustomerUploadsList = gbb.$("<div>").addClass("gbbCustomerUploadsList");

                // gbb.settings.customerUploads.attachmentFields = [{
                //     "label": "Photo 1",
                //     "url": "",
                // },
                // {
                //     "label": "Photo 2",
                //     "url": "",
                // },
                // {
                //     "label": "Photo 3",
                //     "url": "",
                // },
                // {
                //     "label": "Photo 4",
                //     "url": "",
                // }];

                let customerUploadsFields = gbb.settings.customerUploads.attachmentFields;
                //each field has a label
                customerUploadsFields.forEach((field, index) => {
                    let labelToDisplay = gbb.utility.removeFirstCharacterIfUnderscore(field.label);
                    let gbbCustomerUploadsListItem = gbb.$("<div>").addClass("gbbCustomerUploadsListItem").attr("data-field-key", field.label);
                    let gbbCustomerUploadsListItemLabel = gbb.$("<div>").addClass("gbbCustomerUploadsListItemLabel").text(labelToDisplay)


                    //.attr("for", `file-upload-${field.label}`);

                    let gbbCustomerUploadsListItemInput = gbb.$("<input>").addClass("gbbCustomerUploadsListItemInput").attr("type", "file").attr("id", `file-upload-${field.label}`)

                    // gbbCustomerUploadsListItemInput accept. excel, pdf, images .jpg .png .jpeg and videos
                    gbbCustomerUploadsListItemInput.attr("accept", ".xlsx,.xls,application/pdf,image/jpeg,image/png,image/jpg,video/*,image/heif,image/heic")

                    let gbbCustomerUploadsActionButton = gbb.$("<div>").addClass("gbbCustomerUploadsActionButton")

                    gbbCustomerUploadsActionButton.text(customerUploadTextFields.uploadText.value)
                    // gbbCustomerUploadsActionButton.addClass("gbbCustomerUploadButton")

                    let gbbCustomerUploadsButton = gbb.$("<label>").addClass("gbbCustomerUploadButton").attr("for", `file-upload-${field.label}`);
                    // gbbCustomerUploadsActionButton

                    // gbbCustomerUploadsButton.on("click", function (event) {
                    //     event.preventDefault();
                    //     gbbCustomerUploadsListItemInput.trigger("click");
                    // })

                    // gbbCustomerUploadsListItemInput.attr("data-field-index",index)
                    gbbCustomerUploadsListItemInput.attr("data-field-key", field.label);
                    gbbCustomerUploadsListItemInput.on("change", gbb.gbbPersonalizePage.events.onCustomerUploadsFileChange)
                    gbbCustomerUploadsListItem.append(gbbCustomerUploadsListItemLabel)
                    gbbCustomerUploadsListItem.append(gbbCustomerUploadsListItemInput)
                    gbbCustomerUploadsActionButton.append(gbbCustomerUploadsButton)
                    gbbCustomerUploadsListItem.append(gbbCustomerUploadsActionButton);
                    gbbCustomerUploadsList.append(gbbCustomerUploadsListItem);
                })

                let gbbCustomerUploadsErrorMsg = gbb.$("<div>").addClass("gbbCustomerUploadsErrorMsg");


                gbbCustomerUploadsHTML.append(gbbCustomerUploadsMainText)
                gbbCustomerUploadsHTML.append(gbbCustomerUploadsSubText)
                gbbCustomerUploadsHTML.append(gbbCustomerUploadsList)
                gbbCustomerUploadsHTML.append(gbbCustomerUploadsErrorMsg)
                gbbCustomerUploadsHTML.append(gbbCustomerUploadsDivider);

                // gbbCustomerUploadsErrorMsg
                return gbbCustomerUploadsHTML;

            },
            videoMessage: function (settings) {
                let gbbVideoMessageHTML = gbb.$("<div>").addClass("gbbVideoMessageHTML");
                let gbbVideoMsgCheckboxWrapper, gbbVideoMsgButtonGroup;
                let gbbVideoMsgCheckboxLabel;
                let videoId = gbb.utility.getAttributValueFromMessageItem("_videoMsgId");
                //TODO: video message entry index
                if (true) {
                    //gbbVideoMsgButton  = gbb.$("<button>").addClass("gbbVideoMsgButton").attr("type", "button").text(gbb.settings.languageData.videoMessage.sendVideoMessageText.value);
                    gbbVideoMsgButton = gbb.$("<button>").addClass("gbbVideoMsgButton").attr("type", "button").text("Video Msg");
                    gbbVideoMsgCheckboxLabel = gbb.$("<label>").addClass("gbbVideoMsgCheckboxLabel").attr("for", "gbbVideoMsgCheckbox").text(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.sendVideoMessageText) || "Record Video 1");
                    // create a label with switch classname

                    gbb.f.applyLabelCSS(gbbVideoMsgCheckboxLabel)

                    gbbVideoMsgCheckboxWrapper = gbb.$("<label>").addClass("gbbVideoMsgCheckboxWrapper").attr("for", "gbbVideoMsg")

                    //input which is type of checkbox
                    let gbbVideoMsgCheckboxField = gbb.$("<input>").addClass("gbbVideoMsgCheckboxField").attr("type", "checkbox").attr("id", "gbbVideoMsg");


                    if (videoId) {
                        gbbVideoMsgCheckboxField.prop("checked", true);
                    } else {
                        gbbVideoMsgCheckboxField.prop("checked", false);
                    }

                    // a span which is round and slider css
                    let gbbVideoMsgSlider = gbb.$("<span>").addClass("gbbVideoMsgSlider").attr("id", "gbbVideoMsgSlider");

                    gbbVideoMsgButtonGroup = gbb.$("<div>").addClass("gbbVideoMsgButtonGroup");

                    //re record button and upload button
                    // reRecordButton
                    let gbbVideoMsgReRecordButton = gbb.$("<button>").addClass("gbbVideoMsgReRecordButton").attr("type", "button").text(gbb.utility.renderLanguageValue(gbb.settings.languageData?.videoMessage?.reRecordText) || "Re-Record");
                    // uploadButton
                    let gbbVideoMsgSaveButton = gbb.$("<button>").addClass("gbbVideoMsgSaveButton").attr("type", "button").text(gbb.utility.renderLanguageValue(gbb.settings.languageData?.videoMessage?.saveVideoText) || "Save");

                    gbbVideoMsgButtonGroup.append(gbbVideoMsgReRecordButton);

                    gbbVideoMsgButtonGroup.append(gbbVideoMsgSaveButton);


                    gbbVideoMsgSaveButton.on("click", function (event) {
                        if (gbb.gbbVideoMsg.state.justNowRecorded) {
                            gbb.gbbVideoMsg.f.clickAccept(event)
                        } else {
                            return;
                        }
                    });

                    gbbVideoMsgReRecordButton.on("click", function (event) {
                        //manipulate the state of gbbVideoMsgCheckboxField
                        if (gbbVideoMsgCheckboxField.prop("checked")) {
                            gbbVideoMsgCheckboxField.prop("checked", false);
                            gbbVideoMsgSlider.removeClass("gbbVideoMsgSliderActive")
                            gbb.gbbVideoMsg.f.clickClose(event);
                        }
                        gbbVideoMsgCheckboxField.prop("checked", true);
                        gbb.gbbVideoMsg.actions.gbbVideoMsgButton(event);
                    });

                    gbbVideoMsgCheckboxField.on("change", function (event) {
                        if (gbbVideoMsgCheckboxField.is(":checked")) {
                            gbb.gbbVideoMsg.actions.gbbVideoMsgButton(event);
                        } else {
                            gbbVideoMsgSlider.removeClass("gbbVideoMsgSliderActive")
                            gbb.gbbVideoMsg.f.clickClose(event);
                        }
                    })
                    gbbVideoMsgCheckboxWrapper.append(gbbVideoMsgCheckboxField)
                    gbbVideoMsgCheckboxWrapper.append(gbbVideoMsgSlider)

                }
                let videoHasAlreadyBeenRecorded = gbb.$("<div>").addClass("gbbVideoHasAlreadyBeenRecorded");
                //007F60
                videoHasAlreadyBeenRecorded.text("You have already recorded a video")
                // gbbGiftMessageV2InputField and gbbGiftMessageV2Label are added to same parent div
                let gbbVideoMessageCheckboxRow = gbb.$("<div>").addClass("gbbVideoMessageCheckboxRow")
                gbb.f.applyLabelCSS(gbbVideoMsgCheckboxLabel)
                gbbVideoMessageCheckboxRow.append(gbbVideoMsgCheckboxLabel).append(gbbVideoMsgCheckboxWrapper)
                if (gbb.utility.getAttributValueFromMessageItem("_videoMsgId") || gbb.gbbVideoMsg.state.uploadedVideoId) {
                    gbbVideoMessageHTML.append(videoHasAlreadyBeenRecorded)
                }
                gbbVideoMessageHTML.append(gbbVideoMessageCheckboxRow)
                gbb.gbbVideoMsg.init(settings, "", gbbVideoMessageCheckboxRow);

                gbbVideoMessageHTML.append(gbbVideoMsgButtonGroup)
                return gbbVideoMessageHTML;
            },
            scheduleDelivery: async function (settings) {
                let gbbScheduleDeliveryHTML = gbb.$("<div>").addClass("gbbScheduleDeliveryHTML");
                let gbbScheduleDeliveryWrapper = gbb.$("<div>").addClass("gbbScheduleDeliveryWrapper");

                //import date-fns
                try {
                    await gbb.importExternalScript("date-flatpickr");
                    gbb.utility.debugConsole("date-flatpickr imported");
                }
                catch (error) {
                    await gbb.importExternalScript("selfHosted-date-flatpickr");
                    gbb.utility.triggerSlackNotification(error)
                    gbb.utility.debugConsole("date-flatpickr not imported");
                }

                const datePicker = gbb.$("<input>").addClass("gbbScheduleDeliveryDatePicker").attr("type", "date")


                datePicker.attr("placeholder", gbb.utility.renderLanguageValue(gbb.settings.languageData?.reviewPage?.deliverySchedulerPlaceholderText) || "Select Date");
                //append a label to the date picker
                // let gbbScheduleDeliveryDateLabel = gbb.$("<div>").addClass("gbbScheduleDeliveryDateLabel").text(gbb.utility.renderLanguageValue(gbb.settings.languageData?.personalizePage?.deliverySchedulerLabel) || "Schedule Delivery1");
                let gbbScheduleDeliveryDateLabel = gbb.$("<div>").addClass("gbbScheduleDeliveryDateLabel").text(gbb.utility.renderLanguageValue(gbb.settings.languageData?.reviewPage?.deliveryDateLabel) || "Schedule Delivery1");
                //gbb.f.applyLabelCSS(gbbScheduleDeliveryDateLabel)

                gbbScheduleDeliveryWrapper.append(gbbScheduleDeliveryDateLabel)

                gbbScheduleDeliveryWrapper.append(datePicker)
                gbbScheduleDeliveryHTML.append(gbbScheduleDeliveryWrapper);

                return gbbScheduleDeliveryHTML;
            },
            emailAddress: function (settings) {
                let emailAddressHTML = gbb.$("<div>").addClass("gbbEmailAddressHTML");
                let emailAddressWrapper = gbb.$("<div>").addClass("gbbEmailAddressWrapper");

                //introduce an input field to enter the email address
                let gbbVideoMsgEmailField = gbb.$("<input>").addClass("gbbVideoMsgEmailField").attr("type", "email").attr("placeholder", gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.personalizePage?.emailAddressPlaceholder) || "Enter Recipient Email Address1");

                let gbbEmailAddressLabelField = gbb.$("<label>").addClass("gbbEmailAddressLabelField").attr("for", "gbbVideoMsgEmailField").text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.personalizePage?.emailAddressLabel) || "Recipient Email Address1");

                gbb.f.applyLabelCSS(gbbEmailAddressLabelField)

                gbbVideoMsgEmailField.on("change", function (event) {
                    gbb.gbbVideoMsg.state.emailId = gbbVideoMsgEmailField.val();
                })

                if (gbb.utility.getAttributValueFromMessageItem("Recipient Email") != null) {
                    let value = gbb.utility.getAttributValueFromMessageItem("Recipient Email");
                    gbbVideoMsgEmailField.val(value)
                    gbb.gbbVideoMsg.state.emailId = value;
                    // gbbVideoMsgEmailField
                }
                let giftMessageDeliveryInfo = gbb.$("<div>").addClass("giftMessageDeliveryInfo").text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.videoMessage?.giftMessageDeliveryInfo) || "The message will be sent to the recipient via email as soon as the order is placed.");
                //insert the email field below the video message row

                emailAddressWrapper.append(gbbEmailAddressLabelField);
                emailAddressWrapper.append(gbbVideoMsgEmailField).append(giftMessageDeliveryInfo)

                emailAddressHTML.append(emailAddressWrapper);
                return emailAddressHTML;
            },
            scheduleMessageDelivery: function () {
                let gbbScheduleMessageDeliveryHTML = gbb.$("<div>").addClass("gbbScheduleMessageDeliveryHTML").text("Email Delivery Date");
                let gbbScheduleMessageDeliveryWrapper = gbb.$("<div>").addClass("gbbScheduleMessageDeliveryWrapper");

                let gbbScheduleMessageSendNowContainer = gbb.$("<button>").addClass("gbbScheduleMessageSendNowContainer");
                let gbbScheduleMessageSendLaterContainer = gbb.$("<button>").addClass("gbbScheduleMessageSendLaterContainer");

                let gbbScheduleMessageDatePicker = gbb.$("<input>").attr("type", "date").addClass("gbbScheduleMessageDatePicker");
                gbb.gbbPersonalizePage.state.emailDatePicker = gbbScheduleMessageDatePicker;

                let dateValue;
                let cartDateValue = gbb.utility.getAttributValueFromMessageItem("_gbbEmailDeliveryDate");
                let emailDeliveryOption = gbb.utility.getAttributValueFromMessageItem("_gbbEmailDeliveryOption");
                gbb.gbbPersonalizePage.state.emailDeliveryOption = emailDeliveryOption

                let today = new Date().toISOString().slice(0, 10);

                dateValue = cartDateValue || today;

                gbbScheduleMessageDatePicker.attr("value", dateValue);
                gbbScheduleMessageDatePicker.attr("max", new Date(new Date().getTime() + 30 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10));


                if (emailDeliveryOption == "sendLater") {
                    gbbScheduleMessageSendLaterContainer.addClass("gbbActiveMsgDeliveryOptions");
                    gbbScheduleMessageDatePicker.css("display", "block");
                } else {
                    gbbScheduleMessageSendNowContainer.addClass("gbbActiveMsgDeliveryOptions");
                }

                gbbScheduleMessageSendLaterContainer.on("click", (event) => {
                    gbbScheduleMessageDatePicker.css("display", "block");
                    gbbScheduleMessageSendLaterContainer.addClass("gbbActiveMsgDeliveryOptions");
                    gbbScheduleMessageSendNowContainer.removeClass("gbbActiveMsgDeliveryOptions");
                    gbb.gbbPersonalizePage.state.emailDeliveryOption = "sendLater"
                })

                gbbScheduleMessageSendNowContainer.on("click", () => {
                    gbbScheduleMessageDatePicker.css("display", "none");
                    gbbScheduleMessageSendNowContainer.addClass("gbbActiveMsgDeliveryOptions");
                    gbbScheduleMessageSendLaterContainer.removeClass("gbbActiveMsgDeliveryOptions");
                    gbb.gbbPersonalizePage.state.emailDeliveryOption = "sendNow"
                    gbbScheduleMessageDatePicker.attr("value", today);
                })

                gbbScheduleMessageSendNowContainer.text(gbb.utility.renderLanguageValue(gbb.settings.languageData.personalizePage.sendNow) || "Send Now1");
                gbbScheduleMessageSendLaterContainer.text(gbb.utility.renderLanguageValue(gbb.settings.languageData.personalizePage.sendLater) || "Send Later1");

                gbbScheduleMessageDeliveryWrapper.append(gbbScheduleMessageSendNowContainer);
                gbbScheduleMessageDeliveryWrapper.append(gbbScheduleMessageSendLaterContainer);

                gbbScheduleMessageDeliveryHTML.append(gbbScheduleMessageDeliveryWrapper);
                gbbScheduleMessageDeliveryHTML.append(gbbScheduleMessageDatePicker);


                return gbbScheduleMessageDeliveryHTML;
            }
        },
        action: {
            handlegreetingCardCheckboxEvent: function (event) {
                // gbb.$(".gbbGreetingCardImgContainer").addClass("")
                if (event.target.checked == true) {
                    gbb.$(".gbbGreetingCardImageContainer").removeClass("gbbDisabled");
                    //find gbbGreetingCardImageContainer inside of  greetingCardWrapper
                } else {
                    gbb.$(".gbbGreetingCardImageContainer").addClass("gbbDisabled");
                }
            },
            handleShowAllGreetingCardImagesButtonEvent: function (event) {
                // gbb.$(".greetingCardAllImagesContainer").toggleClass(");
                //hide the
                gbb.utility.debugConsole("Event triggered to show all greeting cards")
            },
            handlegiftWrapCheckboxEvent: function (event) {
                // gbb.$(".gbbGreetingCardImgContainer").addClass("")
                if (event.target.checked == true) {
                    gbb.$(".gbbGiftWrapImageContainer").removeClass("gbbDisabled");
                } else {
                    gbb.$(".gbbGiftWrapImageContainer").addClass("gbbDisabled");
                }
            },
            onClearSelectionButtonClick: async function (productType) {
                let products = gbb.state.giftBoxCartData.items;
                let allVariantIdList;
                if (productType == "greetingCard") {
                    allVariantIdList = gbb.settings.shopifyData?.greetingCardData?.variants?.map((variant) => {
                        return variant.id
                    });
                }
                if (productType == "giftWrap") {
                    allVariantIdList = gbb.settings.shopifyData?.giftWrapData?.variants?.map((variant) => {
                        return variant.id
                    });
                }
                let variantIdsToRemoveFromCart;
                //find all the variant ids in the cart whose properties have _boxProduct as the same as productType
                if (products) {
                    variantIdsToRemoveFromCart = products.map((product) => {
                        //product.properties is an object
                        if (product.properties["_boxProduct"] == productType) {
                            return product.variant_id
                        }
                    })
                    // remove null and undefined values

                    // ["123",undefined,undefined,"456"] -> ["123","456"]
                    variantIdsToRemoveFromCart = variantIdsToRemoveFromCart.filter((variantId) => {
                        return variantId != null || variantId != undefined;
                    })
                    await gbb.utility.removeFromCartBulk(variantIdsToRemoveFromCart, productType);
                }
                if (productType == "greetingCard") {
                    gbb.$(".gbbGreetingCardImageList").find(".gbb_checkmark").remove()
                    gbb.$(".gbbGreetingCardImageList").find(".gbbActiveGreetingCard").removeClass("gbbActiveGreetingCard")
                    gbb.gbbPersonalizePage.state.greetingCardActiveImageSrc = "";
                    gbb.gbbPersonalizePage.state.greetingCardTitle = "";
                    gbb.gbbPersonalizePage.state.greetingCardPrice = "";
                    gbb.$(".gbbGreetingCardCheckboxPrice").text(" ");
                    gbb.$(".gbbGreetingCardCheckboxLabel").text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.personalizePage?.selectGreetingCardLabel) || "Greeting Card1");
                }
                if (productType == "giftWrap") {
                    gbb.$(".giftWrapImageList").find(".gbb_checkmark").remove()
                    gbb.$(".giftWrapImageList").find(".activeGiftWrap").removeClass("activeGiftWrap")
                    gbb.gbbPersonalizePage.state.giftWrapActiveImageSrc = "";
                    gbb.gbbPersonalizePage.state.giftWrapTitle = "";
                    gbb.gbbPersonalizePage.state.giftWrapPrice = "";

                    gbb.$(".gbbGiftWrapCheckboxPrice").text(" ");
                    gbb.$(".gbbGiftWrapCheckboxLabel").text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.personalizePage?.giftWrapLabel) || "Select Wrap 1");
                }
                await gbb.utility.getGiftBoxProductsFromCart()
                gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML("personalizePage"));
            },
            onGreetingCardImageClick: async function (event) {
                event.preventDefault();
                //disable gbbGreetingCardImageList pointer events
                gbb.$(".gbbGreetingCardImageList").css("pointer-events", "none");
                // Pass either the image or just trigger this as a callback on Onclick
                let imageSrc;
                imageSrc = gbb.$(this).find("img").attr("src")
                gbb.utility.debugConsole("onclick triggered")
                // gbb.$('.greetingCardImagePreview').attr("src", imageSrc)


                // gbb.utility.addToCart
                //get the image attribute of data-variant-id
                let variantId = gbb.$(this).find("img").attr("data-variant-id");

                await gbb.gbbPersonalizePage.action.onClearSelectionButtonClick("greetingCard");
                gbb.gbbPersonalizePage.state.greetingCardActiveImageSrc = imageSrc


                //find the variant_title and price from the variantId by looping over gbb.settings.shopifyData.greetingCardData?.variants
                let variantTitle = "";
                let variantPrice = "";
                gbb.settings.shopifyData?.greetingCardData?.variants?.forEach((variant) => {
                    if (variant.id == variantId) {
                        variantTitle = variant.title;
                        variantPrice = variant.price;
                    }
                })
                if (variantTitle) {
                    gbb.gbbPersonalizePage.state.greetingCardTitle = variantTitle;
                    // gbb.$(".gbbGreetingCardCheckboxLabel").text(gbb.gbbPersonalizePage.state.greetingCardTitle)
                }
                gbb.$(this).find("input").prop("checked", true)
                gbb.$(this).addClass("gbbActiveGreetingCard")
                // add an icon on top of it
                gbb.gbbPersonalizePage.action.addCheckMarkDivs(gbb.$(this))
                gbb.gbbPersonalizePage.action.removeCheckmarkDivsFromSiblings(gbb.$(this))


                await gbb.utility.updateCartV2({ updates: { [variantId]: 1 }, attributes: { [variantId]: "greetingCard" } })
                gbb.$(".gbbGreetingCardImageList").css("pointer-events", "auto");
                await gbb.utility.getGiftBoxProductsFromCart();
                gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML("personalizePage"));
            },
            onGiftWrapImageClick: async function (event) {
                event.preventDefault();
                gbb.$(".giftWrapImageList").css("pointer-events", "none");
                // Pass either the image or just trigger this as a callback on Onclick
                let imageSrc;
                imageSrc = gbb.$(this).find("img").attr("src")

                await gbb.gbbPersonalizePage.action.onClearSelectionButtonClick("giftWrap");
                // gbb.$('.greetingCardImagePreview').attr("src", imageSrc)
                gbb.gbbPersonalizePage.state.giftWrapActiveImageSrc = imageSrc

                gbb.$(this).find("input").prop("checked", true)
                gbb.$(this).addClass("activeGiftWrap")
                // add an icon on top of it
                gbb.gbbPersonalizePage.action.addCheckMarkDivs(gbb.$(this))
                gbb.gbbPersonalizePage.action.removeCheckmarkDivsFromSiblings(gbb.$(this))
                // gbb.utility.addToCart
                //get the image attribute of data-variant-id
                // gbb.gbbPersonalizePage.f.activateClearSelectionButton("giftWrapImageList","giftWrap");

                let variantId = gbb.$(this).find("img").attr("data-variant-id");


                //find the variant_title and price from the variantId by looping over gbb.settings.shopifyData.greetingCardData?.variants
                let variantTitle = "";
                let variantPrice = "";
                gbb.settings?.shopifyData?.giftWrapData?.variants?.forEach((variant) => {
                    if (variant.id == variantId) {
                        variantTitle = variant.title;
                        variantPrice = variant.price;
                    }

                })
                if (variantTitle) {
                    gbb.gbbPersonalizePage.state.giftWrapTitle = variantTitle;
                }
                if (variantPrice) {
                    gbb.gbbPersonalizePage.state.giftWrapPrice = gbb.utility.formatPrice(variantPrice);
                }

                // gbbGiftWrapCheckboxLabel
                gbb.$(".gbbGiftWrapCheckboxLabel").text(gbb.gbbPersonalizePage.state.giftWrapTitle)
                gbb.$(".gbbGiftWrapCheckboxPrice").text(gbb.gbbPersonalizePage.state.giftWrapPrice)


                await gbb.utility.updateCartV2({ updates: { [variantId]: 1 }, attributes: { [variantId]: "giftWrap" } })
                gbb.$(".giftWrapImageList").css("pointer-events", "auto");
                await gbb.utility.getGiftBoxProductsFromCart()
                gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML("personalizePage"));
            },
            findSelectedGreetingCardImage: function () {
                let selectedGreetingCardImage = gbb.$(".greetingCardImageContainer").find(".gbbActiveGreetingCard")
                return selectedGreetingCardImage
            },
            removeCheckmarkDivsFromSiblings: function (element) {
                element.siblings().find(".gbb_checkmark").remove()
                element.siblings().removeClass("gbbActiveGreetingCard")
            },
            removeCheckmarkDivsFromGreetingCards: function () {
                gbb.$(".gbbGreetingCardImageList").find(".gbb_checkmark").remove()
                gbb.$(".gbbGreetingCardImageList").find(".gbbActiveGreetingCard").removeClass("gbbActiveGreetingCard")
            },
            removeCheckmarkDivsFromGiftWrap: function () {
                gbb.$(".giftWrapImageList").find(".gbb_checkmark").remove()
                gbb.$(".giftWrapImageList").find(".activeGiftWrap").removeClass("activeGiftWrap")
            },
            addCheckMarkDivs: function (element) {
                let checkMarkDiv = gbb.$("<span>").addClass("gbb_checkmark")
                checkMarkDiv.append(gbb.$("<div>").addClass("gbb_checkmark_circle"))
                checkMarkDiv.append(gbb.$("<div>").addClass("gbb_checkmark_stem"))
                checkMarkDiv.append(gbb.$("<div>").addClass("gbb_checkmark_kick"))
                element.append(checkMarkDiv)
            },

            showPersonalizationPage: async function () {
                //updatePageStatusFn
                // gbb.gbbAddProductsPage.state.updatePageStatusFn(1);
                let pageId = "personalizationPage";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            },

            uploadCustomerUploadsFile: async function (fileBlob, fieldKey) {
                try {
                    let formData = new FormData();

                    formData.append("shopName", gbb.settings.merchantInfo.shopName);
                    formData.append("upload_data", fileBlob);
                    formData.append("fieldKey", fieldKey);
                    // formData.append("fileExtension", fileExtension);
                    // formData.append("fileType", fileExtension);
                    // formData.append("fieldKey", fieldKey);
                    formData.append("upload_preset", "gbb_customer_uploads");
                    let response = await fetch("/apps/" + gbb.state.gbbUrl + "/upload/fileUploads", {
                        method: "POST",
                        body: formData
                    });
                    let data = await response.json();
                    return data;
                } catch (e) {
                    gbb.utility.debugConsole(e)
                    return false;
                }
            },
            refreshCustomerUploadsErrorMessage: function (buttonRef) {
                // fileSizeError
                // fileUploadError     

                try {
                    let fileSizeErrorText = gbb.settings.customerUploads.textFields.fileSizeError.value;
                    let fileUploadErrorText = gbb.settings.customerUploads.textFields.fileUploadError.value;
                    let fileNotSupportedText = gbb.settings.customerUploads.textFields.fileNotSupportedError.value;

                    let errorMsgField = gbb.$(".gbbCustomerUploadsErrorMsg");

                    if (errorMsgField) {
                        errorMsgField.html(" ");
                        const objectKeys = Object.keys(gbb.gbbPersonalizePage.state.customerUploadsErrors)

                        for (let i = 0; i < objectKeys.length; i++) {
                            let currentKey = objectKeys[i];
                            let currentItem = gbb.gbbPersonalizePage.state.customerUploadsErrors[currentKey];
                            if (currentItem) {
                                let isFileSizeError = currentItem.fileSizeError;
                                let isFileUploadError = currentItem.fileUploadError;
                                let isFileNotSupported = currentItem.fileNotSupportedError;
                                if (isFileSizeError) {
                                    errorMsgField.append(currentKey + " - " + fileSizeErrorText + "<br/>");
                                }
                                if (isFileUploadError) {
                                    errorMsgField.append(currentKey + " - " + fileUploadErrorText + "<br/>");
                                }
                                if (isFileNotSupported) {
                                    errorMsgField.append(currentKey + " - " + fileNotSupportedText + "<br/>");
                                }

                            }
                        }
                    } else {
                        gbb.utility.debugConsole("field not found")
                    }


                } catch (error) {
                    gbb.utility.debugConsole(error)
                    return;
                }

            },

            refreshCustomerUploadsList: function () {
                try {
                    let customerUploadsList = gbb.$(".gbbCustomerUploadsList");
                    //getCartAttributes
                    //filter attributes to get only those keys that are in customerUploads.fields
                    let customerUploadFields = gbb.settings.customerUploads.attachmentFields;

                    let customerUploads = {};
                    if (!customerUploadFields || !customerUploadFields?.length) {
                        return;
                    }
                    for (let i = 0; i < customerUploadFields?.length; i++) {
                        let currentKey = customerUploadFields[i].label;
                        let imageURL = gbb.utility.getAttributValueFromMessageItem(currentKey);
                        if (imageURL) {
                            customerUploads[currentKey] = imageURL;
                        }
                    }

                    // this occurs when the state is empty, often when the page is refreshed
                    if (gbb.gbbPersonalizePage.state.customerUploadsResponse == null) {
                        gbb.gbbPersonalizePage.state.customerUploadsResponse = customerUploads;
                    }

                    let customerUploadsTextFields = gbb.settings.customerUploads.textFields || {};
                    if (customerUploadsList) {
                        for (let i = 0; i < customerUploadFields.length; i++) {
                            let currentKey = customerUploadFields[i].label;
                            let currentItem = gbb.gbbPersonalizePage.state.customerUploadsResponse[currentKey];
                            let currentListItem = gbb.$(".gbbCustomerUploadsListItem[data-field-key='" + currentKey + "']");
                            let gbbCustomerUploadsActionButton = currentListItem.find(".gbbCustomerUploadsActionButton");
                            if (currentItem) {
                                if (currentListItem) {
                                    //currentListItem has a gbbCustomerUploadsActionButton that should be hidden 
                                    let removeButton = currentListItem.find(".gbbCustomerUploadsRemoveButton");
                                    gbbCustomerUploadsActionButton.removeClass("gbbDisabled");
                                    let previewButton = gbb.$("<div>").addClass("gbbCustomerUploadPreviewButton").text(customerUploadsTextFields.previewText.value || "Preview");

                                    //remove all previous on click events from the button

                                    // gbbCustomerUploadsActionButton.addClass("gbbCustomerUploadPreviewButton")
                                    // gbbCustomerUploadsActionButton.removeClass("gbbCustomerUploadButton")

                                    // gbbCustomerUploadsActionButton.off("click");
                                    previewButton.on("click", function () {
                                        gbb.utility.debugConsole("Clicked on preview from current Item");
                                        window.open(currentItem, '_blank')
                                    });

                                    if (removeButton.length > 0 == false) {
                                        removeButton = gbb.$("<div>").addClass("gbbCustomerUploadsRemoveButton")
                                    }

                                    removeButton.html(CONSTANT_CLOSE_ICON_SVG)


                                    //add a remove button
                                    removeButton.on("click", function () {
                                        gbb.utility.debugConsole("remove button clicked")
                                        currentListItem.find(".gbbCustomerUploadsListItemInput").val("");
                                        gbb.gbbPersonalizePage.f.deleteCustomerUploadsError(currentKey);
                                        gbb.gbbPersonalizePage.f.deleteCustomerUploadsResponse(currentKey);

                                        gbb.gbbPersonalizePage.action.refreshCustomerUploadsList();
                                    });
                                    gbbCustomerUploadsActionButton.html(previewButton)
                                    currentListItem.append(removeButton);
                                }
                            } else {
                                gbb.utility.debugConsole("currentListItem not found")
                                gbbCustomerUploadsActionButton.removeClass("gbbDisabled");
                                // gbbCustomerUploadsActionButton.text(customerUploadsTextFields.uploadText.value || "Upload");
                                // gbbCustomerUploadsActionButton.removeClass("")
                                // gbbCustomerUploadsActionButton.addClass("gbbCustomerUploadButton")
                                //remove the previous click event
                                // gbbCustomerUploadsActionButton.off("click");
                                let gbbCustomerUploadButton = gbb.$("<label>").addClass("gbbCustomerUploadButton").text(customerUploadsTextFields.uploadText.value || "Upload").attr("for", `file-upload-${currentKey}`);
                                // gbbCustomerUploadButton.on("click",function(event){
                                //     gbb.utility.debugConsole("Clicked on upload from current Item");
                                //     event.preventDefault();
                                //     currentListItem.find(".gbbCustomerUploadsListItemInput").trigger("click");
                                // });
                                gbbCustomerUploadsActionButton.html(gbbCustomerUploadButton);
                                gbb.$(currentListItem).find(".gbbCustomerUploadsRemoveButton").remove();
                            }
                        }
                    }
                    gbb.utility.debugConsole("list refreshed")
                } catch (error) {
                    gbb.utility.debugConsole(error)
                }
            },
        }
    },
    gbbProductFormStep: {
        state: {
            formSubmissionData: {},
        },
        components: {
            prepareTextHTML: function (formData, productData) {

                gbb.gbbProductFormStep.f.initFormSubmissionData(formData, productData);

                // Container creation
                let container = gbb.$("<div>").addClass("gbbProductFormTextContainer").attr("fieldKey", formData.fieldKey)

                // Label creation
                let label = gbb.$("<div>").addClass("gbbProductFormTextLabel").text(formData.fieldLabel);
                container.append(label);

                // Validation message and character count
                let validationContainer = gbb.$("<div>").addClass("gbbProductFormValidationContainer");
                let validationMessage = gbb.$("<div>").addClass("gbbRequiredFieldMessage").text(formData.validationMessage)

                validationMessage.hide();


                let isRenderMultiLineInput = formData?.allowMultiLineText || false;

                // Input field creation
                let inputField;
                if (isRenderMultiLineInput) {
                    inputField = gbb.$("<textarea>").addClass("gbbProductFormText").attr({
                        placeholder: formData.placeholderText,
                        fieldKey: formData.fieldKey,
                        isMandatory: formData.isMandatory,
                        minCharacterLimit: formData?.minCharacterLimit || 0,
                        maxCharacterLimit: formData?.maxCharacterLimit || 99999
                    });
                } else {
                    inputField = gbb.$("<input>").addClass("gbbProductFormText").attr({
                        placeholder: formData.placeholderText,
                        type: "text",
                        fieldKey: formData.fieldKey,
                        isMandatory: formData.isMandatory,
                        minCharacterLimit: formData?.minCharacterLimit || 0,
                        maxCharacterLimit: formData?.maxCharacterLimit || 99999
                    });
                }
               // Initial value and character count
                let initialValue = gbb.gbbProductFormStep.state.formSubmissionData[formData.fieldKey]?.value || "";
                inputField.val(initialValue);

                // Character count display creation
                let characterCount = gbb.$("<div>").addClass("gbbProductFormTextCharacterCount").text(initialValue.length + "/" + formData.maxCharacterLimit);
                if (!formData?.maxCharacterLimit) {
                    characterCount.hide();
                }

                // On key up event
                inputField.on("keyup", function (e) {
                    gbb.gbbProductFormStep.f.handleInputChange(gbb.$(this), validationMessage, characterCount);
                });

                container.append(inputField);
                validationContainer.append(validationMessage, characterCount);
                container.append(validationContainer);

                return container;
            },

            prepareImageSelectorHTML: function (formData, productData) {
                gbb.gbbProductFormStep.f.initFormSubmissionData(formData, productData);

                // Initialize variables
                let formSubmissionData = gbb.gbbProductFormStep.state.formSubmissionData;
                let fieldKey = formData.fieldKey;
                let images = formData.images;
                let selectedImage = formSubmissionData[fieldKey]?.value || "";

                // Create main container
                // // let gbbProductFormImageSelectorContainer = createContainer("gbbProductFormImageSelectorContainer", formData.fieldLabel);
                // let gbbProductFormImageSelectorContainer = gbb.$("<div>").addClass("gbbProductFormImageSelectorContainer");


                // // Create image list container
                // let gbbProductFormImageSelectorListContainer = createContainer("gbbProductFormImageSelectorListContainer");

                let gbbProductFormImageSelectorContainer = gbb.$("<div>").addClass("gbbProductFormImageSelectorContainer").attr("fieldKey", fieldKey)
                let gbbProductFormImageSelectorLabel = gbb.$("<div>").addClass("gbbProductFormImageSelectorLabel").text(formData.fieldLabel);
                let gbbProductFormImageSelectorListContainer = gbb.$("<div>").addClass("gbbProductFormImageSelectorListContainer");

                // Create image list
                let gbbProductFormImageSelectorListItems = gbb.$("<div>").addClass("gbbProductFormImageSelectorListItems");


                // Validation message and character count
                let validationContainer = gbb.$("<div>").addClass("gbbProductFormValidationContainer");
                let validationMessage = gbb.$("<div>").addClass("gbbRequiredFieldMessage").text(formData.validationMessage)

                validationMessage.hide();


                // If mandatory, select first image
                if (false && formData.isMandatory && images.length > 0) {
                    selectedImage = images[0].imageCaption;
                }

                // Create image list items
                images.forEach(image => {
                    let currentImageListItem = gbb.gbbProductFormStep.f.createImageListItem(image, fieldKey, selectedImage);
                    gbbProductFormImageSelectorListItems.append(currentImageListItem);
                });

                // Append list items to the list container
                let gbbProductFormImageSelectorList = gbb.$("<div>").addClass("gbbProductFormImageSelectorList");
                gbbProductFormImageSelectorList.append(gbbProductFormImageSelectorListItems);

                // Append list container to the main container
                validationContainer.append(validationMessage);

                gbbProductFormImageSelectorListContainer.append(gbbProductFormImageSelectorList);
                gbbProductFormImageSelectorContainer.append(gbbProductFormImageSelectorLabel);
                gbbProductFormImageSelectorContainer.append(gbbProductFormImageSelectorListContainer);
                gbbProductFormImageSelectorContainer.append(validationContainer);

                return gbbProductFormImageSelectorContainer;


            },
            prepareRadioHTML: function (formData) {

                gbb.gbbProductFormStep.f.initFormSubmissionData(formData);

                // Initialize variables
                let formSubmissionData = gbb.gbbProductFormStep.state.formSubmissionData;
                let fieldKey = formData.fieldKey;
                let options = formData.options;
                let selectedOption = formSubmissionData[fieldKey]?.value || "";

                // Create main container
                let gbbProductFormRadioContainer = gbb.$("<div>").addClass("gbbProductFormRadioContainer").attr("fieldKey", fieldKey);
                let gbbProductFormRadioLabel = gbb.$("<div>").addClass("gbbProductFormRadioLabel");
                gbbProductFormRadioLabel.text(formData.fieldLabel);
                gbbProductFormRadioContainer.append(gbbProductFormRadioLabel);

                // Create radio list container
                let gbbProductFormRadioListContainer = gbb.$("<div>").addClass("gbbProductFormRadioListContainer");

                // Create radio list
                let gbbProductFormRadioListItems = gbb.$("<div>").addClass("gbbProductFormRadioListItems");

                // If mandatory, select first option
                if (formData.isMandatory && options.length > 0) {
                    selectedOption = options[0].value;
                }

                // Create radio list items
                options.forEach((option) => {
                    let currentRadioListItem = gbb.gbbProductFormStep.f.createRadioListItem(option, fieldKey, selectedOption);
                    gbbProductFormRadioListItems.append(currentRadioListItem);
                });

                // Append list items to the list container
                let gbbProductFormRadioList = gbb.$("<div>").addClass("gbbProductFormRadioList");
                gbbProductFormRadioList.append(gbbProductFormRadioListItems);

                // Append list container to the main container
                gbbProductFormRadioListContainer.append(gbbProductFormRadioList);
                gbbProductFormRadioContainer.append(gbbProductFormRadioListContainer);

                return gbbProductFormRadioContainer;



            },

        },
        f: {
            prepareFormToBeRenderedHTML: function (form, product) {

                gbb.gbbProductFormStep.state.formSubmissionData = {};

                // gbb.gbbAddProductsPage.state.productPersonalizationData has a block known as formblock
                //formBlocks: [
                // {
                //     type: "text",
                //     fieldLabel: "Your Name",
                //     fieldKey: "customerNameKey", // this will be used in SF as product attribute.
                //     placeholderText: "Enter your name",
                //     isMandatory: true,
                //     min and max character limit
                //     minCharacterLimit: 2,
                //     maxCharacterLimit: 10,
                //     validationMessage: "Name field is required"
                // },
                // 
                let gbbProductFormContainer = gbb.$("<div>").addClass("gbbProductFormContainer");
                let formComponentDiv;
                let productPersonalizationDataFormBlocks = gbb.gbbAddProductsPage.state.productPersonalizationData?.formBlocks || [];
                productPersonalizationDataFormBlocks.forEach((formBlock) => {
                    switch (formBlock.type) {
                        case "TEXT":
                            formComponentDiv = gbb.gbbProductFormStep.components.prepareTextHTML(formBlock, product);
                            break;
                        case "IMAGE_SELECTOR":
                            formComponentDiv = gbb.gbbProductFormStep.components.prepareImageSelectorHTML(formBlock, product);
                            break;
                        case "RADIO":
                            formComponentDiv = gbb.gbbProductFormStep.components.prepareRadioHTML(formBlock, product);
                            break;

                        // case "radio":
                        //     formComponentDiv = gbb.f.prepareRadioHTML(formBlock);
                        //     break;
                        // case "checkbox":
                        //     formComponentDiv = gbb.f.prepareCheckboxHTML(formBlock);
                        //     break;
                        // case "imageSelector":
                        //     formComponentDiv = gbb.f.prepareImageSelectorHTML(formBlock);
                        //     break;
                        // case default:
                        //     break;
                    }
                    gbbProductFormContainer.append(formComponentDiv);
                })

                return gbbProductFormContainer;

            },
            // formSubmissionData
            initFormSubmissionData: function (formData, productData) {
                try {
                    let formSubmissionData = gbb.gbbProductFormStep.state.formSubmissionData;
                    let fieldKey = formData.fieldKey;
                    formSubmissionData[fieldKey] = {
                        ...gbb.gbbProductFormStep.state.formSubmissionData[fieldKey],
                        fieldLabel: formData.fieldLabel,
                        type: formData.type,
                        value: "",
                        isValid: formData.isMandatory ? false : true,
                        isMandatory: formData.isMandatory,
                        showValueOnSummaryPage: formData?.showValueOnSummaryPage || false,
                    }

                    // let retreiveProductFormTextFromCart = gbb.gbbProductFormStep.f.retreiveProductFormTextFromCart(fieldKey,productData);

                    // if(retreiveProductFormTextFromCart){
                    //     formSubmissionData[fieldKey] = {
                    //         value : retreiveProductFormTextFromCart,
                    //         isValid: true,
                    //         isMandatory : formData.isMandatory,
                    //     }
                    // }

                    gbb.gbbProductFormStep.state.formSubmissionData = formSubmissionData;
                } catch (error) {
                    gbb.utility.debugConsole(error)
                }
            },
            handleFormSubmissionData: function (key, data) {
                gbb.utility.debugConsole("Data to be updated is", data);
                let formSubmissionData = gbb.gbbProductFormStep.state.formSubmissionData;
                formSubmissionData[key] = {
                    // value: value,
                    ...formSubmissionData[key],
                    ...data,
                }
                gbb.gbbProductFormStep.state.formSubmissionData = formSubmissionData;

                // let currentVariantData = JSON.parse(JSON.stringify(gbb.state.variantCustomProperties));
                // currentVariantData[key] = value;
                // gbb.state.variantCustomProperties = currentVariantData;
            },
            checkFormValidationForProduct: function () {
                let formSubmissionData = gbb.gbbProductFormStep.state.formSubmissionData || {};
                let isFormValid = true;
                let formSubmissionDataKeys = Object.keys(formSubmissionData);
                for (let i = 0; i < formSubmissionDataKeys.length; i++) {
                    let currentKey = formSubmissionDataKeys[i];
                    let currentData = formSubmissionData[currentKey];
                    if (currentData.isValid == false) {
                        isFormValid = false;
                        break;
                    }
                }
                return isFormValid;
            },
            displayRequiredFieldMessage: function () {
                let formSubmissionData = gbb.gbbProductFormStep.state.formSubmissionData || {};
                let formSubmissionDataKeys = Object.keys(formSubmissionData);
                for (let i = 0; i < formSubmissionDataKeys.length; i++) {
                    let currentKey = formSubmissionDataKeys[i];
                    let currentData = formSubmissionData[currentKey];
                    let currentInput = gbb.$(`[fieldKey="${currentKey}"]`);
                    let currentInputRequiredFieldMessage = currentInput.find(".gbbRequiredFieldMessage");
                    if (currentData.isValid == false) {
                        currentInputRequiredFieldMessage.css("display", "block");
                    } else {
                        currentInputRequiredFieldMessage.css("display", "none");
                    }
                }
            },
            retreiveProductFormTextFromCart: function (key, product) {
                // let cartData = gbb.gbbBrowser.getCartDataFromSessionStorage();
                let cartData = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(gbb.state.activeBoxId)
                let productFormText = "";
                if (cartData && cartData.items.length > 0) {
                    // let itemsInTheCart = cartData.boxes[gbb.state.activeBoxId].items;
                    let itemsInTheCart = cartData.items;
                    let productInCart = itemsInTheCart.find((item) => {
                        return item.product_id == product.id;
                    })
                    if (productInCart && productInCart.properties) {
                        let properties = productInCart.properties;
                        if (properties && properties[key]) {
                            productFormText = properties[key];
                        }
                    }
                }
                return productFormText;
            },
            handleInputChange: function (currentInput, validationMessage, characterCount) {
                let currentValue = currentInput.val();
                let minLimit = parseInt(currentInput.attr("minCharacterLimit")) || 1;
                let maxLimit = currentInput.attr("maxCharacterLimit");
                let isMandatory = currentInput.attr("isMandatory") == "true";
                let fieldKey = currentInput.attr("fieldKey");
                let isValidationPassed = true;
                let characterCountText = currentValue.length + "/" + maxLimit;

                if (isMandatory && (currentValue.length < minLimit || currentValue.length > maxLimit)) {
                    isValidationPassed = false;
                    //dont show validation message now, we will show it later
                    //when user clicks on Add TO box
                    // validationMessage.show();
                } else {
                    validationMessage.hide();
                }

                if (currentValue.length > maxLimit) {
                    currentInput.val(currentValue.substring(0, maxLimit));
                    currentValue = currentInput.val();
                    characterCountText = maxLimit + "/" + maxLimit;
                }

                characterCount.text(characterCountText);
                gbb.gbbProductFormStep.f.handleFormSubmissionData(fieldKey, { value: currentValue, isValid: isValidationPassed });
            },
            createImageListItem: function (image, fieldKey, selectedImage) {
                let currentImageListItem = gbb.$("<div>").addClass("gbbProductFormImageSelectorListItem");
                let currentImageLabel = gbb.$("<label>").addClass("gbbPersonalizationImageLabel").attr("fieldKey", fieldKey)
                let captionSpan = gbb.$("<span>").addClass("gbbPersonalizationImageCaption").text(image.imageCaption);
                let currentImageListItemRadio = gbb.$("<input>").addClass("personalizationImageInput").attr("type", "radio").attr("name", fieldKey).attr("value", image.imageCaption).attr("fieldKey", fieldKey);
                let currentImageListItemImage = gbb.$("<img>").addClass("personalizationImage").attr("src", image.url).attr("fieldKey", fieldKey);

                currentImageLabel.append(currentImageListItemRadio, currentImageListItemImage);
                currentImageLabel.append(captionSpan);

                currentImageListItem.append(currentImageLabel);


                currentImageListItemRadio.on("click", function (event) {
                    gbb.gbbProductFormStep.f.handleImageSelection(gbb.$(this), currentImageListItem);
                });

                if (selectedImage == image.imageCaption) {
                    currentImageListItemRadio.trigger("click");
                }

                return currentImageListItem;
            },
            handleImageSelection: function (selectedRadio, currentListItem) {
                let radioValue = selectedRadio.val();
                let radioName = selectedRadio.attr("name");

                gbb.gbbProductFormStep.f.handleFormSubmissionData(radioName, { value: radioValue, isValid: true });

                currentListItem.addClass("gbbActiveImageSelectorListItem");
                currentListItem.siblings().removeClass("gbbActiveImageSelectorListItem");

                currentListItem.find(".gbb_checkmark").remove();
                gbb.gbbPersonalizePage.action.addCheckMarkDivs(currentListItem);
                gbb.gbbPersonalizePage.action.removeCheckmarkDivsFromSiblings(currentListItem);
            },
            createRadioListItem: function (option, fieldKey, selectedOption) {
                let currentRadioListItem = gbb.$("<div>").addClass("gbbProductFormRadioListItem");
                let currentRadioLabel = gbb.$("<label>").addClass("gbbpersonalizationRadioLabel").attr("fieldKey", fieldKey);
                let currentRadioItemRadio = gbb.$("<input>").addClass("personalizationRadioInput").attr("type", "radio").attr("name", fieldKey).attr("value", option.value).attr("fieldKey", fieldKey);
                let currentRadioListItemLabel = gbb.$("<span>").addClass("personalizationRadioLabel").text(option.label).attr("fieldKey", fieldKey);

                currentRadioLabel.append(currentRadioItemRadio, currentRadioListItemLabel);
                currentRadioListItem.append(currentRadioLabel);

                currentRadioItemRadio.on("click", function (event) {
                    gbb.gbbProductFormStep.f.handleRadioSelection(gbb.$(this), currentRadioListItem);
                });

                if (selectedOption == option.value) {
                    currentRadioItemRadio.trigger("click");
                }

                return currentRadioListItem;
            },

            handleRadioSelection: function (selectedRadio, currentListItem) {
                let radioValue = selectedRadio.val();
                let radioName = selectedRadio.attr("name");

                gbb.gbbProductFormStep.f.handleFormSubmissionData(radioName, { value: radioValue, isValid: true });

                currentListItem.addClass("gbbActiveRadioSelectorListItem");
                currentListItem.siblings().removeClass("gbbActiveRadioSelectorListItem");
            }

        }
    },
    gbbReviewPage: {
        state: {
            buildBoxButtonAction: undefined,
            ReviewPageBody: ""
        },
        init: async function (settings, parent) {
            if (true || gbb.state.currentPageId !== 'reviewPage') {
                gbb.gbbBrowser.emitCustomEvent({
                    eventName: 'gbb-page-init',
                    detail: {
                        prevPageId: gbb.state.currentPageId,
                        activePageId: 'reviewPage'
                    }
                })
            }
            gbb.state.currentPageId = "reviewPage"
            if (gbb?.gbbAddProductsPage?.state?.productPageData) {
                gbb.gbbAddProductsPage.state.productPageData = undefined
            }
            let navItem = gbb.utility.getNavItem(gbb.state.currentPageId)
            gbb.f.markPreviousNavigationItemsAsCompleted(navItem)
            let cartData = gbb.gbbBrowser.getCartDataFromSessionStorage();
            if (cartData && Object.keys(cartData.boxes).length > 0 && gbb.gbbBrowser.getProductsFromAllBoxesFromCart()?.length > 0 && !gbb.gbbReviewPage.f.checkIfAllBoxesHaveZeroPrice(cartData)) {
                await gbb.gbbReviewPage.initialize(settings, parent)
                await gbb.utility.getGiftBoxProductsFromCart(); //#TBD
            } else {
                await gbb.gbbReviewPage.renderEmptyState();
            }
            gbb.utility.renderTemporaryLoadingSpinner("hide")

            gbb.gbbReviewPage.f.registerEvents(settings)


            // gbb.gbbModel.init(settings)
        },
        renderEmptyState: async function () {

            let gbbEmptySummaryPageWrapper = gbb.$("<div>").addClass("gbbEmptySummaryPageWrapper");
            let gbbSummaryPageHTML = gbb.$("<div>").addClass("gbbSummaryPageBodyHTML");
            const EmptySummaryPageBanner = gbb.$("<div>").addClass("gbbEmptySummaryPageBanner");
            //all the text and button goes in this div
            const EmptySummaryPageBannerImage = gbb.$("<img>").addClass("gbbEmptySummaryPageBannerImage");
            const EmptySummaryPageBannerTextWrapper = gbb.$("<div>").addClass("gbbEmptySummaryPageBannerTextWrapper")
                .css("color", gbb.settings?.pageCustomizationData?.SummaryPage?.bannerTextColor)
                .css("width", "100%");
            const EmptySummaryPageBannerText = gbb.$("<div>").addClass("gbbEmptySummaryPageBannerText");
            const EmptySummaryPageAction = gbb.$("<div>").addClass("EmptySummaryPageAction");

            EmptySummaryPageAction.text(gbb.settings?.stepsConfigurationData?.summaryPageData?.reviewPageEmptyStateBannerButtonText || DEFAULT_EMPTY_REVIEWPAGE_BUTTONTEXT);
            EmptySummaryPageAction.on("click", function (event) {
                gbb.gbbBrowser.initializeRelevantBoxQuantity();
                gbb.state.currentPageId = gbb.state.navigationItems[0]['id'];
                let firstPageItem = gbb.f.getNavItem(gbb.state.currentPageId);
                firstPageItem.initFn();
                gbb.f.addParamsToUrl("page", firstPageItem.id)
            })
            //subtext
            const EmptySummaryPageBannerSubText = gbb.$("<div>").addClass("gbbEmptySummaryPageBannerSubText");
            EmptySummaryPageBannerImage.attr("src", gbb.settings?.stepsConfigurationData?.summaryPageData?.reviewPageEmptyStateBanner || DEFAULT_EMPTY_REVIEWPAGE_BANNER);

            EmptySummaryPageBannerText.text(gbb.settings?.stepsConfigurationData?.summaryPageData?.reviewPageEmptyStateBannerText);
            EmptySummaryPageBannerSubText.text(gbb.settings?.stepsConfigurationData?.summaryPageData?.reviewPageEmptyStateBannerSubText);

            EmptySummaryPageBannerTextWrapper.append(EmptySummaryPageBannerText);
            EmptySummaryPageBannerTextWrapper.append(EmptySummaryPageAction);
            EmptySummaryPageBannerTextWrapper.append(EmptySummaryPageBannerSubText);

            EmptySummaryPageBanner.append(EmptySummaryPageBannerImage);

            gbbSummaryPageHTML.append(EmptySummaryPageBanner);
            gbbSummaryPageHTML.append(EmptySummaryPageBannerTextWrapper);
            gbbEmptySummaryPageWrapper.append(gbbSummaryPageHTML);

            gbb.state.ReviewPageBody = gbbEmptySummaryPageWrapper;
            gbb.gbbReviewPage.f.insertIntoMainPageWrapper();
        },
        initialize: async function (settings, parent) {

            // gbb.utility.debugConsole("settings:",settings.giftwrap);
            // let {isEnabledOnProductPage, isEnabledOnCartPage} = gbb.gbbLandingPage.f.checkifGiftWrapEnabled(settings.giftwrap, productHandle, parent)
            // if (isEnabledOnProductPage) {
            const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()
            let gbbSummaryPageWrapper = gbb.$("<div>").addClass("gbbSummaryPageWrapper");
            if (isPurchaseTypeSubscription) { 
                gbbSummaryPageWrapper.addClass('gbbSubscriptionBundle')
            }
            const gbbSummaryPageHeaderHTML = gbb.gbbReviewPage.f.prepareHeader();
            const gbbDiscountComponent = gbb.$("<div>").addClass("gbbDiscountComponent");
            const gbbSummaryPageBodyHTML = await gbb.gbbReviewPage.f.prepareUIV2();
            // const gbbReviewPageFooterHTML = gbb.gbbReviewPage.f.prepareFooter();

            gbbSummaryPageWrapper.append(gbbSummaryPageHeaderHTML);
            gbbSummaryPageWrapper.append(gbbDiscountComponent);
            gbbSummaryPageWrapper.append(gbbSummaryPageBodyHTML);
            // gbbSummaryPageWrapper.append(gbbReviewPageFooterHTML);

            gbb.state.ReviewPageBody = gbbSummaryPageWrapper;
            gbb.gbbReviewPage.f.insertIntoMainPageWrapper();

            gbb.$("body").attr("data-page", gbb.state.currentPageId)

            // const gbbScheduleDeliveryWrapper = gbb.$();
            //find the selector which is in DEFAULT_scheduleDeliveryPickerSelector
            let gbbSummaryPageDeliveryAndOrderDetailsUI = gbb.$(document).find(".gbbSummaryPageDeliverOrderDetailsDiv");
            gbbSummaryPageDeliveryAndOrderDetailsUI.append(await gbb.gbbReviewPage.f.prepareDeliveryAndOrderDetailsUI());
            gbb.gbbReviewPage.f.reRenderDiscountAndSubTotalV2()

        },
        f: {

            prepareHeader: function () {
                //this is a header
                const gbbSummaryPageHeaderHTML = gbb.$("<div>").addClass("gbbSummaryPageHeader");
                // gbbSummaryPageHeaderHTML.append("<div> <h1> Header Gift Box Builder</h1> </div>");
                // return gbbSummaryPageHeaderHTML;
            },
            prepareUIV2: async function () {

                let gbbSummaryPageHTML = gbb.$("<div>").addClass("gbbSummaryPageHTML");

                const SummaryPageBanner = gbb.$("<div>").addClass("gbbSummaryPageBanner");
                //all the text and button goes in this div
                const SummaryPageBannerImage = gbb.$("<img>").addClass("gbbSummaryPageBannerImage");

                const gbbSummaryPageBannerTextWrapper = gbb.$("<div>").addClass("gbbSummaryPageBannerTextWrapper")
                    .css("color", gbb.settings?.pageCustomizationData?.SummaryPage?.bannerTextColor)
                    .css("width", "100%");
                const SummaryPageBannerText = gbb.$("<div>").addClass("gbbSummaryPageBannerText");
                //subtext
                const SummaryPageBannerSubText = gbb.$("<div>").addClass("gbbSummaryPageBannerSubText");

                SummaryPageBannerImage.attr("src", gbb.settings.pageCustomizationData.banners.productReviewImageSrc);
                SummaryPageBannerText.text(gbb.settings?.stepsConfigurationData?.summaryPageData?.reviewPageBannerText);
                SummaryPageBannerSubText.html(gbb.settings?.stepsConfigurationData?.summaryPageData?.reviewPageBannerSubtext);

                gbbSummaryPageBannerTextWrapper.append(SummaryPageBannerText);
                gbbSummaryPageBannerTextWrapper.append(SummaryPageBannerSubText);

                SummaryPageBanner.append(SummaryPageBannerImage);

                let gbbSummaryPageBodyWrapper = gbb.$("<div>").addClass("gbbSummaryPageBodyWrapper");

                let gbbSummaryPageBundlesContainer = await gbb.gbbReviewPage.f.prepareBundleDetailsContainerUI();
                // if(gbbSummaryPageBundlesContainer.length == 0) {
                //     gbbSummaryPageBundlesContainer = gbb.$("<div>").addClass("gbbSummaryPageBundlesContainer");
                // } else {
                //     gbbSummaryPageBundlesContainer.html("");
                // }

                // let allBoxes = gbb.gbbBrowser.getCartDataFromSessionStorage();
                // allBoxes = allBoxes?.boxes || {}
                // let allBoxesKeys = Object.keys(allBoxes) || [];
                // for(let i=0; i < allBoxesKeys.length; i++) {
                //     let box = allBoxes[allBoxesKeys[i]];
                //     gbbSummaryPageBundlesContainer.append(await gbb.gbbReviewPage.f.prepareBundleDetailsUI(box));
                // }

                let gbbSummaryPageSubsriptionDiv = await gbb.gbbReviewPage.f.prepareSubscriptionUI();
                let gbbSummaryPageDeliverOrderDetailsDiv = gbb.$("<div>").addClass("gbbSummaryPageDeliverOrderDetailsDiv");
                let gbbSummaryPageOrderDetailsUI = gbb.$("<div>").addClass("gbbSummaryPageOrderDetailsUI");

                let gbbCustomHTMLBlock = gbb.gbbReviewPage.f.customHTMLBlock()


                gbbSummaryPageBodyWrapper.append(gbbSummaryPageBundlesContainer);

                if (gbb.settings?.stepsConfigurationData?.isOrderSubscriptionsEnabled) {
                    // gbbSummaryPageBodyWrapper.append(gbbSummaryPageSubsriptionDiv);
                    gbbSummaryPageDeliverOrderDetailsDiv.append(gbbSummaryPageSubsriptionDiv);
                }
                gbbSummaryPageBodyWrapper.append(gbbSummaryPageDeliverOrderDetailsDiv);
                gbbSummaryPageBodyWrapper.append(gbbSummaryPageOrderDetailsUI);

                //gbbSummaryPageHTML.append(SummaryPageBanner);
                gbbSummaryPageHTML.append(gbbSummaryPageBannerTextWrapper);
                gbbSummaryPageHTML.append(gbbSummaryPageBodyWrapper);
                gbbSummaryPageHTML.append(gbbCustomHTMLBlock);
                return gbbSummaryPageHTML;
            },
            prepareSubscriptionUI: async function () {
                //initialize subscriptionValues
                const isOneTimePurchaseEnabled = gbb.settings?.stepsConfigurationData?.isOneTimePurchaseEnabled;

                if (isOneTimePurchaseEnabled == undefined || isOneTimePurchaseEnabled == true) {
                    gbb.gbbBrowser.updateSubscriptionType("oneTimeSubscription");
                } else {
                    gbb.gbbBrowser.updateSubscriptionType("saveSubscription");
                }

                if (gbb.gbbBrowser.getSubscriptionPlan()) {
                    gbb.gbbBrowser.removeSubscriptionPlan();
                }
                let gbbSummaryPageSubscriptionHTML = gbb.$("<div>").addClass("gbbSummaryPageSubscriptionHTML");
                // let gbbSummaryPageSubscriptionContainer = gbb.$("<div>").addClass("gbbSummaryPageSubscriptionContainer");

                let gbbSummaryPageOneTimeSubscriptionDiv = gbb.$("<div>").addClass("gbbSummaryPageOneTimeSubscriptionDiv");
                let gbbSummaryPageOneTimeSubscriptionInput = gbb.$("<input>").attr("id", "oneTimeSubscription").attr("type", "radio").attr("value", "oneTimeSubscription").addClass("gbbSummaryPageOneTimeSubscriptionInput");
                let gbbSummaryPageOneTimeSubscriptionLabel = gbb.$("<label>").attr("for", "oneTimeSubscription").addClass("gbbSummaryPageOneTimeSubscriptionLabel").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.reviewPage?.oneTimePurchaseLabel) || "One-Time Purchase");

                let gbbSummaryPageSubscriptionAndSaveDiv = gbb.$("<div>").addClass("gbbSummaryPageSubscriptionAndSaveDiv");
                let gbbSummaryPageSubscriptionAndSaveInputAndLabel = gbb.$("<div>").addClass("gbbSummaryPageSubscriptionAndSaveInputAndLabel");
                let gbbSummaryPageSubscriptionAndSaveInput = gbb.$("<input>").attr("id", "saveSubscription").attr("type", "radio").attr("value", "saveSubscription").addClass("gbbSummaryPageSubscriptionAndSaveInput");
                let gbbSummaryPageSubscriptionAndSaveLabel = gbb.$("<label>").attr("for", "saveSubscription").addClass("gbbSummaryPageSubscriptionAndSaveLabel").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.reviewPage?.subscribeAndSaveLabel) || "Subscribe and save");

                if (isOneTimePurchaseEnabled == undefined || isOneTimePurchaseEnabled) {
                    gbbSummaryPageOneTimeSubscriptionInput.prop("checked", gbb.gbbBrowser.getSubscriptionType() == "oneTimeSubscription" ? true : false);
                } else {
                    gbbSummaryPageSubscriptionAndSaveInput.prop("checked", true);
                }



                gbbSummaryPageSubscriptionAndSaveInputAndLabel.append(gbbSummaryPageSubscriptionAndSaveInput);
                gbbSummaryPageSubscriptionAndSaveInputAndLabel.append(gbbSummaryPageSubscriptionAndSaveLabel);
                gbbSummaryPageSubscriptionAndSaveInput.prop("checked", gbb.gbbBrowser.getSubscriptionType() == "saveSubscription" ? true : false);

                gbbSummaryPageOneTimeSubscriptionInput.on("change", () => {
                    gbb.gbbBrowser.updateSubscriptionType("oneTimeSubscription");
                    if (gbb.gbbBrowser.getSubscriptionPlan()) {
                        gbb.gbbBrowser.removeSubscriptionPlan();
                    }
                    gbb.$(".gbbSummaryPageNoSellingPlanFoundContainer").remove();
                    gbb.$(".gbbSummaryPageSubscriptionPlansDropdownContainer").remove();
                    gbb.gbbReviewPage.f.reRenderUiOnSubscriptionChange();
                    gbbSummaryPageSubscriptionAndSaveInput.prop("checked", false);
                })

                gbbSummaryPageSubscriptionAndSaveInput.on("change", async () => {
                    gbb.gbbBrowser.updateSubscriptionType("saveSubscription");
                    gbbSummaryPageOneTimeSubscriptionInput.prop("checked", false);
                    gbbSummaryPageSubscriptionAndSaveDiv.append(await gbb.gbbReviewPage.f.prepareSellingsPlansDropDown());

                    const subscriptionPlanExists = gbb.gbbReviewPage.f.checkIfSubscriptionPlanExists();
                    if (subscriptionPlanExists) {
                        gbb.gbbReviewPage.f.reRenderUiOnSubscriptionChange();
                    }
                })
                gbbSummaryPageOneTimeSubscriptionDiv.append(gbbSummaryPageOneTimeSubscriptionInput);
                gbbSummaryPageOneTimeSubscriptionDiv.append(gbbSummaryPageOneTimeSubscriptionLabel);

                gbbSummaryPageSubscriptionAndSaveDiv.append(gbbSummaryPageSubscriptionAndSaveInputAndLabel);

                if (isOneTimePurchaseEnabled != undefined && isOneTimePurchaseEnabled != true) {
                    gbbSummaryPageSubscriptionAndSaveDiv.append(await gbb.gbbReviewPage.f.prepareSellingsPlansDropDown("initialize"));
                    gbb.gbbBrowser.updateSubscriptionType("saveSubscription");
                    gbbSummaryPageOneTimeSubscriptionInput.prop("checked", false);
                    gbb.gbbReviewPage.f.reRenderUiOnSubscriptionChange();
                }

                if (isOneTimePurchaseEnabled == undefined || isOneTimePurchaseEnabled == true) {
                    gbbSummaryPageSubscriptionHTML.append(gbbSummaryPageOneTimeSubscriptionDiv);
                }

                gbbSummaryPageSubscriptionHTML.append(gbbSummaryPageSubscriptionAndSaveDiv);
                return gbbSummaryPageSubscriptionHTML;
            },
            prepareSellingsPlansDropDown: async function (type) {
                let gbbSummaryPageSubscriptionPlansDropdownContainer = gbb.$("<div>").addClass("gbbSummaryPageSubscriptionPlansDropdownContainer");
                let cartProducts = gbb.gbbBrowser.getProductsFromAllBoxesFromCart();

                for (let i = 0; i < cartProducts.length; i++) {
                    cartProducts[i].sellingPlanDetails = gbb.gbbReviewPage.f.getSellingPlanDetailsForVariant(cartProducts[i]?.selling_plan_groups, cartProducts[i]?.selling_plan_allocations);
                    gbb.gbbBrowser.updateCartItemSellingDetails(cartProducts[i]["variant_id"], cartProducts[i]?.sellingPlanDetails);
                }

                let isAllItemsHaveASellingPlan = gbb.gbbReviewPage.f.checkIfAllItemsHasASellingPlan();
                let allAvailableSubscriptions = gbb.gbbReviewPage.f.getAllSubscriptionPlans();
                allAvailableSubscriptions = Object.values(allAvailableSubscriptions) || [];

                if (!isAllItemsHaveASellingPlan || allAvailableSubscriptions.length == 0) {
                    let gbbSummaryPageNoSellingPlanFoundContainer = gbb.$("<div>").addClass("gbbSummaryPageNoSellingPlanFoundContainer");
                    gbbSummaryPageNoSellingPlanFoundContainer.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.reviewPage?.noSubscriptionFoundLabel) || "Oops! No Subscription Plans were found");
                    gbbSummaryPageSubscriptionPlansDropdownContainer.append(gbbSummaryPageNoSellingPlanFoundContainer);
                    if (gbb.gbbBrowser.getSubscriptionPlan()) {
                        gbb.gbbBrowser.removeSubscriptionPlan();
                    }
                } else {
                    const gbbSubscriptionDeliveryFrequencyLabel = gbb.$("<div>").addClass("gbbSubscriptionDeliveryFrequencyLabel");
                    gbbSubscriptionDeliveryFrequencyLabel.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.reviewPage?.deliveryFrequencyLabel) || "Delivery Frequency");
                    const gbbSubscriptionDropDownSelect = gbb.$("<select>").addClass("gbbSubscriptionDropDownSelect");
                    allAvailableSubscriptions.forEach((plan, index) => {
                        if (plan) {
                            //let planName = plan?.selling_plan_name + " " + "( " + gbb.utility.getCurrencySymbol() + plan?.per_delivery_price + "/" + (gbb.utility.renderLanguageValue(gbb.settings?.languageData?.reviewPage?.deliveryLabel) || "delivery") + " )" || "";
                            let planName = plan?.selling_plan_name;
                            let optionEle = gbb.$("<option>").attr("value", plan?.selling_plan_id)
                                .text(planName);
                            if (index == 0 && (!gbb.gbbBrowser.getSubscriptionPlan() || type == "initialize")) {
                                optionEle.attr("selected", "selected");
                                gbb.gbbBrowser.updateSubscriptionPlan(parseInt(plan?.selling_plan_id))
                            }
                            if (gbb.gbbBrowser.getSubscriptionPlan() == plan?.selling_plan_id) {
                                optionEle.attr("selected", "selected");
                            }
                            gbbSubscriptionDropDownSelect.append(optionEle)
                        }
                    })
                    gbbSubscriptionDropDownSelect.change(async (event) => {
                        gbb.gbbBrowser.updateSubscriptionPlan(parseInt(event.target.value));
                        gbb.gbbReviewPage.f.reRenderUiOnSubscriptionChange();
                    })
                    gbbSummaryPageSubscriptionPlansDropdownContainer.append(gbbSubscriptionDeliveryFrequencyLabel);
                    gbbSummaryPageSubscriptionPlansDropdownContainer.append(gbbSubscriptionDropDownSelect);
                }
                return gbbSummaryPageSubscriptionPlansDropdownContainer;
            },
            getSellingPlanDetailsForVariant: function (selling_plan_groups, selling_plan_allocations) {
                try {
                    // gbb.utility.debugConsole("inside getSellingPlanDetailsForVariant");
                    let result = {};
                    if (selling_plan_groups?.length > 0 && selling_plan_allocations?.length > 0) {
                        //loop through all the selling_plan_allocations
                        for (let i = 0; i < selling_plan_allocations.length; i++) {
                            let sellingPlanId = selling_plan_allocations[i]?.selling_plan_id; //current selling_plan_id from selling_plan_allocations of the variant
                            let sellingPlanName;
                            let perDeliveryPrice = selling_plan_allocations[i]?.per_delivery_price;
                            let price = selling_plan_allocations[i]?.price;
                            let sellingPlanGroup = selling_plan_groups.find(group => group.id == selling_plan_allocations[i]?.selling_plan_group_id); //find the selling plan group to which this plan belongs to get the name of the plan

                            for (let j = 0; j < sellingPlanGroup?.selling_plans.length; j++) { //loop through all the selling_plans of this group

                                let currentSellingPlan = sellingPlanGroup?.selling_plans[j];
                                if (currentSellingPlan && currentSellingPlan.id == sellingPlanId) {
                                    sellingPlanName = currentSellingPlan?.name || "";
                                    break;
                                }
                            }
                            result[sellingPlanId] = {
                                selling_plan_id: sellingPlanId,
                                selling_plan_name: sellingPlanName,
                                per_delivery_price: perDeliveryPrice,
                                price: price
                            }
                            //result.push(obj);
                        }
                    }
                    // gbb.utility.debugConsole("result inside getSellingPlanDetailsForVariant", result);
                    return result;
                } catch (err) {
                    gbb.utility.debugConsole(err);
                }
            },
            getAllSubscriptionPlans: function () {
                try {
                    let items = gbb.gbbBrowser.getProductsFromAllBoxesFromCart();
                    let uniquePlans = {};
                    for (let i = 0; i < items.length; i++) {
                        if (items[i]?.sellingPlanDetails) {
                            let sellingPlanDetails = Object.values(items[i]?.sellingPlanDetails) || [];
                            for (let j = 0; j < sellingPlanDetails?.length; j++) {
                                let currPlan = sellingPlanDetails[j] || "";
                                if (currPlan && !uniquePlans[currPlan.selling_plan_id]) {
                                    uniquePlans[currPlan.selling_plan_id] = {
                                        selling_plan_id: currPlan?.selling_plan_id || "",
                                        selling_plan_name: currPlan?.selling_plan_name || "",
                                        per_delivery_price: currPlan?.per_delivery_price || ""
                                    }
                                }
                            }
                        }
                    }

                    let tempUniquePlans = Object.values(uniquePlans) || [];

                    for (let i = 0; i < tempUniquePlans.length; i++) {
                        for (let j = 0; j < items.length; j++) {
                            let planToTest = items[j].sellingPlanDetails[tempUniquePlans[i]["selling_plan_id"]] || undefined;
                            if (!planToTest) {
                                delete uniquePlans[tempUniquePlans[i]["selling_plan_id"]]
                                break;
                            }
                        }
                    }
                    // gbb.utility.debugConsole("uniquePlans:", uniquePlans);
                    return uniquePlans;
                } catch (err) {
                    gbb.utility.debugConsole(err);
                    return {};
                }
            },
            checkIfAllItemsHasASellingPlan: function () {
                let result = true;
                let products = gbb.gbbBrowser.getProductsFromAllBoxesFromCart();
                // gbb.utility.debugConsole("products inside checkIfAllItemsHasASellingPlan:", products);
                for (let i = 0; i < products?.length; i++) {
                    if (!products[i]?.sellingPlanDetails || Object.values(products[i]?.sellingPlanDetails)?.length == 0) {
                        result = false;
                        break;
                    }
                }
                // gbb.utility.debugConsole("result inside checkIfAllItemsHasASellingPlan", result);
                return result;
            },
            prepareBundleDetailsContainerUI: async function (boxesData) {
                try {
                    let gbbSummaryPageBundlesContainer = gbb.$(".gbbSummaryPageBundlesContainer");
                    if (gbbSummaryPageBundlesContainer.length == 0) {
                        gbbSummaryPageBundlesContainer = gbb.$("<div>").addClass("gbbSummaryPageBundlesContainer");
                    } else {
                        gbbSummaryPageBundlesContainer.html("");
                    }
                    let allBoxes;
                    if (!boxesData) {
                        allBoxes = gbb.gbbBrowser.getCartDataFromSessionStorage();
                        allBoxes = allBoxes?.boxes || {};
                    } else {
                        allBoxes = boxesData?.boxes || {}
                    }

                    let allBoxesKeys = Object.keys(allBoxes) || [];
                    for (let i = 0; i < allBoxesKeys.length; i++) {
                        let box = allBoxes[allBoxesKeys[i]];
                        if (gbb.gbbReviewPage.f.checkIfCurrentBoxPriceIsZero(box)) {
                            continue;
                        }
                        gbbSummaryPageBundlesContainer.append(await gbb.gbbReviewPage.f.prepareBundleDetailsUI(box));
                    }
                    return gbbSummaryPageBundlesContainer;
                } catch (err) {
                    gbb.utility.debugConsole(err + "in prepareBundleDetailsContainerUI");
                }
            },
            prepareBundleDetailsUI: async function (box) {
                //items:
                const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()
                let gbbSummaryPageBundleDetailsHTML = gbb.$(".gbbSummaryPageBundleDetailsHTML");

                // if(true || gbbSummaryPageBundleDetailsHTML.length == 0) {
                gbbSummaryPageBundleDetailsHTML = gbb.$("<div>").addClass("gbbSummaryPageBundleDetailsHTML");
                // } else {
                //     //empty the div if found, below we will append the new content
                //     gbbSummaryPageBundleDetailsHTML.html("");
                // }

                let gbbSummaryPageBundleDetailsWithProducts = gbb.$("<div>").addClass("gbbSummaryPageBundleDetailsWithProducts");

                let gbbSummaryPageBundleImageTitleContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleImageTitleContainer");
                let gbbSummaryPageBundleImageContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleImageContainer");
                let gbbSummaryPageBundleImage = gbb.$("<img>").addClass("gbbSummaryPageBundleImage")
                    .attr("src", gbb.settings?.stepsConfigurationData?.bundleImg || DEFAULT_BUNDLE_IMAGE);
                gbbSummaryPageBundleImageContainer.append(gbbSummaryPageBundleImage);

                let gbbSummaryPageBundleDetailsContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleDetailsContainer");
                let gbbSummaryPageBundleDetails = gbb.$("<div>").addClass("gbbSummaryPageBundleDetails");

                let gbbSummaryPageBundleActions = gbb.$("<div>").addClass("gbbSummaryPageBundleActions");

                let gbbSummaryPageBundleTitleContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleTitleContainer");
                let gbbSummaryPageBundleTitle = gbb.$("<div>").addClass("gbbSummaryPageBundleTitle");
                gbbSummaryPageBundleTitle.text(gbb?.settings?.stepsConfigurationData?.bundleName || "BundleX");

                //this will be rendered with gbbSummaryPageBundlePriceContainer
                let gbbSummaryPageBundleQuantity = gbb.$("<div>").addClass("gbbSummaryPageBundleQuantity");
                // gbbSummaryPageBundleQuantity.text("x"+gbb.gbbBrowser.getRelevantBoxQuantity(box?.boxId));
                gbbSummaryPageBundleQuantity.text("x" + box?.boxQuantity || 1);

                let noOfItems = 0;
                let cartData = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(box?.boxId);
                if (cartData && cartData.items) {
                    noOfItems = cartData.items.length;
                }
                let gbbSummaryPageBundleItemsLabel = gbb.$("<div>").addClass("gbbSummaryPageBundleItemsLabel")
                    .text(noOfItems)
                gbbSummaryPageBundleItemsLabel.append(" ").append(gbb.settings?.languageData?.reviewPage?.itemsLabel?.value || "item(s)")
                gbbSummaryPageBundleTitleContainer.append(gbbSummaryPageBundleTitle);
                gbbSummaryPageBundleTitleContainer.append(gbbSummaryPageBundleItemsLabel);

                let gbbSummaryPageBundleQuantityContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleQuantityContainer");
                let gbbSummaryPageBundleQuantityText = gbb.$("<div>").addClass("gbbSummaryPageBundleQuantityText");
                // gbbSummaryPageBundleQuantityText.text(gbb.gbbBrowser.getRelevantBoxQuantity(box?.boxId));
                gbbSummaryPageBundleQuantityText.text(box?.boxQuantity || 1);

                let gbbSummaryPageBundleQuantityAddButton = gbb.$("<div>").addClass("gbbSummaryPageBundleQuantityAddButton");
                gbbSummaryPageBundleQuantityAddButton.css("background", gbb.settings.pageCustomizationData?.productCard?.productCardButtonColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                gbbSummaryPageBundleQuantityAddButton.css("color", gbb.settings.pageCustomizationData?.productCard?.productCardButtonTextColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);

                let gbbSummaryPageQuantityAddButtonWrapper = gbb.$("<div>").addClass("gbbSummaryPageQuantityAddButtonWrapper");
                gbbSummaryPageQuantityAddButtonWrapper.html("+");
                gbbSummaryPageBundleQuantityAddButton.append(gbbSummaryPageQuantityAddButtonWrapper);

                let gbbSummaryPageBundleQuantityRemoveButton = gbb.$("<div>").addClass("gbbSummaryPageBundleQuantityRemoveButton");
                gbbSummaryPageBundleQuantityRemoveButton.css("background", gbb.settings.pageCustomizationData?.productCard?.productCardButtonColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                gbbSummaryPageBundleQuantityRemoveButton.css("color", gbb.settings.pageCustomizationData?.productCard?.productCardButtonTextColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
                let gbbSummaryPageQuantityRemoveButtonWrapper = gbb.$("<div>").addClass("gbbSummaryPageQuantityRemoveButtonWrapper");
                gbbSummaryPageQuantityRemoveButtonWrapper.html("-");
                gbbSummaryPageBundleQuantityRemoveButton.append(gbbSummaryPageQuantityRemoveButtonWrapper);

                gbbSummaryPageBundleQuantityContainer.append(gbbSummaryPageBundleQuantityRemoveButton);
                gbbSummaryPageBundleQuantityContainer.append(gbbSummaryPageBundleQuantityText);
                gbbSummaryPageBundleQuantityContainer.append(gbbSummaryPageBundleQuantityAddButton);

                gbbSummaryPageBundleQuantityAddButton.on("click", (event) => {
                    setTimeout(function () {
                        //   gbb.utility.debugConsole("after timeeout");
                        gbbSummaryPageBundleQuantityAddButton.prop("disabled", false);
                        gbbSummaryPageBundleQuantityAddButton.removeClass("gbbDisabled");
                    }, 500);
                    let currentBundleQuantity = gbb.gbbBrowser.getRelevantBoxQuantity(box?.boxId);
                    currentBundleQuantity = gbb.gbbBrowser.updateRelevantBoxQuantity(currentBundleQuantity + 1, box?.boxId);
                    gbbSummaryPageBundleQuantityText.text(currentBundleQuantity);
                    gbbSummaryPageBundleQuantity.text("x" + currentBundleQuantity);

                    gbb.gbbReviewPage.f.reRenderDiscountAndSubTotalV2()
                })

                gbbSummaryPageBundleQuantityRemoveButton.on("click", (event) => {
                    setTimeout(function () {
                        // gbb.utility.debugConsole("after timeeout")
                        gbbSummaryPageBundleQuantityRemoveButton.prop('disabled', false);
                        gbbSummaryPageBundleQuantityRemoveButton.removeClass("gbbDisabled");
                    }, 500);
                    let currentBundleQuantity = gbb.gbbBrowser.getRelevantBoxQuantity(box?.boxId);
                    if (currentBundleQuantity > 1) {
                        currentBundleQuantity = gbb.gbbBrowser.updateRelevantBoxQuantity(currentBundleQuantity - 1, box?.boxId);
                        gbbSummaryPageBundleQuantityText.text(currentBundleQuantity);
                        gbbSummaryPageBundleQuantity.text("x" + currentBundleQuantity);
                        gbb.gbbReviewPage.f.reRenderDiscountAndSubTotalV2()
                    }
                })

                gbbSummaryPageBundleDetails.append(gbbSummaryPageBundleTitleContainer);
                if (isPurchaseTypeSubscription) {
                    let gbbSummaryPageBundleSubscriptionDetails = gbb.$("<div>").addClass("gbbSummaryPageBundleSubscriptionDetails");
                    const subscriptionDataFromSessionStorage = gbb.gbbSubscriptionProductsPage.f.getSubscriptionDataFromSessionStorage()
                    let activeSellingPlanDetails = subscriptionDataFromSessionStorage.activeSellingPlanDetails || {}
                    gbbSummaryPageBundleSubscriptionDetails.text(activeSellingPlanDetails?.displayTitle || "");
                    gbbSummaryPageBundleDetails.append(gbbSummaryPageBundleSubscriptionDetails);
                }
                gbbSummaryPageBundleDetails.append(gbbSummaryPageBundleQuantityContainer);
                // gbbSummaryPageBundleDetails.append(gbbSummaryPageBundleProductsContainer);

                let gbbSummaryPageBundlePriceContainer = gbb.$("<div>").addClass("gbbSummaryPageBundlePriceContainer");

                let gbbSummaryPageBundleOriginalPrice = gbb.$("<div>").addClass("gbbSummaryPageBundleOriginalPrice").css("color", "#625f5f");
                gbbSummaryPageBundleOriginalPrice.append(gbb.utility.formatPrice(box.total_price));

                let gbbSummaryPageBundlePriceLabel = gbb.$("<div>").addClass("gbbSummaryPageBundlePriceLabel").text("Price");

                let gbbSummaryPageBundleDiscountedPrice = gbb.$("<div>").addClass("gbbSummaryPageBundleDiscountedPrice");

                if (gbb.settings?.discountsData?.isDiscountEnabled && gbb.settings?.discountsData?.isShowDiscountsEnabled && gbb.utility.getGiftBoxProductsDiscountedTotal(box?.boxId) != parseFloat(box.total_price / 100)) {
                    gbbSummaryPageBundlePriceContainer.css("grid-template-columns", "1fr 1fr min-content")
                    gbbSummaryPageBundlePriceContainer.append(gbbSummaryPageBundleOriginalPrice);
                }

                // gbbSummaryPageBundlePriceContainer.append(gbbSummaryPageBundlePriceLabel);

                // gbbSummaryPageBundleDiscountedPrice.append(gbb.gbbBrowser.getRelevantGiftBoxProductsTotalWithCurrency(box?.boxId))
                let formattedDiscountedPrice = gbb.utility.formatPrice(box.total_price);
                let discountedTotal = gbb.utility.getGiftBoxProductsDiscountedTotal(box?.boxId);

                if (gbb.settings?.discountsData?.isDiscountEnabled && gbb.settings?.discountsData?.isShowDiscountsEnabled && gbb.utility.getGiftBoxProductsDiscountedTotal(box?.boxId) != parseFloat(box.total_price / 100)) {
                    discountedTotal = gbb.utility.getGiftBoxProductsDiscountedTotal(box?.boxId);
                    let discountedTotalInShopifyFormat = discountedTotal * 100;
                    formattedDiscountedPrice = gbb.utility.formatPrice(discountedTotalInShopifyFormat);
                }
                gbbSummaryPageBundleDiscountedPrice.append(formattedDiscountedPrice);

                gbbSummaryPageBundlePriceContainer.append(gbbSummaryPageBundleDiscountedPrice);
                gbbSummaryPageBundlePriceContainer.append(gbbSummaryPageBundleQuantity);
                gbbSummaryPageBundleActions.append(gbbSummaryPageBundlePriceContainer);


                let gbbSummaryPageBundleEditRemoveButtons = gbb.$("<div>").addClass("gbbSummaryPageBundleEditRemoveButtons");
                let gbbSummaryPageBundleRemoveButton = gbb.$("<div>").addClass("gbbSummaryPageBundleRemoveButton")
                    .text(gbb.settings?.languageData?.general?.removeButtonText?.value || "Remove");
                let gbbSummaryPageBundleEditButton = gbb.$("<div>").addClass("gbbSummaryPageBundleEditButton")
                    .text(gbb.settings?.languageData?.reviewPage?.editButtonText?.value || "Edit");

                gbbSummaryPageBundleEditButton.on("click", (event) => {
                    gbb.gbbBrowser.activateRelevantBoxInSessionStorage(box?.boxId, { redirectToFirstProductPage: true });
                })

                gbbSummaryPageBundleRemoveButton.on("click", async (event) => {
                    await gbb.gbbBrowser.clearRelevantBoxFromSessionStorage(box?.boxId);
                })

                gbbSummaryPageBundleEditRemoveButtons.append(gbbSummaryPageBundleEditButton);
                gbbSummaryPageBundleEditRemoveButtons.append(gbbSummaryPageBundleRemoveButton);
                gbbSummaryPageBundleActions.append(gbbSummaryPageBundleEditRemoveButtons);

                gbbSummaryPageBundleDetailsContainer.append(gbbSummaryPageBundleDetails);
                gbbSummaryPageBundleDetailsContainer.append(gbbSummaryPageBundleActions);

                // gbbSummaryPageBundleImageTitleContainer.append(gbbSummaryPageBundleImageContainer);
                // gbbSummaryPageBundleImageTitleContainer.append(gbbSummaryPageBundleDetailsContainer);

                let gbbSummaryPageBundleProductsMainContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleProductsMainContainer");
                //let gbbSummaryPageBundleProductEmptyDiv =  gbb.$("<div>").addClass("gbbSummaryPageBundleProductEmptyDiv");
                let gbbSummaryPageBundleProductsContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleProductsContainer");
                gbb.gbbReviewPage.f.populateIteminGiftBoxProductListV2(gbbSummaryPageBundleProductsContainer, box);
                //gbbSummaryPageBundleProductsMainContainer.append(gbbSummaryPageBundleProductEmptyDiv);
                gbbSummaryPageBundleProductsMainContainer.append(gbbSummaryPageBundleProductsContainer);

                //gbbSummaryPageBundleDetailsHTML.append(gbbSummaryPageBundleImageTitleContainer);
                gbbSummaryPageBundleDetailsHTML.append(gbbSummaryPageBundleImageContainer);
                gbbSummaryPageBundleDetailsWithProducts.append(gbbSummaryPageBundleDetailsContainer);
                gbbSummaryPageBundleDetailsWithProducts.append(gbbSummaryPageBundleProductsMainContainer);
                gbbSummaryPageBundleDetailsHTML.append(gbbSummaryPageBundleDetailsWithProducts);

                return gbbSummaryPageBundleDetailsHTML;
            },
            prepareBundleProductsUI: async function (products) {

                let gbbSummaryPageBundleProductsHTML = gbb.$("<div>").addClass("gbbSummaryPageBundleProductsContainer");

                let gbbSummaryPageBundleProductsContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleProductsContainer");
                let gbbSummaryPageBundleProductTitlesContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleProductTitlesContainer");
                let gbbSummaryPageBundleProductQtysPricesContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleProductQtysPricesContainer");

                products?.forEach((product) => {
                    let gbbSummaryPageBundleProductTitle = gbb.$("<div>").addClass("gbbSummaryPageBundleProductTitle");

                    let gbbSummaryPageBundleProductQtyPriceContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleProductQtyPriceContainer");
                    let gbbSummaryPageBundleProductPrice = gbb.$("<div>").addClass("gbbSummaryPageBundleProductPrice");
                    let gbbSummaryPageBundleProductQuantity = gbb.$("<div>").addClass("gbbSummaryPageBundleProductQuantity");
                    gbbSummaryPageBundleProductQtyPriceContainer.append(gbbSummaryPageBundleProductPrice);
                    gbbSummaryPageBundleProductQtyPriceContainer.append(gbbSummaryPageBundleProductQuantity);

                    gbbSummaryPageBundleProductTitlesContainer.append(gbbSummaryPageBundleProductTitle);
                    gbbSummaryPageBundleProductQtysPricesContainer.append(gbbSummaryPageBundleProductQtyPriceContainer);
                })
                gbbSummaryPageBundleProductsContainer.append(gbbSummaryPageBundleProductTitlesContainer);
                gbbSummaryPageBundleProductsContainer.append(gbbSummaryPageBundleProductQtysPricesContainer);

                gbbSummaryPageBundleProductsHTML.append(gbbSummaryPageBundleProductsContainer);
                return gbbSummaryPageBundleProductsHTML;
            },
            prepareDeliveryAndOrderDetailsUI: async function () {
                let gbbSummaryPageDeliveryAndOrderDetailsHTML = gbb.$("<div>").addClass("gbbSummaryPageDeliveryAndOrderDetailsHTML");
                let gbbSummaryPageDeliverDetails = await gbb.gbbReviewPage.f.prepareDeliveryDetailsUI();
                let gbbSummaryPageOrderDetails = await gbb.gbbReviewPage.f.prepareOrderDetailsUI();
                gbbSummaryPageDeliverDetails.append(gbbSummaryPageOrderDetails)

                //gbbSummaryPageDeliveryAndOrderDetailsHTML.append(gbbSummaryPageDeliverDetails);
                gbbSummaryPageDeliveryAndOrderDetailsHTML.append(gbbSummaryPageOrderDetails);
                return gbbSummaryPageDeliveryAndOrderDetailsHTML;
            },
            prepareDeliveryDetailsUI: async function () {
                let gbbScheduleDeliveryWrapper = gbb.$(document).find(gbb.selectors.scheduleDeliveryPickerSelector);
                let gbbScheduleDeliveryHeadingLabel = gbb.$("<div>").addClass("gbbScheduleDeliveryHeadingLabel");
                //gbbScheduleDeliveryHeadingLabel.text(gbb.settings?.languageData?.reviewPage?.deliveryDetails || "Delivery Details");

                if (gbb.settings?.scheduleDelivery?.isScheduleDeliveryEnabled) {
                    //gbbScheduleDeliveryWrapper.append(gbbScheduleDeliveryHeadingLabel);
                    let scheduleDeliveryHTML = await gbb.gbbPersonalizePage.components.scheduleDelivery();
                    gbbScheduleDeliveryWrapper.append(scheduleDeliveryHTML);
                }
                if (gbb.settings?.scheduleDelivery?.isScheduleDeliveryEnabled) {
                    gbb.gbbPersonalizePage.f.useDatePickerLibrary();
                }
                return gbbScheduleDeliveryWrapper;
            },
            prepareOrderDetailsUI: async function () {
                let gbbOrderDetailsHTMl = gbb.$("<div>").addClass("gbbOrderDetailsHTMl");
                let gbbOrderDetailsHeading = gbb.$("<div>").addClass("gbbOrderDetailsHeading");
                gbbOrderDetailsHeading.text(gbb.settings.languageData.reviewPage?.orderDetailsLabel?.value || "Order Details");

                let gbbOrderSubtotalTotalContainer = gbb.$("<div>").addClass("gbbOrderSubtotalTotalContainer");
                gbbOrderSubtotalTotalContainer.append(gbb.gbbReviewPage.f.prepareSubtotalContainerV2());

                let gbbDiscountContainer = gbb.$("<div>").addClass("gbbSummaryPageDiscountAppliedWrapper");
                if (gbb.gbbDiscountComponent.state.isAtleastOneDiscountActive) {
                    gbbDiscountContainer.html(gbb.gbbReviewPage.f.prepareDiscountContainerV2())
                }

                let gbbSummaryPageActionButtons = gbb.$("<div>").addClass("gbbSummaryPageActionButtons");
                // let gbbSummaryPageBackButton = gbb.$("<div>").addClass("gbbSummaryPageBackButton").text(gbb.settings?.languageData?.general?.backButtonText?.value || "Back")
                // gbbSummaryPageBackButton.css("background", gbb.settings.pageCustomizationData.cartFooter.cartFooterBackButtonColor);
                // gbbSummaryPageBackButton.css("color", gbb.settings.pageCustomizationData.cartFooter.cartFooterBackButtonTextColor);

                // gbbSummaryPageBackButton.on("click", function (event) {
                //     gbb.giftboxbuilderPage.action.onPrevNavigationBYOB();
                // })

                let checkoutButtonText = gbb?.settings?.languageData?.general?.checkoutButtonText?.value || "Checkout";

                if (gbb.settings.app.redirectToCartEnabled && !gbb.settings.app.redirectToCheckoutEnabled) {
                    checkoutButtonText = gbb?.settings?.languageData?.general?.addToCartButtonText?.value || "Add to Cart";
                }


                let gbbSummaryPageCheckoutButton = gbb.$("<div>").addClass("gbbSummaryPageCheckoutButton").text(checkoutButtonText);
                gbbSummaryPageCheckoutButton.css("background", gbb.settings.pageCustomizationData.summaryBlock.summaryBlockAddToCartButtonColor)
                gbbSummaryPageCheckoutButton.css("color", gbb.settings.pageCustomizationData.summaryBlock.summaryBlockAddToCartButtonTextColor)

                gbbSummaryPageCheckoutButton.on("click", async function (event) {
                    event.preventDefault();
                    event.stopPropagation();
                    gbbSummaryPageCheckoutButton.addClass("gbbDisabled")
                    gbbSummaryPageCheckoutButton.text(gbb.settings.languageData.general?.loadingCheckoutButtonText?.value || "Loading ...1")
                    if (gbb.gbbPersonalizePage.state.scheduleDeliveryDate) {
                        // await gbb.utility.updateCart({ attributes: { ["gbbScheduleDelivery"]: gbb.gbbPersonalizePage.state.scheduleDeliveryDate } });
                        gbb.gbbBrowser.updateCartAttributes({ "gbbScheduleDelivery": gbb.gbbPersonalizePage.state.scheduleDeliveryDate })
                    }
                    //if gbb.gbbDiscountComponent.state.currentDiscountRule

                    // let cartData = await gbb.utility.getCart();
                    // gbb.state.giftBoxCartData = cartData; //TBD
                    gbb.gbbBrowser.emitCustomEvent({
                        eventName: "gbb-checkout-button-click",
                        attachEventTo: gbbSummaryPageCheckoutButton[0]
                    })
                    await gbb.utility.handleCheckoutClick()
                    // setTimeout(()=>{
                    //     gbbSummaryPageCheckoutButton.removeClass("gbbDisabled");
                    //     gbbSummaryPageCheckoutButton.text(gbb?.settings?.languageData?.general?.checkoutButtonText?.value || "Checkout");
                    // },4000)
                    // await gbb.shopifyUtility.addToCart();

                    //check if discount is enabled
                })
                let gbbSummaryPageCreateNewBoxButton = gbb.$("<div>").addClass("gbbSummaryPageCreateNewBoxButton")
                    .text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.reviewPage?.createNewBoxLabel) || "Create a new Box");

                gbbSummaryPageCreateNewBoxButton.css("background", gbb.settings.pageCustomizationData.cartFooter.cartFooterBackButtonColor);
                gbbSummaryPageCreateNewBoxButton.css("color", gbb.settings.pageCustomizationData.cartFooter.cartFooterBackButtonTextColor);

                gbbSummaryPageCreateNewBoxButton.on("click", () => {
                    setTimeout(function () {
                        gbbSummaryPageCreateNewBoxButton.prop('disabled', false);
                        gbbSummaryPageCreateNewBoxButton.removeClass("gbbDisabled");
                    }, 500);
                    let isRedirectAllowed = true;
                    gbb.gbbBrowser.createNewBoxInSessionStorage(isRedirectAllowed);
                    gbb.gbbBrowser.emitCustomEvent({
                        eventName: "gbb-create-new-box-click",
                        attachEventTo: gbbSummaryPageCreateNewBoxButton[0]
                    })
                })
                //gbbSummaryPageActionButtons.append(gbbSummaryPageBackButton)
                gbbSummaryPageActionButtons.append(gbbSummaryPageCheckoutButton);

                if (gbb?.settings?.merchantInfo?.bundleSettings?.allowMultipleBoxesFromSameBundle) {
                    gbbSummaryPageActionButtons.append(gbbSummaryPageCreateNewBoxButton)
                }

                gbbOrderDetailsHTMl.append(gbbOrderDetailsHeading);
                gbbOrderDetailsHTMl.append(gbbOrderSubtotalTotalContainer);
                gbbOrderDetailsHTMl.append(gbbDiscountContainer);
                gbbOrderDetailsHTMl.append(gbbSummaryPageActionButtons);
                if (gbb.utility.checkIfBrandingShouldBeVisible()) {
                    gbbOrderDetailsHTMl.append(gbb.utility.renderPoweredByLabel());
                }
                return gbbOrderDetailsHTMl;
            },
            prepareDiscountContainerV2: function (cartData) {
                let discountContainerArray = []
                const boxQuantity = gbb.state.giftBoxCartData.boxQuantity
                let cartTotal;
                // if(!cartData){
                //      cartTotal = gbb.utility.calculateCartDiscount().cartTotalAmount;
                // }else{
                //     cartTotal = gbb.utility.calculateCartDiscount(cartData).cartTotalAmount;
                // }
                cartTotal = gbb.utility.calculateCartDiscount(cartData).cartTotalAmount + gbb.utility.calculateCartDiscount(cartData).cartBlacklistedItemsTotal;


                cartTotal = gbb.utility.formatPrice(cartTotal);

                let discountOffered = gbb.utility.calculateCartDiscount(cartData).cartDiscount;
                discountOffered = gbb.utility.formatPrice(discountOffered);

                discountOffered = "-" + discountOffered;

                let gbbSummaryPageDiscountAppliedContainer = gbb.$("<div>").addClass("gbbSummaryPageDiscountAppliedContainer")
                let gbbSummaryPageDiscountAppliedLabel = gbb.$("<div>").addClass("gbbSummaryPageDiscountAppliedLabel").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.reviewPage?.discountAppliedLabel) || "Discount")

                let gbbSummaryPageDiscountAppliedValue = gbb.$("<span>").addClass("gbbSummaryPageDiscountAppliedValue")
                gbbSummaryPageDiscountAppliedValue.append(discountOffered)

                gbbSummaryPageDiscountAppliedContainer.append(gbbSummaryPageDiscountAppliedLabel);
                gbbSummaryPageDiscountAppliedContainer.append(gbbSummaryPageDiscountAppliedValue);
                // let gbbSummaryPageDiscountAppliedValue = gbb.$("<span>").addClass("gbbSummaryPageDiscountAppliedValue")
                // gbbSummaryPageDiscountAppliedValue.append("      ").append(gbb.gbbDiscountComponent.state.currentDiscountRule.discountValue)

                let gbbSummaryPageTotalCartValueContainer = gbb.$("<div>").addClass("gbbSummaryPageTotalCartValueContainer")

                let gbbSummaryPageTotalCartValueLabel = gbb.$("<div>").addClass("gbbSummaryPageTotalCartValueLabel").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.reviewPage?.totalLabel) || "Total1")
                let gbbSummaryPageTotalCartValue = gbb.$("<div>").addClass("gbbSummaryPageTotalCartValue")
                gbbSummaryPageTotalCartValue.append(cartTotal)

                gbbSummaryPageTotalCartValueContainer.append(gbbSummaryPageTotalCartValueLabel);
                gbbSummaryPageTotalCartValueContainer.append(gbbSummaryPageTotalCartValue);

                discountContainerArray.push(gbbSummaryPageDiscountAppliedContainer)

                discountContainerArray.push(gbbSummaryPageTotalCartValueContainer)
                return discountContainerArray;
            },
            prepareSubtotalContainerV2: function (allBoxesData) {
                let gbbSummaryPageSubTotalCart = gbb.$("<div>").addClass("gbbSummaryPageSubTotalCart")
                //let gbbSummaryPageSubTotalCart = gbb.$("<div>").addClass("gbbSummaryPageSubTotalCart")
                let gbbSummaryPageSubTotalCartLabel = gbb.$("<div>").addClass("gbbSummaryPageSubTotalCartLabel").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.reviewPage?.subtotalLabel) || "Sub Total1")
                let gbbSummaryPageSubTotalValue = gbb.$("<div>").addClass("gbbSummaryPageSubTotalValue")
                // gbbSummaryPageSubTotalValue.append(gbb.utility.getGiftBoxProductsTotalWithCurrency())

                let _allBoxesData;
                if (allBoxesData) {
                    _allBoxesData = JSON.parse(JSON.stringify(allBoxesData));
                }
                let subtotalValue = gbb.utility.calculateCartDiscount(_allBoxesData).cartSubTotal + gbb.utility.calculateCartDiscount(_allBoxesData).cartBlacklistedItemsTotal;

                subtotalValue = gbb.utility.formatPrice(subtotalValue);

                gbbSummaryPageSubTotalValue.append(subtotalValue)


                gbbSummaryPageSubTotalCart.append(gbbSummaryPageSubTotalCartLabel)
                gbbSummaryPageSubTotalCart.append(gbbSummaryPageSubTotalValue)

                return gbbSummaryPageSubTotalCart;
            },
            // prepareSubtotalContainer: function () {
            //     let gbbSubTotalCartValue = gbb.$("<div>").addClass("gbbReviewPageSubTotalCart")
            //     let gbbSubTotalLabel = gbb.$("<div>").addClass("gbbReviewPageSubTotalCartLabel").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.reviewPage?.subtotalLabel) || "Sub Total1")
            //     gbbSubTotalLabel.append("      ").append(gbb.utility.getGiftBoxProductsTotalWithCurrency())
            //     gbbSubTotalCartValue.append(gbbSubTotalLabel)
            //     return gbbSubTotalCartValue;
            // },
            prepareFooter: function () {
                //this is a footer
                const gbbSummaryPageFooterHTML = gbb.$("<div>").addClass("gbbSummaryPageFooter");
                gbbSummaryPageFooterHTML.append("<div> <h1>Footer Gift Box Builder</h1> </div>");
                return gbbSummaryPageFooterHTML;
            },
            reRenderDiscountAndSubTotalV2: function (allBoxesData) {
                let gbbSummaryPageSubTotalCart = gbb.$(".gbbOrderSubtotalTotalContainer")

                gbbSummaryPageSubTotalCart.html(gbb.gbbReviewPage.f.prepareSubtotalContainerV2(allBoxesData))

                let gbbSummaryPageDiscountAppliedWrapper = gbb.$(".gbbSummaryPageDiscountAppliedWrapper")

                if (!gbbSummaryPageDiscountAppliedWrapper.length > 0) {
                    gbbSummaryPageDiscountAppliedWrapper = gbb.$("<div>").addClass("gbbSummaryPageDiscountAppliedWrapper")
                }
                //if theres an active discount rule
                if (gbb.gbbDiscountComponent.state.isAtleastOneDiscountActive) {
                    if (gbbSummaryPageDiscountAppliedWrapper.length > 0) {
                        // gbb.utility.debugConsole("->gbbreviewPage Code here works");

                        gbbSummaryPageDiscountAppliedWrapper.html(gbb.gbbReviewPage.f.prepareDiscountContainerV2(allBoxesData))
                    } else {
                        // gbb.utility.debugConsole("->came in else block");
                        gbb.$(".gbbSummaryPageDiscountAppliedWrapper").html(gbb.gbbReviewPage.f.prepareDiscountContainerV2(allBoxesData))
                    }
                }

                //if there is no active discount rule. remove the discount container
                else {
                    gbbSummaryPageDiscountAppliedWrapper.remove();
                }
            },
            renderChangeQuantity: async function () {
                // this is the increasedecrease comp
                let variantQuantity = 1;
                let gbbBundleQuantityHTMLContainer = gbb.$("<div>").addClass("gbbBundleQuantityHTMLContainer")

                let gbbBundleQuantityHTML = gbb.$("<div>").addClass("gbbBundleQuantityHTML");

                let gbbBundleQuantityHeading = gbb.$("<div>").addClass("gbbBundleQuantityHeading")
                // let gbbProductQuantityAddButton = gbb.$("<button>").addClass("gbbProductQuantityAddButton")
                let gbbBundleQuantityAddButton = gbb.$("<div>").addClass("gbbBundleChangeButton")
                    .css("background", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                    .css("color", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor)
                    .html("+")
                // let gbbProductQuantityRemoveButton = gbb.$("<button>").addClass("gbbProductQuantityRemoveButton")
                let gbbBundleQuantityRemoveButton = gbb.$("<div>").addClass("gbbBundleChangeButton")
                    .css("background", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                    .css("color", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor)
                    .html("-")
                let gbbBundleQuantityLabel = gbb.$("<div>").addClass("gbbBundleQuantityLabel");
                // gbbProductQuantityAddButton.append(gbb.$("<div>").addClass("gbbProductQuantityAddButtonWrapper").html("+"));
                // gbbProductQuantityRemoveButton.append(gbb.$("<div>").addClass("gbbProductQuantityRemoveButtonWrapper").html("-"));

                gbbBundleQuantityAddButton.on("click", async (event) => {
                    variantQuantity += 1;
                    gbbBundleQuantityLabel.text(variantQuantity);
                })

                gbbBundleQuantityRemoveButton.on("click", async (event) => {
                    if (variantQuantity > 0) {
                        variantQuantity -= 1;
                        gbbBundleQuantityLabel.text(variantQuantity);
                    }
                })

                gbbBundleQuantityLabel.text(variantQuantity);

                gbbBundleQuantityHeading.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.general.quantity) || "Quantity");

                gbbBundleQuantityHTML.append(gbbBundleQuantityRemoveButton)
                gbbBundleQuantityHTML.append(gbbBundleQuantityLabel);
                gbbBundleQuantityHTML.append(gbbBundleQuantityAddButton);
                gbbBundleQuantityHTMLContainer.append(gbbBundleQuantityHTML);

                return gbbBundleQuantityHTMLContainer;
            },
            insertIntoMainPageWrapper: function () {

                gbb.$(".gbbBodyWrapper").html(gbb.state.ReviewPageBody);
                gbb.$(".gbbBodyWrapper").children().first().hide();
                gbb.$(".gbbBodyWrapper").children().first().fadeIn(700);
                return

            },
            registerEvents: function (settings) {
                gbb.gbbLandingPage.state.buildBoxButtonAction = function () {
                    gbb.utility.debugConsole("build box button clicked");
                    // window.alert("build box button clicked");
                };
            },
            populateTotalInTotalBlock: async function (ele) {
                let total = gbb.utility.getGiftBoxProductsTotalWithCurrency()
                ele.text(total)

            },
            populateIteminGiftBoxProductListV2: function (gbbSummaryPageProductListItems, box) {

                try {
                    // let productData = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(boxId);
                    let productData = box;
                    if (productData && productData.items && productData.items.length && productData.items.length > 0) {
                        let products = productData.items
                        for (let i = 0; i < products.length; i++) {
                            let product = products[i]
                            let productProperties = product.properties
                            if (productProperties) {

                                let updateProductTitleOfMessage = gbb.gbbReviewPage.f.getProductTitleModifiedIfMessageOrUpload(product) || "";
                                let updateProductTitleOfProductsThatHavePersonalization = gbb.gbbReviewPage.f.getProductTitleModifiedForPersonalizedProducts(product) || "";

                                if (updateProductTitleOfMessage || updateProductTitleOfProductsThatHavePersonalization) {
                                    product.title = product?.product_title || product?.title || product?.public_title || "";
                                    product.title = product.title + updateProductTitleOfMessage + updateProductTitleOfProductsThatHavePersonalization || "";
                                }



                            }
                            let gbbSummaryPageProductListItem = gbb.$("<div>").addClass("gbbSummaryPageProductListItem")
                            let gbbSummaryPageProductTitleQtyPriceContainer = gbb.$("<div>").addClass("gbbSummaryPageProductTitleQtyPriceContainer");

                            let gbbSummaryPageProductTitleWrapper = gbb.$("<div>").addClass("gbbSummaryPageProductTitleWrapper")
                            let gbbSummaryPageProductQtyPriceContainer = gbb.$("<div>").addClass("gbbSummaryPageProductQtyPriceContainer")

                            let gbbSummaryPageProductListItemName = gbb.$("<div>").addClass("gbbSummaryPageProductListItemName").html(product.title)
                            let qtyHtml1 = gbb.$("<span>").css("font-size", "10px").text("x")
                            let qtyHtml2 = gbb.$("<span>").text("x" + product.quantity)
                            let gbbSummaryPageProductListItemQty = gbb.$("<div>").addClass("gbbSummaryPageProductListItemQty")
                            gbbSummaryPageProductListItemQty.append(qtyHtml2)

                            let gbbSummaryPageProductListItemPrice = gbb.$("<div>").addClass("gbbSummaryPageProductListItemPrice")
                            gbbSummaryPageProductListItemPrice.html(gbb.utility.formatPrice(product.price))
                            let gbbSummaryPageProductListItemRemoveBtn = gbb.$("<span>").addClass("gbbSummaryPageProductListItemRemoveBtn").text(`(${gbb.utility.renderLanguageValue(gbb.settings?.languageData.general.removeButtonText)})`)
                                .attr("data-variant_id", product.variant_id)
                                .attr("data-product_id", product.product_id)

                            gbbSummaryPageProductListItemRemoveBtn.on("click", async function (event) {

                                event.preventDefault();
                                event.stopPropagation();

                                //find the parent element gbbSummaryPageProductListItem and remove it
                                let listItemToBeRemoved = gbb.$(this).parents(".gbbSummaryPageProductListItem")
                                listItemToBeRemoved.remove()

                                gbb.$('.gbbSummaryPageProductListItemRemoveBtn').prop('disabled', true);
                                //add a disabled class
                                // gbb.$('.gbbSummaryPageProductListItemRemoveBtn').addClass('gbbDisabled');
                                setTimeout(function () {
                                    gbb.$('.gbbSummaryPageProductListItemRemoveBtn').prop('disabled', false);
                                    //    gbb.$('.gbbSummaryPageProductListItemRemoveBtn').removeClass('gbbDisabled');
                                }, 500);

                                await gbb.utility.updateCartV2({ updates: { [event.target.dataset.variant_id]: 0 }, attributes: { [event.target.dataset.variant_id]: "reviewPage" } })

                                gbb.gbbReviewPage.f.reRenderDiscountAndSubTotalV2()

                                // gbb.gbbReviewPage.init(gbb.settings, "SUMMARY_PAGE")

                            })

                            // let renderChangeQuantity = await gbb.gbbSummaryPage.f.renderChangeQuantity()

                            //add gbbSummaryPageProductListItemRemoveBtn inside gbbSummaryPageProductListItemName
                            // gbbSummaryPageProductListItemName.append("  ").append(gbbSummaryPageProductListItemRemoveBtn)
                            gbbSummaryPageProductTitleWrapper.append(gbbSummaryPageProductListItemName)
                            // gbbSummaryPageProductTitleWrapper.append(gbbSummaryPageProductListItemRemoveBtn)

                            gbbSummaryPageProductQtyPriceContainer.append(gbbSummaryPageProductListItemPrice)
                            gbbSummaryPageProductQtyPriceContainer.append(gbbSummaryPageProductListItemQty)

                            gbbSummaryPageProductTitleQtyPriceContainer.append(gbbSummaryPageProductTitleWrapper);
                            gbbSummaryPageProductTitleQtyPriceContainer.append(gbbSummaryPageProductQtyPriceContainer);
                            gbbSummaryPageProductListItem.append(gbbSummaryPageProductTitleQtyPriceContainer)


                            gbbSummaryPageProductListItems.append(gbbSummaryPageProductListItem)
                        }
                    }
                } catch (error) {
                    gbb.utility.debugConsole("error", error)
                }
            },
            getProductTitleModifiedIfMessageOrUpload: function (product) {
                try {
                    let titleResult = ""
                    if (product.properties) {
                        //find the value of Message
                        let messageKey = Object.keys(product.properties).find(key => key == "Message");
                        let message = product.properties[messageKey];
                        let recipientEmailKey = Object.keys(product.properties).find(key => key == "Recipient Email");
                        let recipientEmail = product.properties[recipientEmailKey];

                        let attachmentFields = gbb.settings.customerUploads && gbb.settings.customerUploads.attachmentFields && gbb.settings.customerUploads.attachmentFields.map(field => field.label);

                        let customerUploads = attachmentFields && Object.keys(product.properties).filter(key => attachmentFields.includes(key));
                        let videoRecordedKey = Object.keys(product.properties).find(key => key == "Video Recorded");
                        let videoRecordedValue = product.properties[videoRecordedKey];

                        if (message) {
                            titleResult = titleResult + " - " + message;
                        }
                        if (recipientEmail) {
                            titleResult = titleResult + " | Email: " + recipientEmail;
                        }
                        if (videoRecordedValue) {
                            titleResult = titleResult + " | Video Recorded: " + videoRecordedValue;
                        }
                        if (customerUploads) {
                            for (let i = 0; i < customerUploads.length; i++) {
                                let customerUpload = customerUploads[i];
                                customerUpload = gbb.utility.removeFirstCharacterIfUnderscore(customerUpload);
                                titleResult = titleResult + " | " + customerUpload;
                            }
                        }
                    }
                    return titleResult;
                } catch (error) {
                    gbb.utility.debugError("error in getProductTitleModifiedIfMessageOrUpload", error);
                }
            },
            getProductTitleModifiedForPersonalizedProducts: function (product) {
                try {
                    // initialize an empty string to hold the final title result
                    let titleResult = "";

                    // use destructuring to access product properties more directly
                    const productProps = product.properties;

                    if (productProps) {
                        // find the key for "productPersonalizationMetaData" from product properties
                        let personalizationKey = Object.keys(productProps).find(key => key === "productPersonalizationMetaData");

                        // if the key exists
                        if (personalizationKey) {
                            // clone product personalization metadata
                            let metaData = JSON.parse(JSON.stringify(productProps[personalizationKey]));

                            // get the keys of the product personalization metadata
                            let metaDataKeys = Object.keys(metaData);

                            // iterate over each key in product personalization metadata
                            metaDataKeys.forEach(key => {
                                // get the associated value or use empty string if undefined
                                let metaValue = metaData[key] || "";

                                // get field label and value from the metadata value
                                let fieldLabel = metaValue.fieldLabel;
                                let fieldValue = metaValue.value;

                                // create the result to be appended to title using field label and value (if value exists)
                                let appendResult = fieldValue ? `${fieldLabel}: ${fieldValue}` : "";

                                // add the result to the title string with a leading " | "
                                titleResult += ` | ${appendResult}`;
                            });
                        }
                    }

                    // return the final title result
                    return titleResult;
                } catch (error) {
                    // if an error occurs, log it as an error in the console
                    gbb.utility.debugError("error in getProductTitleModifiedForPersonalizedProducts", error);
                }
            },
            reRenderUiOnSubscriptionChange: async function () {
                let allBoxesData = await gbb.utility.getCart(); //TBD
                gbb.gbbReviewPage.f.reRenderDiscountAndSubTotalV2(allBoxesData);
                gbb.gbbReviewPage.f.prepareBundleDetailsContainerUI(allBoxesData);
            },
            checkIfSubscriptionPlanExists: function () {
                const checkIfAllItemsHasASellingPlan = gbb.gbbReviewPage.f.checkIfAllItemsHasASellingPlan()
                const getAllSubscriptionPlans = Object.values(gbb.gbbReviewPage.f.getAllSubscriptionPlans()).length > 0;
                return checkIfAllItemsHasASellingPlan && getAllSubscriptionPlans;
            },
            checkIfAllBoxesHaveZeroPrice: function (cartData) { //this function checks if the items added to cart are only free items
                try {
                    let allBoxesZeroPrice = true;
                    for (const boxId in cartData.boxes) {
                        const box = cartData.boxes[boxId];
                        if (box.total_price != 0) {
                            allBoxesZeroPrice = false;
                            break;
                        }
                    }
                    return allBoxesZeroPrice;
                } catch (err) {
                    gbb.utility.debugConsole(err);
                    return false;
                }
            },
            checkIfCurrentBoxPriceIsZero: function (box) { //this function checks if the items added to cart are only free items
                try {
                    if (box && box?.items?.length > 0 && box?.total_price == 0) {
                        return true;
                    }
                    return false;
                } catch (err) {
                    gbb.utility.debugConsole(err);
                    return false;
                }
            },
            customHTMLBlock: function () {
                let customHTMLBlock = gbb.settings?.stepsConfigurationData?.summaryPageData?.customHTMLBlock || "";
                return customHTMLBlock;
            },
        },
        events: function (settings) {
        },
        action: {
        }
    },


    gbbKite: {
        state: {
            isKiteEnabled: false,
        },
        init: function (settings) {
            gbb.gbbKite.initialize();
        },
        initialize: function () {
            try {
                gbb.gbbKite.f.overWriteDiscountMessaging();
                gbb.gbbKite.f.setMapForDiscountProducts();
            } catch (e) {
                gbb.utility.debugConsole("error in gbbKite initialize", e);
            }
            // gbb.utility.debugConsole("gbbKite initialized");
        },
        f: {
            setMapForDiscountProducts: function () {
                try {
                    if (!gbb.settings.gbbKiteData) {
                        return;
                    }

                    let discounts = gbb.settings.gbbKiteData?.discounts || [];
                    // Initialize a map for discount products
                    let discountMap = {};

                    // Loop through each discount object
                    for (let i = 0; i < discounts.length; i++) {
                        const discountObj = discounts[i];

                        // Check if isEBIntegrationEnabled is false
                        if (!discountObj.isEBIntegrationEnabled) {
                            continue;
                        }

                        // Get the first discount value from the rules
                        const discountValue = discountObj.rules[0].disValue;

                        // Get the discount type
                        const discountType = discountObj.disValueType;

                        // Get the products
                        const products = gbb.gbbKite.f.flattenProductsDataInDesiredFormat(discountObj);

                        // Loop through each product
                        for (let j = 0; j < products.length; j++) {
                            const product = products[j];

                            // Store the discount value and type for this product in the map
                            discountMap[product.productId] = { discountValue, discountType };
                        }
                    }
                    // Return the discount map
                    // return discountMap;
                    gbb.gbbKite.state.mapForDiscountProducts = discountMap;
                } catch (e) {
                    gbb.utility.debugConsole("error in setMapForDiscountProducts", e);
                }
            },
            modifyProductDataWithDiscountedPrice: function (productData) {
                try {
                    // Get the product id
                    const productId = productData.id;

                    //isDiscountToBeAppliedOnThisProduct(productData)

                    // Get the discount map
                    const discountMap = gbb.gbbKite.state.mapForDiscountProducts;



                    // Check if the product id exists in the discount map
                    if (discountMap && discountMap[productId]) {
                        // Get the discount value and type
                        const discountValue = discountMap[productId].discountValue;
                        const discountType = discountMap[productId].discountType;

                        // Get the product price

                        productData.compare_at_price = productData.price;
                        productData.price = gbb.gbbKite.f.modifyPriceBasedOnType(productData.price, { discountValue, discountType });


                        for (let i = 0; i < productData.variants.length; i++) {
                            let variant = productData.variants[i];
                            // variant.price = productPrice;
                            variant.compare_at_price = variant.price;
                            // variant.price = productPrice;
                            variant.price = gbb.gbbKite.f.modifyPriceBasedOnType(variant.price, { discountValue, discountType });
                        }



                    }

                    // Return the modified product data
                    return productData;
                } catch (e) {
                    gbb.utility.debugConsole("error in modifyProductDataWithDiscountedPrice", e);

                    // Return the original product data

                    return productData;
                }
            },
            modifyPriceBasedOnType: function (originalPrice, discountSettings) {
                let { discountValue, discountType } = discountSettings;

                // Apply the discount to the price
                if (discountType === 'PERCENTAGE_DIS') {
                    return originalPrice * (1 - (discountValue / 100));
                } else if (discountType === 'FIXED_DIS') {
                    // multiply by 100 to convert to shopify api original way
                    discountValue = discountValue * 100;
                    return Math.max(originalPrice - discountValue, 0);
                } else {
                    // If the discount type is not recognized, return the original price
                    return originalPrice;
                }
            },

            overWriteDiscountMessaging: function() {
                try {
                    if (gbb.settings.discountsData.isKiteDiscountMessagingEnabled) {
                        gbb.settings.discountsData.rules = gbb.settings.discountsData.kiteDiscountMessaging.rules;
                        gbb.settings.discountsData.discountTextBody = gbb.settings.discountsData.kiteDiscountMessaging.discountTextBody;
                        gbb.settings.discountsData.discountTextForSuccess = gbb.settings.discountsData.kiteDiscountMessaging.discountTextForSuccess;
                    }    
                } catch (error) {
                     gbb.utility.debugConsole("error in overWriteDiscountMessaging", error);
                }
            },
            flattenProductsDataInDesiredFormat: function (discountsObj) {
                try {
                    // Initialize an empty array to hold the normalized products data
                    let flattenedData = [];

                    let productsContainerObj = discountsObj.disProducts;

                    let discountType = productsContainerObj.type;



                    // if the type is "ALL_PRODUCTS", all products are discounted
                    // if (discountType === 'ALL_PRODUCTS') {
                    //     return [];
                    // }

                    // if the type is "COLLECTIONS", check if the product's ID is in the selected collections
                    if (discountType === 'COLLECTIONS') {
                        // Flatten array of product objects in each collection into a single array of product IDs
                        let productsListFromAllCollections = productsContainerObj.collectionsData.map(collection => collection.productList).flat();

                        flattenedData = [...new Set(productsListFromAllCollections)]

                        // Filter products data based on collectionProductIds
                        // flattenedData = productsData.filter(product => collectionProductIds.includes(product.productId));
                    }

                    // if the type is "SELECTED_PRODUCTS", check if the product's ID is in the selected products
                    if (discountType === 'SELECTED_PRODUCTS') {
                        // create an array of product IDs
                        // let selectedProductIds = discountsObj.products.map(product => product.productId);

                        flattenedData = productsContainerObj.products
                        // Filter products data based on selectedProductIds
                        // flattenedData = productsData.filter(product => selectedProductIds.includes(product.productId));
                    }

                    // Return flattened data
                    return flattenedData;
                } catch (error) {
                    gbb.utility.debugError('Error occurred while flattening the products data: ', error);
                    return [];
                }
            },




            isDiscountToBeAppliedOnThisProduct: function (productData, discountObj) {
                try {

                    const discountType = discountObj.type;



                    // return false if none of the above conditions are met
                    return false;
                } catch (e) {
                    gbb.utility.debugConsole("error in isDiscountToBeAppliedOnThisProduct", e);
                }
            }
        }
    },

    gbbDiscountComponent: {
        state: {
            currentDiscountRule: {},
            discountCode: "",
            discountCodePrefix: "",
            isAtleastOneDiscountActive: false,
        },
        init: function (settings) {
            gbb.gbbDiscountComponent.events(settings)
            gbb.gbbDiscountComponent.render(settings)
        },
        render: function (settings) {
            const discountComponentHTML = gbb.gbbDiscountComponent.f.prepareProgressBar()
            //attach all this to the first component of gbbBodyWrapper
            // gbb.$(".gbbBodyWrapper").first().prepend(discountComponentHTML)
            // gbb.elements.cartPageWrapperV2.append(gbbDiscountComponent)
            // return discountComponentHTML;

            //find the gbbDiscountComponent on the page and insert it
            gbb.$(".gbbDiscountComponent").html(discountComponentHTML)
        },
        events: function (settings) {
        },
        f: {
            prepareProgressBar: function (settings) {
                settings = gbb.settings;

                let discountRules = settings.discountsData.rules;
                let isDiscountProgressBarEnabled = settings.discountsData.isDiscountProgressBarEnabled;

                if (isDiscountProgressBarEnabled == false) {
                    return;
                }

                let gbbDiscountComponent = gbb.$("<div>").addClass("gbbDiscountComponent")
                let gbbDiscountComponentTitle = gbb.$("<div>").addClass("gbbDiscountComponentTitle")

                // if(discountD)
                //sort rules by their rule amount in ascending order
                // discountRules = discountRules.sort(function (a, b) {
                //     return a.value - b.value
                // })

                let gbbDiscountComponentProgressBarContainer = gbb.$("<div>").addClass("gbbDiscountComponentProgressBarContainer")

                let gbbDiscountComponentProgressBar = gbb.$("<div>").addClass("gbbDiscountComponentProgressBar")

                let gbbDiscountComponentProgressBarRuleWrapper = gbb.$("<div>").addClass("gbbDiscountComponentProgressBarRuleWrapper")
                let gbbDiscountComponentProgressBarRule = gbb.$("<div>").addClass("gbbDiscountComponentProgressBarRule")
                let gbbDiscountComponentProgressBarRuleText = gbb.$("<span>").addClass("gbbDiscountComponentProgressBarRuleText")


                let maxDiscountValue = discountRules[discountRules.length - 1].amount;
                for (let i = 0; i < discountRules.length; i++) {
                    let rule = discountRules[i]
                    let ruleItemWrapper = gbbDiscountComponentProgressBarRule.clone()
                    let ruleItemText = gbbDiscountComponentProgressBarRuleText.clone()

                    let ruleOffer = gbb.utility.renderLanguageValue(eval(`gbb.settings.languageData.discountRules.rule${i + 1}.text`))
                    let ruleAmount = gbb.utility.renderLanguageValue(eval(`gbb.settings.languageData.discountRules.rule${i + 1}.amount`))
                    ruleItemText.text(ruleOffer + " " + ruleAmount)

                    // let starSvg = gbb.$("<svg>").addClass("gbbDiscountComponentProgressBarRuleStar").attr("src", CONSTANT_SVG_STAR)

                    // let starSvg = gbb.$("<div>").addClass("gbbStarSvgContainer").append(CONSTANT_SVG_STAR)
                    let starSvg = gbb.$("<div>").addClass("gbbStarSvgContainer").append(CONSTANT_SVG_CIRCLE)

                    //add data attribut to this starSvg of discount amount
                    starSvg.attr("data-discount-amount", rule.amount)
                    //.gbbStarSvgContainer polygon.svgStar
                    //the max discount gets the left: 100% and the rest get the left: with a calculated percentage
                    if (rule.amount == maxDiscountValue) {
                        ruleItemText.css("left", "95%")
                        starSvg.css("left", "97%")
                    } else {
                        starSvg.css("left", `${((rule.amount / maxDiscountValue) * 100) - parseInt(2)}%`)
                        ruleItemText.css("left", `${((rule.amount / maxDiscountValue) * 100) - parseInt(5)}%`)
                    }

                    //attach the rule to the progress bar
                    ruleItemWrapper.append(starSvg)
                    ruleItemWrapper.append(ruleItemText)
                    gbbDiscountComponentProgressBarRuleWrapper.append(ruleItemWrapper)

                }
                gbbDiscountComponentProgressBarContainer.append(gbbDiscountComponentProgressBar)
                gbbDiscountComponentProgressBarContainer.append(gbbDiscountComponentProgressBarRuleWrapper)

                gbbDiscountComponent.append(gbbDiscountComponentProgressBarContainer)

                return gbbDiscountComponent;
            },
            updateCurrentDiscountRule: async function () {
                try {

                    if (gbb.settings.discountsData.rules == undefined || gbb.settings.discountsData.isDiscountEnabled == false) {
                        return;
                    }
                    let currentDiscountMode = gbb.settings.discountsData.discountMode;

                    if (gbb.settings.discountsData.isKiteDiscountMessagingEnabled){
                        currentDiscountMode = gbb.settings.discountsData.kiteDiscountMessaging.discountMode
                    }

                    let currentDiscountRuleKeys = [];
                    //get all keys from gbb.gbbDiscountComponent.state.currentDiscountRule = {}
                    if (gbb.gbbDiscountComponent.state.currentDiscountRule) {
                        currentDiscountRuleKeys = Object.keys(gbb.gbbDiscountComponent.state.currentDiscountRule)
                    } else {
                        gbb.gbbDiscountComponent.state.currentDiscountRule = {}
                    }



                    let cartDataFromSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();

                    if (!cartDataFromSessionStorage) {
                        return;
                    }
                    //for loop for each box.  discountEligibleCartData(b)

                    let allBoxes = cartDataFromSessionStorage.boxes

                    let allBoxKeys = Object.keys(allBoxes)

                    for (let i = 0; i < currentDiscountRuleKeys.length; i++) {
                        let boxKey = currentDiscountRuleKeys[i];
                        if (allBoxKeys.includes(boxKey) == false) {
                            delete gbb.gbbDiscountComponent.state.currentDiscountRule[boxKey];
                        }
                    }


                    Object.keys(allBoxes).forEach(function (boxKey) {


                        let box = allBoxes[boxKey];

                        let cartData = gbb.gbbDiscountComponent.f.discountEligibleCartData(box);
                        const cartQuantity = cartData.item_count;

                        // let currentCartValue = gbb.state.giftBoxCartData.total_price / 100
                        let currentCartValue = cartData.total_price / 100;

                        let activeCurrencyRate = gbb.utility.getActiveCurrencyRate();

                        let totalCartValue = currentCartValue / activeCurrencyRate;

                        let applicableRule;
                        let applicableDiscountValue = 0;

                        const rulesArr = JSON.parse(JSON.stringify(gbb.settings.discountsData.rules));
                        // const rulesArr = (gbb.settings.discountsData.rules)
                        if (currentDiscountMode != "FIXED_BUNDLE_PRICE") {
                            for (let i = 0; i < rulesArr.length; i++) {
                                if (rulesArr[i].type == "quantity") {
                                    if (cartQuantity >= rulesArr[i].value) {
                                        let curDiscountValue;
                                        if (currentDiscountMode == "PERCENTAGE") {
                                            curDiscountValue = rulesArr[i].discountValue * (totalCartValue / 100);
                                        } else {
                                            curDiscountValue = rulesArr[i].discountValue;
                                        }
                                        // if (!applicableRule || applicableDiscountValue < curDiscountValue) {
                                        applicableRule = rulesArr[i];
                                        applicableDiscountValue = curDiscountValue;
                                        // }
                                    }
                                } else if (rulesArr[i].type == "amount") {
                                    if (totalCartValue >= rulesArr[i].value) {
                                        let curDiscountValue;
                                        if (currentDiscountMode == "PERCENTAGE") {
                                            curDiscountValue = rulesArr[i].discountValue * (totalCartValue / 100);
                                        } else {
                                            curDiscountValue = rulesArr[i].discountValue;
                                        }
                                        // if (!applicableRule || applicableDiscountValue < curDiscountValue) {
                                        applicableRule = rulesArr[i];
                                        applicableDiscountValue = curDiscountValue;
                                        // }
                                    }
                                }
                            }
                            if (!applicableRule) {
                                applicableRule = null;
                            }
                        } else if (currentDiscountMode == "FIXED_BUNDLE_PRICE") {
                            for (let i = 0; i < rulesArr.length; i++) {
                                //store discount only if cartQuantity is equal to the rule value
                                if (cartQuantity == rulesArr[i].value && totalCartValue >= rulesArr[i].discountValue) {
                                    applicableRule = rulesArr[i];
                                    applicableDiscountValue = rulesArr[i].discountValue;
                                }
                            }
                            if (!applicableRule) {
                                applicableRule = null;
                            }
                        }

                        const cartValue = totalCartValue;

                        //   gbb.utility.debugConsole("cartValue= ", cartValue);

                        //get the last rule from the eligible rules
                        //   gbb.utility.debugConsole("applicable rule: ", applicableRule);
                        if (!applicableRule) {
                            gbb.gbbDiscountComponent.state.currentDiscountRule[box.boxId] = null;
                        } else {
                            gbb.gbbDiscountComponent.state.currentDiscountRule[box.boxId] = applicableRule;
                        }
                    });


                    //check all the objects in the currentDiscountRule object and see if they are all null
                    let isDiscountsExist = false;
                    //use a for loop to check if any of the values are not null
                    for (let key in gbb.gbbDiscountComponent.state.currentDiscountRule) {
                        if (gbb.gbbDiscountComponent.state.currentDiscountRule[key] != null) {
                            gbb.gbbDiscountComponent.state.discountCodePrefix = gbb.gbbDiscountComponent.state.currentDiscountRule[key].discountCodePrefix;
                            isDiscountsExist = true;
                            break;
                        }
                    }

                    gbb.gbbDiscountComponent.state.isAtleastOneDiscountActive = isDiscountsExist;

                } catch (e) {
                    gbb.utility.debugError("error in updateCurrentDiscountRule: ", e)
                    gbb.utility.triggerSlackNotification(e)
                }
            },
            discountEligibleCartData: function (cartData) {
                try {

                    // let gbbPagesWhereDiscountIsDisabled = ["addProductsPage2"];
                    // let gbbPagesWhereDiscountIsDisabled = [];
                    //get the current cart items
                    // let cartData = {...gbb.state.giftBoxCartData};
                    // let cartData = gbb.gbbBrowser.getCartDataFromSessionStorage()
                    // let items = gbb.gbbBrowser.getProductsFromAllBoxesFromCart()

                    // cartData.items = items

                    // cartData  = gbb.utility.multiplyByBundleQuantity(cartData)


                    //blacklist a bunch of products which should be filtered out when calculating the discount

                    const messageProductId = gbb.settings?.giftMessage?.messageProduct?.product?.id || null;

                    // const greetingcardProductId = gbb?.settings?.greetingCard?.greetingCardProducts.length ? gbb?.settings?.greetingCard?.greetingCardProducts[0]?.productId : null;

                    // if the length is more than 1, then there are multiple greeting cards
                    // MAKE A LIST OF ALL THE GREETING CARDS

                    let productIdstoFilterForGreetingCards = [];
                    if (gbb?.settings?.greetingCard?.greetingCardProducts.length > 0) {
                        for (let i = 0; i < gbb?.settings?.greetingCard?.greetingCardProducts.length; i++) {
                            productIdstoFilterForGreetingCards.push(gbb?.settings?.greetingCard?.greetingCardProducts[i]?.productId)
                        }
                    }



                    let quantityToRemove = 0;
                    let blackListedIds = [];
                    let blackListedItemsTotalPrice = 0;

                    for (let i = 0; i < cartData.items.length; i++) {
                        if (cartData.items[i].price == 0) {
                            blackListedIds.push(cartData.items[i].product_id)
                        }
                        // if (gbbPagesWhereDiscountIsDisabled.includes(cartData.items[i].properties._boxProduct)) {
                        //     blackListedIds.push(cartData.items[i].product_id)
                        // }
                    }

                    // push items with value zero to the blacklist

                    if (messageProductId) {
                        blackListedIds.push(messageProductId);
                    }
                    if (productIdstoFilterForGreetingCards.length > 0) {
                        productIdstoFilterForGreetingCards.forEach(id => {
                            blackListedIds.push(id);
                        })
                        // blackListedIds.push(greetingcardProductId);
                    }

                    let newCartValue = 0;

                    // each blackListedId should be a number
                    blackListedIds = blackListedIds.map(id => parseInt(id))

                    let blackListedBoxProductKeys = ['addonProduct']  
                    let applicableProducts = cartData.items.map((item, index) => {
                        item.product_id = parseInt(item.product_id);
                        let isProductIdBlackListed = blackListedIds.includes(item?.product_id)
                        let isProductHavingBlackListedProperty = blackListedBoxProductKeys.includes(item?.properties?._boxProduct)

                        if(isProductIdBlackListed || isProductHavingBlackListedProperty){
                            if (item.price > 0 && item.quantity > 0) {
                                blackListedItemsTotalPrice = blackListedItemsTotalPrice + (item.price * item.quantity)
                            }
                            quantityToRemove = item.quantity + quantityToRemove;
                            return;
                        }
                        else{
                            //new cartValue
                            newCartValue = newCartValue + (item.price * item.quantity)
                            return item;
                        } 
                    })

                    //filter out the undefined values
                    applicableProducts = applicableProducts.filter(item => item != undefined)

                    cartData.blackListedItemsTotalPrice = blackListedItemsTotalPrice;
                    cartData.items = applicableProducts;
                    cartData.total_price = newCartValue
                    cartData.item_count = cartData.item_count - quantityToRemove
                    // gbb.utility.debugConsole("applicableProducts quantity ", cartData.item_count)
                    return cartData

                } catch (e) {
                    gbb.utility.debugError("error in discountEligibleCartData: ", e)
                    return
                }
            },
            calculateNextApplicableDiscountRuleForFixedBundlePrice: function () {
                try {
                    let result = {
                        nextDiscountRuleForFBP: undefined,
                        isFirstDiscountRule: false,
                        nextDiscountRuleIndexForFBP: null
                    }
                    // let allDiscountsData = {...gbb?.settings?.discountsData} || {};
                    let allDiscountsData = JSON.parse(JSON.stringify(gbb?.settings?.discountsData)) || {};

                    // let discountRules = [...gbb?.settings?.discountsData?.rules] || [];
                    let discountRules = JSON.parse(JSON.stringify(gbb?.settings?.discountsData?.rules)) || [];

                    // allDiscountsData?.rules now here go through the rules and convert the discountValue to currency of the customer
                    // allDiscountsData.rules = allDiscountsData.rules.map((rule) => {
                    //     rule.value = gbb.utility.convertFromStoreCurrencyToCustomer(rule.value);
                    //     return rule;
                    // })

                    let boxItemsCount = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
                    boxItemsCount = boxItemsCount.item_count || 0;
                    let noOfRulesCleared = 0
                    if (boxItemsCount == 0) {
                        result.nextDiscountRuleForFBP = undefined;
                    } else {
                        for (let i = 0; i < discountRules.length; i++) {
                            let currentDiscountRuleValue = parseInt(discountRules[i].value)
                            if (boxItemsCount >= currentDiscountRuleValue) {
                                noOfRulesCleared += 1
                            }
                            if (currentDiscountRuleValue > boxItemsCount) {
                                result.nextDiscountRuleForFBP = discountRules[i];
                                if (i == 0) {
                                    result.isFirstDiscountRule = true;
                                } else {
                                    result.isFirstDiscountRule = false;
                                }
                                break;
                            }
                        }
                    }
                    if (result.isFirstDiscountRule || !result.nextDiscountRuleForFBP) {
                        result.nextDiscountRuleForFBP = allDiscountsData?.rules[0];
                        result.nextDiscountRuleIndexForFBP = 1
                    } else {
                        for (let i = 0; i < allDiscountsData?.rules?.length; i++) {
                            let currRule = allDiscountsData?.rules[i];
                            if (result.nextDiscountRuleForFBP && result.nextDiscountRuleForFBP.discountValue == currRule.discountValue) {
                                // if(i != allDiscountsData?.rules?.length - 1) {
                                result.nextDiscountRuleForFBP = allDiscountsData?.rules[i] //? allDiscountsData?.rules[i+1] : allDiscountsData?.rules[i];
                                result.nextDiscountRuleIndexForFBP = i; //allDiscountsData?.rules[i+1] ? i+1 : i;
                                // } else {
                                // result.nextDiscountRuleForFBP = undefined;
                                // }
                                break;
                            }
                        }
                        result.nextDiscountRuleIndexForFBP += 1;
                    }
                    if (noOfRulesCleared >= discountRules.length) {
                        result.nextDiscountRuleForFBP = undefined;
                        result.nextDiscountRuleIndexForFBP = discountRules.length;
                        result.isAllRuleSatisfied = true
                    }
                    return result;
                } catch (err) {
                    gbb.utility.debugError(err + "inside calculateCurrentDiscountRuleForFixedBundlePrice");
                }
            },
            calculateDiscountProgressBarValue: function () {
                try {
                    let { item_count: totalQuantity, total_price: totalCartValue } = gbb.state.giftBoxCartData
                    let { rules: discountRules } = JSON.parse(JSON.stringify(gbb.settings.discountsData))
                    totalCartValue = totalCartValue / 100
                    let discountRulesType = discountRules[0].type
                    let calculateDiscountOnValue = discountRulesType == 'amount' ? totalCartValue : totalQuantity
                    if (discountRulesType == 'amount') {
                        discountRules = discountRules.map((rule) => {
                            rule.value = gbb.utility.convertFromStoreCurrencyToCustomer(rule.value)
                            return rule
                        })
                    }
                    let highestDiscountValue = 0
                    discountRules.forEach((rule) => highestDiscountValue = Math.max(highestDiscountValue, parseInt(rule.value)))
                    let progressPercentage = (calculateDiscountOnValue / highestDiscountValue) * 100
                    return progressPercentage
                } catch (error) {
                    gbb.utility.debugError("error in calculateDiscountProgressBarValue", error);
                }
            },
            OldcalculateDiscountProgressBarValue: function () {
                // this function can return value when you have mixed discount type for eg: mix type of discount amount and quantity
                try {
                    let { item_count: totalQuantity, total_price: totalCartValue } = gbb.state.giftBoxCartData
                    let { rules: discountRules } = gbb.settings.discountsData
                    totalCartValue = totalCartValue / 100
                    let lastClearedRuleNo = 0


                    discountRules.forEach((rule, idx) => {
                        let searchDb = rule.type == 'amount' ? totalCartValue : totalQuantity
                        if (searchDb >= Number(rule.value)) {
                            lastClearedRuleNo = idx + 1
                            // LastClearedRuleNo is nothing but the index of the last discount rule that was cleared -> this will help us to calculate the distance between the last cleared rule and the next rule
                        }
                    });

                    let nextRule = discountRules[lastClearedRuleNo]// ? discountRules[lastClearedRuleNo + 1] : undefined
                    let nextRuleProgress = 0

                    if (nextRule) {
                        let nextRuleValue = Number(nextRule.value)
                        let valeOfEachShare = 100 / discountRules.length // valueOfEachShare is the percentage of the progress bar that each rule will take -> for Eg : 5 rules then each rule will take 20% -> 100/5 = 20
                        let searchDb = nextRule.type == 'amount' ? totalCartValue : totalQuantity
                        nextRuleProgress = (searchDb / nextRuleValue) * valeOfEachShare // using this formulate we calculate the progress of the next rule
                    }

                    let progressPercentage = (lastClearedRuleNo * 100) / discountRules.length;
                    // first calculate the progress of the last cleared rule and then add the progress of the next rule for Eg: lastClearedRuleNo 3 and we have 4 discount rules -> 300/4 = 75% -> now we add the progress of the next rule to this 75% -> 75% + 10% = 85%
                    progressPercentage += nextRuleProgress
                    return progressPercentage
                } catch (error) {
                    gbb.utility.debugError("error in calculateDiscountProgressBarValue", error);
                }
            },
            isEveryDiscountRulehaveSameType: function () {
                try {
                    let discountRulesArray = gbb.settings.discountsData.rules || []
                    if (discountRulesArray.length == 0) return false
                    for (let i = 0; i < discountRulesArray.length; i++) {
                        if (discountRulesArray[i].type != discountRulesArray[0].type) {
                            return false
                        }
                    }
                    return true
                } catch (error) {
                    gbb.utility.debugError("error in isEveryDiscountRulehaveSameType", error);
                }
            },
            discountStatusFooterHTML: function () {
                try {
                    let gbbDiscountFooterHTML = gbb.$("<div>").addClass('gbbDiscountFooterHTML');
                    let gbbDiscountMessage = gbb.$("<div>").addClass('gbbDiscountMessage');
                    let renderAddonsMessaging = gbb.gbbAddonProducts.f.checkIfAddonsMessagingNeeded()
                    if (renderAddonsMessaging) {
                        let messageToDisplay = gbb.gbbAddonProducts.f.getAddonsMessageToRender()
                        gbbDiscountMessage.html(messageToDisplay)
                        gbbDiscountFooterHTML.append(gbbDiscountMessage)
                    } else {
                        let currentDiscountRuleObj = JSON.parse(JSON.stringify(gbb.gbbDiscountComponent.state.currentDiscountRule[gbb.state.activeBoxId]));
                        // let allDiscountsData = {...gbb?.settings?.discountsData} || {};
                        let allDiscountsData = JSON.parse(JSON.stringify(gbb?.settings?.discountsData)) || {};
                        let nextDiscountRule;
                        let nextDiscountRuleIndex;
                        let discountMessageToBeShown = "";
                        let isAllRuleSatisfied = false // this variable will keep track if user has cleared all the discount rules or not / based on this we will show the discount success message 

                        let currentDiscountMode = gbb.settings.discountsData.discountMode;


                        if (gbb.settings.discountsData.isKiteDiscountMessagingEnabled) {
                            currentDiscountMode = gbb.settings.discountsData.kiteDiscountMessaging.discountMode
                        }

                        //the goal is to find next applicable discoune
                        //for FBP we need to get the currentDiscountRule that can be applied
                        if (currentDiscountMode == "FIXED_BUNDLE_PRICE") {
                            let result = gbb.gbbDiscountComponent.f.calculateNextApplicableDiscountRuleForFixedBundlePrice();
                            nextDiscountRule = result.nextDiscountRuleForFBP;
                            nextDiscountRuleIndex = result.nextDiscountRuleIndexForFBP;
                            if (result.isAllRuleSatisfied) {
                                isAllRuleSatisfied = true
                            }
                        } else {
                            //the purpose of nextDiscountRuleIndex is to use this to show the respective message on ui

                            if (!currentDiscountRuleObj) {
                                nextDiscountRule = allDiscountsData?.rules[0];
                                nextDiscountRuleIndex = 1
                            } else {
                                //if it's not the first rule then we iterate through all the rules and check for the next applicable discount rule
                                for (let i = 0; i < allDiscountsData?.rules?.length; i++) {
                                    let currRule = allDiscountsData?.rules[i];
                                    //if currentDiscountRuleObj discount value that is applied is equal to the currRule (rule that is currently)
                                    //being iterated then we need to get the rule right after that -> i+1
                                    if (currentDiscountRuleObj && currentDiscountRuleObj.discountValue == currRule.discountValue && i + 1 <= allDiscountsData?.rules?.length) {
                                        //if the currentDiscountRuleObj is the maximum discount rule that's there
                                        //then we don't do anything, otherwise:
                                        if (i != allDiscountsData?.rules?.length - 1) {
                                            nextDiscountRule = allDiscountsData?.rules[i + 1] //? allDiscountsData?.rules[i+1] : allDiscountsData?.rules[i];
                                            nextDiscountRuleIndex = i + 1; //allDiscountsData?.rules[i+1] ? i+1 : i;
                                            break;
                                        } else {
                                            isAllRuleSatisfied = true
                                            nextDiscountRule = undefined;
                                        }
                                        break;
                                    }
                                }
                                nextDiscountRuleIndex = nextDiscountRuleIndex + 1;
                            }
                        }

                        if (nextDiscountRule?.discountValue && currentDiscountMode == "FIXED_BUNDLE_PRICE") {
                            discountMessageToBeShown = gbb.settings.discountsData.discountTextBody.fixedBundlePrice;
                            nextDiscountRule.discountValue = gbb.utility.convertFromStoreCurrencyToCustomer(nextDiscountRule.discountValue);
                            //round off to the ceiling
                            // nextDiscountRule.discountValue = Math.ceil(nextDiscountRule.discountValue);
                        } else {
                            if (nextDiscountRule && nextDiscountRule?.type == "amount") {
                                nextDiscountRule.value = gbb.utility.convertFromStoreCurrencyToCustomer(nextDiscountRule?.value);
                                // nextDiscountRule.value = Math.ceil(nextDiscountRule.value);
                            }

                            if (nextDiscountRule && currentDiscountMode == "FIXED") {
                                nextDiscountRule.discountValue = gbb.utility.convertFromStoreCurrencyToCustomer(nextDiscountRule?.discountValue);
                                // nextDiscountRule.discountValue = Math.ceil(nextDiscountRule.discountValue);
                            }
                            discountMessageToBeShown = gbb.settings.discountsData.discountTextBody.percentageAndFixed;
                        }
                        discountMessageToBeShown = nextDiscountRuleIndex ? discountMessageToBeShown["rule" + nextDiscountRuleIndex]["text"] : '';

                        let message = ''
                        if (nextDiscountRule && discountMessageToBeShown) {
                            message = gbb.gbbDiscountComponent.f.replaceDiscountVariables(discountMessageToBeShown, nextDiscountRule);
                        }
                        // gbbDiscountMessage.text(message);
                        // whenever user exhausts all the discount rules -> we store undefined in the nextDiscountRule variable till now so to show the success message we need to check if the nextDiscountRule is undefined and all the rules are satisfied
                        if (!nextDiscountRule && isAllRuleSatisfied) {
                            message = gbb.settings.discountsData?.discountTextForSuccess?.value;
                        }
                        let doesThisContainNextLineKeyword = true
                        if (message && (doesThisContainNextLineKeyword)) {
                            gbbDiscountMessage.html(message);
                        } else {
                            gbbDiscountMessage.text(message);
                        }

                        gbbDiscountMessage.css("color", gbb.settings?.pageCustomizationData?.cartFooter?.cartFooterDiscountTextColor || "black")


                        let gbbDiscountMessageContainer = gbb.$('<div>').addClass('gbbDiscountMessageContainer')

                        gbbDiscountMessageContainer.append(gbbDiscountMessage)
                        gbbDiscountFooterHTML.append(gbbDiscountMessageContainer)
                        let isEveryDiscountRulehaveSameType = gbb.gbbDiscountComponent.f.isEveryDiscountRulehaveSameType();
                        if (gbb.settings?.discountsData?.isDiscountProgressBarEnabled && isEveryDiscountRulehaveSameType) {
                            let filledPercentage = gbb.gbbDiscountComponent.f.calculateDiscountProgressBarValue();// get the filled percentage value for the progress bar
                            let progressBarConfigOptions = {
                                filledColor: gbb.settings.pageCustomizationData?.cartFooter?.cartFooterDiscountProgressBarFilledColor || '#4caf50',
                                emptyColor: gbb.settings.pageCustomizationData?.cartFooter?.cartFooterDiscountProgressBarEmptyColor || '#C1E7C5',
                                filledPercentage: filledPercentage || 0
                            }
                            let progressBarHTML = gbb.gbbAddProductsPage.f.renderProgressBarHTML(progressBarConfigOptions)
                            gbbDiscountFooterHTML.append(progressBarHTML)
                        }

                    }
                    return gbbDiscountFooterHTML;
                } catch (err) {
                    gbb.utility.debugError(err + "inside discountStatusFooterHTML");
                }
            },
            replaceDiscountVariables: function (message, nextDiscountRule) {
                if (nextDiscountRule) {
                    let boxCartData = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
                    let discountConditionDiff;
                    let discountUnit;
                    let discountValue;
                    let currentCartValue;
                    let discountValueUnit;
                    let currentDiscountMode = gbb.settings.discountsData.discountMode;


                    if (gbb.settings.discountsData.isKiteDiscountMessagingEnabled){
                        currentDiscountMode = gbb.settings.discountsData.kiteDiscountMessaging.discountMode
                    }

                    if (nextDiscountRule.type == "amount") {
                        currentCartValue = parseFloat(boxCartData?.total_price / 100).toFixed(2);
                        currentCartValue = Math.round(currentCartValue);
                        discountUnit = gbb.utility.getCurrencySymbol();
                        // let activeCurrencyRate = gbb.utility.getActiveCurrencyRate();
                        // currentCartValue = currentCartValue / activeCurrencyRate;
                    } else if (nextDiscountRule.type == "quantity") {
                        // currentCartValue = boxCartData.item_count || 0;
                        let cartValue = JSON.parse(JSON.stringify(boxCartData.items));
                        //find cart item only that have more than 0 price
                        cartValue = boxCartData.items.filter(item => item.price > 0);
                        // 
                        // get me cartValue, boxCartData
                        currentCartValue = 0;
                        cartValue.forEach(item => {
                            currentCartValue = currentCartValue + item.quantity;
                        })
                        discountUnit = " product(s)";
                        if (parseInt(currentCartValue) >= parseInt(nextDiscountRule.value)) {
                            return "";
                        }
                    }

                    if (currentDiscountMode == "FIXED_BUNDLE_PRICE") {
                        discountUnit = " product(s)";
                        discountValueUnit = gbb.utility.getCurrencySymbol();
                        // discountValueUnit = gbb.utility.getStoreCurrencySymbol();
                    }

                    let isDiscountFromKiteAndPercentage = false;
                    let isDiscountFromKiteAndFixed = false;

                    if (gbb.settings.discountsData.isKiteIntegrationEnabled) {
                        const discounts = gbb.settings.gbbKiteData?.discounts;
                        if (discounts && discounts.length > 0) {
                            const fixedDiscountsType = ["FIXED_TOTAL", "FIXED_DIS"];
                            const percentageDiscountsType = ["PERCENTAGE_DIS"];
                            if (fixedDiscountsType.includes(discounts[0].disValueType)) {
                                isDiscountFromKiteAndFixed = true;
                            } else if (percentageDiscountsType.includes(discounts[0].disValueType)) {
                                isDiscountFromKiteAndPercentage = true;
                            }
                        }
                    }


                    if (currentDiscountMode == "FIXED" || isDiscountFromKiteAndFixed) {
                        discountValueUnit = gbb.utility.getCurrencySymbol();
                        // discountValueUnit = gbb.utility.getStoreCurrencySymbol();
                    } else if (currentDiscountMode == "PERCENTAGE" || isDiscountFromKiteAndPercentage) {
                        discountValueUnit = "%"
                    }



                    discountConditionDiff = Math.round(nextDiscountRule.value) - Math.round(currentCartValue); //include item that was just added
                    discountValue = nextDiscountRule.discountValue;

                    let variableValues = {
                        discountConditionDiff,
                        discountUnit,
                        discountValue,
                        discountValueUnit
                    }

                    let variables;
                    if (currentDiscountMode == "PERCENTAGE") {
                        variables = ["discountConditionDiff", "discountUnit", "discountValue", "discountValueUnit"]
                    } else {
                        variables = ["discountConditionDiff", "discountUnit", "discountValueUnit", "discountValue"]
                    }

                    for (let i = 0; i < variables.length; i++) {
                        let VariableName = "##" + variables[i] + "##";
                        let value = variableValues[variables[i]];
                        message = message.replace(new RegExp(`${VariableName}`, 'g'), value);
                    }
                } else {
                    message = "";
                }
                return message;
            },

        }
    },
    gbbVideoMsg: {
        init: function (settings, parent, element) {
            gbb.gbbVideoMsg.initialize(settings, parent, element)
        },
        state: {
            elements: {},
            uploadedVideoId: null,
            recordingTimeMS: 60000,
            recordingTime: "1:00",
            recordedBlob: "",
            mediaRecorder: null,
            interval: undefined,
            emailId: null,
            gbbVideoMsgPlayerWrapper: null,
        },
        initialize: function (settings, parent, element) {
            // let productHandle = gbb.f.getProductPageHandle(settings)
            gbb.utility.debugConsole("videoMesageInitialize");
            //todo
            if (true || gbb.settings.videoMessage.isVideoMessageEnabled) {
                gbb.gbbVideoMsg.f.registerEvents()
                gbb.gbbVideoMsg.f.prepareVideoMsgPlayer(element)
                // // let oneClickUpsellProductPageHTML = gbb.gbbOneClickUpsell.f.prepareUI(settings, variantListToBeShownOnProductPage, parent)
                // let giftMessageProductPageHTML = gbb.gbbMessage.f.prepareUI(settings, productHandle, parent)
                // gbb.gbbMessage.f.insertIntoProductPageWrapper(settings, giftMessageProductPageHTML)
                // gbb.utility.overWriteBuyNowBtn()
                // gbb.state.isOverWriteBuyNowBtnTriggered = true
            }

        },
        f: {
            registerEvents: function () {
                gbb.$(document).on("click", ".gbbVideoMsgButton", gbb.gbbVideoMsg.actions.gbbVideoMsgButton)
            },
            prepareVideoMsgPlayer: function (element) {

                let gbbVideoMsgPlayerWrapper = gbb.$("<div>").addClass("gbbVideoMsgPlayerWrapper");

                gbb.gbbVideoMsg.state.gbbVideoMsgPlayerWrapper = gbbVideoMsgPlayerWrapper;
                let gbbRecorder = gbb.$("<div>").addClass("gbbRecorder")
                gbb.utility.debugConsole("prepareVideoMsgPlayer");
                let gbbRecorderCloseBtn = gbb.$("<button>").addClass("gbbRecorderCloseBtn").on("click", function (e) { gbb.gbbVideoMsg.f.clickClose(e) })

                //: change s3 url
                let gbbRecorderCloseBtnImg = gbb.$("<img>").attr("src", "https://db07ji0eqime4.cloudfront.net/public/videoMessage/close-video.svg")
                gbbRecorderCloseBtn.append(gbbRecorderCloseBtnImg)

                //: change s3 url
                let gbbRecord = gbb.$("<div>").addClass("gbbRecord")
                let gbbVideoPlayer = gbb.$("<video>").addClass("gbbVideoPlayer")
                    .attr("autoplay", true)
                    .prop("muted", true)
                    .attr("poster", "https://db07ji0eqime4.cloudfront.net/public/videoMessage/free-video.jpg")
                let gbbPermissionDenied = gbb.$("<div>").addClass("gbbPermissionDenied gbbVideoPlayerHide").text(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.permissionDenied))
                let gbbVideoPlayerStatus = gbb.$("<div>").addClass("gbbVideoPlayerStatus").html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.pressToRecord))

                //let gbbVideoPlayerEmptyPTag = gbb.$("<p>");

                let gbbVideoPlayerStartBtn = gbb.$("<button>").addClass("gbbVideoPlayerStartBtn").on("click", function (e) { gbb.gbbVideoMsg.f.clickStart(e) })
                let gbbVideoPlayerRedDot = gbb.$("<div><p></p></div>").addClass("gbbVideoPlayerRedDot")
                //gbbVideoPlayerRedDot.append(gbbVideoPlayerEmptyPTag);
                gbbVideoPlayerStartBtn.append(gbbVideoPlayerRedDot)

                let gbbVideoPlayerStopBtn = gbb.$("<button>").addClass("gbbVideoPlayerStopBtn").on("click", function (e) { gbb.gbbVideoMsg.f.clickStop(e) })
                let gbbVideoPlayerRedSquare = gbb.$("<div><p></p></div>").addClass("gbbVideoPlayerRedSquare")
                //gbbVideoPlayerRedSquare.append(gbbVideoPlayerEmptyPTag);
                gbbVideoPlayerStopBtn.append(gbbVideoPlayerRedSquare)


                let gbbVideoPlayerTimeLeft = gbb.$("<div>").addClass("gbbVideoPlayerTimeLeft gbbVideoPlayerHide")

                gbbRecord.append(gbbVideoPlayer)
                gbbRecord.append(gbbPermissionDenied)
                gbbRecord.append(gbbVideoPlayerStatus)
                gbbRecord.append(gbbVideoPlayerStartBtn)
                gbbRecord.append(gbbVideoPlayerStopBtn)
                gbbRecord.append(gbbVideoPlayerTimeLeft)


                let gbbRecorded = gbb.$("<div>").addClass("gbbRecorded")

                let gbbVideoPlayerRecording = gbb.$("<video>").addClass("gbbVideoPlayerRecording")
                    .attr("preload", "none")
                    .attr("poster", "https://db07ji0eqime4.cloudfront.net/public/videoMessage/free-video.jpg")

                let gbbLoadingHeading = gbb.$("<div>").addClass("gbbLoadingHeading gbbVideoPlayerHide").html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.loading))
                let gbbUploadingVideoHeading = gbb.$("<div>").addClass("gbbUploadingVideoHeading gbbVideoPlayerHide").html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.uploading))

                let gbbVideoPlayerControls = gbb.$("<div>").addClass("gbbVideoPlayerControls")

                let gbbVideoPlayerControlsAcceptBtnDiv = gbb.$("<div>").addClass("gbbVideoPlayerControlsAcceptBtnDiv");

                let gbbVideoPlayerControlsAcceptBtnDivInfo = gbb.$("<p>").addClass("gbbVideoPlayerControlsBtnDivInfo").html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.startUploadText));

                gbbVideoPlayerControlsAcceptBtnDiv.append(gbbVideoPlayerControlsAcceptBtnDivInfo);

                let gbbVideoPlayerControlsAcceptBtn = gbb.$("<button>").addClass("gbbVideoPlayerControlsAcceptBtn").on("click", function (e) { gbb.gbbVideoMsg.f.clickAccept(e) })

                //CHORE : change s3 url
                let gbbVideoPlayerControlsAcceptBtnImg = gbb.$("<img>").addClass("gbbVideoPlayerControlsAcceptBtnImg")
                    .attr("src", "https://db07ji0eqime4.cloudfront.net/public/videoMessage/confirm-video.png")
                gbbVideoPlayerControlsAcceptBtn.append(gbbVideoPlayerControlsAcceptBtnImg)
                gbbVideoPlayerControlsAcceptBtnDiv.append(gbbVideoPlayerControlsAcceptBtn);



                let gbbVideoPlayerControlsPlayBtnDiv = gbb.$("<div>").addClass("gbbVideoPlayerControlsPlayBtnDiv");

                let gbbVideoPlayerControlsPlayBtnDivInfo = gbb.$("<p>").addClass("gbbVideoPlayerControlsBtnDivInfo").html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.playText));

                gbbVideoPlayerControlsPlayBtnDiv.append(gbbVideoPlayerControlsPlayBtnDivInfo);

                let gbbVideoPlayerControlsPlayBtn = gbb.$("<button>").addClass("gbbVideoPlayerControlsPlayBtn").on("click", function (e) { gbb.gbbVideoMsg.f.clickPlay(e) })
                let gbbVideoPlayerControlsPlayBtnImg = gbb.$("<img>").addClass("gbbVideoPlayerControlsPlayBtnImg")
                    .attr("src", "https://db07ji0eqime4.cloudfront.net/public/videoMessage/play-video.png")
                gbbVideoPlayerControlsPlayBtn.append(gbbVideoPlayerControlsPlayBtnImg)
                gbbVideoPlayerControlsPlayBtnDiv.append(gbbVideoPlayerControlsPlayBtn);


                let gbbVideoPlayerControlsReStartBtnDiv = gbb.$("<div>").addClass("gbbVideoPlayerControlsReStartBtnDiv");

                let gbbVideoPlayerControlsReStartBtnDivInfo = gbb.$("<p>").addClass("gbbVideoPlayerControlsBtnDivInfo").html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.reRecordVideoText));

                gbbVideoPlayerControlsReStartBtnDiv.append(gbbVideoPlayerControlsReStartBtnDivInfo);

                let gbbVideoPlayerControlsReStartBtn = gbb.$("<button>").addClass("gbbVideoPlayerControlsReStartBtn").on("click", function (e) { gbb.gbbVideoMsg.f.clickReStart(e) })
                let gbbVideoPlayerControlsReStartBtnImg = gbb.$("<img>").addClass("gbbVideoPlayerControlsReStartBtnImg")
                    .attr("src", "https://db07ji0eqime4.cloudfront.net/public/videoMessage/redo-video.png")
                gbbVideoPlayerControlsReStartBtn.append(gbbVideoPlayerControlsReStartBtnImg)
                gbbVideoPlayerControlsReStartBtnDiv.append(gbbVideoPlayerControlsReStartBtn);

                gbbVideoPlayerControls.append(gbbVideoPlayerControlsReStartBtnDiv)
                gbbVideoPlayerControls.append(gbbVideoPlayerControlsPlayBtnDiv)
                gbbVideoPlayerControls.append(gbbVideoPlayerControlsAcceptBtnDiv)


                gbbRecorded.append(gbbVideoPlayerRecording)
                gbbRecorded.append(gbbLoadingHeading)
                gbbRecorded.append(gbbUploadingVideoHeading)
                gbbRecorded.append(gbbVideoPlayerControls)


                gbbRecorder.append(gbbRecorderCloseBtn)
                gbbRecorder.append(gbbRecord)
                gbbRecorder.append(gbbRecorded)

                gbbVideoMsgPlayerWrapper.append(gbbRecorder)
                element.after(gbbVideoMsgPlayerWrapper);
                //attach it to the body
                // gbb.$("body").append(gbbVideoMsgPlayerWrapper);
                // .after(gbbVideoMsgPlayerWrapper);

                gbb.gbbVideoMsg.state.elements.gbbRecorder = gbbRecorder
                gbb.gbbVideoMsg.state.elements.gbbRecord = gbbRecord
                gbb.gbbVideoMsg.state.elements.gbbRecorded = gbbRecorded
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayer = gbbVideoPlayer
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStartBtn = gbbVideoPlayerStartBtn
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStopBtn = gbbVideoPlayerStopBtn
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControlsReStartBtn = gbbVideoPlayerControlsReStartBtn
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControlsPlayBtn = gbbVideoPlayerControlsPlayBtn
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerRecording = gbbVideoPlayerRecording
                gbb.gbbVideoMsg.state.elements.gbbRecorderCloseBtn = gbbRecorderCloseBtn
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControlsAcceptBtn = gbbVideoPlayerControlsAcceptBtn
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControls = gbbVideoPlayerControls
                gbb.gbbVideoMsg.state.elements.gbbLoadingHeading = gbbLoadingHeading
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerTimeLeft = gbbVideoPlayerTimeLeft
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStatus = gbbVideoPlayerStatus
                gbb.gbbVideoMsg.state.elements.gbbPermissionDenied = gbbPermissionDenied
                gbb.gbbVideoMsg.state.elements.gbbUploadingVideoHeading = gbbUploadingVideoHeading


            },
            createRecorder: function () {
                gbb.gbbVideoMsg.state.elements.gbbRecorder.removeClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbRecord.removeClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStartBtn.removeClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStatus.removeClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbPermissionDenied.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbRecorded.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStopBtn.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControls.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerTimeLeft.html(gbb.gbbVideoMsg.state.recordingTime);
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStatus.html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.pressToRecord));
                gbb.gbbVideoMsg.state.recordingTime = "1:00";
                gbb.gbbVideoMsg.state.elements.gbbUploadingVideoHeading.html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.uploading));
                navigator.mediaDevices
                    .getUserMedia({
                        audio: true,
                        video: true,
                    })
                    .then((stream) => {
                        gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].srcObject = stream;
                    })
                    .catch((error) => {
                        gbb.utility.debugConsole("navigator", error)
                        gbb.utility.debugConsole(error);
                        gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStartBtn.addClass("gbbVideoPlayerHide");
                        gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStatus.addClass("gbbVideoPlayerHide");
                        gbb.gbbVideoMsg.state.elements.gbbPermissionDenied.removeClass("gbbVideoPlayerHide");
                    });
            },
            clickClose: function (e) {
                e.preventDefault();
                gbb.gbbVideoMsg.state.gbbVideoMsgPlayerWrapper.css('display', 'none')
                // gbb.gbbVideoMsg.state.elements.gbbRecorder.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.f.stopRecording(gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].srcObject);
                gbb.gbbVideoMsg.f.revokeObjectUrl();
            },
            stopRecording: function (stream) {
                if (gbb.gbbVideoMsg.state.interval) {
                    clearInterval(gbb.gbbVideoMsg.state.interval);
                }
                if (gbb.gbbVideoMsg.state.mediaRecorder && gbb.gbbVideoMsg.state.mediaRecorder.state !== "inactive") {
                    gbb.gbbVideoMsg.state.mediaRecorder.stop();
                }
                stream.getTracks().forEach(function (track) {
                    if (track.readyState == "live") {
                        gbb.utility.debugConsole("hello - stop");
                        track.stop();
                    }
                })
            },

            clearTracks: function (stream) {
                if (stream) {
                    stream.getTracks().forEach(function (track) {
                        if (track.readyState == "live") {
                            gbb.utility.debugConsole("hello - stop");
                            track.stop();
                        }
                    })

                }

            },
            revokeObjectUrl: function () {
                URL.revokeObjectURL(gbb.gbbVideoMsg.state.elements.gbbVideoPlayerRecording.src);
            },
            clickStart: function async(e) {
                e.preventDefault();
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStartBtn.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbRecorderCloseBtn.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStopBtn.removeClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerTimeLeft.removeClass("gbbVideoPlayerHide");

                // the below field for the text
                //hide the toggle
                //gbbVideoMsgCheckboxWrapper

                gbb.gbbVideoMsg.f.clearTracks(gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].srcObject);

                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStatus.html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.recording));
                navigator.mediaDevices
                    .getUserMedia({
                        video: true,
                        audio: true,
                    })
                    .then((stream) => {
                        gbb.utility.debugConsole("1 - navigator");
                        gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].srcObject = stream;
                        gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].captureStream = gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].captureStream || gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].mozCaptureStream;
                        return new Promise((resolve) => (
                            gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].onplaying = resolve
                        ));
                    })
                    .then(() => {
                        gbb.utility.debugConsole("2 - onplaying");
                        return gbb.gbbVideoMsg.f.startRecording(e, gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].captureStream())
                    })
                    .then((recordedChunks) => {
                        gbb.utility.debugConsole("3 - startRecording");
                        gbb.utility.debugConsole(recordedChunks);
                        gbb.gbbVideoMsg.state.justNowRecorded = true
                        gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControls.removeClass("gbbVideoPlayerHide");
                        gbb.gbbVideoMsg.state.elements.gbbUploadingVideoHeading.addClass("gbbVideoPlayerHide");
                        gbb.gbbVideoMsg.state.elements.gbbLoadingHeading.addClass("gbbVideoPlayerHide");
                        gbb.gbbVideoMsg.state.recordedBlob = new Blob(recordedChunks, { type: "video/webm" });
                        gbb.gbbVideoMsg.state.elements.gbbVideoPlayerRecording.attr("src", URL.createObjectURL(gbb.gbbVideoMsg.state.recordedBlob));
                        gbb.gbbVideoMsg.state.elements.gbbVideoPlayerRecording[0].load();
                    })
                    .catch(
                        (error) =>
                            gbb.utility.debugConsole(error)
                    );
            },
            startRecording: function (e, stream) {
                return new Promise((resolve, reject) => {

                    let mediaRecorder = new MediaRecorder(stream);
                    gbb.gbbVideoMsg.state.mediaRecorder = mediaRecorder;
                    let parts = [];
                    mediaRecorder.ondataavailable = (event) => {
                        parts.push(event.data);
                    };
                    mediaRecorder.start(1000);

                    mediaRecorder.onerror = (event) => reject(event.name);

                    gbb.gbbVideoMsg.f.wait(mediaRecorder);

                    mediaRecorder.onstop = function () {
                        gbb.utility.debugConsole("mediaRecorder.onstop() func called");
                        resolve(parts);
                    }
                })
            },
            clickStop: function (e) {
                e.preventDefault();
                gbb.gbbVideoMsg.state.elements.gbbRecord.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbRecorded.removeClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControls.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerTimeLeft.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStatus.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbRecorderCloseBtn.removeClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbLoadingHeading.removeClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.f.stopRecording(gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].srcObject);
            },
            covertBlobToBase64: async function (recordedBlob) {
                const reader = new FileReader();
                reader.readAsDataURL(recordedBlob);

                reader.onloadend = function () {

                    var arrayBuffer = reader.result;

                    gbb.utility.debugConsole(arrayBuffer);

                    var formData = new FormData();

                    formData.append("upload_data", recordedBlob, "video.txt");
                    formData.append("shopName", gbb.settings.merchantInfo.shopName);

                    // fetch("http://"+gbb.settings.SERVER_URL+"/api/proxy/upload/video?shopName="+gbb.settings.merchantInfo.shopName,{
                    // fetch("/apps/gbb/upload/video", {
                    fetch("/apps/" + gbb.state.gbbUrl + "/upload/video", {
                        method: 'POST',
                        body: formData
                    }).then(
                        response => response.json() // if the response is a JSON object
                    ).then(
                        success => {
                            if (success.responseCode == 200) {
                                gbb.gbbVideoMsg.state.uploadedVideoId = success.data.videoMsgId;
                                gbb.utility.debugConsole(success) // Handle the success response object
                                gbb.gbbVideoMsg.state.elements.gbbUploadingVideoHeading.html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage?.uploadConfirmation) || "Successfully uploaded1");
                                //gbb.$('.gbbVideoMsgPlayerWrapper').css('display', 'none')
                                // Show feedback that it got uploaded
                                // gbb.gbbVideoMsg.state.elements.gbbRecorder.addClass("gbbVideoPlayerHide");
                            }
                            /*
                            * @Abhishek, the below if else condition is added to handle the
                            * condition where the api fails in sending over responseCode 200.
                            */
                            else {
                                gbb.utility.debugConsole(success) // Handle the error response object
                                gbb.gbbVideoMsg.state.elements.gbbUploadingVideoHeading.html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.errorMessage));
                            }

                        }
                    ).catch(
                        error => {
                            gbb.utility.debugConsole(error) // Handle the error response object
                            gbb.gbbVideoMsg.state.elements.gbbUploadingVideoHeading.html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.errorMessage));
                        }
                    );
                }
            },
            clickAccept: function (e) {
                e.preventDefault();
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControls.addClass("gbbVideoPlayerHide")
                gbb.gbbVideoMsg.state.elements.gbbUploadingVideoHeading.removeClass("gbbVideoPlayerHide")
                gbb.gbbVideoMsg.f.covertBlobToBase64(gbb.gbbVideoMsg.state.recordedBlob);
            },
            wait: function (mediaRecorder) {
                var now = new Date().getTime();
                var deadline = new Date(now + gbb.gbbVideoMsg.state.recordingTimeMS).getTime();
                var interval = setInterval(() => {
                    now = new Date().getTime();
                    var t = deadline - now;
                    gbb.utility.debugConsole(t);
                    var minutes = Math.floor((t % (1000 * 60 * 60)) / (1000 * 60));
                    var seconds = Math.floor((t % (1000 * 60)) / 1000);
                    if (t < 0) {
                        gbb.$('.gbbVideoPlayerStopBtn').click();
                    }
                    gbb.gbbVideoMsg.state.elements.gbbVideoPlayerTimeLeft.html(minutes + " : " + seconds)
                }, 1000);
                gbb.gbbVideoMsg.state.interval = interval;
            },
            clickReStart: function (e) {
                e.preventDefault();
                gbb.gbbVideoMsg.f.revokeObjectUrl()
                gbb.gbbVideoMsg.f.createRecorder();
            },
            clickPlay: async function (e) {
                e.preventDefault();
                try {
                    gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControls.addClass("gbbVideoPlayerHide");
                    gbb.gbbVideoMsg.state.elements.gbbVideoPlayerRecording[0].play();
                    let isEnded = new Promise((resolve, reject) => {
                        gbb.gbbVideoMsg.state.elements.gbbVideoPlayerRecording[0].onended = resolve;
                    });
                    await isEnded;
                    gbb.gbbVideoMsg.state.elements.gbbVideoPlayerRecording[0].load();
                    gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControls.removeClass("gbbVideoPlayerHide");

                } catch (error) {
                    gbb.utility.debugConsole(error)
                }
            },
            scrollToVideoDiv: function () {
                // gbb.$(".gbbPersonalizePageMessageContent").animate({scrollTop: 9999},1000);
                gbb.$(".giftMessageV2MainContent").animate({ scrollTop: 360 }, 2000, 'swing');
            },
        },
        actions: {
            gbbVideoMsgButton: function (e) {
                e.preventDefault()
                gbb.gbbVideoMsg.state.gbbVideoMsgPlayerWrapper.css('display', 'grid')
                gbb.gbbVideoMsg.f.createRecorder()
                gbb.gbbVideoMsg.f.scrollToVideoDiv()
            },
        },
        events: {

        },

    },
    gbbIntegrations: {
        judgeme: {
            state: {
                public_token: null,
                baseURL: null,
                reviewStarsHTMLbyProductIds: null,
            },
            init: async function (productsData) {
                try {
                    let params = {}
                    gbb.gbbIntegrations.judgeme.state.public_token = gbb?.settings?.app?.integrations?.judgeme?.public_token
                    gbb.gbbIntegrations.judgeme.state.baseURL = `https://cache.judge.me/widgets/shopify/${gbb?.settings?.merchantInfo?.shopName}?publictoken=${gbb?.settings?.app?.integrations?.judgeme?.public_token}`
                    let productIdsToSend = productsData?.map((product) => Number(product.productId) || product.id).join(',')
                    if (productIdsToSend && productIdsToSend.length > 0) {
                        params = {
                            preview_badge_product_ids: productIdsToSend
                        }
                    }
                    await gbb.gbbIntegrations?.judgeme?.initialize(params)
                } catch (error) {
                    gbb.utility.debugError("error in judgeme init", error);
                }
            },
            initialize: async function (options) {
                try {
                    let judgemeData = await gbb.gbbIntegrations?.judgeme?.f?.getJudgeMeData(options)
                    let judgemeStyle = judgemeData?.html_miracle;
                    gbb.gbbIntegrations?.judgeme?.f?.appendJudgeMeStyle(judgemeStyle)
                    gbb.gbbIntegrations.judgeme.state.reviewStarsHTMLbyProductIds = judgemeData?.preview_badges || []
                } catch (error) {
                    gbb.utility.debugError('error in judgeme initialize', error)
                }
            },
            f: {
                getJudgeMeData: function (options = {}) {
                    try {
                        let params = ''
                        for (const key in options) {
                            params += `&${key}=${options[key]}`
                        }
                        let fetchUrl = gbb.gbbIntegrations?.judgeme?.state?.baseURL + params;

                        let judgemeData = new Promise((resolve, reject) => {
                            fetch(fetchUrl)
                                .then((response) => {
                                    return response.json()
                                }).then((response) => {
                                    gbb.utility.debugConsole("judgeme-data:", response);
                                    resolve(response)
                                })
                                .catch((error) => {
                                    reject(error)
                                })
                        })
                        return judgemeData
                    } catch (error) {
                        gbb.utility.debugError("error in getJudgeMeData", error);
                    }
                },
                appendJudgeMeStyle: function (style) {
                    try {
                        gbb.$('html > head').append(style);
                        return style;
                    } catch (error) {
                        gbb.utility.debugError("error in appendJudgeMeStyle", error);
                    }
                },
                getStarsHTMLByProductId: function (productId) {
                    try {
                        let judgemeProductData = gbb.gbbIntegrations?.judgeme?.state?.reviewStarsHTMLbyProductIds || {}
                        let starsHTML = judgemeProductData[productId]
                        return starsHTML
                    } catch (error) {
                        gbb.utility.debugError('error in getStarsHTMLByProductId', error)
                    }
                },
                applyJudgemeStyleAndLanguage : function(){
                    try{
                        const starRatingTexts = document.querySelectorAll(".jdgm-prev-badge__text");
                        const starRatingWrappers = document.querySelectorAll(".jdgm-prev-badge");
                        const starIcons = document.querySelectorAll(".jdgm-prev-badge__stars .jdgm-star");

                        if (jdgmSettings.badge_star_color) {
                        starIcons.forEach((icon) => {
                            icon.style.color = jdgmSettings.badge_star_color;
                        });
                        } else {
                        starIcons.forEach((icon) => {
                            icon.style.color = jdgmSettings.widget_primary_color ?? "#339999";
                        });
                        }

                        if (jdgmSettings.badge_n_reviews_text) {
                        const textFormat = jdgmSettings.badge_n_reviews_text;

                        starRatingWrappers.forEach((wrapper, idx) => {
                            const reviewCount = parseInt(wrapper.dataset.numberOfReviews);
                            const avgRatingFull = wrapper.dataset.averageRating;
                            const avgRatingShort = Math.round(
                            (parseFloat(wrapper.dataset.averageRating) * 10) / 10
                            );

                            if (reviewCount > 0) {
                            const qntyRegex = /([a-z]+)\/([a-z]+)/;
                            let newText = textFormat.replace(/\{\{\s?n\s?\}\}/g, reviewCount);
                            const qntyTexts = qntyRegex.exec(textFormat);

                            if (qntyTexts != null) {
                                if (reviewCount == 1) {
                                newText = newText.replace(qntyRegex, qntyTexts[1]);
                                } else {
                                newText = newText.replace(qntyRegex, qntyTexts[2]);
                                }
                            } else {
                                if (reviewCount == 1) {
                                starRatingTexts[idx].textContent = `${reviewCount} review`;
                                } else {
                                starRatingTexts[idx].textContent = `${reviewCount} reviews`;
                                }
                            }

                            newText = newText.replace(
                                /\{\{\s?average_rating\s\}\}/g,
                                avgRatingFull
                            );
                            newText = newText.replace(
                                /\{\{\s?average_rating_1_decimal\s\}\}/g,
                                avgRatingShort
                            );
                            starRatingTexts[idx].textContent = newText;

                            if (!jdgmSettings.badge_hide_text) {
                                starRatingTexts[idx].style.visibility = "visible";
                            }
                            }
                        });
                        } else {
                        starRatingWrappers.forEach((wrapper, idx) => {
                            const reviewCount = parseInt(wrapper.dataset.numberOfReviews);

                            if (reviewCount > 0) {
                            if (reviewCount == 1) {
                                starRatingTexts[idx].textContent = `${reviewCount} review`;
                            } else {
                                starRatingTexts[idx].textContent = `${reviewCount} reviews`;
                            }
                            }

                            if (!jdgmSettings.badge_hide_text) {
                            starRatingTexts[idx].style.visibility = "visible";
                            }
                        });
                        }
                    } catch(e){
                        gbb.utility.debugConsole("error in applyJudgemeStyleAndLanguage", e)
                    }

                }
            }
        }

    }
    // gbb Code start
}
window.gbb = gbb;
/*
* start the program
*/
gbbUtils.f.loadJquery(function (jqueryRefObj) {
    gbb.$ = jqueryRefObj;

    gbb.$(document).ready(function () {
        gbb.utility.debugConsole("document-ready-gbb", gbb.$);
        gbb.f.initialize(gbb.$);
        gbb.utility.debugConsole("gbb-page-load-event")
        let event = new CustomEvent('gbb-page-load', {});
        document.dispatchEvent(event);
    })
})


// comment at the end of line
</script>
    <style>.flatpickr-calendar {
  background: transparent;
  opacity: 0;
  display: none;
  text-align: center;
  visibility: hidden;
  padding: 0;
  -webkit-animation: none;
  animation: none;
  direction: ltr;
  border: 0;
  font-size: 14px;
  line-height: 24px;
  border-radius: 5px;
  position: absolute;
  width: 307.875px;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  -ms-touch-action: manipulation;
  touch-action: manipulation;
  background: #fff;
  -webkit-box-shadow: 1px 0 0 #e6e6e6, -1px 0 0 #e6e6e6, 0 1px 0 #e6e6e6,
    0 -1px 0 #e6e6e6, 0 3px 13px rgba(0, 0, 0, 0.08);
  box-shadow: 1px 0 0 #e6e6e6, -1px 0 0 #e6e6e6, 0 1px 0 #e6e6e6,
    0 -1px 0 #e6e6e6, 0 3px 13px rgba(0, 0, 0, 0.08);
}
.flatpickr-calendar.open,
.flatpickr-calendar.inline {
  opacity: 1;
  max-height: 640px;
  visibility: visible;
}
.flatpickr-calendar.open {
  display: inline-block;
  z-index: 99999;
}
.flatpickr-calendar.animate.open {
  -webkit-animation: fpFadeInDown 300ms cubic-bezier(0.23, 1, 0.32, 1);
  animation: fpFadeInDown 300ms cubic-bezier(0.23, 1, 0.32, 1);
}
.flatpickr-calendar.inline {
  display: block;
  position: relative;
  top: 2px;
}
.flatpickr-calendar.static {
  position: absolute;
  top: calc(100% + 2px);
}
.flatpickr-calendar.static.open {
  z-index: 999;
  display: block;
}
.flatpickr-calendar.multiMonth
  .flatpickr-days
  .dayContainer:nth-child(n + 1)
  .flatpickr-day.inRange:nth-child(7n + 7) {
  -webkit-box-shadow: none !important;
  box-shadow: none !important;
}
.flatpickr-calendar.multiMonth
  .flatpickr-days
  .dayContainer:nth-child(n + 2)
  .flatpickr-day.inRange:nth-child(7n + 1) {
  -webkit-box-shadow: -2px 0 0 #e6e6e6, 5px 0 0 #e6e6e6;
  box-shadow: -2px 0 0 #e6e6e6, 5px 0 0 #e6e6e6;
}
.flatpickr-calendar .hasWeeks .dayContainer,
.flatpickr-calendar .hasTime .dayContainer {
  border-bottom: 0;
  border-bottom-right-radius: 0;
  border-bottom-left-radius: 0;
}
.flatpickr-calendar .hasWeeks .dayContainer {
  border-left: 0;
}
.flatpickr-calendar.hasTime .flatpickr-time {
  height: 40px;
  border-top: 1px solid #e6e6e6;
}
.flatpickr-calendar.noCalendar.hasTime .flatpickr-time {
  height: auto;
}
.flatpickr-calendar:before,
.flatpickr-calendar:after {
  position: absolute;
  display: block;
  pointer-events: none;
  border: solid transparent;
  content: "";
  height: 0;
  width: 0;
  left: 22px;
}
.flatpickr-calendar.rightMost:before,
.flatpickr-calendar.arrowRight:before,
.flatpickr-calendar.rightMost:after,
.flatpickr-calendar.arrowRight:after {
  left: auto;
  right: 22px;
}
.flatpickr-calendar.arrowCenter:before,
.flatpickr-calendar.arrowCenter:after {
  left: 50%;
  right: 50%;
}
.flatpickr-calendar:before {
  border-width: 5px;
  margin: 0 -5px;
}
.flatpickr-calendar:after {
  border-width: 4px;
  margin: 0 -4px;
}
.flatpickr-calendar.arrowTop:before,
.flatpickr-calendar.arrowTop:after {
  bottom: 100%;
}
.flatpickr-calendar.arrowTop:before {
  border-bottom-color: #e6e6e6;
}
.flatpickr-calendar.arrowTop:after {
  border-bottom-color: #fff;
}
.flatpickr-calendar.arrowBottom:before,
.flatpickr-calendar.arrowBottom:after {
  top: 100%;
}
.flatpickr-calendar.arrowBottom:before {
  border-top-color: #e6e6e6;
}
.flatpickr-calendar.arrowBottom:after {
  border-top-color: #fff;
}
.flatpickr-calendar:focus {
  outline: 0;
}
.flatpickr-wrapper {
  position: relative;
  display: inline-block;
}
.flatpickr-months {
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
}
.flatpickr-months .flatpickr-month {
  background: transparent;
  color: rgba(0, 0, 0, 0.9);
  fill: rgba(0, 0, 0, 0.9);
  height: 34px;
  line-height: 1;
  text-align: center;
  position: relative;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  overflow: hidden;
  -webkit-box-flex: 1;
  -webkit-flex: 1;
  -ms-flex: 1;
  flex: 1;
}
.flatpickr-months .flatpickr-prev-month,
.flatpickr-months .flatpickr-next-month {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  text-decoration: none;
  cursor: pointer;
  position: absolute;
  top: 0;
  height: 34px;
  padding: 10px;
  z-index: 3;
  color: rgba(0, 0, 0, 0.9);
  fill: rgba(0, 0, 0, 0.9);
}
.flatpickr-months .flatpickr-prev-month.flatpickr-disabled,
.flatpickr-months .flatpickr-next-month.flatpickr-disabled {
  display: none;
}
.flatpickr-months .flatpickr-prev-month i,
.flatpickr-months .flatpickr-next-month i {
  position: relative;
}
.flatpickr-months .flatpickr-prev-month.flatpickr-prev-month,
.flatpickr-months .flatpickr-next-month.flatpickr-prev-month {
  /*
      /*rtl:begin:ignore*/
  left: 0; /*
      /*rtl:end:ignore*/
} /*
      /*rtl:begin:ignore*/
/*
      /*rtl:end:ignore*/
.flatpickr-months .flatpickr-prev-month.flatpickr-next-month,
.flatpickr-months .flatpickr-next-month.flatpickr-next-month {
  /*
      /*rtl:begin:ignore*/
  right: 0; /*
      /*rtl:end:ignore*/
} /*
      /*rtl:begin:ignore*/
/*
      /*rtl:end:ignore*/
.flatpickr-months .flatpickr-prev-month:hover,
.flatpickr-months .flatpickr-next-month:hover {
  color: #959ea9;
}
.flatpickr-months .flatpickr-prev-month:hover svg,
.flatpickr-months .flatpickr-next-month:hover svg {
  fill: #f64747;
}
.flatpickr-months .flatpickr-prev-month svg,
.flatpickr-months .flatpickr-next-month svg {
  width: 14px;
  height: 14px;
}
.flatpickr-months .flatpickr-prev-month svg path,
.flatpickr-months .flatpickr-next-month svg path {
  -webkit-transition: fill 0.1s;
  transition: fill 0.1s;
  fill: inherit;
}
.numInputWrapper {
  position: relative;
  height: auto;
}
.numInputWrapper input,
.numInputWrapper span {
  display: inline-block;
}
.numInputWrapper input {
  width: 100%;
}
.numInputWrapper input::-ms-clear {
  display: none;
}
.numInputWrapper input::-webkit-outer-spin-button,
.numInputWrapper input::-webkit-inner-spin-button {
  margin: 0;
  -webkit-appearance: none;
}
.numInputWrapper span {
  position: absolute;
  right: 0;
  width: 14px;
  padding: 0 4px 0 2px;
  height: 50%;
  line-height: 50%;
  opacity: 0;
  cursor: pointer;
  border: 1px solid rgba(57, 57, 57, 0.15);
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
}
.numInputWrapper span:hover {
  background: rgba(0, 0, 0, 0.1);
}
.numInputWrapper span:active {
  background: rgba(0, 0, 0, 0.2);
}
.numInputWrapper span:after {
  display: block;
  content: "";
  position: absolute;
}
.numInputWrapper span.arrowUp {
  top: 0;
  border-bottom: 0;
}
.numInputWrapper span.arrowUp:after {
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  border-bottom: 4px solid rgba(57, 57, 57, 0.6);
  top: 26%;
}
.numInputWrapper span.arrowDown {
  top: 50%;
}
.numInputWrapper span.arrowDown:after {
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  border-top: 4px solid rgba(57, 57, 57, 0.6);
  top: 40%;
}
.numInputWrapper span svg {
  width: inherit;
  height: auto;
}
.numInputWrapper span svg path {
  fill: rgba(0, 0, 0, 0.5);
}
.numInputWrapper:hover {
  background: rgba(0, 0, 0, 0.05);
}
.numInputWrapper:hover span {
  opacity: 1;
}
.flatpickr-current-month {
  font-size: 135%;
  line-height: inherit;
  font-weight: 300;
  color: inherit;
  position: absolute;
  width: 75%;
  left: 12.5%;
  padding: 7.48px 0 0 0;
  line-height: 1;
  height: 34px;
  display: inline-block;
  text-align: center;
  -webkit-transform: translate3d(0, 0, 0);
  transform: translate3d(0, 0, 0);
}
.flatpickr-current-month span.cur-month {
  font-family: inherit;
  font-weight: 700;
  color: inherit;
  display: inline-block;
  margin-left: 0.5ch;
  padding: 0;
}
.flatpickr-current-month span.cur-month:hover {
  background: rgba(0, 0, 0, 0.05);
}
.flatpickr-current-month .numInputWrapper {
  width: 6ch;
  width: 7ch\0;
  display: inline-block;
}
.flatpickr-current-month .numInputWrapper span.arrowUp:after {
  border-bottom-color: rgba(0, 0, 0, 0.9);
}
.flatpickr-current-month .numInputWrapper span.arrowDown:after {
  border-top-color: rgba(0, 0, 0, 0.9);
}
.flatpickr-current-month input.cur-year {
  background: transparent;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  color: inherit;
  cursor: text;
  padding: 0 0 0 0.5ch;
  margin: 0;
  display: inline-block;
  font-size: inherit;
  font-family: inherit;
  font-weight: 300;
  line-height: inherit;
  height: auto;
  border: 0;
  border-radius: 0;
  vertical-align: initial;
  -webkit-appearance: textfield;
  -moz-appearance: textfield;
  appearance: textfield;
}
.flatpickr-current-month input.cur-year:focus {
  outline: 0;
}
.flatpickr-current-month input.cur-year[disabled],
.flatpickr-current-month input.cur-year[disabled]:hover {
  font-size: 100%;
  color: rgba(0, 0, 0, 0.5);
  background: transparent;
  pointer-events: none;
}
.flatpickr-current-month .flatpickr-monthDropdown-months {
  appearance: menulist;
  background: transparent;
  border: none;
  border-radius: 0;
  box-sizing: border-box;
  color: inherit;
  cursor: pointer;
  font-size: inherit;
  font-family: inherit;
  font-weight: 300;
  height: auto;
  line-height: inherit;
  margin: -1px 0 0 0;
  outline: none;
  padding: 0 0 0 0.5ch;
  position: relative;
  vertical-align: initial;
  -webkit-box-sizing: border-box;
  -webkit-appearance: menulist;
  -moz-appearance: menulist;
  width: auto;
}
.flatpickr-current-month .flatpickr-monthDropdown-months:focus,
.flatpickr-current-month .flatpickr-monthDropdown-months:active {
  outline: none;
}
.flatpickr-current-month .flatpickr-monthDropdown-months:hover {
  background: rgba(0, 0, 0, 0.05);
}
.flatpickr-current-month
  .flatpickr-monthDropdown-months
  .flatpickr-monthDropdown-month {
  background-color: transparent;
  outline: none;
  padding: 0;
}
.flatpickr-weekdays {
  background: transparent;
  text-align: center;
  overflow: hidden;
  width: 100%;
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
  -webkit-align-items: center;
  -ms-flex-align: center;
  align-items: center;
  height: 28px;
}
.flatpickr-weekdays .flatpickr-weekdaycontainer {
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-flex: 1;
  -webkit-flex: 1;
  -ms-flex: 1;
  flex: 1;
}
span.flatpickr-weekday {
  cursor: default;
  font-size: 90%;
  background: transparent;
  color: rgba(0, 0, 0, 0.54);
  line-height: 1;
  margin: 0;
  text-align: center;
  display: block;
  -webkit-box-flex: 1;
  -webkit-flex: 1;
  -ms-flex: 1;
  flex: 1;
  font-weight: bolder;
}
.dayContainer,
.flatpickr-weeks {
  padding: 1px 0 0 0;
}
.flatpickr-days {
  position: relative;
  overflow: hidden;
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: start;
  -webkit-align-items: flex-start;
  -ms-flex-align: start;
  align-items: flex-start;
  width: 307.875px;
}
.flatpickr-days:focus {
  outline: 0;
}
.dayContainer {
  padding: 0;
  outline: 0;
  text-align: left;
  width: 307.875px;
  min-width: 307.875px;
  max-width: 307.875px;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  display: inline-block;
  display: -ms-flexbox;
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-wrap: wrap;
  flex-wrap: wrap;
  -ms-flex-wrap: wrap;
  -ms-flex-pack: justify;
  -webkit-justify-content: space-around;
  justify-content: space-around;
  -webkit-transform: translate3d(0, 0, 0);
  transform: translate3d(0, 0, 0);
  opacity: 1;
}
.dayContainer + .dayContainer {
  -webkit-box-shadow: -1px 0 0 #e6e6e6;
  box-shadow: -1px 0 0 #e6e6e6;
}
.flatpickr-day {
  background: none;
  border: 1px solid transparent;
  border-radius: 150px;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  color: #393939;
  cursor: pointer;
  font-weight: 400;
  width: 14.2857143%;
  -webkit-flex-basis: 14.2857143%;
  -ms-flex-preferred-size: 14.2857143%;
  flex-basis: 14.2857143%;
  max-width: 39px;
  height: 39px;
  line-height: 39px;
  margin: 0;
  display: inline-block;
  position: relative;
  -webkit-box-pack: center;
  -webkit-justify-content: center;
  -ms-flex-pack: center;
  justify-content: center;
  text-align: center;
}
.flatpickr-day.inRange,
.flatpickr-day.prevMonthDay.inRange,
.flatpickr-day.nextMonthDay.inRange,
.flatpickr-day.today.inRange,
.flatpickr-day.prevMonthDay.today.inRange,
.flatpickr-day.nextMonthDay.today.inRange,
.flatpickr-day:hover,
.flatpickr-day.prevMonthDay:hover,
.flatpickr-day.nextMonthDay:hover,
.flatpickr-day:focus,
.flatpickr-day.prevMonthDay:focus,
.flatpickr-day.nextMonthDay:focus {
  cursor: pointer;
  outline: 0;
  background: #e6e6e6;
  border-color: #e6e6e6;
}
.flatpickr-day.today {
  border-color: #959ea9;
}
.flatpickr-day.today:hover,
.flatpickr-day.today:focus {
  border-color: #959ea9;
  background: #959ea9;
  color: #fff;
}
.flatpickr-day.selected,
.flatpickr-day.startRange,
.flatpickr-day.endRange,
.flatpickr-day.selected.inRange,
.flatpickr-day.startRange.inRange,
.flatpickr-day.endRange.inRange,
.flatpickr-day.selected:focus,
.flatpickr-day.startRange:focus,
.flatpickr-day.endRange:focus,
.flatpickr-day.selected:hover,
.flatpickr-day.startRange:hover,
.flatpickr-day.endRange:hover,
.flatpickr-day.selected.prevMonthDay,
.flatpickr-day.startRange.prevMonthDay,
.flatpickr-day.endRange.prevMonthDay,
.flatpickr-day.selected.nextMonthDay,
.flatpickr-day.startRange.nextMonthDay,
.flatpickr-day.endRange.nextMonthDay {
  background: #569ff7;
  -webkit-box-shadow: none;
  box-shadow: none;
  color: #fff;
  border-color: #569ff7;
}
.flatpickr-day.selected.startRange,
.flatpickr-day.startRange.startRange,
.flatpickr-day.endRange.startRange {
  border-radius: 50px 0 0 50px;
}
.flatpickr-day.selected.endRange,
.flatpickr-day.startRange.endRange,
.flatpickr-day.endRange.endRange {
  border-radius: 0 50px 50px 0;
}
.flatpickr-day.selected.startRange + .endRange:not(:nth-child(7n + 1)),
.flatpickr-day.startRange.startRange + .endRange:not(:nth-child(7n + 1)),
.flatpickr-day.endRange.startRange + .endRange:not(:nth-child(7n + 1)) {
  -webkit-box-shadow: -10px 0 0 #569ff7;
  box-shadow: -10px 0 0 #569ff7;
}
.flatpickr-day.selected.startRange.endRange,
.flatpickr-day.startRange.startRange.endRange,
.flatpickr-day.endRange.startRange.endRange {
  border-radius: 50px;
}
.flatpickr-day.inRange {
  border-radius: 0;
  -webkit-box-shadow: -5px 0 0 #e6e6e6, 5px 0 0 #e6e6e6;
  box-shadow: -5px 0 0 #e6e6e6, 5px 0 0 #e6e6e6;
}
.flatpickr-day.flatpickr-disabled,
.flatpickr-day.flatpickr-disabled:hover,
.flatpickr-day.prevMonthDay,
.flatpickr-day.nextMonthDay,
.flatpickr-day.notAllowed,
.flatpickr-day.notAllowed.prevMonthDay,
.flatpickr-day.notAllowed.nextMonthDay {
  color: rgba(57, 57, 57, 0.3);
  background: transparent;
  border-color: transparent;
  cursor: default;
}
.flatpickr-day.flatpickr-disabled,
.flatpickr-day.flatpickr-disabled:hover {
  cursor: not-allowed;
  color: rgba(57, 57, 57, 0.1);
}
.flatpickr-day.week.selected {
  border-radius: 0;
  -webkit-box-shadow: -5px 0 0 #569ff7, 5px 0 0 #569ff7;
  box-shadow: -5px 0 0 #569ff7, 5px 0 0 #569ff7;
}
.flatpickr-day.hidden {
  visibility: hidden;
}
.rangeMode .flatpickr-day {
  margin-top: 1px;
}
.flatpickr-weekwrapper {
  float: left;
}
.flatpickr-weekwrapper .flatpickr-weeks {
  padding: 0 12px;
  -webkit-box-shadow: 1px 0 0 #e6e6e6;
  box-shadow: 1px 0 0 #e6e6e6;
}
.flatpickr-weekwrapper .flatpickr-weekday {
  float: none;
  width: 100%;
  line-height: 28px;
}
.flatpickr-weekwrapper span.flatpickr-day,
.flatpickr-weekwrapper span.flatpickr-day:hover {
  display: block;
  width: 100%;
  max-width: none;
  color: rgba(57, 57, 57, 0.3);
  background: transparent;
  cursor: default;
  border: none;
}
.flatpickr-innerContainer {
  display: block;
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  overflow: hidden;
}
.flatpickr-rContainer {
  display: inline-block;
  padding: 0;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
}
.flatpickr-time {
  text-align: center;
  outline: 0;
  display: block;
  height: 0;
  line-height: 40px;
  max-height: 40px;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  overflow: hidden;
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
}
.flatpickr-time:after {
  content: "";
  display: table;
  clear: both;
}
.flatpickr-time .numInputWrapper {
  -webkit-box-flex: 1;
  -webkit-flex: 1;
  -ms-flex: 1;
  flex: 1;
  width: 40%;
  height: 40px;
  float: left;
}
.flatpickr-time .numInputWrapper span.arrowUp:after {
  border-bottom-color: #393939;
}
.flatpickr-time .numInputWrapper span.arrowDown:after {
  border-top-color: #393939;
}
.flatpickr-time.hasSeconds .numInputWrapper {
  width: 26%;
}
.flatpickr-time.time24hr .numInputWrapper {
  width: 49%;
}
.flatpickr-time input {
  background: transparent;
  -webkit-box-shadow: none;
  box-shadow: none;
  border: 0;
  border-radius: 0;
  text-align: center;
  margin: 0;
  padding: 0;
  height: inherit;
  line-height: inherit;
  color: #393939;
  font-size: 14px;
  position: relative;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  -webkit-appearance: textfield;
  -moz-appearance: textfield;
  appearance: textfield;
}
.flatpickr-time input.flatpickr-hour {
  font-weight: bold;
}
.flatpickr-time input.flatpickr-minute,
.flatpickr-time input.flatpickr-second {
  font-weight: 400;
}
.flatpickr-time input:focus {
  outline: 0;
  border: 0;
}
.flatpickr-time .flatpickr-time-separator,
.flatpickr-time .flatpickr-am-pm {
  height: inherit;
  float: left;
  line-height: inherit;
  color: #393939;
  font-weight: bold;
  width: 2%;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
  align-self: center;
}
.flatpickr-time .flatpickr-am-pm {
  outline: 0;
  width: 18%;
  cursor: pointer;
  text-align: center;
  font-weight: 400;
}
.flatpickr-time input:hover,
.flatpickr-time .flatpickr-am-pm:hover,
.flatpickr-time input:focus,
.flatpickr-time .flatpickr-am-pm:focus {
  background: #eee;
}
.flatpickr-input[readonly] {
  cursor: pointer;
}

@-webkit-keyframes fpFadeInDown {
  from {
    opacity: 0;
    -webkit-transform: translate3d(0, -20px, 0);
    transform: translate3d(0, -20px, 0);
  }
  to {
    opacity: 1;
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
  }
}
@keyframes fpFadeInDown {
  from {
    opacity: 0;
    -webkit-transform: translate3d(0, -20px, 0);
    transform: translate3d(0, -20px, 0);
  }
  to {
    opacity: 1;
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
  }
}
.gbbDiscountComponentProgressBarContainer{
    background: gray;
    display: block;
    position: relative;
    height:20px;
    border-radius:5px;
    width: 100%;
    margin: auto;
    width: 80%;
}

.gbbDiscountComponentProgressBar{
    /* background: rgb(0, 217, 255); */
    background: rgb(26, 240, 58);
    position: absolute;
    display: block !important;
    /* max-width: 100%; */
    height: 100%;
    border-radius:5px;
}
.gbbDiscountComponentProgressBarAnimation{
    animation: progressAnimation 1s forwards;
    width: 100%;
}

.gbbDiscountComponentProgressBarRuleText{
    position: absolute;
    top: 22px;
    width: 6ch;
}

/* progressAnimation based on time */
@keyframes progressAnimation {
    0% { width: 0%; }
    10%{ width: 10%; }
    20%{ width: 20%; }
    30%{ width: 30%; }
    40%{ width: 40%; }
    50%{ width: 50%; }
    60%{ width: 60%; }
    70%{ width: 70%; }
    80%{ width: 80%; }
    90%{ width: 90%; }
    100% { width: 100%; }
}


.gbbDiscountComponentProgressBarContainer{
    height: 10px;
}

.gbbDiscountComponent:not(:empty){
    height: 40px;
}

.gbbStarSvgContainer{
    width: 24px;
    height: 24px;
    position: absolute;
    top: -15px;
}


.gbbReviewPageDiscountAppliedLabel{
    display: grid;
    justify-content: end;
    grid-template-columns: max-content;
    font-size: 14px;
    font-weight: 600;
}

.gbbReviewPageDiscountAppliedWrapper:not(empty){
    display: grid;
    justify-content: end;
}

.gbbReviewPageTotalCartValueLabel{
    display: grid;
    justify-content: end;
    grid-template-columns: max-content;
    font-size: 16px;
    font-weight: 600;
    text-align: end;
}


/* .gbbStarSvgContainer polygon.svgInnerBody{
    fill: white;
} */

.gbbStarActive polygon.svgInnerBody{
    fill: rgb(255, 255, 0) !important;
    /* add animation */
    /* animation: starAnimation 1s infinite; */
    /* put a transform and translate animation */
    
    transition: fill 0.5s;
}

@keyframes starAnimation {
    0% { fill: white; }
    50% { fill: rgb(58, 10, 232); }
    100% { fill: rgb(255, 255, 0); }
}


@media screen and (min-width: 1023px) {
    .gbbDiscountComponentProgressBarRuleText{
        position: absolute;
        top: 22px;
        width: max-content;
    }

    .gbbDiscountComponentProgressBarContainer{
        width: 80%;
    }  
    
    .gbbReviewPageTotalCartValueLabel{

        font-size: 24px;
    
    }
    .gbbReviewPageDiscountAppliedLabel{
        font-size: 16px;
    }
       
}



.gbbCategoryHeaderContainer {
  display: grid;
  /* grid-auto-flow: column; */
  align-items: center;
  justify-content: start;
  grid-template-columns: 0.3fr 1fr 2fr;
}
.gbbCategoryImage {
  width: 150px;
  height: 100px;
  object-fit: contain;
}
.gbbCategoryContainer {
  padding: 5px;
  /* background: #f5f5f5; */
  border: 2px solid #C0C0C0;
  border-radius: 10px;
}
.gbbMultipleCategoriesContainerHTML{
  display: grid;
  grid-gap: 20px;
}
.gbbMultipleCategoriesPageHTML{
  margin: 20px 0;
}
.gbbCategoryHeaderContainer{
  cursor: pointer;
}
.gbbCategoryTitle{
  font-weight: 600;
}

.gbbCategoryContainerTab{
  width: fit-content;
  padding: 5px;
  border-radius: 6px;
  display: grid;
  place-items: center;
}

.gbbCategoryTitlesContainer.gbbCategoryContainerTabUI{
  width: fit-content;
  display: grid;
  place-items: center;
}

.gbbMultipleCategoriesRibbonContainer, .gbbMultipleCategoriesDropdownContainer{
  padding: 21px 15px;
  display: flex;
  place-content: start;
  flex-wrap: wrap;
  grid-gap: 10px;
  overflow-x: auto;
  top: 0;
  z-index: 2;
}

.gbbMultipleCategoriesDropdownContainer{
  border-radius: 4px;
}


.gbbCategoryContainer.gbbCategoryContainerTabUI , .gbbMutipleCategoriesDropdown{
  padding: 5px 15px;
  border-radius: 5px;
  border: 1px solid #3c3c3c;
 
  display: grid;
  flex-grow: 1;
}


.gbbMutipleCategoriesDropdown{
  background: black;
  color: white;
  padding: 10px;
  border-radius: 4px;
}


.gbbCategoryContainer.gbbCategoryContainerTabUI.gbbCategoryContainerTabUIActive{
  background-color: black;
  color: #F6F6F6;
}

.gbbCategorySubTitleForTabUI{
  display: none;
}

.gbbMultipleCategoriesActiveCategorySubtitle{
  display: grid;
  place-items: center;
  grid-template-columns: 1fr;
  font-weight: 900;
}

.gbbCategoryImageForTabUI{
  display: none;
}

.gbbCategoryTitlesContainer.gbbCategoryTitlesContainerForTabUI{
  display: grid;
  place-content: center;
}

.gbbCategoryHeaderContainerTabUI.gbbCategoryHeaderContainer{
  display: grid;
  place-items: center;
  grid-template-columns: 1fr;
}

/* .gbbMultipleCategoriesPageHTMLForTabUI{
  overflow-y: auto;
  max-height: 80vh;
} */
.gbbMultipleCategoriesContainerHTMLForTabUI{
  position: relative;
}
 .gbbFiltersMainButtonWrapper{
  z-index: 1;
}
@media (min-width:600px){
  .gbbCategoryContainer {
      padding: 10px 20px;
  }
  .gbbCategoryHeaderContainer {
      grid-template-columns: unset;
      grid-auto-flow: column;
  }
  .gbbCategoryTitlesContainer.gbbCategoryTitlesContainerForTabUI{
    display: grid;
    place-content: center;
  }
  
  .gbbCategoryHeaderContainerTabUI.gbbCategoryHeaderContainer{
    display: grid;
    place-items: center;
    grid-template-columns: 1fr;
  }
}

@media only screen and (max-width: 600px) {
  .gbbMultipleCategoriesRibbonContainer , .gbbMultipleCategoriesDropdownContainer{
    padding: 21px 15px;
    place-content: start;
  }
 
  .gbbMultipleCategoriesDropdownContainer{
      display: flex;
    }


    .gbbMultipleCategoriesRibbonContainer{
      display: none;
    }

}

@media only screen and (min-width: 601px) {
  .gbbMultipleCategoriesDropdownContainer{
    display: none;
  }
}

.gbbMultipleCategoriesDropdownArrow{
    align-self: center;
    display: grid;
    position: absolute;
    right: 4%;
    pointer-events: none;
}

.gbbMultipleCategoriesDropdownArrow svg path{ 
  fill: white;
}

.gbbMutipleCategoriesDropdown{
  -webkit-appearance: none; /* Remove default arrow for WebKit browsers */
  -moz-appearance: none; /* Remove default arrow for Firefox */
  appearance: none; /* Remove default arrow for modern browsers */
}



.bannerAttached .gbbCategoryHeaderContainer :first-child, .bannerAttached .gbbCategorySubTitle{
  display : none;
}
.bannerAttached .gbbCategoryImage{
  width: unset !important;
  height: unset !important;
  max-width: 100%;
}
.bannerAttached .gbbCategoryHeaderContainer{
  grid-template-columns: unset;
}

.gbbCategoryContainer.bannerAttached {
  background: #FFFFFF;
  border: unset;
}.gbbProductsContainer,.gbbProductsContainerV2{
  margin: 15px 10px;
  
}
.gbbProductsItemsContainer{
  display: grid;
  grid-template-columns: repeat(2,1fr);
  grid-gap: 15px;
  font-size: 14px;
}
.gbbProductItem {
  display: grid;
  grid-template-rows: 2fr 0.1fr 0.5fr;
  background: #f1f2f3;
  /* padding: 10px; */
  position: relative;
  box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
  transition: all 0.3s cubic-bezier(.25,.8,.25,1);
}


.gbbProductItem {
    display: grid;
    grid-template-rows: 1fr 0.1fr 0.1fr;
    background: #F1F2F3;
    /* padding: 10px; */
    position: relative;
    box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
    transition: all 0.3s cubic-bezier(.25,.8,.25,1);
}
  


.gbbProductReadMore{
  display: grid;
  justify-self: end;
  padding: 10px;
  color: red;
  cursor: pointer;
}
.gbbProductDescriptionContainer{
  width: 100%;
}
.gbbProductDescriptionText{
  display: -webkit-box;
  max-width: 100%;
  margin: 0 auto;
  font-size: 14px;
  -webkit-box-orient: vertical;
  overflow: hidden;
  font-weight: 400;
  max-height: 200px;
  overflow-y: auto;
  /* -webkit-line-clamp: 4;
  text-overflow: ellipsis; */
}
.gbbProductVariantModalDetailsContainer{
  display: grid;
  grid-gap: 15px;
}
.gbbProductCardActionContainer{
  display: grid;
  grid-template-rows: min-content;
  grid-gap: 10px;
  grid-template-columns: 1fr 1fr;
}
.gbbProductCardActionContainer .gbbProductButtonWrapper{
  width: 50%;
  justify-self: end;
  user-select: none;
}
.gbbProductVariantModalContentContainer{
  display: grid;
  grid-gap: 20px;
}
.gbbProductItemPrice{
}
.gbbProductImageContainer{
  /* width: 140px;
  height: 140px; */
  position: relative;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}
.gbbProductSliderNavigatior{
  position: absolute;
  bottom: 5px;
  right:5px;
}
.gbbPrevImage,.gbbNextImage{
  margin-left:5px;
  position: absolute;
  top: 50%;
  width: 2px;
  padding: 16px;
  margin-top: -22px;
  color: #777676;
  font-weight: bold;
  font-size: 18px;
  transition: 0.6s ease;
  border-radius: 0 3px 3px 0;
  user-select: none;
  margin-left: 5px;
  font-size: 16px;
  cursor: pointer !important;
}
.gbbNextImage{
  right: 3%;
}
.gbbPrevImage:hover, .gbbNextImage:hover {
  /* background-color: rgb(124 121 121 / 80%);
  color: #ffff; */
  scale: 1.1;
}
.gbbFade {
  animation-name: gbbFade;
  animation-duration: 1.5s;
}

@keyframes gbbFade {
  from {opacity: .4} 
  to {opacity: 1}
}
.gbbProductImageContainerImg{
  width: 100%;
  height: 100%;
  object-fit: cover;
  max-height: 150px;
  background: white;
}
.gbbProductVariantModalContentContainer .gbbProductImageContainerImg{
  max-height: 300px;
}
.gbbAddedToCartText{
  position: absolute;
  top: 5%;
  left: 5%;
  background: #000;
  color: #fff;
  border-radius: 5px;
  padding: 5px;
}
.gbbProductQtyContainer{
  width: 60%;
  margin: 0% 10%;
}
.gbbProductQuantityHTML{
  width: 100%;
  display: grid;
  grid-auto-flow: column;
  grid-gap: 15px;
  align-items: center;
}
.gbbProductQuantityAddButton, .gbbProductQuantityRemoveButton{
  background: #000000;
  color:#ffffff;
  border: none;
  border-radius: 5px;
  width: 35px;
  height: 35px;
  font-size: 24px;
  justify-self: center;
  cursor: pointer;
  position: relative;
  user-select: none;
  
  
}

.gbbProductQuantityAddButtonWrapper, .gbbProductQuantityRemoveButtonWrapper{
  position: absolute;
  top: 16px;
  left: 18px;
  transform: translate(-50%, -50%);
  -webkit-tap-highlight-color: transparent;
  user-select: none;
}


.gbbProductQuantityAddButton{
  justify-self: right;
  -webkit-tap-highlight-color: transparent;
}
.gbbProductQuantityRemoveButton{
  justify-self: left;
  -webkit-tap-highlight-color: transparent;
}
.gbbProductQuantityLabel{
  text-align: center;
  font-size: 16px;
  user-select: none;
}
.gbbProductActionContainer{
  width: 100%;
  padding: 10px 10px;
  align-items: center;
  display: grid;
  grid-gap:5px;
  padding-top: 5px;
}
.gbbProductAddButton{
  -webkit-tap-highlight-color: transparent;
  padding: 10px;
  width: 100%;
  background: #000000;
  color: #ffffff;
  border-radius: 5px;
  border: none;
  font-size: 14px;
  cursor: pointer;
  text-align: center;
}

.gbbProductAddButton:active, .gbbProductQuantityAddButton:active, .gbbProductQuantityRemoveButton:active {
  transform: scale(0.95);
}
.gbbProductTextContainer, .gbbProductCardTextContainer,.gbbProductDynamicContentContainer{
  text-align: left;
  width: 100%;
  font-size: 12px;
  align-self: center;
  padding: 5px 10px;
}
.gbbProductCardTextContainer > div{
  font-weight: bold;
  padding: 0;
  font-size: 14px;
}
.gbbProductItemPrice{
  font-size: 12px;
  /* color: black; */
}
.gbbProductItemTitle{
  /* color: black; */
}
.gbbProductsLabel{
  margin: 0 5px;
  font-size: 16px;
  font-weight: 600;
  color: #4f4b4b;
  margin-bottom: 20px;
}
.gbbProductQuantityHTMLContainer{
  display: grid;
  grid-auto-flow: column;
  grid-template-columns: 0.2fr 0.2fr;
  grid-gap: 15px;
  -webkit-tap-highlight-color: transparent;
}
.gbbPageBannerImage{
  width: 100%;
}
.gbbAddProductsPageNavigationContainer, .gbbChooseGiftBoxPageNavigationContainer, .gbbPersonalizePageNavigationContainer{
  /* width: 100%; */
  position: relative;
  /* top: 15%; */
  /* transform: translate(0px, -45%); */
}
.gbbAddProductsPageHTML, .gbbChooseGiftBoxPageHTML, .gbbPersonalizePageHTML{
  /* position: relative;  */
  /* transform: translate(0px, -150px); */
}
.gbbPrecuratedBoxPageHTML{
  position: relative; 
  transform: translate(0px, -100px);
}
/* .gbbAddProductsPageNavigationContainer .gbbNavigationItemsContainer::before{
  content: none;
}
.gbbChooseGiftBoxPageNavigationContainer .gbbNavigationItemsContainer::before{
  content: none;
}
.gbbPersonalizePageNavigationContainer .gbbNavigationItemsContainer::before{
  content: none;
} */
/* do it for other pages also */
/* .gbbAddProductsPageNavigationContainer .gbbNavigationItemsContainer{ 
  margin: 0 10%;
}
.gbbChooseGiftBoxPageNavigationContainer .gbbNavigationItemsContainer{ 
  /* margin: 0 10%; */
  /* margin: 10%; */
/* } */
/* .gbbPersonalizePageNavigationContainer .gbbNavigationItemsContainer{ 
  margin: 0 10%;
}  */

.gbbChooseGiftBoxPageHeader, .gbbAddProductsPageHeader{
  
}

.gbbProductRemoveButton{
  background: rgb(237 159 159);
}
.gbbProductSoldOutButton{
  background: #d2cccc;
  pointer-events: none;
}
/********************PRODUCT VARIANTS MODAL*********************************/
.gbbDisabled {
  pointer-events: none;
  opacity: 0.2;
  /* background-color: black; */
}
.gbbProductVariantModalMainContainer{
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  top: 0;
  background-color: rgba(24,24,24,0.8);
  z-index: 1000000000;
}
.gbbProductVariantModalContainer{
  position: fixed;
  /* top: 30%;
  left: 5% !important;
  right: 5% !important;
transform: translate(0%, -50%); */
  /* width: 100%;
  margin: 0 25px; */
  height: 100%;
  background: #ffff;
  overflow-y: auto;
  z-index: 100;
  display: grid;
  /* grid-template-rows: 0.1fr 0.6fr 0.1fr;; */
  padding: 20px;
  border: 2px solid #b2b5b9;
  border-radius: 5px;
  grid-gap: 20px;
  overflow-x: hidden;
  /* animation: zoom-in-zoom-out 0.2s ease; */

}
.gbbCartProductsMainContainer{
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  top: 0;
  background-color: rgba(24,24,24,0.8);
  z-index: 1000000000;
}
.gbbCartProductsContainerModal{
  position: fixed;
  z-index: 1000000000;
  transform: translate(0, -50%);
  background: #ffff;
  border-radius: 5px;
  text-align: center;
  padding: 10px;
  max-height: 95vh;
  /* left: 5vw;
  top: 5vh;
  right: 5vw; */
  left: 5vw;
  right: 5vw;
  top: 50vh;
}
.gbbCartProductsContainerHeader{
  display: grid;
  grid-template-columns: 1fr 0.2fr;
  justify-content: space-between;
  align-items: center;
}
.gbbCartProductsModalClose{
  justify-self: end;
  padding: 12px 10px;
  font-weight: bold;
  transform: rotate(45deg);
  font-size: 35px;
  position: absolute;
  top: -8px;
  right: 0px;
  color: #B2B5B9;
  cursor: pointer;
  user-select: none;
}
.gbbModalTotalContainer{
  display: grid;
  grid-template-columns: 1fr 1fr;
  justify-content: space-between;
  align-items: center;
  padding: 0 5px;
}
.gbbModalTotalContainer .gbbFooterTotalContainer{
  text-align: unset;
}
.gbbModalTotalContainer .gbbFooterTotalLabel{
  justify-self: start;
  font-size: 16px;
  font-weight: 600;
}
.gbbModalTotalContainer .gbbFooterTotalValue{
  justify-self: end;
}
.gbbConditionNotificationToastMainContainer{
  position: fixed;
  top: 80%;
transform: translate(-50%, -50%);
  background: #ffff;
  padding: 20px;
  border-radius: 5px;
  text-align: center;
  z-index: 300;
}
.gbbConditionNotificationToast {
  position: absolute;
  left: 50%;
  bottom: 80%;
  right: 5%;
  transform: translate(-50%, -50%);
  background: #ffff;
  z-index: 99999999999;
  padding: 5px 15px;
  border-radius: 5px;
  width: 80%;
  display: grid;
  grid-auto-flow: column;
  grid-gap: 20px;
  align-items: center;
  justify-content: center;
}
@keyframes zoom-in-zoom-out {
  0% {
    transform: scale(0, 0);
  }
  50% {
    transform: scale(0.5, 0.5);
  }
  100% {
    transform: scale(1, 1);
  }
}



.gbbProductVariantOptionValue{
  padding: 5px 15px;
  border: none;
  background: #f1f2f3;
  font-size: 14px;
  border-radius: 5px;
  cursor: pointer;
}
.gbbProductVariantModalHeader{
  display: grid;
  grid-auto-flow: column;
}
.gbbProductVariantOptionLabel, .gbbProductQuantityHeading{
  font-weight: bold;
  font-size: 14px;
}
.gbbProductVariantNotAvailableWarning{
  font-size: 14px;
  color: red;
  font-weight: bold;
  display: none;
}
.gbbProductVariantOptionValuesContainer{
  /* padding: 10px 0; */
  display: flex;
  flex-wrap: wrap;
  row-gap: 10px;
  column-gap: 10px;
}
.gbbProductVariantAddButton{
  padding: 5px 10px;
  width: 100%;
  display: grid;
  justify-self: end;
  border: none;
  border-radius: 5px;
  background: #000000;
  color: #ffffff;
  cursor: pointer;
  text-align: center;
  align-items: center;
}
.gbbProductVariantAddButton:active {
  transform: scale(0.95);
}
.gbbProductVariantModalClose{
  justify-self: end;
  padding: 2px 10px;
  font-weight: bold;
  transform: rotate(45deg);
  font-size: 35px;
  position: absolute;
  top: -5px;
  right: 0px;
  color: #B2B5B9;
  cursor: pointer;
  user-select: none;
}
.gbbConditionNotificationClose{
  justify-self: end;
  transform: rotate(45deg);
  font-size: 35px;
  color: #ffff;
  cursor: pointer;
}
.gbbFooterProductPrice, .gbbCartModalProductPrice{
  font-weight: bold;
}
.gbbFooterTotalValueContainer{
  display: grid;
  grid-auto-flow: column;
  grid-gap: 5px;
  grid-template-columns: repeat(2, min-content);
  justify-content: end;
}
.gbbFooterOriginalTotalValue, .gbbSummaryPageBundleOriginalPrice{
  text-decoration: line-through;
}
.gbbFooterProductsContainer{

}
.gbbDiscountMessage{
  text-align: center;
  font-size: 16px;
  color: black;
}
/* .gbbFooterProductsContainer::-webkit-scrollbar {
  width: 0.3rem;
}

.gbbFooterProductsContainer::-webkit-scrollbar-track {
  -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
}

.gbbFooterProductsContainer::-webkit-scrollbar-thumb {
  background-color: darkgrey;
} */

/********FILTER PRODUCTS*******************************/
.gbbProductsFilterContainer{
  margin: 0 20px;
  cursor: pointer;
  /* margin-top: 70px; */
}
.gbbFiltersDropDownWrapper{
  display: grid;
  grid-template-columns: 1fr 50px;
  margin: 10px 0px;
  align-items: center;
}

.gbbFiltersDropDownButton{
/* transform: rotate(180deg); */
/* height: 30px; */
    display: grid;
width: auto;
cursor: pointer
}
.gbbProductsFilterHeader{
  cursor: pointer !important;
}
.gbbProductsFilterButton{
  color: #796c6c;
  padding: 10px 15px;
  font-size: 16px;
  border: none;
  background: #f1f2f3;
  font-weight: 500;
  font-weight: bold;
  margin: 10px 0;
  border-radius: 5px;
  cursor: pointer;
}
.gbbProductsFilterTagsContainer{
  /* width: min-content; */
  /* display: grid;
  grid-template-columns: repeat(3,1fr);
  grid-gap: 30px; */
  display: flex;
  flex-flow: row wrap;
  gap: 10px;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #f1f2f3;
}
.gbbActiveFilter{
  background: #000000;
  color: #ffffff;
}
.gbbFilterTagContainer{
  /* padding: 0 10px; */
  background: #f1f2f3;
  border-radius: 5px;
  /* display: grid;
  grid-auto-flow: column;
  grid-gap: 10px;
  height: min-content;
  justify-items: center; */
}
.gbbFilterTagText{
  color: black;
  padding: 5px 10px;
}
.gbbFilterTagRemoveSymbol{
  font-size: 14px;
  align-self: center;
}
.gbbFiltersSideBarContainer, .gbbProductsFiltersMainContainer{
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  top: 0;
  z-index: 999999999;
  transition: transform 2s;
}
.gbbProductsFiltersMainContainer{
  background-color: rgba(24,24,24,0.8);
  height: 100%;
}
.gbbProductsFiltersContainer{
  background: white;
  padding: 4%;
  height: 100%;
  width: 70%;
  transition: 0.5s;
  transform: translateX(-100%);
  overflow-y: auto;
  animation: slide-in 0.5s forwards;
  -webkit-animation: slide-in 0.5s forwards;
}
.gbbProductsFiltersContainerHeader{
  display: flex;
  justify-content: space-between;
  margin: 10px 0px;
  position: relative;
}
.gbbFilterDropDownButton{
  transform: rotate(180deg);
  height: 30px;
  width: auto;
  cursor: pointer;
}
.gbbProductsFiltersContainerHeaderLabels{
  display: grid;
  grid-auto-flow: column;
  grid-gap: 10px;
  align-items: center;
}
.gbbProductsFiltersClearLabel{
  font-size: 10px;
  text-decoration: underline;
  cursor: pointer;
}
.gbbProductsFiltersContainerLabel{
  font-weight: 600;
  font-size: 16px;
}
.gbbFilterModalClose{
  justify-self: end;
  transform: rotate(45deg);
  font-size: 45px;
  position: absolute;
  top: -30px;
  right: 0px;
  color: #B2B5B9;
  cursor: pointer;
}
.gbbProductsFilterTagContainer{
  display: flex;
  gap: 10px;
  align-items: center;
}
.gbbProductsFilterTagCheckbox{
  width: 16px;
  height: 16px;
}
.gbbFilterContainer {
  border-top: 1px solid #d5cccc;
  padding-bottom: 15px;
  cursor: pointer; 
}

.gbbFilterTagsContainer{
  height: 85%;
  /* overflow-y: scroll; */
  overflow-y: auto;
}

.gbbFiltersSearchSortHeader{
  margin: 5px 10px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-gap: 10px;
}
.gbbFiltersMainButtonWrapper{
  display: grid;
  grid-auto-flow: column;
  grid-gap: 15px;
  align-items: center;
  font-size: 14px;
  border: 1px solid #f1f2f3;
  padding: 0 20px;
  cursor: pointer;
}
/* Filters sidebar animation */
.gbbFiltersSideBarContainerSlideIn {
  animation: slide-in 0.5s forwards;
  -webkit-animation: slide-in 0.5s forwards;
}

.gbbFiltersSideBarContainerSlideOut {
  animation: slide-out 0.5s forwards;
  -webkit-animation: slide-out 0.5s forwards;
}
  
@keyframes slide-in {
  100% { transform: translateX(0%); }
}

@-webkit-keyframes slide-in {
  100% { -webkit-transform: translateX(0%); }
}
  
@keyframes slide-out {
  0% { transform: translateX(0%); }
  100% { transform: translateX(-100%); }
}

@-webkit-keyframes slide-out {
  0% { -webkit-transform: translateX(0%); }
  100% { -webkit-transform: translateX(-100%); }
}
/* code for price filter from codepen ->  https://codepen.io/sln/pen/bqzRMq */
.gbbFilterPriceContainer {
  width: 100%;
  border: 0;
  padding: 0;
  margin: 0; 
}

.gbbPriceFieldContainer {
  position: relative;
  width: 100%;
  height: 36px;
  box-sizing: border-box;
  background: rgba(248, 247, 244, 0.2);
  padding-top: 15px;
  border-radius: 3px;
}

.gbbPriceFieldContainer input[type=range] {
    position: absolute;
}

/* Reset style for input range */

.gbbPriceFieldContainer input[type=range] {
  width: 100%;
  height: 2px; 
  border: 0;
  outline: 0;
  box-sizing: border-box;
  border-radius: 5px;
  pointer-events: none;
  -webkit-appearance: none;
}

.gbbPriceFieldContainer input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
}

.gbbPriceFieldContainer input[type=range]:active,
.gbbPriceFieldContainer input[type=range]:focus {
  outline: 0;
}

.gbbPriceFieldContainer input[type=range]::-ms-track {
  width: 100%;
  height: 2px; 
  border: 0;
  outline: 0;
  box-sizing: border-box;
  border-radius: 5px;
  pointer-events: none;
  background: transparent;
  border-color: transparent;
  color: transparent;
  border-radius: 5px;
}

/* Style toddler input range */

.gbbPriceFieldContainer input[type=range]::-webkit-slider-thumb { 
  /* WebKit/Blink */
    position: relative;
    -webkit-appearance: none;
    margin: 0;
    border: 0;
    outline: 0;
    border-radius: 50%;
    height: 15px;
    width: 15px;
    margin-top: -6px;
    background-color: #686662;
    cursor: pointer;
    cursor: pointer;
    pointer-events: all;
    z-index: 100;
}

.gbbPriceFieldContainer input[type=range]::-moz-range-thumb { 
  /* Firefox */
  position: relative;
  appearance: none;
  margin: 0;
  border: 0;
  outline: 0;
  border-radius: 50%;
  height: 10px;
  width: 10px;
  margin-top: -5px;
  background-color: #686662;
  cursor: pointer;
  cursor: pointer;
  pointer-events: all;
  z-index: 100;
}

.gbbPriceFieldContainer input[type=range]::-ms-thumb  { 
  /* IE */
  position: relative;
  appearance: none;
  margin: 0;
  border: 0;
  outline: 0;
  border-radius: 50%;
  height: 10px;
  width: 10px;
  margin-top: -5px;
  background-color: #686662;
  cursor: pointer;
  cursor: pointer;
  pointer-events: all;
  z-index: 100;
}

/* Style track input range */

.gbbPriceFieldContainer input[type=range]::-webkit-slider-runnable-track { 
  /* WebKit/Blink */
  width: 188px;
  height: 2px;
  cursor: pointer;
  background: #686662;
  border-radius: 5px;
}

.gbbPriceFieldContainer input[type=range]::-moz-range-track { 
  /* Firefox */
  width: 188px;
  height: 2px;
  cursor: pointer;
  background: #686662;
  border-radius: 5px;
}

.gbbPriceFieldContainer input[type=range]::-ms-track { 
  /* IE */
  width: 188px;
  height: 2px;
  cursor: pointer;
  background: #686662;
  border-radius: 5px;
}

/* Style for input value block */

.gbbPriceTextWrap {
  display: flex;
  justify-content: space-between;
  color: #686662;
  font-size: 14px;
  line-height: 1.2em;
  font-weight: 400;
  margin: 5px 0;
}

.gbbPriceWrap1, 
.gbbPriceWrap1 {
  display: flex;
}



.gbbPriceTextWrap #gbbPriceWrap1Input, 
.gbbPriceTextWrap #gbbPriceWrap2Input {
  width: 30px;
  text-align: right;
  margin: 0;
  padding: 0;
  margin:0 2px;
  background:  0;
  border: 0;
  outline: 0;
  color: #fff;
  font-size: 14px;
  line-height: 1.2em;
  font-weight: 400;
}

.gbbPriceTextWrap label {
  text-align: right;
}

/* Style for active state input */
    
.gbbPriceFieldContainer input[type=range]:hover::-webkit-slider-thumb {
  box-shadow: 0 0 0 0.5px #686662;
  transition-duration: 0.3s;
}

.gbbPriceFieldContainer input[type=range]:active::-webkit-slider-thumb {
  box-shadow: 0 0 0 0.5px #686662;
  transition-duration: 0.3s;
}
.gbbSortByDropDownSelect{
  cursor: pointer;
  padding: 5px 25px;
  border: 2px solid #f1f2f3;
  font-size: 14px;
}
/* style for search box */
.gbbSearchBarMainWrapper{
display: grid;
  grid-template-columns: 0.1fr 1fr;
  align-items: center;
  grid-column: 2;
  margin: 10px 0;
  justify-self: end;
  /* border-bottom: 1px solid #f1f2f3; */
  border-bottom: 1px solid #000000;
}
.gbbSearchBarIcon{
  width: fit-content;
  display: grid;
}
.gbbSearchBarInput{
  padding: 10px;
  font-size: 14px;
  border: none;
  box-shadow: none;
    outline: none;
        width: 100%;
    background-color: transparent;
}
.gbbSearchBarInput::placeholder{
  color: #c4c4c4;
}
/* .gbbSearchBarMainWrapper:focus-within{
  border-bottom: 1px solid #000000;
} */
 .gbbProductsNotAvailable{
  text-align: center;
  font-size: 2rem;
  grid-column: 1 / -1;
 }
/*******************FOOTER HTML****************************/
.gbbAddProductsPageFooterHTML,.gbbChooseGiftBoxPageFooterHTML, .gbbPersonalizePageFooterHTML, .gbbPrecuratedBoxPageFooterHTML, .gbbMultipleCategoriesPageFooterHTML{
  background: #D7D7D7;
  padding: 5px;
  position: sticky;
  bottom: 0;
  /* z-index: 999999; */
}
.gbbProductsFooterHTML{
  display: grid;
  grid-template-columns: 1fr 0.2fr;
  grid-gap: 20px;
  padding: 10px;
  position: relative;
  background: #D7D7D7;
  /* background: #f1f2f3;
  padding: 5px;
  position: sticky;
  bottom: 0; */
}
.gbbFooterProductsContainer{
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: min-content;
  grid-gap: 5px;
  overflow-x: auto;
  overflow-y: hidden;
}
.gbbCartModalProductsContainer{
  display: grid;
  grid-auto-flow: column;
  grid-gap: 5px;
  /* overflow-x: auto; */
  overflow-y: auto;
  max-height: 70vh;
}
.gbbCartModalProductsContainer{
  grid-auto-flow: row;
}
.gbbFooterProductContainer, .gbbCartModalProductContainer{
  display: grid;
  grid-auto-flow: column;
  grid-gap: 10px;
  position: relative;
  padding: 5px;
}
.gbbCartModalProductContainer{
  grid-template-columns: 0.5fr 3fr;
}


.gbbFooterProductImageContainer{
  display: grid;
  width: 50px;
  height: 50px;
  border: 1px solid #cfc9c9;
  overflow: hidden;
}
.gbbCartProductImageContainer{
  display: grid;
  width: 80px;
  height: 80px;
  border: 1px solid #cfc9c9;
  overflow: hidden;
}
.gbbViewCartProductsLink{
  text-decoration: underline;
  cursor: pointer; 
}
.gbbCartModalProductImage{
  width: 100%;
  height: 100%;
}

.gbbFooterProductRemoveButton, .gbbCartModalProductRemoveButton{
  position: absolute;
  cursor: pointer;
}
.gbbCartProductImageContainer{
  object-fit: contain;
}
.gbbFooterProductImage{
  /* max-width: 50px; */
  /* max-width: 40px;
  min-height: 40px; */
  width: 100%;
  height: 100%;
  object-fit: contain;
}
.gbbFooterProductTextContainer{
  font-size: 12px;
  width: 100px;
}
.gbbCartModalProductTextContainer{
  font-size: 14px;
  /* width: 165px; */
  display: grid;
  grid-template-columns: 1fr 0.2fr;
  justify-content: space-between;
  align-items: start;
  grid-gap: 10px;
}
.gbbCartProductsContainerHeaderLabel{
  justify-self: start;
  font-size: 16px;
  font-weight: bold;
}
.gbbProductsFooterHTMLForMobile .gbbFooterButtonsWrapper{
  grid-template-columns: 1fr 2fr;
}
.gbbFooterProductTitle{
  width: 100px;
  white-space: nowrap;
  text-overflow: ellipsis;
  display: block;
  overflow: hidden;
}
.gbbCartModalProductTitle{
  width: 100%;
  text-align: left;
}
.gbbCartModalProductPriceQtyContainer{
  display: grid;
  grid-template-columns: 1fr 2fr;
  grid-gap: 5px;
}
.gbbFooterTotalLabel{
  color: black;
  font-size: 14px;
  line-height: 8px;
}
.gbbFooterTotalValue{
  color: black;
  font-weight: 600;
  font-size: 16px;
  white-space: nowrap;
}
.gbbFooterButtonsWrapper{
  display: grid;
  grid-gap: 15px;
  grid-template-columns: auto auto;
}
.gbbFooterBackButton, .gbbFooterNextButton {
  font-size: 12px;
  padding: 10px 15px;
  border: none;
  border-radius: 5px;
  text-align: center;
  font-weight: 600;
  cursor: pointer;
  user-select: none;
}
.gbbFooterBackButton{
  background: grey;
  color: #ffff;
}
.gbbFooterBackButton:active {
  transform: scale(0.95);
}
.gbbFooterNextButton {
  color: #000;
  background: #000000;
  color: #ffffff;
  grid-column: 2 /-1;
}

.gbbFooterNextButton:active {
  transform: scale(0.95);
}

.gbbFooterTotalContainer{
  text-align: right;
}
.gbbFooterProductQtyPriceContainer, .gbbCartModalProductQtyPriceContainer{
  display: flex;
  gap: 5px;
}
.gbbCartModalProductTitleQty{
  display: grid;
  justify-content: start;
  width: unset;
}
.gbbCartModalProductQuantity{
  justify-self: start;
}
.gbbAddedToCartText{
  position: absolute;
  top: 5%;
  left: 5%;
  background: black;
  color: #ffff;
  padding: 0 4px;
  border-radius: 5px;
  font-size: 12px;
}
.gbbViewProductsLabelAndTotalContainer{
  display: grid;
  grid-template-columns: 1fr 0.4fr;
}
.gbbCartProductsContainerModal{
  display: grid;
  grid-gap: 10px;
}
.gbbAddProductsPageHTML .gbbProductsFilterContainer, .gbbChooseGiftBoxPageHTML .gbbProductsFilterContainer, .gbbPrecuratedBoxPageHTML .gbbProductsFilterContainer{
  /* margin-top: 120px; */
}

.gbbLoadMoreProductsButton{
  text-align: center;
  margin: 20px;
  padding: 10px;
  border: 1px solid black;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
}
.gbbProductAllImagesContainer{
  display: none;
  max-height: 200px;
}
.gbbProductVariantModalImageTitleContainer{
  display: grid;
  grid-gap: 15px;
}
.gbbProductTileImageContainer{
  display: grid;
  justify-items: center;
  align-items: center;
}


@media (min-width:600px){

  .gbbProductsItemsContainer{
      grid-template-columns: repeat(3,1fr);
   
  }
  /* .gbbProductItem{
      grid-template-rows: 3fr 0.8fr 0.8fr;
  } */
  .gbbProductImageContainerImg{
      max-height: 180px;
  }
  
  .gbbAddProductsPageNavigationContainer,.gbbPersonalizePageNavigationContainer,.gbbChooseGiftBoxPageNavigationContainer{
  }
  .gbbAddProductsPageNavigationContainer, .gbbChooseGiftBoxPageNavigationContainer, .gbbPersonalizePageNavigationContainer{
      /* transform: translate(0px, -35%); */
  } 
  .gbbProductTextContainer, .gbbProductItemPrice,.gbbProductDynamicContentContainer{
      font-size: 14px;
  }
  .gbbProductCardTextContainer > div{
      font-size: 18px;
  }
  .gbbProductActionContainer{
      display: grid;
      grid-template-columns: auto auto;
      justify-content: space-between;
      grid-gap: max-content;
      width: 100%;
  } 
  .gbbProductsFilterTagsContainer{
  }
  .gbbAddedToCartText{
      font-size: 14px;
  }
  .gbbAddProductsPageHeader, .gbbChooseGiftBoxPageHeader{
  }
  .gbbProductsFiltersContainerLabel{
      font-size: 20px;
  }
  .gbbFiltersMainButtonWrapper{
      font-size: 18px;
  }
  .gbbSortByDropDownSelect{
      font-size: 18px;
  }
  .gbbFiltersMainButtonWrapper{
      justify-self: start;
      padding: 5px 20px;
  }
  .gbbSortByDropDownContainer{
      justify-self: end;
  }
  .gbbProductsFiltersClearLabel{
      font-size: 14px;
  }
  .gbbProductVariantModalBodyContainer{
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      align-items: center;
      grid-gap: 15px;
  }
  .gbbProductVariantModalDetailsContainer{
      display: grid;
      grid-gap: 20px;
  }
  .gbbProductVariantOptionsContainer{
      display: grid;
      grid-gap: 15px;
  }
  .gbbProductVariantOptionLabel, .gbbProductQuantityHeading{
      font-weight: bold;
      font-size: 16px;
  }
  .gbbProductVariantOptionValue{
      font-size: 16px;
  }
  .gbbProductVariantAddButton{
      /* width: 50%; */
  }
  .gbbProductDescriptionText{
      max-height: 150px;
  }
  .gbbProductAllImagesContainer{
      display: grid;
      grid-gap: 5px;
      grid-auto-columns: min-content;
      grid-template-columns: repeat(4, 1fr);
      overflow-y: auto;
  }
  .gbbProductTileImageContainer{
      object-fit: contain;
  }
  .gbbProductTileImage {
      max-height: 70px;
  }
}
/* @media (min-width:768px) and (max-widthx:1023px){
  .gbbAddProductsPageNavigationContainer, .gbbChooseGiftBoxPageNavigationContainer{
      transform: translate(0px, -55%);
  }    
} */
@media (min-width:1024px){
  .gbbProductVariantModalContainer{
      top: 40vh;
      left: 50vw !important;
      transform: translate(-50%, -50%);
      margin: 10vh 0;
      height: unset;
      grid-gap: 15px;
      max-height: 95vh;
  }
  .gbbProductImageContainerImg{
      max-height: 200px;
  }

  .gbbPrevImage,.gbbNextImage{
      font-size: 20px;
  }

  .gbbProductItem:hover {
      box-shadow: 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
  }

  .gbbProductItem{
      grid-template-rows: 3fr 0.8fr 0.8fr;
  }

  .gbbProductImageContainer{
      /* width: 235px;
      height: 235px; */
  }
  .gbbProductsLabel{
      margin: 0 10px;
      font-size: 18px;
      margin-bottom: 20px;
  }
  .gbbPageBannerImage{
      width: 100%;
      height: 10vw;
  }
  .gbbProductButton{
      padding: 10px;
  }
  .gbbFooterProductTextContainer{
      width: 150px;
      font-size: 12px;
  }
  .gbbFooterProductTitle{
      width: 150px;
  }
  .gbbFooterProductImage{
      /* min-height: 50px;
      max-width: 50px; */
  }
  .gbbFooterBackButton, .gbbFooterNextButton {
      font-size: 14px;
  }
  .gbbFooterTotalValue{
      font-size: 16px;
  }
  .gbbFooterTotalContainer{
      text-align: right;
  }
  .gbbFooterProductsContainer{
      grid-gap: 0;
  }
  .gbbProductsFilterContainer{
      margin: 0 20px;
      cursor: pointer;
      /* margin-top: 80px; */

  }
  .gbbChooseGiftBoxPageHTML .gbbProductsFilterContainer{
      /* margin-top: 0 !important; */
  }
  .gbbProductsFilterButton{
      color: #796c6c;
      padding: 10px 15px;
      font-size: 16px;
      border: none;
      background: #f1f2f3;
      font-weight: 500;
      font-weight: bold;
      margin: 10px 0;
      border-radius: 5px;
      cursor: pointer;
  }
  .gbbProductsFilterTagsContainer{
      /* width: min-content; */
      
  }
  .gbbFilterTagContainer{
      /* padding: 0 10px; */
      background: #f1f2f3;
      border-radius: 5px;
      /* display: grid;
      grid-auto-flow: column;
      grid-gap: 10px;
      height: min-content; */
  }
  .gbbFilterTagText{
      color: black;
      padding: 5px 10px;
  }
  .gbbFilterTagRemoveSymbol{
      font-size: 14px;
      align-self: center;
  }
  .gbbProductsFilterTagsContainer{
      padding: 20px;
      border-radius: 5px;
  }
  .gbbPrevImage,.gbbNextImage{
      width: 5px;
  }
  .gbbAddProductsPageNavigationContainer, .gbbChooseGiftBoxPageNavigationContainer, .gbbPersonalizePageNavigationContainer{
      /* transform: translate(0px, -40%); */
  }  
  .gbbProductTextContainer, .gbbProductItemPrice, .gbbProductCardTextContainer,.gbbProductDynamicContentContainer{
      font-size: 14px;
  }

  .gbbProductDynamicContentContainer{
    font-weight: 600;
  }

  .gbbChooseGiftBoxPageHeader{
  }
  .gbbAddProductsPageHeader {
  }
  .gbbProductsFiltersContainer{
      background: white;
      width: 25%;
  }
  .gbbConditionNotificationToast{
      width: max-content;
  }
}
@media(min-width:1192px){
  .gbbProductsItemsContainer{
      grid-template-columns: repeat(4,1fr);
  }
  .gbbProductImageContainerImg{
      max-height: 240px;
  }
  .gbbLoadMoreProductsButton{
      border: none;
      border-bottom: 1px solid black;
  }
}

@media(min-width:1600px){
  .gbbProductsItemsContainer{
      grid-template-columns: repeat(5,1fr);
  }
  
}

@media(min-width:1920px){
  .gbbProductsItemsContainer{
      grid-template-columns: repeat(6,1fr);
  }
}

@media(min-width:2560px){
  .gbbProductsItemsContainer{
      grid-template-columns: repeat(8,1fr);
  }
}

@media(min-width:3840px){
  .gbbProductsItemsContainer{
      grid-template-columns: repeat(12,1fr);
  }
}

@media(min-width: 1023px){

  .gbbProductItemOverLay{
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex !important;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
    cursor: pointer;
  }
  
  
  .gbbOverLayIconContainer{
    display: block !important;
    width:100%;
    height: 100%;
    background-image: url("https://d3ks0ngva6go34.cloudfront.net/storefront/overlay-image.svg");
    background-repeat: no-repeat;
    background-size: 25%;
    background-position: center;
  }


  /* .gbbProductItem:hover .gbbProductItemOverLay{
    opacity: 0.8;
    display: flex !important;
  } */

  .gbbProductImageContainer:hover .gbbProductItemOverLay{
    opacity: 0.8;
    display: flex !important;
  }
}


.gbbProductFormText{
  margin: 0px;
  padding: 10px 18px;
  width: 100%;
  background-color: #ffffff;
  color: #000000;
  max-width: 100%;
  line-height: 1.2;
  border-radius: 2px;
  padding-bottom: 10px;
  border: 1px solid #A2A2A2;
  font-size: 14px !important;
}

.gbbProductVariantModalContainerWithPersonalization .gbbProductDescriptionContainer{
  display: none;
}

.gbbRequiredFieldMessage{
    color: red;
    margin: 0;
    padding: 0;
    font-size: 12px;

}

.gbbProductFormTextCharacterCount {
  font-size: 12px;
  color: #8c8c8c;
  text-align: end;
  grid-column: 2/-1;
}
.gbbProductFormValidationContainer{
  display: grid;
  grid-template-columns: 1fr 1fr;
}


/* For the main list container */
/* .gbbProductFormImageSelectorListContainer {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  grid-gap: 10px;
} */

/* For individual list items within the list container */
.gbbProductFormImageSelectorListItems {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
}

/* For the label element */
.gbbProductFormImageSelectorListLabel {
  width: 100%;
  height: 125px;
  position: relative;
  cursor: pointer;
  display: inline-block;
  align-self: center;
}

/* For individual list items */
.gbbProductFormImageSelectorListItem {
  position: relative;
}

/* For the input (radio button) element */
.personalizationImageInput {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  visibility: hidden;
}

/* For the image element */
.personalizationImage {
  width: 100%;
  height: auto;
  height: 100%;
}

.gbbActiveImageSelectorListItem{
  border: 1px solid #000000;
  opacity: 0.5;
  padding : 10px;
  padding : 5px;
}

.gbbProductFormContainer{
  display: grid;
  grid-gap: 10px;
}

.gbbPersonalizationImageCaption {
  position: absolute;
  bottom: 5%;
  width: 100%;
  opacity: 0;
  background-color: rgba(0,0,0,0.5);
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: opacity 0.5s;
  cursor: pointer;
  font-size: 1.5rem;
  font-weight: bold;
  text-align: center;
}

.gbbActiveImageSelectorListItem .gbbPersonalizationImageCaption{
  opacity: 0;
  padding: 10px;
}


.gbbProductFormRadioListItems{
  display: flex;
  gap: 20px;
}

.personalizationRadioLabel{
  padding-left: 5px;
}

/* =============== NEW PRODUCT CARD DESIGN ============== */
.gbbProductsCardLayoutV2 .gbbProductTextContainer,.gbbProductsCardLayoutV2 .gbbProductItemPricesContainer{
  text-align: center;
}
.gbbProductsCardLayoutV2 .gbbProductActionContainer{
  grid-template-columns: 1fr;
  padding: 0px;
  grid-template-rows: .5fr 45px;
  place-self: end;
}
.gbbProductsCardLayoutV2 .gbbProductItemPricesContainer{
  display: grid;
  grid-template-columns: auto auto;
  justify-self: center;
  gap:10px;
}
.gbbProductsCardLayoutV2 .gbbProductItem{
  background: white;  
  padding: 8px;
  grid-gap: 5px;
  border-radius: 12px;
  border: 1px solid #E3E3E3;
}
.gbbProductsCardLayoutV2 .gbbProductItem:has(.gbbReviewStarsContainer){
    grid-template-rows: min-content;
}
.gbbProductsCardLayoutV2 .gbbProductItem:not(:hover){
  box-shadow: none;
}
.gbbProductsCardLayoutV2 .gbbProductImageContainer{
  border-radius: 8px;
  overflow: hidden;
}
.gbbProductsCardLayoutV2 .gbbProductQuantityHTML,.gbbProductVariantModalLayoutV2 .gbbProductQuantityHTML{
  height: 100%;
  padding: 5px;
  border-radius: 9px;
  place-items: center;
  background: #eeeeee;
}
.gbbProductsCardLayoutV2 .gbbProductTitleOnly{
  font-weight: bold;
    font-size: 18px;
    line-height: 22px;
}
.gbbProductsCardLayoutV2 .gbbFooterButtonsWrapper{
      grid-template-columns: .5fr 1fr .5fr;
        width: 100%;
}
.gbbProductsCardLayoutV2 .gbbDiscountMessage{
  font-weight: bold;
}
.gbbProductsCardLayoutV2 .gbbFooterButtonsContainer{
  display: grid;
    justify-items: center;
    background: #f6f6f6;
    padding: 8px;
    border-radius: 12px;
}
.gbbProductsCardLayoutV2 .gbbFooterTotalContainer{
    display: grid;
      grid-template-columns: repeat(2, min-content);
      align-items: center;
      grid-gap: 10px;
      font-weight: bold;
      place-content: center;
}
.gbbProductsCardLayoutV2 .gbbFooterTotalValueContainer{
  justify-content: start;
}
.gbbProductsCardLayoutV2 .gbbFooterBackButton{
  color: black ;
    border: 2px solid black;
    background: white ;
}
.gbbProductsCardLayoutV2 .gbbFooterNextButton{
  grid-column: 3;
}
.gbbProductsCardLayoutV2 .gbbProductsFooterHTML{
  grid-template-columns: 1fr;
  padding: 10px 0px;
  grid-gap: 8px;
}
.gbbProductsCardLayoutV2 .gbbDiscountFooterHTML{
  padding-top: 5px;
}
.gbbDiscountFooterHTML:has(.progressBarContainer) {
  display: grid;
  grid-gap: 10px;
}
.gbbProductsCardLayoutV2 .gbbDiscountMessageContainer{
      display: grid;
        grid-template-columns: repeat(2, max-content);
        place-content: center;
        grid-gap: 10px;
        align-items: center;
        /* cursor: pointer; */
}
.gbbProductsCardLayoutV2 .gbbProductAddButton{
  border-radius: 10px;
  font-weight:  bold;
}

.gbbProductsCardLayoutV2 .gbbShowBoxProductsToggle{
  height: 25px;
}
.gbbProductsCardLayoutV2 .gbbShowBoxProductsToggleContainer{
  display: flex;
  align-items: center;
}
.gbbProductsCardLayoutV2 .gbbShowBoxProductsToggleContainer>svg{
  height: 30px;
  width: 30px;
}
.gbbProductsCardLayoutV2 .gbbProductQuantityRemoveButton,.gbbProductsCardLayoutV2 .gbbProductQuantityAddButton{
        border-radius: 6px;
        width: 100%;
}
.gbbProductsCardLayoutV2 .gbbProductQuantityAddButtonWrapper,.gbbProductsCardLayoutV2 .gbbProductQuantityRemoveButtonWrapper{
  top: 50%;
  left: 50%;
}
.gbbProductsCardLayoutV2 .showBoxProductsInFooter{
  display: grid;
  grid-template-columns: repeat(2, max-content);
  justify-content: center;
  align-items: center;
  cursor: pointer;
  grid-gap: 10px;
  padding-top: 5px;
}
/* .gbbProductsCardLayoutV2 .gbbFooterProductsContainer{
  display: none;
} */
 .gbbProductsCardLayoutV2 .gbbFooterTotalLabel{
  font-size: 16px;
 }
 .gbbProductsCardLayoutV2 .gbbPageFooterHTML{
  width: 80%;
 }
 .gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbFooterButtonsWrapper{
  grid-template-columns: .5fr 1.5fr .5fr;
  grid-gap: 10px;
 }
 .gbbProductsCardLayoutV2 .gbbAddProductsPageFooterHTML, .gbbProductsCardLayoutV2 .gbbPersonalizePageFooterHTML{
  display: grid;
  justify-items: center;
  z-index: 2;
 }
.gbbAddProductsPageFooterHTML{
  border-top: 1px solid #E3E3E3;
 }
.progressBarContainer {
      display: flex;
        justify-content: center;
 }
.progressBar {
        background-color: #C1E7C5;
        height: 7px;
        border-radius: 25px;
        overflow: hidden;
        width: 80%;
 }
.gbbProductsCardLayoutV2 .progressBar{
width: 100%;
}
.progressBarFill {
        height: 100%;
        width: 0%;
        background-color: #4caf50;
        transition: width 1s;
        /* animation: fillAnimation 2s forwards; */
        display: block !important;
 }
 .gbbProductsCardLayoutV2 .gbbFooterOriginalTotalValue{
  grid-column: 2;
 }
 .gbbProductsCardLayoutV2 .gbbFooterBackButton, .gbbProductsCardLayoutV2 .gbbFooterNextButton{
  border-radius: 5px;
  font-weight: bold;
 }
 .gbbProductsCardLayoutV2 .gbbOverLayIconContainer{
  background-image: url("https://d3ks0ngva6go34.cloudfront.net/storefront/magnifier_new.svg");
 }
 .gbbProductsCardLayoutV2 .gbbProductItemPrice,
 .gbbProductsCardLayoutV2 .gbbProductItemCompareAtPrice {
   font-size: 16px !important;
   font-weight: bold;
 }
  .gbbProductsCardLayoutV2 .gbbProductItem:hover {
    box-shadow: 0 14px 28px rgba(0, 0, 0, 0.12), 0 10px 10px rgba(0, 0, 0, 0.12);
  }
  .gbbProductsCardLayoutV2 .gbbProductTextContainer{
    padding: 0px;
  }
  .gbbProductsCardLayoutV2 .gbbProductItem .gbbReviewStarsContainer{
    text-align: center;
  }
  .gbbProductVariantModalContainer .gbbReviewStarsContainer{
    font-size: 13px;
  }

 @media (max-width: 900px){
  .gbbProductsCardLayoutV2 .gbbPageFooterHTML{
    width: 100%;
  }
  .gbbProductsCardLayoutV2 .gbbDiscountMessageContainer{
    display: flex;
  }
  .gbbProductsCardLayoutV2 .gbbDiscountMessage,.gbbProductsCardLayoutV2 .gbbFooterTotalContainer{
    font-size: 14px;
  }
  .gbbProductsCardLayoutV2 .gbbProductTitleOnly {
  font-size: 14px;
    line-height: 18px;
  }
  .gbbProductsCardLayoutV2 .gbbProductItemPrice,
    .gbbProductsCardLayoutV2 .gbbProductItemCompareAtPrice {
    font-size: 14px !important;
  }
  .gbbProductsCardLayoutV2 .gbbProductAddButton{
    font-size: 12px;
  }
  .gbbProductsCardLayoutV2 .gbbProductItem{
    grid-gap: 8px;
  }
 }
.gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbFooterProductsContainer {
    display: grid;
      max-height: 60vh;
      overflow-y: auto;
      grid-template-columns: 1fr;
      grid-auto-columns: unset;
      grid-auto-flow: unset;
          padding-top: 5px;
}
.gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbFooterProductContainer {
  grid-template-columns: 65px 1fr;
  align-items: center;
  padding: 0px;
}
.gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbFooterProductImageContainer {
  height: 60px;
    width: 65px;
  border-radius: 8px;
}
.gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbFooterProductImage{
  height: 100%;
  object-fit: contain;
  width: 100%;
}
.gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbFooterProductRemoveButton {
    align-items: center;
      position: absolute;
      cursor: pointer;
      top: 0;
      height: 15px;
      display: flex;
}
.gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbFooterProductTextContainer{
  width: 100%;
  overflow: auto;
}
 .gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbFooterProductTitle{
  font-size: 14px;
  width: 100%;
}
 .gbbProductsCardLayoutV2 .gbbCartIconWithQuantityContainer {
  position: absolute;
  left: 50%;
  transform: translate(-50%, -50%);
  top: 0px;
  display: flex;
    padding: 0px 10px;
    border-radius: 10px;
    font-size: 14px;
    align-items: center;
 }
/* .gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbCartIconWithQuantityContainer {
  display: flex;
  padding: 0px 10px;
  border-radius: 10px;
  font-size: 14px;
  align-items: center;
} */
.gbbProductsCardLayoutV2 .gbbCartIconWithQuantityContainer>svg {
 height: 20px;
}
/* .gbbProductsCardLayoutV2 .gbbProductsFooterHTML.gbbProductsFooterHTMLForMobile {
  padding: 0px;
} */
/* NEW VARIANT MODAL */
.gbbProductVariantModalLayoutV2 .gbbProductItemPricesContainer {
  display: grid;
  grid-template-columns: repeat(2,max-content);
  align-items: center;
  gap: 5px;
}
.gbbProductVariantModalLayoutV2 .gbbProductItemCompareAtPrice{
  grid-column: -1;
  grid-row: 1;
}
.gbbProductVariantModalLayoutV2 .gbbProductItemPrice{
  grid-column: 1;
  grid-row: 1;
}
.gbbProductVariantModalLayoutV2 .gbbProductQuantityHTMLContainer{
  grid-template-columns: .8fr 1.5fr;
  align-items: center;
}
.gbbProductVariantModalLayoutV2 .gbbProductQuantityAddButton,
.gbbProductVariantModalLayoutV2 .gbbProductQuantityRemoveButton{
  width: 55px;
  height: 30px;
}
.gbbProductVariantModalLayoutV2 .gbbProductQuantityAddButtonWrapper,
.gbbProductVariantModalLayoutV2 .gbbProductQuantityRemoveButtonWrapper{
  top: 50%;
  left: 50%;
}
.gbbProductVariantModalLayoutV2 .gbbProductCardTextContainer{
  display: grid;
    grid-gap: 5px;
}
.gbbProductVariantModalLayoutV2 .gbbProductDescriptionText{
  scrollbar-width: thin;
}
.gbbProductVariantModalLayoutV2 .gbbProductItemTitle{
  font-size: 20px;
}
.gbbProductVariantModalLayoutV2 .gbbProductItemCompareAtPrice{
  font-size: 15px;
}
.gbbProductVariantModalLayoutV2 .gbbProductItemPrice{
  font-size: 16px;
}
.gbbProductVariantModalLayoutV2 .gbbNextBtnContainer,.gbbProductVariantModalLayoutV2 .gbbPrevBtnContainer{
      background: #eeee;
        display: grid;
        place-items: center;
        cursor: pointer;
}
.gbbProductVariantModalLayoutV2 .gbbNextBtnContainer{
  border-bottom-left-radius: 6px;
    border-bottom-right-radius: 6px;
}
.gbbProductVariantModalLayoutV2 .gbbPrevBtnContainer {
  border-top-left-radius: 6px;
  border-top-right-radius: 6px;
}
.gbbProductVariantModalLayoutV2 .gbbProductImageContainerImg{
  border-radius: 10px;
}
.gbbProductVariantModalLayoutV2 .gbbProductTabImageContainer ,.gbbProductVariantModalLayoutV2 .gbbProductTabImageContainer img{
  border-radius: 8px;
}
.gbbProductVariantModalLayoutV2 .gbbProductCardActionContainer{
grid-template-columns: 1fr;
grid-gap: 0px;
}
.gbbProductVariantModalLayoutV2 .gbbProductVariantModalContainer{
  border: none;
}
.gbbProductVariantModalContainer.gbbVariantInventoryNotAvailable .gbbProductVariantAddButton{
  pointer-events: none;
  opacity: 0.5;
}
.gbbInventoryText{
  font-style: italic;
  font-size: 14px;
}

@media (max-width:430px) {
  .gbbProductsCardLayoutV2 .gbbProductItemPricesContainer{
    grid-template-columns: 1fr;
    gap: 0px;
  }
 
}
@media (max-width:330px) {
  .gbbProductsItemsContainer{
      grid-template-columns: repeat(1,1fr);
    }
}

@media screen and (min-width: 1800px) {
  .gbbProductImageContainer img {
    object-fit: contain;
  }
}
/* @media (min-width: 486px) {
.gbbProductsItemsContainer[data-total-products="1"],
  .gbbProductsItemsContainer[data-total-products="2"],
  .gbbProductsItemsContainer[data-total-products="3"],
  .gbbProductsItemsContainer[data-total-products="4"] {
    display: flex;
    justify-content: center;
  } -- not using this block
.gbbProductsItemsContainerLessProducts{
  display: flex;
  justify-content: center;
}
  .gbbProductsItemsContainerLessProducts .gbbProductTitleOnly {
    word-wrap: break-word;
    max-width: 240px;
  }

  .gbbProductsItemsContainerLessProducts .gbbProductItem {
    min-width: 250px;
  }
} */

/* SLOTS */
.gbbSlotFooterProductsContainer {
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: min-content;
  grid-gap: 10px;
  padding: 5px 0px;
  overflow-x: auto;
  overflow-y: hidden;
  /* place-content: center; */
}
.gbbSlotFooterProductContainer {
      position: relative;
      height: 70px;
      width: 75px;
      border-radius: 8px;
      display: grid;
      place-content: center;
}
img.gbbSlotFooterProductImage {
  height: 100%;
  object-fit: contain;
  width: 100%;
}
.gbbSlotFooterProductImageContainer {
        height: 70px;
        width: 75px;
        margin: 0;
            border: 1px solid #cfc9c9;
              overflow: hidden;
              border-radius: 8px;
}
.gbbSlotFooterProductContainerEmpty {
  border: 1px dashed;
  background: #f1f1f1;
}
.gbbSlotFooterProductQuantity {
  position: absolute;
  bottom: 5%;
  font-size: 12px;
  right: 2%;
  background: black;
  color: white;
  padding: 0px 10px;
  border-radius: 10px;
}
.gbbSlotFooterProductRemoveButton{
  align-items: center;
  position: absolute;
  cursor: pointer;
  top: 0;
  /* right: -5px; */
  height: 15px;
  display: flex;
}
.gbbSlotFooterProductsContainerWrapper {
  display: grid;
  justify-content: center;
}
  .gbbProductsFooterHTMLForMobile .gbbSlotFooterProductContainer ,
  .gbbProductsFooterHTMLForMobile .gbbSlotFooterProductImageContainer{
    height: 60px;
    width: 65px;
  }
  .gbbProductsFooterHTMLForMobile .gbbSlotFooterProductQuantity {
    font-size: 10px;
}
.gbbDiscountRibbon {
  background: red;
  color: white;
  font-weight: bold;
  width: fit-content;
  padding: 2px 8px;
  position: absolute;
  top: 25px;
  right: 0;
  font-size: 12px;
}/***************************************************Landing page CSS*******************************************************************/
* {
  margin: 0;
  padding: 0;
}
.gbbReviewPageHTMLContent {
  display: grid;
  grid-gap: 20px;
}
/* review page banner css */
.gbbReviewPageBanner {
  display: grid;
  position: relative;
}
.gbbReviewPageBannerImage {
  display: grid;
  object-fit: cover;
  width: 100%;
  /* width: 100vw; */
  height: 40vw; /*20vw for desktop*/
}
.gbbReviewPageBannerText {
  font-size: 14px;
  /* color: #fff; */
}
.gbbReviewPageBannerSubText {
  font-size: 12px;
  /* color: #fff; */
}
.ReviewPageBannerButton {
  padding: 10px;
  font-size: 12px;
  width: 100%;
  border-radius: 8px;
  border: 2px solid #ffff;
  cursor: pointer;
}
.gbbReviewPageBannerTextWrapper {
  /* position: absolute; */
  top: 55%;
  left: 8%;
  /* top: 20%;
    left: 10%; */
  width: max-content;
  display: grid;
  grid-template-rows: 0.2fr 0.4fr;
  grid-gap: 10px;
  grid-gap: 5px;
  justify-items: center;
  text-align: center;
  width: 70vw;
  padding: 10px;
}

.gbbReviewPageBodyContainer {
  display: grid;
  justify-self: center;
  width: 95%;
}

.gbbReviewPageTotalBlock {
  display: grid;
  grid-auto-flow: column;
  grid-template-columns: auto auto 2fr;
  border-radius: 5px;
  color: #000;
}
.gbbReviewPageTotalBlockPrice {
  display: grid;
  justify-self: center;
  align-self: center;
  padding: 5px 5px;
}
.gbbReviewPageTotalBlockPriceTitle {
  font-size: 12px;
}

.gbbReviewPageTotalBlockPriceValue {
  font-weight: 700;
}
.gbbReviewPageTotalBlockDelivery {
  display: grid;
  justify-self: center;
  align-self: center;
  padding: 5px 5px;
}
.gbbReviewPageTotalBlockDeliveryTitle {
  font-size: 12px;
}
.gbbReviewPageTotalBlockDeliveryTitleValue {
  font-weight: 700;
}

.gbbReviewPageTotalBlockActions {
  display: grid;
  /* grid-template-columns: 1fr auto auto; */
  grid-template-columns: 1fr 1fr;
  grid-auto-flow: column;
  justify-items: end;
  grid-gap: 5px;
  /* padding: 5px 5px; */
  margin-top: 10px;
  justify-items: right;
  align-items: center;
}

.gbbReviewPageTotalBlockActionsBack {
  background-color: grey;
  padding: 5px 10px;
  text-align: center;
  color: #fff;
  border-radius: 5px;
  justify-self: left;
  font-size: 12px;
  cursor: pointer;
}

.gbbReviewPageTotalBlockActionsCheckout {
  padding: 5px 10px;
  text-align: center;
  color: #000;
  border-radius: 5px;
  font-size: 12px;
  cursor: pointer;
  width: 100%;
  font-weight: 500;
}
.gbbReviewPageProductList {
  /* padding-top: 20px; */
}
.gbbReviewPageProductListItems {
  display: grid;
  margin: 10px 0px;
  /* padding: 0px 10px; */
  border-top: 2px solid #f1f2f3;
  border-bottom: 2px solid #f1f2f3;
}
.gbbReviewPageProductListItem,
.gbbReviewPageProductItemsHeaders {
  display: grid;
  grid-auto-flow: column;
  grid-template-columns: 2fr 1fr 1fr;
}
.gbbReviewPageProductListItem {
  font-size: 12px;
}

.gbbReviewPageProductListItemName,
.gbbReviewPageProductItemsHeadersProduct,
.gbbReviewPageProductItemsHeadersQuantity,
.gbbReviewPageProductItemsHeadersPrice {
  padding: 5px 5px;
  font-weight: 600;
}
.gbbReviewPageProductItemsHeadersProduct {
  text-align: left;
}
.gbbReviewPageProductItemsHeadersQuantity {
  text-align: center;
}
.gbbReviewPageProductItemsHeadersPrice {
  text-align: right;
}
.gbbReviewPageProductListItemQty {
  padding: 5px 5px;
  text-align: center;
}
.gbbReviewPageProductListItemPrice {
  padding: 5px 5px;
  text-align: right;
  display: grid;
  grid-template-columns: max-content;
  justify-content: end;
}
.gbbReviewPageProductListItemRemoveBtn {
  padding: 5px 5px;
  font-size: 12px;
  justify-self: end;
  cursor: pointer;
  color: #aba6a6;
}
.gbbReviewPageProductListTitle {
  font-size: 15px;
  font-weight: 600;
}
/**********ADD ON PRODUCTS HTML ****/
.gbbReviewPageHTMLContent .gbbProductItem {
  /* width: auto; */
  display: grid;
  width: 140px;
  grid-template-rows: 90px 0.1fr 0.1fr;
  grid-gap: 5px;
}
.gbbReviewPageHTMLContent .gbbProductsContainer {
  overflow-x: auto;
  display: grid;
  justify-self: center;
}
.gbbReviewPageHTMLContent .gbbProductsItemsContainer {
  display: grid;
  grid-auto-flow: column;
  grid-template-columns: auto;
  grid-gap: 10px;
  overflow-x: auto;
}
.gbbReviewPageHTMLContent .gbbProductTextContainer {
  align-self: normal;
}
.gbbReviewPageHTMLContent .gbbProductItemTitle {
  color: black;
  white-space: nowrap;
  text-overflow: ellipsis;
  width: 120px;
  display: block;
  overflow: hidden;
}
.gbbReviewPageHTMLContent .gbbProductImageContainer {
  position: relative;
  width: 100%;
  height: 100%;
  border: 1px solid #cfc9c9;
  overflow: hidden;
}

.gbbReviewPageSubTotalCartWrapper {
  display: grid;
  grid-template-columns: 1fr 1fr;
}

.gbbReviewPageSubTotalCart {
  text-align: end;
  grid-column: 2/3;
}

.gbbReviewPageSubTotalCartLabel {
  display: grid;
  font-size: 14px;
  font-weight: 600;
  justify-content: end;
  grid-template-columns: max-content;
}
.gbbReviewPageHTMLContent .gbbProductQuantityRemoveButton,
.gbbReviewPageHTMLContent .gbbProductQuantityAddButton {
  height: 25px;
  width: 25px;
  font-size: 14px;
}
.gbbReviewPageHTMLContent .gbbProductActionContainer {
  grid-auto-flow: row !important;
  grid-gap: 10px !important;
}
.gbbReviewPageHTMLContent .gbbPrevImage,
.gbbReviewPageHTMLContent .gbbNextImage {
  padding: 0;
  width: 2px;
  margin-top: 0;
  top: 40%;
  background: none;
  color: grey;
}
.gbbReviewPageBodyContainer {
  margin: 20px;
}
.gbbReviewPageHTMLContent .gbbNextImage {
  right: 10px;
}
@media only screen and (min-width: 600px) {
  .gbbReviewPageProductListTitle {
    font-size: 20px;
  }
  .gbbReviewPageProductListItem {
    font-size: 15px;
  }

  .gbbReviewPageBannerImage {
    height: 22vw;
  }
  .gbbReviewPageBannerTextWrapper {
    /* width: 30vw;
        top: 15%; */
    width: 40vw;
    top: 50%;
    left: 20%;
  }
  .gbbReviewPageBodyContainer {
    width: 80%;
    margin: 20px;
  }
  .gbbReviewPageTotalBlockPrice {
    padding: 5px 20px;
  }
  .gbbReviewPageTotalBlockDelivery {
    padding: 5px 20px;
  }
  .gbbReviewPageTotalBlockActionsBack {
    font-size: 14px;
    /* grid-column: 2/2; */
  }

  .gbbReviewPageTotalBlockActionsCheckout {
    font-size: 16px;
    width: 80%;
    /* grid-column: 3/3; */
  }

  .gbbReviewPageTotalBlockActions {
    /* grid-template-columns: 2fr auto auto; */
    grid-template-columns: 1fr 1fr;
    grid-gap: 15px;
    /* padding: 5px 15px; */
    /* padding: 5px 5px; */
  }

  /* .gbbReviewPageHTMLContent .gbbProductItem{
        grid-template-rows: auto;
    } */
  .gbbReviewPageHTMLContent .gbbProductItem {
    display: grid;
    width: 170px;
    grid-template-rows: 110px 0.1fr 0.1fr;
    grid-gap: 5px;
  }
}

@media (min-width: 1023px) {
  .gbbReviewPageProductListItem {
    font-size: 16px;
  }
  .gbbReviewPageTotalBlockActionsBack {
    font-size: 16px;
  }

  .gbbReviewPageSubTotalCartLabel {
    font-size: 16px;
  }

  .gbbReviewPageDiscountAppliedLabel {
    font-size: 16px;
  }
  .gbbReviewPageTotalBlockActionsCheckout {
    font-size: 16px;
    width: 60%;
  }
  .gbbReviewPageBannerTextWrapper {
    width: 35vw;
  }
  .gbbReviewPageBannerImage {
    height: 18vw;
  }

  .gbbBodyWrapper {
    margin: 0 10%;
  }
  .gbbReviewPageBannerTextWrapper {
    /* grid-gap: 14px; */
    top: 55%;
    left: 20%;
  }
  .gbbReviewPageBannerText {
    font-size: 22px;
  }
  .gbbReviewPageBannerSubText {
    font-size: 15px;
    /* width: 45%; */
  }
  .gbbReviewPageBannerButtonWrapper {
  }
  .ReviewPageBannerButton {
    padding: 12px;
    font-size: 18px;
    width: 100%;
  }

  .gbbReviewPageTotalBlockActions {
    /* grid-template-columns: 3fr auto auto; */
    grid-template-columns: 1fr 1fr;
    grid-gap: 15px;
    margin-top: 10px;
    /* padding: 5px 15px; */
    /* padding: 5px 5px; */
  }

  .gbbReviewPageHTMLContent .gbbProductsItemsContainer {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  }

  .gbbReviewPageHTMLContent .gbbProductItem {
  }
}

@media (min-width: 1192px) {
  .gbbReviewPagePrecuratedBoxesLabel {
    font-size: 18px;
  }
  /* .gbbNavigationItemsContainer::before{
        top: 45px;
    } */
}

/* this  {is the css code */
.gbbBundleQuantityHTMLContainer {
  grid-template-columns: 0fr 0fr;
  grid-gap: 0px;
  display: grid;
  grid-auto-flow: column;
  -webkit-tap-highlight-color: transparent;
}

.gbbBundleChangeButton {
  padding-left: 9px;
  background: #51d5c7;
  border: none;
  border-radius: 5px;
  width: 35px;
  height: 35px;
  font-size: 24px;
  justify-self: center;
  cursor: pointer;
  position: relative;
  user-select: none;
}

.gbbBundleQuantityWrapper {
  width: 100%;
  display: flex;
  justify-content: end;
  flex-direction: row;
}

/* bundle from product */
.gbbBundleQuantityHTML {
  width: 100%;
  display: grid;
  grid-auto-flow: column;
  grid-gap: 15px;
  align-items: center;
}

.gbbBundleQuantityHeading {
  font-weight: bold;
  font-size: 14px;
}

.gbbBundleQuantityLabel {
  text-align: center;
  font-size: 16px;
  user-select: none;
}
.gbbSummaryPageHTML{
  margin-bottom: 100px;
}
.gbbSummaryPageBodyWrapper{
    display: grid;
    grid-gap: 10px;
}
.gbbSummaryPageBundleDetailsContainer{
    display: grid;
    grid-template-columns: 1fr 0.2fr;
    align-items: start;
}
.gbbSummaryPageBundleDetails{
    display: grid;
    grid-gap: 5px;
}
.gbbSummaryPageBundleDetailsHTML{
    display: grid;
    grid-template-columns: 0.1fr 1fr;
    grid-gap: 10px;
    padding: 10px;
    border:2px solid #f1f2f3;
    margin-bottom: 10px;
    /* grid-column: 1/3; */
}
.gbbSummaryPageBundleImage{
    width: 60px;
    height: 60px;
    object-fit: contain;
}
.gbbSummaryPageBundleImageContainer{
    display: grid;
    justify-content: center;
}
.gbbSummaryPageProductListItemName{
  color: #848484;
  font-weight: 600;
}
.gbbSummaryPageProductListItemName, .gbbSummaryPageProductQtyPriceContainer{
    /* padding: 5px 5px; */
    font-size: 12px;
    text-wrap: balance;

}

.gbbSummaryPageProductTitleQtyPriceContainer{
    display: grid;
    grid-template-columns: 1fr 0.2fr;
}
.gbbSummaryPageProductQtyPriceContainer{
    display: grid;
    grid-auto-flow: column;
    grid-gap: 10px;
    grid-template-columns: 1fr 1fr;
}
.gbbSummaryPageBundleQuantityAddButton{
    justify-self: right;
    -webkit-tap-highlight-color: transparent;
}
.gbbSummaryPageBundleQuantityRemoveButton{
    justify-self: left;
    -webkit-tap-highlight-color: transparent;
}
.gbbSummaryPageBundleQuantityAddButton:active, .gbbSummaryPageBundleQuantityRemoveButton:active {
    transform: scale(0.95);
}
.gbbSummaryPageQuantityAddButtonWrapper, .gbbSummaryPageQuantityRemoveButtonWrapper{
  position: absolute;
  top: 10px;
  left: 11px;
  transform: translate(-50%, -50%);
  -webkit-tap-highlight-color: transparent;
  user-select: none;
}
.gbbSummaryPageBundleQuantityAddButton, .gbbSummaryPageBundleQuantityRemoveButton{
    background: #000000;
    color:#ffffff;
    border: none;
    border-radius: 5px;
    width: 20px;
    height: 20px;
    font-size: 14px;
    justify-self: center;
    cursor: pointer;
    position: relative;
    user-select: none;
}
.gbbSummaryPageBundleQuantityAddButton{
  justify-self: right;
  -webkit-tap-highlight-color: transparent;
}
.gbbSummaryPageBundleQuantityRemoveButton{
  justify-self: left;
  -webkit-tap-highlight-color: transparent;
}
.gbbSummaryPageBundleQuantityAddButton{

}
.gbbSummaryPageBundleItemsLabel{
  font-size: 14px;
}
.gbbSummaryPageBundleTitle{
    font-size: 14px;
    font-weight: 700;
}
.gbbSummaryPageBundleQuantityContainer{
    display: grid;
    grid-template-columns: auto auto auto;
    grid-gap: 15px;
    align-items: center;
    width: 20px;
}
.gbbSummaryPageBundleQuantityText{
    text-align: center;
}
.gbbSummaryPageProductListItemPrice{
    font-weight: 600;
    justify-self: end;
}
.gbbSummaryPageProductListItemQty{
  justify-self: end;
}
.gbbOrderDetailsHTMl, .gbbSummaryPageSubscriptionHTML{
    padding: 15px;
    display: grid;
    grid-gap: 10px;
    background: #f1f2f3;
}
.gbbOrderDetailsHeading, .gbbScheduleDeliveryHeadingLabel{
    font-weight: 600;
}
.gbbSummaryPageSubTotalCart, .gbbSummaryPageDiscountAppliedContainer, .gbbSummaryPageTotalCartValueContainer{
    display: grid;
    grid-template-columns: 1fr 1fr;
}
.gbbSummaryPageSubTotalCartLabel, .gbbSummaryPageDiscountAppliedLabel, .gbbSummaryPageTotalCartValueLabel{
    font-weight: 600;
    color: #848484;
}
.gbbScheduleDeliveryDateLabel{
    font-weight: 600;
}
.gbbSummaryPageSubTotalValue, .gbbSummaryPageDiscountAppliedValue, .gbbSummaryPageTotalCartValue{
    justify-self: end;
    font-weight: 600;
}
.gbbSummaryPageBundleProductsMainContainer{
    /* display: grid; */
    /* align-items: center; */
    /* grid-column: span 2; */
    /* grid-column-start: 2; */
    white-space: nowrap;
}
.gbbSummaryPageBundleImageTitleContainer{
    display: grid;
    grid-template-columns: 0.2fr 1fr;
    align-items: center;
}
/* .gbbSummaryPageBundleProductsContainer{
    grid-column: 2;
} */
.gbbSummaryPageBundlePriceLabel{
    font-weight: 600;
    text-align: end;
    justify-self: end;
}
.gbbSummaryPageBundleRemoveButton{
    font-size: 14px;
    color: #ce6b6b;
    text-align: end;
    cursor: pointer;
}
.gbbSummaryPageBundlePriceContainer{
    display: grid;
    grid-template-columns: 1fr min-content;
    grid-gap: 5px;
}
.gbbSummaryPageBundleDiscountedPrice{
    font-weight: 600;
    justify-self: end;
}
.gbbSummaryPageActionButtons{
    display: grid;
    /* grid-template-columns: 0.4fr 1fr; */
    grid-gap: 10px;
}
.gbbSummaryPageBackButton{
    background-color: grey;
    padding: 10px;
    text-align: center;
    color: #fff;
    border-radius: 5px;
    font-size: 14px;
    cursor: pointer;
    border: none;
    display: grid;
    align-self: center;
}
.gbbSummaryPageCheckoutButton, .gbbSummaryPageCreateNewBoxButton, .gbbUnavailableProductsModalFooterBackBtn, .gbbUnavailableProductsModalFooterCheckoutBtn{
    padding: 10px 10px;
    text-align: center;
    color: #000;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
    width: 100%;
    font-weight: 500;
    background: black;
    color: white;
    border: none;
}
.gbbUnavailableProductsModalFooter{
  display: grid;
  grid-gap: 10px;
}
.gbbSummaryPageBanner {
    display: grid;
    position: relative;
  }
  .gbbSummaryPageBannerImage {
    display: grid;
    object-fit: cover;
    width: 100%;
    /* width: 100vw; */
    height: 40vw; /*20vw for desktop*/
  }
  .gbbSummaryPageBannerText {
    font-size: 14px;
    /* color: #fff; */
  }
  .gbbSummaryPageBannerSubText {
    font-size: 12px;
    /* color: #fff; */
  }
  .gbbSummaryPageBannerTextWrapper {
    /* position: absolute; */
    top: 55%;
    left: 8%;
    /* top: 20%;
      left: 10%; */
    width: max-content;
    display: grid;
    grid-template-rows: 0.2fr 0.4fr;
    grid-gap: 10px;
    grid-gap: 5px;
    justify-items: center;
    text-align: center;
    width: 70vw;
    padding: 40px 10px;
  }
  .gbbSummaryPageBannerText {
    font-size: 14px;
    /* color: #fff; */
  }
  .gbbSummaryPageBannerSubText {
    font-size: 12px;
    /* color: #fff; */
  }
  .gbbScheduleDeliveryWrapper{
    display: grid;
    grid-gap: 10px;
    padding: 15px;
    background: #f1f2f3;
  }
  .gbbSummaryPageDeliverOrderDetailsDiv{
    /* padding: 10px;
    background: #f1f2f3; */
  }
  .gbbSummaryPageBundleTitleContainer{
    display: flex;
    gap: 10px;
    align-items: center;
  }
  .gbbEmptySummaryPageWrapper{
    margin-bottom: 100px;
  }
  .gbbEmptySummaryPageWrapper, .gbbEmptySummaryPageBannerTextWrapper{
    display: grid;
    justify-content: center;
    align-items: center;
    grid-gap: 10px;
  }
  .EmptySummaryPageAction{
    text-align: center;
    padding: 10px;
    background: black;
    color: white;
    border-radius: 5px;
    cursor: pointer;
  }
  .gbbEmptySummaryPageBannerText{
    text-align: center;
  }
  .gbbEmptySummaryPageBannerImage{
    width: 250px;
    height: 250px;
    object-fit: contain;
  }
  .gbbOrderSubtotalTotalContainer{
    display: grid;
    /* grid-template-columns: 1fr 1fr; */
  }
  .gbbSummaryPageBundleQuantity{
    justify-self: end;
  }
  .gbbSummaryPageBundleItemsLabel{
    color: #848484;
  }
  .gbbSummaryPageBundleItemsLabel{
    display: none;
  }
  .gbbSummaryPageBundleDetailsWithProducts{
    display: grid;
    grid-template-rows: min-content;
    grid-gap: 10px;
    overflow-wrap: break-word;

  }

  .gbbFooterDiscountedTotalValue, .gbbFooterOriginalTotalValue, .gbbFooterTotalLabel {
    white-space: nowrap !important;
  }
  
  .gbbSummaryPageDiscountAppliedWrapper{
    display: grid;
    grid-gap: 10px;
  }
  .gbbSummaryPageOneTimeSubscriptionDiv, .gbbSummaryPageSubscriptionAndSaveInputAndLabel{
    display: grid;
    grid-template-columns: min-content 1fr;
    grid-gap: 10px;
    align-items: center;
  }
  .gbbSubscriptionDropDownSelect{
    width: 100%;
    padding: 8px 10px;
    border: 1px solid #cbc2c2;
    border-radius: 5px;
    border: 1px solid #D3D5D6;
  }
  .gbbSummaryPageSubscriptionAndSaveDiv{
    display: grid;
    grid-gap: 10px;
  }
  .gbbSummaryPageOneTimeSubscriptionInput, .gbbSummaryPageSubscriptionAndSaveInput{
    width: 15px;
  }
  .gbbSummaryPageSubscriptionAndSaveLabel, .gbbSummaryPageOneTimeSubscriptionLabel{
    cursor: pointer;
  }
  .gbbSubscriptionDeliveryFrequencyLabel{
    font-size: 12px;
    text-transform: uppercase;
  }
  /* .gbbSummaryPageCreateNewBoxButtonWrapper{
    padding: 5px 10px;
    width: fit-content;
    background: black;
    color: white;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    /* text-decoration: underline; 
    border-radius: 5px;
  }*/
  .gbbSummaryPageBundleEditButton{
    font-size: 14px;
    text-align: end;
    cursor: pointer;
    /* text-decoration: underline; */
    font-weight: bold;
  }
  .gbbSummaryPageBundleEditRemoveButtons{
    display: grid;
    grid-template-columns: 1fr 1fr;
    align-items: center;
    grid-gap: 10px;
  }
  .gbbPreparingBundleMainContainer, .gbbUnavailableProductsMainContainer, .gbbActivatePricingMainContainer{
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    top: 0;
    background-color: rgba(24,24,24,0.8);
    z-index: 1000000000;
  }
  .gbbPreparingBundleContainerModal{
    position: fixed;
    z-index: 1000000000;
    transform: translate(0, -50%);
    background: #ffff;
    border-radius: 5px;
    text-align: center;
    padding: 10px;
    max-height: 95vh;
    /* left: 5vw;
    top: 5vh;
    right: 5vw; */
    left: 25vw;
    right: 25vw;
    top: 50vh;
    display: grid;
    grid-gap: 10px;
    justify-content: center;
  }

  @media screen and (min-width: 600px) {
    .gbbPreparingBundleContainerModal{
      left: 35vw;
      right: 35vw;
    }
    
  }

  .gbbUnavailableProductsContainerModal{
    position: fixed;
    z-index: 1000000000;
    transform: translate(0, -50%);
    background: #ffff;
    border-radius: 5px;
    text-align: center;
    padding: 10px;
    max-height: 95vh;
    /* left: 5vw;
    top: 5vh;
    right: 5vw; */
    left: 20vw;
    right: 20vw;
    top: 50vh;
    display: grid;
    grid-gap: 10px;
  }
  .gbbPreparingBundleHeader{
    font-weight: 600;
    font-size: 14px;
  }
  .gbbPreparingBundleGif{
    width: 120px;
    max-width: 100%;
  }
  .gbbUnavailableProductsModalDiscountsMayNotApplyText{
    color: grey;
  }
  .gbbActivatePricingContainerModal{
    position: fixed;
    z-index: 1000000000;
    transform: translate(-50%, -50%);
    background: #ffff;
    border-radius: 5px;
    text-align: center;
    padding: 2rem 1rem;
    max-height: 95vh;
    left: 50%;
    top:50%;
    display: grid;
    grid-gap: 10px;
    width:300px;
  }
  .gbbActivatePricingImg{
    width:150px;
    height:150px;
  }
  .gbbActivatePricingHeader{
    font-weight: 600;
    font-size: 1.7rem;
    color:#8C4444;
    line-height:initial;
  }
  .gbbActivatePricingDescription{
    font-size: 1.3rem;
    font-weight:500;
    line-height:initial;
  }
  .gbbActivatePricingButton{
    background-color: #8C4444;
    color: #ffffff;
    border-radius:5px;
    padding:1rem 2.5rem;
    font-weight:550;
    cursor:pointer;
    border:none;
  }
  .gbbActivatePricingNoteContainer{
    font-size: 1.2rem;
  }
  .gbbActivatePricingPoweredByContainer{
    display:grid;
    justify-items:end;
    font-size: 1.1rem;
  }
  

@media (min-width: 600px) {
    .gbbSummaryPageBannerImage {
        height: 22vw;
      }
      .gbbSummaryPageBundleItemsLabel{
        display: block;
      }
      .gbbSummaryPageBannerTextWrapper {
        /* width: 30vw;
            top: 15%; */
        width: 40vw;
        top: 50%;
        left: 20%;
      }
    .gbbSummaryPageProductListItemName, .gbbSummaryPageProductQtyPriceContainer{
        font-size: 14px;
    }

    .gbbSummaryPageBundleTitle{
      font-size: 16px;
    }
    .gbbSummaryPageBundleImage{
      width: 100px;
      height: 100px;
    }
    .gbbSummaryPageBundleQuantityAddButton, .gbbSummaryPageBundleQuantityRemoveButton{
      width: 25px;
      height: 25px;
    }
    .gbbSummaryPageQuantityAddButtonWrapper, .gbbSummaryPageQuantityRemoveButtonWrapper{
      top: 12px;
      left: 13px;
    }
    .gbbSummaryPageOneTimeSubscriptionInput, .gbbSummaryPageSubscriptionAndSaveInput{
      width: 20px;
      height: 20px;
    }
    .gbbPreparingBundleGif{
      width: 150px;
    }
    .gbbActivatePricingContainerModal{
      width:500px;
    }
}
@media (min-width: 1023px) {
      .gbbSummaryPageBodyWrapper{
        margin: 0 20px;
      }
      .gbbSummaryPageBannerImage {
        height: 18vw;
      }
      .gbbSummaryPageBannerText {
        font-size: 22px;
      }
      .gbbSummaryPageBannerSubText {
        font-size: 15px;
        /* width: 45%; */
      }
      .gbbSummaryPageBannerTextWrapper {
        width: 35vw;
        top: 55%;
        left: 20%;
      }
      .gbbSummaryPageBannerText {
        font-size: 22px;
      }
      .gbbSummaryPageBannerSubText {
        font-size: 15px;
        /* width: 45%; */
      }
      .gbbSummaryPageBodyWrapper{
        grid-template-columns: 1fr 0.5fr;
    }
    .gbbSummaryPageBundleDetailsHTML{
        /* grid-row-start: 1;
        grid-row-end: span 2; */
    }
    .gbbSummaryPageDeliverOrderDetailsDiv{
        /* height: 100%; */
    }
    .gbbSummaryPageOrderDetailsUI{
        grid-column-start: 2;
    }
    .gbbSummaryPageBundlePriceContainer{
      /* grid-template-columns: 1fr 0.3fr; */
      grid-gap: 10px;
  }
  .gbbSummaryPageBundlePriceLabel{
    /* text-align: unset; */
  }
  .gbbPreparingBundleGif{
    width: 200px;
  }
  .gbbUnavailableProductsContainerModal{
    left: 30vw;
    right: 30vw;
  }
  .gbbUnavailableProductsModalFooter{
    grid-template-columns: 1fr 1fr;
  }
}
.gbbSummaryPageWrapper.gbbSubscriptionBundle .gbbSummaryPageCreateNewBoxButton {
  display: none;
  /*--- TEMP FIX ----*/
}

.gbbSummaryPageBundleSubscriptionDetails {
  font-size: 14px;
}
:root {
    --gbb-gbbSubscriptionBundle-purchase-option-active-color: #2B2B2B;
    --gbb-gbbSubscriptionBundle-purchase-option-active-bg-color: #FFFFFF;
    --gbb-gbbSubscriptionBundle-purchase-option-inactive-color: #888888;
    --gbb-gbbSubscriptionBundle-purchase-option-inactive-bg-color: #F0F0F0;
    --gbb-gbbSubscriptionBundle-purchase-option-stroke-radius: 8px;
    --gbb-gbbSubscriptionBundle-purchase-option-stroke-color: #D5D5D5;
    --gbb-gbbSubscriptionBundle-purchase-option-stroke-width: 2px;

    --gbb-gbbSubscriptionBundle-selling-plan-navigation-active-bg-color: #FFFFFF;
    --gbb-gbbSubscriptionBundle-selling-plan-navigation-active-title-color: #333333;
    --gbb-gbbSubscriptionBundle-selling-plan-navigation-inactive-title-color: #333333;

    --gbb-gbbSubscriptionBundle-page-title-color: #000000;
    --gbb-gbbSubscriptionBundle-page-title-font-weight: bold;
    --gbb-gbbSubscriptionBundle-header-bg-color: #EDEDED;

    --gbb-gbbSubscriptionBundle-selling-plan-navigation-next-prev-icon-bg-color: #2B2B2B;
    --gbb-gbbSubscriptionBundle-selling-plan-navigation-active-discount-pill-bg-color: #CAE983;
    --gbb-gbbSubscriptionBundle-selling-plan-navigation-active-discount-pill-text-color: #000000;
    --gbb-gbbSubscriptionBundle-selling-plan-navigation-inactive-discount-pill-text-color: #000000;
    --gbb-gbbSubscriptionBundle-selling-plan-navigation-inactive-discount-pill-bg-color: #9D9D9D;

    --gbb-gbbSubscriptionBundle-product-discount-ribbon-bg-color: #FF0000;
    --gbb-gbbSubscriptionBundle-product-discount-ribbon-text-color: #FFFFFF;

    --gbb-gbbSubscriptionBundle-subscription-frequency-label-text-color: #333333;
    --gbb-gbbSubscriptionBundle-subscription-frequency-label-font-weight: bold;
    --gbb-gbbSubscriptionBundle-selling-plans-navigation-stroke-color: #B7B7B7;
    --gbb-gbbSubscriptionBundle-selling-plans-navigation-stroke-width: 2px;
    --gbb-gbbSubscriptionBundle-selling-plans-navigation-stroke-radius: 10px;
}
.gbbPurchaseOptionsWrapper{
    display: grid;
    place-content: center;
    gap: 5px;
}
.gbbPurchaseOptionsTitle{
    color:var(--gbb-gbbSubscriptionBundle-subscription-frequency-label-text-color);
    text-align: center;
    font-weight: var(--gbb-gbbSubscriptionBundle-subscription-frequency-label-font-weight);
}
.gbbPurchaseOptionsButtonWrapper {
    display: grid;
    grid-template-columns: repeat(2, max-content);
    align-items: center;
    place-content: center;
}
.gbbPurchaseOption{
    padding: 6px 14px;
    font-weight: bold;
    text-transform: capitalize;
    cursor: pointer;
    /* border:var(--gbb-gbbSubscriptionBundle-purchase-option-stroke-width) solid var(--gbb-gbbSubscriptionBundle-purchase-option-stroke-color); */
    background-color: var(--gbb-gbbSubscriptionBundle-purchase-option-inactive-bg-color);
    color: var(--gbb-gbbSubscriptionBundle-purchase-option-inactive-color);
}
.gbbPurchaseOption {
    width: fit-content;
    position: relative;
    overflow: hidden;
    cursor: pointer;
    user-select: none;
    background-color: rgba(0, 0, 0, 0.16);
    color: rgba(255, 255, 255, 0.7);
    transition-timing-function: cubic-bezier(0.25, 0.8, 0.25, 1);
    transition-duration: 300ms;
    transition-property: color, background-color, box-shadow;
    display: flex;
    align-items: center;
    box-shadow: rgba(0, 0, 0, 0.15) 0px 2px 1px 0px inset, rgba(255, 255, 255, 0.17) 0px 1px 1px 0px;
    outline: none;
    justify-content: center;
}
.gbbPurchaseOption.active {
        background-color: #2d6737;
        color: white;
        box-shadow: rgba(0, 0, 0, 0.23) 0px -1px 1px 0px inset, rgba(255, 255, 255, 0.17) 0px -1px 1px 0px, rgba(0, 0, 0, 0.17) 0px 2px 4px 1px;
    }
.gbbPurchaseOption.active .gbbPurchaseOptionTextContent {
    transform: translateY(-2px);
}
.gbbPurchaseOption.active:hover {
    /* background-color: #34723f; */
    box-shadow: rgba(0, 0, 0, 0.26) 0px -1px 1px 0px inset, rgba(255, 255, 255, 0.17) 0px -1px 1px 0px, rgba(0, 0, 0, 0.15) 0px;
}
.gbbPurchaseOption:hover .gbbPurchaseOptionTextContent {
    transform: translateY(-2px);
}
.gbbPurchaseOption:hover {
    background-color: #2c2c2c;
    color: white;
    box-shadow: rgba(0, 0, 0, 0.23) 0px -1px 1px 0px inset, rgba(255, 255, 255, 0.17) 0px -1px 1px 0px, rgba(0, 0, 0, 0.17) 0px 2px 4px 1px;
}
.gbbPurchaseOption .gbbPurchaseOptionTextContent {
    font-size: 14px;
    font-weight: 600;
    pointer-events: none;
    transition-timing-function: cubic-bezier(0.25, 0.8, 0.25, 1);
    transition-duration: 300ms;
    transition-property: transform;
    transform: translateY(0px);
}

.gbbPurchaseOption:hover .gbbPurchaseOptionTextContent {
    transform: translateY(-2px);
}
.gbbPurchaseOption:first-child{
    border-top-left-radius: var(--gbb-gbbSubscriptionBundle-purchase-option-stroke-radius);
    border-bottom-left-radius: var(--gbb-gbbSubscriptionBundle-purchase-option-stroke-radius);
}
.gbbPurchaseOption:last-child{
    border-top-right-radius: var(--gbb-gbbSubscriptionBundle-purchase-option-stroke-radius);
    border-bottom-right-radius: var(--gbb-gbbSubscriptionBundle-purchase-option-stroke-radius);
}
.gbbPurchaseOption.active{
    background-color: var(--gbb-gbbSubscriptionBundle-purchase-option-active-bg-color);
    color: var(--gbb-gbbSubscriptionBundle-purchase-option-active-color);
}
.gbbSellingPlansNavigationTabsContainer {
        display: grid;
        grid-auto-flow: column;
        overflow-x: scroll;
        grid-auto-columns: 25%; /* make it dynamic width tabs */
        scrollbar-width: none;
}

.gbbSellingPlanNavigationDiscountText {
    font-size: 12px;
    background: var(--gbb-gbbSubscriptionBundle-selling-plan-navigation-inactive-discount-pill-bg-color);
    color: var(--gbb-gbbSubscriptionBundle-selling-plan-navigation-inactive-discount-pill-text-color);
    width: fit-content;
    padding: 2px 10px;
    border-radius: 12px;
}
.gbbSellingPlanNavigationTab.active .gbbSellingPlanNavigationDiscountText{
    background-color: var(--gbb-gbbSubscriptionBundle-selling-plan-navigation-active-discount-pill-bg-color);
    color: var(--gbb-gbbSubscriptionBundle-selling-plan-navigation-active-discount-pill-text-color);
}
.gbbSellingPlanNavigationTab {
    display: grid;
    place-content: center;
    text-align: center;
    cursor: pointer;
    position: relative;
    padding: 10px;
    place-items: center;
    border-top-left-radius: var(--gbb-gbbSubscriptionBundle-selling-plans-navigation-stroke-radius);
    border-top-right-radius: var(--gbb-gbbSubscriptionBundle-selling-plans-navigation-stroke-radius);
    border-bottom: var(--gbb-gbbSubscriptionBundle-selling-plans-navigation-stroke-width) solid var(--gbb-gbbSubscriptionBundle-selling-plans-navigation-stroke-color);
}

.gbbSellingPlansNavigationTitle{
    color: var(--gbb-gbbSubscriptionBundle-page-title-color);
    font-weight: var(--gbb-gbbSubscriptionBundle-page-title-font-weight);
}
.gbbSellingPlanNavigationTab.active {
    background-color: var(--gbb-gbbSubscriptionBundle-selling-plan-navigation-active-bg-color);
    border: var(--gbb-gbbSubscriptionBundle-selling-plans-navigation-stroke-width) solid var(--gbb-gbbSubscriptionBundle-selling-plans-navigation-stroke-color);
    border-bottom: none;
}
.gbbSellingPlanNavigationTabTitle{
    color:var(--gbb-gbbSubscriptionBundle-selling-plan-navigation-inactive-title-color)
}
.gbbSellingPlanNavigationTabTitle.active{
    color: var(--gbb-gbbSubscriptionBundle-selling-plan-navigation-active-title-color);
}
.gbbSellingPlansNavigationWrapper {
    display: grid;
    text-align: center;
    gap: 10px;
}
.gbbSubscriptionBundleWrapper {
    display: grid;
    gap: 20px;
    margin: 0 -12.5%;
    background: var(--gbb-gbbSubscriptionBundle-header-bg-color);
}
.gbbSellingPlansNavigationItemsWrapper {
    display: grid;
    align-items: center;
    gap: 20px;
}
.gbbSellingPlanNextNavigationIconWrapper{
    transform: rotate(180deg);
}
.gbbSellingPlanNextNavigationIconWrapper,
.gbbSellingPlanPrevNavigationIconWrapper{
    cursor: pointer;
}
.gbbSellingPlanNextNavigationIconWrapper svg g,
.gbbSellingPlanPrevNavigationIconWrapper svg g{
    fill: var(--gbb-gbbSubscriptionBundle-selling-plan-navigation-next-prev-icon-bg-color);
}

.gbbSellingPlansNavigationItemsWrapper:has(.gbbSellingPlanNextNavigationIconWrapper) {
    grid-template-columns: 30px 1fr 30px;
    padding: 0px 20px;
}

.gbbSubscriptionDiscountContent {
    background: var(--gbb-gbbSubscriptionBundle-product-discount-ribbon-bg-color);
    color: var(--gbb-gbbSubscriptionBundle-product-discount-ribbon-text-color);
    font-weight: bold;
    width: fit-content;
    padding: 2px 8px;
    position: absolute;
    top: 25px;
    right: 0;
    font-size: 12px;
}
.gbbPageBody:has(.gbbSubscriptionBundleWrapper){
    padding: 0px !important;
}
.gbbSellingPlansNavigationItemsWrapper[data-total-selling-plans="2"] .gbbSellingPlansNavigationTabsContainer,
.gbbSellingPlansNavigationItemsWrapper[data-total-selling-plans="3"] .gbbSellingPlansNavigationTabsContainer,
.gbbSellingPlansNavigationItemsWrapper[data-total-selling-plans="1"] .gbbSellingPlansNavigationTabsContainer{
    justify-content: center;
}
.gbbSubscriptionBundleWrapper:not(:has(.gbbSellingPlansNavigationWrapper)){
    padding-bottom: 20px;
}
@media only screen and (max-width: 500px) {
    .gbbSubscriptionBundleWrapper{
        margin: 0px;
    }
    .gbbPurchaseOption .gbbPurchaseOptionTextContent{
        font-size: 12px;
    }
    .gbbSellingPlansNavigationTabsContainer{
        grid-auto-columns: 33%;
    }
    .gbbSellingPlansNavigationItemsWrapper:has(.gbbSellingPlanNextNavigationIconWrapper){
        padding: 0px 5px;
    }
    .gbbSellingPlansNavigationItemsWrapper:has(.gbbSellingPlanNextNavigationIconWrapper) .gbbSellingPlansNavigationTabsContainer{
        grid-auto-columns: 100%;
    }
    .gbbSellingPlanNavigationTab{
        padding :5px;
    }
        .gbbSellingPlansNavigationItemsWrapper[data-total-selling-plans="2"] .gbbSellingPlansNavigationTabsContainer,
        .gbbSellingPlansNavigationItemsWrapper[data-total-selling-plans="3"] .gbbSellingPlansNavigationTabsContainer,
        .gbbSellingPlansNavigationItemsWrapper[data-total-selling-plans="1"] .gbbSellingPlansNavigationTabsContainer {
            justify-content: normal;
        }
 }
  @media only screen and (max-width: 1020px) {
      .gbbSubscriptionBundleWrapper {
          margin: 0px;
      }
  }/***************************************************Landing page CSS*******************************************************************/
*{
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: inherit;
}
main{
    padding: 0 !important;
}

p{
    padding: 0 ;
    margin: 0 ;
}
/* landing page banner css */
.gbbLandingPageBanner{
    display: grid;
    position: relative;
}
.gbbLandingPageBannerImage {
    display: grid;
    object-fit: cover;
    width: 100vw;
    height: 25vw;  /*20vw for desktop*/
}
.gbbLandingPageBannerText{
    font-size: 14px;
    color: black;
    text-align: center;
    margin: 2% 0%;
}
.gbbLandingPageBannerSubText{
    font-size: 12px;
    color: #fff;
}
.landingPageBannerButton{
    padding: 10px;
    font-size: 12px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
    width: 50%;
    margin: 2% 0%;
}

.landingPageBannerButton:active {
    transform: scale(0.95);
}

.gbbMainPrecuratedBoxesContainer{
    margin: 10% 0%;
}
.gbbLandingPageBannerTextWrapper{
    position: absolute;
    top: 12%;
    left: 7%;
    width: max-content;
    display: grid;
    grid-template-rows: 0.2fr 0.4fr 0.2fr;
    grid-gap: 10px;
    justify-items: center;
    text-align: center;
}
/* landing page - navigation css */
.gbbNavigationItemsContainer{
    display: grid;
    /* grid-template-columns: 1fr 1fr 1fr; */
    grid-template-columns: repeat(auto-fit,minmax(50px,1fr));
    justify-content: center;
    position: relative;
    margin:2% 2%;
}
.gbbLandingPageNavigationItemsContainer{
    margin:2% 2%;
}
.gbbNavigationItem{
    cursor: pointer;
}
.gbbLandingPageNavigationItemsContainer::before{
    /* content: '';
    position: absolute;
    border-top: 5px solid #f1f2f3;
    left: 0;
    right: 0;
    top: 45px;
    z-index: -1; */
}
.gbbNavigationItem{
    justify-content: center;
    z-index: 1;
    display: grid;
    justify-items: center;
}
.gbbNavigationItemsContainer::before{
    content: '';
    position: absolute;
    border-top: 2px solid #d4d5d6;
    left: 0px;
    right: 0px;
    top: 22px;
    z-index: 0;
}


.gbbPreviousNavigationItemsButton , .gbbNextNavigationItemsButton{
    cursor: pointer;
    display: grid;
    justify-items: center;
    align-items: center;
    position: absolute;
    top: 10px;
    border-radius: 50%;
}

.gbbPreviousNavigationItemsButton {
    left:-12px;
}

.gbbNextNavigationItemsButton{
    right: -12px;
   
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);  
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
    /* rotate: 180deg; */
}


.gbbNavigationItemsContainer {
    display: grid;
    justify-items: center;
} 

.gbbNavigationStepContainer {
    display: grid;
    grid-template-rows: 1fr 0.2fr;
    justify-content: center;
    align-items: center;
}
.gbbNavigationImage {
    width: 100%;
    height: 100%;
}
.gbbNavigationStepImgContainer {
    background: white;
    text-align: center;
    border: 2px solid #d4d5d6;
    border-radius: 50%;
    padding: 4px;
    display: grid;
    align-items: center;
    justify-items: center;
    width: 40px;
    height: 40px;
    overflow: hidden;
}
.gbbNavigationTitle{
    font-size: 12px;
    font-weight: 600;
    text-align: center;
}
.gbbNavigationTitleContainer{
    display: grid;
    /* justify-content: center; */
    align-items: center; 
    /* width: 100%; */
    /* padding: 7px 25px; */
    /* text-align: center; */
}
/* landing page - precurated boxes css */
.gbbLandingPagePrecuratedBoxes{
    margin:20px 10px;
    display: grid;
    grid-gap: 20px;
}
.gbbLandingPagePrecuratedBoxesLabel {
    font-size: 16px; 
}
.gbbLandingPagePrecuratedBoxesCardWrapper{
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-gap: 12px;
}
.gbbPrecuratedBoxesCard{
    display: grid;
    grid-template-rows: 1fr 0.2fr;
    justify-content: center;
    background: #f1f2f3;
    padding: 20px;
    font-size: 16px;
    grid-gap: 15px;
}
.gbbPrecuratedBoxesCardImageContainer{
    width: 120px;
    height: 120px;
}
.gbbPrecuratedBoxesCardImage{
    width: 100%;
    height: 100%;
    object-fit: contain;
}
.gbbPrecuratedBoxesCardText{
    text-align: center;
}
.activeNavItem{
    border:  4px solid #ffffff;
}
.gbbLandingPageBannerButtonWrapper{
    text-align: center;
    display: grid;
    place-items: center;
}
.gbbPageHeader{
    position: relative;
}
.gbbPageHeaderText{
    position: absolute;
    top: 10%;
    z-index: 100;
    left: 30%;
    color: white;
    font-size: 16px;
    font-size: 14px;
}
.gbbtickMark {
    border: none;
    position: absolute;
    top: 5px;
}

.gbbtickMarkPseudo::before {
    display: block !important;
    position: absolute;
    left: 0;
    top: 50%;
    height: 50%;
    width: 3px;
    background-color: #ffffff;
    content: "";
    transform: translateX(10px) rotate(-45deg);
    transform-origin: left bottom;
}

.gbbtickMarkPseudo::after {
    display: block !important;
    position: absolute;
    left: 0;
    bottom: 0;
    height: 3px;
    width: 100%;
    background-color: #ffffff;
    content: "";
    transform: translateX(10px) rotate(-45deg);
    transform-origin: left bottom;
}

.checkmark {
    display:inline-block;
    width: 22px;
    height:22px;
    -ms-transform: rotate(45deg); /* IE 9 */
    -webkit-transform: rotate(45deg); /* Chrome, Safari, Opera */
    transform: rotate(45deg);
}

.checkmarkStem {
    position: absolute;
    width:3px;
    height:9px;
    background-color:#ccc;
    left:11px;
    top:6px;
}

.checkmarKick {
    position: absolute;
    width:3px;
    height:3px;
    background-color:#ccc;
    left:8px;
    top:12px;
}
.gbbPageHeader{
    position: relative;
}
.gbbPageHeader:after{
    /* content: " ";
    position: absolute;
    width: 75%;
    left: 10%;
    bottom: 10%;
    height: 50px;
    z-index: -1;
    -moz-box-shadow: 0px 4px #d4d5d6;
    -webkit-box-shadow: 0px 4px #d4d5d6;
    box-shadow: 0px 4px #d4d5d6; */
        /* right: 10px; */

}
/* .gbbPrecuratedPageHeader, .gbbPageHeaderWithoutLine{
    position: relative;
}
.gbbPageHeaderWithoutLine:after{
    display: none !important;
} */
.gbbAddProductPageSubtext,
.gbbPrecuratedBoxPageSubtext,
.gbbPersonalizePageSubtext,
.gbbChooseBoxPageSubtext,
.gbbMultipleCategoriesPageSubtext{
    font-size: 14px;
    color: black;
}

.page-container{
overflow : unset !important;
}
#dummy-chat-button-iframe{
display : none !important;
}

#dummy-chat-button{
display : none !important;
}

@media (min-width:600px){
    .gbbNavigationItemsContainer{
        margin: 2% 10%;  
    }
    .gbbLandingPageBannerImage{
        height: 20vw;
    }
    .gbbNavigationTitleContainer{
        padding: 8px 0px;
    }
    .gbbNavigationTitle{
        font-size: 14px;
    }
    .landingPageBannerButton{
        width: 40%;
    }
    .gbbPageHeaderText{
        top: 15%;
        left: 35%;
        font-size: 16px;
    }
    .gbbPageHeader:after{
        bottom: 7%;
    }

    .gbbAddProductPageSubtext,
    .gbbPrecuratedBoxPageSubtext,
    .gbbPersonalizePageSubtext,
    .gbbChooseBoxPageSubtext,
    .gbbMultipleCategoriesPageSubtext{
        font-size: 18px;
        color: black;
    }

}
@media (min-width:1024px){
    .gbbtickMark{
        /* top: 4%; */
    }
    .gbbLandingPageBannerImage{
        height: 18vw;
        width: 78vw;
    }
    .gbbBodyWrapper{
    margin: 0 10%;
    }
    
.gbbPreviousNavigationItemsButton {
    left:-24px;
}
.gbbNextNavigationItemsButton{
    right: -24px;
}
    .gbbMainPrecuratedBoxesContainer{
        margin: 5% 0%;
    }
    .gbbLandingPageBannerTextWrapper{
        grid-gap: 14px;
        top: 16%;
        left: 8%;
    }
    .gbbLandingPageBannerText{
        font-size: 25px;
    }
    .gbbLandingPageBannerSubText{
        font-size: 17px;
        /* width: 45%; */
    }
    .landingPageBannerButton{
        padding: 12px;
        font-size: 18px;
        width: 40%;
        border-radius: 10px;
    }
    .gbbNavigationItemsContainer{
         margin: 2% 20%;
        /* grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); */ 
    }
    /* .gbbNavigationStepImgContainer{
        height: 100px;
        width: 100px;
    } */
    .gbbNavigationImage{
        width: 100%;
        height: 100%;
    }
    .gbbLandingPagePrecuratedBoxesLabel{
        font-size: 18px;
    }
    .gbbLandingPagePrecuratedBoxesCardWrapper{
        display: grid;
        grid-template-columns: repeat(3,1fr);
        grid-gap: 15px;
    }
    .gbbAddProductPageSubtext,
    .gbbPrecuratedBoxPageSubtext,
    .gbbPersonalizePageWrapper,
    .gbbChooseBoxPageSubtext,
    .gbbMultipleCategoriesPageSubtext{
        font-size: 18px;
    }

    .gbbNavigationItemsContainer::before{
        /* top: 30%; */
    }
    .gbbNavigationItem{
        /* width: 100px;         */
    }
    .gbbNavigationTitleContainer{
        justify-content:normal;
        padding: 4px 2px;
        text-align: center;
    }
    .gbbPrecuratedBoxesCard{
        padding: 10px;
    }
    .gbbPrecuratedBoxesCardImageContainer{
        width: 235px;
        height: 235px;
    }
    .gbbPageHeaderText{
        top: 25%;
        left: 40%;

    }
}

.gbbAddProductPageSubtextWrapper:not(:empty),
.gbbPrecuratedBoxPageSubtextWrapper:not(:empty),
.gbbPersonalizePageSubtextWrapper:not(:empty),
.gbbChooseBoxPageSubtextWrapper:not(:empty),
.gbbMultipleCategoriesPageSubtextWrapper:not(:empty){
    display: grid;  
    margin: 10px;
    justify-content: center;
    text-align: center;
}



.gbbAddProductPageSubtext,
.gbbPrecuratedBoxPageSubtext,
.gbbChooseBoxPageSubtext,
.gbbMultipleCategoriesPageSubtext{
    font-size: 18px;
}

@media(min-width:1192px){
    .gbbLandingPagePrecuratedBoxesLabel{
        font-size: 18px;
    }
    .gbbNavigationItemsContainer::before{
        /* top: 45px; */
    }
}






/* .gbbLoadingScreen {
    display: grid;
    place-items: center;
    height: 80vh;
    margin: 0 auto;
    text-align: -webkit-center;
  } */
  /* .gbbLoadingScreenSpinner {
    border: 16px solid #f3f3f3;
    border-radius: 50%;
    border-top: 16px solid rgb(117, 117, 122);
    border-bottom: 16px solid rgb(117, 117, 122);
    width: 120px;
    height: 120px;
    -webkit-animation: spin 2s linear infinite;
    animation: spin 2s linear infinite;
  }

  @-webkit-keyframes spin {
    0% {
      -webkit-transform: rotate(0deg);
    }

    100% {
      -webkit-transform: rotate(360deg);
    }
  } */
/* 
  .gbbLoadingSkeleon {
    opacity: .7;
    animation: skeleton-loading 1s linear infinite alternate;
  }
  .gbbLoadingSkeleon .skeleton-text {
    width: 100%;
    height: .5rem;
    margin-bottom: .25rem;
    border-radius: .125rem;
  }
  .gbbLoadingSkeleon .skeleton-text:last-child {
    margin-bottom: 0;
    width: 80%;
  }

  @keyframes skeleton-loading {
    0% {
      background-color: hsl(200, 20%, 70%);
    }
  100% {
      background-color: hsl(200, 20%, 95%);
    }
  }

  .gbbLoadingScreenSpinner {    
    width: 100%;
    height: 100%;
    display: block;
    background: linear-gradient(
        to right,
        rgba(255, 255, 255, 0),
        rgba(255, 255, 255, 0.5) 50%,
        rgba(255, 255, 255, 0) 80%
      ),
      lightgray;
    background-repeat: repeat-y;
    background-position: 0 0;
    animation: shine 1s infinite;
  }


  @keyframes shine {
    to {
      background-position: 100% 0;
    } 
  /* } */

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }


.gbbNavigationStepsContainer{
    max-width: 100%;
    width: 100%;
    table-layout: fixed;
    display: table;
}

.gbbNavigationStep{
    cursor: pointer;
    margin: 0 15px;
    text-align: center;
    display: table-cell;
    opacity: 0.6;
    color: rgba(58,58,58,1);
}

.gbbProgressBar{
    display: block !important;
    border-bottom: solid 2px rgba(217,225,230,1);
}

.gbbStepActive{
    opacity: 1;
    font-family: bold;
}

.gbbStepCompleted{
    opacity: 1;
}

.gbbNavigationStepCircle{
    display: block !important;
    margin: 0 auto;
    margin-top: -7px;
    width: 12px;
    height: 12px;
    background: white;
    border: solid 2px;
    border-radius: 50%;
}

.gbbNavigationContainerV2{
    margin:5% 15px;
}


.landingPageBannerButton,
.gbbProductAddButton,
.gbbProductQuantityRemoveButton,
.gbbProductQuantityAddButton,
.gbbProductVariantOptionValue,
.gbbProductVariantAddButton,
.gbbFooterNextButton,
.gbbFooterBackButton,
.gbbCustomerUploadsActionButton,
.gbbProductAddButton{
    cursor: pointer;
    user-select: none;
}

.gbbLoadingScreen{
    user-select: none;
    z-index: 1;
    /* background: #fff; */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: grid;
    justify-content: center;
    align-items: center;
}




.gbbHideScrollBar{
    overflow: hidden;
}
.gbbPageBody{
    height:100%;
    padding:10px;
}


.gbbProductItemCompareAtPrice{
    text-decoration: line-through;
    color: #999;
    font-size: 12px;
}
.gbbProductVariantOptionContainerHidden{
    display: none;
}

.gbbFooterOriginalTotalValue{
    color : #625f5f;
}


.gbbTagsAndPillHTMLContainer{
    display: inline;
}


.gbbProductTabImageContainer img {
    width: 100%;
    height: 100%;
}

.gbbMobileImageBanner , .gbbDesktopImageBanner {
    width: 100%;
  }

.gbbProductQuantityInput{
  width: 48px;  
  font-size: 16px;
  padding: 4px;
  border-radius: 5px;
}

.gbbProductQuantityInput{
    text-align: center;
}

.gbbProductQuantityInput::-webkit-outer-spin-button,
.gbbProductQuantityInput::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

/* Firefox */
.gbbProductQuantityInput[type=number] {
  -moz-appearance: textfield;
}

/* Mobile styles */
@media (max-width: 600px) {
    .gbbMobileImageBanner {
      display: block;
    }
    .gbbDesktopImageBanner {
      display: none;
    }
    .gbbProductQuantityHTML{
        grid-gap: 8px;
    }
    .gbbProductQuantityInput{
        width: 64px;
    }
    .gbbProductVariantModalDetailsContainer .gbbProductQuantityHTML{
        grid-gap: 8px;
    }
  }
  
  /* Desktop styles */
  @media (min-width: 601px) {
    .gbbMobileImageBanner {
      display: none;
    }
    .gbbDesktopImageBanner {
      display: block;
    }
  }

  .gbbAddProductPageBanners:empty{
     display: none;
  }


.gbbProductsCardLayoutV2 .gbbNavigationItemsContainer::before{
    content: none;
    }
  .gbbProductsCardLayoutV2 .gbbStepsProgressBarContainer{
    width: 100%;
    height: 6px;
    position: absolute;
    border-radius: 20px;
    overflow: hidden;
    top: 17px;
  }
  .gbbProductsCardLayoutV2 .gbbStepsProgressBar{
    width: 100%;
    background: #eeeeee;
    height: 100%;
  }
  .gbbProductsCardLayoutV2 .gbbStepsProgressBarFilled{
    display: block !important;
    background: black;
    width: 10%;
    height: 100%;
  }

  .gbbBundle-HTML footer, .gbbBundle-HTML .footer  {
    opacity: 0;
    visibility: hidden;
    transition: opacity 3s, visibility 3s;
    animation: showElement 3s forwards;
}

@keyframes showElement {
    from {
        opacity: 0;
        visibility: hidden;
    }
    to {
        opacity: 1;
        visibility: visible;
    }
}

.gbbPersonalizePageWrapper{
  /* margin: 10% 25%; */
}
.gbbPersonalizePageHTML{
  margin: 5% 5%;
  display:grid;
  grid-gap:40px;
  position: relative; 
  transform: translate(0px, -5%);
}

.gbbPersonalizePageHTMLContent{
    display:grid;
    grid-gap: 20px;
}

.greetingCardAllImagesContainer{
    display: grid;
    /* grid-template-columns: repeat(2,1fr); */
    grid-gap: 15px;
    padding: 10px;
    background: white;    
}


.gbbGreetingCardContainer,
.gbbGiftWrapContainer{
    display: grid;
    grid-gap: 10px;
}

.gbbGreetingCardImg,
.gbbGiftWrapImg{
    width: 100%;
    height: 100%;
    object-fit: contain;
    background: white;
}

.greetingCardPreviewImage{
    height: 100px;
    width: 150px;
}
/* .greetingCardImage,.gbbGreetingCardListWrapper{ */
.greetingCardImage,
.giftWrapImage{
    width: 100%;
    height: 100%;
    /* object-fit: contain; */
    object-fit: cover;
    /* border: 2px solid white; */
    /* padding: 5px; */
    background: white;
}

.greetingCardWrapper,
.giftWrapWrapper{
    overflow-x: hidden;
    /* overflow-y: auto; */
    /* overflow-y: auto; */
    padding-right:5px;
    height: auto;
    /* max-height: 400px; */
    max-height: 350px;
    /* padding: 5px 10px; */
    /* border: 2px solid #D3D5D6; */
    border-radius: 5px;
}

.gbbGreetingCardShowAllImagesButtonWrapper{
    padding: 10px;
    background: white;
    height: fit-content;
}

.gbbGreetingCardShowAllImagesButton{
    padding:10px;
    border-radius: 5%;
}

.gbbGreetingCardDropDownWrapper,
.gbbGiftWrapDropDownWrapper{
    display: grid;
    /* grid-template-columns : 1fr; */
    grid-template-columns: 2fr 1fr;
    grid-template-rows: 1fr;
    padding: 0px 10px;
    border-radius: 5px;
  /* 
    border: 2px solid #D3D5D6;
    padding: 5px; */
}

.gbb_checkmark {
    display:inline-block;
    position:absolute;
    top:10px;
    left:10px;
    width: 22px;
    height:22px;
    -ms-transform: rotate(45deg); /* IE 9 */
    -webkit-transform: rotate(45deg); /* Chrome, Safari, Opera */
    transform: rotate(45deg);
}
.gbb_checkmark {
    top: 50%;
    left: 50%;
    transform: rotate(45deg) translate(-50%, -50%);
}



.gbb_checkmark_circle {
    /* display:block;
    position: absolute;
    width:22px;
    height:22px;
    background-color: green;
    border-radius:11px;
    left:0;
    top:0;
    opacity:0.5; */

    display: block !important;
    position: absolute;
    width: 36px;
    height: 36px;
    background-color: #026a02;
    border-radius: 50%;
    left: -6px;
    top: 0px;
}




.gbb_checkmark_stem {
    display:block !important;
    position: absolute;
    width:3px;
    height:9px;
    background-color:#fff;
    left:11px;
    top:6px;
}
.gbb_checkmark_stem {
  height: 20px;
}

.gbb_checkmark_kick {
    display:block !important;
    position: absolute;
    width:3px;
    height:3px;
    background-color:#fff;
    left:8px;
    top:12px;
}

.gbb_checkmark_kick{
     width: 9px;
    background-color: #fff;
    left: 3px;
    top: 23px;
}



.gbbGreetingCardImageList .greetingCardLabel input:checked,
.giftWrapImageList .giftWrapLabel input:checked{
    border:2px solid #A96668;
    border-radius:5px;
}

.gbbGreetingCardImageList .gbbGreetingCardImageLabel img, 
.giftWrapImageList .giftWrapImageLabel img{
    max-width:100%;
    width: 100%;
    /* width: -moz-available;           */
    /* WebKit-based browsers will ignore this. */
}

.gbbGreetingCardImageLabel,
.giftWrapImageLabel{
    width: 100%;
    height: 150px;
    height: 125px;
    position:relative;
    cursor:pointer;
    display:inline-block;
    align-self:center;
}


.gbbGreetingCardImageList,
.giftWrapImageList{
    display:grid;
    /* grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); */
    grid-template-columns: repeat(1, 1fr);
    grid-template-columns: repeat(2, 1fr);
    grid-gap:10px;
}

.gbbGreetingCardImageList .gbbGreetingCardImageLabel,
.giftWrapImageList .giftWrapImageLabel{
/* gbbGreetingCardImageList .gbbGreetingCardImageLabel, */
  /* border: 1px solid #D3D5D6; */

}
.gbbActiveGreetingCard{
  opacity: 0.5;
}

.greetingCardImageInput,
.giftWrapImageInput{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    visibility:hidden;
}


.gbbBodyWrapper ::-webkit-scrollbar {
  height: 4px;
  width: 3px;
}
  
  /* Track */
  .gbbBodyWrapper ::-webkit-scrollbar-track {
    background: #f1f1f1; 
  }
   
  /* Handle */
   .gbbBodyWrapper ::-webkit-scrollbar-thumb {
    background: #2c2c2c 0% 0% no-repeat padding-box;
  }
  
  /* Handle on hover */
  .gbbBodyWrapper ::-webkit-scrollbar-thumb:hover {
    background: #000000 0% 0% no-repeat padding-box;
  }



.greetingCardDropDownWrapper{
    cursor: pointer;
}


.gbbDisabled{
    pointer-events: none;
    opacity: 0.5;
}

.gbbEmailAddressWrapper{
  display: grid;
  /* background: white;     */
  background: none;
}



.gbbScheduleDeliveryDatePicker{
  display: grid;
  padding: 5px 10px;
  font-weight: 500;
  background: white;    
  /* width: 100%; */
  border-radius: 5px;
  border: 1px solid #D3D5D6;
}




.greetingCardWrapper::-webkit-scrollbar,.giftWrapWrapper::-webkit-scrollbar{ 
  width: 0.3rem;
}
.greetingCardWrapper::-webkit-scrollbar-track,.giftWrapWrapper::-webkit-scrollbar-track{
  -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
}
.greetingCardWrapper::-webkit-scrollbar-thumb,.giftWrapWrapper::-webkit-scrollbar-thumb{
  width: 5px;
  background-color: rgb(26, 24, 24);
}


.gbbGreetingCardDropDownButton,
.gbbGiftWrapDropDownButton{
  transform: rotate(180deg);
  justify-self: self-end;
  height: 30px;
  width: auto;
  cursor: pointer
}


.gbbJustOneProduct{
  display: grid;
  grid-template-columns: 1fr;
  grid-template-rows: 1fr;
  padding: 10px 0px;
  background: white;    
}

.gbbClearSelectionButton{
  border: none;
  text-decoration: underline;
  font-size: 12px;
  cursor: pointer;
  justify-self: end;
}


.greetingCardImgWrapper,.giftWrapImgWrapper{
  height: 250px;
  overflow: hidden;
}


.gbbGreetingCardCheckboxPrice,
.gbbGiftWrapCheckboxPrice{
   justify-self: right;
} 

.gbbVideoHasAlreadyBeenRecorded{
  color: #007F60;
  font-size: 12px;
  font-weight: 600;
  text-align: center;
  background: #f1f2f3;
}


.gbbVideoMsgButtonGroup{
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-gap: 10px;
}

.gbbVideoMsgReRecordButton,
.gbbVideoMsgSaveButton{
  background: #f1f2f3;
  border: 1px solid #D3D5D6;
  border-radius: 5px;
  padding: 5px;
  cursor: pointer;
}

.gbbVideoMsgSaveButton{
  grid-column: 2/3;
  padding: 5px;
}

.gbbVariantDetailsWrapper{
  /* position: absolute;
  bottom: 10%;
  right: 25%;
  background: black;
  color: white; */
  display: grid;
  grid-template-columns: 1fr 1fr;
  /* background-color: rgb(189, 183, 183) ; */
  /* grid-gap: 10px; */
  /* justify-items: center; */
}

.greetingCardImageAndDetailsWrapper{
  display: grid;
  /* grid-template-rows: 3fr 0.5fr; */
  /* grid-gap: 10px; */
  /* border: 2px solid #D3D5D6; */
  border-radius: 5px;
  padding: 5px 5px;
  background-color: rgb(241, 242, 243);
  /* padding: 5px;
  justify-content: center; */
}

.gbbScheduleDeliveryHTML{
  /* grid-column: 2/3; */
}

.gbbScheduleMessageDeliveryWrapper{
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-gap: 10px;
  width: 100%;
  max-width: 100%;
}
.gbbScheduleMessageDeliveryHTML{
  display: grid;
  grid-gap: 10px;
}
.gbbScheduleMessageSendNowContainer, .gbbScheduleMessageSendLaterContainer{
  box-shadow: none;
  display: inline-block;
  justify-content: center;
  cursor: pointer;
  line-height: 30px;
  margin: 0px;
  padding: 6px;
  font-weight: 700;
  text-transform: uppercase;
  font-size: 12px;
  color: #585858;
  border: 1px solid #f3f3f3;
  /* border-top: 0 solid #f3f3f3; */
  transition: transform .2s;
  font-family: inherit;
  /* background: none; */
}
.gbbScheduleMessageSendNowContainer:hover, .gbbScheduleMessageSendLaterContainer:hover{

  transform: scale(0.95);

}
.gbbScheduleMessageDatePicker{
  width: 100%;
  padding: 10px;
  border: 1px solid #a6a6a6;
  display: none;
}
.gbbGiftMessageV2RequiredWarning{
  color: #ff0000;
  font-size: 14px;
}

.gbbGiftMessageV2ToFromContainer {
  width: 100%;
  max-width: 100%;
  display: grid;
  grid-template-columns: 1fr;
  grid-gap: 10px;
  margin-bottom: 10px;
}

.gbbGiftMessageV2FromField,
.gbbGiftMessageV2ToField {
  padding: 10px 18px;
  padding-bottom: 10px;
  border-radius: 2px;
  border: 1px solid #A2A2A2;
  width: unset;
}



@media (min-width:600px){
  .gbbPersonalizePageHTML{
      margin: 10% 0%;
  }
  .gbbGiftMessageV2ToFromContainer{
    grid-template-columns: 1fr 1fr;
  }
  
  .gbbGreetingCardImageLabel, .giftWrapImageLabel{
      width: 100%;
      height: 150px;
  }
  .gbbScheduleDeliveryDatePicker{
    
    padding: 8px 10px;
    
  }
  .gbbGreetingCardImageList{
    grid-template-columns: repeat(3, 1fr);
  }
}


@media (min-width:1024px){  
.gbbPersonalizePageHTML{
  position: relative; 
  transform: translate(0px, -10%);
}
.gbbGiftMessageV2InputFieldsDiv textarea {
  height: 130px;
}

.gbbJustOneProduct .gbbGreetingCardImageLabel,
.gbbJustOneProduct .giftWrapImageLabel{
  width: 100%;
  height: 200px;
}
.gbbGreetingCardImageList, .giftWrapImageList {
  display: grid;
  /* grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); */
  grid-template-columns: repeat(4, 1fr);
  grid-gap: 10px;
}
}


.gbbVariantPrice{
  justify-self: right;
}


.gbbGiftMessageCounterEle:not(:empty),.gbbGiftMessageCounterEle:not(:empty){
  font-size: 12px;
  color: #8c8c8c;
  margin-top: 5px;
  text-align: end;
}


.gbbCustomerUploadsListItemInput{
  display: none;
}


.gbbCustomerUploadsList {
  display: grid;
  grid-gap: 15px;
}

.gbbCustomerUploadsListItem {
  display: grid;
  grid-template-columns: 2fr 1fr 25px;
  grid-gap: 10px;
  margin-bottom: 10px;
}


.gbbCustomerUploadsErrorMsg:not(:empty){
  display: block;
  color:red
}


.gbbCustomerUploadButton{
  font-size: 14px;
  padding: 5px 10px;
  border: none;
  /* width: min-content; */
  border-radius: 5px;
  justify-self: end;
  text-align: center;
  cursor: pointer;
  user-select: none;
}


.gbbCustomerUploadsActionButton {
  font-size: 14px;
  justify-self: end;
}


.gbbCustomerUploadsRemoveButton{
  grid-column: 3/4;
  align-self: end;
  cursor: pointer;
  user-select: none;
}



.gbbCustomerUploadPreviewButton{
  /* underline and blue color */
  font-size: 14px;
  padding: 5px 10px;
  border: none;
  /* width: min-content; */
  border-radius: 5px;
  justify-self: end;
  text-align: center;
  cursor: pointer;
  user-select: none;
  cursor: pointer;
  user-select: none;
  text-decoration: underline;
  color: blue;
}
.gbbCustomerUploadButton{

}

.gbbCustomerUploadsRemoveButton svg {
  /* background: #cf1a1a;
  border-radius: 50%;
  stroke: 0;
  border: 1px solid white;
  fill: white; */
}

.gbbCustomerUploadsMainText{
  /* font-size: 15px; */
  font-weight: 600;
}

.gbbCustomerUploadsDivider{
  display: block !important;
  border: 1px solid #A2A2A2 !important;
  height: 0px;
  opacity: 0.5;
}


/* PRODUCT ADDONS */
.gbbAddonDiscountRibbon{
  background: blue; 
  color: white;
  border-radius: 5px 0px 0px 5px;
}
.notEligibleForAddons .gbbProductItem{
  pointer-events: none;
  opacity: 0.5;
}
.gbbPersonalizePageHTML:has(.gbbAddonProductsWrapper){
  transform: translate(0px, 0px);
  margin: 0% 0%;
}
.gbbAddonProductsSectionTitle{
  font-weight: 600;
}
.gbbProductItem[free-addon-product="true"] .gbbProductItemPricesContainer{
  display: none;
}
.gbbProductItem[free-addon-product="true"] .gbbProductActionContainer {
  grid-template-rows: auto;
}

/* PRODUCT ADDONS */:root {
    /* Banners */
    --gbb-landing-page-image-src: url(https://d3ks0ngva6go34.cloudfront.net/public/banners/landing_page_bannerv2.png);
    --gbb-page-banner-image-src: url(https://d3ks0ngva6go34.cloudfront.net/public/banners/page_banner_temp.png);
    --gbb-product-review-image-src: url(https://d3ks0ngva6go34.cloudfront.net/public/banners/landing_page_bannerv2.png);

    /* Colors */
    --gbb-primary-color: blue;
    --gbb-secondary-color: aqua;
    --gbb-text-color: black;
    --gbb-disabled-color: gray;
    --gbb-product-box-color: blue;

    /* Landing Page */
    --gbb-landing-page-text-color: #000000;
    --gbb-landing-page-button-bg-color: #000000;
    --gbb-landing-page-button-text-color: #ffffff;

    /* Cart Footer */
    --gbb-cart-footer-bg-color: #ffffff;
    --gbb-cart-footer-buttons-container-bg-color: #f6f6f6;
    --gbb-cart-footer-border-radius: 0px;
    --gbb-cart-footer-product-image-border-radius: 0px;
    --gbb-cart-footer-buttons-container-border-radius: 9px;
    --gbb-cart-footer-show-hide-prices: visible;
    --gbb-cart-footer-text-color: #000000;
    --gbb-cart-footer-strikethrough-price-color: #8D8D8D;
    --gbb-cart-footer-final-price-font-thickness: bold;
    --gbb-cart-footer-strikethrough-price-font-thickness: regular;
    --gbb-cart-footer-back-button-color: #6d7175;
    --gbb-cart-footer-back-button-text-color: #FFFFFF;
    --gbb-cart-footer-back-button-border-color: #000000;
    --gbb-cart-footer-back-button-border-thickness: 2px;
    --gbb-cart-footer-next-button-text-color: #ffffff;
    --gbb-cart-footer-next-button-color: #000000;
    --gbb-cart-footer-next-button-border-color: #000000;
    --gbb-cart-footer-next-button-border-thickness: 2px;
    --gbb-cart-footer-buttons-border-radius: 9px;
    --gbb-cart-footer-buttons-padding: 10px;
    --gbb-cart-footer-discount-progress-bar-empty-color: #C1E7C5;
    --gbb-cart-footer-discount-progress-bar-filled-color: #15A524;
    --gbb-cart-footer-discount-text-visibility: visible;

    /* Product Card */
    --gbb-product-card-bg-color: #f1f2f3;
    --gbb-product-card-border-radius: 12px;
    --gbb-product-card-image-border-radius: 8px;
    --gbb-product-card-image-fit: cover;
    --gbb-product-card-per-row-xtra-large-screen: 6;
    --gbb-product-card-per-row-large-screen: 4;
    --gbb-product-card-text-color: #252525;
    --gbb-product-card-title-font-size: 19px;
    --gbb-product-card-title-font-weight: regular;
    --gbb-product-card-final-price-visibility: block;
    --gbb-product-card-compare-at-price-font-size: 20px;
    --gbb-product-card-compare-at-price-font-weight: regular;
    --gbb-product-card-compare-at-price-visibility: block;
    --gbb-product-card-final-price-font-size: 18px;
    --gbb-product-card-final-price-font-color: #252525;
    --gbb-product-card-final-price-font-weight: bold;
    --gbb-product-card-button-color: #000000;
    --gbb-product-card-button-text-color: #ffffff;
    --gbb-product-card-button-border-radius: 10px;
    --gbb-product-card-allow-only-one-quantity: block;
    --gbb-product-card-quantity-selector-bg-color: #EEEEEE;
    --gbb-product-card-quantity-selector-btns-bg-color: #000000;
    --gbb-product-card-quantity-selector-text-color: #000000;
    --gbb-product-card-quantity-selector-border-radius: 8px;
    --gbb-product-card-quantity-selector-button-text-color: #ffffff;

    /* Navigation Banner */
    --gbb-navigation-banner-title-color: #ffffff;
    --gbb-navigation-banner-text-color: #ffffff;
    --gbb-navigation-banner-step-completion-color: #000000;
    --gbb-navigation-banner-step-done-color: #000000;
    --gbb-navigation-banner-step-text-color: #000000;
    --gbb-navigation-banner-step-progress-bar-filled-color: #1E1E1E;
    --gbb-navigation-banner-step-progress-bar-empty-color: #cccccc;
    --gbb-navigation-banner-step-text-font-size: 20px;
    --gbb-navigation-check-color: #ffffff;
    --gbb-navigation-banner-step-completed-border-color: #000000;
    --gbb-navigation-banner-step-completed-border-width: 2px;
    --gbb-navigation-banner-step-incomplete-bg-color: #FFFFFF;
    --gbb-navigation-banner-step-incomplete-border-color: #000000;
    --gbb-navigation-banner-step-incomplete-border-width: 2px;
    --gbb-navigation-banner-tabs-active-bg-color: #000000;
    --gbb-navigation-banner-tabs-active-text-color: #F6f6f6;
    --gbb-navigation-banner-tabs-inactive-bg-color: #FFFFFF;
    --gbb-navigation-banner-tabs-inactive-text-color: #000000;
    --gbb-navigation-banner-tabs-border-color: #3c3c3c;
    --gbb-navigation-banner-tabs-corner-radius: 5px;

    /* Summary Block */
    --gbb-summary-block-add-to-cart-button-color: #000000;
    --gbb-summary-block-add-to-cart-button-text-color: #ffffff;
    --gbb-summary-block-back-button-color: #252525;
    --gbb-summary-block-back-button-text-color: #ffffff;

    /* Category Block */
    --gbb-category-bg-color: #f5f5f5;
    --gbb-tab-active-bg-color: #000000;
    --gbb-tab-active-text-color: #F6f6f6;
    --gbb-tab-inactive-bg-color: #FFFFFF;
    --gbb-tab-inactive-text-color: #000000;

    /* Quick Settings */
    --gbb-quick-settings-primary-color: #000000;
    --gbb-quick-settings-button-bg-color: #000000;
    --gbb-quick-settings-button-text-color: #ffffff;

    /* General Settings */
    --gbb-condition-toast-bg-color: #000000;
    --gbb-condition-toast-text-color: #ffffff;
    --gbb-scroll-bar-color: #F6F6F6;
    --gbb-icon-text-color: #1d1d1b;
    --gbb-icon-bg-color: #ffffff;
    --gbb-product-page-title-color: #000000;
    --gbb-bundle-bg-color: #ffffff;
}


.gbbNewPageCustomization.gbbProductsCardLayoutV2 {

    /* CART FOOTER COLOR CONFIG */
    .gbbProductsFooterHTML,
    .gbbAddProductsPageFooterHTML,
    .gbbPersonalizePageFooterHTML {
        background-color: var(--gbb-cart-footer-bg-color);
        border-radius: var(--gbb-cart-footer-border-radius);
    }

    .gbbFooterButtonsWrapper {
        background-color: var(--gbb-cart-footer-buttons-container-bg-color);
        border-radius: var(--gbb-cart-footer-buttons-container-border-radius);
    }

    .gbbFooterTotalContainer {
        visibility: var(--gbb-cart-footer-show-hide-prices);
    }

    .gbbFooterProductImageContainer {
        border-radius: var(--gbb-cart-footer-product-image-border-radius);
    }

    .gbbFooterDiscountedTotalValue {
        font-weight: var(--gbb-cart-footer-final-price-font-thickness);
        color: var(--gbb-cart-footer-final-price-font-color);
    }
    
    .gbbFooterOriginalTotalValue {
        color: var(--gbb-cart-footer-strikethrough-price-color);
        font-weight: var(---gbb-cart-footer-strikethrough-price-font-thickness);
    }

    .gbbFooterBackButton {
        background-color: var(--gbb-cart-footer-back-button-color);
        color: var(--gbb-cart-footer-back-button-text-color);
        border: var(--gbb-cart-footer-back-button-border-thickness) solid var(--gbb-cart-footer-back-button-border-color);

    }

    .gbbFooterNextButton {
        background-color: var(--gbb-cart-footer-next-button-color);
        color: var(--gbb-cart-footer-back-button-text-color);
        border: var(--gbb-cart-footer-next-button-border-thickness) solid var(--gbb-cart-footer-next-button-border-color);
       
    }
    .gbbFooterBackButton,.gbbFooterNextButton{
        border-radius: var(--gbb-cart-footer-buttons-border-radius);
        padding: var(--gbb-cart-footer-buttons-padding);
    }

    .progressBar {
        background-color: var(--gbb-cart-footer-discount-progress-bar-empty-color);
    }

    .progressBarFill {
        background-color: var(--gbb-cart-footer-discount-progress-bar-filled-color);
    }

    .gbbDiscountMessage {
        color: var(--cart-footer-discount-text-color);
        visibility: var(--gbb-cart-footer-discount-text-visibility)
    }

    
    /* CART FOOTER COLOR CONFIG */

    /* PRODUCT CARD COLOR CONFIG */
    .gbbProductItem {
        background-color: var(--gbb-product-card-bg-color);
        border-radius: var(--gbb-product-card-border-radius);
    }

    .gbbProductQuantityAddButton {
        display: var(--gbb-product-card-allow-only-one-quantity);
        border-radius: var(--gbb-product-card-quantity-selector-border-radius);
    }

    .gbbProductItemPrice {
        display: var(--gbb-product-card-final-price-visibility);
    }

    .gbbProductImageContainer {
        border-radius: var(--gbb-product-card-image-border-radius);
    }

    .gbbProductImageContainerImg {
        object-fit: var(--gbb-product-card-image-fit);
    }

    .gbbProductTextContainer {
        color: var(--gbb-product-card-text-color);
    }

    .gbbProductTitleOnly {
        font-size: var(--gbb-product-card-title-font-size);
        font-weight: var(--gbb-product-card-title-font-weight);
    }

    .gbbProductItemCompareAtPrice {
        color: var(--gbb-product-card-compare-at-price-font-color);
        font-size: var(--gbb-product-card-compare-at-price-font-size);
        font-weight: var(--gbb-product-card-compare-at-price-font-weight);
        display: var(--gbb-product-card-compare-at-price-visibility);
    }

    .gbbProductItemPrice {
        color: var(--gbb-product-card-final-price-font-color);
        font-size: var(--gbb-product-card-final-price-font-size);
        font-weight: var(--gbb-product-card-final-price-font-weight);
    }

    .gbbProductAddButton {
        background-color: var(--gbb-product-card-button-color);
        color: var(--gbb-product-card-button-text-color);
        border-radius: var(--gbb-product-card-button-border-radius);
    }

    .gbbProductQuantityHTML {
        background-color: var(--gbb-product-card-quantity-selector-bg-color);
        color:var(--gbb-product-card-quantity-selector-text-color) ;
        border-radius: var(--gbb-product-card-button-border-radius);
    }
    .gbbProductQuantityRemoveButton{
        background-color: var(--gbb-product-card-quantity-selector-btns-bg-color);
        color: var(--gbb-product-card-quantity-selector-button-text-color);
        border-radius: var(--gbb-product-card-quantity-selector-border-radius);
    }
        /* productCardQuantitySelectorButtonTextColor */
    @media screen and (min-width: 1921px) {
        .gbbProductsItemsContainer {
            grid-template-columns: repeat(var(--gbb-product-card-per-row-xtra-large-screen), 1fr);
        }
    }
        @media screen and (min-width: 768px) and (max-width: 1920px) {
            .gbbProductsItemsContainer {
                grid-template-columns: repeat(var(--gbb-product-card-per-row-large-screen), 1fr);
            }
        }
    /* PRODUCT CARD COLOR CONFIG */

    /* Navigation */

    .gbbNavigationTitle {
        color: var(--gbb-navigation-banner-text-color);
        font-size: var(--gbb-navigation-banner-step-text-font-size);
    }

    .gbbStepsProgressBar {
        background-color: var(--gbb-navigation-banner-step-progress-bar-empty-color);
    }

    .gbbStepsProgressBarFilled {
        background-color: var(--gbb-navigation-banner-step-progress-bar-filled-color);
    }

    .gbbCategoryContainerTabUI {
        background-color: var(--gbb-navigation-banner-tabs-inactive-bg-color);
        color: var(--gbb-navigation-banner-tabs-inactive-text-color);
        border: 1px solid var(--gbb-navigation-banner-tabs-border-color);
        border-radius: var(--gbb-navigation-banner-tabs-corner-radius);
    }

    .gbbCategoryContainerTabUIActive {
        background-color: var(--gbb-navigation-banner-tabs-active-bg-color);
        color: var(--gbb-navigation-banner-tabs-active-text-color);
    }

    .gbbtickMark svg>path {
        fill: var(--gbb-navigation-banner-step-done-color);
    }
 /* gbbNavigationStepImgContainer class which doesnt includes gbbNavigationStepImgContainerActive */

    .gbbNavigationStepImgContainer:not(.gbbNavigationStepImgContainerActive) {
        border: var(--gbb-navigation-banner-step-incomplete-border-width) solid var(--gbb-navigation-banner-step-incomplete-border-color);
        background-color: var(--gbb-navigation-banner-step-incomplete-bg-color);
    }

    .gbbNavigationStepImgContainerActive {
        border: var(--gbb-navigation-banner-step-completed-border-width) solid var(--gbb-navigation-banner-step-completion-color);
        /* background-color: var(--gbb-navigation-banner-step-completion-color); */
    }

    /* Navigation */

/*const cssVariables=[ '
--gbb-navigation-banner-title-color',
'--gbb-navigation-banner-step-text-color',
];*/

}
.gbbNewPageCustomization.gbbProductVariantModalLayoutV2 {
    .gbbProductVariantAddButton{
        background-color: var(--gbb-product-card-button-color);
            color: var(--gbb-product-card-button-text-color);
            border-radius: var(--gbb-product-card-button-border-radius);

    }
    .gbbProductQuantityHTML {
        background-color: var(--gbb-product-card-quantity-selector-bg-color);
        color: var(--gbb-product-card-quantity-selector-text-color);
        border-radius: var(--gbb-product-card-quantity-selector-border-radius);
    }
    .gbbProductQuantityAddButton {
        display: var(--gbb-product-card-allow-only-one-quantity);
        border-radius: var(--gbb-product-card-quantity-selector-border-radius);
    }
    .gbbProductQuantityRemoveButton {
        background-color: var(--gbb-product-card-quantity-selector-btns-bg-color);
        color: var(--gbb-product-card-quantity-selector-button-text-color);
        border-radius: var(--gbb-product-card-quantity-selector-border-radius);
    }
}.gbbGiftMessageV2InputFieldsDiv textarea {
    margin:0px;
    padding: 10px 18px;
    width: 100%;
    border: 1px solid #cccccc;
    /* background-color:#f1f2f3; */
    /* background-color: #ffffff; */
    color: #000000;
    max-width: 100%;
    line-height: 1.2;
    border-radius: 2px;
    padding-bottom: 10px;
    max-height: 170px !important;
    min-height:50px !important;
    border: 1px solid #A2A2A2;
    resize: none;
    width: 100%;
    height: 130px;
    padding: 10px;
    background: none;
}


.gbbGiftMessageV2Divider{
    display: block !important;
    border: 1px solid #A2A2A2 !important;
    height: 0px;
    opacity: 0.5;
 }
.gbbGiftMessageV2Label{
    text-align: left;
    letter-spacing: 0px;
    display: block;
    color: #000000;
    padding-bottom: 10px;
    opacity: 1;
}

.gbbGiftMessageV2{
    display: grid;
    grid-template-rows: 0.6fr;
    grid-gap: 10px;
}
.gbbVideoMessageCheckboxRow{
    display: grid;
    grid-auto-flow: column;
    padding: 5px;
    /* background-color: #f1f2f3; */
}
.gbbVideoMsgCheckboxLabel{
    text-align: left;
    letter-spacing: 0px;
    color: #000000;
}
 .gbbVideoMsgCheckboxWrapper {
    position: relative;
    display: inline-block;
    width: 44px;
    justify-self: end;
    height: 26px;
  }
.gbbVideoMsgCheckboxField { 
  width: 0px;
  height: 0px;
}

.gbbVideoMsgToggle input{ 
    opacity: 0;
    width: 0;
    height: 0;
  }
  
.gbbVideoMsgSlider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #fff;
    border: 1px solid black;    
    -webkit-transition: .4s;
    transition: .4s;
  }
  
 .gbbVideoMsgSlider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 4px;
    bottom: 4px;
    top:2px;
    background-color: white;
    -webkit-transition: .4s;
    transition: .4s;
  }
  
   input:checked + .gbbVideoMsgSlider {
    background-color: black;
  }
  
 input:checked + .gbbVideoMsgSlider:before {
    -webkit-transform: translateX(16px);
    -ms-transform: translateX(16px);
    
    transform: translateX(16px);
  }
  
 
 
  /* Rounded sliders */
  .slider.round, .gbbVideoMsgSlider {
    border-radius: 34px;
  }
  
  .slider.round:before, .gbbVideoMsgSlider:before {
    border-radius: 50%;
    border: 1px solid black;
  }


  /* ============================================================================video message  */
  .gbbVideoPlayerHide {
    display: none !important;
  }

  .gbbVideoMsgPlayerWrapper {
    /* height: 100vh; */
    z-index: 10000000000000;
    display: none;
    align-items: center;
    justify-items: center;
    width: 100%;
    /* position: fixed; */
    top: 30px;
    margin: 10px auto;
  }

  .gbbRecorder {
  
    width: 100%;
    min-height: 250px;
    position: relative;
    border-radius: 2%;
    overflow: hidden;
  }

  .gbbVideoPlayer,
  .gbbVideoPlayerRecording {
    width: 100%;
    height: auto;
  }
 
  .gbbRecorderCloseBtn {
    position: absolute;
    z-index: 1;
    left: 2%;
    top: 5%;
    background: transparent;
    border: none;
    display: none;
  }

  .gbbRecorderCloseBtn img {
    height: 30px;
    width: 30px;
    filter: invert(90%);
    cursor: pointer;
  }

  .gbbVideoPlayerStartBtn,
  .gbbVideoPlayerStopBtn {
    position: absolute;
    bottom: 2%;
    left: 50%;
    transform: translateX(-50%);
    cursor: pointer;
    height: 60px;
    width: 60px;
    border-radius: 50%;
    border: none;
    background-color: transparent;
  }

  .gbbVideoPlayerStartBtn {
    background-color: white;
  }

  .gbbVideoPlayerStopBtn {
    background-color: red;
  }

  .gbbVideoPlayerRedDot,
  .gbbVideoPlayerRedSquare {
    height: 20px;
    width: 20px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  .gbbVideoPlayerRedDot {
    background-color: red;
    border-radius: 50%;
  }

  .gbbVideoPlayerRedSquare {
    background-color: white;
    border-radius: 10%;
  }

  .gbbPermissionDenied {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 16px;
  }

  .gbbVideoPlayerTimeLeft {
    position: absolute;
    bottom: 4%;
    right: 4%;
    color: white;
    font-size: 12px;
    background: black;
    padding: 4px;
    color: white;
    opacity: 0.7;  
  }

  .gbbVideoPlayerStatus {
    position: absolute;
    bottom: 4%;
    left: 4%;
    font-size: 12px;
    padding: 4px;
    background-color: black;
    color: white;
    opacity: 0.7;
  }

  

  .gbbVideoPlayerControls {
    width: 100%;
    text-align: center;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1;
    display: grid;
    /* grid-template-columns: repeat(3, 1fr); */
    justify-content: space-evenly;
    align-items: center;
  }

  .gbbLoadingHeading {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1;
    color: white;
    font-size: 20px;
  }

  .gbbUploadingVideoHeading {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1;
    color: #e3dada;
    font-size: 16px;
    text-align: center;
    line-height: 40px;
  }

  .gbbVideoPlayerControlsAcceptBtnDiv, 
  .gbbVideoPlayerControlsPlayBtnDiv, 
  .gbbVideoPlayerControlsReStartBtnDiv{
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  .gbbVideoPlayerControlsReStartBtnDiv,
  .gbbVideoPlayerControlsAcceptBtnDiv{
    display: none;
  }

  .gbbVideoPlayerControlsBtnDivInfo{
    font-size: 12px;
    color: white;
    margin: 0 0 8px 0; 
  }

  .gbbVideoPlayerControlsAcceptBtn,
  .gbbVideoPlayerControlsPlayBtn,
  .gbbVideoPlayerControlsReStartBtn {
    background-color: transparent;
    height: 90px;
    width: 90px;
    border-radius: 50%;
    cursor: pointer;
    border:0;
    /* margin-right: 20px; */
  }

  old.gbbVideoPlayerControlsAcceptBtn {
    border: 5px solid #3ce669;
  }

  old.gbbVideoPlayerControlsPlayBtn {
    border: 5px solid #d3d3d3;
  }

  old.gbbVideoPlayerControlsReStartBtn {
    border: 5px solid #e03838;
  }

  .gbbVideoPlayerControlsAcceptBtnImg,
  .gbbVideoPlayerControlsPlayBtnImg,
  .gbbVideoPlayerControlsReStartBtnImg {
    height: auto;
    width: 100%;
  }

  old.gbbVideoPlayerControlsAcceptBtnImg {
    filter: invert(69%) sepia(59%) saturate(537%) hue-rotate(80deg) brightness(98%) contrast(93%);
  }

  old.gbbVideoPlayerControlsPlayBtnImg {
    filter: invert(100%) sepia(0) saturate(7500%) hue-rotate(116deg) brightness(80%) contrast(109%);
  }

  old.gbbVideoPlayerControlsReStartBtnImg {
    filter: invert(23%) sepia(77%) saturate(3858%) hue-rotate(348deg) brightness(98%) contrast(80%);
  }

  /* 500px and down */
  @media only screen and (max-width: 600px) {
    .gbbVideoPlayerRecording {
      object-fit: cover;
      height: 100%;
    }
    .gbbRecorder {
      min-height: 36vh;
    }
    .gbbVideoPlayer,
  .gbbVideoPlayerRecording{
    width: 100%;
    object-fit: cover;
    position: absolute;
    height: 100%;
  }
    .gbbVideoPlayerControlsAcceptBtn,
    .gbbVideoPlayerControlsPlayBtn,
    .gbbVideoPlayerControlsReStartBtn {
      height: 50px;
      width: 50px;
    }

    .gbbVideoPlayerControlsAcceptBtnImg,
    .gbbVideoPlayerControlsPlayBtnImg,
    .gbbVideoPlayerControlsReStartBtnImg {
      height: 40px;
      width: 40px;
    }
  }

  /* 350px and down */
  @media only screen and (max-width: 600px) {
    .gbbVideoPlayerStartBtn,
    .gbbVideoPlayerStopBtn {
      height: 40px;
      width: 40px;
    }

    .gbbVideoPlayerRedDot,
    .gbbVideoPlayerRedSquare {
      width: 10px;
      height: 10px;
    }
    .gbbGiftMessageV2InputFieldsDiv textarea {
      height: 80px;
    }

  }
  .gbbGiftCardMessageContent{
    overflow-y:auto;
  }

  
  /* Track */
  .gbbGiftCardMessageContent  ::-webkit-scrollbar-track,.gbbGreetingCardListWrapper ::-webkit-scrollbar-track  {
    background: #f1f1f1; 
  }
   
  /* Handle */
   .gbbGiftCardMessageContent  ::-webkit-scrollbar-thumb,.gbbGreetingCardListWrapper ::-webkit-scrollbar-thumb{
    background: #2c2c2c 0% 0% no-repeat padding-box;
  }



  
  /* Handle on hover */
  .gbbGiftCardMessageContent  ::-webkit-scrollbar-thumb:hover, .gbbGreetingCardListWrapper ::-webkit-scrollbar-thumb:hover {
    background: #000000 0% 0% no-repeat padding-box;
  }

  /* Extra small devices (phones, 600px and down) */
  /* @media only screen and (max-width: 800px) {
    .gbbRecorder {
      width: 375px;
      height: 650px;
      background-color: black;
    }

    .gbbVideoPlayer,
    .gbbVideoPlayerRecording {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .gbbVideoPlayerRecording {
      object-fit: contain;
    }

    .gbbVideoPlayerControls {
      width: 80%;
    }

    .gbbVideoPlayerControlsAcceptBtn,
    .gbbVideoPlayerControlsPlayBtn,
    .gbbVideoPlayerControlsReStartBtn {
      margin-right: 7px;
    }

    .gbbVideoPlayerTimeLeft,
    .gbbVideoPlayerStatus {
      font-size: 18px;
      background-color: rgba(0,0,0,0.2);
      padding: 2px 4px;
    }

  } */


  /* @media only screen and (max-width: 850px) {} */

  /* Small devices (portrait tablets and large phones, 600px and up) */
  /* @media only screen and (min-width: 600px) {} */

  /* Medium devices (landscape tablets, 768px and up) */
  /* @media only screen and (min-width: 768px) {} */

  /* Large devices (laptops/desktops, 992px and up) */
  @media only screen and (min-width: 900px) {
    .gbbRecorder {
      min-height: 180px;
      height: 100%;
    }
    .gbbRecord,.gbbRecorded{
      height: 100%;
    }
    .gbbVideoPlayer, .gbbVideoPlayerRecording{
      width: 100%;
      object-fit: cover;
      height: 100%;
    }
    .gbbVideoMsgPlayerWrapper{
      height: auto;  
    }
   
    .gbbGiftCardMessageContent{
      max-height: 350px;
    } 

  }

  /* Extra large devices (large laptops and desktops, 1200px and up) */
  /* @media only screen and (min-width: 1200px) {}  */


  .giftMessageDeliveryInfo{
    font-size: 12px;
    /* font-style: italic; */
    color: #8c8c8c;    
  }
  
.gbbVideoMsgEmailField{
  margin: 0px;
  padding: 10px 18px;
  /* width: 100%; */
  /* background-color: #ffffff; */
  color: #000000;
  max-width: 100%;
  line-height: 1.2;
  border-radius: 2px;
  padding-bottom: 10px;
  border: 1px solid #A2A2A2;
  font-size: 14px !important;
  background: none;
}



.gbbEmailValidationError{
  color: #ff0000;
  font-size: 14px;
  margin-top: 5px;
}

.gbbVideoMessageHTML{
    height: fit-content;
    /* background: #f1f2f3; */
    /* background-color: white; */
    background: none;
    display: grid;
    grid-gap: 5px;
}


.gbbGreetingCardDropDownWrapper,.gbbGiftWrapDropDownWrapper,
.gbbGiftMessageV2Label,.gbbScheduleDeliveryDateLabel,
.gbbEmailAddressLabelField{
  font-weight: 600;
}</style>
    <style>  </style>
    <style></style>
    <style>.gbbAddProductsPageFooterHTML, .gbbChooseGiftBoxPageFooterHTML, .gbbPersonalizePageFooterHTML, .gbbPrecuratedBoxPageFooterHTML, .gbbMultipleCategoriesPageFooterHTML {
  z-index: 9999999999999999999999999999999;
  margin-bottom: 330px;
}
@media only screen and (max-width: 768px) {
  .gbbAddProductsPageFooterHTML,
  .gbbChooseGiftBoxPageFooterHTML,
  .gbbPersonalizePageFooterHTML,
  .gbbPrecuratedBoxPageFooterHTML,
  .gbbMultipleCategoriesPageFooterHTML {
      z-index: 9999999999999999999999999999999;
      margin-bottom: 25px;
  }
}
.gbbProductImageContainerImg{
       object-fit: contain !important;
}
@media screen and (max-width: 600px){
.gbbProductsItemsContainer {
grid-template-columns: repeat(2,1fr) !important;
}
}
.gbbProductsItemsContainer {
grid-template-columns: repeat(5,1fr);
}
#shopify-section-footer {
  margin-top: 122px;
}
.gbbCartProductsContainerModal {
  z-index: 1000000000000000000000000000;
}
.gbbCategoryContainer.gbbCategoryContainerTabUI.gbbCategoryContainerTabUIActive {
  background-color: #A5C02F !important;
  color: #F6F6F6 !important;
}
@media (max-width: 768px) {
  .gbbFooterButtonsWrapper {
      display: flex !important;
      justify-content: center !important;
  }
}
.gbbMutipleCategoriesDropdown {
  color: white;
  background-color: #87B138;
  padding: 10px;
  border-radius: 4px;
}


@media only screen and (max-width: 768px) {
  .gbbProductsCardLayoutV2 .gbbCartIconWithQuantityContainer {
      position: absolute;
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      padding: 2px 14px;
      border-radius: 10px;
      font-size: 14px;
      align-items: center;
  }
}



.gbbMultipleCategoriesRibbonContainer {
padding: 21px 15px;
place-content: start;
flex-wrap: wrap;
grid-gap: 10px;
overflow-x: auto;
top: 0;
z-index: 2;
margin-bottom: 100px;
}
.gbbFooterProductImageContainer{
background: none;
border:none;
}
.gbbProductsCardLayoutV2 .gbbFooterBackButton, .gbbProductsCardLayoutV2 .gbbFooterNextButton{
border-radius: 0px;
}
.gbbProductsCardLayoutV2 .gbbProductAddButton {
border-radius: 0px;
}
.gbbProductsCardLayoutV2 .gbbProductQuantityHTML, .gbbProductVariantModalLayoutV2 .gbbProductQuantityHTML,.gbbProductsCardLayoutV2 .gbbProductQuantityRemoveButton, .gbbProductsCardLayoutV2 .gbbProductQuantityAddButton{
color: #000000 !important;
background: #A5C02F !important;
border-radius: 0px;
font-weight: bold;
}
@media screen and (min-width: 1240px) {
.gbbMultipleCategoriesRibbonContainer {
  display: flex;
}
}
.gbbProductsCardLayoutV2 .gbbProductItem {
background: white;
padding: 8px;
grid-gap: inherit;
border: 2px solid black;
}
.gbbProductImageContainer {
position: relative;
cursor: pointer;
-webkit-tap-highlight-color: transparent;
top: -73px;
}
.gbbProductAddButton {
-webkit-tap-highlight-color: transparent;
padding: 10px;
width: 100%;
background: #000000;
color: #FFFFFF;
border: none;
font-size: 14px;
cursor: pointer;
text-align: center;
}
.gbbProductAddButton {
-webkit-tap-highlight-color: transparent;
padding: 10px;
width: 100%;
background: #000000;
color: #FFFFFF;
cursor: pointer;
text-align: center;
font-style: italic;
line-height: 28.4px;
}
.gbbProductsItemsContainer {
grid-template-columns: repeat(4, 1fr);
}
.gbbProductsCardLayoutV2 .gbbProductItem {
background: white;
padding: 8px;
grid-gap: 5px;
border-radius: 0px;
border: 2px solid black;
background: white !important;
}
.gbbProductsItemsContainer {
grid-template-columns: repeat(4, 1fr);
row-gap: 100px;
}
.gbbProductItem {
display: grid;
grid-template-rows: 151px 105px 49px;
background: #F1F2F3;
/* padding: 10px; */
position: relative;
box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
transition: all 0.3s cubic-bezier(.25, .8, .25, 1);
}
.gbbProductsCardLayoutV2 .gbbProductImageContainer {
border-radius: 0px;
overflow: hidden;
height: 253px;
}
.gbbProductImageContainerImg {
background: transparent;
}
@media only screen and (max-width: 768px) {
.gbbMultipleCategoryBody {
  margin-top: 100px;
  /* Adjust the value as needed for mobile */
}
}
@media screen and (max-width: 767px) {
.gbbProductItem {
  grid-template-rows: 69px 60px 60px;
}
.gbbProductsCardLayoutV2 .gbbProductImageContainer {
  border-radius: 0px;
  overflow: hidden;
  height: 145px;
}
}
.gbbCategoryContainer.gbbCategoryContainerTabUI, .gbbMutipleCategoriesDropdown {
border-radius: 0px;
border: 2px solid #000000 !important;
}
.gbbCategoryHeaderContainerTabUI.gbbCategoryHeaderContainer{
font-style: italic !important;
}
.gbbProductsCardLayoutV2 .gbbFooterBackButton{
border: 2px solid #ffffff !important;
}
.gbbProductsCardLayoutV2 .gbbFooterTotalLabel, .gbbFooterTotalValue{
color: #A5C02F !important;
}
.gbbAddProductsPageFooterHTML{
border-top: none;
}
.gbbNavigationStepImgContainer{
background: #E7EBD1;
border: 2px solid black !important;
}
.gbbNavigationStepImgContainerActive{
background: #A5C02F !important;
border: 2px solid black !important;
}
.gbbProductItemOverLay {
display: none !important;
}
.gbbProductItemOverLay{
position: unset;
background-color: unset;
transition: unset;
}
.gbbProductVariantModalContentContainer .gbbProductImageContainerImg{
max-height: 100%;
}
.gbbProductVariantModalBodyContainer .gbbProductImageContainer {
top: 0px;
}
.gbbProductVariantAddButton, .gbbProductQuantityRemoveButton, .gbbProductQuantityAddButton{
border-radius: 0px;
}
.gbbProductQuantityRemoveButton, .gbbProductQuantityAddButton{
background: #A5C02F !important;
color: black !important;
}
.gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbFooterProductImageContainer{
border-radius: 0px;
}
.gbbFooterProductRemoveButtonIcon svg{
fill: #A5C02F;
}
.gbbFooterProductTitle{
font-weight: bold !important;
font-style: italic;
}
.gbbFooterProductPrice{
font-weight: normal;
}
.gbbCartQuantity{
font-weight: bold;
}
.shopify-section-footer {
  opacity: 0;
  visibility: hidden;
  transition: opacity 1s ease-in, visibility 0s linear 3s;
}
.gbbMultipleCategoriesRibbonContainer{
margin-bottom: 0px;
}
.gbbMultipleCategoriesDropdownContainer{
    display: none;
  }

  .gbbMultipleCategoriesRibbonContainer{
    display: flex;
  }
@media screen and (min-width: 1024px) {
  .gbbMultipleCategoriesActiveCategorySubtitle {
      margin-bottom: 60px;
  }
}
.gbbFade {
animation-name: gbbSlideAbove;
animation-duration: 0.4s;
}

@keyframes gbbSlideAbove {
from {
  transform: translateY(100%);
  opacity: 0.4;
} 
to {
  transform: translateY(0);
  opacity: 1;
}
}
.gbbProductsCardLayoutV2 .gbbCartIconWithQuantityContainer{
border-radius: 20px;
}
.gbbCartQuantity{
font-size: large;
}
.gbbProductsCardLayoutV2 .gbbCartIconWithQuantityContainer>svg{
height: 30px;
}
.gbbProductsCardLayoutV2 .showBoxProductsInFooter{
padding-top: 14px;
}
@media screen and (max-width: 767px){
.gbbProductsCardLayoutV2 .gbbProductImageContainer {
   height: 185px;
   padding-bottom: 10px;
}
.gbbProductTitleOnly{
font-size: 14px !important;
}
}
.gbbProductsCardLayoutV2 .gbbDiscountFooterHTML {
    padding-top: 15px;
}
.gbbDiscountMessage{
color: white !important;
}
.gbbAddProductPageSubtext{
padding-bottom: 40px;
}
.gbbProductsCardLayoutV2 .gbbProductQuantityHTML, .gbbProductVariantModalLayoutV2 .gbbProductQuantityHTML, .gbbProductsCardLayoutV2 .gbbProductQuantityRemoveButton, .gbbProductsCardLayoutV2 .gbbProductQuantityAddButton{
border-radius: 0px !important;
}
.gbbProductQuantityHTML{
border-radius: 0px;
}
@media (max-width: 600px) {
    .gbbMobileImageBanner{
padding-bottom: 30px;
}
}

.gbbMultipleCategoriesActiveCategorySubtitle {

text-align: center;

}</style>
    <script>  </script>
    <style>  </style>
    <script>
      if (!gbb.state.bundleId){
        gbb.state.bundleId = "5";
      }
    </script>
    <style>
    .gbbLoadingScreen{
    user-select: none;
    z-index: 1;
    /* background: #fff; */
    position: unset;
    top: 0;
    left: 0;
    width: 100%;
    height: 1000px;
    display: grid;
    justify-content: center;
    align-items: center;
    }</style>
        </main><div id="shopify-section-footer-promotions" class="shopify-section index-section--footer">
</div><div id="shopify-section-footer" class="shopify-section"><div class="ie__seperator">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none">
    <path d="M1200 120L0 16.48 0 0 1200 0 1200 120z" class="shape-fill"></path>
  </svg>
</div>
<footer class="site-footer" data-section-id="footer" data-section-type="footer">
  <div class="page-width">
    <div class="grid"><style data-shopify="">@media only screen and (min-width: 769px) {
            .footer__item--2a546a73-92bb-4210-af32-045cf284b478 {
              width: 60%;
            }
          }</style><div class="grid__item footer__item--2a546a73-92bb-4210-af32-045cf284b478"><div class="footer__logo-social"><span>Folge uns auf</span>
  <ul class="no-bullets social-icons footer__social"><li>
      <a target="_blank" rel="noopener" href="https://www.instagram.com/infused.energy/?hl=de" title="Infused energy auf Instagram" class="js-no-transition">
        <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-instagram" viewBox="0 0 32 32"><path fill="#444" d="M16 3.094c4.206 0 4.7.019 6.363.094 1.538.069 2.369.325 2.925.544.738.287 1.262.625 1.813 1.175s.894 1.075 1.175 1.813c.212.556.475 1.387.544 2.925.075 1.662.094 2.156.094 6.363s-.019 4.7-.094 6.363c-.069 1.538-.325 2.369-.544 2.925-.288.738-.625 1.262-1.175 1.813s-1.075.894-1.813 1.175c-.556.212-1.387.475-2.925.544-1.663.075-2.156.094-6.363.094s-4.7-.019-6.363-.094c-1.537-.069-2.369-.325-2.925-.544-.737-.288-1.263-.625-1.813-1.175s-.894-1.075-1.175-1.813c-.212-.556-.475-1.387-.544-2.925-.075-1.663-.094-2.156-.094-6.363s.019-4.7.094-6.363c.069-1.537.325-2.369.544-2.925.287-.737.625-1.263 1.175-1.813s1.075-.894 1.813-1.175c.556-.212 1.388-.475 2.925-.544 1.662-.081 2.156-.094 6.363-.094zm0-2.838c-4.275 0-4.813.019-6.494.094-1.675.075-2.819.344-3.819.731-1.037.4-1.913.944-2.788 1.819S1.486 4.656 1.08 5.688c-.387 1-.656 2.144-.731 3.825-.075 1.675-.094 2.213-.094 6.488s.019 4.813.094 6.494c.075 1.675.344 2.819.731 3.825.4 1.038.944 1.913 1.819 2.788s1.756 1.413 2.788 1.819c1 .387 2.144.656 3.825.731s2.213.094 6.494.094 4.813-.019 6.494-.094c1.675-.075 2.819-.344 3.825-.731 1.038-.4 1.913-.944 2.788-1.819s1.413-1.756 1.819-2.788c.387-1 .656-2.144.731-3.825s.094-2.212.094-6.494-.019-4.813-.094-6.494c-.075-1.675-.344-2.819-.731-3.825-.4-1.038-.944-1.913-1.819-2.788s-1.756-1.413-2.788-1.819c-1-.387-2.144-.656-3.825-.731C20.812.275 20.275.256 16 .256z"></path><path fill="#444" d="M16 7.912a8.088 8.088 0 0 0 0 16.175c4.463 0 8.087-3.625 8.087-8.088s-3.625-8.088-8.088-8.088zm0 13.338a5.25 5.25 0 1 1 0-10.5 5.25 5.25 0 1 1 0 10.5zM26.294 7.594a1.887 1.887 0 1 1-3.774.002 1.887 1.887 0 0 1 3.774-.003z"></path></svg>
        <span class="icon__fallback-text">Instagram</span>
      </a>
    </li><li>
      <a target="_blank" rel="noopener" href="https://www.facebook.com/infusedenergyDE" title="Infused energy auf Facebook" class="js-no-transition">
        <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-facebook" viewBox="0 0 14222 14222"><path d="M14222 7112c0 3549.352-2600.418 6491.344-6000 7024.72V9168h1657l315-2056H8222V5778c0-562 275-1111 1159-1111h897V2917s-814-139-1592-139c-1624 0-2686 984-2686 2767v1567H4194v2056h1806v4968.72C2600.418 13603.344 0 10661.352 0 7112 0 3184.703 3183.703 1 7111 1s7111 3183.703 7111 7111zm-8222 7025c362 57 733 86 1111 86-377.945 0-749.003-29.485-1111-86.28zm2222 0v-.28a7107.458 7107.458 0 0 1-167.717 24.267A7407.158 7407.158 0 0 0 8222 14137zm-167.717 23.987C7745.664 14201.89 7430.797 14223 7111 14223c319.843 0 634.675-21.479 943.283-62.013z"></path></svg>
        <span class="icon__fallback-text">Facebook</span>
      </a>
    </li><li>
      <a target="_blank" rel="noopener" href="https://www.youtube.com/channel/UCoPCBmF79qQiOSyGhFw0HyQ" title="Infused energy auf YouTube" class="js-no-transition">
        <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-youtube" viewBox="0 0 21 20"><path fill="#444" d="M-.196 15.803q0 1.23.812 2.092t1.977.861h14.946q1.165 0 1.977-.861t.812-2.092V3.909q0-1.23-.82-2.116T17.539.907H2.593q-1.148 0-1.969.886t-.82 2.116v11.894zm7.465-2.149V6.058q0-.115.066-.18.049-.016.082-.016l.082.016 7.153 3.806q.066.066.066.164 0 .066-.066.131l-7.153 3.806q-.033.033-.066.033-.066 0-.098-.033-.066-.066-.066-.131z"></path></svg>
        <span class="icon__fallback-text">YouTube</span>
      </a>
    </li><li>
      <a target="_blank" rel="noopener" href="https://www.tiktok.com/@infused.energy?lang=de-DE" title="Infused energy auf TikTok" class="js-no-transition">
        <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-tiktok" viewBox="0 0 2859 3333"><path d="M2081 0c55 473 319 755 778 785v532c-266 26-499-61-770-225v995c0 1264-1378 1659-1932 753-356-583-138-1606 1004-1647v561c-87 14-180 36-265 65-254 86-398 247-358 531 77 544 1075 705 992-358V1h551z"></path></svg>
        <span class="icon__fallback-text">TikTok</span>
      </a>
    </li></ul>

</div>
</div><style data-shopify="">@media only screen and (min-width: 769px) {
            .footer__item--eed96166-a699-47f6-a26c-02f05d8c7bc3 {
              width: 40%;
            }
          }</style><div class="grid__item grid-newsletter footer__item--eed96166-a699-47f6-a26c-02f05d8c7bc3">
  <p class="footer__title small--hide footer__newsletter-title ">BLEIB AUF DEM LAUFENDEN UND SICHERE DIR EINEN 15 % GUTSCHEIN</p>
  <button type="button" class="footer__title collapsible-trigger collapsible-trigger-btn medium-up--hide" aria-controls="Footer-eed96166-a699-47f6-a26c-02f05d8c7bc3" aria-expanded="false">
    BLEIB AUF DEM LAUFENDEN UND SICHERE DIR EINEN 15 % GUTSCHEIN
<span class="collapsible-trigger__icon collapsible-trigger__icon--open" role="presentation">
  <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon--wide icon-chevron-down" viewBox="0 0 28 16"><path d="M1.57 1.59l12.76 12.77L27.1 1.59" stroke-width="2" stroke="#000" fill="none" fill-rule="evenodd"></path></svg>
</span>
</button>

<div id="Footer-eed96166-a699-47f6-a26c-02f05d8c7bc3" class="collapsible-content collapsible-content--small is-open">
  <div class="collapsible-content__inner">
    <div class="footer__collapsible footer_collapsible--disabled">
      
        <p>Melde dich hier zu unserem Newsletter an und erhalte als Dankeschön einen 15 % Gutschein</p>
      

      <script src="./Infused energy_files/popup.js.download" async=""></script>

      <button class="rm-open-popup footer__newsletter-modal">Newsletter abonnieren</button>

      
    </div>
  </div>
</div>
</div><style data-shopify="">@media only screen and (min-width: 769px) {
            .footer__item--b8e5715f-76e3-41d8-8ed5-465552caed7e {
              width: 95%;
            }
          }</style><div class="footer__clear small--hide"></div><div class="grid__item footer__item--b8e5715f-76e3-41d8-8ed5-465552caed7e">
  
  <div>
    <div class="collapsible-content__inner">
      <div class="footer__collapsible footer_collapsible--disabled">
        <ul class="no-bullets site-footer__linklist"><li><a href="https://infusedenergy.shop/pages/newsletter">NEWSLETTER</a></li><li><a href="https://infusedenergy.shop/search">Suchen</a></li><li><a href="https://infusedenergy.shop/pages/impressum">Impressum</a></li><li><a href="https://infusedenergy.shop/pages/datenschutz">Datenschutz</a></li><li><a href="https://infusedenergy.shop/pages/widerrufsbelehrung-und-formular">Widerrufsbelehrung und -Formular</a></li><li><a href="https://infusedenergy.shop/pages/liefer-und-zahlungsbedingungen">Liefer- und Zahlungsbedingungen</a></li><li><a href="https://infusedenergy.shop/pages/cookie-richtlinie">Cookie Richtlinie</a></li><li><a href="https://infusedenergy.shop/pages/datenschutz-fur-social-media-auftritte">Datenschutz für Social Media Auftritte</a></li><li><a href="https://infusedenergy.shop/pages/agb-1">AGB</a></li><li><a href="https://infusedenergy.shop/policies/terms-of-service">Terms of service</a></li><li><a href="https://infusedenergy.shop/policies/refund-policy">Refund policy</a></li><li><a href="https://infusedenergy.shop/apps/gbb/easybundle/5?page=addProductsPage1&amp;currentFlow=byob#uc-corner-modal-show" class="js-no-transition">Cookie Einstellungen</a></li><li><a href="https://infusedenergy.shop/pages/data-sale-opt-out-1">Do not sell or share my personal information</a></li><li><a href="https://infusedenergy.shop/pages/data-sale-opt-out-1">Meine personenbezogenen Daten nicht verkaufen oder weitergeben</a></li></ul>
      </div>
    </div>
  </div>

</div></div>

    <div class="site-footer__bottom"><ul class="inline-list payment-icons site-footer__bottom-block payment-icons--greyscale text-center"><li class="icon--payment">
                <svg xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="pi-american_express" viewBox="0 0 38 24" width="38" height="24"><title id="pi-american_express">American Express</title><path fill="#000" d="M35 0H3C1.3 0 0 1.3 0 3v18c0 1.7 1.4 3 3 3h32c1.7 0 3-1.3 3-3V3c0-1.7-1.4-3-3-3Z" opacity=".07"></path><path fill="#006FCF" d="M35 1c1.1 0 2 .9 2 2v18c0 1.1-.9 2-2 2H3c-1.1 0-2-.9-2-2V3c0-1.1.9-2 2-2h32Z"></path><path fill="#FFF" d="M22.012 19.936v-8.421L37 11.528v2.326l-1.732 1.852L37 17.573v2.375h-2.766l-1.47-1.622-1.46 1.628-9.292-.02Z"></path><path fill="#006FCF" d="M23.013 19.012v-6.57h5.572v1.513h-3.768v1.028h3.678v1.488h-3.678v1.01h3.768v1.531h-5.572Z"></path><path fill="#006FCF" d="m28.557 19.012 3.083-3.289-3.083-3.282h2.386l1.884 2.083 1.89-2.082H37v.051l-3.017 3.23L37 18.92v.093h-2.307l-1.917-2.103-1.898 2.104h-2.321Z"></path><path fill="#FFF" d="M22.71 4.04h3.614l1.269 2.881V4.04h4.46l.77 2.159.771-2.159H37v8.421H19l3.71-8.421Z"></path><path fill="#006FCF" d="m23.395 4.955-2.916 6.566h2l.55-1.315h2.98l.55 1.315h2.05l-2.904-6.566h-2.31Zm.25 3.777.875-2.09.873 2.09h-1.748Z"></path><path fill="#006FCF" d="M28.581 11.52V4.953l2.811.01L32.84 9l1.456-4.046H37v6.565l-1.74.016v-4.51l-1.644 4.494h-1.59L30.35 7.01v4.51h-1.768Z"></path></svg>

              </li><li class="icon--payment">
                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" role="img" x="0" y="0" width="38" height="24" viewBox="0 0 165.521 105.965" xml:space="preserve" aria-labelledby="pi-apple_pay"><title id="pi-apple_pay">Apple Pay</title><path fill="#000" d="M150.698 0H14.823c-.566 0-1.133 0-1.698.003-.477.004-.953.009-1.43.022-1.039.028-2.087.09-3.113.274a10.51 10.51 0 0 0-2.958.975 9.932 9.932 0 0 0-4.35 4.35 10.463 10.463 0 0 0-.975 2.96C.113 9.611.052 10.658.024 11.696a70.22 70.22 0 0 0-.022 1.43C0 13.69 0 14.256 0 14.823v76.318c0 .567 0 1.132.002 1.699.003.476.009.953.022 1.43.028 1.036.09 2.084.275 3.11a10.46 10.46 0 0 0 .974 2.96 9.897 9.897 0 0 0 1.83 2.52 9.874 9.874 0 0 0 2.52 1.83c.947.483 1.917.79 2.96.977 1.025.183 2.073.245 3.112.273.477.011.953.017 1.43.02.565.004 1.132.004 1.698.004h135.875c.565 0 1.132 0 1.697-.004.476-.002.952-.009 1.431-.02 1.037-.028 2.085-.09 3.113-.273a10.478 10.478 0 0 0 2.958-.977 9.955 9.955 0 0 0 4.35-4.35c.483-.947.789-1.917.974-2.96.186-1.026.246-2.074.274-3.11.013-.477.02-.954.022-1.43.004-.567.004-1.132.004-1.699V14.824c0-.567 0-1.133-.004-1.699a63.067 63.067 0 0 0-.022-1.429c-.028-1.038-.088-2.085-.274-3.112a10.4 10.4 0 0 0-.974-2.96 9.94 9.94 0 0 0-4.35-4.35A10.52 10.52 0 0 0 156.939.3c-1.028-.185-2.076-.246-3.113-.274a71.417 71.417 0 0 0-1.431-.022C151.83 0 151.263 0 150.698 0z"></path><path fill="#FFF" d="M150.698 3.532l1.672.003c.452.003.905.008 1.36.02.793.022 1.719.065 2.583.22.75.135 1.38.34 1.984.648a6.392 6.392 0 0 1 2.804 2.807c.306.6.51 1.226.645 1.983.154.854.197 1.783.218 2.58.013.45.019.9.02 1.36.005.557.005 1.113.005 1.671v76.318c0 .558 0 1.114-.004 1.682-.002.45-.008.9-.02 1.35-.022.796-.065 1.725-.221 2.589a6.855 6.855 0 0 1-.645 1.975 6.397 6.397 0 0 1-2.808 2.807c-.6.306-1.228.511-1.971.645-.881.157-1.847.2-2.574.22-.457.01-.912.017-1.379.019-.555.004-1.113.004-1.669.004H14.801c-.55 0-1.1 0-1.66-.004a74.993 74.993 0 0 1-1.35-.018c-.744-.02-1.71-.064-2.584-.22a6.938 6.938 0 0 1-1.986-.65 6.337 6.337 0 0 1-1.622-1.18 6.355 6.355 0 0 1-1.178-1.623 6.935 6.935 0 0 1-.646-1.985c-.156-.863-.2-1.788-.22-2.578a66.088 66.088 0 0 1-.02-1.355l-.003-1.327V14.474l.002-1.325a66.7 66.7 0 0 1 .02-1.357c.022-.792.065-1.717.222-2.587a6.924 6.924 0 0 1 .646-1.981c.304-.598.7-1.144 1.18-1.623a6.386 6.386 0 0 1 1.624-1.18 6.96 6.96 0 0 1 1.98-.646c.865-.155 1.792-.198 2.586-.22.452-.012.905-.017 1.354-.02l1.677-.003h135.875"></path><g><g><path fill="#000" d="M43.508 35.77c1.404-1.755 2.356-4.112 2.105-6.52-2.054.102-4.56 1.355-6.012 3.112-1.303 1.504-2.456 3.959-2.156 6.266 2.306.2 4.61-1.152 6.063-2.858"></path><path fill="#000" d="M45.587 39.079c-3.35-.2-6.196 1.9-7.795 1.9-1.6 0-4.049-1.8-6.698-1.751-3.447.05-6.645 2-8.395 5.1-3.598 6.2-.95 15.4 2.55 20.45 1.699 2.5 3.747 5.25 6.445 5.151 2.55-.1 3.549-1.65 6.647-1.65 3.097 0 3.997 1.65 6.696 1.6 2.798-.05 4.548-2.5 6.247-5 1.95-2.85 2.747-5.6 2.797-5.75-.05-.05-5.396-2.101-5.446-8.251-.05-5.15 4.198-7.6 4.398-7.751-2.399-3.548-6.147-3.948-7.447-4.048"></path></g><g><path fill="#000" d="M78.973 32.11c7.278 0 12.347 5.017 12.347 12.321 0 7.33-5.173 12.373-12.529 12.373h-8.058V69.62h-5.822V32.11h14.062zm-8.24 19.807h6.68c5.07 0 7.954-2.729 7.954-7.46 0-4.73-2.885-7.434-7.928-7.434h-6.706v14.894z"></path><path fill="#000" d="M92.764 61.847c0-4.809 3.665-7.564 10.423-7.98l7.252-.442v-2.08c0-3.04-2.001-4.704-5.562-4.704-2.938 0-5.07 1.507-5.51 3.82h-5.252c.157-4.86 4.731-8.395 10.918-8.395 6.654 0 10.995 3.483 10.995 8.89v18.663h-5.38v-4.497h-.13c-1.534 2.937-4.914 4.782-8.579 4.782-5.406 0-9.175-3.222-9.175-8.057zm17.675-2.417v-2.106l-6.472.416c-3.64.234-5.536 1.585-5.536 3.95 0 2.288 1.975 3.77 5.068 3.77 3.95 0 6.94-2.522 6.94-6.03z"></path><path fill="#000" d="M120.975 79.652v-4.496c.364.051 1.247.103 1.715.103 2.573 0 4.029-1.09 4.913-3.899l.52-1.663-9.852-27.293h6.082l6.863 22.146h.13l6.862-22.146h5.927l-10.216 28.67c-2.34 6.577-5.017 8.735-10.683 8.735-.442 0-1.872-.052-2.261-.157z"></path></g></g></svg>

              </li><li class="icon--payment">
                <svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 38 24" width="38" height="24" aria-labelledby="pi-google_pay"><title id="pi-google_pay">Google Pay</title><path d="M35 0H3C1.3 0 0 1.3 0 3v18c0 1.7 1.4 3 3 3h32c1.7 0 3-1.3 3-3V3c0-1.7-1.4-3-3-3z" fill="#000" opacity=".07"></path><path d="M35 1c1.1 0 2 .9 2 2v18c0 1.1-.9 2-2 2H3c-1.1 0-2-.9-2-2V3c0-1.1.9-2 2-2h32" fill="#FFF"></path><path d="M18.093 11.976v3.2h-1.018v-7.9h2.691a2.447 2.447 0 0 1 1.747.692 2.28 2.28 0 0 1 .11 3.224l-.11.116c-.47.447-1.098.69-1.747.674l-1.673-.006zm0-3.732v2.788h1.698c.377.012.741-.135 1.005-.404a1.391 1.391 0 0 0-1.005-2.354l-1.698-.03zm6.484 1.348c.65-.03 1.286.188 1.778.613.445.43.682 1.03.65 1.649v3.334h-.969v-.766h-.049a1.93 1.93 0 0 1-1.673.931 2.17 2.17 0 0 1-1.496-.533 1.667 1.667 0 0 1-.613-1.324 1.606 1.606 0 0 1 .613-1.336 2.746 2.746 0 0 1 1.698-.515c.517-.02 1.03.093 1.49.331v-.208a1.134 1.134 0 0 0-.417-.901 1.416 1.416 0 0 0-.98-.368 1.545 1.545 0 0 0-1.319.717l-.895-.564a2.488 2.488 0 0 1 2.182-1.06zM23.29 13.52a.79.79 0 0 0 .337.662c.223.176.5.269.785.263.429-.001.84-.17 1.146-.472.305-.286.478-.685.478-1.103a2.047 2.047 0 0 0-1.324-.374 1.716 1.716 0 0 0-1.03.294.883.883 0 0 0-.392.73zm9.286-3.75l-3.39 7.79h-1.048l1.281-2.728-2.224-5.062h1.103l1.612 3.885 1.569-3.885h1.097z" fill="#5F6368"></path><path d="M13.986 11.284c0-.308-.024-.616-.073-.92h-4.29v1.747h2.451a2.096 2.096 0 0 1-.9 1.373v1.134h1.464a4.433 4.433 0 0 0 1.348-3.334z" fill="#4285F4"></path><path d="M9.629 15.721a4.352 4.352 0 0 0 3.01-1.097l-1.466-1.14a2.752 2.752 0 0 1-4.094-1.44H5.577v1.17a4.53 4.53 0 0 0 4.052 2.507z" fill="#34A853"></path><path d="M7.079 12.05a2.709 2.709 0 0 1 0-1.735v-1.17H5.577a4.505 4.505 0 0 0 0 4.075l1.502-1.17z" fill="#FBBC04"></path><path d="M9.629 8.44a2.452 2.452 0 0 1 1.74.68l1.3-1.293a4.37 4.37 0 0 0-3.065-1.183 4.53 4.53 0 0 0-4.027 2.5l1.502 1.171a2.715 2.715 0 0 1 2.55-1.875z" fill="#EA4335"></path></svg>

              </li><li class="icon--payment">
                <svg xmlns="http://www.w3.org/2000/svg" role="img" width="38" height="24" viewBox="0 0 38 24" aria-labelledby="pi-klarna"><title id="pi-klarna">Klarna</title><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path d="M35 0H3C1.3 0 0 1.3 0 3v18c0 1.7 1.4 3 3 3h32c1.7 0 3-1.3 3-3V3c0-1.7-1.4-3-3-3z" fill="#FFB3C7"></path><path d="M35 1c1.1 0 2 .9 2 2v18c0 1.1-.9 2-2 2H3c-1.1 0-2-.9-2-2V3c0-1.1.9-2 2-2h32" fill="#FFB3C7"></path><path d="M34.117 13.184c-.487 0-.882.4-.882.892 0 .493.395.893.882.893.488 0 .883-.4.883-.893a.888.888 0 00-.883-.892zm-2.903-.69c0-.676-.57-1.223-1.274-1.223-.704 0-1.274.547-1.274 1.222 0 .675.57 1.223 1.274 1.223.704 0 1.274-.548 1.274-1.223zm.005-2.376h1.406v4.75h-1.406v-.303a2.446 2.446 0 01-1.394.435c-1.369 0-2.478-1.122-2.478-2.507 0-1.384 1.11-2.506 2.478-2.506.517 0 .996.16 1.394.435v-.304zm-11.253.619v-.619h-1.44v4.75h1.443v-2.217c0-.749.802-1.15 1.359-1.15h.016v-1.382c-.57 0-1.096.247-1.378.618zm-3.586 1.756c0-.675-.57-1.222-1.274-1.222-.703 0-1.274.547-1.274 1.222 0 .675.57 1.223 1.274 1.223.704 0 1.274-.548 1.274-1.223zm.005-2.375h1.406v4.75h-1.406v-.303A2.446 2.446 0 0114.99 15c-1.368 0-2.478-1.122-2.478-2.507 0-1.384 1.11-2.506 2.478-2.506.517 0 .997.16 1.394.435v-.304zm8.463-.128c-.561 0-1.093.177-1.448.663v-.535H22v4.75h1.417v-2.496c0-.722.479-1.076 1.055-1.076.618 0 .973.374.973 1.066v2.507h1.405v-3.021c0-1.106-.87-1.858-2.002-1.858zM10.465 14.87h1.472V8h-1.472v6.868zM4 14.87h1.558V8H4v6.87zM9.45 8a5.497 5.497 0 01-1.593 3.9l2.154 2.97H8.086l-2.341-3.228.604-.458A3.96 3.96 0 007.926 8H9.45z" fill="#0A0B09" fill-rule="nonzero"></path></g></svg>
              </li><li class="icon--payment">
                <svg viewBox="0 0 38 24" xmlns="http://www.w3.org/2000/svg" width="38" height="24" role="img" aria-labelledby="pi-maestro"><title id="pi-maestro">Maestro</title><path opacity=".07" d="M35 0H3C1.3 0 0 1.3 0 3v18c0 1.7 1.4 3 3 3h32c1.7 0 3-1.3 3-3V3c0-1.7-1.4-3-3-3z"></path><path fill="#fff" d="M35 1c1.1 0 2 .9 2 2v18c0 1.1-.9 2-2 2H3c-1.1 0-2-.9-2-2V3c0-1.1.9-2 2-2h32"></path><circle fill="#EB001B" cx="15" cy="12" r="7"></circle><circle fill="#00A2E5" cx="23" cy="12" r="7"></circle><path fill="#7375CF" d="M22 12c0-2.4-1.2-4.5-3-5.7-1.8 1.3-3 3.4-3 5.7s1.2 4.5 3 5.7c1.8-1.2 3-3.3 3-5.7z"></path></svg>
              </li><li class="icon--payment">
                <svg viewBox="0 0 38 24" xmlns="http://www.w3.org/2000/svg" role="img" width="38" height="24" aria-labelledby="pi-master"><title id="pi-master">Mastercard</title><path opacity=".07" d="M35 0H3C1.3 0 0 1.3 0 3v18c0 1.7 1.4 3 3 3h32c1.7 0 3-1.3 3-3V3c0-1.7-1.4-3-3-3z"></path><path fill="#fff" d="M35 1c1.1 0 2 .9 2 2v18c0 1.1-.9 2-2 2H3c-1.1 0-2-.9-2-2V3c0-1.1.9-2 2-2h32"></path><circle fill="#EB001B" cx="15" cy="12" r="7"></circle><circle fill="#F79E1B" cx="23" cy="12" r="7"></circle><path fill="#FF5F00" d="M22 12c0-2.4-1.2-4.5-3-5.7-1.8 1.3-3 3.4-3 5.7s1.2 4.5 3 5.7c1.8-1.2 3-3.3 3-5.7z"></path></svg>
              </li><li class="icon--payment">
                <svg viewBox="0 0 38 24" xmlns="http://www.w3.org/2000/svg" width="38" height="24" role="img" aria-labelledby="pi-paypal"><title id="pi-paypal">PayPal</title><path opacity=".07" d="M35 0H3C1.3 0 0 1.3 0 3v18c0 1.7 1.4 3 3 3h32c1.7 0 3-1.3 3-3V3c0-1.7-1.4-3-3-3z"></path><path fill="#fff" d="M35 1c1.1 0 2 .9 2 2v18c0 1.1-.9 2-2 2H3c-1.1 0-2-.9-2-2V3c0-1.1.9-2 2-2h32"></path><path fill="#003087" d="M23.9 8.3c.2-1 0-1.7-.6-2.3-.6-.7-1.7-1-3.1-1h-4.1c-.3 0-.5.2-.6.5L14 15.6c0 .2.1.4.3.4H17l.4-3.4 1.8-2.2 4.7-2.1z"></path><path fill="#3086C8" d="M23.9 8.3l-.2.2c-.5 2.8-2.2 3.8-4.6 3.8H18c-.3 0-.5.2-.6.5l-.6 3.9-.2 1c0 .2.1.4.3.4H19c.3 0 .5-.2.5-.4v-.1l.4-2.4v-.1c0-.2.3-.4.5-.4h.3c2.1 0 3.7-.8 4.1-3.2.2-1 .1-1.8-.4-2.4-.1-.5-.3-.7-.5-.8z"></path><path fill="#012169" d="M23.3 8.1c-.1-.1-.2-.1-.3-.1-.1 0-.2 0-.3-.1-.3-.1-.7-.1-1.1-.1h-3c-.1 0-.2 0-.2.1-.2.1-.3.2-.3.4l-.7 4.4v.1c0-.3.3-.5.6-.5h1.3c2.5 0 4.1-1 4.6-3.8v-.2c-.1-.1-.3-.2-.5-.2h-.1z"></path></svg>
              </li><li class="icon--payment">
                <svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 38 24" width="38" height="24" aria-labelledby="pi-shopify_pay"><title id="pi-shopify_pay">Shop Pay</title><path opacity=".07" d="M35 0H3C1.3 0 0 1.3 0 3v18c0 1.7 1.4 3 3 3h32c1.7 0 3-1.3 3-3V3c0-1.7-1.4-3-3-3z" fill="#000"></path><path d="M35.889 0C37.05 0 38 .982 38 2.182v19.636c0 1.2-.95 2.182-2.111 2.182H2.11C.95 24 0 23.018 0 21.818V2.182C0 .982.95 0 2.111 0H35.89z" fill="#5A31F4"></path><path d="M9.35 11.368c-1.017-.223-1.47-.31-1.47-.705 0-.372.306-.558.92-.558.54 0 .934.238 1.225.704a.079.079 0 00.104.03l1.146-.584a.082.082 0 00.032-.114c-.475-.831-1.353-1.286-2.51-1.286-1.52 0-2.464.755-2.464 1.956 0 1.275 1.15 1.597 2.17 1.82 1.02.222 1.474.31 1.474.705 0 .396-.332.582-.993.582-.612 0-1.065-.282-1.34-.83a.08.08 0 00-.107-.035l-1.143.57a.083.083 0 00-.036.111c.454.92 1.384 1.437 2.627 1.437 1.583 0 2.539-.742 2.539-1.98s-1.155-1.598-2.173-1.82v-.003zM15.49 8.855c-.65 0-1.224.232-1.636.646a.04.04 0 01-.069-.03v-2.64a.08.08 0 00-.08-.081H12.27a.08.08 0 00-.08.082v8.194a.08.08 0 00.08.082h1.433a.08.08 0 00.081-.082v-3.594c0-.695.528-1.227 1.239-1.227.71 0 1.226.521 1.226 1.227v3.594a.08.08 0 00.081.082h1.433a.08.08 0 00.081-.082v-3.594c0-1.51-.981-2.577-2.355-2.577zM20.753 8.62c-.778 0-1.507.24-2.03.588a.082.082 0 00-.027.109l.632 1.088a.08.08 0 00.11.03 2.5 2.5 0 011.318-.366c1.25 0 2.17.891 2.17 2.068 0 1.003-.736 1.745-1.669 1.745-.76 0-1.288-.446-1.288-1.077 0-.361.152-.657.548-.866a.08.08 0 00.032-.113l-.596-1.018a.08.08 0 00-.098-.035c-.799.299-1.359 1.018-1.359 1.984 0 1.46 1.152 2.55 2.76 2.55 1.877 0 3.227-1.313 3.227-3.195 0-2.018-1.57-3.492-3.73-3.492zM28.675 8.843c-.724 0-1.373.27-1.845.746-.026.027-.069.007-.069-.029v-.572a.08.08 0 00-.08-.082h-1.397a.08.08 0 00-.08.082v8.182a.08.08 0 00.08.081h1.433a.08.08 0 00.081-.081v-2.683c0-.036.043-.054.069-.03a2.6 2.6 0 001.808.7c1.682 0 2.993-1.373 2.993-3.157s-1.313-3.157-2.993-3.157zm-.271 4.929c-.956 0-1.681-.768-1.681-1.783s.723-1.783 1.681-1.783c.958 0 1.68.755 1.68 1.783 0 1.027-.713 1.783-1.681 1.783h.001z" fill="#fff"></path></svg>

              </li><li class="icon--payment">
                <svg viewBox="-36 25 38 24" xmlns="http://www.w3.org/2000/svg" width="38" height="24" role="img" aria-labelledby="pi-unionpay"><title id="pi-unionpay">Union Pay</title><path fill="#005B9A" d="M-36 46.8v.7-.7zM-18.3 25v24h-7.2c-1.3 0-2.1-1-1.8-2.3l4.4-19.4c.3-1.3 1.9-2.3 3.2-2.3h1.4zm12.6 0c-1.3 0-2.9 1-3.2 2.3l-4.5 19.4c-.3 1.3.5 2.3 1.8 2.3h-4.9V25h10.8z"></path><path fill="#E9292D" d="M-19.7 25c-1.3 0-2.9 1.1-3.2 2.3l-4.4 19.4c-.3 1.3.5 2.3 1.8 2.3h-8.9c-.8 0-1.5-.6-1.5-1.4v-21c0-.8.7-1.6 1.5-1.6h14.7z"></path><path fill="#0E73B9" d="M-5.7 25c-1.3 0-2.9 1.1-3.2 2.3l-4.4 19.4c-.3 1.3.5 2.3 1.8 2.3H-26h.5c-1.3 0-2.1-1-1.8-2.3l4.4-19.4c.3-1.3 1.9-2.3 3.2-2.3h14z"></path><path fill="#059DA4" d="M2 26.6v21c0 .8-.6 1.4-1.5 1.4h-12.1c-1.3 0-2.1-1.1-1.8-2.3l4.5-19.4C-8.6 26-7 25-5.7 25H.5c.9 0 1.5.7 1.5 1.6z"></path><path fill="#fff" d="M-21.122 38.645h.14c.14 0 .28-.07.28-.14l.42-.63h1.19l-.21.35h1.4l-.21.63h-1.68c-.21.28-.42.42-.7.42h-.84l.21-.63m-.21.91h3.01l-.21.7h-1.19l-.21.7h1.19l-.21.7h-1.19l-.28 1.05c-.07.14 0 .28.28.21h.98l-.21.7h-1.89c-.35 0-.49-.21-.35-.63l.35-1.33h-.77l.21-.7h.77l.21-.7h-.7l.21-.7zm4.83-1.75v.42s.56-.42 1.12-.42h1.96l-.77 2.66c-.07.28-.35.49-.77.49h-2.24l-.49 1.89c0 .07 0 .14.14.14h.42l-.14.56h-1.12c-.42 0-.56-.14-.49-.35l1.47-5.39h.91zm1.68.77h-1.75l-.21.7s.28-.21.77-.21h1.05l.14-.49zm-.63 1.68c.14 0 .21 0 .21-.14l.14-.35h-1.75l-.14.56 1.54-.07zm-1.19.84h.98v.42h.28c.14 0 .21-.07.21-.14l.07-.28h.84l-.14.49c-.07.35-.35.49-.77.56h-.56v.77c0 .14.07.21.35.21h.49l-.14.56h-1.19c-.35 0-.49-.14-.49-.49l.07-2.1zm4.2-2.45l.21-.84h1.19l-.07.28s.56-.28 1.05-.28h1.47l-.21.84h-.21l-1.12 3.85h.21l-.21.77h-.21l-.07.35h-1.19l.07-.35h-2.17l.21-.77h.21l1.12-3.85h-.28m1.26 0l-.28 1.05s.49-.21.91-.28c.07-.35.21-.77.21-.77h-.84zm-.49 1.54l-.28 1.12s.56-.28.98-.28c.14-.42.21-.77.21-.77l-.91-.07zm.21 2.31l.21-.77h-.84l-.21.77h.84zm2.87-4.69h1.12l.07.42c0 .07.07.14.21.14h.21l-.21.7h-.77c-.28 0-.49-.07-.49-.35l-.14-.91zm-.35 1.47h3.57l-.21.77h-1.19l-.21.7h1.12l-.21.77h-1.26l-.28.42h.63l.14.84c0 .07.07.14.21.14h.21l-.21.7h-.7c-.35 0-.56-.07-.56-.35l-.14-.77-.56.84c-.14.21-.35.35-.63.35h-1.05l.21-.7h.35c.14 0 .21-.07.35-.21l.84-1.26h-1.05l.21-.77h1.19l.21-.7h-1.19l.21-.77zm-19.74-5.04c-.14.7-.42 1.19-.91 1.54-.49.35-1.12.56-1.89.56-.7 0-1.26-.21-1.54-.56-.21-.28-.35-.56-.35-.98 0-.14 0-.35.07-.56l.84-3.92h1.19l-.77 3.92v.28c0 .21.07.35.14.49.14.21.35.28.7.28s.7-.07.91-.28c.21-.21.42-.42.49-.77l.77-3.92h1.19l-.84 3.92m1.12-1.54h.84l-.07.49.14-.14c.28-.28.63-.42 1.05-.42.35 0 .63.14.77.35.14.21.21.49.14.91l-.49 2.38h-.91l.42-2.17c.07-.28.07-.49 0-.56-.07-.14-.21-.14-.35-.14-.21 0-.42.07-.56.21-.14.14-.28.35-.28.63l-.42 2.03h-.91l.63-3.57m9.8 0h.84l-.07.49.14-.14c.28-.28.63-.42 1.05-.42.35 0 .63.14.77.35s.21.49.14.91l-.49 2.38h-.91l.42-2.24c.07-.21 0-.42-.07-.49-.07-.14-.21-.14-.35-.14-.21 0-.42.07-.56.21-.14.14-.28.35-.28.63l-.42 2.03h-.91l.7-3.57m-5.81 0h.98l-.77 3.5h-.98l.77-3.5m.35-1.33h.98l-.21.84h-.98l.21-.84zm1.4 4.55c-.21-.21-.35-.56-.35-.98v-.21c0-.07 0-.21.07-.28.14-.56.35-1.05.7-1.33.35-.35.84-.49 1.33-.49.42 0 .77.14 1.05.35.21.21.35.56.35.98v.21c0 .07 0 .21-.07.28-.14.56-.35.98-.7 1.33-.35.35-.84.49-1.33.49-.35 0-.7-.14-1.05-.35m1.89-.7c.14-.21.28-.49.35-.84v-.35c0-.21-.07-.35-.14-.49a.635.635 0 0 0-.49-.21c-.28 0-.49.07-.63.28-.14.21-.28.49-.35.84v.28c0 .21.07.35.14.49.14.14.28.21.49.21.28.07.42 0 .63-.21m6.51-4.69h2.52c.49 0 .84.14 1.12.35.28.21.35.56.35.91v.28c0 .07 0 .21-.07.28-.07.49-.35.98-.7 1.26-.42.35-.84.49-1.4.49h-1.4l-.42 2.03h-1.19l1.19-5.6m.56 2.59h1.12c.28 0 .49-.07.7-.21.14-.14.28-.35.35-.63v-.28c0-.21-.07-.35-.21-.42-.14-.07-.35-.14-.7-.14h-.91l-.35 1.68zm8.68 3.71c-.35.77-.7 1.26-.91 1.47-.21.21-.63.7-1.61.7l.07-.63c.84-.28 1.26-1.4 1.54-1.96l-.28-3.78h1.19l.07 2.38.91-2.31h1.05l-2.03 4.13m-2.94-3.85l-.42.28c-.42-.35-.84-.56-1.54-.21-.98.49-1.89 4.13.91 2.94l.14.21h1.12l.7-3.29-.91.07m-.56 1.82c-.21.56-.56.84-.91.77-.28-.14-.35-.63-.21-1.19.21-.56.56-.84.91-.77.28.14.35.63.21 1.19"></path></svg>
              </li><li class="icon--payment">
                <svg viewBox="0 0 38 24" xmlns="http://www.w3.org/2000/svg" role="img" width="38" height="24" aria-labelledby="pi-visa"><title id="pi-visa">Visa</title><path opacity=".07" d="M35 0H3C1.3 0 0 1.3 0 3v18c0 1.7 1.4 3 3 3h32c1.7 0 3-1.3 3-3V3c0-1.7-1.4-3-3-3z"></path><path fill="#fff" d="M35 1c1.1 0 2 .9 2 2v18c0 1.1-.9 2-2 2H3c-1.1 0-2-.9-2-2V3c0-1.1.9-2 2-2h32"></path><path d="M28.3 10.1H28c-.4 1-.7 1.5-1 3h1.9c-.3-1.5-.3-2.2-.6-3zm2.9 5.9h-1.7c-.1 0-.1 0-.2-.1l-.2-.9-.1-.2h-2.4c-.1 0-.2 0-.2.2l-.3.9c0 .1-.1.1-.1.1h-2.1l.2-.5L27 8.7c0-.5.3-.7.8-.7h1.5c.1 0 .2 0 .2.2l1.4 6.5c.1.4.2.7.2 1.1.1.1.1.1.1.2zm-13.4-.3l.4-1.8c.1 0 .2.1.2.1.7.3 1.4.5 2.1.4.2 0 .5-.1.7-.2.5-.2.5-.7.1-1.1-.2-.2-.5-.3-.8-.5-.4-.2-.8-.4-1.1-.7-1.2-1-.8-2.4-.1-3.1.6-.4.9-.8 1.7-.8 1.2 0 2.5 0 3.1.2h.1c-.1.6-.2 1.1-.4 1.7-.5-.2-1-.4-1.5-.4-.3 0-.6 0-.9.1-.2 0-.3.1-.4.2-.2.2-.2.5 0 .7l.5.4c.4.2.8.4 1.1.6.5.3 1 .8 1.1 1.4.2.9-.1 1.7-.9 2.3-.5.4-.7.6-1.4.6-1.4 0-2.5.1-3.4-.2-.1.2-.1.2-.2.1zm-3.5.3c.1-.7.1-.7.2-1 .5-2.2 1-4.5 1.4-6.7.1-.2.1-.3.3-.3H18c-.2 1.2-.4 2.1-.7 3.2-.3 1.5-.6 3-1 4.5 0 .2-.1.2-.3.2M5 8.2c0-.1.2-.2.3-.2h3.4c.5 0 .9.3 1 .8l.9 4.4c0 .1 0 .1.1.2 0-.1.1-.1.1-.1l2.1-5.1c-.1-.1 0-.2.1-.2h2.1c0 .1 0 .1-.1.2l-3.1 7.3c-.1.2-.1.3-.2.4-.1.1-.3 0-.5 0H9.7c-.1 0-.2 0-.2-.2L7.9 9.5c-.2-.2-.5-.5-.9-.6-.6-.3-1.7-.5-1.9-.5L5 8.2z" fill="#142688"></path></svg>
              </li></ul><div class="footer__copyright site-footer__bottom-block"><span>
            © 2025
            Infused energy
</span></div>
    </div>
  </div>
</footer>


</div></div>
    </div><div id="VideoModal" class="modal modal--solid">
  <div class="modal__inner">
    <div class="modal__centered page-width text-center">
      <div class="modal__centered-content">
        <div class="video-wrapper video-wrapper--modal">
          <div id="VideoHolder"></div>
        </div>
      </div>
    </div>
  </div>

  <button type="button" class="modal__close js-modal-close text-link">
    <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-close" viewBox="0 0 64 64"><path d="M19 17.61l27.12 27.13m0-27.12L19 44.74"></path></svg>
    <span class="icon__fallback-text">"Schließen (Esc)"</span>
  </button>
</div>
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="pswp__bg"></div>
  <div class="pswp__scroll-wrap">
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>

    <div class="pswp__ui pswp__ui--hidden">
      <button class="btn btn--no-animate btn--body btn--circle pswp__button pswp__button--arrow--left" title="Zurück">
        <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-chevron-left" viewBox="0 0 284.49 498.98"><path d="M249.49 0a35 35 0 0 1 24.75 59.75L84.49 249.49l189.75 189.74a35.002 35.002 0 1 1-49.5 49.5L10.25 274.24a35 35 0 0 1 0-49.5L224.74 10.25A34.89 34.89 0 0 1 249.49 0z"></path></svg>
      </button>

      <button class="btn btn--no-animate btn--body btn--circle btn--large pswp__button pswp__button--close" title="Schließen (Esc)">
        <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-close" viewBox="0 0 64 64"><path d="M19 17.61l27.12 27.13m0-27.12L19 44.74"></path></svg>
      </button>

      <button class="btn btn--no-animate btn--body btn--circle pswp__button pswp__button--arrow--right" title="Vorwärts">
        <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-chevron-right" viewBox="0 0 284.49 498.98"><path d="M35 498.98a35 35 0 0 1-24.75-59.75l189.74-189.74L10.25 59.75a35.002 35.002 0 0 1 49.5-49.5l214.49 214.49a35 35 0 0 1 0 49.5L59.75 488.73A34.89 34.89 0 0 1 35 498.98z"></path></svg>
      </button>
    </div>
  </div>
</div>
<tool-tip data-tool-tip="">
  <div class="tool-tip__inner" data-tool-tip-inner="">
    <button class="tool-tip__close" data-tool-tip-close=""><svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-close" viewBox="0 0 64 64"><path d="M19 17.61l27.12 27.13m0-27.12L19 44.74"></path></svg></button>
    <div class="tool-tip__content" data-tool-tip-content="">
    </div>
  </div>
</tool-tip>
<!-- PickyStory snippet "main_widget_script", do not modify. Safe to remove after the app is uninstalled -->
  
  <!-- PickyStory end snippet "main_widget_script" -->
    <style>
  @media (max-width:599px){
    #squirai-div-1 {
      width: 60% !important;
      height: auto;
    }
    #squirai-offer {
      font-size: 12px !important;
    }
    #squirai-price-title {
      font-size: 11px !important;
      margin-top: 1px !important;
    }
    #squirai-button-text {
      font-size: 12px !important;
    }
    #squirai-product-detail {
      font-size: 10px !important;
    }
    #squirai-popup-inside {
        flex-direction: unset !important;
    }
       #squirai-popup-temp #squirai-popup-container {
        width: 375px !important;
    }
        #squirai-special-day {
        font-size: 25px !important;
    }
    #squirai-hint-text {
        font-size: 7px !important;
    }
    #squirai-promo-detail {
        font-size: 12px !important;
    }
    #sca-p-popup-main-popup-container .sca-modal-dialog-pu {
        width: 100% !important;
    }
    .squirai-Countdown #defaultCountdown {
        width: 175px !important;
    }
    .countdown-show4 .countdown-section {
      width: 22.5% !important;
  }
    .squirai-Countdown span {
        font-size: 8px !important;
    }
   #squirai-compare-price {
        font-size: 20px !important;
    } 
    #squirai-button-add-to-cart {
      margin-top: 1px !important;
    }
    #squirai-popup-inside {
        gap: unset !important;
    }
    #squirai-promo-container .squirai-Countdown {
        padding-bottom: 0px !important;
        padding-top: 0px !important;
    }
      #squirai-div-2 {
        padding: 0px 11px !important;
    }
    #defaultCountdown {
    height: 44px !important;
    }
}
</style> <!-- Decify Start -->
<script>
  window.decifyDataLayer = window.decifyDataLayer || [];

  window.decifyDataLayer.push({
    event: "page_view",
    shopify: {
      localization: {
        language: {
          iso_code: "de",
        },
        country: {
          iso_code: "DE",
        },
        market: {
          id: 1245544683,
          handle: "de",
        },
      },
    },
  });

  
</script>

<script>
  !function(d,e,c,i,f,y){d.Decify=d.Decify||{},d._DecifyConfig={projectId:"677f84983bee7a9c88cfe4fc",version:"0"},f=e.getElementsByTagName("head")[0],(y=e.createElement("script")).async=1,y.src="https://cdn.decify.ai/surveys/c/"+d._DecifyConfig.projectId+".js?v="+d._DecifyConfig.version,f.appendChild(y)}(window,document);
</script>
<!-- Decify End --><div id="shopify-block-AQjhsaFFDeVJBdGc0M__4912811683585195618" class="shopify-block shopify-app-block">
    <script defer="">let ppData = {"tabs":"{\"status\":false,\"must_click_to_open\":true,\"tab_title\":\"Special Offer\",\"tab_text_color\":\"#FFFFFF\",\"background_color\":\"#333333\",\"tab_position\":\"bottom_center\"}","popups":[],"hidden_brandmark":true}</script>

    <script type="text/javascript" defer="">window.SQUIRAI = {customer_tags: {tags: null}};</script>

    <div id="sca-p-popup-main-popup-container" class="sca-p-popup-main-container sca-modal-pu" data-animation="slideInOutTop">
        <div id="sca-p-popup-modal" class="slide-container sca-modal-dialog-pu"></div>
    </div>
    <div id="sca-p-popup-tab" class="sca-p-popup-main-container sca-modal-pu" style="display: none;">
        <span class="sca-p-popup-warp-btn p-popup-tab-btn-custom">
            <button id="squirai-tab-close-button">✕</button>
            <span id="sca-p-popup-text" class="sca-p-popup-tab-click"></span>
        </span>
    </div>
    <script src="./Infused energy_files/squirai-theme-app-extension.js.download" defer=""></script>




</div><div id="shopify-block-AN3hsdzZvTTlIb2FWQ__8218531531362863771" class="shopify-block shopify-app-block"><script async="" src="./Infused energy_files/shippingDiscount.js.download"></script>
<script async="" src="./Infused energy_files/customDiscountLogic.js.download"></script>
<script>
    let shopifyLiquidValuesApp7Ext = { 
        product: { 
            handle: null,
            productId: null,
            collections: [
                
            ]
        },
        selected_or_first_available_variant: null,
        customer: {
                    first_name: null,
                    email: null,
                    id: null,
                    total_spent: null,
                    customerTags: null
        },
        cartData : {"note":"","attributes":{"_kite_cfData":"{\"Aktions-Rabatt\":\"\"}","_customerTags":[],"gbbDiscountCode-Energy Latte":"EasyBundle-MYV2XCT7NV","show_payment":"true"},"original_total_price":10760,"total_price":10760,"total_discount":0,"total_weight":920.0,"item_count":4,"items":[{"id":50264118821130,"properties":{"Bundle":"Energy Latte","Box ID":"1"},"quantity":1,"variant_id":50264118821130,"key":"50264118821130:f1770f8fd2de6044e6ff26d68685d847","title":"Energy latte - Cacao","price":2690,"original_price":2690,"discounted_price":2690,"line_price":2690,"original_line_price":2690,"total_discount":0,"discounts":[],"sku":"IEL_CA","grams":240,"vendor":"Infused energy","taxable":true,"product_id":9797276565770,"product_has_only_default_variant":true,"gift_card":false,"final_price":2690,"final_line_price":2690,"url":"\/products\/energy-latte-cacao?variant=50264118821130","featured_image":{"aspect_ratio":1.0,"alt":"Energy latte - Cacao","height":1420,"url":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Cacao_Milky-Chocolate_Front_1420x1420_c289b805-bc64-4733-8c95-e41d29dc46b0.png?v=1731316426","width":1420},"image":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Cacao_Milky-Chocolate_Front_1420x1420_c289b805-bc64-4733-8c95-e41d29dc46b0.png?v=1731316426","handle":"energy-latte-cacao","requires_shipping":true,"product_type":"","product_title":"Energy latte - Cacao","product_description":"Freue dich auf echten Kakao kombiniert mit hochwertigem japanischen Matcha – eine harmonische Verbindung für natürlichen Genuss und Energie. Diese Sorte bietet dir einen sanften Wach-Effekt, der lange anhält, und überzeugt mit ihrem einzigartig guten Geschmack. Ergänzt mit Ginseng, Guarana und Ashwagandha, ist sie dein perfekter Begleiter für Fokus und Wohlbefinden.\n ","variant_title":null,"variant_options":["Default Title"],"options_with_values":[{"name":"Title","value":"Default Title"}],"line_level_discount_allocations":[],"line_level_total_discount":0},{"id":44966031556874,"properties":{"Bundle":"Energy Latte","Box ID":"1"},"quantity":1,"variant_id":44966031556874,"key":"44966031556874:4f59f2ff0a6fe5560c65c1b8db3c75ba","title":"Energy latte - Spekulatius","price":2690,"original_price":2690,"discounted_price":2690,"line_price":2690,"original_line_price":2690,"total_discount":0,"discounts":[],"sku":"IEL-XMS_240","grams":200,"vendor":"Infused energy","taxable":true,"product_id":8358568722698,"product_has_only_default_variant":true,"gift_card":false,"final_price":2690,"final_line_price":2690,"url":"\/products\/infused-energy-latte-spekulatius?variant=44966031556874","featured_image":{"aspect_ratio":1.0,"alt":"Energy latte - Spekulatius","height":1420,"url":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Christmas-Edition_Spekulatius_Front_1420x1420_9580a96a-eaed-4725-8a76-236656a84d4c.png?v=1701975690","width":1420},"image":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Christmas-Edition_Spekulatius_Front_1420x1420_9580a96a-eaed-4725-8a76-236656a84d4c.png?v=1701975690","handle":"infused-energy-latte-spekulatius","requires_shipping":true,"product_type":"","product_title":"Energy latte - Spekulatius","product_description":"Endlich wieder da! \nWärmende Gewürze wie Zimt, Sternanis \u0026 Co. vertreiben jede Kälte und bringen deinen Kreislauf in Schwung, während Japan Matcha Guarana und Ginseng für langanhaltende Energie sorgen.\nDie anregenden Basiszutaten aus Bio Japan Matcha, Bio Guarana, Bio Ginseng, Bio Ashwagandha und Bio Datteln werden von uns zu einem feinen Pulver verarbeitet, welches du ganz einfach mit Milch\/Pflanzenmilch mixen kannst.","variant_title":null,"variant_options":["Default Title"],"options_with_values":[{"name":"Title","value":"Default Title"}],"line_level_discount_allocations":[],"line_level_total_discount":0},{"id":49703104741642,"properties":{"Bundle":"Energy Latte","Box ID":"1"},"quantity":1,"variant_id":49703104741642,"key":"49703104741642:3ab3db61a08ab61b437ac3b206276e60","title":"Energy latte - Matcha x Coffee","price":2690,"original_price":2690,"discounted_price":2690,"line_price":2690,"original_line_price":2690,"total_discount":0,"discounts":[],"sku":"IEL-IC_240","grams":240,"vendor":"Infused energy","taxable":true,"product_id":9604885086474,"product_has_only_default_variant":true,"gift_card":false,"final_price":2690,"final_line_price":2690,"url":"\/products\/energy-latte-iced-coffee?variant=49703104741642","featured_image":{"aspect_ratio":1.0,"alt":"Energy latte - Matcha x Coffee","height":1420,"url":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Matcha-Iced-Coffee_Front_1420x1420_f07eb706-ea0a-4363-906f-e876a9285526.png?v=1722512555","width":1420},"image":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Matcha-Iced-Coffee_Front_1420x1420_f07eb706-ea0a-4363-906f-e876a9285526.png?v=1722512555","handle":"energy-latte-iced-coffee","requires_shipping":true,"product_type":"","product_title":"Energy latte - Matcha x Coffee","product_description":"Freue dich auf die einzigartige Kombination aus echtem japanischen Matcha und aromatischem Kaffee. Diese Sorte vereint das Beste aus beiden Welten – für einen langanhaltenden Wach-Effekt und einen außergewöhnlich guten Geschmack. Ergänzt mit Ginseng, Guarana und Ashwagandha, ist sie der perfekte Begleiter für natürliche Energie und Fokus.\n \n","variant_title":null,"variant_options":["Default Title"],"options_with_values":[{"name":"Title","value":"Default Title"}],"line_level_discount_allocations":[],"line_level_total_discount":0},{"id":50325483651338,"properties":{"Bundle":"Energy Latte","Box ID":"1"},"quantity":1,"variant_id":50325483651338,"key":"50325483651338:9359f9e75c29afc4f388055c9f6fac19","title":"Energy latte - Dubai Edition (limitiert)","price":2690,"original_price":2690,"discounted_price":2690,"line_price":2690,"original_line_price":2690,"total_discount":0,"discounts":[],"sku":"FE-XL-LT-DB","grams":240,"vendor":"Infused energy","taxable":true,"product_id":9816077304074,"product_has_only_default_variant":true,"gift_card":false,"final_price":2690,"final_line_price":2690,"url":"\/products\/energy-latte-dubai-edition-limitiert?variant=50325483651338","featured_image":{"aspect_ratio":1.0,"alt":"Energy latte - Dubai Edition (limitiert)","height":1420,"url":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Dubai_Front_1420x1420_60bb1c56-404b-4af6-93a0-763c06c3e273.png?v=1732284794","width":1420},"image":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Dubai_Front_1420x1420_60bb1c56-404b-4af6-93a0-763c06c3e273.png?v=1732284794","handle":"energy-latte-dubai-edition-limitiert","requires_shipping":true,"product_type":"","product_title":"Energy latte - Dubai Edition (limitiert)","product_description":"Freue dich auf echten Roh-Cacao mit feinen Pistazien und echtem japanischem Matcha, Ginseng, Guarana und Ashwagandha für einen wohltuenden Energie-Kick.","variant_title":null,"variant_options":["Default Title"],"options_with_values":[{"name":"Title","value":"Default Title"}],"line_level_discount_allocations":[],"line_level_total_discount":0}],"requires_shipping":true,"currency":"EUR","items_subtotal_price":10760,"cart_level_discount_applications":[],"checkout_charge_amount":10760},

    };

    
    window.shopifyLiquidValuesApp7Ext = shopifyLiquidValuesApp7Ext;
</script>

<script id="kite-app-data" type="application/json" data-json=""></script>

<script>
    
    if (window && !window.kite_app_data) {
      let metafieldData;
      
      // Get the JSON data from the data attribute of the script tag
      const jsonDataElement = document.getElementById('kite-app-data');
      const jsonString = jsonDataElement ? jsonDataElement.getAttribute('data-json') : '';

      try {
        // Parse the JSON string
        metafieldData = JSON.parse(jsonString);
      } catch (error) {
        // Log the error if parsing fails
        console.error("Failed to parse metafield data:", error);
        metafieldData = { errorMsg: "This is not a valid JSON" };
      }

      // If the parsing was successful and no error message exists
      if (metafieldData && !metafieldData?.errorMsg) {
        window.kite_app_data = metafieldData;
        
      }

      // Clear the data-json attribute
      if (jsonDataElement) {
        jsonDataElement.setAttribute('data-json', '');
      }
    }
</script>


</div><div id="shopify-block-AQzZUdjQ3SXVxbUpNb__11348531219507317188" class="shopify-block shopify-app-block"><script>
    let shopifyLiquidValuesApp4Ext =   { 
      product: { 
            handle: null,
            productId: null,
            collections: [
                
            ],
        },
        selected_or_first_available_variant: null,
        cartData: {"note":"","attributes":{"_kite_cfData":"{\"Aktions-Rabatt\":\"\"}","_customerTags":[],"gbbDiscountCode-Energy Latte":"EasyBundle-MYV2XCT7NV","show_payment":"true"},"original_total_price":10760,"total_price":10760,"total_discount":0,"total_weight":920.0,"item_count":4,"items":[{"id":50264118821130,"properties":{"Bundle":"Energy Latte","Box ID":"1"},"quantity":1,"variant_id":50264118821130,"key":"50264118821130:f1770f8fd2de6044e6ff26d68685d847","title":"Energy latte - Cacao","price":2690,"original_price":2690,"discounted_price":2690,"line_price":2690,"original_line_price":2690,"total_discount":0,"discounts":[],"sku":"IEL_CA","grams":240,"vendor":"Infused energy","taxable":true,"product_id":9797276565770,"product_has_only_default_variant":true,"gift_card":false,"final_price":2690,"final_line_price":2690,"url":"\/products\/energy-latte-cacao?variant=50264118821130","featured_image":{"aspect_ratio":1.0,"alt":"Energy latte - Cacao","height":1420,"url":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Cacao_Milky-Chocolate_Front_1420x1420_c289b805-bc64-4733-8c95-e41d29dc46b0.png?v=1731316426","width":1420},"image":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Cacao_Milky-Chocolate_Front_1420x1420_c289b805-bc64-4733-8c95-e41d29dc46b0.png?v=1731316426","handle":"energy-latte-cacao","requires_shipping":true,"product_type":"","product_title":"Energy latte - Cacao","product_description":"Freue dich auf echten Kakao kombiniert mit hochwertigem japanischen Matcha – eine harmonische Verbindung für natürlichen Genuss und Energie. Diese Sorte bietet dir einen sanften Wach-Effekt, der lange anhält, und überzeugt mit ihrem einzigartig guten Geschmack. Ergänzt mit Ginseng, Guarana und Ashwagandha, ist sie dein perfekter Begleiter für Fokus und Wohlbefinden.\n ","variant_title":null,"variant_options":["Default Title"],"options_with_values":[{"name":"Title","value":"Default Title"}],"line_level_discount_allocations":[],"line_level_total_discount":0},{"id":44966031556874,"properties":{"Bundle":"Energy Latte","Box ID":"1"},"quantity":1,"variant_id":44966031556874,"key":"44966031556874:4f59f2ff0a6fe5560c65c1b8db3c75ba","title":"Energy latte - Spekulatius","price":2690,"original_price":2690,"discounted_price":2690,"line_price":2690,"original_line_price":2690,"total_discount":0,"discounts":[],"sku":"IEL-XMS_240","grams":200,"vendor":"Infused energy","taxable":true,"product_id":8358568722698,"product_has_only_default_variant":true,"gift_card":false,"final_price":2690,"final_line_price":2690,"url":"\/products\/infused-energy-latte-spekulatius?variant=44966031556874","featured_image":{"aspect_ratio":1.0,"alt":"Energy latte - Spekulatius","height":1420,"url":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Christmas-Edition_Spekulatius_Front_1420x1420_9580a96a-eaed-4725-8a76-236656a84d4c.png?v=1701975690","width":1420},"image":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Christmas-Edition_Spekulatius_Front_1420x1420_9580a96a-eaed-4725-8a76-236656a84d4c.png?v=1701975690","handle":"infused-energy-latte-spekulatius","requires_shipping":true,"product_type":"","product_title":"Energy latte - Spekulatius","product_description":"Endlich wieder da! \nWärmende Gewürze wie Zimt, Sternanis \u0026 Co. vertreiben jede Kälte und bringen deinen Kreislauf in Schwung, während Japan Matcha Guarana und Ginseng für langanhaltende Energie sorgen.\nDie anregenden Basiszutaten aus Bio Japan Matcha, Bio Guarana, Bio Ginseng, Bio Ashwagandha und Bio Datteln werden von uns zu einem feinen Pulver verarbeitet, welches du ganz einfach mit Milch\/Pflanzenmilch mixen kannst.","variant_title":null,"variant_options":["Default Title"],"options_with_values":[{"name":"Title","value":"Default Title"}],"line_level_discount_allocations":[],"line_level_total_discount":0},{"id":49703104741642,"properties":{"Bundle":"Energy Latte","Box ID":"1"},"quantity":1,"variant_id":49703104741642,"key":"49703104741642:3ab3db61a08ab61b437ac3b206276e60","title":"Energy latte - Matcha x Coffee","price":2690,"original_price":2690,"discounted_price":2690,"line_price":2690,"original_line_price":2690,"total_discount":0,"discounts":[],"sku":"IEL-IC_240","grams":240,"vendor":"Infused energy","taxable":true,"product_id":9604885086474,"product_has_only_default_variant":true,"gift_card":false,"final_price":2690,"final_line_price":2690,"url":"\/products\/energy-latte-iced-coffee?variant=49703104741642","featured_image":{"aspect_ratio":1.0,"alt":"Energy latte - Matcha x Coffee","height":1420,"url":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Matcha-Iced-Coffee_Front_1420x1420_f07eb706-ea0a-4363-906f-e876a9285526.png?v=1722512555","width":1420},"image":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Matcha-Iced-Coffee_Front_1420x1420_f07eb706-ea0a-4363-906f-e876a9285526.png?v=1722512555","handle":"energy-latte-iced-coffee","requires_shipping":true,"product_type":"","product_title":"Energy latte - Matcha x Coffee","product_description":"Freue dich auf die einzigartige Kombination aus echtem japanischen Matcha und aromatischem Kaffee. Diese Sorte vereint das Beste aus beiden Welten – für einen langanhaltenden Wach-Effekt und einen außergewöhnlich guten Geschmack. Ergänzt mit Ginseng, Guarana und Ashwagandha, ist sie der perfekte Begleiter für natürliche Energie und Fokus.\n \n","variant_title":null,"variant_options":["Default Title"],"options_with_values":[{"name":"Title","value":"Default Title"}],"line_level_discount_allocations":[],"line_level_total_discount":0},{"id":50325483651338,"properties":{"Bundle":"Energy Latte","Box ID":"1"},"quantity":1,"variant_id":50325483651338,"key":"50325483651338:9359f9e75c29afc4f388055c9f6fac19","title":"Energy latte - Dubai Edition (limitiert)","price":2690,"original_price":2690,"discounted_price":2690,"line_price":2690,"original_line_price":2690,"total_discount":0,"discounts":[],"sku":"FE-XL-LT-DB","grams":240,"vendor":"Infused energy","taxable":true,"product_id":9816077304074,"product_has_only_default_variant":true,"gift_card":false,"final_price":2690,"final_line_price":2690,"url":"\/products\/energy-latte-dubai-edition-limitiert?variant=50325483651338","featured_image":{"aspect_ratio":1.0,"alt":"Energy latte - Dubai Edition (limitiert)","height":1420,"url":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Dubai_Front_1420x1420_60bb1c56-404b-4af6-93a0-763c06c3e273.png?v=1732284794","width":1420},"image":"\/\/infusedenergy.shop\/cdn\/shop\/files\/IE_Infused-Latte_Dubai_Front_1420x1420_60bb1c56-404b-4af6-93a0-763c06c3e273.png?v=1732284794","handle":"energy-latte-dubai-edition-limitiert","requires_shipping":true,"product_type":"","product_title":"Energy latte - Dubai Edition (limitiert)","product_description":"Freue dich auf echten Roh-Cacao mit feinen Pistazien und echtem japanischem Matcha, Ginseng, Guarana und Ashwagandha für einen wohltuenden Energie-Kick.","variant_title":null,"variant_options":["Default Title"],"options_with_values":[{"name":"Title","value":"Default Title"}],"line_level_discount_allocations":[],"line_level_total_discount":0}],"requires_shipping":true,"currency":"EUR","items_subtotal_price":10760,"cart_level_discount_applications":[],"checkout_charge_amount":10760}
    }
    window.shopifyLiquidValuesApp4Ext = shopifyLiquidValuesApp4Ext;
</script>

<script id="easybundles-ext-data" type="application/json" data-json=""></script>

<script>
    //console.log("inside app embed file");
    if (window && !window.easybundles_ext_data) {
      let metafieldData;
      
      // Get the JSON data from the data attribute of the script tag
      const jsonDataElement = document.getElementById('easybundles-ext-data');
      const jsonString = jsonDataElement ? jsonDataElement.getAttribute('data-json') : '';

      try {
        // Parse the JSON string
        metafieldData = JSON.parse(jsonString);
      } catch (error) {
        // Log the error if parsing fails
        console.error("Failed to parse metafield data:", error);
        metafieldData = { errorMsg: "This is not a valid JSON" };
      }

      // If the parsing was successful and no error message exists
      if (metafieldData && !metafieldData?.errorMsg && !metafieldData.isUseAppLevelMetafieldEnabled) {
        window.easybundles_ext_data = metafieldData;
        //console.log("app_data from easybundles app embed", window.easybundles_ext_data);
      }

      // Clear the data-json attribute
      if (jsonDataElement) {
        jsonDataElement.setAttribute('data-json', '');
      }
    }
</script>

</div><div tabindex="-1" aria-hidden="true" id="web-pixels-manager-sandbox-container" data-shopify-privacy="exclude" style="height: 0px !important; width: 0px !important; position: fixed !important; visibility: hidden !important; overflow: hidden !important; z-index: -100 !important; margin: 0px !important; padding: 0px !important; border: 0px !important;"><iframe tabindex="-1" aria-hidden="true" name="web-pixel-sandbox-CUSTOM-120357130-LAX-bb202aaewd7fabeadp1286c7ffm6c4f3798" src="./Infused energy_files/5.html" id="web-pixel-sandbox-CUSTOM-120357130-LAX-bb202aaewd7fabeadp1286c7ffm6c4f3798" sandbox="allow-scripts allow-forms" style="height: 0px !important; width: 0px !important; visibility: hidden !important;"></iframe><iframe tabindex="-1" aria-hidden="true" name="web-pixel-sandbox-CUSTOM-154239242-LAX-bb202aaewd7fabeadp1286c7ffm6c4f3798" src="./Infused energy_files/5(1).html" id="web-pixel-sandbox-CUSTOM-154239242-LAX-bb202aaewd7fabeadp1286c7ffm6c4f3798" sandbox="allow-scripts allow-forms" style="height: 0px !important; width: 0px !important; visibility: hidden !important;"></iframe><iframe tabindex="-1" aria-hidden="true" name="web-pixel-sandbox-CUSTOM-158695690-LAX-bb202aaewd7fabeadp1286c7ffm6c4f3798" src="./Infused energy_files/5(2).html" id="web-pixel-sandbox-CUSTOM-158695690-LAX-bb202aaewd7fabeadp1286c7ffm6c4f3798" sandbox="allow-scripts allow-forms" style="height: 0px !important; width: 0px !important; visibility: hidden !important;"></iframe><iframe tabindex="-1" aria-hidden="true" name="web-pixel-sandbox-CUSTOM-shopify-custom-pixel-LAX-bb202aaewd7fabeadp1286c7ffm6c4f3798" src="./Infused energy_files/5(3).html" id="web-pixel-sandbox-CUSTOM-shopify-custom-pixel-LAX-bb202aaewd7fabeadp1286c7ffm6c4f3798" sandbox="allow-scripts allow-forms" style="height: 0px !important; width: 0px !important; visibility: hidden !important;"></iframe></div>

<style id="custom-css" data-source-name="gfgFreeGift">.gfgFreeGiftWidgetTitleBar<br>{<br>text-align: center !important;<br>}</style><script src="./Infused energy_files/js"></script><div id="rmOrganism">
    <div class="rmPopup__container">
            <div class="rmPopup__backdrop"></div>
            <div class="rmPopup rmPopup--modal rmLayout--vertical rmBase">
            <div class="rmPopup__close">×</div>
                    
    <div data-page-type="formSubscribe" class="rmBase__body rmSubscription">
                                    <form method="post" action="https://t4eae93e3.emailsys1a.net/48/4743/1ade440918/subscribe/form.html" class="rmBase__content">
                        <div class="rmBase__container">
                                    <div class="rmBase__section">
                                                    

<div class="rmBase__el rmBase__el--logo">
        
        <img class="rmBase__comp--logo" src="./Infused energy_files/4e1a71518865aa0d387d54dbaece9c9071ff56c3.png" alt="" style="max-height: 50px">
    </div>                                            </div>
                                    <div class="rmBase__section">
                                                    

<div class="rmBase__el rmBase__el--heading">
        <div class="rmBase__comp--heading">
    Jetzt 15% Gutschein sichern!
    <!-- this linebreak is important, don't remove it! this will force trailing linebreaks to be displayed -->
    <br>
</div>
</div>                                            </div>
                                    <div class="rmBase__section">
                                                    

<div class="rmBase__el rmBase__el--text">
        <div class="rmBase__comp--text">
    Melde dich hier zu unserem Newsletter an und erhalte als Dankeschön einen 15% Gutschein.
    <!-- this linebreak is important, don't remove it! this will force trailing linebreaks to be displayed -->
    <br>
</div>
</div>                                            </div>
                                    <div class="rmBase__section">
                                                    

<div class="rmBase__el rmBase__el--input rmBase__el--label-pos-none" data-field="firstname">
        <label for="firstname" class="rmBase__compLabel rmBase__compLabel--hideable">Vorname</label>
<div class="rmBase__compContainer">
    <input type="text" name="firstname" id="firstname" placeholder="Vorname" value="" class="rmBase__comp--input comp__input">
    <div class="rmBase__compError"></div>
</div>
</div>                                                    

<div class="rmBase__el rmBase__el--input rmBase__el--label-pos-none" data-field="lastname">
        <label for="lastname" class="rmBase__compLabel rmBase__compLabel--hideable">Nachname</label>
<div class="rmBase__compContainer">
    <input type="text" name="lastname" id="lastname" placeholder="Nachname" value="" class="rmBase__comp--input comp__input">
    <div class="rmBase__compError"></div>
</div>
</div>                                                    

<div class="rmBase__el rmBase__el--input rmBase__el--label-pos-none" data-field="email">
        <label for="email" class="rmBase__compLabel rmBase__compLabel--hideable">E-Mail-Adresse</label>
<div class="rmBase__compContainer">
    <input type="text" name="email" id="email" placeholder="E-Mail" value="" class="rmBase__comp--input comp__input">
    <div class="rmBase__compError"></div>
</div>
</div>                                            </div>
                                    <div class="rmBase__section">
                                                    

<div class="rmBase__el rmBase__el--consent" data-field="consent_text">
            <div class="rmBase__comp--checkbox">
        Ich stimme zu, dass meine personenbezogenen Daten genutzt werden, um werbliche E-Mails zu erhalten, und weiß, dass ich dies jederzeit widerrufen kann.
    </div>
</div>                                            </div>
                                    <div class="rmBase__section">
                                                    

<div class="rmBase__el rmBase__el--cta">
        <button type="submit" class="rmBase__comp--cta">
    Anmelden
</button>
</div>                                            </div>
                                    <div class="rmBase__section">
                                                    

<div class="rmBase__el rmBase__el--data-privacy">
        <div class="rmBase__comp--privacy">
    <figure class="privacy__visual">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 256 256" xml:space="preserve"><g stroke-linecap="round" stroke-linejoin="round" stroke-width="4" fill="currentColor" stroke="currentColor"><path fill="none" stroke-miterlimit="10" d="M144.5 105v-7h-44v54c0 3.3 2.7 6 6 6M112.5 152c0 3.3-2.7 6-6 6h40c3.3 0 6-2.7 6-6v-4h-40V152z"></path><line fill="none" stroke-miterlimit="10" x1="110.5" y1="112" x2="127.5" y2="112"></line><line fill="none" stroke-miterlimit="10" x1="110.5" y1="123" x2="127.5" y2="123"></line><line fill="none" stroke-miterlimit="10" x1="110.5" y1="134" x2="122.5" y2="134"></line><polyline fill="none" stroke-miterlimit="10" points="151.5 124.5 151.5 139 144.5 134 137.5 139 137.5 124.5 "></polyline><circle fill="none" stroke-miterlimit="10" cx="144.5" cy="116" r="11"></circle><line fill="none" stroke-miterlimit="10" x1="144.5" y1="148" x2="144.5" y2="141"></line><path fill="none" stroke-miterlimit="10" d="M127.5 3.9l-4.2 8.9 -9.7 1.2 7.2 6.7 -1.8 9.6 8.6-4.7 8.6 4.7 -1.8-9.6 7.2-6.7 -9.7-1.2L127.5 3.9zM131.7 234.5l-4.2-8.9 -4.2 8.9 -9.7 1.2 7.2 6.7 -1.8 9.6 8.6-4.7 8.6 4.7 -1.8-9.6 7.2-6.7L131.7 234.5zM252.3 124.9l-9.7-1.2 -4.2-8.9 -4.2 8.9 -9.7 1.2 7.2 6.7 -1.8 9.6 8.6-4.7 8.6 4.7 -1.8-9.6L252.3 124.9zM17.6 136.5l8.6 4.7 -1.8-9.6 7.2-6.7 -9.7-1.2 -4.2-8.9 -4.2 8.9 -9.7 1.2 7.2 6.7L9 141.2 17.6 136.5zM174.1 47.1l8.6-4.7 8.6 4.7 -1.8-9.6 7.2-6.7 -9.7-1.2 -4.2-8.9 -4.2 8.9 -9.7 1.2 7.2 6.7L174.1 47.1zM76 221.6l-4.2-8.9 -4.2 8.9 -9.7 1.2 7.2 6.7 -1.8 9.6 8.6-4.7 8.6 4.7 -1.8-9.6 7.2-6.7L76 221.6zM225.8 178.9l-4.2-8.9 -4.2 8.9 -9.7 1.2 7.2 6.7 -1.8 9.6 8.6-4.7 8.6 4.7 -1.8-9.6 7.2-6.7L225.8 178.9zM21 85.5l8.6-4.7 8.6 4.7 -1.8-9.6 7.2-6.7L33.8 68l-4.2-8.9L25.4 68l-9.7 1.2 7.2 6.7L21 85.5zM214 87.4l8.6-4.7 8.6 4.7 -1.8-9.6 7.2-6.7 -9.7-1.2 -4.2-8.9 -4.2 8.9 -9.7 1.2 7.2 6.7L214 87.4zM34.7 180.8l-4.2-8.9 -4.2 8.9 -9.7 1.2 7.2 6.7 -1.8 9.6 8.6-4.7 8.6 4.7 -1.8-9.6 7.2-6.7L34.7 180.8zM187.9 219.2l-4.2-8.9 -4.2 8.9 -9.7 1.2 7.2 6.7 -1.8 9.6 8.6-4.7 8.6 4.7 -1.8-9.6 7.2-6.7L187.9 219.2zM72.8 18.3l-4.2 8.9 -9.7 1.2 7.2 6.7 -1.8 9.6 8.6-4.7 8.6 4.7 -1.8-9.6 7.2-6.7L77 27.2 72.8 18.3z"></path></g></svg>
    </figure>

    <p class="privacy__text">
                                                
        Für den Versand unserer Newsletter nutzen wir rapidmail. Mit Ihrer Anmeldung stimmen Sie zu, dass die eingegebenen Daten an rapidmail übermittelt werden. Beachten Sie bitte auch die <a href="https://www.rapidmail.de/agb" target="_blank">AGB</a> und <a href="https://www.rapidmail.de/datenschutz-kundenbereich" target="_blank">Datenschutzbestimmungen</a>.
    </p>
</div>
</div>                                            </div>
                                </div>
                    </form>
            </div>
    
    <div data-page-type="pageSubscribeSuccess" class="rmBase__body rmSubscription hidden">
                                    <div class="rmBase__content">
                        <div class="rmBase__container">
                                    <div class="rmBase__section">
                                                    

<div class="rmBase__el rmBase__el--logo">
        
        <img class="rmBase__comp--logo" src="./Infused energy_files/4e1a71518865aa0d387d54dbaece9c9071ff56c3.png" alt="" style="max-height: 50px">
    </div>                                            </div>
                                    <div class="rmBase__section">
                                                    

<div class="rmBase__el rmBase__el--heading">
        <div class="rmBase__comp--heading">
    Dein Gutscheincode lautet: GET15
    <!-- this linebreak is important, don't remove it! this will force trailing linebreaks to be displayed -->
    <br>
</div>
</div>                                            </div>
                                    <div class="rmBase__section">
                                                    

<div class="rmBase__el rmBase__el--text">
        <div class="rmBase__comp--text">
    Vielen Dank für deine Anmeldung. Dieser Gutschein ist pro Kunde 1x gültig.
    <!-- this linebreak is important, don't remove it! this will force trailing linebreaks to be displayed -->
    <br>
</div>
</div>                                            </div>
                                </div>
                    </div>
            </div>
        </div>
    </div>
        <style>
                                
                
                
    
        .rmBody.rmBody--embed {
        background: #F7F9FA;
    }

    #rmOrganism .rmBase {
        background: #F7F9FA;
        color: #969A9E;
        font-family: Arial, Helvetica, sans-serif;
    }

    #rmOrganism .rmBase__comp--textlink {
        color: #1CCC71;
    }

    #rmOrganism .rmBase__comp--link {
        color: #1CCC71;
    }

    #rmOrganism .rmBase__comp--button {
        background: #1CCC71;
        border: 0px solid #1CCC71;
        border-radius: 5px;
        color: #ffffff;
    }

    #rmOrganism .rmBase__comp--cta {
        background: #1CCC71;
        border: 0px solid #1CCC71;
        border-radius: 5px;
        color: #ffffff;
    }

    #rmOrganism .rmBase__compError {
        color: #FFFFFF;
        background-color: #FF0000;
    }

        #rmOrganism .rmSubscription {
        background: #F7F9FA;
        color: #969A9E;
        font-family: Arial, Helvetica, sans-serif;
    }

    #rmOrganism .rmSubscription .rmBase__el {
        font-size: 16px;
        margin-bottom: 1em;
    }

    #rmOrganism .rmSubscription .rmBase__el--logo {
        text-align: center;
    }

    #rmOrganism .rmSubscription .rmBase__el--heading {
        margin-bottom: 0px;
        text-align: center;
    }

    #rmOrganism .rmSubscription .rmBase__el--text {
        margin-bottom: 28px;
        text-align: center;
    }

    #rmOrganism .rmSubscription .rmBase__el--link {
        text-align: center;
    }

    #rmOrganism .rmSubscription .rmBase__el--captcha {
        text-align: center;
    }

    #rmOrganism .rmSubscription .rmBase__el--cta {
        align-items: stretch
    }

    #rmOrganism .rmSubscription .rmBase__el--legal-notice {
        text-align: center;
    }

    #rmOrganism .rmSubscription .rmBase__comp--heading {
        color: #021C1E;
        font-size: 36px;
        line-height: 45px;
    }

    #rmOrganism .rmSubscription .rmBase__comp--text {
        font-size: 16px;
        line-height: 24px;
    }

    #rmOrganism .rmSubscription .rmBase__compLabel {
        color: #C9CED4;
    }

    #rmOrganism .rmSubscription .rmBase__comp--cta {
        font-size: 16px;
    }

    #rmOrganism .rmPopup__close {
        font-family: Arial, Helvetica, sans-serif;
    }

    #rmOrganism .rmPopup__backdrop {
        background: #303233;
        opacity: 0.6;
    }

        #rmOrganism .rmPage {
        background: #F7F9FA;
        color: #969A9E;
        font-family: Arial, Helvetica, sans-serif;
    }

    #rmOrganism .rmPage .rmBase__comp--heading {
        color: #021C1E;
    }

    #rmOrganism .rmPage .rmBase__compLabel {
        color: #969A9E;
    }

    
</style>
</div><style>.rmBody{margin:0;padding:0}#rmOrganism{box-sizing:border-box}#rmOrganism *{color:currentColor;border:0;font-size:100%;font:inherit;margin:0;outline:none;padding:0;vertical-align:baseline}#rmOrganism *,#rmOrganism :after,#rmOrganism :before{box-sizing:inherit}#rmOrganism button::-moz-focus-inner,#rmOrganism input::-moz-focus-inner{border:0;padding:0}#rmOrganism input[type=email],#rmOrganism input[type=password],#rmOrganism input[type=text],#rmOrganism textarea{-webkit-appearance:none}#rmOrganism .hidden{display:none!important}#rmOrganism .rmPopup__container{bottom:0;display:none;left:0;overflow:hidden;pointer-events:none;position:fixed;right:0;top:0;z-index:1000}#rmOrganism .rmPopup__container.rmPopup--show{display:flex}#rmOrganism .rmPopup__container .rmPopup__backdrop{display:block;height:100%;left:0;pointer-events:auto;position:absolute;top:0;width:100%}#rmOrganism .rmPopup__container .rmPopup{overflow:hidden;pointer-events:auto}#rmOrganism .rmPopup__container .rmPopup .rmPopup__close{align-items:center;background:rgba(0,0,0,.6);border-radius:100%;color:#fff;cursor:pointer;display:flex;flex-direction:column;font-family:Arial,Helvetica,sans-serif;font-size:20px;font-weight:700;height:1.6em;justify-content:center;line-height:1;position:absolute;right:2px;text-align:center;top:2px;width:1.6em;z-index:100}#rmOrganism .rmPopup__container .rmPopup.rmPopup--modal{border-radius:1em 1em 0 0;max-height:90%;overflow:hidden;position:absolute;bottom:0;left:50%;transform:translate(-50%);width:98%}@media screen and (min-width:768px){#rmOrganism .rmPopup__container .rmPopup.rmPopup--modal{border-radius:1em;box-shadow:0 0 1em rgba(0,0,0,.25);bottom:auto;top:5%;width:calc(100% - 2em)}}#rmOrganism .rmPopup__container .rmPopup.rmPopup--sidebar{border-radius:1em 0 0 0;box-shadow:0 0 1em rgba(0,0,0,.25);max-height:calc(100% - 1em);overflow:hidden;position:absolute;right:0;bottom:0;width:calc(100% - 1em)}#rmOrganism .rmPopup__container .rmPopup.rmPopup--banner{box-shadow:0 0 1em rgba(0,0,0,.15);overflow:hidden;position:absolute;left:0;width:100%}#rmOrganism .rmPopup__container .rmPopup.rmPopup--banner.rmLayout--banner-top{top:0}#rmOrganism .rmPopup__container .rmPopup.rmPopup--banner.rmLayout--banner-bottom{bottom:0}#rmOrganism .rmBase__el .comp__input,#rmOrganism .rmBase__el .comp__select{background:#fff;border:none;border-radius:.25em;box-shadow:inset 0 2px 1px rgba(0,0,0,.05),inset 0 0 0 1px rgba(0,0,0,.2);color:#666;font-family:inherit;font-size:1em;font-weight:400;height:2.5em;line-height:1.5;margin:0;outline:none;padding:.5em;vertical-align:top;width:100%}#rmOrganism .rmBase__el .comp__input:focus,#rmOrganism .rmBase__el .comp__select:focus{box-shadow:inset 0 2px 1px rgba(0,0,0,.05),inset 0 0 0 1px rgba(0,0,0,.5);color:#666;outline:none}#rmOrganism .rmBase__el .comp__input::placeholder{color:currentColor!important;opacity:1!important}#rmOrganism .rmBase__el.rmBase__el--has-error .rmBase__compError{display:inline-block}#rmOrganism .rmBase__el--title .rmBase__comp--titleInput{margin-top:1em}#rmOrganism .rmBase__el--image{margin:0!important}#rmOrganism .rmBase__comp--image{background:no-repeat 50%;height:100%;position:relative;width:100%}#rmOrganism .rmBase__comp--image.image--fit{background-size:cover}#rmOrganism .rmBase__comp--image .image__link{display:block;height:100%;width:100%}#rmOrganism .rmBase__comp--logo{border:none;display:inline-block;height:auto;max-width:100%;vertical-align:top}#rmOrganism .rmBase__comp--logolink{display:inline-block}#rmOrganism .rmBase__comp--cta{cursor:pointer;display:inline-block;font-family:inherit;line-height:1.5;font-weight:700;text-align:center;padding:.5em 1.5em}#rmOrganism .rmBase__comp--button,#rmOrganism .rmBase__comp--link{cursor:pointer;display:inline-block;line-height:1.5;text-decoration:none}#rmOrganism .rmBase__comp--link{font-weight:400;padding:.5em 0}#rmOrganism .rmBase__comp--link:hover{text-decoration:underline}#rmOrganism .rmBase__comp--button{font-weight:700;padding:.5em 1em}#rmOrganism .rmBase__comp--textlink{cursor:pointer;font-weight:400;text-decoration:none}#rmOrganism .rmBase__comp--textlink:hover{text-decoration:underline}#rmOrganism .rmBase__comp--captcha{display:inline-block;max-width:100%;overflow:hidden;text-align:left;vertical-align:top}#rmOrganism .rmBase__comp--coupon{border:2px dashed;display:inline-block;line-height:1.5;padding:.75em 2.25em}#rmOrganism .rmBase__comp--birthday{display:flex}#rmOrganism .rmBase__comp--birthday .comp__select{flex-grow:1;min-width:1%}#rmOrganism .rmBase__comp--birthday .comp__select:not(:first-child){margin-left:1em}#rmOrganism .rmBase__comp--privacy{align-items:center;display:flex}#rmOrganism .rmBase__comp--privacy .privacy__visual{flex-shrink:0;font-size:16px;height:4em;margin-right:1em;width:4em}#rmOrganism .rmBase__comp--privacy .privacy__text{font-size:11px;line-height:1.4;text-align:left}#rmOrganism .rmBase__comp--privacy .privacy__text a{color:currentColor;text-decoration:underline}#rmOrganism .rmBase__comp--checkbox .vFormCheckbox,#rmOrganism .rmBase__comp--radio .vFormCheckbox{align-items:flex-start;display:inline-flex}#rmOrganism .rmBase__comp--checkbox .vFormCheckbox .vFormCheckbox__indicator,#rmOrganism .rmBase__comp--radio .vFormCheckbox .vFormCheckbox__indicator{background:#fff;border:1px solid #ccc;border-radius:.125em;color:#666;cursor:pointer;display:inline-block;flex-shrink:0;font-size:1.25em;height:1em;line-height:0;position:relative;vertical-align:top;width:1em}#rmOrganism .rmBase__comp--checkbox .vFormCheckbox .vFormCheckbox__input,#rmOrganism .rmBase__comp--radio .vFormCheckbox .vFormCheckbox__input{display:none;left:0;opacity:0;position:absolute;top:0}#rmOrganism .rmBase__comp--checkbox .vFormCheckbox .vFormCheckbox__input:checked~.vFormCheckbox__indicator:after,#rmOrganism .rmBase__comp--radio .vFormCheckbox .vFormCheckbox__input:checked~.vFormCheckbox__indicator:after{background:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' width='10' height='10'%3E%3Cpath fill='%23333' d='M19.4 2.6c-.8-.8-2-.8-2.8 0L6.4 12.8l-3-3.1c-.8-.8-2-.8-2.8 0-.8.8-.8 2 0 2.8L5.1 17c.8.8 2 .8 2.8 0l1.4-1.4L19.4 5.4c.8-.8.8-2 0-2.8z'/%3E%3C/svg%3E") no-repeat 50%;content:"";display:block;height:.75em;left:50%;margin:-.375em 0 0 -.375em;position:absolute;top:50%;width:.75em}#rmOrganism .rmBase__comp--checkbox .vFormCheckbox .vFormCheckbox__label,#rmOrganism .rmBase__comp--radio .vFormCheckbox .vFormCheckbox__label{font-size:1em;line-height:1.25;margin:0}#rmOrganism .rmBase__comp--checkbox .vFormCheckbox .vFormCheckbox__indicator~.vFormCheckbox__label,#rmOrganism .rmBase__comp--radio .vFormCheckbox .vFormCheckbox__indicator~.vFormCheckbox__label{margin:0 0 0 .75em}#rmOrganism .rmBase__comp--checkbox .vFormCheckbox:hover .vFormCheckbox__indicator,#rmOrganism .rmBase__comp--radio .vFormCheckbox:hover .vFormCheckbox__indicator{border-color:#666}#rmOrganism .rmBase__comp--checkbox{font-size:1em;line-height:1.25}#rmOrganism .rmBase__comp--radio{padding-top:.625em}#rmOrganism .rmBase__comp--radio .vFormRadio__group--inline,#rmOrganism .rmBase__comp--radio .vFormRadio__group--stacked{display:inline-flex;flex-direction:row;flex-wrap:wrap}#rmOrganism .rmBase__comp--radio .vFormRadio__group--stacked{flex-direction:column}#rmOrganism .rmBase__comp--radio .vFormRadio{align-items:flex-start;display:inline-flex;vertical-align:top}#rmOrganism .rmBase__comp--radio .vFormRadio .vFormRadio__indicator{background:#fff;border:1px solid #ccc;border-radius:100%;color:#666;cursor:pointer;display:inline-block;flex-shrink:0;font-size:1.25em;height:1em;position:relative;vertical-align:top;width:1em}#rmOrganism .rmBase__comp--radio .vFormRadio .vFormRadio__input{display:none;left:0;opacity:0;position:absolute;top:0}#rmOrganism .rmBase__comp--radio .vFormRadio .vFormRadio__input:checked~.vFormRadio__indicator:after{background:currentColor;border-radius:100%;content:"";display:block;height:.5em;left:50%;margin:-.25em 0 0 -.25em;position:absolute;top:50%;width:.5em}#rmOrganism .rmBase__comp--radio .vFormRadio .vFormRadio__label{font-size:1em;line-height:1.25;margin:0 0 0 .75em}#rmOrganism .rmBase__comp--radio .vFormRadio:hover .vFormRadio__indicator{border-color:#666}#rmOrganism .rmBase__comp--radio .vFormRadio--inline{display:inline-flex}#rmOrganism .rmBase__comp--radio .vFormRadio--inline:not(:first-child){margin-left:1em}#rmOrganism .rmBase__comp--radio .vFormRadio--stacked{display:flex}#rmOrganism .rmBase__comp--radio .vFormRadio--stacked:not(:first-child){margin-top:.5em}#rmOrganism .rmBase__compError{border-radius:3px;display:none;font-size:12px;font-weight:700;line-height:1.5;margin-top:2px;padding:1px 5px}#rmOrganism .rmBase__compError--radio{margin-top:.5em}#rmOrganism .rmBase__comp--legal-noticeDivider{background:currentColor;border:none;color:inherit;display:inline-block;font-size:1em;height:2px;line-height:0;margin-bottom:1em;opacity:.25;overflow:hidden;width:10em}#rmOrganism .rmBase__comp--legal-notice{font-size:11px;line-height:1.4}@media screen and (min-width:480px){#rmOrganism .rmSubscription .rmBase__el.rmBase__el--label-pos-left{display:flex}#rmOrganism .rmSubscription .rmBase__el.rmBase__el--label-pos-left .rmBase__compLabel{flex-basis:30%;flex-shrink:0;hyphens:auto;margin:0;max-width:30%;padding:.625em .5em 0 0}#rmOrganism .rmSubscription .rmBase__el.rmBase__el--label-pos-left .rmBase__compContainer{flex-grow:1}}#rmOrganism .rmLayout--vertical.rmBase{display:flex;flex-direction:column;max-width:480px}@media screen and (min-width:768px){#rmOrganism .rmLayout--vertical.rmBase .rmBase__container{padding:2em}}#rmOrganism .rmLayout--vertical.rmBase.rmLayout--vertical-image-top .rmBase__el--image{flex-shrink:0;height:100px}@media screen and (min-width:768px){#rmOrganism .rmLayout--vertical.rmBase.rmLayout--vertical-image-top .rmBase__el--image{height:140px}}#rmOrganism .rmLayout--vertical.rmBase.rmLayout--vertical-image-right{max-width:640px}#rmOrganism .rmLayout--vertical.rmBase.rmLayout--vertical-image-right .rmBase__el--image{flex-shrink:0;height:100px}@media screen and (min-width:768px){#rmOrganism .rmLayout--vertical.rmBase.rmLayout--vertical-image-right .rmBase__body{flex-direction:row}#rmOrganism .rmLayout--vertical.rmBase.rmLayout--vertical-image-right .rmBase__el--image{flex-basis:0px;flex-grow:1;height:auto;order:10}#rmOrganism .rmLayout--vertical.rmBase.rmLayout--vertical-image-right .rmBase__content{flex-basis:80%;flex-grow:1;flex-shrink:0;max-width:400px}}#rmOrganism .rmLayout--vertical.rmBase.rmLayout--vertical-image-bottom .rmBase__el--image{flex-shrink:0;height:100px;order:10}@media screen and (min-width:768px){#rmOrganism .rmLayout--vertical.rmBase.rmLayout--vertical-image-bottom .rmBase__el--image{height:140px}}#rmOrganism .rmLayout--vertical.rmBase.rmLayout--vertical-image-left{max-width:640px}#rmOrganism .rmLayout--vertical.rmBase.rmLayout--vertical-image-left .rmBase__el--image{flex-shrink:0;height:100px}@media screen and (min-width:768px){#rmOrganism .rmLayout--vertical.rmBase.rmLayout--vertical-image-left .rmBase__body{flex-direction:row}#rmOrganism .rmLayout--vertical.rmBase.rmLayout--vertical-image-left .rmBase__el--image{flex-basis:0px;flex-grow:1;height:auto}#rmOrganism .rmLayout--vertical.rmBase.rmLayout--vertical-image-left .rmBase__content{flex-basis:80%;flex-grow:1;flex-shrink:0;max-width:400px}}#rmOrganism .rmLayout--horizontal.rmBase{display:flex;flex-direction:column;max-width:640px}@media screen and (min-width:768px){#rmOrganism .rmLayout--horizontal.rmBase .rmBase__container{padding:2em}#rmOrganism .rmLayout--horizontal.rmBase .rmBase__section{display:flex;flex-direction:row}#rmOrganism .rmLayout--horizontal.rmBase .rmBase__section .rmBase__el{flex-basis:0px;flex-grow:1;margin-right:1em}#rmOrganism .rmLayout--horizontal.rmBase .rmBase__section .rmBase__el:last-child{margin-right:0}#rmOrganism .rmLayout--horizontal.rmBase .rmBase__section .rmBase__el--cta:not(:only-child),#rmOrganism .rmLayout--horizontal.rmBase .rmBase__section .rmBase__el--link:not(:only-child){flex-basis:auto;flex-grow:0;flex-shrink:0}#rmOrganism .rmLayout--horizontal.rmBase .rmBase__section .rmBase__el--label-pos-top~.rmBase__el--cta:not(:only-child),#rmOrganism .rmLayout--horizontal.rmBase .rmBase__section .rmBase__el--label-pos-top~.rmBase__el--link:not(:only-child){align-self:flex-end}#rmOrganism .rmLayout--horizontal.rmBase .rmBase__section:last-child .rmBase__el{margin-bottom:0}}#rmOrganism .rmLayout--horizontal.rmBase.rmLayout--horizontal-image-right{max-width:800px}#rmOrganism .rmLayout--horizontal.rmBase.rmLayout--horizontal-image-right .rmBase__el--image{flex-shrink:0;height:100px}@media screen and (min-width:768px){#rmOrganism .rmLayout--horizontal.rmBase.rmLayout--horizontal-image-right .rmBase__body{flex-direction:row}#rmOrganism .rmLayout--horizontal.rmBase.rmLayout--horizontal-image-right .rmBase__el--image{flex-basis:0px;flex-grow:1;height:auto;order:10}#rmOrganism .rmLayout--horizontal.rmBase.rmLayout--horizontal-image-right .rmBase__content{flex-basis:90%;flex-grow:1;flex-shrink:0;max-width:640px}}#rmOrganism .rmLayout--horizontal.rmBase.rmLayout--horizontal-image-left{max-width:800px}#rmOrganism .rmLayout--horizontal.rmBase.rmLayout--horizontal-image-left .rmBase__el--image{flex-shrink:0;height:100px}@media screen and (min-width:768px){#rmOrganism .rmLayout--horizontal.rmBase.rmLayout--horizontal-image-left .rmBase__body{flex-direction:row}#rmOrganism .rmLayout--horizontal.rmBase.rmLayout--horizontal-image-left .rmBase__el--image{flex-basis:0px;flex-grow:1;height:auto}#rmOrganism .rmLayout--horizontal.rmBase.rmLayout--horizontal-image-left .rmBase__content{flex-basis:90%;flex-grow:1;flex-shrink:0;max-width:640px}}@media screen and (min-width:768px){#rmOrganism .rmLayout--banner.rmBase{display:flex;flex-direction:column}#rmOrganism .rmLayout--banner.rmBase .rmBase__content{margin:0 auto;max-width:1200px;width:100%}#rmOrganism .rmLayout--banner.rmBase .rmBase__container{padding:1em 2em}#rmOrganism .rmLayout--banner.rmBase .rmBase__section{display:flex;flex-direction:row;min-width:480px}#rmOrganism .rmLayout--banner.rmBase .rmBase__section .rmBase__el{flex-basis:0px;flex-grow:1;margin-right:1em}#rmOrganism .rmLayout--banner.rmBase .rmBase__section .rmBase__el:last-child{margin-right:0}#rmOrganism .rmLayout--banner.rmBase .rmBase__section .rmBase__el--cta:not(:only-child),#rmOrganism .rmLayout--banner.rmBase .rmBase__section .rmBase__el--link:not(:only-child){flex-basis:auto;flex-grow:0;flex-shrink:0}#rmOrganism .rmLayout--banner.rmBase .rmBase__section .rmBase__el--label-pos-top~.rmBase__el--cta:not(:only-child),#rmOrganism .rmLayout--banner.rmBase .rmBase__section .rmBase__el--label-pos-top~.rmBase__el--link:not(:only-child){align-self:flex-end}#rmOrganism .rmLayout--banner.rmBase .rmBase__section:last-child .rmBase__el{margin-bottom:0}}#rmOrganism .rmSubscription.rmBase__body{display:flex;flex-direction:column;overflow:hidden}#rmOrganism .rmSubscription .rmBase__content{-webkit-overflow-scrolling:touch;box-sizing:border-box;margin:0;overflow:auto}#rmOrganism .rmSubscription .rmBase__container{padding:2em 1em}#rmOrganism .rmSubscription .rmBase__el .rmBase__compLabel{display:block;line-height:1.25;margin:0 0 .25em;max-width:99%;overflow:hidden;text-overflow:ellipsis;vertical-align:top;white-space:nowrap}#rmOrganism .rmSubscription .rmBase__el.rmBase__el--label-pos-none .rmBase__compLabel.rmBase__compLabel--hideable{display:none}#rmOrganism .rmSubscription .rmBase__el.rmBase__el--cta{display:flex;flex-direction:column}#rmOrganism .rmSubscription .rmBase__section:last-child .rmBase__el:last-child{margin-bottom:0}.rmBody.rmBody--subscription.rmBody--popup{background:#e9edf2}.rmBody.rmBody--subscription.rmBody--embed #rmOrganism .rmBase{margin:0 auto}#rmOrganism .rmPage{font-size:16px}#rmOrganism .rmPage .rmBase__container{margin:0 auto;max-width:44em;padding:2em 1em}@media screen and (min-width:768px){#rmOrganism .rmPage .rmBase__container{padding:2em}}#rmOrganism .rmPage .rmBase__comp--heading{font-size:2em;line-height:1.25}#rmOrganism .rmPage .rmBase__compLabel{display:block;line-height:1.25;margin:0 0 .25em;max-width:99%;overflow:hidden;text-overflow:ellipsis;vertical-align:top;white-space:nowrap}#rmOrganism .rmPage .rmBase__el{font-size:1em;line-height:1.4;margin-bottom:1em}#rmOrganism .rmPage .rmBase__el--logo{margin:0 0 3em}#rmOrganism .rmPage .rmBase__el--coupon,#rmOrganism .rmPage .rmBase__el--cta,#rmOrganism .rmPage .rmBase__el--unsubscribe-reason{margin:3em 0}#rmOrganism .rmPage .rmBase__el--coupon .rmBase__compLabel,#rmOrganism .rmPage .rmBase__el--unsubscribe-reason .rmBase__compLabel{margin:0 0 .5em;max-width:100%;overflow:visible;text-overflow:unset;white-space:normal}#rmOrganism .rmPage .rmBase__el--unsubscribe-reason{text-align:left}#rmOrganism .rmPage .rmBase__el--legal-notice{margin-top:3rem;text-align:left}#rmOrganism .rmPage .rmBase__section:last-child .rmBase__el:last-child{margin-bottom:0}#rmOrganism .rmLayout--page-centered .rmPage .rmBase__container,#rmOrganism .rmLayout--page-centered .rmPage .rmBase__container .rmBase__el--legal-notice{text-align:center}#rmOrganism .rmLayout--legacy .rmBase__el .comp__input,#rmOrganism .rmLayout--legacy .rmBase__el .comp__select{border-radius:0;height:2em;padding:.25em .5em}@media screen and (min-width:360px){#rmOrganism .rmLayout--legacy .rmSubscription .rmBase__el.rmBase__el--label-pos-left{display:flex}#rmOrganism .rmLayout--legacy .rmSubscription .rmBase__el.rmBase__el--label-pos-left .rmBase__compLabel{flex-basis:140px;flex-shrink:0;hyphens:auto;margin:0;max-width:140px;padding:.375em .5em 0 0}#rmOrganism .rmLayout--legacy .rmSubscription .rmBase__el.rmBase__el--label-pos-left .rmBase__compContainer{flex-grow:1}}#rmOrganism .rmLayout--legacy.rmBase{display:flex;flex-direction:column;max-width:400px}#rmOrganism .rmLayout--legacy.rmBase .rmBase__container{padding:10px}.rmBody.rmBody--subscription.rmBody--legacy{background:transparent}.rmBody.rmBody--subscription.rmBody--legacy.rmBody--embed #rmOrganism .rmBase{margin:0 auto 0 0}</style><script src="./Infused energy_files/trustbadge.js.download" charset="utf-8" data-type="trustbadge-business-logic"></script><iframe id="trustbadge-iframe" style="display: none;" src="./Infused energy_files/saved_resource.html"></iframe><div id="trustbadge-container-98e3dadd90eb493088abdc5597a70810" style="z-index: 2147483647; position: fixed;"><div class="_t53mel"><div id="minimized-trustbadge-98e3dadd90eb493088abdc5597a70810" data-testid="minimized-trustbadge-floating" class="_1u68cu3"><p id="trustbadge-minimized-menu-button-98e3dadd90eb493088abdc5597a70810" data-testid="trustbadge-minimized-menu-button" class="_14hdeiv"><img alt="ellipsis" width="10" height="3" src="./Infused energy_files/sprite.fa10bbbffbb158ef65643d1dccd20ba7bd355392.svg" class="_fhufc4"></p><div data-testid="trustmark-container-floating" class="_1tcd14j"><img alt="trustmark" width="50" height="50" src="./Infused energy_files/sprite(1).fa10bbbffbb158ef65643d1dccd20ba7bd355392.svg" class="_lfj93"><p class="_1bse7md">Käuferschutz</p></div><div class="_18uerla"></div><div data-testid="trustbadge-floating-reviews-container" class="_15odmu7"><div id="ratingStarsContainer-98e3dadd90eb493088abdc5597a70810" data-testid="rating-stars-container" class="_1wkl6o"><div class="_13jbtvd"><img alt="star-gray" width="34" height="32" src="./Infused energy_files/sprite(2).fa10bbbffbb158ef65643d1dccd20ba7bd355392.svg" data-testid="rating-star-gray" class="_18s8z9d"><img alt="star-gray" width="34" height="32" src="./Infused energy_files/sprite(2).fa10bbbffbb158ef65643d1dccd20ba7bd355392.svg" data-testid="rating-star-gray" class="_18s8z9d"><img alt="star-gray" width="34" height="32" src="./Infused energy_files/sprite(2).fa10bbbffbb158ef65643d1dccd20ba7bd355392.svg" data-testid="rating-star-gray" class="_18s8z9d"><img alt="star-gray" width="34" height="32" src="./Infused energy_files/sprite(2).fa10bbbffbb158ef65643d1dccd20ba7bd355392.svg" data-testid="rating-star-gray" class="_18s8z9d"><img alt="star-gray" width="34" height="32" src="./Infused energy_files/sprite(2).fa10bbbffbb158ef65643d1dccd20ba7bd355392.svg" data-testid="rating-star-gray" class="_qf3tps"></div><div class="_2i9bci"><img alt="star-yellow" width="34" height="32" src="./Infused energy_files/sprite(3).fa10bbbffbb158ef65643d1dccd20ba7bd355392.svg" data-testid="rating-star-yellow" class="_18s8z9d"><img alt="star-yellow" width="34" height="32" src="./Infused energy_files/sprite(3).fa10bbbffbb158ef65643d1dccd20ba7bd355392.svg" data-testid="rating-star-yellow" class="_18s8z9d"><img alt="star-yellow" width="34" height="32" src="./Infused energy_files/sprite(3).fa10bbbffbb158ef65643d1dccd20ba7bd355392.svg" data-testid="rating-star-yellow" class="_18s8z9d"><img alt="star-yellow" width="34" height="32" src="./Infused energy_files/sprite(3).fa10bbbffbb158ef65643d1dccd20ba7bd355392.svg" data-testid="rating-star-yellow" class="_18s8z9d"><img alt="star-yellow" width="34" height="32" src="./Infused energy_files/sprite(3).fa10bbbffbb158ef65643d1dccd20ba7bd355392.svg" data-testid="rating-star-yellow" class="_qf3tps"></div></div><p class="_17wvbpl"><span class="_368rpk">4,72</span></p><p class="_jkmglk">Sehr gut</p></div></div></div></div></body><div id="tella-plugin"><template shadowrootmode="open"><div style="font-size: 16px; font-weight: 400; user-select: none"></div><link rel="stylesheet" type="text/css" href="chrome-extension://enejkfhimljloggnimhebadbjajhgkad/build/index.css"></template></div><grammarly-desktop-integration data-grammarly-shadow-root="true"><template shadowrootmode="open"><style>
      div.grammarly-desktop-integration {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select:none;
        user-select:none;
      }

      div.grammarly-desktop-integration:before {
        content: attr(data-content);
      }
    </style><div aria-label="grammarly-integration" role="group" tabindex="-1" class="grammarly-desktop-integration" data-content="{&quot;mode&quot;:&quot;full&quot;,&quot;isActive&quot;:true,&quot;isUserDisabled&quot;:false}"></div></template></grammarly-desktop-integration></html>