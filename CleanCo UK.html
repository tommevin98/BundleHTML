<!DOCTYPE html>
<!-- saved from url=(0077)https://clean.co/apps/gbb/easybundle/2?page=addProductsPage1&currentFlow=byob -->
<html class="js no-touch bundle-2 gbbBundle-HTML" lang="en" data-google-analytics-opt-out="" style="--gbb-product-card-bg-color: #f1f2f3; --gbb-product-card-text-color: #252525; --gbb-product-card-final-price-visibility: block; --gbb-product-card-compare-at-price-visibility: block; --gbb-product-card-button-color: #000000; --gbb-product-card-button-text-color: #ffffff; --gbb-product-card-allow-only-one-quantity: block; --gbb-navigation-banner-title-color: #ffffff; --gbb-navigation-banner-text-color: #ffffff; --gbb-navigation-banner-step-completion-color: #000000; --gbb-navigation-banner-step-done-color: #ffffff; --gbb-navigation-banner-step-text-color: #000000; --gbb-cart-footer-bg-color: #f1f2f3; --gbb-cart-footer-show-hide-prices: visible; --gbb-cart-footer-text-color: #000000; --gbb-cart-footer-back-button-color: #6d7175; --gbb-cart-footer-back-button-text-color: #ffffff; --gbb-cart-footer-next-button-text-color: #ffffff; --gbb-cart-footer-next-button-color: #000000; --gbb-cart-footer-discount-text-color: #000000; --gbb-cart-footer-discount-text-visibility: visible;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="apple-touch-icon" sizes="180x180" href="https://clean.co/cdn/shop/t/191/assets/apple-touch-icon.png?v=79141617026047500451734353636">
<link rel="icon" type="image/png" sizes="32x32" href="https://clean.co/cdn/shop/t/191/assets/favicon-32x32.png?v=60387222737736828551734353636">
<link rel="icon" type="image/png" sizes="16x16" href="https://clean.co/cdn/shop/t/191/assets/favicon-16x16.png?v=123835429961310568321734353636">
<link rel="manifest" href="https://clean.co/cdn/shop/t/191/assets/site.webmanifest?v=120163857677330376811734357861">
<link rel="shortcut icon" href="https://clean.co/cdn/shop/t/191/assets/favicon.ico?v=77810498735972283091734353636">
<meta name="msapplication-TileColor" content="#F7F2E8">
<meta name="msapplication-config" content="//clean.co/cdn/shop/t/191/assets/browserconfig.xml?v=2004639817750690231734357861">
<meta name="theme-color" content="#F7F2E8">

<link rel="canonical" href="https://clean.co/apps/gbb/easybundle/2?page=addproductspage1">
<link rel="preconnect" href="https://cdn.shopify.com/" crossorigin="">
<title>CleanCo UK</title>
<meta name="description" content="CleanCo UK">


<meta property="og:site_name" content="CleanCo UK">
<meta property="og:url" content="https://clean.co/apps/gbb/easybundle/2?page=addproductspage1">
<meta property="og:title" content="CleanCo UK">
<meta property="og:type" content="website">
<meta property="og:description" content="Discover our Clean Spirits, perfect in a G&amp;T, a Mojito, an Old Fashioned, a Margarita, a Moscow Mule... Why Clean? A more positive approach to alcohol-free drinks. It makes it easier to order at the bar and more sense for people who drink less, or not at all, as part of a cleaner lifestyle. Life tastes better clean!"><meta property="og:image" content="http://clean.co/cdn/shop/files/3_8cad25b0-456b-4f3d-a538-46189b7fc76c.png?v=1699374121">
  <meta property="og:image:secure_url" content="https://clean.co/cdn/shop/files/3_8cad25b0-456b-4f3d-a538-46189b7fc76c.png?v=1699374121">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="628"><meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="CleanCo UK">
<meta name="twitter:description" content="Discover our Clean Spirits, perfect in a G&amp;T, a Mojito, an Old Fashioned, a Margarita, a Moscow Mule... Why Clean? A more positive approach to alcohol-free drinks. It makes it easier to order at the bar and more sense for people who drink less, or not at all, as part of a cleaner lifestyle. Life tastes better clean!">
<style data-shopify="">
    :root {
      --ice: #f7f2e8;
      --blue: #1c98a5;
      --rosemary: #0b464c;

      --headerFillBackground: var(--ice);
      --headerFillText: var(--rosemary);
      --headerFillHoverBackground: var(--rosemary);
      --headerFillHoverText: var(--ice);
    }

    .header-revealed [data-sticky] {
      top: calc(var(--headerHeight) + 20px);
    }

    .header-revealed [data-sticky][data-mobile-faq-nav] {
      top: var(--headerHeight);
    }

    @font-face {
      font-family: 'GT Pressura';
      src: url('//clean.co/cdn/shop/t/191/assets/GTPressura-Bold.woff2?v=147310364943571791781734353636') format('woff2'), url('//clean.co/cdn/shop/t/191/assets/GTPressura-Bold.woff?v=17478584505350873511734353636') format('woff');
      font-weight: bold;
      font-style: normal;
      font-display: swap;
    }

    @font-face {
      font-family: 'YWFT Ultramagnetic';
      src: url('//clean.co/cdn/shop/t/191/assets/YWFTUltramagnetic-Regular.woff2?v=105474295226107163471734353636') format('woff2'), url('//clean.co/cdn/shop/t/191/assets/YWFTUltramagnetic-Regular.woff?v=64200305935014866941734353636') format('woff');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }

    @font-face {
      font-family: 'Calvino';
      src: url('//clean.co/cdn/shop/t/191/assets/Calvino-Italic.woff2?v=57669728920104814451734353636') format('woff2'),
          url('//clean.co/cdn/shop/t/191/assets/Calvino-Italic.woff?v=141616840112640355351734353636') format('woff');
      font-weight: normal;
      font-style: italic;
      font-display: swap;
  }

    @font-face {
      font-family: 'Rubik';
      src: url('//clean.co/cdn/shop/t/191/assets/Rubik-Regular.woff2?v=69186707810362592591734353636') format('woff2'), url('//clean.co/cdn/shop/t/191/assets/Rubik-Regular.woff?v=100452957150786689091734353636') format('woff');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }
</style>
<script async="" src="./CleanCo UK_files/tp.min.js.download" type="text/javascript"></script><script type="text/javascript" async="" src="./CleanCo UK_files/instafeed-3746c8b738a50a742caac24296efc1ed.js.download"></script><script type="text/javascript" async="" src="./CleanCo UK_files/script_d7731b8a6dab08eb1492d5afe8d9b431.js.download"></script><script type="text/javascript" async="" src="./CleanCo UK_files/awin-shopify-integration-code.js.download"></script><script type="text/javascript" async="" src="./CleanCo UK_files/c5imCWRvuJVcZI1mxTxJPQ.js.download"></script><script type="text/javascript" async="" src="./CleanCo UK_files/dtag.js.download"></script><script type="text/javascript" async="" src="./CleanCo UK_files/sfdr.js.download"></script><script type="text/javascript" async="" src="./CleanCo UK_files/clean-liquor.myshopify.com.js.download"></script><script type="text/javascript" async="" src="./CleanCo UK_files/header.min.js.download"></script><script type="text/javascript" async="" src="./CleanCo UK_files/destination"></script><script async="true" src="./CleanCo UK_files/fbevents.js.download"></script><script async="" src="./CleanCo UK_files/analytics.js.download"></script><script type="text/javascript" async="" src="./CleanCo UK_files/trekkie.storefront.c44d6898594db6c4847cb75ef4de7d5f4456a012.min.js.download"></script><script type="text/javascript">
  // Set class to define javascript support
  document.documentElement.className = document.documentElement.className.replace('no-js', 'js');

  // Set class to define touch support. Browsers must refresh to detect touch-support changes
  if (!!('ontouchstart' in document)) {
    document.documentElement.className = document.documentElement.className.replace('no-touch', 'touch');
  }

  // Set class to define if iOS device. Browsers must refresh to detect iOS changes
  if (!!navigator.platform && /iPad|iPhone|iPod/.test(navigator.platform)) {
    const body = document.body || document.documentElement;
    body.classList.add('is-iOS');
  }
</script>


<script type="text/javascript" src="./CleanCo UK_files/tp.widget.bootstrap.min.js.download" async=""></script>
<script type="text/javascript" src="./CleanCo UK_files/sidebarv2.js.download" async="true"></script>





  <link href="./CleanCo UK_files/theme-95511e97.css" rel="stylesheet" type="text/css" media="all">





  <link rel="modulepreload" href="./CleanCo UK_files/theme-fbbd2d48.js.download" as="script" crossorigin="anonymous">
  <script src="./CleanCo UK_files/theme-fbbd2d48.js.download" type="module" crossorigin="anonymous"></script>


<script type="text/javascript">
      window.routes = {
        cart_add_url: '/cart/add',
        cart_change_url: '/cart/change',
        cart_update_url: '/cart/update',
        cart_url: '/cart',
        product_recommendations_url: '/recommendations/products',
        predictive_search_url: '/search/suggest'
      };

      document.addEventListener('DOMContentLoaded', () => {
        const body = document.body || document.documentElement;
        const header = document.querySelector('sticky-header');

        body.style.setProperty('--headerHeight', `${header.offsetHeight}px`);
      });
    </script>

    <script>window.performance && window.performance.mark && window.performance.mark('shopify.content_for_header.start');</script><meta name="google-site-verification" content="LAx4xYha9t-b0huvTeb8XG9B-PSMaAO7dCZxTY3OM_0">
<meta name="google-site-verification" content="z1DDFRpXvo-MWAMEbr7h7wf4XhV3diZ-upsU1BfEOIU">
<meta name="google-site-verification" content="IIgWb1OemeN9P-v0uss4S4Y0yPKEBow5BTas3YgIKgQ">
<meta name="google-site-verification" content="qmShzzYiBKYk-17qUXfa58Joe1KA4_DAe65YgumYa0E">
<meta id="shopify-digital-wallet" name="shopify-digital-wallet" content="/26795606113/digital_wallets/dialog">
<meta name="shopify-checkout-api-token" content="d5570629679b3a56ebb5c45d9bdca8e8">
<link rel="alternate" hreflang="x-default" href="https://clean.co/apps/gbb/easybundle/2?page=addProductsPage1">
<link rel="alternate" hreflang="en-IE" href="https://clean.co/en-ie/apps/gbb/easybundle/2?page=addProductsPage1">
<link rel="alternate" hreflang="en-GB" href="https://clean.co/apps/gbb/easybundle/2?page=addProductsPage1">
<script async="async" src="./CleanCo UK_files/preloads.js.download"></script>
<link rel="preconnect" href="https://shop.app/" crossorigin="anonymous">
<script async="async" src="./CleanCo UK_files/preloads(1).js.download" crossorigin="anonymous"></script>
<script id="apple-pay-shop-capabilities" type="application/json">{"shopId":26795606113,"countryCode":"GB","currencyCode":"GBP","merchantCapabilities":["supports3DS"],"merchantId":"gid:\/\/shopify\/Shop\/26795606113","merchantName":"CleanCo UK","requiredBillingContactFields":["postalAddress","email","phone"],"requiredShippingContactFields":["postalAddress","email","phone"],"shippingType":"shipping","supportedNetworks":["visa","maestro","masterCard","amex","discover","elo"],"total":{"type":"pending","label":"CleanCo UK","amount":"1.00"},"shopifyPaymentsEnabled":true,"supportsSubscriptions":false}</script>
<script id="shopify-features" type="application/json">{"accessToken":"d5570629679b3a56ebb5c45d9bdca8e8","betas":["rich-media-storefront-analytics"],"domain":"clean.co","predictiveSearch":true,"shopId":26795606113,"smart_payment_buttons_url":"https:\/\/clean.co\/cdn\/shopifycloud\/payment-sheet\/assets\/latest\/spb.en.js","dynamic_checkout_cart_url":"https:\/\/clean.co\/cdn\/shopifycloud\/payment-sheet\/assets\/latest\/dynamic-checkout-cart.en.js","locale":"en"}</script>
<script>var Shopify = Shopify || {};
Shopify.shop = "clean-liquor.myshopify.com";
Shopify.locale = "en";
Shopify.currency = {"active":"GBP","rate":"1.0"};
Shopify.country = "GB";
Shopify.theme = {"name":"0.0% cleanco\/dev - Greene King","id":123780530273,"schema_name":"CleanCo Theme","schema_version":"1.0.0","theme_store_id":null,"role":"main"};
Shopify.theme.handle = "null";
Shopify.theme.style = {"id":null,"handle":null};
Shopify.cdnHost = "clean.co/cdn";
Shopify.routes = Shopify.routes || {};
Shopify.routes.root = "/";</script>
<script type="module">!function(o){(o.Shopify=o.Shopify||{}).modules=!0}(window);</script>
<script>!function(o){function n(){var o=[];function n(){o.push(Array.prototype.slice.apply(arguments))}return n.q=o,n}var t=o.Shopify=o.Shopify||{};t.loadFeatures=n(),t.autoloadFeatures=n()}(window);</script>
<script>window.ShopifyPay = window.ShopifyPay || {};
window.ShopifyPay.apiHost = "shop.app\/pay";</script>
<script>
  window.Shopify = window.Shopify || {};
  if (!window.Shopify.featureAssets) window.Shopify.featureAssets = {};
  window.Shopify.featureAssets['shop-js'] = {"init-fed-cm":["modules/v2/client.init-fed-cm_BFfxuk4S.en.esm.js","modules/v2/chunk.common_fjasPWHi.esm.js"],"shop-cash-offers":["modules/v2/client.shop-cash-offers_BaNVYAZB.en.esm.js","modules/v2/chunk.common_fjasPWHi.esm.js","modules/v2/chunk.modal_D1sCEFKx.esm.js"],"init-shop-email-lookup-coordinator":["modules/v2/client.init-shop-email-lookup-coordinator_C_jSxxEe.en.esm.js","modules/v2/chunk.common_fjasPWHi.esm.js"],"shop-toast-manager":["modules/v2/client.shop-toast-manager_M1eQYh4b.en.esm.js","modules/v2/chunk.common_fjasPWHi.esm.js"],"checkout-modal":["modules/v2/client.checkout-modal_D-Cabmnu.en.esm.js","modules/v2/chunk.common_fjasPWHi.esm.js","modules/v2/chunk.modal_D1sCEFKx.esm.js"],"avatar":["modules/v2/client.avatar_BTnouDA3.en.esm.js"],"pay-button":["modules/v2/client.pay-button_Dg8MH-4A.en.esm.js","modules/v2/chunk.common_fjasPWHi.esm.js"],"shop-login-button":["modules/v2/client.shop-login-button_BpXSz6Zg.en.esm.js","modules/v2/chunk.common_fjasPWHi.esm.js","modules/v2/chunk.modal_D1sCEFKx.esm.js"],"init-customer-accounts-sign-up":["modules/v2/client.init-customer-accounts-sign-up_Dwr0Cwoo.en.esm.js","modules/v2/client.shop-login-button_BpXSz6Zg.en.esm.js","modules/v2/chunk.common_fjasPWHi.esm.js","modules/v2/chunk.modal_D1sCEFKx.esm.js"],"init-shop-for-new-customer-accounts":["modules/v2/client.init-shop-for-new-customer-accounts_BaG0AO37.en.esm.js","modules/v2/client.shop-login-button_BpXSz6Zg.en.esm.js","modules/v2/chunk.common_fjasPWHi.esm.js","modules/v2/chunk.modal_D1sCEFKx.esm.js"],"init-customer-accounts":["modules/v2/client.init-customer-accounts_D4rTpEBh.en.esm.js","modules/v2/client.shop-login-button_BpXSz6Zg.en.esm.js","modules/v2/chunk.common_fjasPWHi.esm.js","modules/v2/chunk.modal_D1sCEFKx.esm.js"],"shop-follow-button":["modules/v2/client.shop-follow-button_TeU2cQDV.en.esm.js","modules/v2/chunk.common_fjasPWHi.esm.js","modules/v2/chunk.modal_D1sCEFKx.esm.js"],"lead-capture":["modules/v2/client.lead-capture_Bl6Zih9m.en.esm.js","modules/v2/chunk.common_fjasPWHi.esm.js","modules/v2/chunk.modal_D1sCEFKx.esm.js"],"payment-terms":["modules/v2/client.payment-terms_B0SZr94x.en.esm.js","modules/v2/chunk.common_fjasPWHi.esm.js","modules/v2/chunk.modal_D1sCEFKx.esm.js"]};
</script>
<script>(function() {
  function asyncLoad() {
    var urls = ["https:\/\/ecommplugins-scripts.trustpilot.com\/v2.1\/js\/header.min.js?settings=eyJrZXkiOiI5N3hTTDlHSTFib21kcjc3IiwicyI6InNrdSJ9\u0026v=2.5\u0026shop=clean-liquor.myshopify.com","https:\/\/ecommplugins-trustboxsettings.trustpilot.com\/clean-liquor.myshopify.com.js?settings=1625240828895\u0026shop=clean-liquor.myshopify.com","https:\/\/sfdr.co\/sfdr.js?sid=41616\u0026shop=clean-liquor.myshopify.com","https:\/\/cdn.attn.tv\/clean\/dtag.js?shop=clean-liquor.myshopify.com","https:\/\/cdn-loyalty.yotpo.com\/loader\/c5imCWRvuJVcZI1mxTxJPQ.js?shop=clean-liquor.myshopify.com","https:\/\/dr4qe3ddw9y32.cloudfront.net\/awin-shopify-integration-code.js?aid=75084\u0026v=shopifyApp_4.3.0\u0026ts=1707822091307\u0026shop=clean-liquor.myshopify.com","https:\/\/cozycountryredirectiii.addons.business\/js\/eggbox\/14699\/script_d7731b8a6dab08eb1492d5afe8d9b431.js?v=1\u0026sign=d7731b8a6dab08eb1492d5afe8d9b431\u0026shop=clean-liquor.myshopify.com","https:\/\/storage.nfcube.com\/instafeed-3746c8b738a50a742caac24296efc1ed.js?shop=clean-liquor.myshopify.com"];
    for (var i = 0; i < urls.length; i++) {
      var s = document.createElement('script');
      s.type = 'text/javascript';
      s.async = true;
      s.src = urls[i];
      var x = document.getElementsByTagName('script')[0];
      x.parentNode.insertBefore(s, x);
    }
  };
  if(window.attachEvent) {
    window.attachEvent('onload', asyncLoad);
  } else {
    window.addEventListener('load', asyncLoad, false);
  }
})();</script>
<script id="__st">var __st={"a":26795606113,"offset":0,"reqid":"966be413-10bf-4ad9-a868-be5cb94b8f0c-1738917443","pageurl":"clean.co\/apps\/gbb\/easybundle\/2?page=addProductsPage1\u0026currentFlow=byob","u":"d665cd17c439"};</script>
<script>window.ShopifyPaypalV4VisibilityTracking = true;</script>
<script id="captcha-bootstrap">!function(){'use strict';const t='contact',e='account',n='new_comment',o=[[t,t],['blogs',n],['comments',n],[t,'customer']],c=[[e,'customer_login'],[e,'guest_login'],[e,'recover_customer_password'],[e,'create_customer']],r=t=>t.map((([t,e])=>`form[action*='/${t}']:not([data-nocaptcha='true']) input[name='form_type'][value='${e}']`)).join(','),a=t=>()=>t?[...document.querySelectorAll(t)].map((t=>t.form)):[];function s(){const t=[...o],e=r(t);return a(e)}const i='password',u='form_key',d=['recaptcha-v3-token','g-recaptcha-response','h-captcha-response',i],f=()=>{try{return window.sessionStorage}catch{return}},m='__shopify_v',_=t=>t.elements[u];function p(t,e,n=!1){try{const o=window.sessionStorage,c=JSON.parse(o.getItem(e)),{data:r}=function(t){const{data:e,action:n}=t;return t[m]||n?{data:e,action:n}:{data:t,action:n}}(c);for(const[e,n]of Object.entries(r))t.elements[e]&&(t.elements[e].value=n);n&&o.removeItem(e)}catch(o){console.error('form repopulation failed',{error:o})}}const l='form_type',E='cptcha';function T(t){t.dataset[E]=!0}const w=window,h=w.document,L='Shopify',v='ce_forms',y='captcha';let A=!1;((t,e)=>{const n=(g='f06e6c50-85a8-45c8-87d0-21a2b65856fe',I='https://cdn.shopify.com/shopifycloud/storefront-forms-hcaptcha/ce_storefront_forms_captcha_hcaptcha.v1.5.2.iife.js',D={infoText:'Protected by hCaptcha',privacyText:'Privacy',termsText:'Terms'},(t,e,n)=>{const o=w[L][v],c=o.bindForm;if(c)return c(t,g,e,D).then(n);var r;o.q.push([[t,g,e,D],n]),r=I,A||(h.body.append(Object.assign(h.createElement('script'),{id:'captcha-provider',async:!0,src:r})),A=!0)});var g,I,D;w[L]=w[L]||{},w[L][v]=w[L][v]||{},w[L][v].q=[],w[L][y]=w[L][y]||{},w[L][y].protect=function(t,e){n(t,void 0,e),T(t)},Object.freeze(w[L][y]),function(t,e,n,w,h,L){const[v,y,A,g]=function(t,e,n){const i=e?o:[],u=t?c:[],d=[...i,...u],f=r(d),m=r(i),_=r(d.filter((([t,e])=>n.includes(e))));return[a(f),a(m),a(_),s()]}(w,h,L),I=t=>{const e=t.target;return e instanceof HTMLFormElement?e:e&&e.form},D=t=>v().includes(t);t.addEventListener('submit',(t=>{const e=I(t);if(!e)return;const n=D(e)&&!e.dataset.hcaptchaBound&&!e.dataset.recaptchaBound,o=_(e),c=g().includes(e)&&(!o||!o.value);(n||c)&&t.preventDefault(),c&&!n&&(function(t){try{if(!f())return;!function(t){const e=f();if(!e)return;const n=_(t);if(!n)return;const o=n.value;o&&e.removeItem(o)}(t);const e=Array.from(Array(32),(()=>Math.random().toString(36)[2])).join('');!function(t,e){_(t)||t.append(Object.assign(document.createElement('input'),{type:'hidden',name:u})),t.elements[u].value=e}(t,e),function(t,e){const n=f();if(!n)return;const o=[...t.querySelectorAll(`input[type='${i}']`)].map((({name:t})=>t)),c=[...d,...o],r={};for(const[a,s]of new FormData(t).entries())c.includes(a)||(r[a]=s);n.setItem(e,JSON.stringify({[m]:1,action:t.action,data:r}))}(t,e)}catch(e){console.error('failed to persist form',e)}}(e),e.submit())}));const S=(t,e)=>{t&&!t.dataset[E]&&(n(t,e.some((e=>e===t))),T(t))};for(const o of['focusin','change'])t.addEventListener(o,(t=>{const e=I(t);D(e)&&S(e,y())}));const B=e.get('form_key'),M=e.get(l),P=B&&M;t.addEventListener('DOMContentLoaded',(()=>{const t=y();if(P)for(const e of t)e.elements[l].value===M&&p(e,B);[...new Set([...A(),...v().filter((t=>'true'===t.dataset.shopifyCaptcha))])].forEach((e=>S(e,t)))}))}(h,new URLSearchParams(w.location.search),n,t,e,['guest_login'])})(!1,!0)}();</script>
<script integrity="sha256-EGCDRYTvIEOXsReXgqGwkAR+5Dl8tickSrieA/ZcQwc=" data-source-attribution="shopify.loadfeatures" defer="defer" src="./CleanCo UK_files/load_feature-1060834584ef204397b1179782a1b090047ee4397cb627244ab89e03f65c4307.js.download" crossorigin="anonymous"></script>
<script crossorigin="anonymous" defer="defer" src="./CleanCo UK_files/storefront-80e528be853eac23af2454534897ca9536b1d3d04aa043b042f34879a3c111c8.js.download"></script>
<script data-source-attribution="shopify.dynamic_checkout.dynamic.init">var Shopify=Shopify||{};Shopify.PaymentButton=Shopify.PaymentButton||{isStorefrontPortableWallets:!0,init:function(){window.Shopify.PaymentButton.init=function(){};var t=document.createElement("script");t.src="https://clean.co/cdn/shopifycloud/portable-wallets/latest/portable-wallets.en.js",t.type="module",document.head.appendChild(t)}};
</script>
<script data-source-attribution="shopify.dynamic_checkout.buyer_consent">
  function portableWalletsHideBuyerConsent(e){var t=document.getElementById("shopify-buyer-consent"),n=document.getElementById("shopify-subscription-policy-button");t&&n&&(t.classList.add("hidden"),t.setAttribute("aria-hidden","true"),n.removeEventListener("click",e))}function portableWalletsShowBuyerConsent(e){var t=document.getElementById("shopify-buyer-consent"),n=document.getElementById("shopify-subscription-policy-button");t&&n&&(t.classList.remove("hidden"),t.removeAttribute("aria-hidden"),n.addEventListener("click",e))}window.Shopify?.PaymentButton&&(window.Shopify.PaymentButton.hideBuyerConsent=portableWalletsHideBuyerConsent,window.Shopify.PaymentButton.showBuyerConsent=portableWalletsShowBuyerConsent);
</script>
<script data-source-attribution="shopify.dynamic_checkout.cart.bootstrap">document.addEventListener("DOMContentLoaded",(function(){function t(){return document.querySelector("shopify-accelerated-checkout-cart, shopify-accelerated-checkout")}if(t())Shopify.PaymentButton.init();else{new MutationObserver((function(e,n){t()&&(Shopify.PaymentButton.init(),n.disconnect())})).observe(document.body,{childList:!0,subtree:!0})}}));
</script>
<script id="scb4127" type="text/javascript" async="" src="./CleanCo UK_files/storefront-banner.js.download"></script>
<link rel="stylesheet" media="screen" href="./CleanCo UK_files/accelerated-checkout-backwards-compat.css" crossorigin="anonymous">

<style id="shopify-accelerated-checkout-cart">
        #shopify-buyer-consent {
  margin-top: 1em;
  display: inline-block;
  width: 100%;
}

#shopify-buyer-consent.hidden {
  display: none;
}

#shopify-subscription-policy-button {
  background: none;
  border: none;
  padding: 0;
  text-decoration: underline;
  font-size: inherit;
  cursor: pointer;
}

#shopify-subscription-policy-button::before {
  box-shadow: none;
}

      </style>
<script>window.performance && window.performance.mark && window.performance.mark('shopify.content_for_header.end');</script>
  <!-- BEGIN app block: shopify://apps/klaviyo-email-marketing-sms/blocks/klaviyo-onsite-embed/2632fe16-c075-4321-a88b-50b567f42507 -->












  <script async="" src="./CleanCo UK_files/klaviyo.js.download"></script>
  <script>!function(){if(!window.klaviyo){window._klOnsite=window._klOnsite||[];try{window.klaviyo=new Proxy({},{get:function(n,i){return"push"===i?function(){var n;(n=window._klOnsite).push.apply(n,arguments)}:function(){for(var n=arguments.length,o=new Array(n),w=0;w<n;w++)o[w]=arguments[w];var t="function"==typeof o[o.length-1]?o.pop():void 0,e=new Promise((function(n){window._klOnsite.push([i].concat(o,[function(i){t&&t(i),n(i)}]))}));return e}}})}catch(n){window.klaviyo=window.klaviyo||[],window.klaviyo.push=function(){var n;(n=window._klOnsite).push.apply(n,arguments)}}}}();</script>

  




  <script>
    window.klaviyoReviewsProductDesignMode = false
  </script>







<!-- END app block --><!-- BEGIN app block: shopify://apps/yotpo-loyalty-rewards/blocks/loader-app-embed-block/2f9660df-5018-4e02-9868-ee1fb88d6ccd -->
    <script src="./CleanCo UK_files/c5imCWRvuJVcZI1mxTxJPQ" async=""></script>




<!-- END app block --><!-- BEGIN app block: shopify://apps/yotpo-subscriptions/blocks/app-embed-block/ef25e582-ada5-4bb0-b4e7-f94e97ab1bb4 -->
  <script src="./CleanCo UK_files/YWjdFctb8ff0rDEM6dDYwWUCYzA8c9qXUISElTjS" async=""></script>

<!-- END app block --><script src="./CleanCo UK_files/giftBoxLogicv1.js.download" type="text/javascript" defer="defer"></script>
<link href="./CleanCo UK_files/giftBoxv1.css" rel="stylesheet" type="text/css" media="all">
<link href="https://monorail-edge.shopifysvc.com/" rel="dns-prefetch">
<script>(function(){if ("sendBeacon" in navigator && "performance" in window) {var session_token = document.cookie.match(/_shopify_s=([^;]*)/);function handle_abandonment_event(e) {var entries = performance.getEntries().filter(function(entry) {return /monorail-edge.shopifysvc.com/.test(entry.name);});if (!window.abandonment_tracked && entries.length === 0) {window.abandonment_tracked = true;var currentMs = Date.now();var navigation_start = performance.timing.navigationStart;var payload = {shop_id: 26795606113,url: window.location.href,navigation_start,duration: currentMs - navigation_start,session_token: session_token && session_token.length === 2 ? session_token[1] : "",page_type: ""};window.navigator.sendBeacon("https://monorail-edge.shopifysvc.com/v1/produce", JSON.stringify({schema_id: "online_store_buyer_site_abandonment/1.1",payload: payload,metadata: {event_created_at_ms: currentMs,event_sent_at_ms: currentMs}}));}}window.addEventListener('pagehide', handle_abandonment_event);}}());</script>
<script id="web-pixels-manager-setup">(function d(d,e,n,o,r,i){if(!Boolean(null===(t=null===(a=window.Shopify)||void 0===a?void 0:a.analytics)||void 0===t?void 0:t.replayQueue)){var a,t,s=function(){var d={modern:/Edge?\/(1{2}[4-9]|1[2-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Firefox\/(1{2}[4-9]|1[2-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Chrom(ium|e)\/(9{2}|\d{3,})\.\d+(\.\d+|)|(Maci|X1{2}).+ Version\/(15\.\d+|(1[6-9]|[2-9]\d|\d{3,})\.\d+)([,.]\d+|)( \(\w+\)|)( Mobile\/\w+|) Safari\/|Chrome.+OPR\/(9{2}|\d{3,})\.\d+\.\d+|(CPU[ +]OS|iPhone[ +]OS|CPU[ +]iPhone|CPU IPhone OS|CPU iPad OS)[ +]+(15[._]\d+|(1[6-9]|[2-9]\d|\d{3,})[._]\d+)([._]\d+|)|Android:?[ /-](13\d|1[4-9]\d|[2-9]\d{2}|\d{4,})(\.\d+|)(\.\d+|)|Android.+Firefox\/(13\d|1[4-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Android.+Chrom(ium|e)\/(13\d|1[4-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|SamsungBrowser\/([2-9]\d|\d{3,})\.\d+/,legacy:/Edge?\/(1[6-9]|[2-9]\d|\d{3,})\.\d+(\.\d+|)|Firefox\/(5[4-9]|[6-9]\d|\d{3,})\.\d+(\.\d+|)|Chrom(ium|e)\/(5[1-9]|[6-9]\d|\d{3,})\.\d+(\.\d+|)([\d.]+$|.*Safari\/(?![\d.]+ Edge\/[\d.]+$))|(Maci|X1{2}).+ Version\/(10\.\d+|(1[1-9]|[2-9]\d|\d{3,})\.\d+)([,.]\d+|)( \(\w+\)|)( Mobile\/\w+|) Safari\/|Chrome.+OPR\/(3[89]|[4-9]\d|\d{3,})\.\d+\.\d+|(CPU[ +]OS|iPhone[ +]OS|CPU[ +]iPhone|CPU IPhone OS|CPU iPad OS)[ +]+(10[._]\d+|(1[1-9]|[2-9]\d|\d{3,})[._]\d+)([._]\d+|)|Android:?[ /-](13\d|1[4-9]\d|[2-9]\d{2}|\d{4,})(\.\d+|)(\.\d+|)|Mobile Safari.+OPR\/([89]\d|\d{3,})\.\d+\.\d+|Android.+Firefox\/(13\d|1[4-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Android.+Chrom(ium|e)\/(13\d|1[4-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Android.+(UC? ?Browser|UCWEB|U3)[ /]?(15\.([5-9]|\d{2,})|(1[6-9]|[2-9]\d|\d{3,})\.\d+)\.\d+|SamsungBrowser\/(5\.\d+|([6-9]|\d{2,})\.\d+)|Android.+MQ{2}Browser\/(14(\.(9|\d{2,})|)|(1[5-9]|[2-9]\d|\d{3,})(\.\d+|))(\.\d+|)|K[Aa][Ii]OS\/(3\.\d+|([4-9]|\d{2,})\.\d+)(\.\d+|)/},e=d.modern,n=d.legacy,o=navigator.userAgent;return e.test(o)?"modern":(n.test(o),"legacy")}(),l=null!=i?i:{modern:"",legacy:""};window.Shopify=window.Shopify||{};var u=window.Shopify;u.analytics=u.analytics||{};var c=u.analytics;c.replayQueue=[],c.publish=function(d,e,n){return c.replayQueue.push([d,e,n]),!0};try{self.performance.mark("wpm:start")}catch(d){}var f=[n,"/wpm","/b",r,s.substring(0,1),".js"].join(""),h=l[s];!function(d){var e=d.src,n=d.async,o=void 0===n||n,r=d.onload,i=d.onerror,a=d.sri,t=document.createElement("script"),s=document.head,l=document.body;t.async=o,t.src=e,a&&(t.integrity=a,t.crossOrigin="anonymous"),r&&t.addEventListener("load",r),i&&t.addEventListener("error",i),s?s.appendChild(t):l?l.appendChild(t):console.error("Did not find a head or body element to append the script")}({src:f,async:!0,onload:function(){if(!function(){var d,e;return Boolean(null===(e=null===(d=window.Shopify)||void 0===d?void 0:d.analytics)||void 0===e?void 0:e.initialized)}()){var n=window.webPixelsManager.init(d)||void 0;if(n){e(n);var o=window.Shopify.analytics;o.replayQueue.forEach((function(d){var e=d[0],o=d[1],r=d[2];n.publishCustomEvent(e,o,r)})),o.replayQueue=[],o.publish=n.publishCustomEvent,o.visitor=n.visitor,o.initialized=!0}}},onerror:function(){var e=d.storefrontBaseUrl.replace(/\/$/,""),n="".concat(e,"/.well-known/shopify/monorail/unstable/produce_batch"),r=JSON.stringify({metadata:{event_sent_at_ms:(new Date).getTime()},events:[{schema_id:"web_pixels_manager_load/3.1",payload:{version:o||"latest",bundle_target:s,page_url:self.location.href,status:"failed",surface:d.surface,error_msg:"".concat(f," has failed to load")},metadata:{event_created_at_ms:(new Date).getTime()}}]});try{if(self.navigator.sendBeacon.bind(self.navigator)(n,r))return!0}catch(d){}var i=new XMLHttpRequest;try{return i.open("POST",n,!0),i.setRequestHeader("Content-Type","text/plain"),i.send(r),!0}catch(d){console&&console.warn&&console.warn("[Web Pixels Manager] Got an unhandled error while logging a load error.")}return!1},sri:function(d){return"string"==typeof d&&/^sha384-[A-Za-z0-9+/=]+$/.test(d)}(h)?h:""})}})({shopId: 26795606113,storefrontBaseUrl: "https://clean.co",extensionsBaseUrl: "https://extensions.shopifycdn.com/cdn/shopifycloud/web-pixels-manager",surface: "storefront-renderer",enabledBetaFlags: ["6a396365"],webPixelsConfigList: [{"id":"187596897","configuration":"{\"config\":\"{\\\"pixel_id\\\":\\\"G-SVVJLPFWBR\\\",\\\"target_country\\\":\\\"GB\\\",\\\"gtag_events\\\":[{\\\"type\\\":\\\"begin_checkout\\\",\\\"action_label\\\":\\\"G-SVVJLPFWBR\\\"},{\\\"type\\\":\\\"search\\\",\\\"action_label\\\":\\\"G-SVVJLPFWBR\\\"},{\\\"type\\\":\\\"view_item\\\",\\\"action_label\\\":[\\\"G-SVVJLPFWBR\\\",\\\"MC-PXSW4TX8EZ\\\"]},{\\\"type\\\":\\\"purchase\\\",\\\"action_label\\\":[\\\"G-SVVJLPFWBR\\\",\\\"MC-PXSW4TX8EZ\\\"]},{\\\"type\\\":\\\"page_view\\\",\\\"action_label\\\":[\\\"G-SVVJLPFWBR\\\",\\\"MC-PXSW4TX8EZ\\\"]},{\\\"type\\\":\\\"add_payment_info\\\",\\\"action_label\\\":\\\"G-SVVJLPFWBR\\\"},{\\\"type\\\":\\\"add_to_cart\\\",\\\"action_label\\\":\\\"G-SVVJLPFWBR\\\"}],\\\"enable_monitoring_mode\\\":false}\"}","eventPayloadVersion":"v1","runtimeContext":"OPEN","scriptVersion":"642ed32d7fafb3e0986c8ba3bf3908a1","type":"APP","apiClientId":1780363,"privacyPurposes":[]},{"id":"85819489","configuration":"{\"pixel_id\":\"570914786794709\",\"pixel_type\":\"facebook_pixel\",\"metaapp_system_user_token\":\"-\"}","eventPayloadVersion":"v1","runtimeContext":"OPEN","scriptVersion":"8d894c63179843e74a9691414b5ad83d","type":"APP","apiClientId":2329312,"privacyPurposes":["ANALYTICS","MARKETING","SALE_OF_DATA"]},{"id":"75563105","configuration":"{\"octaneDomain\":\"https:\\\/\\\/app.octaneai.com\",\"botID\":\"pvfpg23oba51bwt9\"}","eventPayloadVersion":"v1","runtimeContext":"STRICT","scriptVersion":"37dc318a6f11ffc666473a9a43d0e79b","type":"APP","apiClientId":2012438,"privacyPurposes":["ANALYTICS","MARKETING","SALE_OF_DATA"]},{"id":"31490145","configuration":"{\"tagID\":\"2613176454225\"}","eventPayloadVersion":"v1","runtimeContext":"STRICT","scriptVersion":"4fd0680eed907adaf3f85849c393d688","type":"APP","apiClientId":3009811,"privacyPurposes":["ANALYTICS","MARKETING","SALE_OF_DATA"]},{"id":"18251873","configuration":"{\"advertiserId\":\"75084\",\"shopDomain\":\"clean-liquor.myshopify.com\",\"appVersion\":\"shopifyApp_4.3.0\"}","eventPayloadVersion":"v1","runtimeContext":"STRICT","scriptVersion":"b04639eb0d2aa44f551c9d825e2f8f7d","type":"APP","apiClientId":2887701,"privacyPurposes":["ANALYTICS","MARKETING"]},{"id":"9764961","eventPayloadVersion":"1","runtimeContext":"LAX","scriptVersion":"9","type":"CUSTOM","privacyPurposes":["ANALYTICS","MARKETING","SALE_OF_DATA"],"name":"Google Tag Manager"},{"id":"14057569","eventPayloadVersion":"1","runtimeContext":"LAX","scriptVersion":"1","type":"CUSTOM","privacyPurposes":["ANALYTICS","MARKETING","SALE_OF_DATA"],"name":"Google Ads Purchase Tracking"},{"id":"shopify-app-pixel","configuration":"{}","eventPayloadVersion":"v1","runtimeContext":"STRICT","scriptVersion":"0282","apiClientId":"shopify-pixel","type":"APP","privacyPurposes":["ANALYTICS","MARKETING"]},{"id":"shopify-custom-pixel","eventPayloadVersion":"v1","runtimeContext":"LAX","scriptVersion":"0282","apiClientId":"shopify-pixel","type":"CUSTOM","privacyPurposes":["ANALYTICS","MARKETING"]}],isMerchantRequest: false,effectiveTopLevelDomain: "",initData: {"shop":{"name":"CleanCo UK","paymentSettings":{"currencyCode":"GBP"},"myshopifyDomain":"clean-liquor.myshopify.com","countryCode":"GB","storefrontUrl":"https:\/\/clean.co"},"customer":null,"cart":null,"checkout":null,"productVariants":[],"purchasingCompany":null},},function pageEvents(webPixelsManagerAPI) {webPixelsManagerAPI.publish("page_viewed", {});},"https://clean.co/cdn","fa4e28fae492e8b8cbffa58e31a72fa67ab51995","bb202aaewd7fabeadp1286c7ffm6c4f3798",{"modern":"","legacy":""});</script><script async="" src="./CleanCo UK_files/bbb202aaewd7fabeadp1286c7ffm6c4f3798m.js.download"></script>  <script>window.ShopifyAnalytics = window.ShopifyAnalytics || {};
window.ShopifyAnalytics.meta = window.ShopifyAnalytics.meta || {};
window.ShopifyAnalytics.meta.currency = 'GBP';
var meta = {"page":{}};
for (var attr in meta) {
  window.ShopifyAnalytics.meta[attr] = meta[attr];
}</script>
<script>window.ShopifyAnalytics.merchantGoogleAnalytics = function() {
  ga(function(tracker) {
    // save client ID as custom dimension
    var cid = tracker.get('clientId');
    tracker.set('dimension1', cid); 
});
};
</script>
<script class="analytics">(window.gaDevIds=window.gaDevIds||[]).push('BwiEti');


(function () {
    var customDocumentWrite = function(content) {
      var jquery = null;

      if (window.jQuery) {
        jquery = window.jQuery;
      } else if (window.Checkout && window.Checkout.$) {
        jquery = window.Checkout.$;
      }

      if (jquery) {
        jquery('body').append(content);
      }
    };

    var hasLoggedConversion = function(token) {
      if (token) {
        return document.cookie.indexOf('loggedConversion=' + token) !== -1;
      }
      return false;
    }

    var setCookieIfConversion = function(token) {
      if (token) {
        var twoMonthsFromNow = new Date(Date.now());
        twoMonthsFromNow.setMonth(twoMonthsFromNow.getMonth() + 2);

        document.cookie = 'loggedConversion=' + token + '; expires=' + twoMonthsFromNow;
      }
    }

    var trekkie = window.ShopifyAnalytics.lib = window.trekkie = window.trekkie || [];
    if (trekkie.integrations) {
      return;
    }
    trekkie.methods = [
      'identify',
      'page',
      'ready',
      'track',
      'trackForm',
      'trackLink'
    ];
    trekkie.factory = function(method) {
      return function() {
        var args = Array.prototype.slice.call(arguments);
        args.unshift(method);
        trekkie.push(args);
        return trekkie;
      };
    };
    for (var i = 0; i < trekkie.methods.length; i++) {
      var key = trekkie.methods[i];
      trekkie[key] = trekkie.factory(key);
    }
    trekkie.load = function(config) {
      trekkie.config = config || {};
      trekkie.config.initialDocumentCookie = document.cookie;
      var first = document.getElementsByTagName('script')[0];
      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.onerror = function(e) {
        var scriptFallback = document.createElement('script');
        scriptFallback.type = 'text/javascript';
        scriptFallback.onerror = function(error) {
                var Monorail = {
      produce: function produce(monorailDomain, schemaId, payload) {
        var currentMs = new Date().getTime();
        var event = {
          schema_id: schemaId,
          payload: payload,
          metadata: {
            event_created_at_ms: currentMs,
            event_sent_at_ms: currentMs
          }
        };
        return Monorail.sendRequest("https://" + monorailDomain + "/v1/produce", JSON.stringify(event));
      },
      sendRequest: function sendRequest(endpointUrl, payload) {
        // Try the sendBeacon API
        if (window && window.navigator && typeof window.navigator.sendBeacon === 'function' && typeof window.Blob === 'function' && !Monorail.isIos12()) {
          var blobData = new window.Blob([payload], {
            type: 'text/plain'
          });

          if (window.navigator.sendBeacon(endpointUrl, blobData)) {
            return true;
          } // sendBeacon was not successful

        } // XHR beacon

        var xhr = new XMLHttpRequest();

        try {
          xhr.open('POST', endpointUrl);
          xhr.setRequestHeader('Content-Type', 'text/plain');
          xhr.send(payload);
        } catch (e) {
          console.log(e);
        }

        return false;
      },
      isIos12: function isIos12() {
        return window.navigator.userAgent.lastIndexOf('iPhone; CPU iPhone OS 12_') !== -1 || window.navigator.userAgent.lastIndexOf('iPad; CPU OS 12_') !== -1;
      }
    };
    Monorail.produce('monorail-edge.shopifysvc.com',
      'trekkie_storefront_load_errors/1.1',
      {shop_id: 26795606113,
      theme_id: 123780530273,
      app_name: "storefront",
      context_url: window.location.href,
      source_url: "//clean.co/cdn/s/trekkie.storefront.c44d6898594db6c4847cb75ef4de7d5f4456a012.min.js"});

        };
        scriptFallback.async = true;
        scriptFallback.src = '//clean.co/cdn/s/trekkie.storefront.c44d6898594db6c4847cb75ef4de7d5f4456a012.min.js';
        first.parentNode.insertBefore(scriptFallback, first);
      };
      script.async = true;
      script.src = '//clean.co/cdn/s/trekkie.storefront.c44d6898594db6c4847cb75ef4de7d5f4456a012.min.js';
      first.parentNode.insertBefore(script, first);
    };
    trekkie.load(
      {"Trekkie":{"appName":"storefront","development":false,"defaultAttributes":{"shopId":26795606113,"isMerchantRequest":null,"themeId":123780530273,"themeCityHash":"5527767015100609860","contentLanguage":"en","currency":"GBP"},"isServerSideCookieWritingEnabled":true,"monorailRegion":"shop_domain"},"Google Analytics":{"trackingId":"UA-151601658-1","domain":"auto","siteSpeedSampleRate":"10","enhancedEcommerce":true,"doubleClick":true,"includeSearch":true},"Session Attribution":{},"S2S":{"facebookCapiEnabled":true,"source":"trekkie-storefront-renderer","apiClientId":580111}}
    );

    var loaded = false;
    trekkie.ready(function() {
      if (loaded) return;
      loaded = true;

      window.ShopifyAnalytics.lib = window.trekkie;

        ga('require', 'linker');
      function addListener(element, type, callback) {
        if (element.addEventListener) {
          element.addEventListener(type, callback);
        }
        else if (element.attachEvent) {
          element.attachEvent('on' + type, callback);
        }
      }
      function decorate(event) {
        event = event || window.event;
        var target = event.target || event.srcElement;
        if (target && (target.getAttribute('action') || target.getAttribute('href'))) {
          ga(function (tracker) {
            var linkerParam = tracker.get('linkerParam');
            document.cookie = '_shopify_ga=' + linkerParam + '; ' + 'path=/';
          });
        }
      }
      addListener(window, 'load', function(){
        for (var i=0; i < document.forms.length; i++) {
          var action = document.forms[i].getAttribute('action');
          if(action && action.indexOf('/cart') >= 0) {
            addListener(document.forms[i], 'submit', decorate);
          }
        }
        for (var i=0; i < document.links.length; i++) {
          var href = document.links[i].getAttribute('href');
          if(href && href.indexOf('/checkout') >= 0) {
            addListener(document.links[i], 'click', decorate);
          }
        }
      });
    

      var originalDocumentWrite = document.write;
      document.write = customDocumentWrite;
      try { window.ShopifyAnalytics.merchantGoogleAnalytics.call(this); } catch(error) {};
      document.write = originalDocumentWrite;

      window.ShopifyAnalytics.lib.page(null,{"shopifyEmitted":true});

      var match = window.location.pathname.match(/checkouts\/(.+)\/(thank_you|post_purchase)/)
      var token = match? match[1]: undefined;
      if (!hasLoggedConversion(token)) {
        setCookieIfConversion(token);
        
      }
    });


        var eventsListenerScript = document.createElement('script');
        eventsListenerScript.async = true;
        eventsListenerScript.src = "//clean.co/cdn/shopifycloud/shopify/assets/shop_events_listener-20905db421adb60b04582abab58b285362bc2e1011d17cd3eabb3bfe05798c59.js";
        document.getElementsByTagName('head')[0].appendChild(eventsListenerScript);

})();</script><script async="" src="./CleanCo UK_files/shop_events_listener-20905db421adb60b04582abab58b285362bc2e1011d17cd3eabb3bfe05798c59.js.download"></script>
<script class="boomerang">
(function () {
  window.BOOMR = window.BOOMR || {};
  window.BOOMR.themeName = "CleanCo Theme";
  window.BOOMR.themeVersion = "1.0.0";
  window.BOOMR.shopId = 26795606113;
  window.BOOMR.themeId = 123780530273;
})();</script>
<script defer="" src="./CleanCo UK_files/shopify-perf-kit-1.2.0.min.js.download" data-application="storefront-renderer" data-shop-id="26795606113" data-render-region="gcp-asia-southeast1" data-page-type="" data-theme-instance-id="123780530273" data-monorail-region="shop_domain" data-resource-timing-sampling-rate="10"></script>
<script type="text/javascript" src="./CleanCo UK_files/jquery.min.js.download"></script><script src="./CleanCo UK_files/pixel.modern.js.download" async=""></script><script src="./CleanCo UK_files/pixel.modern(1).js.download" async=""></script><script type="text/javascript" async="" src="./CleanCo UK_files/fender_analytics.234f527c96efc492367d.js.download" crossorigin="anonymous"></script><script type="text/javascript" async="" src="./CleanCo UK_files/static.4b8f99d71b7685ee4f53.js.download" crossorigin="anonymous"></script><script type="text/javascript" async="" src="./CleanCo UK_files/runtime.e1aca8fcae202dc22cfa.js.download" crossorigin="anonymous"></script><script type="text/javascript" async="" src="./CleanCo UK_files/sharedUtils.9ce79bcd530dc4dd1a60.js.download" crossorigin="anonymous"></script><script type="text/javascript" async="" src="./CleanCo UK_files/vendors~in_app_forms~signup_forms~atlas~onsite-triggering.a49ef971ee5fab0afe02.js.download" crossorigin="anonymous"></script><script type="text/javascript" async="" src="./CleanCo UK_files/vendors~in_app_forms~signup_forms.30321f46d7549c0b04b1.js.download" crossorigin="anonymous"></script><script type="text/javascript" async="" src="./CleanCo UK_files/default~in_app_forms~signup_forms~onsite-triggering.7a64e488a2e875dd465a.js.download" crossorigin="anonymous"></script><script type="text/javascript" async="" src="./CleanCo UK_files/default~in_app_forms~signup_forms.4b6b09e628aed8ea59d0.js.download" crossorigin="anonymous"></script><script type="text/javascript" async="" src="./CleanCo UK_files/signup_forms.cf7d7cd8bc3bfdaffaf4.js.download" crossorigin="anonymous"></script><script type="text/javascript" src="./CleanCo UK_files/jquery.min.js.download"></script><script src="./CleanCo UK_files/bundle.js.download" defer="" type="text/javascript" charset="utf-8"></script><script src="./CleanCo UK_files/app.v0.9.4-7036.js.download" async="" type="text/javascript" charset="utf-8"></script><style>
                    .gbbActiveVariant {
                            background: #000000 !important;
                            color:#ffffff !important;
                        }
                    .gbbActiveImage {
                            border: 2px solid #000000 !important;
                    }    
                    .gbbBodyWrapper ::-webkit-scrollbar-thumb{
                        background: black !important;
                    }    
                    .gbbActiveMsgDeliveryOptions {
                        border: 1px solid #A2A2A2 !important;
                        background-color: rgb(255, 255, 255) !important;
                    }      
                    .gbbCustomerUploadButton{
                        background-color: #000000;
                        color: #ffffff;
                    }      
                    </style><link rel="stylesheet" type="text/css" href="chrome-extension://enejkfhimljloggnimhebadbjajhgkad/font/Inter.css"><script src="./CleanCo UK_files/bundle.js.download" defer="" type="text/javascript" charset="utf-8"></script><script src="./CleanCo UK_files/app.v0.9.4-7036.js.download" async="" type="text/javascript" charset="utf-8"></script><script type="module" defer="" src="./CleanCo UK_files/consent-tracking-api.js.download"></script><style>.yotpo-widget-empty-placeholder { display: block!important; }</style><style>.yotpo-widget-empty-placeholder { display: block!important; }</style><link rel="modulepreload" as="script" crossorigin="" href="https://clean.co/cdn/shop/t/191/assets/site-drawers-01d836be.js"><link rel="modulepreload" as="script" crossorigin="" href="https://clean.co/cdn/shop/t/191/assets/overlay-1c1bfeee.js"><link rel="modulepreload" as="script" crossorigin="" href="https://clean.co/cdn/shop/t/191/assets/cart-items-51f0dbed.js"><link rel="modulepreload" as="script" crossorigin="" href="https://clean.co/cdn/shop/t/191/assets/purchase-options-radios-d0cb74a1.js"><style id="kl-custom-fonts">
@import 'https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap';

@font-face {
        font-family: 'Liberal'; 
        src: url(https://cdn.shopify.com/s/files/1/0267/9560/6113/t/53/assets/Liberal-ExtraBold.woff2?v=17893978439260934210);
        font-weight: 300;
        font-style: normal;
        font-display: swap;
      }
@font-face {
        font-family: 'Poppins-Klaviyo-Hosted'; 
        src: url(https://static.klaviyo.com/onsite/hosted-fonts/Poppins/latin/poppins_latin_italic_400.woff2);
        font-weight: 400;
        font-style: italic;
        font-display: swap;
      }
@font-face {
        font-family: 'Poppins-Klaviyo-Hosted'; 
        src: url(https://static.klaviyo.com/onsite/hosted-fonts/Poppins/latin/poppins_latin_italic_700.woff2);
        font-weight: 700;
        font-style: italic;
        font-display: swap;
      }
@font-face {
        font-family: 'Poppins-Klaviyo-Hosted'; 
        src: url(https://static.klaviyo.com/onsite/hosted-fonts/Poppins/latin/poppins_latin_regular_400_2.woff2);
        font-weight: 400;
        font-style: normal;
        font-display: swap;
      }
@font-face {
        font-family: 'Poppins-Klaviyo-Hosted'; 
        src: url(https://static.klaviyo.com/onsite/hosted-fonts/Poppins/latin/poppins_latin_regular_700.woff2);
        font-weight: 700;
        font-style: normal;
        font-display: swap;
      }
</style><link rel="stylesheet" type="text/css" href="./CleanCo UK_files/532.69d01a114306171334a5.css" crossorigin="anonymous"><link rel="modulepreload" as="script" crossorigin="" href="https://clean.co/cdn/shop/t/191/assets/swiper-0f3b5cc0.js"><link rel="modulepreload" as="script" crossorigin="" href="https://clean.co/cdn/shop/t/191/assets/utils-78c3c92c.js"><style id="_goober"> .go3176171171{color:#000000;line-height:normal;}.go3176171171 p{margin:0px;}.go3176171171 span{display:inline;}.go3176171171 ol,.go3176171171 ul{padding:0 0 0 48px;margin:0;}.go3176171171 ul{list-style-type:disc;}.go3176171171 li{line-height:18px;}.go3176171171 a{color:#0066cc;text-decoration:underline;border-bottom:none;}.go1596356512 > div{padding-bottom:8px;padding-top:8px;}.go681896951{cursor:pointer;}.go681896951 *{cursor:pointer;}.go2324193863.go2324193863.go2324193863:focus-visible{outline-width:2px;outline-style:auto;outline-color:#1C65AD;outline-offset:0;}.go1102772938.go1102772938.go1102772938 [data-testid='form-row']{margin-bottom:calc((1 - 1) * 1%);}.go1272136950.go1272136950.go1272136950::before{content:'';background-color:rgba(20, 20, 20, 0.5);height:100%;width:100%;left:0;top:0;bottom:0;right:0;position:fixed;z-index:90000;opacity:1;}.go2527187944.go2527187944.go2527187944::before{content:'';height:100%;background-color:#0B464C;top:-50%;width:100%;position:absolute;}.go249761392.go249761392.go249761392::before{content:'';display:block;min-height:0px;width:100%;}.go249761392.go249761392.go249761392::after{content:'';display:block;min-height:0px;width:100%;}.go417382439.go417382439.go417382439 [href]:focus-visible{outline-width:2px;outline-style:auto;outline-color:#1C65AD;}.go4117816934.go4117816934.go4117816934::placeholder{color:#949596;font-family:'Rubik', 'Lucida Sans', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;font-size:14px;font-weight:300;letter-spacing:0px;}.go4117816934.go4117816934.go4117816934::-moz-placeholder{line-height:50px;}.go4117816934.go4117816934.go4117816934:hover{border-color:#000000 !important;}.go4117816934.go4117816934.go4117816934:focus-visible{outline-width:2px;outline-style:auto;outline-color:#000000;outline-offset:0;}.go879326207.go879326207.go879326207:hover{background-color:#F7F2E8 !important;color:#0B464C !important;}.go879326207.go879326207.go879326207:focus-visible{outline-width:2px;outline-style:auto;outline-color:#000000;outline-offset:0;}</style><link rel="modulepreload" as="script" crossorigin="" href="https://clean.co/cdn/shop/t/191/assets/index-7065afb4.js"><link rel="dns-prefetch preconnect" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/polyfills.aaTJ3aJS.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/app.9jNknLmz.js" crossorigin=""><script type="text/javascript" src="./CleanCo UK_files/app.v1.0.368.js.download"></script><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/page-OnePage.BcStQnjH.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/DeliveryMethodSelectorSection.DKcq4inK.js" crossorigin=""><style type="text/css">body {
    margin: 0;
}
#swell-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #000;
    opacity: .5;
    z-index: 2147483645 !important;
}

#swell-popup {
    display: none;
    position: fixed;
    width: 540px;
    height: 400px;
    font-family: sans-serif;
    font-size: 16px;
    border: 0;
    left: 50%;
    top: 50%;
    transform: translateX(-50%) translateY(-50%);
    background-color: #fff;
    box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.5);
    z-index: 2147483647 !important; 
    color: black;
    max-width: inherit;
}

#swell-rewards-popup {
    display: none;
    position: fixed;
    width: 866px;
    height: 700px;
    font-family: "Open Sans";
    font-size: 16px;
    left: 50%;
    top: 50%;
    transform: translateX(-50%) translateY(-50%);
    background-color: #fff;
    box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.5);
    z-index: 2147483646 !important;
    opacity: 1
}

#swell-popup-error-container {
    font-weight: 700;
    border: 1px solid #000;
    background-color: rgba(245, 245, 245, 1);
    display: none;
    color: #a94442;
    z-index: 2147483647;
    padding: 15px;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    width: 90%;
    margin: 0 auto;
    text-align: center;
    border-radius: 5px;
    border-top-left-radius: 0;
    border-top-right-radius: 0;
    border-top: 0
}

#swell-popup-items-container {
    position: relative
}

#swell-popup-close {
    position: absolute;
    width: 24px;
    height: 24px;
    top: 7px;
    right: 10px;
    text-align: center;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.3);
    cursor: pointer;
    z-index: 999999999999999;
}

#swell-popup-close-x {
    width: 100%;
    margin: auto;
    line-height: 20px !important;
    vertical-align: middle;
    color: rgba(255, 255, 255, 0.9);
    font-size: 22px;
    font-weight: 300;
    text-align: center
}
#swell-popup-close-x i{
    font-size: 16px;
    line-height: 22px;
}
.swell-popup-item-wrapper {
    line-height: normal;
    box-sizing: content-box !important;
    position: absolute
}

.swell-popup-item {
    line-height: normal;
    box-sizing: content-box !important;
    position: relative;
    width: 100% !important;
    height: 100% !important;
}

.swell-text-item {
    background-color: transparent
}

.swell-tab {
    position: fixed;
    z-index: 2147483644
}

.swell-loader,
.swell-loader:before,
.swell-loader:after {
    background: #fff;
    -webkit-animation: swell-loader-1 1s infinite ease-in-out;
    animation: swell-loader-1 1s infinite ease-in-out;
    width: 1em;
    height: 4em
}

.swell-loader:before,
.swell-loader:after {
    position: absolute;
    top: 0;
    content: ''
}

.swell-loader:before {
    left: -1.5em;
    -webkit-animation-delay: -.32s;
    animation-delay: -.32s
}

.swell-loader {
    text-indent: -9999em;
    margin: 0 auto;
    position: relative;
    font-size: 5px;
    -webkit-transform: translateZ(0);
    -ms-transform: translateZ(0);
    transform: translateZ(0);
    -webkit-animation-delay: -.16s;
    animation-delay: -.16s
}

.swell-loader:after {
    left: 1.5em
}

@-webkit-keyframes swell-loader-1 {
    0%,
    80%,
    100% {
        box-shadow: 0 0 #fff;
        height: 4em
    }
    40% {
        box-shadow: 0 -2em #fff;
        height: 5em
    }
}

@keyframes swell-loader-1 {
    0%,
    80%,
    100% {
        box-shadow: 0 0 #fff;
        height: 4em
    }
    40% {
        box-shadow: 0 -2em #fff;
        height: 5em
    }
}
.swell-standalone-modal .swell-modal .modal-body { background-color: white; color: black; }
.swell-standalone-modal .swell-modal .modal-header { color: white; }
.swell-standalone-modal .swell-modal .modal-title { text-align: center; }
.swell-standalone-modal .swell-modal .modal-header .close { background-image: none; position: absolute; top: 0px; right: 10px; color: white; font-size: 45px; font-weight: 100;opacity: 1; cursor: pointer; }

.swell-embedded-popup { position: relative; margin: 0 auto; max-width: inherit; } 
.swell-embedded-popup #swell-sidebar { position: static; }
.swell-embedded-popup #swell-popup-close { display: none; }
</style><style type="text/css">/*!
 * jquery-confirm v3.3.2 (http://craftpip.github.io/jquery-confirm/)
 * Author: boniface pereira
 * Website: www.craftpip.com
 * Contact: hey@craftpip.com
 *
 * Copyright 2013-2017 jquery-confirm
 * Licensed under MIT (https://github.com/craftpip/jquery-confirm/blob/master/LICENSE)
 */
 @-webkit-keyframes jconfirm-spin {
    from {
      -webkit-transform: rotate(0deg);
              transform: rotate(0deg);
    }
    to {
      -webkit-transform: rotate(360deg);
              transform: rotate(360deg);
    }
  }
  @keyframes jconfirm-spin {
    from {
      -webkit-transform: rotate(0deg);
              transform: rotate(0deg);
    }
    to {
      -webkit-transform: rotate(360deg);
              transform: rotate(360deg);
    }
  }
  body[class*=jconfirm-no-scroll-] {
    overflow: hidden !important;
  }
  .jconfirm {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 99999999;
    font-family: inherit;
    overflow: hidden;
  }
  .jconfirm .jconfirm-bg {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    -webkit-transition: opacity .4s;
    transition: opacity .4s;
  }
  .jconfirm .jconfirm-bg.jconfirm-bg-h {
    opacity: 0 !important;
  }
  .jconfirm .jconfirm-scrollpane {
    -webkit-perspective: 500px;
            perspective: 500px;
    -webkit-perspective-origin: center;
            perspective-origin: center;
    display: table;
    width: 100%;
    height: 100%;
  }
  .jconfirm .jconfirm-row {
    display: table-row;
    width: 100%;
  }
  .jconfirm .jconfirm-cell {
    display: table-cell;
    vertical-align: middle;
  }
  .jconfirm .jconfirm-holder {
    max-height: 100%;
    padding: 50px 0;
  }
  .jconfirm .jconfirm-box-container {
    -webkit-transition: -webkit-transform;
    transition: -webkit-transform;
    transition: transform;
    transition: transform, -webkit-transform;
    max-width: 95%;
    margin: auto;
  }
  
  @media screen and (min-width: 564px) {
    .jconfirm .jconfirm-box-container {
      max-width: 564px;
    }
  }
  .jconfirm .jconfirm-box-container.jconfirm-no-transition {
    -webkit-transition: none !important;
    transition: none !important;
  }
  .jconfirm .jconfirm-box {
    background: white;
    border-radius: 4px;
    position: relative;
    outline: none;
    padding: 15px 15px 0;
    overflow: hidden;
    margin-left: auto;
    margin-right: auto;
  }
  @-webkit-keyframes type-blue {
    1%,
    100% {
      border-color: #3498db;
    }
    50% {
      border-color: #5faee3;
    }
  }
  @keyframes type-blue {
    1%,
    100% {
      border-color: #3498db;
    }
    50% {
      border-color: #5faee3;
    }
  }
  @-webkit-keyframes type-green {
    1%,
    100% {
      border-color: #2ecc71;
    }
    50% {
      border-color: #54d98c;
    }
  }
  @keyframes type-green {
    1%,
    100% {
      border-color: #2ecc71;
    }
    50% {
      border-color: #54d98c;
    }
  }
  @-webkit-keyframes type-red {
    1%,
    100% {
      border-color: #e74c3c;
    }
    50% {
      border-color: #ed7669;
    }
  }
  @keyframes type-red {
    1%,
    100% {
      border-color: #e74c3c;
    }
    50% {
      border-color: #ed7669;
    }
  }
  @-webkit-keyframes type-orange {
    1%,
    100% {
      border-color: #f1c40f;
    }
    50% {
      border-color: #f4d03f;
    }
  }
  @keyframes type-orange {
    1%,
    100% {
      border-color: #f1c40f;
    }
    50% {
      border-color: #f4d03f;
    }
  }
  @-webkit-keyframes type-purple {
    1%,
    100% {
      border-color: #9b59b6;
    }
    50% {
      border-color: #b07cc6;
    }
  }
  @keyframes type-purple {
    1%,
    100% {
      border-color: #9b59b6;
    }
    50% {
      border-color: #b07cc6;
    }
  }
  @-webkit-keyframes type-dark {
    1%,
    100% {
      border-color: #34495e;
    }
    50% {
      border-color: #46627f;
    }
  }
  @keyframes type-dark {
    1%,
    100% {
      border-color: #34495e;
    }
    50% {
      border-color: #46627f;
    }
  }
  .jconfirm .jconfirm-box.jconfirm-type-animated {
    -webkit-animation-duration: 2s;
            animation-duration: 2s;
    -webkit-animation-iteration-count: infinite;
            animation-iteration-count: infinite;
  }
  .jconfirm .jconfirm-box.jconfirm-type-blue {
    border-top: solid 7px #3498db;
    -webkit-animation-name: type-blue;
            animation-name: type-blue;
  }
  .jconfirm .jconfirm-box.jconfirm-type-green {
    border-top: solid 7px #2ecc71;
    -webkit-animation-name: type-green;
            animation-name: type-green;
  }
  .jconfirm .jconfirm-box.jconfirm-type-red {
    border-top: solid 7px #e74c3c;
    -webkit-animation-name: type-red;
            animation-name: type-red;
  }
  .jconfirm .jconfirm-box.jconfirm-type-orange {
    border-top: solid 7px #f1c40f;
    -webkit-animation-name: type-orange;
            animation-name: type-orange;
  }
  .jconfirm .jconfirm-box.jconfirm-type-purple {
    border-top: solid 7px #9b59b6;
    -webkit-animation-name: type-purple;
            animation-name: type-purple;
  }
  .jconfirm .jconfirm-box.jconfirm-type-dark {
    border-top: solid 7px #34495e;
    -webkit-animation-name: type-dark;
            animation-name: type-dark;
  }
  .jconfirm .jconfirm-box.loading {
    height: 120px;
  }
  .jconfirm .jconfirm-box.loading:before {
    content: '';
    position: absolute;
    left: 0;
    background: white;
    right: 0;
    top: 0;
    bottom: 0;
    border-radius: 10px;
    z-index: 1;
  }
  .jconfirm .jconfirm-box.loading:after {
    opacity: 0.6;
    content: '';
    height: 30px;
    width: 30px;
    border: solid 3px transparent;
    position: absolute;
    left: 50%;
    margin-left: -15px;
    border-radius: 50%;
    -webkit-animation: jconfirm-spin 1s infinite linear;
            animation: jconfirm-spin 1s infinite linear;
    border-bottom-color: dodgerblue;
    top: 50%;
    margin-top: -15px;
    z-index: 2;
  }
  .jconfirm .jconfirm-box div.jconfirm-closeIcon {
    height: 20px;
    width: 20px;
    position: absolute;
    top: 10px;
    right: 10px;
    cursor: pointer;
    opacity: .6;
    text-align: center;
    font-size: 27px !important;
    line-height: 14px !important;
    display: none;
    z-index: 1;
  }
  .jconfirm .jconfirm-box div.jconfirm-closeIcon:empty {
    display: none;
  }
  .jconfirm .jconfirm-box div.jconfirm-closeIcon .fa {
    font-size: 16px;
  }
  .jconfirm .jconfirm-box div.jconfirm-closeIcon .glyphicon {
    font-size: 16px;
  }
  .jconfirm .jconfirm-box div.jconfirm-closeIcon .zmdi {
    font-size: 16px;
  }
  .jconfirm .jconfirm-box div.jconfirm-closeIcon:hover {
    opacity: 1;
  }
  .jconfirm .jconfirm-box div.jconfirm-title-c {
    display: block;
    font-size: 22px;
    line-height: 20px;
    -webkit-user-select: none;
       -moz-user-select: none;
        -ms-user-select: none;
            user-select: none;
    cursor: default;
    padding-bottom: 15px;
  }
  .jconfirm .jconfirm-box div.jconfirm-title-c.jconfirm-hand {
    cursor: move;
  }
  .jconfirm .jconfirm-box div.jconfirm-title-c .jconfirm-icon-c {
    font-size: inherit;
    display: inline-block;
    vertical-align: middle;
  }
  .jconfirm .jconfirm-box div.jconfirm-title-c .jconfirm-icon-c i {
    vertical-align: middle;
  }
  .jconfirm .jconfirm-box div.jconfirm-title-c .jconfirm-icon-c:empty {
    display: none;
  }
  .jconfirm .jconfirm-box div.jconfirm-title-c .jconfirm-title {
    -webkit-user-select: none;
       -moz-user-select: none;
        -ms-user-select: none;
            user-select: none;
    font-size: inherit;
    font-family: inherit;
    display: inline-block;
    vertical-align: middle;
  }
  .jconfirm .jconfirm-box div.jconfirm-title-c .jconfirm-title:empty {
    display: none;
  }
  .jconfirm .jconfirm-box div.jconfirm-content-pane {
    margin-bottom: 15px;
    height: auto;
    -webkit-transition: height 0.4s ease-in;
    transition: height 0.4s ease-in;
    display: inline-block;
    width: 100%;
    position: relative;
  }
  .jconfirm .jconfirm-box div.jconfirm-content-pane.no-scroll {
    overflow-y: hidden;
  }
  .jconfirm .jconfirm-box div.jconfirm-content-pane::-webkit-scrollbar {
    width: 3px;
  }
  .jconfirm .jconfirm-box div.jconfirm-content-pane::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
  }
  .jconfirm .jconfirm-box div.jconfirm-content-pane::-webkit-scrollbar-thumb {
    background: #666;
    border-radius: 3px;
  }
  .jconfirm .jconfirm-box div.jconfirm-content-pane .jconfirm-content {
    overflow: auto;
  }
  .jconfirm .jconfirm-box div.jconfirm-content-pane .jconfirm-content img {
    max-width: 100%;
    height: auto;
  }
  .jconfirm .jconfirm-box div.jconfirm-content-pane .jconfirm-content:empty {
    display: none;
  }
  .jconfirm .jconfirm-box .jconfirm-buttons {
    padding-bottom: 11px;
  }
  .jconfirm .jconfirm-box .jconfirm-buttons > button {
    margin-bottom: 4px;
    margin-left: 2px;
    margin-right: 2px;
  }
  .jconfirm .jconfirm-box .jconfirm-buttons button {
    display: inline-block;
    padding: 6px 12px;
    font-size: 14px;
    font-weight: 400;
    line-height: 1.42857143;
    text-align: center;
    white-space: nowrap;
    vertical-align: middle;
    -ms-touch-action: manipulation;
    touch-action: manipulation;
    cursor: pointer;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    border-radius: 4px;
    min-height: 1em;
    -webkit-transition: opacity 0.1s ease, background-color 0.1s ease, color 0.1s ease, background 0.1s ease, -webkit-box-shadow 0.1s ease;
    transition: opacity 0.1s ease, background-color 0.1s ease, color 0.1s ease, background 0.1s ease, -webkit-box-shadow 0.1s ease;
    transition: opacity 0.1s ease, background-color 0.1s ease, color 0.1s ease, box-shadow 0.1s ease, background 0.1s ease;
    transition: opacity 0.1s ease, background-color 0.1s ease, color 0.1s ease, box-shadow 0.1s ease, background 0.1s ease, -webkit-box-shadow 0.1s ease;
    -webkit-tap-highlight-color: transparent;
    border: none;
    background-image: none;
  }
  .jconfirm .jconfirm-box .jconfirm-buttons button.btn-blue {
    background-color: #3498db;
    color: #FFF;
    text-shadow: none;
    -webkit-transition: background .2s;
    transition: background .2s;
  }
  .jconfirm .jconfirm-box .jconfirm-buttons button.btn-blue:hover {
    background-color: #2980b9;
    color: #FFF;
  }
  .jconfirm .jconfirm-box .jconfirm-buttons button.btn-green {
    background-color: #2ecc71;
    color: #FFF;
    text-shadow: none;
    -webkit-transition: background .2s;
    transition: background .2s;
  }
  .jconfirm .jconfirm-box .jconfirm-buttons button.btn-green:hover {
    background-color: #27ae60;
    color: #FFF;
  }
  .jconfirm .jconfirm-box .jconfirm-buttons button.btn-red {
    background-color: #e74c3c;
    color: #FFF;
    text-shadow: none;
    -webkit-transition: background .2s;
    transition: background .2s;
  }
  .jconfirm .jconfirm-box .jconfirm-buttons button.btn-red:hover {
    background-color: #c0392b;
    color: #FFF;
  }
  .jconfirm .jconfirm-box .jconfirm-buttons button.btn-orange {
    background-color: #f1c40f;
    color: #FFF;
    text-shadow: none;
    -webkit-transition: background .2s;
    transition: background .2s;
  }
  .jconfirm .jconfirm-box .jconfirm-buttons button.btn-orange:hover {
    background-color: #f39c12;
    color: #FFF;
  }
  .jconfirm .jconfirm-box .jconfirm-buttons button.btn-default {
    background-color: #ecf0f1;
    color: #000;
    text-shadow: none;
    -webkit-transition: background .2s;
    transition: background .2s;
  }
  .jconfirm .jconfirm-box .jconfirm-buttons button.btn-default:hover {
    background-color: #bdc3c7;
    color: #000;
  }
  .jconfirm .jconfirm-box .jconfirm-buttons button.btn-purple {
    background-color: #9b59b6;
    color: #FFF;
    text-shadow: none;
    -webkit-transition: background .2s;
    transition: background .2s;
  }
  .jconfirm .jconfirm-box .jconfirm-buttons button.btn-purple:hover {
    background-color: #8e44ad;
    color: #FFF;
  }
  .jconfirm .jconfirm-box .jconfirm-buttons button.btn-dark {
    background-color: #34495e;
    color: #FFF;
    text-shadow: none;
    -webkit-transition: background .2s;
    transition: background .2s;
  }
  .jconfirm .jconfirm-box .jconfirm-buttons button.btn-dark:hover {
    background-color: #2c3e50;
    color: #FFF;
  }
  .jconfirm .jconfirm-box.jconfirm-type-red .jconfirm-title-c .jconfirm-icon-c {
    color: #e74c3c !important;
  }
  .jconfirm .jconfirm-box.jconfirm-type-blue .jconfirm-title-c .jconfirm-icon-c {
    color: #3498db !important;
  }
  .jconfirm .jconfirm-box.jconfirm-type-green .jconfirm-title-c .jconfirm-icon-c {
    color: #2ecc71 !important;
  }
  .jconfirm .jconfirm-box.jconfirm-type-purple .jconfirm-title-c .jconfirm-icon-c {
    color: #9b59b6 !important;
  }
  .jconfirm .jconfirm-box.jconfirm-type-orange .jconfirm-title-c .jconfirm-icon-c {
    color: #f1c40f !important;
  }
  .jconfirm .jconfirm-box.jconfirm-type-dark .jconfirm-title-c .jconfirm-icon-c {
    color: #34495e !important;
  }
  .jconfirm .jconfirm-clear {
    clear: both;
  }
  .jconfirm.jconfirm-rtl {
    direction: rtl;
  }
  .jconfirm.jconfirm-rtl div.jconfirm-closeIcon {
    left: 5px;
    right: auto;
  }
  .jconfirm.jconfirm-white .jconfirm-bg,
  .jconfirm.jconfirm-light .jconfirm-bg {
    background-color: #444;
    opacity: .2;
  }
  .jconfirm.jconfirm-white .jconfirm-box,
  .jconfirm.jconfirm-light .jconfirm-box {
    -webkit-box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    border-radius: 5px;
  }
  .jconfirm.jconfirm-white .jconfirm-box .jconfirm-title-c .jconfirm-icon-c,
  .jconfirm.jconfirm-light .jconfirm-box .jconfirm-title-c .jconfirm-icon-c {
    margin-right: 8px;
    margin-left: 0px;
  }
  .jconfirm.jconfirm-white .jconfirm-box .jconfirm-buttons,
  .jconfirm.jconfirm-light .jconfirm-box .jconfirm-buttons {
    float: right;
  }
  .jconfirm.jconfirm-white .jconfirm-box .jconfirm-buttons button,
  .jconfirm.jconfirm-light .jconfirm-box .jconfirm-buttons button {
    text-transform: uppercase;
    font-size: 14px;
    font-weight: bold;
    text-shadow: none;
  }
  .jconfirm.jconfirm-white .jconfirm-box .jconfirm-buttons button.btn-default,
  .jconfirm.jconfirm-light .jconfirm-box .jconfirm-buttons button.btn-default {
    -webkit-box-shadow: none;
            box-shadow: none;
    color: #333;
  }
  .jconfirm.jconfirm-white .jconfirm-box .jconfirm-buttons button.btn-default:hover,
  .jconfirm.jconfirm-light .jconfirm-box .jconfirm-buttons button.btn-default:hover {
    background: #ddd;
  }
  .jconfirm.jconfirm-white.jconfirm-rtl .jconfirm-title-c .jconfirm-icon-c,
  .jconfirm.jconfirm-light.jconfirm-rtl .jconfirm-title-c .jconfirm-icon-c {
    margin-left: 8px;
    margin-right: 0px;
  }
  .jconfirm.jconfirm-black .jconfirm-bg,
  .jconfirm.jconfirm-dark .jconfirm-bg {
    background-color: darkslategray;
    opacity: .4;
  }
  .jconfirm.jconfirm-black .jconfirm-box,
  .jconfirm.jconfirm-dark .jconfirm-box {
    -webkit-box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    background: #444;
    border-radius: 5px;
    color: white;
  }
  .jconfirm.jconfirm-black .jconfirm-box .jconfirm-title-c .jconfirm-icon-c,
  .jconfirm.jconfirm-dark .jconfirm-box .jconfirm-title-c .jconfirm-icon-c {
    margin-right: 8px;
    margin-left: 0px;
  }
  .jconfirm.jconfirm-black .jconfirm-box .jconfirm-buttons,
  .jconfirm.jconfirm-dark .jconfirm-box .jconfirm-buttons {
    float: right;
  }
  .jconfirm.jconfirm-black .jconfirm-box .jconfirm-buttons button,
  .jconfirm.jconfirm-dark .jconfirm-box .jconfirm-buttons button {
    border: none;
    background-image: none;
    text-transform: uppercase;
    font-size: 14px;
    font-weight: bold;
    text-shadow: none;
    -webkit-transition: background .1s;
    transition: background .1s;
    color: white;
  }
  .jconfirm.jconfirm-black .jconfirm-box .jconfirm-buttons button.btn-default,
  .jconfirm.jconfirm-dark .jconfirm-box .jconfirm-buttons button.btn-default {
    -webkit-box-shadow: none;
            box-shadow: none;
    color: #fff;
    background: none;
  }
  .jconfirm.jconfirm-black .jconfirm-box .jconfirm-buttons button.btn-default:hover,
  .jconfirm.jconfirm-dark .jconfirm-box .jconfirm-buttons button.btn-default:hover {
    background: #666;
  }
  .jconfirm.jconfirm-black.jconfirm-rtl .jconfirm-title-c .jconfirm-icon-c,
  .jconfirm.jconfirm-dark.jconfirm-rtl .jconfirm-title-c .jconfirm-icon-c {
    margin-left: 8px;
    margin-right: 0px;
  }
  .jconfirm .jconfirm-box.hilight.jconfirm-hilight-shake {
    -webkit-animation: shake 0.82s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
            animation: shake 0.82s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
    -webkit-transform: translate3d(0, 0, 0);
            transform: translate3d(0, 0, 0);
  }
  .jconfirm .jconfirm-box.hilight.jconfirm-hilight-glow {
    -webkit-animation: glow 0.82s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
            animation: glow 0.82s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
    -webkit-transform: translate3d(0, 0, 0);
            transform: translate3d(0, 0, 0);
  }
  @-webkit-keyframes shake {
    10%,
    90% {
      -webkit-transform: translate3d(-2px, 0, 0);
              transform: translate3d(-2px, 0, 0);
    }
    20%,
    80% {
      -webkit-transform: translate3d(4px, 0, 0);
              transform: translate3d(4px, 0, 0);
    }
    30%,
    50%,
    70% {
      -webkit-transform: translate3d(-8px, 0, 0);
              transform: translate3d(-8px, 0, 0);
    }
    40%,
    60% {
      -webkit-transform: translate3d(8px, 0, 0);
              transform: translate3d(8px, 0, 0);
    }
  }
  @keyframes shake {
    10%,
    90% {
      -webkit-transform: translate3d(-2px, 0, 0);
              transform: translate3d(-2px, 0, 0);
    }
    20%,
    80% {
      -webkit-transform: translate3d(4px, 0, 0);
              transform: translate3d(4px, 0, 0);
    }
    30%,
    50%,
    70% {
      -webkit-transform: translate3d(-8px, 0, 0);
              transform: translate3d(-8px, 0, 0);
    }
    40%,
    60% {
      -webkit-transform: translate3d(8px, 0, 0);
              transform: translate3d(8px, 0, 0);
    }
  }
  @-webkit-keyframes glow {
    0%,
    100% {
      -webkit-box-shadow: 0 0 0px red;
              box-shadow: 0 0 0px red;
    }
    50% {
      -webkit-box-shadow: 0 0 30px red;
              box-shadow: 0 0 30px red;
    }
  }
  @keyframes glow {
    0%,
    100% {
      -webkit-box-shadow: 0 0 0px red;
              box-shadow: 0 0 0px red;
    }
    50% {
      -webkit-box-shadow: 0 0 30px red;
              box-shadow: 0 0 30px red;
    }
  }
  /*Transition rules*/
  .jconfirm {
    -webkit-perspective: 400px;
            perspective: 400px;
  }
  .jconfirm .jconfirm-box {
    opacity: 1;
    -webkit-transition-property: all;
    transition-property: all;
  }
  .jconfirm .jconfirm-box.jconfirm-animation-top,
  .jconfirm .jconfirm-box.jconfirm-animation-left,
  .jconfirm .jconfirm-box.jconfirm-animation-right,
  .jconfirm .jconfirm-box.jconfirm-animation-bottom,
  .jconfirm .jconfirm-box.jconfirm-animation-opacity,
  .jconfirm .jconfirm-box.jconfirm-animation-zoom,
  .jconfirm .jconfirm-box.jconfirm-animation-scale,
  .jconfirm .jconfirm-box.jconfirm-animation-none,
  .jconfirm .jconfirm-box.jconfirm-animation-rotate,
  .jconfirm .jconfirm-box.jconfirm-animation-rotatex,
  .jconfirm .jconfirm-box.jconfirm-animation-rotatey,
  .jconfirm .jconfirm-box.jconfirm-animation-scaley,
  .jconfirm .jconfirm-box.jconfirm-animation-scalex {
    opacity: 0;
  }
  .jconfirm .jconfirm-box.jconfirm-animation-rotate {
    -webkit-transform: rotate(90deg);
            transform: rotate(90deg);
  }
  .jconfirm .jconfirm-box.jconfirm-animation-rotatex {
    -webkit-transform: rotateX(90deg);
            transform: rotateX(90deg);
    -webkit-transform-origin: center;
            transform-origin: center;
  }
  .jconfirm .jconfirm-box.jconfirm-animation-rotatexr {
    -webkit-transform: rotateX(-90deg);
            transform: rotateX(-90deg);
    -webkit-transform-origin: center;
            transform-origin: center;
  }
  .jconfirm .jconfirm-box.jconfirm-animation-rotatey {
    -webkit-transform: rotatey(90deg);
            transform: rotatey(90deg);
    -webkit-transform-origin: center;
            transform-origin: center;
  }
  .jconfirm .jconfirm-box.jconfirm-animation-rotateyr {
    -webkit-transform: rotatey(-90deg);
            transform: rotatey(-90deg);
    -webkit-transform-origin: center;
            transform-origin: center;
  }
  .jconfirm .jconfirm-box.jconfirm-animation-scaley {
    -webkit-transform: scaley(1.5);
            transform: scaley(1.5);
    -webkit-transform-origin: center;
            transform-origin: center;
  }
  .jconfirm .jconfirm-box.jconfirm-animation-scalex {
    -webkit-transform: scalex(1.5);
            transform: scalex(1.5);
    -webkit-transform-origin: center;
            transform-origin: center;
  }
  .jconfirm .jconfirm-box.jconfirm-animation-top {
    -webkit-transform: translate(0px, -100px);
            transform: translate(0px, -100px);
  }
  .jconfirm .jconfirm-box.jconfirm-animation-left {
    -webkit-transform: translate(-100px, 0px);
            transform: translate(-100px, 0px);
  }
  .jconfirm .jconfirm-box.jconfirm-animation-right {
    -webkit-transform: translate(100px, 0px);
            transform: translate(100px, 0px);
  }
  .jconfirm .jconfirm-box.jconfirm-animation-bottom {
    -webkit-transform: translate(0px, 100px);
            transform: translate(0px, 100px);
  }
  .jconfirm .jconfirm-box.jconfirm-animation-zoom {
    -webkit-transform: scale(1.2);
            transform: scale(1.2);
  }
  .jconfirm .jconfirm-box.jconfirm-animation-scale {
    -webkit-transform: scale(0.5);
            transform: scale(0.5);
  }
  .jconfirm .jconfirm-box.jconfirm-animation-none {
    visibility: hidden;
  }
  .jconfirm.jconfirm-supervan .jconfirm-bg {
    background-color: rgba(54, 70, 93, 0.95);
  }
  .jconfirm.jconfirm-supervan .jconfirm-box {
    background-color: transparent;
  }
  .jconfirm.jconfirm-supervan .jconfirm-box.jconfirm-type-blue {
    border: none;
  }
  .jconfirm.jconfirm-supervan .jconfirm-box.jconfirm-type-green {
    border: none;
  }
  .jconfirm.jconfirm-supervan .jconfirm-box.jconfirm-type-red {
    border: none;
  }
  .jconfirm.jconfirm-supervan .jconfirm-box.jconfirm-type-orange {
    border: none;
  }
  .jconfirm.jconfirm-supervan .jconfirm-box.jconfirm-type-purple {
    border: none;
  }
  .jconfirm.jconfirm-supervan .jconfirm-box.jconfirm-type-dark {
    border: none;
  }
  .jconfirm.jconfirm-supervan .jconfirm-box div.jconfirm-closeIcon {
    color: white;
  }
  .jconfirm.jconfirm-supervan .jconfirm-box div.jconfirm-title-c {
    text-align: center;
    color: white;
    font-size: 28px;
    font-weight: normal;
  }
  .jconfirm.jconfirm-supervan .jconfirm-box div.jconfirm-title-c > * {
    padding-bottom: 25px;
  }
  .jconfirm.jconfirm-supervan .jconfirm-box div.jconfirm-title-c .jconfirm-icon-c {
    margin-right: 8px;
    margin-left: 0px;
  }
  .jconfirm.jconfirm-supervan .jconfirm-box div.jconfirm-content-pane {
    margin-bottom: 25px;
  }
  .jconfirm.jconfirm-supervan .jconfirm-box div.jconfirm-content {
    text-align: center;
    color: white;
  }
  .jconfirm.jconfirm-supervan .jconfirm-box .jconfirm-buttons {
    text-align: center;
  }
  .jconfirm.jconfirm-supervan .jconfirm-box .jconfirm-buttons button {
    font-size: 16px;
    border-radius: 2px;
    background: #303f53;
    text-shadow: none;
    border: none;
    color: white;
    padding: 10px;
    min-width: 100px;
  }
  .jconfirm.jconfirm-supervan.jconfirm-rtl .jconfirm-box div.jconfirm-title-c .jconfirm-icon-c {
    margin-left: 8px;
    margin-right: 0px;
  }
  .jconfirm.jconfirm-material .jconfirm-bg {
    background-color: rgba(0, 0, 0, 0.67);
  }
  .jconfirm.jconfirm-material .jconfirm-box {
    background-color: white;
    -webkit-box-shadow: 0 7px 8px -4px rgba(0, 0, 0, 0.2), 0 13px 19px 2px rgba(0, 0, 0, 0.14), 0 5px 24px 4px rgba(0, 0, 0, 0.12);
            box-shadow: 0 7px 8px -4px rgba(0, 0, 0, 0.2), 0 13px 19px 2px rgba(0, 0, 0, 0.14), 0 5px 24px 4px rgba(0, 0, 0, 0.12);
    padding: 30px 25px 10px 25px;
  }
  .jconfirm.jconfirm-material .jconfirm-box .jconfirm-title-c .jconfirm-icon-c {
    margin-right: 8px;
    margin-left: 0px;
  }
  .jconfirm.jconfirm-material .jconfirm-box div.jconfirm-closeIcon {
    color: rgba(0, 0, 0, 0.87);
  }
  .jconfirm.jconfirm-material .jconfirm-box div.jconfirm-title-c {
    color: rgba(0, 0, 0, 0.87);
    font-size: 22px;
    font-weight: bold;
  }
  .jconfirm.jconfirm-material .jconfirm-box div.jconfirm-content {
    color: rgba(0, 0, 0, 0.87);
  }
  .jconfirm.jconfirm-material .jconfirm-box .jconfirm-buttons {
    text-align: right;
  }
  .jconfirm.jconfirm-material .jconfirm-box .jconfirm-buttons button {
    text-transform: uppercase;
    font-weight: 500;
  }
  .jconfirm.jconfirm-material.jconfirm-rtl .jconfirm-title-c .jconfirm-icon-c {
    margin-left: 8px;
    margin-right: 0px;
  }
  .jconfirm.jconfirm-bootstrap .jconfirm-bg {
    background-color: rgba(0, 0, 0, 0.21);
  }
  .jconfirm.jconfirm-bootstrap .jconfirm-box {
    background-color: white;
    -webkit-box-shadow: 0 3px 8px 0px rgba(0, 0, 0, 0.2);
            box-shadow: 0 3px 8px 0px rgba(0, 0, 0, 0.2);
    border: solid 1px rgba(0, 0, 0, 0.4);
    padding: 15px 0 0;
  }
  .jconfirm.jconfirm-bootstrap .jconfirm-box .jconfirm-title-c .jconfirm-icon-c {
    margin-right: 8px;
    margin-left: 0px;
  }
  .jconfirm.jconfirm-bootstrap .jconfirm-box div.jconfirm-closeIcon {
    color: rgba(0, 0, 0, 0.87);
  }
  .jconfirm.jconfirm-bootstrap .jconfirm-box div.jconfirm-title-c {
    color: rgba(0, 0, 0, 0.87);
    font-size: 22px;
    font-weight: bold;
    padding-left: 15px;
    padding-right: 15px;
  }
  .jconfirm.jconfirm-bootstrap .jconfirm-box div.jconfirm-content {
    color: rgba(0, 0, 0, 0.87);
    padding: 0px 15px;
  }
  .jconfirm.jconfirm-bootstrap .jconfirm-box .jconfirm-buttons {
    text-align: right;
    padding: 10px;
    margin: -5px 0 0px;
    border-top: solid 1px #ddd;
    overflow: hidden;
    border-radius: 0 0 4px 4px;
  }
  .jconfirm.jconfirm-bootstrap .jconfirm-box .jconfirm-buttons button {
    font-weight: 500;
  }
  .jconfirm.jconfirm-bootstrap.jconfirm-rtl .jconfirm-title-c .jconfirm-icon-c {
    margin-left: 8px;
    margin-right: 0px;
  }
  .jconfirm.jconfirm-modern .jconfirm-bg {
    background-color: slategray;
    opacity: .6;
  }
  .jconfirm.jconfirm-modern .jconfirm-box {
    background-color: white;
    -webkit-box-shadow: 0 7px 8px -4px rgba(0, 0, 0, 0.2), 0 13px 19px 2px rgba(0, 0, 0, 0.14), 0 5px 24px 4px rgba(0, 0, 0, 0.12);
            box-shadow: 0 7px 8px -4px rgba(0, 0, 0, 0.2), 0 13px 19px 2px rgba(0, 0, 0, 0.14), 0 5px 24px 4px rgba(0, 0, 0, 0.12);
    padding: 30px 30px 15px;
  }
  .jconfirm.jconfirm-modern .jconfirm-box div.jconfirm-closeIcon {
    color: rgba(0, 0, 0, 0.87);
    top: 15px;
    right: 15px;
  }
  .jconfirm.jconfirm-modern .jconfirm-box div.jconfirm-title-c {
    color: rgba(0, 0, 0, 0.87);
    font-size: 24px;
    font-weight: bold;
    text-align: center;
    margin-bottom: 10px;
  }
  .jconfirm.jconfirm-modern .jconfirm-box div.jconfirm-title-c .jconfirm-icon-c {
    -webkit-transition: -webkit-transform .5s;
    transition: -webkit-transform .5s;
    transition: transform .5s;
    transition: transform .5s, -webkit-transform .5s;
    -webkit-transform: scale(0);
            transform: scale(0);
    display: block;
    margin-right: 0px;
    margin-left: 0px;
    margin-bottom: 10px;
    font-size: 69px;
    color: #aaa;
  }
  .jconfirm.jconfirm-modern .jconfirm-box div.jconfirm-content {
    text-align: center;
    font-size: 15px;
    color: #777;
    margin-bottom: 25px;
  }
  .jconfirm.jconfirm-modern .jconfirm-box .jconfirm-buttons {
    text-align: center;
  }
  .jconfirm.jconfirm-modern .jconfirm-box .jconfirm-buttons button {
    font-weight: bold;
    text-transform: uppercase;
    -webkit-transition: background .1s;
    transition: background .1s;
    padding: 10px 20px;
  }
  .jconfirm.jconfirm-modern .jconfirm-box .jconfirm-buttons button + button {
    margin-left: 4px;
  }
  .jconfirm.jconfirm-modern.jconfirm-open .jconfirm-box .jconfirm-title-c .jconfirm-icon-c {
    -webkit-transform: scale(1);
            transform: scale(1);
  }</style><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/useEditorShopPayNavigation.BW3E1m6g.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/VaultedPayment.CgXTLNzl.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/LocalizationExtensionField.BULHRGvh.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/RememberMeDescriptionText.Bg8G9G5y.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/PayButtonSection.Dan-lf-k.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/component-ShopPayVerificationSwitch.DNjAbpmp.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/useSubscribeMessenger.E4C7PNGt.js" crossorigin=""><link rel="prefetch" fetchpriority="low" as="script" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/index.C8_-YN6d.js" crossorigin=""><link href="./CleanCo UK_files/css" type="text/css" rel="stylesheet"><style type="text/css">#swell-bootstrap .rewards-templete h1,
#swell-bootstrap .rewards-templete h2,
#swell-bootstrap .rewards-templete h3,
#swell-bootstrap .rewards-templete h4,
#swell-bootstrap .rewards-templete h5,
#swell-bootstrap .rewards-templete h6 {
  padding: 0px !important;
  font-style: normal;
}
</style><link rel="prefetch" fetchpriority="low" as="style" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/assets/app.CqblHuRC.css" crossorigin=""><link rel="prefetch" fetchpriority="low" as="style" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/assets/OnePage.PMX4OSBO.css" crossorigin=""><link rel="prefetch" fetchpriority="low" as="style" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/assets/DeliveryMethodSelectorSection.DmqjTkNB.css" crossorigin=""><link rel="prefetch" fetchpriority="low" as="style" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/assets/useEditorShopPayNavigation.DCOTvxC3.css" crossorigin=""><link rel="prefetch" fetchpriority="low" as="style" href="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1.en/assets/ShopPayVerificationSwitch.DW7NMDXG.css" crossorigin=""><link rel="prefetch" fetchpriority="low" as="image" href="https://cdn.shopify.com/s/files/1/0267/9560/6113/files/CleanCo_Vectored_Logo_RGB_Rosemary_x320.png?v=1697538328" crossorigin=""><script async="true" type="text/javascript" src="./CleanCo UK_files/unified-tag.js.download"></script><script type="text/javascript" src="./CleanCo UK_files/kHM.js.download" async="true"></script></head>
  <body class="template-gbb pt-[--headerHeight] header-revealed" style="--headerHeight: 146px;" data-page="addProductsPage1" data-new-gr-c-s-check-loaded="14.1221.0" data-gr-ext-installed=""><div data-yotpo-instance-id="583477" class="yotpo-widget-instance"></div>
    <div id="swell-customer-identification" data-authenticated="true" data-email="" data-id="" data-tags="" style="display:none;"></div>

    <sticky-header class="group/stickyheader fixed top-0 z-20 w-full transition-all duration-500 [&amp;.hide]:-translate-y-full fill">
      <!-- BEGIN sections: group-header -->
<div id="shopify-section-sections--14915551756385__announcement-bar" class="shopify-section shopify-section-group-group-header"><announcement-bar data-options="{
      &quot;autoplay&quot;:true,
      &quot;autoplay_speed&quot;:3,
      &quot;effect&quot;: &quot;fade&quot;
    }" client:idle="">
    <div class="bg-[--backgroundColour] text-[--textColour]" style="
        --backgroundColour:#0b464c;
        --textColour:#f7f2e8;
      ">
      <div class="swiper swiper-fade swiper-initialized swiper-horizontal swiper-watch-progress swiper-backface-hidden">
        <div class="swiper-wrapper" style="transition-duration: 0ms; transition-delay: 0ms;"><div class="swiper-slide swiper-slide-next swiper-slide-prev" style="width: 1314px; opacity: 0; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;" data-swiper-slide-index="0"><a href="https://clean.co/collections/shop" class="block bg-[--backgroundColour] px-4 py-2" style="
                    --backgroundColour:#f7f2e8;
                    --textColour:#0b464c;
                  "><p class="text-center font-gtpressura text-sm uppercase text-[--textColour]">Free Shipping when you order 3 bottles or more</p></a></div><div class="swiper-slide swiper-slide-visible swiper-slide-fully-visible swiper-slide-active" style="width: 1314px; opacity: 1; transform: translate3d(-1314px, 0px, 0px); transition-duration: 0ms;" data-swiper-slide-index="1"><a href="https://clean.co/pages/rewards" class="block bg-[--backgroundColour] px-4 py-2" style="
                    --backgroundColour:rgba(0,0,0,0);
                    --textColour:;
                  "><p class="text-center font-gtpressura text-sm uppercase text-[--textColour]">JOIN THE CLEAN CLUB &amp; EARN POINTS</p></a></div></div>
      </div>
    </div>
  </announcement-bar>
</div><div id="shopify-section-sections--14915551756385__header" class="shopify-section shopify-section-group-group-header"><header class="flex gap-4 px-3 transition-all group-hover/stickyheader:bg-[--headerFillBackground] group-fill/stickyheader:bg-[--headerFillBackground] lg:px-8">
  <div class="flex flex-1">
    <button class="group/hamburger flex items-center gap-2 font-gtpressura uppercase text-ice group-hover/stickyheader:text-[--headerFillText] group-fill/stickyheader:text-[--headerFillText] lg:hidden" data-mobile-menu-trigger="">
      <svg class="w-3 group-active/hamburger:hidden" viewBox="0 0 11 10" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill="currentColor" d="M0 0h11v2H0zM0 4h11v2H0zM0 8h11v2H0z"></path>
      </svg>

      <svg class="hidden w-3 group-active/hamburger:block" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill="currentColor" d="M1.414 0l7.778 7.778-1.414 1.414L0 1.414z"></path><path fill="currentColor" d="M0 7.97L7.778.194l1.415 1.414-7.778 7.778z"></path>
      </svg>

      <span class="relative" data-text="">Menu</span>
    </button><main-navigation class="hidden items-center lg:flex" client:idle="">
  <nav class="h-full" role="navigation" aria-label="Main Navigation">
    <ul class="flex h-full gap-4"><li class="group/menuitem flex items-center" data-dropdown="">
          <a href="https://clean.co/collections/shop" title="Shop" class="whitespace-nowrap rounded-md px-2.5 py-2 font-gtpressura text-sm uppercase text-ice transition-all hover:bg-[--headerFillHoverBackground] hover:!text-[--headerFillHoverText] group-hover/menuitem:bg-[--headerFillHoverBackground] group-hover/menuitem:!text-[--headerFillHoverText] group-hover/stickyheader:text-[--headerFillText] group-active/menuitem:bg-[--headerFillHoverBackground] group-active/menuitem:text-[--headerFillText] group-fill/stickyheader:text-[--headerFillText] lg:text-[15px]">Shop</a><div class="invisible absolute inset-x-0 top-full z-[53] w-full border-t-2 border-solid border-rosemary bg-ice opacity-0 transition-all group-active/menuitem:visible group-active/menuitem:opacity-100">
              <div class="px-3 py-5 lg:px-8">
                <div class="relative grid grid-cols-5 gap-4">
                  <ul class="col-span-1 flex flex-col gap-2"><li class="group/childlink active" data-sub-menu-target="sections--14915551756385__header-clean-spirits-1">
                        <a href="https://clean.co/collections/shop" title="Clean Spirits" class="block rounded-md px-2.5 py-4 font-ultramagnetic text-[15px] uppercase text-rosemary transition-all hover:bg-blue hover:text-ice group-hover/childlink:bg-blue group-hover/childlink:text-ice">Clean Spirits</a>
                      </li><li class="group/childlink" data-sub-menu-target="sections--14915551756385__header-clean-bundles-2">
                        <a href="https://clean.co/collections/bundles" title="Clean Bundles" class="block rounded-md px-2.5 py-4 font-ultramagnetic text-[15px] uppercase text-rosemary transition-all hover:bg-blue hover:text-ice group-hover/childlink:bg-blue group-hover/childlink:text-ice">Clean Bundles</a>
                      </li><li class="group/childlink" data-sub-menu-target="sections--14915551756385__header-merch-more-3">
                        <a href="https://clean.co/apps/gbb/easybundle/2?page=addProductsPage1&amp;currentFlow=byob#" title="Merch &amp; more" class="block rounded-md px-2.5 py-4 font-ultramagnetic text-[15px] uppercase text-rosemary transition-all hover:bg-blue hover:text-ice group-hover/childlink:bg-blue group-hover/childlink:text-ice">Merch &amp; more</a>
                      </li><li class="group/childlink mt-auto">
                        <a href="https://clean.co/collections/shop" title="Shop all products" class="btn-full-width btn-rosemary-filled">Shop all products</a>
                      </li>
                  </ul>
                  <div class="grid-col-4 col-span-4 grid gap-2"><div class="hidden auto-rows-fr gap-4 self-start active/childlink:grid lg:grid-cols-4 active" data-sub-menu="sections--14915551756385__header-clean-spirits-1"><a href="https://clean.co/products/clean-g-alcohol-free-spirit" title="Clean G" class="group/block relative grid aspect-[53/38] grid-cols-2 overflow-hidden rounded-md bg-[--accent] px-5 pt-5 transition-all hover:opacity-90" style="--accent:#71aa4b"><img src="./CleanCo UK_files/Clean_G.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean G</span><div class="absolute -right-5 top-4 block aspect-square w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0">




  <img src="./CleanCo UK_files/1_f24127fd-9d1b-4f00-979f-c224fa397343.png" srcset="//clean.co/cdn/shop/files/1_f24127fd-9d1b-4f00-979f-c224fa397343.png?v=1727779031&amp;width=165 165w" width="338" height="700" loading="lazy" class="w-full h-full object-contain object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                              </div>
                            </a><a href="https://clean.co/products/clean-g-rhubarb-alcohol-free-spirit" title="Clean G Rhubarb" class="group/block relative grid aspect-[53/38] grid-cols-2 overflow-hidden rounded-md bg-[--accent] px-5 pt-5 transition-all hover:opacity-90" style="--accent:#e84772"><img src="./CleanCo UK_files/Clean_G_Rhubarb.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean G Rhubarb</span><div class="absolute -right-5 top-4 block aspect-square w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0">




  <img src="./CleanCo UK_files/6_e2ad49ba-bcc7-46ab-b1fc-656b5387386b.png" srcset="//clean.co/cdn/shop/files/6_e2ad49ba-bcc7-46ab-b1fc-656b5387386b.png?v=1727779040&amp;width=165 165w" width="338" height="700" loading="lazy" class="w-full h-full object-contain object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                              </div>
                            </a><a href="https://clean.co/products/clean-r-alcohol-free-spirit" title="Clean R" class="group/block relative grid aspect-[53/38] grid-cols-2 overflow-hidden rounded-md bg-[--accent] px-5 pt-5 transition-all hover:opacity-90" style="--accent:#f29500"><img src="./CleanCo UK_files/Clean_R.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean R</span><div class="absolute -right-5 top-4 block aspect-square w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0">




  <img src="./CleanCo UK_files/4_3fc2e500-75b0-451f-9587-2d6d1b31e2f6.png" srcset="//clean.co/cdn/shop/files/4_3fc2e500-75b0-451f-9587-2d6d1b31e2f6.png?v=1727779041&amp;width=165 165w" width="338" height="700" loading="lazy" class="w-full h-full object-contain object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                              </div>
                            </a><a href="https://clean.co/products/clean-t-alcohol-free-spirit" title="Clean T" class="group/block relative grid aspect-[53/38] grid-cols-2 overflow-hidden rounded-md bg-[--accent] px-5 pt-5 transition-all hover:opacity-90" style="--accent:#c595d8"><img src="./CleanCo UK_files/Clean_T.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean T</span><div class="absolute -right-5 top-4 block aspect-square w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0">




  <img src="./CleanCo UK_files/2_413276f9-262b-4859-ad98-4d95f8e521ba.png" srcset="//clean.co/cdn/shop/files/2_413276f9-262b-4859-ad98-4d95f8e521ba.png?v=1727779067&amp;width=165 165w" width="338" height="700" loading="lazy" class="w-full h-full object-contain object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                              </div>
                            </a><a href="https://clean.co/products/clean-w-alcohol-free-spirit" title="Clean W" class="group/block relative grid aspect-[53/38] grid-cols-2 overflow-hidden rounded-md bg-[--accent] px-5 pt-5 transition-all hover:opacity-90" style="--accent:#ea5311"><img src="./CleanCo UK_files/Clean_W.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean W</span><div class="absolute -right-5 top-4 block aspect-square w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0">




  <img src="./CleanCo UK_files/3_964ee5b8-9897-4cb5-b7d2-4c3960b78e24.png" srcset="//clean.co/cdn/shop/files/3_964ee5b8-9897-4cb5-b7d2-4c3960b78e24.png?v=1727779067&amp;width=165 165w" width="338" height="700" loading="lazy" class="w-full h-full object-contain object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                              </div>
                            </a></div><div class="hidden auto-rows-fr gap-4 self-start active/childlink:grid lg:grid-cols-4" data-sub-menu="sections--14915551756385__header-clean-bundles-2"><a href="https://clean.co/products/clean-gin-tonic-bundle-alcohol-free" title="Clean G+T" class="group/block relative grid aspect-[53/38] grid-cols-2 overflow-hidden rounded-md bg-[--accent] px-5 pt-5 transition-all hover:opacity-90" style="--accent:#71aa4b"><img src="./CleanCo UK_files/Clean_G.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean G+T</span><div class="absolute -right-5 top-4 block aspect-square w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0">




  <img src="./CleanCo UK_files/CleanG_T_125ab40d-956b-46ee-a152-a2d7025bf7cc.png" alt="Clean G&amp;T" srcset="//clean.co/cdn/shop/files/CleanG_T_125ab40d-956b-46ee-a152-a2d7025bf7cc.png?v=1727778271&amp;width=165 165w, //clean.co/cdn/shop/files/CleanG_T_125ab40d-956b-46ee-a152-a2d7025bf7cc.png?v=1727778271&amp;width=360 360w, //clean.co/cdn/shop/files/CleanG_T_125ab40d-956b-46ee-a152-a2d7025bf7cc.png?v=1727778271&amp;width=500 500w, //clean.co/cdn/shop/files/CleanG_T_125ab40d-956b-46ee-a152-a2d7025bf7cc.png?v=1727778271&amp;width=720 720w, //clean.co/cdn/shop/files/CleanG_T_125ab40d-956b-46ee-a152-a2d7025bf7cc.png?v=1727778271&amp;width=960 960w, //clean.co/cdn/shop/files/CleanG_T_125ab40d-956b-46ee-a152-a2d7025bf7cc.png?v=1727778271&amp;width=1066 1066w, //clean.co/cdn/shop/files/CleanG_T_125ab40d-956b-46ee-a152-a2d7025bf7cc.png?v=1727778271&amp;width=1280 1280w, //clean.co/cdn/shop/files/CleanG_T_125ab40d-956b-46ee-a152-a2d7025bf7cc.png?v=1727778271&amp;width=1500 1500w" width="1750" height="1750" loading="lazy" class="w-full h-full object-contain object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                              </div>
                            </a><a href="https://clean.co/products/clean-rhubarb-gin-tonic-bundle-alcohol-free" title="Clean Rhubarb G+T" class="group/block relative grid aspect-[53/38] grid-cols-2 overflow-hidden rounded-md bg-[--accent] px-5 pt-5 transition-all hover:opacity-90" style="--accent:#e84772"><img src="./CleanCo UK_files/Clean_G_Rhubarb.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean Rhubarb G+T</span><div class="absolute -right-5 top-4 block aspect-square w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0">




  <img src="./CleanCo UK_files/CleanRhubarbG_T_a6fee4d5-7783-4d9a-a281-09af3e0f03ea.png" alt="Clean Rhubarb G+T" srcset="//clean.co/cdn/shop/files/CleanRhubarbG_T_a6fee4d5-7783-4d9a-a281-09af3e0f03ea.png?v=1727778276&amp;width=165 165w, //clean.co/cdn/shop/files/CleanRhubarbG_T_a6fee4d5-7783-4d9a-a281-09af3e0f03ea.png?v=1727778276&amp;width=360 360w, //clean.co/cdn/shop/files/CleanRhubarbG_T_a6fee4d5-7783-4d9a-a281-09af3e0f03ea.png?v=1727778276&amp;width=500 500w, //clean.co/cdn/shop/files/CleanRhubarbG_T_a6fee4d5-7783-4d9a-a281-09af3e0f03ea.png?v=1727778276&amp;width=720 720w, //clean.co/cdn/shop/files/CleanRhubarbG_T_a6fee4d5-7783-4d9a-a281-09af3e0f03ea.png?v=1727778276&amp;width=960 960w, //clean.co/cdn/shop/files/CleanRhubarbG_T_a6fee4d5-7783-4d9a-a281-09af3e0f03ea.png?v=1727778276&amp;width=1066 1066w, //clean.co/cdn/shop/files/CleanRhubarbG_T_a6fee4d5-7783-4d9a-a281-09af3e0f03ea.png?v=1727778276&amp;width=1280 1280w, //clean.co/cdn/shop/files/CleanRhubarbG_T_a6fee4d5-7783-4d9a-a281-09af3e0f03ea.png?v=1727778276&amp;width=1500 1500w" width="1750" height="1750" loading="lazy" class="w-full h-full object-contain object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                              </div>
                            </a><a href="https://clean.co/products/clean-nstormy-bundle-alcohol-free-rum" title="Clean N&#39;Stormy" class="group/block relative grid aspect-[53/38] grid-cols-2 overflow-hidden rounded-md bg-[--accent] px-5 pt-5 transition-all hover:opacity-90" style="--accent:#f29500"><img src="./CleanCo UK_files/Clean_R.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean N'Stormy</span><div class="absolute -right-5 top-4 block aspect-square w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0">




  <img src="./CleanCo UK_files/CleanNStormy_14a7600c-612e-49ee-858b-8414e8c2baae.png" alt="Clean N&#39;Stormy" srcset="//clean.co/cdn/shop/files/CleanNStormy_14a7600c-612e-49ee-858b-8414e8c2baae.png?v=1727778267&amp;width=165 165w, //clean.co/cdn/shop/files/CleanNStormy_14a7600c-612e-49ee-858b-8414e8c2baae.png?v=1727778267&amp;width=360 360w, //clean.co/cdn/shop/files/CleanNStormy_14a7600c-612e-49ee-858b-8414e8c2baae.png?v=1727778267&amp;width=500 500w, //clean.co/cdn/shop/files/CleanNStormy_14a7600c-612e-49ee-858b-8414e8c2baae.png?v=1727778267&amp;width=720 720w, //clean.co/cdn/shop/files/CleanNStormy_14a7600c-612e-49ee-858b-8414e8c2baae.png?v=1727778267&amp;width=960 960w, //clean.co/cdn/shop/files/CleanNStormy_14a7600c-612e-49ee-858b-8414e8c2baae.png?v=1727778267&amp;width=1066 1066w, //clean.co/cdn/shop/files/CleanNStormy_14a7600c-612e-49ee-858b-8414e8c2baae.png?v=1727778267&amp;width=1280 1280w, //clean.co/cdn/shop/files/CleanNStormy_14a7600c-612e-49ee-858b-8414e8c2baae.png?v=1727778267&amp;width=1500 1500w" width="1750" height="1750" loading="lazy" class="w-full h-full object-contain object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                              </div>
                            </a><a href="https://clean.co/products/clean-whiskey-ginger-bundle-alcohol-free" title="Clean W &amp; Ginger" class="group/block relative grid aspect-[53/38] grid-cols-2 overflow-hidden rounded-md bg-[--accent] px-5 pt-5 transition-all hover:opacity-90" style="--accent:#ea5311"><img src="./CleanCo UK_files/Clean_W.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean W &amp; Ginger</span><div class="absolute -right-5 top-4 block aspect-square w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0">




  <img src="./CleanCo UK_files/CleanW_Ginger_09fb137e-61c8-4eab-9ac2-79699ad529c5.png" alt="Clean W &amp; Ginger" srcset="//clean.co/cdn/shop/files/CleanW_Ginger_09fb137e-61c8-4eab-9ac2-79699ad529c5.png?v=1727778281&amp;width=165 165w, //clean.co/cdn/shop/files/CleanW_Ginger_09fb137e-61c8-4eab-9ac2-79699ad529c5.png?v=1727778281&amp;width=360 360w, //clean.co/cdn/shop/files/CleanW_Ginger_09fb137e-61c8-4eab-9ac2-79699ad529c5.png?v=1727778281&amp;width=500 500w, //clean.co/cdn/shop/files/CleanW_Ginger_09fb137e-61c8-4eab-9ac2-79699ad529c5.png?v=1727778281&amp;width=720 720w, //clean.co/cdn/shop/files/CleanW_Ginger_09fb137e-61c8-4eab-9ac2-79699ad529c5.png?v=1727778281&amp;width=960 960w, //clean.co/cdn/shop/files/CleanW_Ginger_09fb137e-61c8-4eab-9ac2-79699ad529c5.png?v=1727778281&amp;width=1066 1066w, //clean.co/cdn/shop/files/CleanW_Ginger_09fb137e-61c8-4eab-9ac2-79699ad529c5.png?v=1727778281&amp;width=1280 1280w, //clean.co/cdn/shop/files/CleanW_Ginger_09fb137e-61c8-4eab-9ac2-79699ad529c5.png?v=1727778281&amp;width=1500 1500w" width="1750" height="1750" loading="lazy" class="w-full h-full object-contain object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                              </div>
                            </a></div><div class="hidden auto-rows-fr gap-4 self-start active/childlink:grid lg:grid-cols-4" data-sub-menu="sections--14915551756385__header-merch-more-3"><a href="https://clean.co/products/clean-cocktail-recipe-book" title="Cocktails Book" class="group/block relative grid aspect-[53/38] grid-cols-2 overflow-hidden rounded-md bg-[--accent] px-5 pt-5 transition-all hover:opacity-90" style="--accent:#0B464C"><span class="font-ultramagnetic uppercase text-ice">Cocktails Book</span><div class="absolute -right-5 top-4 block aspect-square w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0">




  <img src="./CleanCo UK_files/book_navigation.png" srcset="//clean.co/cdn/shop/files/book_navigation.png?v=1723474505&amp;width=165 165w, //clean.co/cdn/shop/files/book_navigation.png?v=1723474505&amp;width=360 360w, //clean.co/cdn/shop/files/book_navigation.png?v=1723474505&amp;width=500 500w, //clean.co/cdn/shop/files/book_navigation.png?v=1723474505&amp;width=720 720w, //clean.co/cdn/shop/files/book_navigation.png?v=1723474505&amp;width=960 960w, //clean.co/cdn/shop/files/book_navigation.png?v=1723474505&amp;width=1066 1066w, //clean.co/cdn/shop/files/book_navigation.png?v=1723474505&amp;width=1280 1280w, //clean.co/cdn/shop/files/book_navigation.png?v=1723474505&amp;width=1500 1500w, //clean.co/cdn/shop/files/book_navigation.png?v=1723474505&amp;width=1800 1800w" width="2000" height="2000" loading="lazy" class="w-full h-full object-contain object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                              </div>
                            </a><a href="https://clean.co/products/gift-card" title="Gift cards" class="group/block relative grid aspect-[53/38] grid-cols-2 overflow-hidden rounded-md bg-[--accent] px-5 pt-5 transition-all hover:opacity-90" style="--accent:#1c98a5"><span class="font-ultramagnetic uppercase text-ice">Gift cards</span><div class="absolute -right-5 top-4 block aspect-square w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0">




  <img src="./CleanCo UK_files/ECOM_US_BOTTLES_0.0.png" srcset="//clean.co/cdn/shop/files/ECOM_US_BOTTLES_0.0.png?v=1727430607&amp;width=165 165w, //clean.co/cdn/shop/files/ECOM_US_BOTTLES_0.0.png?v=1727430607&amp;width=360 360w, //clean.co/cdn/shop/files/ECOM_US_BOTTLES_0.0.png?v=1727430607&amp;width=500 500w, //clean.co/cdn/shop/files/ECOM_US_BOTTLES_0.0.png?v=1727430607&amp;width=720 720w, //clean.co/cdn/shop/files/ECOM_US_BOTTLES_0.0.png?v=1727430607&amp;width=960 960w, //clean.co/cdn/shop/files/ECOM_US_BOTTLES_0.0.png?v=1727430607&amp;width=1066 1066w, //clean.co/cdn/shop/files/ECOM_US_BOTTLES_0.0.png?v=1727430607&amp;width=1280 1280w, //clean.co/cdn/shop/files/ECOM_US_BOTTLES_0.0.png?v=1727430607&amp;width=1500 1500w, //clean.co/cdn/shop/files/ECOM_US_BOTTLES_0.0.png?v=1727430607&amp;width=1800 1800w" width="2000" height="2000" loading="lazy" class="w-full h-full object-contain object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                              </div>
                            </a></div></div>
                </div>
              </div>
            </div></li><li class="flex items-center">
          <a href="https://clean.co/apps/gbb/easybundle/2" title="Build a box" class="whitespace-nowrap rounded-md px-2.5 py-2 font-gtpressura text-sm uppercase text-ice transition-all hover:bg-[--headerFillHoverBackground] hover:!text-[--headerFillHoverText] group-hover/menuitem:bg-[--headerFillHoverBackground] group-hover/menuitem:!text-[--headerFillHoverText] group-hover/stickyheader:text-[--headerFillText] group-active/menuitem:bg-[--headerFillHoverBackground] group-active/menuitem:text-[--headerFillText] group-fill/stickyheader:text-[--headerFillText] lg:text-[15px]">Build a box</a></li><li class="flex items-center">
          <a href="https://clean.co/pages/subscribe-save" title="Subscribe &amp; Save" class="whitespace-nowrap rounded-md px-2.5 py-2 font-gtpressura text-sm uppercase text-ice transition-all hover:bg-[--headerFillHoverBackground] hover:!text-[--headerFillHoverText] group-hover/menuitem:bg-[--headerFillHoverBackground] group-hover/menuitem:!text-[--headerFillHoverText] group-hover/stickyheader:text-[--headerFillText] group-active/menuitem:bg-[--headerFillHoverBackground] group-active/menuitem:text-[--headerFillText] group-fill/stickyheader:text-[--headerFillText] lg:text-[15px]">Subscribe &amp; Save</a></li><li class="flex items-center">
          <a href="https://clean.co/blogs/clean-cocktails" title="Clean Cocktails" class="whitespace-nowrap rounded-md px-2.5 py-2 font-gtpressura text-sm uppercase text-ice transition-all hover:bg-[--headerFillHoverBackground] hover:!text-[--headerFillHoverText] group-hover/menuitem:bg-[--headerFillHoverBackground] group-hover/menuitem:!text-[--headerFillHoverText] group-hover/stickyheader:text-[--headerFillText] group-active/menuitem:bg-[--headerFillHoverBackground] group-active/menuitem:text-[--headerFillText] group-fill/stickyheader:text-[--headerFillText] lg:text-[15px]">Clean Cocktails</a></li><li class="relative group/menuitem flex items-center" data-dropdown="">
          <a href="https://clean.co/pages/about-cleanco-story" title="About" class="whitespace-nowrap rounded-md px-2.5 py-2 font-gtpressura text-sm uppercase text-ice transition-all hover:bg-[--headerFillHoverBackground] hover:!text-[--headerFillHoverText] group-hover/menuitem:bg-[--headerFillHoverBackground] group-hover/menuitem:!text-[--headerFillHoverText] group-hover/stickyheader:text-[--headerFillText] group-active/menuitem:bg-[--headerFillHoverBackground] group-active/menuitem:text-[--headerFillText] group-fill/stickyheader:text-[--headerFillText] lg:text-[15px]">About</a><ul class="invisible absolute -left-4 top-full w-[285px] rounded-b-md bg-ice p-4 opacity-0 transition-all group-active/menuitem:visible group-active/menuitem:opacity-100"><li>
                  <a href="https://clean.co/pages/about-cleanco-story" title="OUR STORY" class="block whitespace-nowrap rounded-md px-2.5 py-4 font-ultramagnetic text-[15px] uppercase text-rosemary transition-all hover:bg-blue hover:text-ice">OUR STORY</a>
                </li><li>
                  <a href="https://clean.co/blogs/news" title="THE CLEAN CHRONICLES" class="block whitespace-nowrap rounded-md px-2.5 py-4 font-ultramagnetic text-[15px] uppercase text-rosemary transition-all hover:bg-blue hover:text-ice">THE CLEAN CHRONICLES</a>
                </li><li>
                  <a href="https://clean.co/blogs/news/our-sustainability-impact" title="SUSTAINABILITY" class="block whitespace-nowrap rounded-md px-2.5 py-4 font-ultramagnetic text-[15px] uppercase text-rosemary transition-all hover:bg-blue hover:text-ice">SUSTAINABILITY</a>
                </li><li>
                  <a href="https://clean.co/blogs/news/the-art-of-cleanco-spirits" title="CRAFTSMANSHIP" class="block whitespace-nowrap rounded-md px-2.5 py-4 font-ultramagnetic text-[15px] uppercase text-rosemary transition-all hover:bg-blue hover:text-ice">CRAFTSMANSHIP</a>
                </li><li>
                  <a href="https://clean.co/pages/rewards" title="JOIN THE CLEAN CLUB" class="block whitespace-nowrap rounded-md px-2.5 py-4 font-ultramagnetic text-[15px] uppercase text-rosemary transition-all hover:bg-blue hover:text-ice">JOIN THE CLEAN CLUB</a>
                </li><li>
                  <a href="https://clean.co/pages/faqs" title="FAQ" class="block whitespace-nowrap rounded-md px-2.5 py-4 font-ultramagnetic text-[15px] uppercase text-rosemary transition-all hover:bg-blue hover:text-ice">FAQ</a>
                </li></ul></li><li class="flex items-center">
          <a href="https://clean.co/pages/store-locations" title="Find us" class="whitespace-nowrap rounded-md px-2.5 py-2 font-gtpressura text-sm uppercase text-ice transition-all hover:bg-[--headerFillHoverBackground] hover:!text-[--headerFillHoverText] group-hover/menuitem:bg-[--headerFillHoverBackground] group-hover/menuitem:!text-[--headerFillHoverText] group-hover/stickyheader:text-[--headerFillText] group-active/menuitem:bg-[--headerFillHoverBackground] group-active/menuitem:text-[--headerFillText] group-fill/stickyheader:text-[--headerFillText] lg:text-[15px]">Find us</a></li>
    </ul>
  </nav>
</main-navigation>
<mobile-navigation class="group/mobilemenu lg:hidden" client:idle="">
  <div class="invisible absolute inset-x-0 bottom-0 top-full flex h-[calc(100dvh_-_100%)] w-screen flex-col overflow-y-auto border-t-2 border-solid border-rosemary bg-ice px-3 py-4 opacity-0 group-active/mobilemenu:visible group-active/mobilemenu:opacity-100">
    <nav class="flex flex-col pb-3" role="navigation">
      <ul class="mb-3 flex flex-col gap-3"><li>
            <a href="https://clean.co/collections/shop" title="Shop" class="group/level1 peer flex items-center justify-between rounded-md bg-blue py-4 pl-3 pr-5 font-ultramagnetic text-[15px] uppercase text-ice transition-all" data-sub-menu-toggle="">Shop<svg class="w-3 group-active/level1:rotate-180" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M1 1.5l6 6 6-6" stroke="currentColor" stroke-width="2"></path>
                </svg></a><ul class="hidden flex-col peer-active:flex"><li class="border-b-2 border-solid border-rosemary">
                    <a href="https://clean.co/collections/shop" title="Clean Spirits" class="group/level2 peer flex items-center justify-between py-4 pr-5 font-ultramagnetic text-[15px] uppercase text-rosemary" data-sub-menu-toggle="">Clean Spirits<svg class="w-3 group-active/level2:rotate-180" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M1 1.5l6 6 6-6" stroke="currentColor" stroke-width="2"></path>
                        </svg></a><div class="hidden auto-rows-fr grid-cols-2 gap-2.5 pb-4 peer-active:grid sm:grid-cols-3"><a href="https://clean.co/products/clean-g-alcohol-free-spirit" title="Clean G" class="group/block relative grid aspect-[18/11] grid-cols-2 overflow-hidden rounded-2xl bg-[--accent] px-3 pt-3.5 transition-all hover:opacity-90" style="--accent:#71aa4b"><img src="./CleanCo UK_files/Clean_G.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean G</span>

                            

                            <div class="absolute -right-5 top-4 block aspect-[--ratio] w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0" style="--ratio:1.0;">




  <img src="./CleanCo UK_files/G_42cf5e63-bf08-4e6f-841c-4328c3ae2d6d.png" alt="Clean G" srcset="//clean.co/cdn/shop/files/G_42cf5e63-bf08-4e6f-841c-4328c3ae2d6d.png?v=1727777996&amp;width=165 165w, //clean.co/cdn/shop/files/G_42cf5e63-bf08-4e6f-841c-4328c3ae2d6d.png?v=1727777996&amp;width=360 360w, //clean.co/cdn/shop/files/G_42cf5e63-bf08-4e6f-841c-4328c3ae2d6d.png?v=1727777996&amp;width=500 500w, //clean.co/cdn/shop/files/G_42cf5e63-bf08-4e6f-841c-4328c3ae2d6d.png?v=1727777996&amp;width=720 720w, //clean.co/cdn/shop/files/G_42cf5e63-bf08-4e6f-841c-4328c3ae2d6d.png?v=1727777996&amp;width=960 960w, //clean.co/cdn/shop/files/G_42cf5e63-bf08-4e6f-841c-4328c3ae2d6d.png?v=1727777996&amp;width=1066 1066w, //clean.co/cdn/shop/files/G_42cf5e63-bf08-4e6f-841c-4328c3ae2d6d.png?v=1727777996&amp;width=1280 1280w, //clean.co/cdn/shop/files/G_42cf5e63-bf08-4e6f-841c-4328c3ae2d6d.png?v=1727777996&amp;width=1500 1500w" width="1750" height="1750" loading="lazy" class="w-full h-full object-cover object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                            </div>
                          </a><a href="https://clean.co/products/clean-g-rhubarb-alcohol-free-spirit" title="Clean G Rhubarb" class="group/block relative grid aspect-[18/11] grid-cols-2 overflow-hidden rounded-2xl bg-[--accent] px-3 pt-3.5 transition-all hover:opacity-90" style="--accent:#e84772"><img src="./CleanCo UK_files/Clean_G_Rhubarb.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean G Rhubarb</span>

                            

                            <div class="absolute -right-5 top-4 block aspect-[--ratio] w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0" style="--ratio:1.0;">




  <img src="./CleanCo UK_files/Grhub_8d3e96f6-bf5f-4888-868a-28251650fb3d.png" alt="Clean G Rhubarb" srcset="//clean.co/cdn/shop/files/Grhub_8d3e96f6-bf5f-4888-868a-28251650fb3d.png?v=1727778000&amp;width=165 165w, //clean.co/cdn/shop/files/Grhub_8d3e96f6-bf5f-4888-868a-28251650fb3d.png?v=1727778000&amp;width=360 360w, //clean.co/cdn/shop/files/Grhub_8d3e96f6-bf5f-4888-868a-28251650fb3d.png?v=1727778000&amp;width=500 500w, //clean.co/cdn/shop/files/Grhub_8d3e96f6-bf5f-4888-868a-28251650fb3d.png?v=1727778000&amp;width=720 720w, //clean.co/cdn/shop/files/Grhub_8d3e96f6-bf5f-4888-868a-28251650fb3d.png?v=1727778000&amp;width=960 960w, //clean.co/cdn/shop/files/Grhub_8d3e96f6-bf5f-4888-868a-28251650fb3d.png?v=1727778000&amp;width=1066 1066w, //clean.co/cdn/shop/files/Grhub_8d3e96f6-bf5f-4888-868a-28251650fb3d.png?v=1727778000&amp;width=1280 1280w, //clean.co/cdn/shop/files/Grhub_8d3e96f6-bf5f-4888-868a-28251650fb3d.png?v=1727778000&amp;width=1500 1500w" width="1750" height="1750" loading="lazy" class="w-full h-full object-cover object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                            </div>
                          </a><a href="https://clean.co/products/clean-r-alcohol-free-spirit" title="Clean R" class="group/block relative grid aspect-[18/11] grid-cols-2 overflow-hidden rounded-2xl bg-[--accent] px-3 pt-3.5 transition-all hover:opacity-90" style="--accent:#f29500"><img src="./CleanCo UK_files/Clean_R.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean R</span>

                            

                            <div class="absolute -right-5 top-4 block aspect-[--ratio] w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0" style="--ratio:1.0;">




  <img src="./CleanCo UK_files/R_8c0bf65b-42ee-4d2d-a92e-0cc313f9b01a.png" alt="Clean R" srcset="//clean.co/cdn/shop/files/R_8c0bf65b-42ee-4d2d-a92e-0cc313f9b01a.png?v=1727778005&amp;width=165 165w, //clean.co/cdn/shop/files/R_8c0bf65b-42ee-4d2d-a92e-0cc313f9b01a.png?v=1727778005&amp;width=360 360w, //clean.co/cdn/shop/files/R_8c0bf65b-42ee-4d2d-a92e-0cc313f9b01a.png?v=1727778005&amp;width=500 500w, //clean.co/cdn/shop/files/R_8c0bf65b-42ee-4d2d-a92e-0cc313f9b01a.png?v=1727778005&amp;width=720 720w, //clean.co/cdn/shop/files/R_8c0bf65b-42ee-4d2d-a92e-0cc313f9b01a.png?v=1727778005&amp;width=960 960w, //clean.co/cdn/shop/files/R_8c0bf65b-42ee-4d2d-a92e-0cc313f9b01a.png?v=1727778005&amp;width=1066 1066w, //clean.co/cdn/shop/files/R_8c0bf65b-42ee-4d2d-a92e-0cc313f9b01a.png?v=1727778005&amp;width=1280 1280w, //clean.co/cdn/shop/files/R_8c0bf65b-42ee-4d2d-a92e-0cc313f9b01a.png?v=1727778005&amp;width=1500 1500w" width="1750" height="1750" loading="lazy" class="w-full h-full object-cover object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                            </div>
                          </a><a href="https://clean.co/products/clean-t-alcohol-free-spirit" title="Clean T" class="group/block relative grid aspect-[18/11] grid-cols-2 overflow-hidden rounded-2xl bg-[--accent] px-3 pt-3.5 transition-all hover:opacity-90" style="--accent:#c595d8"><img src="./CleanCo UK_files/Clean_T.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean T</span>

                            

                            <div class="absolute -right-5 top-4 block aspect-[--ratio] w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0" style="--ratio:1.0;">




  <img src="./CleanCo UK_files/T_02ea59f9-01b5-41be-9dbe-b88af81b4ccb.png" alt="Clean T" srcset="//clean.co/cdn/shop/files/T_02ea59f9-01b5-41be-9dbe-b88af81b4ccb.png?v=1727778011&amp;width=165 165w, //clean.co/cdn/shop/files/T_02ea59f9-01b5-41be-9dbe-b88af81b4ccb.png?v=1727778011&amp;width=360 360w, //clean.co/cdn/shop/files/T_02ea59f9-01b5-41be-9dbe-b88af81b4ccb.png?v=1727778011&amp;width=500 500w, //clean.co/cdn/shop/files/T_02ea59f9-01b5-41be-9dbe-b88af81b4ccb.png?v=1727778011&amp;width=720 720w, //clean.co/cdn/shop/files/T_02ea59f9-01b5-41be-9dbe-b88af81b4ccb.png?v=1727778011&amp;width=960 960w, //clean.co/cdn/shop/files/T_02ea59f9-01b5-41be-9dbe-b88af81b4ccb.png?v=1727778011&amp;width=1066 1066w, //clean.co/cdn/shop/files/T_02ea59f9-01b5-41be-9dbe-b88af81b4ccb.png?v=1727778011&amp;width=1280 1280w, //clean.co/cdn/shop/files/T_02ea59f9-01b5-41be-9dbe-b88af81b4ccb.png?v=1727778011&amp;width=1500 1500w" width="1750" height="1750" loading="lazy" class="w-full h-full object-cover object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                            </div>
                          </a><a href="https://clean.co/products/clean-w-alcohol-free-spirit" title="Clean W" class="group/block relative grid aspect-[18/11] grid-cols-2 overflow-hidden rounded-2xl bg-[--accent] px-3 pt-3.5 transition-all hover:opacity-90" style="--accent:#ea5311"><img src="./CleanCo UK_files/Clean_W.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean W</span>

                            

                            <div class="absolute -right-5 top-4 block aspect-[--ratio] w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0" style="--ratio:1.0;">




  <img src="./CleanCo UK_files/W_dee6fb0b-63a6-4280-a9d0-6433cdd22986.png" alt="Clean W" srcset="//clean.co/cdn/shop/files/W_dee6fb0b-63a6-4280-a9d0-6433cdd22986.png?v=1727778017&amp;width=165 165w, //clean.co/cdn/shop/files/W_dee6fb0b-63a6-4280-a9d0-6433cdd22986.png?v=1727778017&amp;width=360 360w, //clean.co/cdn/shop/files/W_dee6fb0b-63a6-4280-a9d0-6433cdd22986.png?v=1727778017&amp;width=500 500w, //clean.co/cdn/shop/files/W_dee6fb0b-63a6-4280-a9d0-6433cdd22986.png?v=1727778017&amp;width=720 720w, //clean.co/cdn/shop/files/W_dee6fb0b-63a6-4280-a9d0-6433cdd22986.png?v=1727778017&amp;width=960 960w, //clean.co/cdn/shop/files/W_dee6fb0b-63a6-4280-a9d0-6433cdd22986.png?v=1727778017&amp;width=1066 1066w, //clean.co/cdn/shop/files/W_dee6fb0b-63a6-4280-a9d0-6433cdd22986.png?v=1727778017&amp;width=1280 1280w, //clean.co/cdn/shop/files/W_dee6fb0b-63a6-4280-a9d0-6433cdd22986.png?v=1727778017&amp;width=1500 1500w" width="1750" height="1750" loading="lazy" class="w-full h-full object-cover object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                            </div>
                          </a></div></li><li class="border-b-2 border-solid border-rosemary">
                    <a href="https://clean.co/collections/bundles" title="Clean Bundles" class="group/level2 peer flex items-center justify-between py-4 pr-5 font-ultramagnetic text-[15px] uppercase text-rosemary" data-sub-menu-toggle="">Clean Bundles<svg class="w-3 group-active/level2:rotate-180" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M1 1.5l6 6 6-6" stroke="currentColor" stroke-width="2"></path>
                        </svg></a><div class="hidden auto-rows-fr grid-cols-2 gap-2.5 pb-4 peer-active:grid sm:grid-cols-3"><a href="https://clean.co/products/clean-gin-tonic-bundle-alcohol-free" title="Clean G+T" class="group/block relative grid aspect-[18/11] grid-cols-2 overflow-hidden rounded-2xl bg-[--accent] px-3 pt-3.5 transition-all hover:opacity-90" style="--accent:#71aa4b"><img src="./CleanCo UK_files/Clean_G.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean G+T</span>

                            

                            <div class="absolute -right-5 top-4 block aspect-[--ratio] w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0" style="--ratio:1.0;">




  <img src="./CleanCo UK_files/CleanG_T_125ab40d-956b-46ee-a152-a2d7025bf7cc.png" alt="Clean G&amp;T" srcset="//clean.co/cdn/shop/files/CleanG_T_125ab40d-956b-46ee-a152-a2d7025bf7cc.png?v=1727778271&amp;width=165 165w, //clean.co/cdn/shop/files/CleanG_T_125ab40d-956b-46ee-a152-a2d7025bf7cc.png?v=1727778271&amp;width=360 360w, //clean.co/cdn/shop/files/CleanG_T_125ab40d-956b-46ee-a152-a2d7025bf7cc.png?v=1727778271&amp;width=500 500w, //clean.co/cdn/shop/files/CleanG_T_125ab40d-956b-46ee-a152-a2d7025bf7cc.png?v=1727778271&amp;width=720 720w, //clean.co/cdn/shop/files/CleanG_T_125ab40d-956b-46ee-a152-a2d7025bf7cc.png?v=1727778271&amp;width=960 960w, //clean.co/cdn/shop/files/CleanG_T_125ab40d-956b-46ee-a152-a2d7025bf7cc.png?v=1727778271&amp;width=1066 1066w, //clean.co/cdn/shop/files/CleanG_T_125ab40d-956b-46ee-a152-a2d7025bf7cc.png?v=1727778271&amp;width=1280 1280w, //clean.co/cdn/shop/files/CleanG_T_125ab40d-956b-46ee-a152-a2d7025bf7cc.png?v=1727778271&amp;width=1500 1500w" width="1750" height="1750" loading="lazy" class="w-full h-full object-cover object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                            </div>
                          </a><a href="https://clean.co/products/clean-rhubarb-gin-tonic-bundle-alcohol-free" title="Clean Rhubarb G+T" class="group/block relative grid aspect-[18/11] grid-cols-2 overflow-hidden rounded-2xl bg-[--accent] px-3 pt-3.5 transition-all hover:opacity-90" style="--accent:#e84772"><img src="./CleanCo UK_files/Clean_G_Rhubarb.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean Rhubarb G+T</span>

                            

                            <div class="absolute -right-5 top-4 block aspect-[--ratio] w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0" style="--ratio:1.0;">




  <img src="./CleanCo UK_files/CleanRhubarbG_T_a6fee4d5-7783-4d9a-a281-09af3e0f03ea.png" alt="Clean Rhubarb G+T" srcset="//clean.co/cdn/shop/files/CleanRhubarbG_T_a6fee4d5-7783-4d9a-a281-09af3e0f03ea.png?v=1727778276&amp;width=165 165w, //clean.co/cdn/shop/files/CleanRhubarbG_T_a6fee4d5-7783-4d9a-a281-09af3e0f03ea.png?v=1727778276&amp;width=360 360w, //clean.co/cdn/shop/files/CleanRhubarbG_T_a6fee4d5-7783-4d9a-a281-09af3e0f03ea.png?v=1727778276&amp;width=500 500w, //clean.co/cdn/shop/files/CleanRhubarbG_T_a6fee4d5-7783-4d9a-a281-09af3e0f03ea.png?v=1727778276&amp;width=720 720w, //clean.co/cdn/shop/files/CleanRhubarbG_T_a6fee4d5-7783-4d9a-a281-09af3e0f03ea.png?v=1727778276&amp;width=960 960w, //clean.co/cdn/shop/files/CleanRhubarbG_T_a6fee4d5-7783-4d9a-a281-09af3e0f03ea.png?v=1727778276&amp;width=1066 1066w, //clean.co/cdn/shop/files/CleanRhubarbG_T_a6fee4d5-7783-4d9a-a281-09af3e0f03ea.png?v=1727778276&amp;width=1280 1280w, //clean.co/cdn/shop/files/CleanRhubarbG_T_a6fee4d5-7783-4d9a-a281-09af3e0f03ea.png?v=1727778276&amp;width=1500 1500w" width="1750" height="1750" loading="lazy" class="w-full h-full object-cover object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                            </div>
                          </a><a href="https://clean.co/products/clean-nstormy-bundle-alcohol-free-rum" title="Clean N&#39;Stormy" class="group/block relative grid aspect-[18/11] grid-cols-2 overflow-hidden rounded-2xl bg-[--accent] px-3 pt-3.5 transition-all hover:opacity-90" style="--accent:#f29500"><img src="./CleanCo UK_files/Clean_R.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean N'Stormy</span>

                            

                            <div class="absolute -right-5 top-4 block aspect-[--ratio] w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0" style="--ratio:1.0;">




  <img src="./CleanCo UK_files/CleanNStormy_14a7600c-612e-49ee-858b-8414e8c2baae.png" alt="Clean N&#39;Stormy" srcset="//clean.co/cdn/shop/files/CleanNStormy_14a7600c-612e-49ee-858b-8414e8c2baae.png?v=1727778267&amp;width=165 165w, //clean.co/cdn/shop/files/CleanNStormy_14a7600c-612e-49ee-858b-8414e8c2baae.png?v=1727778267&amp;width=360 360w, //clean.co/cdn/shop/files/CleanNStormy_14a7600c-612e-49ee-858b-8414e8c2baae.png?v=1727778267&amp;width=500 500w, //clean.co/cdn/shop/files/CleanNStormy_14a7600c-612e-49ee-858b-8414e8c2baae.png?v=1727778267&amp;width=720 720w, //clean.co/cdn/shop/files/CleanNStormy_14a7600c-612e-49ee-858b-8414e8c2baae.png?v=1727778267&amp;width=960 960w, //clean.co/cdn/shop/files/CleanNStormy_14a7600c-612e-49ee-858b-8414e8c2baae.png?v=1727778267&amp;width=1066 1066w, //clean.co/cdn/shop/files/CleanNStormy_14a7600c-612e-49ee-858b-8414e8c2baae.png?v=1727778267&amp;width=1280 1280w, //clean.co/cdn/shop/files/CleanNStormy_14a7600c-612e-49ee-858b-8414e8c2baae.png?v=1727778267&amp;width=1500 1500w" width="1750" height="1750" loading="lazy" class="w-full h-full object-cover object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                            </div>
                          </a><a href="https://clean.co/products/clean-whiskey-ginger-bundle-alcohol-free" title="Clean W &amp; Ginger" class="group/block relative grid aspect-[18/11] grid-cols-2 overflow-hidden rounded-2xl bg-[--accent] px-3 pt-3.5 transition-all hover:opacity-90" style="--accent:#ea5311"><img src="./CleanCo UK_files/Clean_W.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean W &amp; Ginger</span>

                            

                            <div class="absolute -right-5 top-4 block aspect-[--ratio] w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0" style="--ratio:1.0;">




  <img src="./CleanCo UK_files/CleanW_Ginger_09fb137e-61c8-4eab-9ac2-79699ad529c5.png" alt="Clean W &amp; Ginger" srcset="//clean.co/cdn/shop/files/CleanW_Ginger_09fb137e-61c8-4eab-9ac2-79699ad529c5.png?v=1727778281&amp;width=165 165w, //clean.co/cdn/shop/files/CleanW_Ginger_09fb137e-61c8-4eab-9ac2-79699ad529c5.png?v=1727778281&amp;width=360 360w, //clean.co/cdn/shop/files/CleanW_Ginger_09fb137e-61c8-4eab-9ac2-79699ad529c5.png?v=1727778281&amp;width=500 500w, //clean.co/cdn/shop/files/CleanW_Ginger_09fb137e-61c8-4eab-9ac2-79699ad529c5.png?v=1727778281&amp;width=720 720w, //clean.co/cdn/shop/files/CleanW_Ginger_09fb137e-61c8-4eab-9ac2-79699ad529c5.png?v=1727778281&amp;width=960 960w, //clean.co/cdn/shop/files/CleanW_Ginger_09fb137e-61c8-4eab-9ac2-79699ad529c5.png?v=1727778281&amp;width=1066 1066w, //clean.co/cdn/shop/files/CleanW_Ginger_09fb137e-61c8-4eab-9ac2-79699ad529c5.png?v=1727778281&amp;width=1280 1280w, //clean.co/cdn/shop/files/CleanW_Ginger_09fb137e-61c8-4eab-9ac2-79699ad529c5.png?v=1727778281&amp;width=1500 1500w" width="1750" height="1750" loading="lazy" class="w-full h-full object-cover object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                            </div>
                          </a></div></li><li class="border-b-2 border-solid border-rosemary">
                    <a href="https://clean.co/apps/gbb/easybundle/2?page=addProductsPage1&amp;currentFlow=byob#" title="Merch &amp; more" class="group/level2 peer flex items-center justify-between py-4 pr-5 font-ultramagnetic text-[15px] uppercase text-rosemary" data-sub-menu-toggle="">Merch &amp; more<svg class="w-3 group-active/level2:rotate-180" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M1 1.5l6 6 6-6" stroke="currentColor" stroke-width="2"></path>
                        </svg></a><div class="hidden auto-rows-fr grid-cols-2 gap-2.5 pb-4 peer-active:grid sm:grid-cols-3"><a href="https://clean.co/products/clean-cocktail-recipe-book" title="Cocktails Book" class="group/block relative grid aspect-[18/11] grid-cols-2 overflow-hidden rounded-2xl bg-[--accent] px-3 pt-3.5 transition-all hover:opacity-90" style="--accent:#0B464C"><span class="font-ultramagnetic uppercase text-ice">Cocktails Book</span>

                            

                            <div class="absolute -right-5 top-4 block aspect-[--ratio] w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0" style="--ratio:1.0;">




  <img src="./CleanCo UK_files/cleancocktailsbook_4897b2cf-3d2f-41dc-ace8-1189902cde69.png" alt="Clean Cocktails Recipe Book" srcset="//clean.co/cdn/shop/files/cleancocktailsbook_4897b2cf-3d2f-41dc-ace8-1189902cde69.png?v=1723474578&amp;width=165 165w, //clean.co/cdn/shop/files/cleancocktailsbook_4897b2cf-3d2f-41dc-ace8-1189902cde69.png?v=1723474578&amp;width=360 360w, //clean.co/cdn/shop/files/cleancocktailsbook_4897b2cf-3d2f-41dc-ace8-1189902cde69.png?v=1723474578&amp;width=500 500w, //clean.co/cdn/shop/files/cleancocktailsbook_4897b2cf-3d2f-41dc-ace8-1189902cde69.png?v=1723474578&amp;width=720 720w, //clean.co/cdn/shop/files/cleancocktailsbook_4897b2cf-3d2f-41dc-ace8-1189902cde69.png?v=1723474578&amp;width=960 960w, //clean.co/cdn/shop/files/cleancocktailsbook_4897b2cf-3d2f-41dc-ace8-1189902cde69.png?v=1723474578&amp;width=1066 1066w, //clean.co/cdn/shop/files/cleancocktailsbook_4897b2cf-3d2f-41dc-ace8-1189902cde69.png?v=1723474578&amp;width=1280 1280w, //clean.co/cdn/shop/files/cleancocktailsbook_4897b2cf-3d2f-41dc-ace8-1189902cde69.png?v=1723474578&amp;width=1500 1500w, //clean.co/cdn/shop/files/cleancocktailsbook_4897b2cf-3d2f-41dc-ace8-1189902cde69.png?v=1723474578&amp;width=1800 1800w" width="2500" height="2500" loading="lazy" class="w-full h-full object-cover object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                            </div>
                          </a><a href="https://clean.co/products/gift-card" title="Gift cards" class="group/block relative grid aspect-[18/11] grid-cols-2 overflow-hidden rounded-2xl bg-[--accent] px-3 pt-3.5 transition-all hover:opacity-90" style="--accent:#1c98a5"><span class="font-ultramagnetic uppercase text-ice">Gift cards</span>

                            

                            <div class="absolute -right-5 top-4 block aspect-[--ratio] w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0" style="--ratio:1.0;">




  <img src="./CleanCo UK_files/Giftcard.png" alt="Instant E-Gift Card" srcset="//clean.co/cdn/shop/files/Giftcard.png?v=1723474031&amp;width=165 165w, //clean.co/cdn/shop/files/Giftcard.png?v=1723474031&amp;width=360 360w, //clean.co/cdn/shop/files/Giftcard.png?v=1723474031&amp;width=500 500w, //clean.co/cdn/shop/files/Giftcard.png?v=1723474031&amp;width=720 720w, //clean.co/cdn/shop/files/Giftcard.png?v=1723474031&amp;width=960 960w, //clean.co/cdn/shop/files/Giftcard.png?v=1723474031&amp;width=1066 1066w, //clean.co/cdn/shop/files/Giftcard.png?v=1723474031&amp;width=1280 1280w, //clean.co/cdn/shop/files/Giftcard.png?v=1723474031&amp;width=1500 1500w, //clean.co/cdn/shop/files/Giftcard.png?v=1723474031&amp;width=1800 1800w" width="2500" height="2500" loading="lazy" class="w-full h-full object-cover object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                            </div>
                          </a></div></li></ul></li><li>
            <a href="https://clean.co/apps/gbb/easybundle/2" title="Build a box" class="group/level1 peer flex items-center justify-between rounded-md bg-blue py-4 pl-3 pr-5 font-ultramagnetic text-[15px] uppercase text-ice transition-all">Build a box</a></li><li>
            <a href="https://clean.co/pages/subscribe-save" title="Subscribe &amp; Save" class="group/level1 peer flex items-center justify-between rounded-md bg-blue py-4 pl-3 pr-5 font-ultramagnetic text-[15px] uppercase text-ice transition-all">Subscribe &amp; Save</a></li><li>
            <a href="https://clean.co/blogs/clean-cocktails" title="Clean Cocktails" class="group/level1 peer flex items-center justify-between rounded-md bg-blue py-4 pl-3 pr-5 font-ultramagnetic text-[15px] uppercase text-ice transition-all">Clean Cocktails</a></li><li>
            <a href="https://clean.co/pages/about-cleanco-story" title="About" class="group/level1 peer flex items-center justify-between rounded-md bg-blue py-4 pl-3 pr-5 font-ultramagnetic text-[15px] uppercase text-ice transition-all" data-sub-menu-toggle="">About<svg class="w-3 group-active/level1:rotate-180" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M1 1.5l6 6 6-6" stroke="currentColor" stroke-width="2"></path>
                </svg></a><ul class="hidden flex-col peer-active:flex"><li>
                    <a href="https://clean.co/pages/about-cleanco-story" title="OUR STORY" class="block justify-between py-4 font-rubik text-[15px] text-rosemary">OUR STORY</a>
                  </li><li>
                    <a href="https://clean.co/blogs/news" title="THE CLEAN CHRONICLES" class="block justify-between py-4 font-rubik text-[15px] text-rosemary">THE CLEAN CHRONICLES</a>
                  </li><li>
                    <a href="https://clean.co/blogs/news/our-sustainability-impact" title="SUSTAINABILITY" class="block justify-between py-4 font-rubik text-[15px] text-rosemary">SUSTAINABILITY</a>
                  </li><li>
                    <a href="https://clean.co/blogs/news/the-art-of-cleanco-spirits" title="CRAFTSMANSHIP" class="block justify-between py-4 font-rubik text-[15px] text-rosemary">CRAFTSMANSHIP</a>
                  </li><li>
                    <a href="https://clean.co/pages/rewards" title="JOIN THE CLEAN CLUB" class="block justify-between py-4 font-rubik text-[15px] text-rosemary">JOIN THE CLEAN CLUB</a>
                  </li><li>
                    <a href="https://clean.co/pages/faqs" title="FAQ" class="block justify-between py-4 font-rubik text-[15px] text-rosemary">FAQ</a>
                  </li></ul></li><li>
            <a href="https://clean.co/pages/store-locations" title="Find us" class="group/level1 peer flex items-center justify-between rounded-md bg-blue py-4 pl-3 pr-5 font-ultramagnetic text-[15px] uppercase text-ice transition-all">Find us</a></li></ul>

      <ul class="flex flex-col"><li class="border-b-2 border-solid border-rosemary"><button type="buttopn" title="Login / Register" class="block w-full py-4 pr-5 text-left font-ultramagnetic text-[15px] uppercase text-rosemary" data-drawer-trigger="login">
              Account
            </button></li><li class="border-b-2 border-solid border-rosemary">
            <button type="button" class="group peer flex w-full items-center py-4 pr-5 font-ultramagnetic text-[15px] uppercase text-rosemary" aria-label="Change country" data-sub-menu-toggle="">
              <div class="relative mr-2 aspect-square w-5 overflow-hidden rounded-full">
                <img src="./CleanCo UK_files/gb.svg" alt="United Kingdom" srcset="//cdn.shopify.com/static/images/flags/gb.svg?width=32 32w" width="32" height="24" class="absolute inset-0 object-cover h-full object-center">
              </div>

              United Kingdom - £
              GBP

              <svg class="ml-auto w-3 group-active:rotate-180" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1 1.5l6 6 6-6" stroke="currentColor" stroke-width="2"></path>
              </svg>
            </button>

            <div class="hidden peer-active:block">
              <localization-form client:idle=""><form method="post" action="https://clean.co/localization" id="localization_form" accept-charset="UTF-8" class="shopify-localization-form" enctype="multipart/form-data"><input type="hidden" name="form_type" value="localization"><input type="hidden" name="utf8" value="✓"><input type="hidden" name="_method" value="put"><input type="hidden" name="return_to" value="/apps/gbb/easybundle/2?page=addProductsPage1&amp;currentFlow=byob"><ul class="mb-4 grid grid-cols-1 gap-4 sm:grid-cols-3 md:grid-cols-4"><li>
                        <a href="https://clean.co/apps/gbb/easybundle/2?page=addProductsPage1&amp;currentFlow=byob#" class="flex items-center gap-2 rounded-md bg-rosemary px-4 py-4 font-gtpressura text-[15px] uppercase text-ice sm:flex-col sm:px-0" data-country="GG">
                          <div class="relative aspect-square w-6 overflow-hidden rounded-full">
                            <img src="./CleanCo UK_files/gg.svg" alt="Guernsey" srcset="//cdn.shopify.com/static/images/flags/gg.svg?width=32 32w" width="32" height="24" class="absolute inset-0 object-cover h-full object-center">
                          </div>

                          Guernsey - £
                          GBP
                        </a>
                      </li><li>
                        <a href="https://clean.co/apps/gbb/easybundle/2?page=addProductsPage1&amp;currentFlow=byob#" class="flex items-center gap-2 rounded-md bg-rosemary px-4 py-4 font-gtpressura text-[15px] uppercase text-ice sm:flex-col sm:px-0" data-country="IE">
                          <div class="relative aspect-square w-6 overflow-hidden rounded-full">
                            <img src="./CleanCo UK_files/ie.svg" alt="Ireland" srcset="//cdn.shopify.com/static/images/flags/ie.svg?width=32 32w" width="32" height="24" class="absolute inset-0 object-cover h-full object-center">
                          </div>

                          Ireland - €
                          EUR
                        </a>
                      </li><li>
                        <a href="https://clean.co/apps/gbb/easybundle/2?page=addProductsPage1&amp;currentFlow=byob#" class="flex items-center gap-2 rounded-md bg-rosemary px-4 py-4 font-gtpressura text-[15px] uppercase text-ice sm:flex-col sm:px-0" data-country="IM">
                          <div class="relative aspect-square w-6 overflow-hidden rounded-full">
                            <img src="./CleanCo UK_files/im.svg" alt="Isle of Man" srcset="//cdn.shopify.com/static/images/flags/im.svg?width=32 32w" width="32" height="24" class="absolute inset-0 object-cover h-full object-center">
                          </div>

                          Isle of Man - £
                          GBP
                        </a>
                      </li><li>
                        <a href="https://clean.co/apps/gbb/easybundle/2?page=addProductsPage1&amp;currentFlow=byob#" class="flex items-center gap-2 rounded-md bg-rosemary px-4 py-4 font-gtpressura text-[15px] uppercase text-ice sm:flex-col sm:px-0" data-country="JE">
                          <div class="relative aspect-square w-6 overflow-hidden rounded-full">
                            <img src="./CleanCo UK_files/je.svg" alt="Jersey" srcset="//cdn.shopify.com/static/images/flags/je.svg?width=32 32w" width="32" height="24" class="absolute inset-0 object-cover h-full object-center">
                          </div>

                          Jersey - £
                          GBP
                        </a>
                      </li><li>
                        <a href="https://clean.co/apps/gbb/easybundle/2?page=addProductsPage1&amp;currentFlow=byob#" class="flex items-center gap-2 rounded-md bg-rosemary px-4 py-4 font-gtpressura text-[15px] uppercase text-ice sm:flex-col sm:px-0" aria-current="true" data-country="GB">
                          <div class="relative aspect-square w-6 overflow-hidden rounded-full">
                            <img src="./CleanCo UK_files/gb.svg" alt="United Kingdom" srcset="//cdn.shopify.com/static/images/flags/gb.svg?width=32 32w" width="32" height="24" class="absolute inset-0 object-cover h-full object-center">
                          </div>

                          United Kingdom - £
                          GBP
                        </a>
                      </li></ul>
                  <input type="hidden" name="country_code" value="GB"></form></localization-form>
            </div>
          </li></ul>
    </nav><a href="https://clean.co/collections/shop" title="Shop all products" class="mt-auto block rounded-md bg-rosemary px-2 py-4 text-center font-gtpressura text-[15px] uppercase text-ice transition-all hover:bg-blue">
        Shop all products
      </a>
  </div>
</mobile-navigation>
<search-dropdown class="group/searchdropdown" client:idle="">
  <div class="invisible absolute inset-x-0 top-full max-h-[calc(100dvh_-_100%)] w-full overflow-y-auto border-t-2 border-solid border-rosemary bg-ice opacity-0 transition-all group-active/searchdropdown:visible group-active/searchdropdown:opacity-100">
    <div class="px-3 py-5 lg:px-8">
      <div class="mb-10 flex items-center gap-2.5 border-b-2 border-solid border-rosemary py-4">
        <div class="group shrink text-rosemary" data-search-icon="">
          <svg class="w-6 group-active:hidden" viewBox="0 0 27 27" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10.781 19.844a9.063 9.063 0 100-18.125 9.063 9.063 0 000 18.125zM25.28 25.281l-8.093-8.092" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>

          <svg class="hidden w-6 animate-spin group-active:block" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
            <g fill="currentColor"><path d="M24 48a24 24 0 1124-24 24.027 24.027 0 01-24 24zm0-44a20 20 0 1020 20A20.023 20.023 0 0024 4z" opacity=".4"></path><path d="M48 24h-4A20.023 20.023 0 0024 4V0a24.028 24.028 0 0124 24z"></path></g>
          </svg>
        </div>
        <form action="https://clean.co/search" method="get" role="search" class="flex grow items-center">
          <input type="search" name="q" class="grow bg-transparent font-ultramagnetic uppercase text-rosemary placeholder:text-rosemary focus:outline-none" value="" placeholder="Start typing" autocorrect="off" autocomplete="off" autocapitalize="off" spellcheck="false">
          <button type="submit" class="sr-only">Submit</button>
        </form>

        <button class="flex shrink items-center gap-2 font-gtpressura uppercase text-rosemary" data-search-close="">
          <svg class="w-3" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill="currentColor" d="M1.414 0l7.778 7.778-1.414 1.414L0 1.414z"></path><path fill="currentColor" d="M0 7.97L7.778.194l1.415 1.414-7.778 7.778z"></path>
          </svg>

          <span class="relative top-px" data-text="">Close</span>
        </button>
      </div>

      <div class="grid grid-cols-12 gap-4 md:gap-8 lg:gap-0" data-results-container="">
        <div class="col-span-12 lg:col-span-7">
          <div class="mb-3.5 font-ultramagnetic text-[15px] uppercase text-rosemary">Suggested Products</div>

          <div class="grid auto-rows-fr grid-cols-2 gap-4 md:grid-cols-3"><a href="https://clean.co/products/clean-g-alcohol-free-spirit" title="Clean G" class="group/block relative grid aspect-[53/38] grid-cols-2 overflow-hidden rounded-md bg-[--accent] px-5 pt-5 transition-all hover:opacity-90" style="--accent:#71aa4b"><img src="./CleanCo UK_files/Clean_G.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean G</span><div class="absolute -right-5 top-4 block aspect-square w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0">




  <img src="./CleanCo UK_files/1_f24127fd-9d1b-4f00-979f-c224fa397343.png" srcset="//clean.co/cdn/shop/files/1_f24127fd-9d1b-4f00-979f-c224fa397343.png?v=1727779031&amp;width=165 165w" width="338" height="700" loading="lazy" class="w-full h-full object-contain object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                </div>
              </a><a href="https://clean.co/products/clean-t-alcohol-free-spirit" title="Clean T" class="group/block relative grid aspect-[53/38] grid-cols-2 overflow-hidden rounded-md bg-[--accent] px-5 pt-5 transition-all hover:opacity-90" style="--accent:#c595d8"><img src="./CleanCo UK_files/Clean_T.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean T</span><div class="absolute -right-5 top-4 block aspect-square w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0">




  <img src="./CleanCo UK_files/2_413276f9-262b-4859-ad98-4d95f8e521ba.png" srcset="//clean.co/cdn/shop/files/2_413276f9-262b-4859-ad98-4d95f8e521ba.png?v=1727779067&amp;width=165 165w" width="338" height="700" loading="lazy" class="w-full h-full object-contain object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                </div>
              </a><a href="https://clean.co/products/clean-r-alcohol-free-spirit" title="Clean R" class="group/block relative grid aspect-[53/38] grid-cols-2 overflow-hidden rounded-md bg-[--accent] px-5 pt-5 transition-all hover:opacity-90" style="--accent:#f29500"><img src="./CleanCo UK_files/Clean_R.png" class="absolute right-0 h-full w-fit object-cover object-center" loading="eager" width="" height=""><span class="font-ultramagnetic uppercase text-ice">Clean R</span><div class="absolute -right-5 top-4 block aspect-square w-3/4 translate-y-2 transition-all duration-500 group-hover/block:translate-y-0">




  <img src="./CleanCo UK_files/4_3fc2e500-75b0-451f-9587-2d6d1b31e2f6.png" srcset="//clean.co/cdn/shop/files/4_3fc2e500-75b0-451f-9587-2d6d1b31e2f6.png?v=1727779041&amp;width=165 165w" width="338" height="700" loading="lazy" class="w-full h-full object-contain object-center absolute inset-0" sizes="500px" fetchpriority="auto" decoding="async">


                </div>
              </a></div>
        </div>

        <div class="col-span-12 grid grid-cols-1 gap-8 md:grid-cols-2 lg:col-span-4 lg:col-start-9 lg:grid-cols-1 xl:col-span-3 xl:col-start-10">
          <div class="flex flex-col border-t border-solid border-rosemary pt-4 md:border-t-0">
            <div class="mb-3.5 flex items-center justify-between">
              <div class="font-ultramagnetic text-[15px] uppercase text-rosemary">Top Recipes</div><a href="https://clean.co/blogs/clean-cocktails" title="Clean Cocktails" class="font-ultramagnetic text-[15px] uppercase text-rosemary underline hover:no-underline">View all</a></div>

            <div class="flex flex-col gap-4"><div class="flex items-center gap-5">
                  <div class="shrink-0 basis-[100px]">
                    <a href="https://clean.co/blogs/clean-cocktails/rhubarb-spritz" class="relative block aspect-[100/68] overflow-hidden rounded-md" title="Clean Rhubarb Spritz">




  <img src="./CleanCo UK_files/CleanCo_Serve_Clean_RG_0037_L.jpg" alt="Clean Rhubarb Spritz" srcset="//clean.co/cdn/shop/articles/CleanCo_Serve_Clean_RG_0037_L.jpg?v=1727275136&amp;width=165 165w, //clean.co/cdn/shop/articles/CleanCo_Serve_Clean_RG_0037_L.jpg?v=1727275136&amp;width=360 360w, //clean.co/cdn/shop/articles/CleanCo_Serve_Clean_RG_0037_L.jpg?v=1727275136&amp;width=500 500w, //clean.co/cdn/shop/articles/CleanCo_Serve_Clean_RG_0037_L.jpg?v=1727275136&amp;width=720 720w, //clean.co/cdn/shop/articles/CleanCo_Serve_Clean_RG_0037_L.jpg?v=1727275136&amp;width=960 960w" width="1000" height="1000" loading="lazy" class="w-full h-full object-cover object-center absolute inset-0" sizes="100vw" fetchpriority="auto" decoding="async">


                    </a>
                  </div>
                  <div class="grow">
                    <a href="https://clean.co/blogs/clean-cocktails/rhubarb-spritz" class="font-ultramagnetic text-[15px] uppercase text-rosemary transition-all hover:opacity-80" title="Clean Rhubarb Spritz">Clean Rhubarb Spritz</a>
                  </div>
                </div><div class="flex items-center gap-5">
                  <div class="shrink-0 basis-[100px]">
                    <a href="https://clean.co/blogs/clean-cocktails/clean-margarita" class="relative block aspect-[100/68] overflow-hidden rounded-md" title="Clean Margarita">




  <img src="./CleanCo UK_files/CleanCo_Serve_Clean_T_0006_P.jpg" alt="Clean Margarita" srcset="//clean.co/cdn/shop/articles/CleanCo_Serve_Clean_T_0006_P.jpg?v=1727286443&amp;width=165 165w, //clean.co/cdn/shop/articles/CleanCo_Serve_Clean_T_0006_P.jpg?v=1727286443&amp;width=360 360w, //clean.co/cdn/shop/articles/CleanCo_Serve_Clean_T_0006_P.jpg?v=1727286443&amp;width=500 500w, //clean.co/cdn/shop/articles/CleanCo_Serve_Clean_T_0006_P.jpg?v=1727286443&amp;width=720 720w, //clean.co/cdn/shop/articles/CleanCo_Serve_Clean_T_0006_P.jpg?v=1727286443&amp;width=960 960w" width="1000" height="1000" loading="lazy" class="w-full h-full object-cover object-center absolute inset-0" sizes="100vw" fetchpriority="auto" decoding="async">


                    </a>
                  </div>
                  <div class="grow">
                    <a href="https://clean.co/blogs/clean-cocktails/clean-margarita" class="font-ultramagnetic text-[15px] uppercase text-rosemary transition-all hover:opacity-80" title="Clean Margarita">Clean Margarita</a>
                  </div>
                </div></div>
          </div>

          <div class="flex flex-col border-t border-solid border-rosemary pt-4 md:border-t-0">
            <div class="mb-3.5 flex items-center justify-between">
              <div class="font-ultramagnetic text-[15px] uppercase text-rosemary">Top Articles</div><a href="https://clean.co/blogs/news" title="The Clean Chronicles" class="font-ultramagnetic text-[15px] uppercase text-rosemary underline hover:no-underline">View all</a></div>

            <div class="flex flex-col gap-4"><div class="flex items-center gap-5">
                  <div class="shrink-0 basis-[100px]">
                    <a href="https://clean.co/blogs/news/cleanco-partners-with-goodrays" class="relative block aspect-[100/68] overflow-hidden rounded-md" title="CleanCo Partners with Goodrays">




  <img src="./CleanCo UK_files/2024_08_30_Goodrays_Group_354_1.jpg" alt="CleanCo Partners with Goodrays" srcset="//clean.co/cdn/shop/articles/2024_08_30_Goodrays_Group_354_1.jpg?v=1728472986&amp;width=165 165w, //clean.co/cdn/shop/articles/2024_08_30_Goodrays_Group_354_1.jpg?v=1728472986&amp;width=360 360w, //clean.co/cdn/shop/articles/2024_08_30_Goodrays_Group_354_1.jpg?v=1728472986&amp;width=500 500w, //clean.co/cdn/shop/articles/2024_08_30_Goodrays_Group_354_1.jpg?v=1728472986&amp;width=720 720w, //clean.co/cdn/shop/articles/2024_08_30_Goodrays_Group_354_1.jpg?v=1728472986&amp;width=960 960w, //clean.co/cdn/shop/articles/2024_08_30_Goodrays_Group_354_1.jpg?v=1728472986&amp;width=1066 1066w, //clean.co/cdn/shop/articles/2024_08_30_Goodrays_Group_354_1.jpg?v=1728472986&amp;width=1280 1280w, //clean.co/cdn/shop/articles/2024_08_30_Goodrays_Group_354_1.jpg?v=1728472986&amp;width=1500 1500w, //clean.co/cdn/shop/articles/2024_08_30_Goodrays_Group_354_1.jpg?v=1728472986&amp;width=1800 1800w" width="2000" height="1333" loading="lazy" class="w-full h-full object-cover object-center absolute inset-0" sizes="100vw" fetchpriority="auto" decoding="async">


                    </a>
                  </div>
                  <div class="grow">
                    <a href="https://clean.co/blogs/news/cleanco-partners-with-goodrays" class="font-ultramagnetic text-[15px] uppercase text-rosemary transition-all hover:opacity-80" title="CleanCo Partners with Goodrays">CleanCo Partners with Goodrays</a>
                  </div>
                </div><div class="flex items-center gap-5">
                  <div class="shrink-0 basis-[100px]">
                    <a href="https://clean.co/blogs/news/how-to-pair-cocktails-with-food" class="relative block aspect-[100/68] overflow-hidden rounded-md" title="How To Pair Cocktails with Food?">




  <img src="./CleanCo UK_files/Cocktail_pairing.png" alt="How To Pair Cocktails with Food?" srcset="//clean.co/cdn/shop/articles/Cocktail_pairing.png?v=1720708765&amp;width=165 165w, //clean.co/cdn/shop/articles/Cocktail_pairing.png?v=1720708765&amp;width=360 360w, //clean.co/cdn/shop/articles/Cocktail_pairing.png?v=1720708765&amp;width=500 500w, //clean.co/cdn/shop/articles/Cocktail_pairing.png?v=1720708765&amp;width=720 720w, //clean.co/cdn/shop/articles/Cocktail_pairing.png?v=1720708765&amp;width=960 960w, //clean.co/cdn/shop/articles/Cocktail_pairing.png?v=1720708765&amp;width=1066 1066w, //clean.co/cdn/shop/articles/Cocktail_pairing.png?v=1720708765&amp;width=1280 1280w, //clean.co/cdn/shop/articles/Cocktail_pairing.png?v=1720708765&amp;width=1500 1500w, //clean.co/cdn/shop/articles/Cocktail_pairing.png?v=1720708765&amp;width=1800 1800w" width="1920" height="1280" loading="lazy" class="w-full h-full object-cover object-center absolute inset-0" sizes="100vw" fetchpriority="auto" decoding="async">


                    </a>
                  </div>
                  <div class="grow">
                    <a href="https://clean.co/blogs/news/how-to-pair-cocktails-with-food" class="font-ultramagnetic text-[15px] uppercase text-rosemary transition-all hover:opacity-80" title="How To Pair Cocktails with Food?">How To Pair Cocktails with Food?</a>
                  </div>
                </div></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</search-dropdown>
</div><div class="flex h-full basis-[--mobileWidth] items-center py-2.5 md:basis-[--desktopWidth]" style="--desktopWidth:90px;--mobileWidth:60px;">
    <a href="https://clean.co/" title="CleanCo UK" class="relative block aspect-[--ratio] w-full transition-all hover:opacity-80 group-hover/stickyheader:text-[--headerFillText] group-fill/stickyheader:text-[--headerFillText]" style="--ratio:1.0"></a>
  </div>

  <div class="flex items-center justify-end flex-1 gap-3 lg:gap-4"><button class="rounded-md px-1.5 py-1.5 text-ice hover:bg-[--headerFillHoverBackground] hover:!text-[--headerFillHoverText] group-hover/stickyheader:text-[--headerFillText] group-fill/stickyheader:text-[--headerFillText]" aria-label="Search" data-search-trigger="">
      <svg class="w-6 transition-all" viewBox="0 0 29 29" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M11.781 20.844a9.063 9.063 0 100-18.125 9.063 9.063 0 000 18.125zM26.281 26.281l-8.092-8.093" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path>
      </svg>
    </button><localization-form class="relative items-center hidden h-full group lg:flex" data-type="desktop" client:idle=""><form method="post" action="https://clean.co/localization" id="localization_form" accept-charset="UTF-8" class="shopify-localization-form" enctype="multipart/form-data"><input type="hidden" name="form_type" value="localization"><input type="hidden" name="utf8" value="✓"><input type="hidden" name="_method" value="put"><input type="hidden" name="return_to" value="/apps/gbb/easybundle/2?page=addProductsPage1&amp;currentFlow=byob"><div class="flex cursor-pointer items-center gap-2 rounded-md px-2.5 py-2 font-gtpressura uppercase text-ice transition-all hover:bg-[--headerFillHoverBackground] hover:!text-[--headerFillHoverText] group-hover/stickyheader:text-[--headerFillText] group-active:bg-[--headerFillHoverBackground] group-active:!text-[--headerFillHoverText] group-fill/stickyheader:text-[--headerFillText]" data-toggle="">
            <div class="relative w-5 overflow-hidden rounded-full aspect-square">
              <img src="./CleanCo UK_files/gb.svg" alt="United Kingdom" srcset="//cdn.shopify.com/static/images/flags/gb.svg?width=32 32w" width="32" height="24" class="absolute inset-0 object-cover h-full object-center">
            </div>

            <svg class="w-3 transition-all" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 1.5l6 6 6-6" stroke="currentColor" stroke-width="2"></path>
            </svg>
          </div>

          <ul class="absolute right-0 flex flex-col invisible p-4 transition-all opacity-0 top-full rounded-b-md bg-ice group-active:visible group-active:opacity-100"><li>
                <a href="https://clean.co/apps/gbb/easybundle/2?page=addProductsPage1&amp;currentFlow=byob#" class="flex items-center whitespace-nowrap rounded-md px-2.5 py-4 font-ultramagnetic text-[15px] uppercase text-rosemary transition-all hover:bg-blue hover:text-ice" data-country="GG">
                  <div class="relative w-5 mr-2 overflow-hidden rounded-full aspect-square">
                    <img src="./CleanCo UK_files/gg.svg" alt="Guernsey" srcset="//cdn.shopify.com/static/images/flags/gg.svg?width=32 32w" width="32" height="24" class="absolute inset-0 object-cover h-full object-center">
                  </div>

                  Guernsey - £
                  GBP
                </a>
              </li><li>
                <a href="https://clean.co/apps/gbb/easybundle/2?page=addProductsPage1&amp;currentFlow=byob#" class="flex items-center whitespace-nowrap rounded-md px-2.5 py-4 font-ultramagnetic text-[15px] uppercase text-rosemary transition-all hover:bg-blue hover:text-ice" data-country="IE">
                  <div class="relative w-5 mr-2 overflow-hidden rounded-full aspect-square">
                    <img src="./CleanCo UK_files/ie.svg" alt="Ireland" srcset="//cdn.shopify.com/static/images/flags/ie.svg?width=32 32w" width="32" height="24" class="absolute inset-0 object-cover h-full object-center">
                  </div>

                  Ireland - €
                  EUR
                </a>
              </li><li>
                <a href="https://clean.co/apps/gbb/easybundle/2?page=addProductsPage1&amp;currentFlow=byob#" class="flex items-center whitespace-nowrap rounded-md px-2.5 py-4 font-ultramagnetic text-[15px] uppercase text-rosemary transition-all hover:bg-blue hover:text-ice" data-country="IM">
                  <div class="relative w-5 mr-2 overflow-hidden rounded-full aspect-square">
                    <img src="./CleanCo UK_files/im.svg" alt="Isle of Man" srcset="//cdn.shopify.com/static/images/flags/im.svg?width=32 32w" width="32" height="24" class="absolute inset-0 object-cover h-full object-center">
                  </div>

                  Isle of Man - £
                  GBP
                </a>
              </li><li>
                <a href="https://clean.co/apps/gbb/easybundle/2?page=addProductsPage1&amp;currentFlow=byob#" class="flex items-center whitespace-nowrap rounded-md px-2.5 py-4 font-ultramagnetic text-[15px] uppercase text-rosemary transition-all hover:bg-blue hover:text-ice" data-country="JE">
                  <div class="relative w-5 mr-2 overflow-hidden rounded-full aspect-square">
                    <img src="./CleanCo UK_files/je.svg" alt="Jersey" srcset="//cdn.shopify.com/static/images/flags/je.svg?width=32 32w" width="32" height="24" class="absolute inset-0 object-cover h-full object-center">
                  </div>

                  Jersey - £
                  GBP
                </a>
              </li><li>
                <a href="https://clean.co/apps/gbb/easybundle/2?page=addProductsPage1&amp;currentFlow=byob#" class="flex items-center whitespace-nowrap rounded-md px-2.5 py-4 font-ultramagnetic text-[15px] uppercase text-rosemary transition-all hover:bg-blue hover:text-ice" aria-current="true" data-country="GB">
                  <div class="relative w-5 mr-2 overflow-hidden rounded-full aspect-square">
                    <img src="./CleanCo UK_files/gb.svg" alt="United Kingdom" srcset="//cdn.shopify.com/static/images/flags/gb.svg?width=32 32w" width="32" height="24" class="absolute inset-0 object-cover h-full object-center">
                  </div>

                  United Kingdom - £
                  GBP
                </a>
              </li></ul>

          <input type="hidden" name="country_code" value="GB"></form>
      </localization-form><button title="Login / Register" class="hidden rounded-md px-1.5 py-1.5 text-ice hover:bg-[--headerFillHoverBackground] hover:!text-[--headerFillHoverText] group-hover/stickyheader:text-[--headerFillText] group-fill/stickyheader:text-[--headerFillText] lg:block" data-drawer-trigger="login">
        <svg class="w-6 transition-all" viewBox="0 0 29 29" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g clip-path="url(#prefix__clip0_268_2841)" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 15.336a4.183 4.183 0 100-8.365 4.183 4.183 0 000 8.365zM22.786 23.904a9.187 9.187 0 00-16.573 0"></path><path d="M14.5 27.048c6.93 0 12.548-5.618 12.548-12.548S21.43 1.952 14.5 1.952 1.952 7.57 1.952 14.5 7.57 27.048 14.5 27.048z"></path></g>
          <defs>
            <clippath id="prefix__clip0_268_2841"><path fill="#fff" d="M0 0h29v29H0z"></path></clippath>
          </defs>
        </svg>
      </button><button class="whitespace-nowrap rounded-md border-2 border-solid border-ice px-2.5 py-1.5 font-gtpressura text-sm uppercase text-ice transition-all hover:bg-[--headerFillHoverBackground] hover:!text-[--headerFillHoverText] group-hover/stickyheader:border-[--headerFillText] group-hover/stickyheader:text-[--headerFillText] group-fill/stickyheader:border-[--headerFillText] group-fill/stickyheader:text-[--headerFillText] lg:text-[15px]" data-drawer-trigger="cart">
      Cart: <span data-cart-count="">0
</span>
    </button>
  </div>
</header>


</div>
<!-- END sections: group-header -->

      <div class="invisible fixed inset-0 z-[-1] h-screen w-screen bg-black/50 opacity-0 transition-all active:visible active:opacity-100" data-header-backdrop=""></div>
    </sticky-header>

    <main role="main">
      
    
    <div class="gbbPageBody bundle-2" id="gbbBundle" style="font-family: Rubik, ui-sans-serif, system-ui, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Noto Color Emoji&quot;;"><div class="gbbHTMLWrapper"><div class="gbbBodyWrapper"><div class="gbbAddGiftBoxPageWrapper" style=""><div class="gbbAddProductsPageHeader"><div class="gbbPageHeader"></div><div class="gbbAddProductsPageNavigationContainer"><div class="gbbNavigationItemsContainer"><div class="gbbNavigationItem" id="addProductsPage1"><div class="gbbNavigationStepImgContainer gbbNavigationStepImgContainerActive" style="border: 4px solid rgb(0, 0, 0);"><img class="gbbNavigationImage" src="./CleanCo UK_files/Deafult+Image.png"></div><div class="gbbNavigationTitleContainer"><p class="gbbNavigationTitle" style="color: rgb(0, 0, 0);">Step 1</p></div></div><div class="gbbNavigationItem" id="addProductsPage2"><div class="gbbNavigationStepImgContainer"><img class="gbbNavigationImage" src="./CleanCo UK_files/Deafult+Image.png"></div><div class="gbbNavigationTitleContainer"><p class="gbbNavigationTitle" style="color: rgb(0, 0, 0);">Step 2</p></div></div><div class="gbbNavigationItem" id="addProductsPage3"><div class="gbbNavigationStepImgContainer"><img class="gbbNavigationImage" src="./CleanCo UK_files/Deafult+Image.png"></div><div class="gbbNavigationTitleContainer"><p class="gbbNavigationTitle" style="color: rgb(0, 0, 0);">Step 3</p></div></div></div></div></div><div class="gbbAddProductPageSubtextWrapper"><div class="gbbAddProductPageSubtext" style="color: black;">Choose Your Clean Spirit</div><div class="gbbAddProductPageBanners"></div></div><div class="gbbDiscountComponent"></div><div class="gbbAddProductsPageHTML"><div class="gbbAddProductsContainerHTML"><div class="gbbFiltersSearchSortHeader"></div><div class="gbbProductsContainer"><div class="gbbProductsItemsContainer" total-products="5"><div class="gbbProductItem" productid="7213935689825" firstvariantid="41820241920097" style="background: rgb(241, 242, 243); color: rgb(37, 37, 37);"><div class="gbbProductImageContainer"><img class="gbbProductImageContainerImg0 gbbProductImageContainerImg gbbFade" src="./CleanCo UK_files/G_42cf5e63-bf08-4e6f-841c-4328c3ae2d6d(1).png" style="display: block;"><a class="gbbPrevImage" style="display: none;">❮</a><a class="gbbNextImage" style="display: none;">❯</a><div class="gbbProductItemOverLay"><div class="gbbOverLayIconContainer"></div></div></div><div class="gbbProductTextContainer"><div class="gbbProductItemTitle" style="cursor: pointer;"><div class="gbbProductTitleOnly">Clean G</div><div class="gbbVariantTitle"></div></div></div><div class="gbbProductActionContainer"><div class="gbbProductItemPricesContainer"><div class="gbbProductItemCompareAtPrice"></div><div class="gbbProductItemPrice">£16.00</div></div><div class="gbbProductButtonWrapper"><div class="gbbProductAddButton" style="background: rgb(0, 0, 0); color: rgb(255, 255, 255);">Add To Box</div></div></div></div><div class="gbbProductItem" productid="7213935755361" firstvariantid="41820241985633" style="background: rgb(241, 242, 243); color: rgb(37, 37, 37);"><div class="gbbProductImageContainer"><img class="gbbProductImageContainerImg0 gbbProductImageContainerImg gbbFade" src="./CleanCo UK_files/Grhub_8d3e96f6-bf5f-4888-868a-28251650fb3d(1).png" style="display: block;"><a class="gbbPrevImage" style="display: none;">❮</a><a class="gbbNextImage" style="display: none;">❯</a><div class="gbbProductItemOverLay"><div class="gbbOverLayIconContainer"></div></div></div><div class="gbbProductTextContainer"><div class="gbbProductItemTitle" style="cursor: pointer;"><div class="gbbProductTitleOnly">Clean G Rhubarb</div><div class="gbbVariantTitle"></div></div></div><div class="gbbProductActionContainer"><div class="gbbProductItemPricesContainer"><div class="gbbProductItemCompareAtPrice"></div><div class="gbbProductItemPrice">£16.00</div></div><div class="gbbProductButtonWrapper"><div class="gbbProductAddButton" style="background: rgb(0, 0, 0); color: rgb(255, 255, 255);">Add To Box</div></div></div></div><div class="gbbProductItem" productid="7213935788129" firstvariantid="41820242018401" style="background: rgb(241, 242, 243); color: rgb(37, 37, 37);"><div class="gbbProductImageContainer"><img class="gbbProductImageContainerImg0 gbbProductImageContainerImg gbbFade" src="./CleanCo UK_files/R_8c0bf65b-42ee-4d2d-a92e-0cc313f9b01a(1).png" style="display: block;"><a class="gbbPrevImage" style="display: none;">❮</a><a class="gbbNextImage" style="display: none;">❯</a><div class="gbbProductItemOverLay"><div class="gbbOverLayIconContainer"></div></div></div><div class="gbbProductTextContainer"><div class="gbbProductItemTitle" style="cursor: pointer;"><div class="gbbProductTitleOnly">Clean R</div><div class="gbbVariantTitle"></div></div></div><div class="gbbProductActionContainer"><div class="gbbProductItemPricesContainer"><div class="gbbProductItemCompareAtPrice"></div><div class="gbbProductItemPrice">£16.00</div></div><div class="gbbProductButtonWrapper"><div class="gbbProductAddButton" style="background: rgb(0, 0, 0); color: rgb(255, 255, 255);">Add To Box</div></div></div></div><div class="gbbProductItem" productid="7213935853665" firstvariantid="41820242116705" data-load-more-indicator-status="fetching" style="background: rgb(241, 242, 243); color: rgb(37, 37, 37);"><div class="gbbProductImageContainer"><img class="gbbProductImageContainerImg0 gbbProductImageContainerImg gbbFade" src="./CleanCo UK_files/T_02ea59f9-01b5-41be-9dbe-b88af81b4ccb(1).png" style="display: block;"><a class="gbbPrevImage" style="display: none;">❮</a><a class="gbbNextImage" style="display: none;">❯</a><div class="gbbProductItemOverLay"><div class="gbbOverLayIconContainer"></div></div></div><div class="gbbProductTextContainer"><div class="gbbProductItemTitle" style="cursor: pointer;"><div class="gbbProductTitleOnly">Clean T</div><div class="gbbVariantTitle"></div></div></div><div class="gbbProductActionContainer"><div class="gbbProductItemPricesContainer"><div class="gbbProductItemCompareAtPrice"></div><div class="gbbProductItemPrice">£16.00</div></div><div class="gbbProductButtonWrapper"><div class="gbbProductAddButton" style="background: rgb(0, 0, 0); color: rgb(255, 255, 255);">Add To Box</div></div></div></div><div class="gbbProductItem" productid="7213935886433" firstvariantid="41820242149473" style="background: rgb(241, 242, 243); color: rgb(37, 37, 37);"><div class="gbbProductImageContainer"><img class="gbbProductImageContainerImg0 gbbProductImageContainerImg gbbFade" src="./CleanCo UK_files/W_dee6fb0b-63a6-4280-a9d0-6433cdd22986(1).png" style="display: block;"><a class="gbbPrevImage" style="display: none;">❮</a><a class="gbbNextImage" style="display: none;">❯</a><div class="gbbProductItemOverLay"><div class="gbbOverLayIconContainer"></div></div></div><div class="gbbProductTextContainer"><div class="gbbProductItemTitle" style="cursor: pointer;"><div class="gbbProductTitleOnly">Clean W</div><div class="gbbVariantTitle"></div></div></div><div class="gbbProductActionContainer"><div class="gbbProductItemPricesContainer"><div class="gbbProductItemCompareAtPrice"></div><div class="gbbProductItemPrice">£16.00</div></div><div class="gbbProductButtonWrapper"><div class="gbbProductAddButton" style="background: rgb(0, 0, 0); color: rgb(255, 255, 255);">Add To Box</div></div></div></div></div></div></div></div><div class="gbbAddProductsPageFooterHTML" style="background: rgb(241, 242, 243); color: rgb(0, 0, 0);"><div class="gbbPageFooterHTML"><div class="gbbProductsFooterHTML" style="background: rgb(241, 242, 243); color: rgb(0, 0, 0); grid-template-columns: 1fr;"><div><div class="gbbFooterButtonsWrapper" style="grid-template-columns: auto 1fr auto;"><div class="gbbFooterNextButton" style="background: rgb(0, 0, 0); color: rgb(255, 255, 255); grid-column: 3 / 3;">Next</div></div></div></div></div></div></div></div></div></div>
    <script>window.tmpCartSettings2 = {"userData":{"_id":"65a00d52b822452117ff673f","shopName":"clean-liquor.myshopify.com","brandName":"CleanCo UK","bundleSettings":{"allowMultipleBoxesFromSameBundle":true,"showCompareAtPrice":true,"dontIndexGiftboxBuilderPages_onGoogle":false,"isValidateInventoryEnabled":false,"combineWithOrderDiscounts":false,"isDiscountMethodAutomatic":false,"removeUnUsedVariantImages":false},"counters":{"reviewModal":100,"themeExtensionModal":5,"instructionsModalCnt":1,"viewBundleModalCnt":0,"createBundleModalCnt":0},"countryCode":"GB","countryName":"United Kingdom","createdAt":"2024-01-11T15:46:26.267Z","currency":"GBP","currencyInfo":{"code":"GBP","symbol":"£","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2},"customSettings":{"initialModalPopupCnt":0,"disableCartSettings":false,"addToCartBtnSelectors":"","checkoutBtnSelectors":"","customStyle":null,"addAfterAddTocartBtn":false,"addAftercheckoutBtn":false,"disableApp":false,"loadingGif":"https://d3ks0ngva6go34.cloudfront.net/custom/clean-liquor.myshopify.com/1709916867361.gif","stackDiscounts":true,"showOnlyAdminSelectedVariants":true,"overWriteCheckoutBtn":false,"addGiftMessageToNote":true,"buyNowBtn":"","cartItemQuantityBtnSelectors":"","cartItemRemoveParentSelectors":"","cartItemRemoveSelectors":"","cartItemSelectors":"","checkIfShowBundleAsProductEnabled":false,"customBundleScript":"","customCartIntegrationScript":"","customStyleForBuilderPages":null,"customStyleForDummyProductPage":null,"customThemeIntegrationScript":"","enableCustomThemeIntegrationScript":false,"isCartIntegrationEnabled":false,"loadingBgColor":"#f7f2e8","preparingBundleGif":"https://d3ks0ngva6go34.cloudfront.net/custom/clean-liquor.myshopify.com/1709916861255.gif","redirectToCartEnabled":false,"redirectToCheckoutEnabled":true,"redirectToScript":"","redirectUrlForCheckoutBtn":"","selectorToRenderBundlePostionOnCart":"Over","selectorToRenderBundlePostionOnSideCart":"Over","selectorToRenderBundleProduct":"","selectorToRenderBundleProductOnSideCart":"","sideCartCheckoutBtnSelectors":""},"isAppFree":false,"isSubscription":{"id":23342481505,"name":"plus-jan10","price":"99.00","billing_on":"2024-01-30","status":"active","created_at":"2024-01-15T09:52:19+00:00","updated_at":"2024-01-15T09:52:28+00:00","activated_on":"2024-01-15","return_url":"https://clean-liquor.myshopify.com/admin/apps/10b4272bede142b02924feec498b4009","test":false,"cancelled_on":null,"trial_days":15,"trial_ends_on":"2024-01-30","api_client_id":3918921729,"decorated_return_url":"https://clean-liquor.myshopify.com/admin/apps/10b4272bede142b02924feec498b4009?charge_id=23342481505","capped_amount":"199.00","balance_used":0,"balance_remaining":199,"risk_level":0.07899250000000001,"currency":"USD"},"multipleCurrenciesInfo":{"EUR":{"code":"EUR","symbol":"€","thousandsSeparator":" ","decimalSeparator":",","symbolOnLeft":false,"spaceBetweenAmountAndSymbol":true,"decimalDigits":2},"GBP":{"code":"GBP","symbol":"£","thousandsSeparator":",","decimalSeparator":".","symbolOnLeft":true,"spaceBetweenAmountAndSymbol":false,"decimalDigits":2}},"otherInfo":[],"planId":"","status":"1","timezone":"","updatedAt":"2025-02-05T15:47:09.928Z","lastVisitTime":"2024-05-16T08:58:43.904Z","isOnBoardingCompleted":true,"videoPage":{"backgroundColor":"#ffffff","logoImg":"https://db07ji0eqime4.cloudfront.net/redeemPage/giftcard/default-no-logo.jpg"},"totalBundleRevenue":16977.34,"totalOrdersCount":293,"shopDomain":"clean.co","loginData":{"lastLoggedInAt":"2025-02-03T11:39:23.013Z"},"reviewData":{"lastShownAt":"2025-02-03T11:39:22.282Z"},"mantleApiToken":"95a96cac-717c-40db-a085-fba15dcc9d97","isAppLevelMetafieldCreated":true,"storefrontAccessToken":"ddbc8df36617932677be6c228dfda6ea"},"languageData":{"_id":"65a00d52b822452117ff6793","shopName":"clean-liquor.myshopify.com","__v":0,"createdAt":"2024-01-11T15:46:26.482Z","en":{"landingPage":{"bannerText":{"id":"bannerText","label":"Banner Text","type":"text","value":"Build your own Bundle in just a few clicks!"},"bannerSubtext":{"id":"bannerSubtext","label":"Banner Subtext","type":"text","value":"Send a custom bundle to your loved one in just a few steps"},"bannerButtonText":{"id":"bannerButtonText","label":"Banner Button Text","type":"text","value":"Start Building your Bundle"},"selectPreCuratedBoxLabel":{"id":"selectPreCuratedBoxLabel","label":"Select Pre-Curated Box Label","type":"text","value":"Or select from a range of pre-curated Gift Boxes"}},"navigationSteps":{"productPageStepText":{"id":"productPageStepText","label":"Product Page Step Text","type":"text","value":"Add Products"},"giftBoxStepText":{"id":"giftBoxStepText","label":"Bundle Step Text","type":"text","value":"Add Gift Box"},"personalizeStepText":{"id":"personalizeStepText","label":"Personalize Step Text","type":"text","value":"Personalize"},"multipleCategoriesStepText":{"id":"multipleCategoriesStepText","label":"Multiple Categories Step Text","type":"text","value":"Multiple Categories"}},"productPage":{"selectProductsLabel":{"id":"selectProductsLabel","label":"Select Products Label","type":"text","value":"Select Products"},"productPageSubtext":{"id":"productPageSubtext","label":"Product Page Subtext","type":"text","value":""}},"giftBoxPage":{"selectGiftBoxLabel":{"id":"selectGiftBoxLabel","label":"Select Bundle Label","type":"text","value":"Select a Bundle Box"},"giftBoxPageSubtext":{"id":"giftBoxPageSubtext","label":"Gift Box Page Subtext","type":"text","value":""}},"videoMessage":{"permissionDenied":{"id":"permissionDenied","label":"Permission Denied","type":"text","value":"Permission Denied"},"uploadConfirmation":{"id":"uploadConfirmation","label":"Upload Confirmation","type":"text","value":"Your video has been successfully uploaded!"},"pressToRecord":{"id":"pressToRecord","label":"Press to record","type":"text","value":"Press to record"},"recording":{"id":"recording","label":"Recording","type":"text","value":"Recording...."},"errorMessage":{"id":"errorMessage","label":"Error Message","type":"text","value":"An error occured, Please try again!"},"loading":{"id":"loading","label":"Loading","type":"text","value":"Loading...."},"uploading":{"id":"uploading","label":"Uploading","type":"text","value":"Uploading...."},"sendVideoMessageText":{"id":"sendVideoMessageText","label":"Send Video Message Text","type":"text","value":"Send Video Message"},"giftMessageDeliveryInfo":{"id":"giftMessageDeliveryInfo","label":"Message Delivery Info","type":"text","value":"The message will be sent to the recipient via email as soon as the order is placed"},"saveVideoText":{"id":"saveVideoText","label":"Save Video Text","type":"text","value":"Save Video"},"reRecordVideoText":{"id":"reRecordVideoText","label":"Re-Record Video Text","type":"text","value":"Re-Record Video"}},"personalizePage":{"selectGreetingCardLabel":{"id":"selectGreetingCardLabel","label":"Select Greeting Card Label","type":"text","value":"Select A Greeting Card"},"clearSelectionButton":{"id":"clearSelectionButton","label":"Clear Selection label","type":"text","value":"Clear Selection"},"noImagesAvailable":{"id":"noImagesAvailable","label":"No Images Available label","type":"text","value":"No Images Available"},"messageLabel":{"id":"messageLabel","label":"Message Label","type":"text","value":"Message"},"senderNamePlaceholder":{"id":"senderNamePlaceholder","label":"Sender Name Placeholder","type":"text","value":"From"},"recipientNamePlaceholder":{"id":"recipientNamePlaceholder","label":"Recipient Name Placeholder","type":"text","value":"To"},"messagePlaceholder":{"id":"messagePlaceholder","label":"Message Placeholder","type":"text","value":"Enter a message here..."},"emailAddressLabel":{"id":"emailAddressLabel","label":"Recipient Email Address Label","type":"text","value":"Recipient Email Address"},"emailAddressPlaceholder":{"id":"emailAddressPlaceholder","label":"Recipient Email Address Placeholder","type":"text","value":"Enter a recipient email address here..."},"emailValidationMessage":{"id":"emailValidationMessage","label":"Email Validation Message","type":"text","value":"Please enter a valid email address"},"sendNow":{"id":"sendNow","label":"Send Now Label","type":"text","value":"Send Now"},"sendLater":{"id":"sendLater","label":"Send Later Label","type":"text","value":"Send Later"},"personalizePageSubtext":{"id":"personalizePageSubtext","label":"Personalize Page Subtext","type":"text","value":""},"messageIsRequiredError":{"id":"messageIsRequiredError","label":"Message is required warning","type":"text","value":"Please enter a message"}},"reviewPage":{"reviewPageBannerText":{"id":"reviewPageBannerText","label":"Review Page Banner Text","type":"text","value":"You’ve made the  Right Choice!"},"reviewPageBannerSubtext":{"id":"reviewPageBannerSubtext","label":"Review Page Banner Subtext","type":"text","value":"Review your bundle and proceed to checkout"},"addOnsLabel":{"id":"addOnsLabel","label":"Add Ons Label","type":"text","value":"Add Ons"},"totalValueLabel":{"id":"totalValueLabel","label":"Total Value Label","type":"text","value":"Total Value"},"totalLabel":{"id":"totalLabel","label":"Total Label","type":"text","value":"Total"},"productLabel":{"id":"productLabel","label":"Product Header Label","type":"text","value":"Product"},"priceLabel":{"id":"priceLabel","label":"Price Header Text","type":"text","value":"Price"},"quantityLabel":{"id":"quantityLabel","label":"Quantity Header Text","type":"text","value":"Quantity"},"deliveryDateLabel":{"id":"deliveryDateLabel","label":"Delivery Date Label","type":"text","value":"Delivery Date"},"productsLabelText":{"id":"productsLabelText","label":"Products Label Text","type":"text","value":"Products"},"messagesLabelText":{"id":"messagesLabelText","label":"Messages Label Text","type":"text","value":"Messages"},"discountAppliedLabel":{"id":"discountAppliedLabel","label":"Discount Applied Label","type":"text","value":"Discount"},"subtotalLabel":{"id":"subtotalLabel","label":"Sub Total Label","type":"text","value":"Subtotal"},"orderDetailsLabel":{"id":"orderDetailsLabel","label":"Order Details Label","type":"text","value":"Order Details"},"itemsLabel":{"id":"itemsLabel","label":"No. of Items Label","type":"text","value":"Item(s)"},"oneTimePurchaseLabel":{"id":"oneTimePurchaseLabel","label":"One-Time Purchase label","type":"text","value":"One-Time Purchase"},"subscribeAndSaveLabel":{"id":"subscribeAndSaveLabel","label":"Subscribe and Save label","type":"text","value":"Subscribe and Save"},"noSubscriptionFoundLabel":{"id":"noSubscriptionFoundLabel","label":"No Subscription plans found label","type":"text","value":"Oops! No Subscription plans were found"},"deliveryFrequencyLabel":{"id":"deliveryFrequencyLabel","label":"Delivery Frequency Label","type":"text","value":"Delivery Frequency"},"createNewBoxLabel":{"id":"createNewBoxLabel","label":"Create New Box Label","type":"text","value":"Create new Box"},"editButtonText":{"id":"editButtonText","label":"Edit Label","type":"text","value":"Edit"},"deliverySchedulerPlaceholderText":{"id":"deliverySchedulerPlaceholderText","label":"Delivery Scheduler Placeholder Text","type":"text","value":"Select a date"}},"general":{"noProductsAvailable":{"id":"noProductsAvailable","label":"No Products Available label","type":"text","value":"No Products Available"},"filtersLabel":{"id":"filtersLabel","label":"Filters Label","type":"text","value":"Filters"},"clearSelection":{"id":"clearSelection","label":"Clear Filters Selection","type":"text","value":"Clear Selection"},"searchLabel":{"id":"searchLabel","label":"Search Label","type":"text","value":"Search"},"addToBoxButtonText":{"id":"addToBoxButtonText","label":"Add To Box Button","type":"text","value":"Add To Box"},"chooseOptionsButtonText":{"id":"chooseOptionsButtonText","label":"Choose Options Button","type":"text","value":"Choose Options"},"loadMoreProductsButtonText":{"id":"loadMoreProductsButtonText","label":"Load More Products Button","type":"text","value":"Load More Products"},"loadingCheckoutButtonText":{"id":"loadingCheckoutButtonText","label":"Loading Checkout Button","type":"text","value":"Loading Checkout..."},"addedText":{"id":"addedText","label":"Added Label","type":"text","value":"Added"},"addButtonText":{"id":"addButtonText","label":"Add Button Text","type":"text","value":"Add"},"nextButtonText":{"id":"nextButtonText","label":"Next Button Text","type":"text","value":"Next"},"addToCartButtonText":{"id":"addToCartButtonText","label":"Add To Cart Button Text","type":"text","value":"Add To Cart"},"backButtonText":{"id":"backButtonText","label":"Back Button Text","type":"text","value":"Back"},"checkoutButtonText":{"id":"checkoutButtonText","label":"Checkout Button Text","type":"text","value":"Checkout"},"removeButtonText":{"id":"removeButtonText","label":"Remove Button Text","type":"text","value":"Remove"},"reviewButtonText":{"id":"reviewButtonText","label":"Review Button Text","type":"text","value":"Review"},"combinationNotAvailable":{"id":"combinationNotAvailable","label":"Combination Not Available","type":"text","value":"Combination Not Available"},"quantity":{"id":"quantity","label":"Quantity Label","type":"text","value":"Quantity"},"viewCartProductsLabel":{"id":"viewCartProductsLabel","label":"View Cart Products Label","type":"text","value":"View Selected Products"},"selectedProductsLabel":{"id":"selectedProductsLabel","label":"Selected Products Label","type":"text","value":"Selected Products"},"selectBundleProductsText":{"id":"selectBundleProductsText","label":"Select Bundle Products label","type":"text","value":"Select Bundle Products"},"redirectingText":{"id":"redirectingText","label":"Redirecting label","type":"text","value":"Redirecting..."},"preparingBundleText":{"id":"preparingBundleText","label":"Preparing Bundle Label","type":"text","value":"Preparing Bundle..."},"productsNotAvailableText":{"id":"productsNotAvailableText","label":"Products Not Available Label","type":"text","value":"Oops! Some Products are not available"},"discountsMayNotApplyText":{"id":"discountsMayNotApplyText","label":"Discounts may not be applied Label","type":"text","value":"discounts may not be applied"},"removeAllBoxProducts":{"id":"removeAllBoxProducts","label":"Remove all Box Products Label (Cart Page Popup)","type":"text","value":"This is a Box Product. Removing this will remove all the products from box"},"cartPageCheckoutButtonLoadingText":{"id":"cartPageCheckoutButtonLoadingText","label":"Cart Page Checkout Button Loading Text","type":"text","value":"Loading Checkout..."},"inventoryInStockText":{"id":"inventoryInStockText","label":"Inventory in Stock Label","type":"text","value":"in Stock"},"inventoryLimitReachedText":{"id":"inventoryLimitReachedText","label":"Inventory Limit Reached Label","type":"text","value":"No More Stock"}},"discountRules":{"rule1":{"amount":{"id":"amount","label":"Amount","type":"text","value":""},"text":{"id":"text","label":"Text","type":"text","value":""}},"rule2":{"amount":{"id":"amount","label":"Amount","type":"text","value":""},"text":{"id":"text","label":"Text","type":"text","value":""}},"rule3":{"amount":{"id":"amount","label":"Amount","type":"text","value":""},"text":{"id":"text","label":"Text","type":"text","value":""}},"rule4":{"amount":{"id":"amount","label":"Amount","type":"text","value":""},"text":{"id":"text","label":"Text","type":"text","value":""}},"rule5":{"amount":{"id":"amount","label":"Amount","type":"text","value":""},"text":{"id":"text","label":"Text","type":"text","value":""}}},"sortBy":{"sortLabel":{"id":"sortLabel","label":"Sort Label","type":"text","value":"Sort"},"alphabeticalAToZ":{"id":"alphabeticalAToZ","label":"Alphabetical, A-Z Label","value":"Alphabetical, A-Z"},"alphabeticalZToA":{"id":"alphabeticalZToA","label":"Alphabetical, Z-A Label","value":"Alphabetical, Z-A"},"priceHighToLow":{"id":"priceHighToLow","label":"Price, High to Low Label","value":"Price, High to Low"},"priceLowToHigh":{"id":"priceLowToHigh","label":"Price, Low to High Label","value":"Price, Low to High"},"featured":{"id":"featured","label":"Featured Label","type":"text","value":"Featured"}},"conditions":{"amount":{"greaterThanOrEqualTo":{"id":"greaterThanOrEqualTo","label":"Greater than condition message","type":"text","value":"Add products worth at least ##conditionAmount## on this step"},"lessThanOrEqualTo":{"id":"lessThanOrEqualTo","label":"Less than condition message","type":"text","value":"Add products worth maximum of ##conditionAmount## on this step"},"equalTo":{"id":"equalTo","label":"Equal to condition message","type":"text","value":"Add products worth ##conditionAmount## on this step"}},"quantity":{"greaterThanOrEqualTo":{"id":"greaterThanOrEqualTo","label":"Greater than condition message","type":"text","value":"Add at least ##conditionQuantity## products on this step"},"lessThanOrEqualTo":{"id":"lessThanOrEqualTo","label":"Less than condition message","type":"text","value":"Add a maximum of ##conditionQuantity## products to continue"},"equalTo":{"id":"equalTo","label":"Equal to condition message","type":"text","value":"Add exactly ##conditionQuantity## products on this step"}},"weight":{"greaterThanOrEqualTo":{"id":"greaterThanOrEqualTo","label":"Greater than condition message","type":"text","value":"Add products weighing at least ##conditionWeight## on this step"},"lessThanOrEqualTo":{"id":"lessThanOrEqualTo","label":"Less than condition message","type":"text","value":"Add products weighing maximum of ##conditionWeight## on this step"},"equalTo":{"id":"equalTo","label":"Equal to condition message","type":"text","value":"Add products weighing ##conditionWeight## on this step"}}},"multipleCategoriesPage":{"multipleCategoriesSubtext":{"id":"multipleCategoriesSubtext","label":"Multiple Categories Page Subtext","type":"text","value":""}},"multipleCategories":{},"addons":{"maxAddonProductsAllowed":{"id":"maxAddonProductsAllowed","label":"Max Addon Products Allowed message","type":"text","value":" add maximum ##maxAllowedAddons## products to continue"},"addonProductsMandatory":{"id":"addonProductsMandatory","label":"Addon Products Mandatory message","type":"text","value":"Please add atleast one product"}}},"languageMode":"SINGLE","updatedAt":"2024-01-11T15:46:26.482Z","mixAndMatchTextData":{"en":{"conditions":{"amount":{"greaterThanOrEqualTo":{"id":"greaterThanOrEqualTo","label":"Greater than condition message","type":"text","value":"Add products worth at least ##conditionAmount## on this step"},"lessThanOrEqualTo":{"id":"lessThanOrEqualTo","label":"Less than condition message","type":"text","value":"Add products worth maximum of ##conditionAmount## on this step"},"equalTo":{"id":"equalTo","label":"Equal to condition message","type":"text","value":"Add products worth ##conditionAmount## on this step"}},"quantity":{"greaterThanOrEqualTo":{"id":"greaterThanOrEqualTo","label":"Greater than condition message","type":"text","value":"Add at least ##conditionQuantity## products on this step"},"lessThanOrEqualTo":{"id":"lessThanOrEqualTo","label":"Less than condition message","type":"text","value":"Add a maximum of ##conditionQuantity## products to continue"},"equalTo":{"id":"equalTo","label":"Equal to condition message","type":"text","value":"Add exactly ##conditionQuantity## products on this step"}},"weight":{"greaterThanOrEqualTo":{"id":"greaterThanOrEqualTo","label":"Greater than condition message","type":"text","value":"Add products weighing at least ##conditionWeight## on this step"},"lessThanOrEqualTo":{"id":"lessThanOrEqualTo","label":"Less than condition message","type":"text","value":"Add products weighing maximum of ##conditionWeight## on this step"},"equalTo":{"id":"equalTo","label":"Equal to condition message","type":"text","value":"Add products weighing ##conditionWeight## on this step"}}},"general":{"noProductsAvailable":{"id":"noProductsAvailable","label":"No Products Available label","type":"text","value":"No Products Available"},"addBundleToCartBtnText":{"id":"addBundleToCartBtnText","label":"Add Bundle Cart label","type":"text","value":"Add Bundle to Cart"},"addBundleToCartLoadingBtnText":{"id":"addBundleToCartLoadingBtnText","label":"Add Bundle Loading label","type":"text","value":"Adding Bundle..."},"inventoryLimitReachedText":{"id":"inventoryLimitReachedText","label":"Inventory Limit Reached Label","type":"text","value":"No More Stock"},"emptyCardText":{"id":"emptyCardText","label":"Add Product Card Text","type":"text","value":"Add Product"}},"footer":{"footerPrevBtnText":{"id":"footerPrevBtnText","label":"Footer Previous Button","type":"text","value":"Prev"},"footerNextBtnText":{"id":"footerNextBtnText","label":"Footer Next Button","type":"text","value":"Next"},"footerFinishBtnText":{"id":"footerFinishBtnText","label":"Footer Finish Button","type":"text","value":"Done"}},"productCard":{"productCardAddBtnText":{"id":"productCardAddBtnText","label":"Product Add to Cart Button","type":"text","value":"Add to Cart"},"productVariantLabelText":{"id":"productVariantLabelText","label":"Product Variant Label","type":"text","value":"Select variant"}}}}},"pageCustomizationData":{"_id":"65a00d52b822452117ff6792","shopName":"clean-liquor.myshopify.com","__v":0,"banners":{"landingPageImageSrc":"https://d3ks0ngva6go34.cloudfront.net/public/banners/landing_page_bannerv2.png","pageBannerImageSrc":"https://d3ks0ngva6go34.cloudfront.net/public/banners/page_banner_temp.png","productReviewImageSrc":"https://d3ks0ngva6go34.cloudfront.net/public/banners/landing_page_bannerv2.png"},"cartFooter":{"cartFooterBgColor":"#f1f2f3","cartFooterTextColor":"#000000","cartFooterNextButtonColor":"#000000","cartFooterNextButtonTextColor":"#ffffff","cartFooterBackButtonColor":"#6d7175","cartFooterBackButtonTextColor":"#ffffff","cartFooterDiscountTextColor":"#000000"},"colors":{"disabledColor":"gray","primaryColor":"blue","productBox":"blue","secondaryColor":"aqua","textColor":"black"},"createdAt":"2024-01-11T15:46:26.482Z","landingPage":{"landingPageTextColor":"#000000","landingPageButtonBgColor":"#000000","landingPageButtonTextColor":"#ffffff"},"navigationBanner":{"navigationBannerTitleColor":"#ffffff","navigationBannerTextColor":"#ffffff","navigationBannerStepCompletionColor":"#000000","navigationBannerStepDoneColor":"#ffffff","navigationBannerStepTextColor":"#000000"},"previewPage":{"bannerTextColor":"#ffffff"},"primaryFont":"","productCard":{"productCardBgColor":"#f1f2f3","productCardTextColor":"#252525","productCardButtonColor":"#000000","productCardButtonTextColor":"#ffffff"},"quickSettings":{"isQuickSettingsEnabled":true,"colors":{"primaryColor":"#000000","buttonBgColor":"#000000","buttonTextColor":"#ffffff"}},"summaryBlock":{"summaryBlockAddToCartButtonColor":"#000000","summaryBlockAddToCartButtonTextColor":"#ffffff","summaryBlockBackButtonColor":"#252525","summaryBlockBackButtonTextColor":"#ffffff"},"updatedAt":"2024-09-25T14:01:00.926Z","templateLevelConfig":{}},"stepsConfigurationData":{"_id":"66f415853071fa60be48f926","bundleId":"2","shopName":"clean-liquor.myshopify.com","__v":0,"bundleImg":"https://d3ks0ngva6go34.cloudfront.net/giftBox/clean-liquor.myshopify.com/1710849891593.png","bundleLink":"https://clean-liquor.myshopify.com/apps/gbb/easybundle/2","bundleName":"Your CleanCo Box","bundleStatus":"ACTIVE","createdAt":"2024-09-25T13:52:05.606Z","customBundleLevelStyle":"","defaultProductsData":{"isDefaultProductsEnabled":false,"products":[]},"enableRecurringDiscounts":false,"isOneTimePurchaseEnabled":true,"isOrderSubscriptionsEnabled":false,"landingPageData":{"isLandingPageEnabled":false,"stepImage":"https://d3ks0ngva6go34.cloudfront.net/public/banners/landing_page_bannerv2.png","isVisibleOnAdminUi":true,"bannerText":"Build your own Bundle in just a few clicks!","bannerButtonText":"Build your Custom Bundle","bannerSubtext":"Send a custom bundle to your loved one in just a few steps"},"multipleCategoriesData":{"isMultipleCategoriesEnabled":false,"stepImage":"https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconf3.png"},"personalizationData":{"isVisibleOnAdminUi":true,"isPersonalizationEnabled":false,"personalizeStepText":"Personalize","personalizePageSubtext":"","stepImage":"https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg","scheduleDelivery":{"isScheduleDeliveryEnabled":false,"leadTime":"7","maxDateInDays":"60","disabledDaysOfWeek":[],"disabledDates":[]}},"productsData1":{"isVisibleOnAdminUi":true,"stepImage":"https://gift-box-builder-app4.s3.us-east-2.amazonaws.com/public/icons/Deafult+Image.png","products":[{"productId":"7213935689825","graphqlId":"gid://shopify/Product/7213935689825","handle":"clean-g-alcohol-free-spirit","variants":[{"variantId":"41820241920097","variantGraphqlId":"gid://shopify/ProductVariant/41820241920097","inventoryQuantity":-4,"inventoryPolicy":"CONTINUE","price":"16.00","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/G.png?v=1726061563"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/G_2.png?v=1726061563"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/US.png?v=1726863514"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/20.png?v=1726863514"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/18_544be5a3-8dee-4756-b6b1-8a174e8bba77.png?v=1726863513"}],"title":"Clean G","tags":["0.0%","Bottles"],"updated_at":"2024-10-01T10:05:09+01:00"},{"productId":"7213935755361","graphqlId":"gid://shopify/Product/7213935755361","handle":"clean-g-rhubarb-alcohol-free-spirit","variants":[{"variantId":"41820241985633","variantGraphqlId":"gid://shopify/ProductVariant/41820241985633","inventoryQuantity":0,"inventoryPolicy":"CONTINUE","price":"16.00","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/Grhub.png?v=1726061578"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/Grhub_2.png?v=1726061577"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/UK_6.png?v=1726863524"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/22.png?v=1726863525"}],"title":"Clean G Rhubarb","tags":["0.0%","Bottles"],"updated_at":"2024-10-01T09:47:44+01:00"},{"productId":"7213935788129","graphqlId":"gid://shopify/Product/7213935788129","handle":"clean-r-alcohol-free-spirit","variants":[{"variantId":"41820242018401","variantGraphqlId":"gid://shopify/ProductVariant/41820242018401","inventoryQuantity":0,"inventoryPolicy":"DENY","price":"16.00","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/R.png?v=1726061583"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/R_2.png?v=1726061583"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/UK_2.png?v=1726863556"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/AmazonStorefrontProducts_1.png?v=1726863787"}],"title":"Clean R","tags":["0.0%","Bottles"],"updated_at":"2024-10-01T09:47:38+01:00"},{"productId":"7213935853665","graphqlId":"gid://shopify/Product/7213935853665","handle":"clean-t-alcohol-free-spirit","variants":[{"variantId":"41820242116705","variantGraphqlId":"gid://shopify/ProductVariant/41820242116705","inventoryQuantity":0,"inventoryPolicy":"DENY","price":"16.00","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/T_af8dd390-3446-4d1e-8624-880ca3c6db31.png?v=1727691036"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/T_2.png?v=1726061589"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/UK_3.png?v=1726863599"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/21.png?v=1726863599"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/19_c32bc70f-4362-4ace-b850-23aa65f33fdc.png?v=1726863599"}],"title":"Clean T","tags":["0.0%","Bottles"],"updated_at":"2024-10-01T09:47:33+01:00"},{"productId":"7213935886433","graphqlId":"gid://shopify/Product/7213935886433","handle":"clean-w-alcohol-free-spirit","variants":[{"variantId":"41820242149473","variantGraphqlId":"gid://shopify/ProductVariant/41820242149473","inventoryQuantity":-6079,"inventoryPolicy":"CONTINUE","price":"16.00","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/W.png?v=1726061599"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/W_2.png?v=1726061599"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/UK_5.png?v=1726863627"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/AmazonStorefrontProducts.png?v=1726863782"}],"title":"Clean W","tags":["0.0%","Bottles"],"updated_at":"2024-10-01T09:47:27+01:00"}],"sortBy":{"isSortByEnabled":true,"categories":{"alphabeticalAToZ":{"id":"alphabeticalAToZ","label":"Alphabetical, A-Z","isEnabled":false},"alphabeticalZToA":{"id":"alphabeticalZToA","label":"Alphabetical, Z-A","isEnabled":true},"priceHighToLow":{"id":"priceHighToLow","label":"Price, High to Low","isEnabled":false},"priceLowToHigh":{"id":"priceLowToHigh","label":"Price, Low to High","isEnabled":false}}},"search":{"isSearchEnabled":true},"filterTypes":{"isFiltersEnabled":true,"categories":{},"filterRule":"OR","filterRuleAcrossCategory":"OR"},"productPageStepText":"Step 1","productPageSubtext":"Choose Your Clean Spirit","productPageKey":"productsData1","conditions":[{"type":"quantity","condition":"greaterThanOrEqualTo","value":"1"}],"displayVariantsAsIndividualProducts":false,"isProductsEnabled":true,"uniqueProductsData":[{"productId":"7213935689825","graphqlId":"gid://shopify/Product/7213935689825","handle":"clean-g-alcohol-free-spirit","variants":[{"variantId":"41820241920097","variantGraphqlId":"gid://shopify/ProductVariant/41820241920097","inventoryQuantity":-4,"inventoryPolicy":"CONTINUE","price":"16.00","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/G.png?v=1726061563"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/G_2.png?v=1726061563"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/US.png?v=1726863514"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/20.png?v=1726863514"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/18_544be5a3-8dee-4756-b6b1-8a174e8bba77.png?v=1726863513"}],"title":"Clean G","tags":["0.0%","Bottles"],"updated_at":"2024-10-01T10:05:09+01:00"},{"productId":"7213935755361","graphqlId":"gid://shopify/Product/7213935755361","handle":"clean-g-rhubarb-alcohol-free-spirit","variants":[{"variantId":"41820241985633","variantGraphqlId":"gid://shopify/ProductVariant/41820241985633","inventoryQuantity":0,"inventoryPolicy":"CONTINUE","price":"16.00","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/Grhub.png?v=1726061578"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/Grhub_2.png?v=1726061577"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/UK_6.png?v=1726863524"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/22.png?v=1726863525"}],"title":"Clean G Rhubarb","tags":["0.0%","Bottles"],"updated_at":"2024-10-01T09:47:44+01:00"},{"productId":"7213935788129","graphqlId":"gid://shopify/Product/7213935788129","handle":"clean-r-alcohol-free-spirit","variants":[{"variantId":"41820242018401","variantGraphqlId":"gid://shopify/ProductVariant/41820242018401","inventoryQuantity":0,"inventoryPolicy":"DENY","price":"16.00","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/R.png?v=1726061583"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/R_2.png?v=1726061583"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/UK_2.png?v=1726863556"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/AmazonStorefrontProducts_1.png?v=1726863787"}],"title":"Clean R","tags":["0.0%","Bottles"],"updated_at":"2024-10-01T09:47:38+01:00"},{"productId":"7213935853665","graphqlId":"gid://shopify/Product/7213935853665","handle":"clean-t-alcohol-free-spirit","variants":[{"variantId":"41820242116705","variantGraphqlId":"gid://shopify/ProductVariant/41820242116705","inventoryQuantity":0,"inventoryPolicy":"DENY","price":"16.00","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/T_af8dd390-3446-4d1e-8624-880ca3c6db31.png?v=1727691036"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/T_2.png?v=1726061589"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/UK_3.png?v=1726863599"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/21.png?v=1726863599"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/19_c32bc70f-4362-4ace-b850-23aa65f33fdc.png?v=1726863599"}],"title":"Clean T","tags":["0.0%","Bottles"],"updated_at":"2024-10-01T09:47:33+01:00"},{"productId":"7213935886433","graphqlId":"gid://shopify/Product/7213935886433","handle":"clean-w-alcohol-free-spirit","variants":[{"variantId":"41820242149473","variantGraphqlId":"gid://shopify/ProductVariant/41820242149473","inventoryQuantity":-6079,"inventoryPolicy":"CONTINUE","price":"16.00","variantTitle":"Default Title"}],"hasOnlyDefaultVariant":true,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/W.png?v=1726061599"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/W_2.png?v=1726061599"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/UK_5.png?v=1726863627"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/AmazonStorefrontProducts.png?v=1726863782"}],"title":"Clean W","tags":["0.0%","Bottles"],"updated_at":"2024-10-01T09:47:27+01:00"}],"autoNextStepOnConditionMet":false,"pageBanners":{"mobileBanner":"","desktopBanner":""},"filterBySearch":{"isSearchEnabled":false,"searchQuery":{"searchField":"title","searchFieldType":"String"}}},"productsData2":{"isVisibleOnAdminUi":true,"stepImage":"https://gift-box-builder-app4.s3.us-east-2.amazonaws.com/public/icons/Deafult+Image.png","products":[{"productId":"7018130636897","graphqlId":"gid://shopify/Product/7018130636897","handle":"ginger-fever-tree","variants":[{"variantId":"41018694238305","variantGraphqlId":"gid://shopify/ProductVariant/41018694238305","inventoryQuantity":507,"price":"3.00","id":"gid://shopify/ProductVariant/41018694238305"},{"variantId":"41018694271073","variantGraphqlId":"gid://shopify/ProductVariant/41018694271073","inventoryQuantity":0,"price":"3.00","id":"gid://shopify/ProductVariant/41018694271073"}],"hasOnlyDefaultVariant":false,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/Untitleddesign_27.png?v=1696251429"}],"title":"FEVER TREE GINGER ALE - x8 PACK","tags":[],"id":"gid://shopify/Product/7018130636897"},{"productId":"7018130735201","graphqlId":"gid://shopify/Product/7018130735201","handle":"fever-tree-tonic","variants":[{"variantId":"41018689847393","variantGraphqlId":"gid://shopify/ProductVariant/41018689847393","inventoryQuantity":468,"price":"3.00","id":"gid://shopify/ProductVariant/41018689847393"},{"variantId":"41018689880161","variantGraphqlId":"gid://shopify/ProductVariant/41018689880161","inventoryQuantity":0,"price":"3.00","id":"gid://shopify/ProductVariant/41018689880161"}],"hasOnlyDefaultVariant":false,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/Untitleddesign_28.png?v=1696251711"}],"title":"FEVER TREE INDIAN TONIC WATER - X8 PACK","tags":[],"id":"gid://shopify/Product/7018130735201"}],"sortBy":{"isSortByEnabled":true,"categories":{"alphabeticalAToZ":{"id":"alphabeticalAToZ","label":"Alphabetical, A-Z","isEnabled":true},"alphabeticalZToA":{"id":"alphabeticalZToA","label":"Alphabetical, Z-A","isEnabled":true},"priceHighToLow":{"id":"priceHighToLow","label":"Price, High to Low","isEnabled":false},"priceLowToHigh":{"id":"priceLowToHigh","label":"Price, Low to High","isEnabled":false}}},"search":{"isSearchEnabled":true},"filterTypes":{"isFiltersEnabled":true,"categories":{},"filterRule":"OR","filterRuleAcrossCategory":"OR"},"productPageStepText":"Step 2","productPageSubtext":"Choose Your Mixers","productPageKey":"productsData2","conditions":[],"displayVariantsAsIndividualProducts":false,"isProductsEnabled":true,"uniqueProductsData":[{"productId":"7018130636897","graphqlId":"gid://shopify/Product/7018130636897","handle":"ginger-fever-tree","variants":[{"variantId":"41018694238305","variantGraphqlId":"gid://shopify/ProductVariant/41018694238305","inventoryQuantity":507,"price":"3.00","id":"gid://shopify/ProductVariant/41018694238305"},{"variantId":"41018694271073","variantGraphqlId":"gid://shopify/ProductVariant/41018694271073","inventoryQuantity":0,"price":"3.00","id":"gid://shopify/ProductVariant/41018694271073"}],"hasOnlyDefaultVariant":false,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/Untitleddesign_27.png?v=1696251429"}],"title":"FEVER TREE GINGER ALE - x8 PACK","tags":[],"id":"gid://shopify/Product/7018130636897"},{"productId":"7018130735201","graphqlId":"gid://shopify/Product/7018130735201","handle":"fever-tree-tonic","variants":[{"variantId":"41018689847393","variantGraphqlId":"gid://shopify/ProductVariant/41018689847393","inventoryQuantity":468,"price":"3.00","id":"gid://shopify/ProductVariant/41018689847393"},{"variantId":"41018689880161","variantGraphqlId":"gid://shopify/ProductVariant/41018689880161","inventoryQuantity":0,"price":"3.00","id":"gid://shopify/ProductVariant/41018689880161"}],"hasOnlyDefaultVariant":false,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/files/Untitleddesign_28.png?v=1696251711"}],"title":"FEVER TREE INDIAN TONIC WATER - X8 PACK","tags":[],"id":"gid://shopify/Product/7018130735201"}]},"productsData3":{"isVisibleOnAdminUi":true,"stepImage":"https://gift-box-builder-app4.s3.us-east-2.amazonaws.com/public/icons/Deafult+Image.png","products":[{"productId":"6690164703329","graphqlId":"gid://shopify/Product/6690164703329","handle":"clean-cocktail-recipe-book","variants":[{"variantId":"39658843144289","variantGraphqlId":"gid://shopify/ProductVariant/39658843144289","inventoryQuantity":444,"price":"20.00","id":"gid://shopify/ProductVariant/39658843144289"},{"variantId":"39658843177057","variantGraphqlId":"gid://shopify/ProductVariant/39658843177057","inventoryQuantity":236,"price":"20.00","id":"gid://shopify/ProductVariant/39658843177057"}],"hasOnlyDefaultVariant":false,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/products/clean_cocktail_recipe_book_2000x2000_1bab56bd-b976-4443-97e2-4eb71c64c5a0.jpg?v=1638877518"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/products/cleanco_cocktail_book_back.jpg?v=1638952884"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/products/cleanco_cocktail_book_recipe_ingredients.jpg?v=1638952884"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/products/cleanco_cocktail_book_equipment.jpg?v=1638952884"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/products/cleanco_cocktail_book_clean_margarita.jpg?v=1638952884"}],"title":"Clean Cocktails Recipe Book","tags":[],"id":"gid://shopify/Product/6690164703329"}],"sortBy":{"isSortByEnabled":true,"categories":{"alphabeticalAToZ":{"id":"alphabeticalAToZ","label":"Alphabetical, A-Z","isEnabled":true},"alphabeticalZToA":{"id":"alphabeticalZToA","label":"Alphabetical, Z-A","isEnabled":true},"priceHighToLow":{"id":"priceHighToLow","label":"Price, High to Low","isEnabled":false},"priceLowToHigh":{"id":"priceLowToHigh","label":"Price, Low to High","isEnabled":false}}},"search":{"isSearchEnabled":true},"filterTypes":{"isFiltersEnabled":true,"categories":{},"filterRule":"OR","filterRuleAcrossCategory":"OR"},"productPageStepText":"Step 3","productPageSubtext":"Any of these take your fancy?","productPageKey":"productsData3","conditions":[],"displayVariantsAsIndividualProducts":false,"isProductsEnabled":true,"uniqueProductsData":[{"productId":"6690164703329","graphqlId":"gid://shopify/Product/6690164703329","handle":"clean-cocktail-recipe-book","variants":[{"variantId":"39658843144289","variantGraphqlId":"gid://shopify/ProductVariant/39658843144289","inventoryQuantity":444,"price":"20.00","id":"gid://shopify/ProductVariant/39658843144289"},{"variantId":"39658843177057","variantGraphqlId":"gid://shopify/ProductVariant/39658843177057","inventoryQuantity":236,"price":"20.00","id":"gid://shopify/ProductVariant/39658843177057"}],"hasOnlyDefaultVariant":false,"images":[{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/products/clean_cocktail_recipe_book_2000x2000_1bab56bd-b976-4443-97e2-4eb71c64c5a0.jpg?v=1638877518"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/products/cleanco_cocktail_book_back.jpg?v=1638952884"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/products/cleanco_cocktail_book_recipe_ingredients.jpg?v=1638952884"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/products/cleanco_cocktail_book_equipment.jpg?v=1638952884"},{"originalSrc":"https://cdn.shopify.com/s/files/1/0267/9560/6113/products/cleanco_cocktail_book_clean_margarita.jpg?v=1638952884"}],"title":"Clean Cocktails Recipe Book","tags":[],"id":"gid://shopify/Product/6690164703329"}]},"productsForBundleLink":[],"selectedProductsForBundleLink":[],"summaryPageData":{"isSummaryPageEnabled":true,"reviewPageBannerText":"You’ve made the Right Choice!","reviewPageBannerSubtext":"Review your bundle and proceed to checkout","reviewPageEmptyStateBanner":"https://d3ks0ngva6go34.cloudfront.net/giftBox/clean-liquor.myshopify.com/1710849899744.png","reviewPageEmptyStateBannerText":"","reviewPageEmptyStateBannerSubText":"","reviewPageEmptyStateBannerButtonText":"Go back to the bundle flow","customHTMLBlock":"","multiLangData":{}},"updatedAt":"2024-10-01T12:31:18.534Z","bundleUpsellConfig":{"isEnabled":false,"showOnAllBundleProducts":true,"selectedProducts":[],"showOnSpecificProductPages":[],"collectionsSelectedData":[],"showOnSpecificCollectionPages":[],"bundleWidgetText":"Save More With Bundle","bundleWidgetRedirectText":"Redirecting","useLinkProductAsDefaultProduct":false},"bundleDesignTemplate":"BUILD_FROM_SCRATCH","conditionalLogic":{"isEnabled":false,"rules":[]},"isProductSlotsEnabled":false,"bundleType":"FULLPAGE_BUNDLE"},"discountsData":{"_id":"66f415853071fa60be48f933","bundleId":"2","shopName":"clean-liquor.myshopify.com","__v":0,"createdAt":"2024-09-25T13:52:05.680Z","discountMode":"PERCENTAGE","discountTextBody":{"percentageAndFixed":{"rule1":{"text":"Add ##discountConditionDiff####discountUnit## to get ##discountValue####discountValueUnit## discount!"},"rule2":{"text":"Congrats🎉 Add ##discountConditionDiff####discountUnit## more to get ##discountValue####discountValueUnit## discount!"},"rule3":{"text":"Congrats🎉 Add ##discountConditionDiff####discountUnit## more to get ##discountValue####discountValueUnit## discount!"},"rule4":{"text":"Congrats🎉 Add ##discountConditionDiff####discountUnit## more to get ##discountValue####discountValueUnit## discount!"},"rule5":{"text":" Congrats🎉 Add ##discountConditionDiff####discountUnit## more to get ##discountValue####discountValueUnit## discount!"}},"fixedBundlePrice":{"rule1":{"text":"Add ##discountConditionDiff## product(s) to get the bundle at ##discountValueUnit####discountValue##"},"rule2":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule3":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule4":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"},"rule5":{"text":"Congrats🎉 Add ##discountConditionDiff## product(s) more to get the bundle at ##discountValueUnit####discountValue##"}}},"isDeleted":false,"isDiscountEnabled":false,"isDiscountProgressBarEnabled":false,"isKiteIntegrationEnabled":false,"isShowDiscountsEnabled":true,"rules":[],"type":"amount","updateMultiLanguage":false,"updatedAt":"2024-09-25T13:52:05.680Z"}}</script>
    <script>// comment at the first line of the file dec2024
let DEFAULT_addToCartBtnSelectorsApp4 = 'input[name="add"], button[name="add"], form[action*="/cart/add"] input[type="submit"], form[action*="/cart/add"] button[type="submit"], form[action*="/cart/add"] button:not([type="button"]), form[action*="/cart/add"] .gbb__add-to-cart';
let DEFAULT_checkoutBtnSelectorsApp4 = 'button[name="checkout"], input[name="checkout"], form[action*="/cart"] a[href="/checkout"], a[href="/checkout"], form[action="/cart"] input[type="submit"][name="checkout"], form[action="/cart"] button[type="submit"][name="checkout"]';
let DEFAULT_quantityBtnSelectorsApp4 = '.ajaxcart__qty,quantity-input .quantity,.product-form__input, .product-form__quantity ';
let DEFAULT_sideCartSelectorsApp4 = '.cart-notification,cart-notification,.cart-notification-wrapper,#cart-notification, #CartDrawer, .drawer, .drawer-cover, .Drawer';
let DEFAULT_buyNowBtnApp4 = '.shopify-payment-button__button, .shopify-payment-button__button--unbranded';
let DEFAULT_cartFormApp4 = 'form[action="/cart"], form[action="/cart/"], form[action="cart"]';

let DEFAULT_BUNDLE_IMAGE = "https://gift-box-builder-app4.s3.us-east-2.amazonaws.com/public/default_bundle_image.jpg"

let DEFAULT_scheduleDeliveryPickerSelector = ".gbbSummaryPageDeliverOrderDetailsDiv"
let DEFAULT_EMPTY_REVIEWPAGE_TEXT = "It's Lonely in here 😔"
let DEFAULT_EMPTY_REVIEWPAGE_SUBTEXT = "Tap the button to add products"
let DEFAULT_EMPTY_REVIEWPAGE_BANNER = "https://gift-box-builder-app4.s3.us-east-2.amazonaws.com/public/Empty+Gift.png"
let DEFAULT_EMPTY_REVIEWPAGE_BUTTONTEXT = "Go back to the bundle flow"

// const DEFAULT_BODY_OVERFLOW_VALUE = "";
let DEFAULT_BODY_OVERFLOW_VALUE = "";

let CONSTANT_IMAGES_DROPDOWN_BUTTON = "https://d3ks0ngva6go34.cloudfront.net/public/Keyboard+arrow+up.svg";
let CONSTANT_IMAGES_CALENDAR_ICON = "https://d3ks0ngva6go34.cloudfront.net/public/calendar.svg";
let CONSTATNT_IMAGES_FILTER_ICON = "https://gift-box-builder-app4.s3.us-east-2.amazonaws.com/public/filters_icon.png";


const ADDPRODUCT_PAGES_LIST = ["addProductsPage1", "addProductsPage2", "addProductsPage3", "addProductsPage4", "addProductsPage5", "addProductsPage6", "addProductsPage7", "addProductsPage8", "addProductsPage9", "addProductsPage10", "addProductsPage11", "addProductsPage12"]
let CONSTANT_SVG_CIRCLE = `<svg xmlns="http://www.w3.org/2000/svg"xmlns:xlink="http://www.w3.org/1999/xlink"><circle style="stroke:#006600; fill:white" cx="20" cy="20" r="12"></circle></svg>`
const STEP_SVG = ` <svg width="32" height="36" viewBox="0 0 32 36" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M17.5934 34.5608C16.8036 35.1751 15.6978 35.1751 14.9081 34.5608L1.48121 24.1177C0.519403 23.3697 0.528664 21.9129 1.4999 21.1772C2.16804 20.671 3.09271 20.6762 3.75509 21.1899L16.2507 30.8804L28.7464 21.1899C29.4087 20.6762 30.3334 20.671 31.0015 21.1772C31.9728 21.913 31.982 23.3697 31.0202 24.1177L17.5934 34.5608ZM16.2507 26.2483L1.79469 15.0047C0.668966 14.1292 0.668969 12.4277 1.79469 11.5522L14.9081 1.35288C15.6978 0.738648 16.8037 0.738649 17.5934 1.35289L30.7068 11.5522C31.8325 12.4277 31.8325 14.1292 30.7068 15.0047L16.2507 26.2483ZM16.2507 21.5236L26.9045 13.2785L16.2507 5.03333L5.59691 13.2785L16.2507 21.5236Z" fill="#232323" />
    </svg>`
const CONSTANT_ARROW_SVG = `<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
        width="24px" height="24px" viewBox="0 0 512.000000 512.000000"
        preserveAspectRatio="xMidYMid meet">
       <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
       fill="#000000" stroke="none">
       <path d="M2265 5109 c-592 -71 -1125 -334 -1540 -760 -375 -385 -598 -825
       -696 -1374 -21 -116 -24 -161 -24 -415 0 -254 3 -299 24 -415 101 -569 343
       -1031 742 -1420 385 -375 825 -598 1374 -696 116 -21 161 -24 415 -24 254 0
       299 3 415 24 276 49 483 116 720 231 246 121 448 264 654 465 399 389 641 851
       742 1420 21 116 24 161 24 415 0 254 -3 299 -24 415 -49 276 -116 483 -231
       720 -121 246 -264 448 -465 654 -389 399 -852 641 -1420 742 -97 17 -169 22
       -375 25 -140 1 -291 -2 -335 -7z m651 -1430 c36 -13 86 -62 105 -104 24 -51
       24 -109 0 -160 -11 -26 -158 -184 -415 -449 l-397 -410 109 -110 c515 -525
       687 -705 703 -741 51 -111 -16 -244 -138 -275 -36 -9 -55 -8 -98 5 -52 15 -72
       33 -535 507 -265 270 -490 509 -501 529 -22 45 -25 116 -5 162 13 33 942 999
       990 1031 49 32 120 38 182 15z"/>
       </g>
       </svg>`;

const ARROW_DOWN_SVG = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 128 128" fill="none">
<path fill-rule="evenodd" clip-rule="evenodd" d="M35.006 49.4059C36.8805 47.5314 39.9197 47.5314 41.7942 49.4059L64.0001 71.6118L86.206 49.4059C88.0805 47.5314 91.1197 47.5314 92.9942 49.4059C94.8687 51.2804 94.8687 54.3196 92.9942 56.1941L67.3942 81.7941C65.5197 83.6686 62.4805 83.6686 60.606 81.7941L35.006 56.1941C33.1315 54.3196 33.1315 51.2804 35.006 49.4059Z" fill="#4A4A4A"/>
</svg>`;

const CART_SVG = `<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M3 4.50059C3 4.00353 3.40294 3.60059 3.9 3.60059H5.83438C6.88071 3.60059 7.76448 4.37015 7.91285 5.40059H19.5C19.7507 5.40059 19.99 5.50514 20.1604 5.68908C20.3307 5.87302 20.4166 6.11966 20.3974 6.36961L19.9678 11.9537C19.8356 13.673 18.4019 15.0006 16.6775 15.0006H9.05636L9.16772 15.936C9.18568 16.087 9.31365 16.2006 9.46562 16.2006H17.1C17.5971 16.2006 18 16.6035 18 17.1006C18 17.5976 17.5971 18.0006 17.1 18.0006H9.46562C8.40184 18.0006 7.50609 17.2051 7.38034 16.1488L6.13228 5.66512C6.11432 5.51422 5.98635 5.40059 5.83438 5.40059H3.9C3.40294 5.40059 3 4.99764 3 4.50059ZM8.84207 13.2006H16.6775C17.4613 13.2006 18.113 12.5971 18.1731 11.8156L18.5281 7.20059H8.12778L8.84207 13.2006ZM12 20.4006C12 21.0633 11.4627 21.6006 10.8 21.6006C10.1373 21.6006 9.6 21.0633 9.6 20.4006C9.6 19.7378 10.1373 19.2006 10.8 19.2006C11.4627 19.2006 12 19.7378 12 20.4006ZM18 20.4006C18 21.0633 17.4627 21.6006 16.8 21.6006C16.1373 21.6006 15.6 21.0633 15.6 20.4006C15.6 19.7378 16.1373 19.2006 16.8 19.2006C17.4627 19.2006 18 19.7378 18 20.4006Z" fill="${window.tmpCartSettings2?.pageCustomizationData?.cartFooter?.cartFooterNextButtonTextColor || "#ffffff"}"/>
</svg>`

const CONSTANT_CLOSE_ICON_SVG = `<svg fill="${window.tmpCartSettings2?.pageCustomizationData?.generalSettings?.icon?.iconBgColor || "black"}" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 26 26" width="16px" height="16px"
style="background: ${window.tmpCartSettings2?.pageCustomizationData?.generalSettings?.icon?.iconTextColor || "white"}; border-radius: 50%; "><path d="M 13 0.1875 C 5.925781 0.1875 0.1875 5.925781 0.1875 13 C 0.1875 20.074219 5.925781 25.8125 13 25.8125 C 20.074219 25.8125 25.8125 20.074219 25.8125 13 C 25.8125 5.925781 20.074219 0.1875 13 0.1875 Z M 18.78125 17.394531 L 17.390625 18.78125 C 17.136719 19.035156 16.722656 19.035156 16.46875 18.78125 L 13 15.3125 L 9.53125 18.78125 C 9.277344 19.035156 8.863281 19.035156 8.609375 18.777344 L 7.21875 17.394531 C 6.96875 17.136719 6.96875 16.726563 7.21875 16.46875 L 10.6875 13 L 7.222656 9.535156 C 6.96875 9.277344 6.96875 8.863281 7.222656 8.609375 L 8.609375 7.222656 C 8.863281 6.964844 9.28125 6.964844 9.535156 7.222656 L 13 10.6875 L 16.46875 7.222656 C 16.722656 6.964844 17.140625 6.964844 17.390625 7.222656 L 18.78125 8.605469 C 19.035156 8.863281 19.035156 9.277344 18.78125 9.535156 L 15.3125 13 L 18.78125 16.46875 C 19.03125 16.726563 19.03125 17.136719 18.78125 17.394531 Z"/></svg>`

const SEARCH_ICON_SVG = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M9.5 3C11.2239 3 12.8772 3.68482 14.0962 4.90381C15.3152 6.12279 16 7.77609 16 9.5C16 11.11 15.41 12.59 14.44 13.73L14.71 14H15.5L20.5 19L19 20.5L14 15.5V14.71L13.73 14.44C12.5504 15.4465 11.0506 15.9996 9.5 16C7.77609 16 6.12279 15.3152 4.90381 14.0962C3.68482 12.8772 3 11.2239 3 9.5C3 7.77609 3.68482 6.12279 4.90381 4.90381C6.12279 3.68482 7.77609 3 9.5 3ZM9.5 5C7 5 5 7 5 9.5C5 12 7 14 9.5 14C12 14 14 12 14 9.5C14 7 12 5 9.5 5Z" fill="black"/>`

const PLAIN_CHEVRON_UP_SVG = `<svg width="25" height="25" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M6.23966 11.7996C6.5432 12.0814 7.01775 12.0639 7.2996 11.7603L10 8.85221L12.7004 11.7603C12.9823 12.0639 13.4568 12.0814 13.7603 11.7996C14.0639 11.5177 14.0815 11.0432 13.7996 10.7397L10.5496 7.23966C10.4077 7.08683 10.2086 7 10 7C9.79145 7 9.59232 7.08683 9.45041 7.23966L6.20041 10.7397C5.91856 11.0432 5.93613 11.5177 6.23966 11.7996Z" fill="#4A4A4A"/>
</svg>`

var gbbUtils = {
    f: {}
}
window.gbbUtils = gbbUtils;
//console.log


/*
*fn(param1, param2) =>
*param1 is url of script that we suppose to load
*param2 is function that should be called after script is loaded
*/


gbbUtils.f.loadScript = function (a, b) {
    var c = document.createElement("script");
    c.type = "text/javascript";
    c.src = a;
    document.getElementsByTagName("head")[0].appendChild(c)
    c.onload = function () { b() };
};

/*
* we changed loadScript function - if else block for onload is removed as it was not making sense
*fn(param1) =>
*param1 - represents function that should be executed once jquery is loaded
*https://www.w3schools.com/jquery/jquery_noconflict.asp
*/

gbbUtils.f.loadJquery = function (b) {
    gbb.utility.debugConsole("Load JQuery");
    let flag = false;
    if ("undefined" === typeof jQuery || 3.1 > parseFloat(jQuery.fn.jquery)) {
        flag = true;
    }
    if ("undefined" != typeof jQuery && jQuery.post == undefined) {
        flag = true;
    }

    if (flag) {
        gbbUtils.f.loadScript("https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js", function () {
            gbbJquery = jQuery.noConflict(!0);
            b(gbbJquery)
        })
    } else {
        b(jQuery);
    }
};


var gbb = {
    debug: [],
    version: 1.2,
    state: {
        cachedProductData: new Map(),
        cachedProductDataGraphql: new Map(),
        bundleId: "",
        bundleName: "",
        activeBoxId: "",
        submitted: "",
        product_added: "",
        page_type: "",
        insertWrapperOnPage: [],
        cartData: undefined,
        isOverWriteBuyNowBtnTriggered: false,
        timer: undefined,
        freeGiftcardPopupModalTriggered: false,
        atleastOneProduct: {},
        pageHistory: [],
        greetingCardActiveImageSrc: "",
        navigationItems: [],
        currentPageId: "",
        giftBoxCartData: undefined,
        currentFilteredProducts: [], //products state of filteredProducts
        currentChooseGiftBoxProductsState: [],
        scrollPoisitionAfterPageChange: 70,
        gbbUrl: "gbb",
        addProductsFilters: {
            isFiltersActive: false,
            activatedFilters: [],
            allFilters: [],
            priceFilterActive: false,
            minPriceValue: "",
            maxPriceValue: ""
        },
        addProductsSortBy: {
            isSortByEnabled: false,
            sortByCategories: [],
            sortByValue: ""
        },
        setInfiniteScrollTrackerForProducts: true,
        navItemsViewPerPage: 5,
        // productsPerBatch : 300, //used in prefetch
        currentFlow: "",
        variantCustomProperties: {},
        storeCurrencySymbol: undefined,
        currentModalProductData: {},
        CONSTANT_DEBUG_FLAG: undefined,
        languageMode: "",
        giftMessageProductInActiveSession: [],
    },
    constants: {
        themesIds: {
            DAWN_THEME: 887,
            VENTURE_THEME: 775,
            EXPRESS_THEME: 885,
            CRAVE_THEME: 1363,
            SENSE_THEME: 1356,
            CRAFT_THEME: 1368,
        }
    },
    importExternalScript: async function (scriptName) {
        let scriptUrl = "";
        switch (scriptName) {
            case "date-flatpickr":
                scriptUrl = "https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.js"
                break;
            case "selfHosted-date-flatpickr":
                scriptUrl = "https://d3ks0ngva6go34.cloudfront.net/storefront/S3-flatpickr.min.js";
                break;
        }
        await new Promise(function (resolve, reject) {
            try {
                // document.body.appendChild(document.createElement('script')).src = url;
                const script = document.createElement('script');
                script.src = scriptUrl;
                console.time(`${scriptName}-onLoad`)
                // script.async = true;
                //attach a link tag for css
                // var link = document.createElement('link');
                // link.rel = 'stylesheet';
                // link.href = 'https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css';
                // document.head.appendChild(link);
                //delay the resolve by 1 second
                //resolve after it has been loaded
                script.onload = function () {
                    console.timeEnd(`${scriptName}-onLoad`)
                    gbb.utility.debugConsole(scriptName, "loaded");
                    gbb.utility.debugConsole("FlatPickrObj", flatpickr);
                    resolve();
                }
                document.body.appendChild(script);
            } catch (e) {
                gbb.utility.triggerSlackNotification(e);
                gbb.utility.debugConsole(scriptName, "error in importing", e);
                reject();
            }
        });
    },
    settings: {}, //object from function
    selectors: {},
    cartInterval: "",
    productinterval: "",
    f: {
        bootstrap: function (settings) {
            gbb.utility.debugConsole("bootstap?");
            gbb.f.initThemeCSS();
            gbb.f.globalListener(settings)
        },
        initThemeCSS: function () {
            // gbb.utility.debugConsole("initThemeCSS?", gbb.selectors.addToCart);
            let addToCartBtnEle = gbb.$(document).find(gbb.selectors.addToCart)
            let checkoutBtnEle = gbb.$(document).find(gbb.selectors.checkoutBtn)

            let buttonToOverRide = gbb.$(addToCartBtnEle).length > 0 ? addToCartBtnEle : checkoutBtnEle;

            if (gbb.settings.app.themeFontFamily == "" && gbb.$("body").length > 0) {
                gbb.settings.app.themeFontFamily = gbb.$("body").css("font-family");
                gbb.$(".gbbPageBody").css("font-family", gbb.settings.app.themeFontFamily);
            }

            if (gbb.settings.app.themeFontFamily && gbb.$("body").length > 0) {
                gbb.$(".gbbPageBody").css("font-family", gbb.settings.app.themeFontFamily);
            }
            //find the font color of the theme
            if (gbb.settings.app.themeFontColor == "" && gbb.$("p").length > 0) {
                gbb.settings.app.themeFontColor = gbb.$("p").css("color");
            }
            //theme background color
            if (gbb.settings.app.themeBackgroundColor == "" && gbb.$("body").length > 0) {
                gbb.settings.app.themeBackgroundColor = gbb.$("body").css("background-color");
            }
            if (gbb.settings.app.themeLabelFontColor == "" && gbb.$("label").length > 0) {
                gbb.settings.app.themeLabelFontColor = gbb.$("label").css("color");
            }
            // themeLabelFontFamily
            if (gbb.settings.app.themeLabelFontFamily == "" && gbb.$("label").length > 0) {
                gbb.settings.app.themeLabelFontFamily = gbb.$("label").css("font-family");
            }
            if (gbb.settings.app.themeButtonBackgroundColor == "" && gbb.$(buttonToOverRide).length > 0) {
                gbb.settings.app.themeButtonBackgroundColor = gbb.$(buttonToOverRide).css("background-color");
            }
            if (gbb.settings.app.themButtonTextColor == "" && gbb.$(buttonToOverRide).length > 0) {
                gbb.settings.app.themButtonTextColor = gbb.$(buttonToOverRide).css("color");
            }
            if (gbb.settings.app.themeButtonBorderColor == "" && gbb.$(buttonToOverRide).length > 0) {
                gbb.settings.app.themeButtonBorderColor = gbb.$(buttonToOverRide).css("border-color");
            }
            //box shadow
            if (gbb.settings.app.themeButtonBoxShadow == "" && gbb.$(buttonToOverRide).length > 0) {
                gbb.settings.app.themeButtonBoxShadow = gbb.$(buttonToOverRide).css("box-shadow");
            }
            // button font family
            if (gbb.settings.app.themeButtonFontFamily == "" && gbb.$(buttonToOverRide).length > 0) {
                gbb.settings.app.themeButtonFontFamily = gbb.$(buttonToOverRide).css("font-family");
            }
            if (gbb.settings.app.themeHeaderFontFamily == "" && gbb.$("h1").length > 0) {
                gbb.settings.app.themeHeaderFontFamily = gbb.$("h1").css("font-family");
            }
            if (gbb.settings.app.themeHeaderFontColor == "" && gbb.$("h1").length > 0) {
                gbb.settings.app.themeHeaderFontColor = gbb.$("h1").css("color");
            }

        },

        applyFontToProductPopupCard: function () {
            if (gbb.settings.app.themeFontFamily == "" && gbb.$("body").length > 0) {
                gbb.settings.app.themeFontFamily = gbb.$("body").css("font-family");
                gbb.$(".gbbProductVariantModalContainer").css("font-family", gbb.settings.app.themeFontFamily);
            }
            if (gbb.settings.app.themeFontFamily && gbb.$("body").length > 0) {
                gbb.$(".gbbProductVariantModalContainer").css("font-family", gbb.settings.app.themeFontFamily);
            }
        },
        applyFontToFiltersSidebar: function () {
            if (gbb.settings.app.themeFontFamily == "" && gbb.$("body").length > 0) {
                gbb.settings.app.themeFontFamily = gbb.$("body").css("font-family");
                gbb.$(".gbbProductsFiltersContainer").css("font-family", gbb.settings.app.themeFontFamily);
            }

            if (gbb.settings.app.themeFontFamily && gbb.$("body").length > 0) {
                gbb.$(".gbbProductsFiltersContainer").css("font-family", gbb.settings.app.themeFontFamily);
            }
        },
        applyFontToFooterCartPopup: function () {
            if (gbb.settings.app.themeFontFamily == "" && gbb.$("body").length > 0) {
                gbb.settings.app.themeFontFamily = gbb.$("body").css("font-family");
                gbb.$(".gbbCartProductsContainerModal").css("font-family", gbb.settings.app.themeFontFamily);
            }

            if (gbb.settings.app.themeFontFamily && gbb.$("body").length > 0) {
                gbb.$(".gbbCartProductsContainerModal").css("font-family", gbb.settings.app.themeFontFamily);
            }
        },
        applyFontToPreparingBundlePopup: function () {
            if (gbb.settings.app.themeFontFamily && gbb.$("body").length > 0) {
                gbb.$(".gbbPreparingBundleContainerModal").css("font-family", gbb.settings.app.themeFontFamily);
            }
        },
        applyFontToUnavailableProductsPopup: function () {
            if (gbb.settings.app.themeFontFamily && gbb.$("body").length > 0) {
                gbb.$(".gbbUnavailableProductsContainerModal").css("font-family", gbb.settings.app.themeFontFamily);
            }
        },
        getSettings: async function () {

            try {
                //promise

                //find the / next to apps from the url

                let url = window.location.href;
                let pathname = window.location.pathname;

                // extract the variable after apps in the url
                try {
                    if (url) {
                        let gbbUrl = url?.split("/apps/")[1];

                        //split it by the next /
                        gbbUrl = gbbUrl.split("/")[0];

                        if (pathname) {
                            //last ele of pathname
                            let eleArr = pathname.split("/");
                            if (eleArr.length > 0) {
                                let lastEle = eleArr[eleArr.length - 1];
                                gbb.state.bundleId = lastEle;
                            }
                        }


                        gbb.state.gbbUrl = gbbUrl;
                    }

                } catch (e) {
                    gbb.utility.debugError(e);
                }

                if (!gbb.state.bundleId) {
                    // lets read it from the query params
                    // from the query params, the key is going to be 
                    // easybundle=1;
                    //and gbbId = gbb or gbb-1 or gbb-2
                    let urlParams = new URLSearchParams(window.location.search);

                    let bundleId = urlParams.get('easybundle');
                    let gbbUrl = urlParams.get('gbbId') || "gbb"

                    if (bundleId && gbbUrl) {
                        gbb.state.bundleId = bundleId;
                        gbb.state.gbbUrl = gbbUrl
                    }

                }


                // gbb.utility.debugConsole("GET setting of giftlab pro fired")
                // return new Promise(function (resolve, reject) {
                //     //  fetch("https://gift101.pagekite.me/api/cartSettings/get?shopName=abhishek-devlopment-store.myshopify.com",{
                // 	// fetch("https://gbb104.pagekite.me/api/cartSettings/get?shopName=staging-testing-107.myshopify.com",{
                // 	// fetch("https://zurakite.pagekite.me/api/cartSettings/get?shopName=rafaths-dev-store.myshopify.com",

                //     // fetch(`apps/${gbbUrl}/getGlobalData`,{


                // })
                if (window.tmpCartSettings2) {
                    return window.tmpCartSettings2 //TBD
                } else {
                    gbb.utility.debugConsole("tmpCartSettings2 not found");
                    let promiseData = await new Promise((resolve, reject) => {

                        fetch(`/apps/${gbb.state.gbbUrl}/getGlobalData?bundleId=${gbb.state.bundleId}`, {
                            method: 'GET',
                        })
                            .then(response => response.json())
                            .then(success => {
                                if (success.responseCode === 200) {
                                    gbb.utility.debugConsole("success-data:", success.data);
                                    resolve(success.data);
                                } else {
                                    reject(new Error("Unexpected response code."));
                                }
                            })
                            .catch(error => {
                                gbb.utility.debugError(error);
                                reject(error);
                            });
                    });
                    return promiseData;
                }
            } catch (e) {
                gbb.utility.debugError(e);
            }


        },
        pageCustomizationInit: function (tmpCartSettings) {
            try {
                let pageCustomizationData = {
                    banners: {
                        landingPageImageSrc: tmpCartSettings.pageCustomizationData.banners.landingPageImageSrc || "https://d3ks0ngva6go34.cloudfront.net/public/banners/landing_page_banner.jpg",
                        pageBannerImageSrc: tmpCartSettings.pageCustomizationData.banners.pageBannerImageSrc || "https://d3ks0ngva6go34.cloudfront.net/public/banners/page_banner.png",
                        productReviewImageSrc: tmpCartSettings.pageCustomizationData.banners.productReviewImageSrc || "https://d3ks0ngva6go34.cloudfront.net/public/banners/review-page_banner.jpg",
                    },
                    colors: {
                        "primaryColor": tmpCartSettings.pageCustomizationData.colors.primaryColor,
                        "secondaryColor": tmpCartSettings.pageCustomizationData.colors.secondaryColor,
                        "textColor": tmpCartSettings.pageCustomizationData.colors.textColor,
                        "disabledColor": tmpCartSettings.pageCustomizationData.colors.disabledColor,
                        "productBox": tmpCartSettings.pageCustomizationData.colors.productBox,
                    },
                    primaryFont: tmpCartSettings.pageCustomizationData.primaryFont,
                    landingPage: {
                        landingPageTextColor: tmpCartSettings.pageCustomizationData.landingPage.landingPageTextColor,
                        landingPageButtonBgColor: tmpCartSettings.pageCustomizationData.landingPage.landingPageButtonBgColor,
                        landingPageButtonTextColor: tmpCartSettings.pageCustomizationData.landingPage.landingPageButtonTextColor,
                    },
                    cartFooter: {
                        cartFooterBgColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterBgColor,
                        cartFooterButtonsContainerBgColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterButtonsContainerBgColor,
                        cartFooterBorderRadius: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterBorderRadius,
                        cartFooterProductImageBorderRadius: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterProductImageBorderRadius,
                        cartFooterButtonsContainerBorderRadius: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterButtonsContainerBorderRadius,
                        cartFooterShowHidePrices: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterShowHidePrices == "Hide" ? "hidden" : "visible",
                        cartFooterTextColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterTextColor,
                        cartFooterStrikethroughPriceColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterDiscountedPriceColor,
                        cartFooterFinalPriceFontColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterFinalPriceFontColor,
                        cartFooterFinalPriceFontThickness: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterFinalPriceFontThickness,
                        cartFooterStrikethroughPriceFontThickness: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterStrikethroughPriceFontThickness,
                        cartFooterBackButtonColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterBackButtonColor,
                        cartFooterBackButtonTextColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterBackButtonTextColor,
                        cartFooterBackButtonBorderColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterBackButtonBorderColor,
                        cartFooterBackButtonBorderThickness: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterBackButtonBorderThickness,
                        cartFooterNextButtonTextColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterNextButtonTextColor,
                        cartFooterNextButtonColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterNextButtonColor,
                        cartFooterNextButtonBorderColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterNextButtonBorderColor,
                        cartFooterNextButtonBorderThickness: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterNextButtonBorderThickness,
                        cartFooterButtonsBorderRadius: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterButtonsBorderRadius,
                        cartFooterButtonsPadding: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterButtonsPadding,
                        cartFooterDiscountTextColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterDiscountTextColor,
                        cartFooterDiscountProgressBarEmptyColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterDiscountProgressBarEmptyColor,
                        cartFooterDiscountProgressBarFilledColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterDiscountProgressBarFilledColor,
                        cartFooterButtonsContainerBgColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterButtonsContainerBgColor,
                        cartFooterDiscountTextVisibility: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterDiscountTextVisibility == "Hide" ? "hidden" : "visible",
                        cartFooterTotalLabelColor: tmpCartSettings?.pageCustomizationData?.cartFooter?.cartFooterTotalLabelColor,
                    },
                    productCard: {
                        productCardBgColor: tmpCartSettings?.pageCustomizationData?.productCard?.productCardBgColor,
                        productCardBorderRadius: tmpCartSettings?.pageCustomizationData?.productCard?.cardBorderRadius,
                        productCardImageBorderRadius: tmpCartSettings?.pageCustomizationData?.productCard?.cardImageBorderRadius,
                        productCardImageFit: tmpCartSettings?.pageCustomizationData?.productCard?.productImageFit,
                        productCardPerRowXtraLargeScreen: tmpCartSettings?.pageCustomizationData?.productCard?.cardsPerRowXL,
                        productCardPerRowLargeScreen: tmpCartSettings?.pageCustomizationData?.productCard?.cardsPerRowL,
                        productCardTextColor: tmpCartSettings?.pageCustomizationData?.productCard?.productCardTextColor,
                        productCardTitleFontSize: tmpCartSettings?.pageCustomizationData?.productCard?.productTitleFontSize,
                        productCardTitleFontWeight: tmpCartSettings?.pageCustomizationData?.productCard?.productTitleFontWeight,
                        productCardFinalPriceVisibility: tmpCartSettings?.pageCustomizationData?.productCard?.productPriceVisibility == "Hide" ? "none" : "block",
                        productCardCompareAtPriceFontColor: tmpCartSettings?.pageCustomizationData?.productCard?.compareAtPriceColor,
                        productCardCompareAtPriceFontSize: tmpCartSettings?.pageCustomizationData?.productCard?.compareAtPriceFontSize,
                        productCardCompareAtPriceFontWeight: tmpCartSettings?.pageCustomizationData?.productCard?.compareAtPriceFontWeight,
                        productCardCompareAtPriceVisibility: tmpCartSettings?.pageCustomizationData?.productCard?.compareAtPriceVisibility == "Hide" ? "none" : "block",
                        productCardFinalPriceFontSize: tmpCartSettings?.pageCustomizationData?.productCard?.finalPriceFontSize,
                        productCardFinalPriceFontColor: tmpCartSettings?.pageCustomizationData?.productCard?.finalPriceFontColor,
                        productCardFinalPriceFontWeight: tmpCartSettings?.pageCustomizationData?.productCard?.finalPriceFontWeight,
                        productCardButtonColor: tmpCartSettings?.pageCustomizationData?.productCard?.productCardButtonColor,
                        productCardButtonTextColor: tmpCartSettings?.pageCustomizationData?.productCard?.productCardButtonTextColor,
                        productCardButtonBorderRadius: tmpCartSettings?.pageCustomizationData?.productCard?.buttonBorderRadius,
                        productCardAllowOnlyOneQuantity: !tmpCartSettings?.pageCustomizationData?.productCard?.allowOnlyOneQuantity ? "block" : "none",
                        productCardQuantitySelectorBgColor: tmpCartSettings?.pageCustomizationData?.productCard?.productCardQuantitySelectorBgColor,// btns wrapper color
                        productCardQuantitySelectorBtnsBgColor: tmpCartSettings?.pageCustomizationData?.productCard?.quantitySelectorBgColor, // btns color
                        productCardQuantitySelectorButtonTextColor: tmpCartSettings?.pageCustomizationData?.productCard?.quantitySelectorButtonTextColor,
                        productCardQuantitySelectorTextColor: tmpCartSettings?.pageCustomizationData?.productCard?.quantitySelectorTextColor,
                        productCardQuantitySelectorBorderRadius: tmpCartSettings?.pageCustomizationData?.productCard?.quantitySelectorButtonBorderRadius,
                    },
                    previewPage: {
                        bannerTextColor: tmpCartSettings?.pageCustomizationData?.productCard?.bannerTextColor,
                    },
                    navigationBanner: {
                        navigationBannerTitleColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerTitleColor,
                        navigationBannerTextColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerTextColor,
                        navigationBannerStepCompletionColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepCompletionColor,
                        navigationBannerStepDoneColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepDoneColor,
                        navigationBannerStepTextColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepTextColor || "",
                        navigationBannerStepProgressBarFilledColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepProgressBarFilledColor,
                        navigationBannerStepProgressBarEmptyColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepProgressBarEmptyColor,
                        navigationBannerStepTextFontSize: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepFontSize,
                        navigationBannerCheckColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationCheckColor,
                        navigationBannerStepCompletedBorderColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepCompletedBorderColor,
                        navigationBannerStepCompletedBorderWidth: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepCompletedBorderWidth,
                        navigationBannerStepIncompleteBgColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepIncompleteBgColor,
                        navigationBannerStepIncompleteBorderColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepIncompleteBorderColor,
                        navigationBannerStepIncompleteBorderWidth: tmpCartSettings?.pageCustomizationData?.navigationBanner?.navigationBannerStepIncompleteBorderWidth,
                        navigationBannerTabsActiveBgColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsActiveBgColor,
                        navigationBannerTabsActiveTextColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsActiveTextColor,
                        navigationBannerTabsInactiveBgColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsInactiveBgColor,
                        navigationBannerTabsInactiveTextColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsInactiveTextColor,
                        navigationBannerTabsBorderColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsBorderColor,
                        navigationBannerTabsCornerRadius: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsCornerRadius
                    },
                    summaryBlock: {
                        summaryBlockBgColor: tmpCartSettings.pageCustomizationData.summaryBlock.summaryBlockBgColor,
                        summaryBlockTextColor: tmpCartSettings.pageCustomizationData.summaryBlock.summaryBlockTextColor,
                        summaryBlockAddToCartButtonColor: tmpCartSettings.pageCustomizationData.summaryBlock.summaryBlockAddToCartButtonColor,
                        summaryBlockAddToCartButtonTextColor: tmpCartSettings.pageCustomizationData.summaryBlock.summaryBlockAddToCartButtonTextColor,
                        summaryBlockBackButtonColor: tmpCartSettings.pageCustomizationData.summaryBlock.summaryBlockBackButtonColor,
                        summaryBlockBackButtonTextColor: tmpCartSettings.pageCustomizationData.summaryBlock.summaryBlockBackButtonTextColor,
                    },
                    categoryBlock: {
                        categoryBgColor: tmpCartSettings.pageCustomizationData?.categoryBlock?.categoryBgColor,
                        tabActiveBgColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsActiveBgColor || tmpCartSettings.pageCustomizationData?.categoryBlock?.tabActiveBgColor,
                        tabActiveTextColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsActiveTextColor || tmpCartSettings.pageCustomizationData?.categoryBlock?.tabActiveTextColor,
                        tabInactiveBgColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsInactiveBgColor || tmpCartSettings.pageCustomizationData?.categoryBlock?.tabInactiveBgColor,
                        tabInactiveTextColor: tmpCartSettings?.pageCustomizationData?.navigationBanner?.tabsInactiveTextColor || tmpCartSettings.pageCustomizationData?.categoryBlock?.tabInactiveTextColor,
                    },
                    quickSettings: {
                        isQuickSettingsEnabled: true,
                        colors: {
                            primaryColor: tmpCartSettings.pageCustomizationData?.quickSettings?.colors?.primaryColor,
                            buttonBgColor: tmpCartSettings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor,
                            buttonTextColor: tmpCartSettings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor,
                        }
                    },
                    generalSettings: {
                        conditionToast: {
                            conditionToastBgColor: tmpCartSettings.pageCustomizationData?.generalSettings?.conditionToastBgColor || tmpCartSettings.pageCustomizationData?.generalSettings?.conditionToast?.conditionToastBgColor,
                            conditionToastTextColor: tmpCartSettings.pageCustomizationData?.generalSettings?.conditionToastTextColor || tmpCartSettings.pageCustomizationData?.generalSettings?.conditionToast?.conditionToastTextColor,
                        },
                        scrollBar: {
                            scrollBarColor: tmpCartSettings.pageCustomizationData?.generalSettings?.scrollBarColor || tmpCartSettings.pageCustomizationData?.generalSettings?.scrollBar?.scrollBarColor || "black",
                        },
                        icon: {
                            iconTextColor: tmpCartSettings.pageCustomizationData?.generalSettings?.iconTextColor || tmpCartSettings.pageCustomizationData?.generalSettings?.icon?.iconTextColor || false,
                            iconBgColor: tmpCartSettings.pageCustomizationData?.generalSettings?.iconBgColor || tmpCartSettings.pageCustomizationData?.generalSettings?.icon?.iconBgColor || false,
                            iconColor: tmpCartSettings.pageCustomizationData?.generalSettings?.iconColor || tmpCartSettings.pageCustomizationData?.generalSettings?.icon?.iconColor || false
                        },
                        productPage: {
                            productPageTitleColor: tmpCartSettings.pageCustomizationData?.generalSettings?.productPageTitleColor || tmpCartSettings.pageCustomizationData?.generalSettings?.productPage?.productPageTitleColor || ""
                        },
                        bundle: {
                            bundleBgColor: tmpCartSettings.pageCustomizationData?.generalSettings?.bundleBgColor || tmpCartSettings.pageCustomizationData?.generalSettings?.bundle?.bundleBgColor || null,
                            applyNewPageCustomization: tmpCartSettings.pageCustomizationData?.generalSettings?.applyNewPageCustomization || false
                        }

                    },

                }
                return pageCustomizationData
            } catch (error) {
                gbb.utility.debugError("error in pageCustomizationInit", error);
            }
        },
        setSettings: function (tmpCartSettings) {

            tmpCartSettings = gbb.f.modifySettings(tmpCartSettings)

            var cart_settings = {
                pageCustomizationData: gbb.f.pageCustomizationInit(tmpCartSettings),
                giftwrap: {
                    isGiftWrapEnabled: tmpCartSettings.stepsConfigurationData?.personalizationData?.giftwrap?.isGiftWrapEnabled || false,
                    isGiftWrapEnabledOnPage: tmpCartSettings.stepsConfigurationData?.personalizationData?.giftwrap?.isGiftWrapEnabledOnPage || false,
                    productId: tmpCartSettings.stepsConfigurationData.personalizationData?.giftwrap?.giftwrapProduct?.productId || "",
                    productHandle: tmpCartSettings.stepsConfigurationData.personalizationData?.giftwrap?.giftwrapProduct?.handle || "",
                    productVariants: tmpCartSettings.stepsConfigurationData.personalizationData?.giftwrap?.giftwrapProduct?.variants || [],
                    giftWrapShopifyImgUrl: tmpCartSettings.stepsConfigurationData.personalizationData?.giftwrap?.giftwrapProduct?.images[0]?.src,
                },
                greetingCard: {
                    isGreetingCardEnabled: tmpCartSettings.stepsConfigurationData.personalizationData?.greetingCard?.isGreetingCardEnabled || false,
                    greetingCardProducts: tmpCartSettings.stepsConfigurationData.personalizationData?.greetingCard?.products || [],
                    productId: tmpCartSettings.stepsConfigurationData.personalizationData?.greetingCard?.greetingCardProduct?.productId || "",
                    productHandle: tmpCartSettings.stepsConfigurationData.personalizationData?.greetingCard?.greetingCardProduct?.handle || "",
                    productVariants: tmpCartSettings.stepsConfigurationData.personalizationData?.greetingCard?.greetingCardProduct?.variants || {},
                },
                giftMessage: tmpCartSettings.stepsConfigurationData.personalizationData?.giftMessage || {},
                customerUploads: tmpCartSettings.stepsConfigurationData.personalizationData?.customerUploads || {},
                videoMessage: tmpCartSettings.stepsConfigurationData.personalizationData?.giftMessage || {},
                giftAddons: tmpCartSettings.stepsConfigurationData.personalizationData?.giftAddons || {},
                scheduleDelivery: tmpCartSettings.stepsConfigurationData.personalizationData?.scheduleDelivery || {},
                addonProducts:gbb.gbbAddonProducts.f.addonProductsInit(tmpCartSettings),
                // deliveryScheduler: tmpCartSettings.stepsConfigurationData.personalizationData?.deliveryScheduler || {},

                stepsConfigurationData: tmpCartSettings.stepsConfigurationData || {},
                discountsData: tmpCartSettings.discountsData || {},
                //TODO: remove server url from here and also remove http in fetch call
                SERVER_URL: tmpCartSettings?.userData.SERVER_URL || "localhost:3001",
                app: {
                    disableApp: tmpCartSettings.userData.customSettings.disableApp || false,
                    disableSideCart: tmpCartSettings.userData.customSettings.disableSideCart || false,
                    refreshProductPageOnGiftWrap: tmpCartSettings.userData.customSettings.refreshProductPageOnGiftWrap || false,
                    addToCartBtnSelectors: tmpCartSettings.userData.customSettings.addToCartBtnSelectors || DEFAULT_addToCartBtnSelectorsApp4,
                    checkoutBtnSelectors: tmpCartSettings.userData.customSettings.checkoutBtnSelectors || DEFAULT_checkoutBtnSelectorsApp4,
                    quantityBtnSelectors: tmpCartSettings.userData.customSettings.quantityBtnSelectors || DEFAULT_quantityBtnSelectorsApp4,
                    sideCartSelectors: tmpCartSettings.userData.customSettings.sideCartSelectors || DEFAULT_sideCartSelectorsApp4,
                    themeBackgroundColor: tmpCartSettings.userData.customSettings.themeBackgroundColor || "",

                    //themeFontFamily: tmpCartSettings.userData.customSettings.themeFontFamily || "",
                    themeFontFamily: tmpCartSettings.pageCustomizationData.primaryFont || "",
                    themeFontColor: tmpCartSettings.userData.customSettings.themeFontColor || "",

                    themeButtonBackgroundColor: tmpCartSettings.userData.customSettings.themeButtonBackgroundColor || "",
                    themButtonTextColor: tmpCartSettings.userData.customSettings.themButtonTextColor || "",
                    themeButtonBorderColor: tmpCartSettings.userData.customSettings.themeButtonBorderColor || "",
                    themeButtonBoxShadow: tmpCartSettings.userData.customSettings.themeButtonBoxShadow || "",
                    //button font family
                    themeButtonFontFamily: tmpCartSettings.userData.customSettings.themeButtonFontFamily || "",

                    themeHeaderFontFamily: tmpCartSettings.userData.customSettings.themeHeaderFontFamily || "",
                    themeHeaderFontColor: tmpCartSettings.userData.customSettings.themeHeaderFontColor || "",

                    themeLabelFontColor: tmpCartSettings.userData.customSettings.themeLabelFontColor || "",
                    themeLabelFontFamily: tmpCartSettings.userData.customSettings.themeLabelFontFamily || "",

                    buyNowBtn: tmpCartSettings.userData.customSettings.buyNowBtn || DEFAULT_buyNowBtnApp4,
                    cartForm: tmpCartSettings.userData.customSettings.cartForm || DEFAULT_cartFormApp4,
                    addAfterAddTocartBtn: tmpCartSettings.userData.customSettings.addAfterAddTocartBtn || false,
                    addAftercheckoutBtn: tmpCartSettings.userData.customSettings.addAftercheckoutBtn || false,
                    customStyle: tmpCartSettings.userData.customSettings.customStyle || null,

                    scheduleDeliveryPickerSelector: tmpCartSettings.userData.customSettings.scheduleDeliveryPickerSelector || DEFAULT_scheduleDeliveryPickerSelector,

                    redirectUrlForCheckoutBtn: tmpCartSettings.userData?.customSettings?.redirectUrlForCheckoutBtn ? window.location.origin + tmpCartSettings.userData.customSettings.redirectUrlForCheckoutBtn : window.location.origin + "/cart/checkout",
                    redirectToScript: tmpCartSettings.userData?.customSettings?.redirectToScript ? tmpCartSettings.userData.customSettings.redirectToScript : "",
                    redirectToCheckoutEnabled: tmpCartSettings.userData?.customSettings?.redirectToCheckoutEnabled ? tmpCartSettings.userData.customSettings.redirectToCheckoutEnabled : false,
                    redirectToCartEnabled: tmpCartSettings.userData?.customSettings?.redirectToCartEnabled ? tmpCartSettings.userData.customSettings.redirectToCartEnabled : false,

                    loadingBgColor: tmpCartSettings.userData?.customSettings?.loadingBgColor ? tmpCartSettings.userData.customSettings.loadingBgColor : "#ffffff",
                    stackDiscounts: tmpCartSettings.userData?.customSettings?.stackDiscounts ? tmpCartSettings.userData.customSettings.stackDiscounts : false,
                    // isInfiniteScrollEnabled: tmpCartSettings.userData?.customSettings?.isInfiniteScrollEnabled ? tmpCartSettings.userData.customSettings.isInfiniteScrollEnabled : false,
                    isInfiniteScrollEnabled: true,
                    // conditionalLogicFilterOnFirstPageAswell: tmp
                    productHandlesAreTranslated: tmpCartSettings.userData?.customSettings?.productHandlesAreTranslated ? tmpCartSettings.userData.customSettings.productHandlesAreTranslated : false,
                    addGiftMessageToNote: tmpCartSettings.userData?.customSettings?.addGiftMessageToNote ? tmpCartSettings.userData.customSettings.addGiftMessageToNote : false,
                    addBoxQuantityToProperties: tmpCartSettings.userData?.customSettings?.addBoxQuantityToProperties ? tmpCartSettings.userData.customSettings.addBoxQuantityToProperties : false,
                    enableStoreFrontGQLAPI: localStorage?.getItem("enableSF") || tmpCartSettings.userData?.customSettings?.enableStoreFrontGQLAPI || false,
                    dynamicScriptForHTMLContent: tmpCartSettings.userData?.customSettings?.dynamicScriptForHTMLContent || "",
                    integrations: {
                        judgeme: {
                            isEnabled: tmpCartSettings.userData.customSettings?.integrations?.judgeme?.isEnabled || false,
                            public_token: tmpCartSettings.userData.customSettings?.integrations?.judgeme?.public_token || "",
                        }
                    },
                },
                bundleSettings: {
                    ...tmpCartSettings.userData.bundleSettings,
                    metafieldNameSpaceAndKeys: tmpCartSettings.userData.bundleSettings?.metafieldNameSpaceAndKeys || [],
                    conditionalLogicFilterOnFirstPageAswell: tmpCartSettings.userData.bundleSettings?.conditionalLogicFilterOnFirstPageAswell || false,
                    builderPageSeoData: tmpCartSettings.userData.bundleSettings?.builderPageSeoData || [],
                    removeUnUsedVariantImages: tmpCartSettings.userData?.bundleSettings?.removeUnUsedVariantImages ? tmpCartSettings.userData.bundleSettings.removeUnUsedVariantImages : false,
                    isGiftMessageVirtualProduct: tmpCartSettings.userData.bundleSettings?.isGiftMessageVirtualProduct || false,
                    isValidateInventoryEnabled: tmpCartSettings.userData.bundleSettings?.isValidateInventoryEnabled || false,
                    showCategoryNamesInLineItem: tmpCartSettings.userData.bundleSettings?.showCategoryNamesInLineItem || false
                },
                merchantInfo: tmpCartSettings.userData,
                languageData: tmpCartSettings.languageData,
                STOREFRONT_ACCESS_TOKEN: tmpCartSettings.userData.storefrontAccessToken,
                gbbKiteData: tmpCartSettings.gbbKiteData || null
            }



            gbb.settings = cart_settings
            gbb.state.bundleName = gbb.settings.stepsConfigurationData?.bundleName || ""
            // gbb.utility.debugConsole("settings assigned")
            gbb.f.initializeQtyIncrementDecrement()
        },
        initializeQtyIncrementDecrement: function () {
            try {
                const { stepsConfigurationData, bundleSettings } = gbb.settings || {};
                const state = gbb.gbbAddProductsPage.state;

                if (stepsConfigurationData && stepsConfigurationData.incrementProductQtyBy > 0 && stepsConfigurationData.decrementProductQtyBy > 0) {
                    state.incrementProductQtyBy = stepsConfigurationData.incrementProductQtyBy;
                    state.decrementProductQtyBy = stepsConfigurationData.decrementProductQtyBy;
                } else if (bundleSettings && bundleSettings.incrementProductQtyBy > 0 && bundleSettings.decrementProductQtyBy > 0) {
                    state.incrementProductQtyBy = bundleSettings.incrementProductQtyBy;
                    state.decrementProductQtyBy = bundleSettings.decrementProductQtyBy;
                }
            } catch (error) {
                gbb.utility.debugError("error in initializeQtyIncrementDecrement", error);
            }
        },
        prefetchData: async function () {
            // gbb.utility.debugConsole("prefetchData")
            console.time("prefetchData")
            gbb.settings.shopifyData = {};
            //fetch data from shopify which will use handle to fetch data
            const settings = gbb.settings;
            let greetingCardProductPromise, giftWrapProductPromise, giftMessagePromise, productsDataPromise, productsData1Promise, productsData2Promise, productsData3Promise, productsData4Promise, giftAddonsProductsPromise, multipleCategoriesPromise, defaultProductsDataPromise, addonProductsPromise;
            //greetingCard.greetingCardProduct -> isGreetingCardEnabled
            //fetch data from shopify for greeting card product which will be called only if isGreetingCardEnabled is true
            if (gbb.settings.greetingCard.isGreetingCardEnabled) {
                const products = gbb.settings.greetingCard.greetingCardProducts ? gbb.settings.greetingCard.greetingCardProducts : [];
                const listOfHandles = products.map(product => product.handle);
                let listOfProductIds = products.map(product => product.productId);
                let fetchOptions = { listOfProductIds }

                greetingCardProductPromise = gbb.utility.getProductsBulkForRelevantVariants(listOfHandles, products, fetchOptions);
            }

            if (gbb.settings.giftMessage.messageProduct?.isMessageProductEnabled) {
                giftMessagePromise = gbb.utility.getProductDataV2(settings.giftMessage.messageProduct?.product?.handle || settings.giftMessage?.messageProduct?.product?.productHandle)
            }


            // giftwrap.giftwrapProduct -> isGiftWrapEnabled

            if (gbb.settings.giftwrap.isGiftWrapEnabled) {
                giftWrapProductPromise = gbb.utility.getProductDataV2(settings.giftwrap.giftwrapProduct?.handle || settings.giftwrap.productHandle)
            }

            // giftAddons.addOnProducts[] -> isGiftAddonsEnabled




            if (gbb.settings?.giftAddons?.isGiftAddonsEnabled) {
                const products = gbb.settings.giftAddons.addOnProducts;
                const listOfHandles = products.map(product => product.handle);
                let listOfProductIds = products.map(product => product.productId);
                let fetchOptions = { listOfProductIds }

                giftAddonsProductsPromise = gbb.utility.getProductsBulkForRelevantVariants(listOfHandles, products, fetchOptions);
                //giftAddonsProductsPromise = gbb.utility.getProductsBulk(settings.giftAddons.addOnProducts.map(product => product.handle))
            }

            //insert here
            if (gbb.settings?.stepsConfigurationData?.defaultProductsData?.isDefaultProductsEnabled && gbb.settings?.stepsConfigurationData?.defaultProductsData?.products?.length > 0) {
                const products = gbb.settings?.stepsConfigurationData?.defaultProductsData?.products;
                const listOfHandles = products.map(product => product.handle);
                let listOfProductIds = products.map(product => product.productId);
                let fetchOptions = { listOfProductIds }

                defaultProductsDataPromise = gbb.utility.getProductsBulkForRelevantVariants(listOfHandles, products, fetchOptions);
            }

            let fetchsixtyProductsEachStep = []
            let fetchsixtyProductsEachStepByProductId = [];
            if (gbb.settings.stepsConfigurationData?.productsData1?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData1?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData1?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData1?.uniqueProductsData

                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData1?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)
                }
            }

            if (gbb.settings.stepsConfigurationData?.productsData2?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData2?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData2?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData2?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData2?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)

                }
            }
            if (gbb.settings.stepsConfigurationData?.productsData3?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData3?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData3?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData3?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData3?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)
                }
            }
            if (gbb.settings.stepsConfigurationData?.productsData4?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData4?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData4?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData4?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData4?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)
                }
            }
            if (gbb.settings.stepsConfigurationData?.productsData5?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData5?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData5?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData5?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData5?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)

                }
            }
            if (gbb.settings.stepsConfigurationData?.productsData6?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData6?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData6?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData6?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData6?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)

                }
            }
            if (gbb.settings.stepsConfigurationData?.productsData7?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData7?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData7?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData7?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData7?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)

                }
            }
            if (gbb.settings.stepsConfigurationData?.productsData8?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData8?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData8?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData8?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData8?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)

                }
            }
            if (gbb.settings.stepsConfigurationData?.productsData9?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData9?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData9?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData9?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData9?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)

                }
            }

            if (gbb.settings.stepsConfigurationData?.productsData10?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData10?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData10?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData10?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData10?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)

                }
            }

            if (gbb.settings.stepsConfigurationData?.productsData11?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData11?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData11?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData11?.uniqueProductsData

                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData11?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)

                }
            }
            if (gbb.settings.stepsConfigurationData?.productsData12?.isProductsEnabled &&
                gbb.settings.stepsConfigurationData?.productsData12?.uniqueProductsData &&
                gbb.settings.stepsConfigurationData?.productsData12?.uniqueProductsData?.length > 0) {
                let uniqueProductsData = gbb.settings.stepsConfigurationData?.productsData12?.uniqueProductsData
                let fetchLimit = 50
                if (gbb.settings.stepsConfigurationData?.productsData12?.pageType == "MULTIPLE_CATEGORY") {
                    fetchLimit = 200
                }
                for (let i = 0; i < Math.min(uniqueProductsData.length, fetchLimit); i += 1) {
                    fetchsixtyProductsEachStep.push(uniqueProductsData[i].handle);
                    fetchsixtyProductsEachStepByProductId.push(uniqueProductsData[i].productId)

                }
            }


            if (gbb.settings.app.enableStoreFrontGQLAPI) {
                // gbb.utility.getcachedProductDataForGraphql(fetchsixtyProductsEachStepByProductId);
            } else {
                gbb.utility.getcachedProductData(fetchsixtyProductsEachStep)
            }


            if (gbb.settings?.stepsConfigurationData?.multipleCategoriesData?.isMultipleCategoriesEnabled && gbb.settings?.stepsConfigurationData?.multipleCategoriesData?.categories) {
                gbb.settings.stepsConfigurationData.multipleCategoriesData.categories = Object.values(gbb.settings?.stepsConfigurationData?.multipleCategoriesData?.categories)

                for (let i = 0; i < gbb.settings?.stepsConfigurationData?.multipleCategoriesData?.categories.length; i++) {
                    const item = gbb.settings?.stepsConfigurationData?.multipleCategoriesData?.categories[i];
                    let products = item.products
                    let tempArr = [];
                    let additionalProducts = [];
                    let resObj = await gbb.utility.getProductsFromCollections(item.collectionsData);
                    if (resObj && resObj.length > 0) {
                        additionalProducts = resObj;
                    }
                    if (additionalProducts && additionalProducts.length > 0) {
                        products.push(...additionalProducts);
                    }
                    products = products.filter((product) => {
                        if (product) {
                            return product;
                        }
                    })
                    let listOfHandles = products.map(product => product.handle)
                    let listOfProductIds = products.map(product => product.productId)
                    let fetchOptions = { listOfProductIds }

                    tempArr.push(gbb.utility.getProductsBulkForRelevantVariants(listOfHandles, products, fetchOptions));

                    let allData = await Promise.all(tempArr)
                    allData = Object.values(allData[0]);

                    gbb.utility.setMapForVariantId(allData);


                    gbb.settings.stepsConfigurationData.multipleCategoriesData.categories[i].dataFromShopify = [
                        ...allData
                    ]
                }
            }

            // addon code changes - Dec '24 
            if (gbb.settings.addonProducts?.isEnabled) {
                let productHandlesArray = []
                let productIdsArray = []
                let products = []
                let tiersToMap = gbb.settings.addonProducts?.tiers || []
                for (let i = 0; i < tiersToMap.length; i++) {
                    let currentTier = tiersToMap[i]
                    let selectedAddonProducts = currentTier.selectedAddonProducts || []
                    selectedAddonProducts.forEach((addonProduct) => {
                        // making this extensive where we are avoiding duplicates
                        if (productHandlesArray.includes(addonProduct.handle)) {
                            //skip -
                            // continue the loop 
                            return
                        }
                        products.push(addonProduct)
                        productHandlesArray.push(addonProduct.handle)
                        productIdsArray.push(addonProduct.productId || addonProduct.id)
                    })
                }
                let fetchOptions = { listOfProductIds: productIdsArray }
                addonProductsPromise = gbb.utility.getProductsBulkForRelevantVariants(productHandlesArray, products, fetchOptions);//remove await 
            }

            let [greetingCardData, giftWrapData, giftMessageData,
                giftAddonsData, multipleCategoriesData, defaultProductsData, addonProductsData]
                =
                await Promise.all([greetingCardProductPromise, giftWrapProductPromise, giftMessagePromise, giftAddonsProductsPromise,
                    multipleCategoriesPromise, defaultProductsDataPromise, addonProductsPromise]);

            //assign data to global variable
            gbb.settings.shopifyData = {
                ...gbb.settings.shopifyData,
                greetingCardData: greetingCardData,
                giftWrapData: giftWrapData,
                giftMessageData: giftMessageData,
                giftAddonsData: giftAddonsData,
                multipleCategoriesData: gbb.settings?.stepsConfigurationData?.multipleCategoriesData,
                defaultProductsData: defaultProductsData,
                addonProductsData: addonProductsData
            }
            if (addonProductsData) {
                gbb.gbbAddonProducts.f.setPrefetchedAddonsData(addonProductsData)
                gbb.gbbAddonProducts.state.productsShopifyData = addonProductsData
                // gbb.utility.setMapForVariantId(addonProductsData);
                gbb.gbbAddonProducts.f.setMapForVariantId_addons(addonProductsData)
            }
            if (greetingCardData) {
                let extraInfo = {
                    shouldVariantTitleBeConvertedToProductTitle: false
                }
                gbb.utility.setMapForVariantId(greetingCardData, extraInfo);
            }

            if (giftWrapData) {
                let giftWrapDataObj = {};
                giftWrapDataObj[giftWrapData.handle] = giftWrapData;
                gbb.utility.setMapForVariantId(giftWrapDataObj);
            }

            if (giftMessageData) {
                //convert the giftMessageData to an object
                //with the key as the handle
                let giftMessageDataObj = {};
                giftMessageDataObj[giftMessageData.handle] = giftMessageData;
                gbb.utility.setMapForVariantId(giftMessageDataObj);
            }

            // if (giftAddonsData) {
            //     gbb.utility.setMapForVariantId(giftAddonsData);
            // }

            if (defaultProductsData) {
                gbb.utility.setMapForVariantId(defaultProductsData);
            }


            console.timeEnd("prefetchData")

        },
        setNavigationItems: function () {
            let navigationItems = [];
            if (gbb.settings?.stepsConfigurationData?.landingPageData?.isLandingPageEnabled) {
                navigationItems.push({
                    "id": "landingPage",
                    "rank": 1,
                    "text": "Landing Page",
                    "isActive": false,
                    "src": "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbLandingPage.init,
                    "isNavBarItem": false
                    // "showFn": glpro.glproGiftWrap.action.show,
                    // "hideFn": glpro.glproGiftWrap.action.hide,
                })
            }
            //only push this in router pages
            if (gbb.settings?.stepsConfigurationData?.productsData1?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage1",
                    "rank": 2,
                    "text": gbb.settings?.stepsConfigurationData?.productsData1?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData1?.stepImage ? gbb.settings?.stepsConfigurationData.productsData1?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage1,
                    "showFn": gbb.gbbAddProductsPage.action.showPage1,
                    "prefetchFn": gbb.gbbAddProductsPage.prefetchDataPage1,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                }
                navigationItems.push(navigationItem)
            }
            if (gbb.settings?.stepsConfigurationData?.productsData2?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage2",
                    "rank": 3,
                    "text": gbb.settings?.stepsConfigurationData?.productsData2?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData2?.stepImage ? gbb.settings?.stepsConfigurationData.productsData2?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage2,
                    "prefetchFn": gbb.gbbAddProductsPage.prefetchDataPage2,
                    "intialFetchFn": gbb.gbbAddProductsPage.intialFetchForPage2,
                    "showFn": gbb.gbbAddProductsPage.action.showPage2,

                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                    // "initFn": glpro.glproGiftWrap.init,
                    // "showFn": glpro.glproGiftWrap.action.show,
                    // "hideFn": glpro.glproGiftWrap.action.hide,
                }
                navigationItems.push(navigationItem)
            }
            // if (gbb.settings?.stepsConfigurationData?.multipleCategoriesData?.isMultipleCategoriesEnabled) {
            //     let navigationItem = {
            //         "id": "multipleCategoriesPage",
            //         "rank": 4,
            //         "text": gbb.settings?.stepsConfigurationData?.multipleCategoriesData?.multipleCategoriesStepText || "",
            //         "isActive": false,
            //         "src": gbb.settings.stepsConfigurationData.multipleCategoriesData?.stepImage ? gbb.settings?.stepsConfigurationData?.multipleCategoriesData?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
            //         "isCompleted": false,
            //         "initFn": gbb.gbbMultipleCategoriesPage.init,
            //         "isNavBarItem": true,
            //         "updatePageStatusFn": gbb.gbbMultipleCategoriesPage.updatePageStatus,
            //         // "initFn": glpro.glproGiftWrap.init,
            //         "showFn": gbb.gbbMultipleCategoriesPage.action.showMultipleCategoriesPage,
            //         // "hideFn": glpro.glproGiftWrap.action.hide,
            //     }
            //     navigationItems.push(navigationItem)
            // }
            if (gbb.settings?.stepsConfigurationData?.productsData3?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage3",
                    "rank": 5,
                    "text": gbb.settings?.stepsConfigurationData?.productsData3?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData3?.stepImage ? gbb.settings?.stepsConfigurationData.productsData3?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage3,
                    "prefetchFn": gbb.gbbAddProductsPage.prefetchDataPage3,
                    "intialFetchFn": gbb.gbbAddProductsPage.intialFetchForPage3,
                    "showFn": gbb.gbbAddProductsPage.action.showPage3,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                    // "initFn": glpro.glproGiftWrap.init,
                    // "showFn": glpro.glproGiftWrap.action.show,
                    // "hideFn": glpro.glproGiftWrap.action.hide,
                }
                navigationItems.push(navigationItem)
            }
            if (gbb.settings?.stepsConfigurationData?.productsData4?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage4",
                    "rank": 6,
                    "text": gbb.settings?.stepsConfigurationData?.productsData4?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData4?.stepImage ? gbb.settings?.stepsConfigurationData.productsData4?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage4,
                    "showFn": gbb.gbbAddProductsPage.action.showPage4,
                    "prefetchFn": gbb.gbbAddProductsPage.prefetchDataPage4,
                    "intialFetchFn": gbb.gbbAddProductsPage.intialFetchForPage4,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                    // "initFn": glpro.glproGiftWrap.init,
                    // "showFn": glpro.glproGiftWrap.action.show,
                    // "hideFn": glpro.glproGiftWrap.action.hide,
                }
                navigationItems.push(navigationItem)
            }

            if (gbb.settings?.stepsConfigurationData?.productsData5?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage5",
                    "rank": 7,
                    "text": gbb.settings?.stepsConfigurationData?.productsData5?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData5?.stepImage ? gbb.settings?.stepsConfigurationData.productsData5?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage5,
                    "showFn": gbb.gbbAddProductsPage.action.showPage5,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                }
                navigationItems.push(navigationItem)
            }

            if (gbb.settings?.stepsConfigurationData?.productsData6?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage6",
                    "rank": 8,
                    "text": gbb.settings?.stepsConfigurationData?.productsData6?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData6?.stepImage ? gbb.settings?.stepsConfigurationData.productsData6?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage6,
                    "showFn": gbb.gbbAddProductsPage.action.showPage6,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                }
                navigationItems.push(navigationItem)
            }

            if (gbb.settings?.stepsConfigurationData?.productsData7?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage7",
                    "rank": 9,
                    "text": gbb.settings?.stepsConfigurationData?.productsData7?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData7?.stepImage ? gbb.settings?.stepsConfigurationData.productsData7?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage7,
                    "showFn": gbb.gbbAddProductsPage.action.showPage7,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                }
                navigationItems.push(navigationItem)
            }

            if (gbb.settings?.stepsConfigurationData?.productsData8?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage8",
                    "rank": 10,
                    "text": gbb.settings?.stepsConfigurationData?.productsData8?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData8?.stepImage ? gbb.settings?.stepsConfigurationData.productsData8?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage8,
                    "showFn": gbb.gbbAddProductsPage.action.showPage8,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                }
                navigationItems.push(navigationItem)
            }

            if (gbb.settings?.stepsConfigurationData?.productsData9?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage9",
                    "rank": 11,
                    "text": gbb.settings?.stepsConfigurationData?.productsData9?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData9?.stepImage ? gbb.settings?.stepsConfigurationData.productsData9?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage9,
                    "showFn": gbb.gbbAddProductsPage.action.showPage9,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                }
                navigationItems.push(navigationItem)
            }

            if (gbb.settings?.stepsConfigurationData?.productsData10?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage10",
                    "rank": 12,
                    "text": gbb.settings?.stepsConfigurationData?.productsData10?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData10?.stepImage ? gbb.settings?.stepsConfigurationData.productsData10?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage10,
                    "showFn": gbb.gbbAddProductsPage.action.showPage10,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                }
                navigationItems.push(navigationItem)
            }

            if (gbb.settings?.stepsConfigurationData?.productsData11?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage11",
                    "rank": 13,
                    "text": gbb.settings?.stepsConfigurationData?.productsData11?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData11?.stepImage ? gbb.settings?.stepsConfigurationData.productsData11?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage11,
                    "showFn": gbb.gbbAddProductsPage.action.showPage11,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                }
                navigationItems.push(navigationItem)
            }
            if (gbb.settings?.stepsConfigurationData?.productsData12?.isProductsEnabled) {
                let navigationItem = {
                    "id": "addProductsPage12",
                    "rank": 14,
                    "text": gbb.settings?.stepsConfigurationData?.productsData12?.productPageStepText || "",
                    "isActive": false,
                    "src": gbb.settings?.stepsConfigurationData.productsData12?.stepImage ? gbb.settings?.stepsConfigurationData.productsData12?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbAddProductsPage.initPage12,
                    "showFn": gbb.gbbAddProductsPage.action.showPage12,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbAddProductsPage.updatePageStatus,
                }
                navigationItems.push(navigationItem)
            }

            if (gbb.settings?.stepsConfigurationData?.personalizationData?.isPersonalizationEnabled) {
                let navigationItem = {
                    "id": "personalizationPage",
                    "rank": 7,
                    "text": gbb.settings?.stepsConfigurationData?.personalizationData?.personalizeStepText,
                    "isActive": false,
                    "src": gbb.settings.stepsConfigurationData.personalizationData?.stepImage ? gbb.settings?.stepsConfigurationData?.personalizationData?.stepImage : "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbPersonalizePage.init,
                    "isNavBarItem": true,
                    "updatePageStatusFn": gbb.gbbPersonalizePage.updatePageStatus,
                    // "initFn": glpro.glproGiftWrap.init,
                    "showFn": gbb.gbbPersonalizePage.action.showPersonalizationPage,
                    // "hideFn": glpro.glproGiftWrap.action.hide,
                }
                navigationItems.push(navigationItem)
            }
            if (gbb.settings?.stepsConfigurationData?.summaryPageData?.isSummaryPageEnabled) {
                navigationItems.push({
                    "id": "reviewPage",
                    "rank": 8,
                    "text": "Review Page",
                    "isActive": false,
                    "src": "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/stepsconfV2.jpeg",
                    "isCompleted": false,
                    "initFn": gbb.gbbReviewPage.init,
                    "isNavBarItem": false
                    // "showFn": glpro.glproGiftWrap.action.show,
                    // "hideFn": glpro.glproGiftWrap.action.hide,
                })
            }
            //add more pages to routerPages
            // gbb.utility.debugConsole("navigationItems:", navigationItems);
            return navigationItems;
        },
        getNavItem: function (id) {
            let navigationItems = gbb.state.navigationItems;
            let navigationItem = navigationItems.filter(function (item) {
                return item.id === id;
            })
            return navigationItem[0];
        },
        getNextNavigationItem: function () {

            let navigationItems = gbb.state.navigationItems;
            let currentPageId = gbb.state.currentPageId;

            let currentPageItem = gbb.f.getNavItem(currentPageId);

            // find the index of the current navigation item
            let currentPageIndex = navigationItems.indexOf(currentPageItem);
            // gbb.utility.debugConsole(currentPageIndex);
            // get the next navigation item making sure its not the last one, if its then return null
            if (currentPageIndex === navigationItems.length - 1) {
                return null;
            }
            else {
                return navigationItems[currentPageIndex + 1];
            }
        },
        getPreviousNavigationItem: function () {

            let navigationItems = gbb.state.navigationItems;
            let currentPageId = gbb.state.currentPageId;

            let currentPageItem = gbb.f.getNavItem(currentPageId);

            // find the index of the current navigation item
            let currentPageIndex = navigationItems.indexOf(currentPageItem);
            // gbb.utility.debugConsole(currentPageIndex);
            if (currentPageIndex == 0) {
                return null;
            }
            return navigationItems[currentPageIndex - 1];
        },
        // Assuming stepsConfiguration has the required data
        cacheAllProductsData: async function () {
            try {
                let allProducts = [];
                let productPages = [
                    gbb.settings.stepsConfigurationData?.productsData1,
                    gbb.settings.stepsConfigurationData?.productsData2,
                    gbb.settings.stepsConfigurationData?.productsData3,
                    gbb.settings.stepsConfigurationData?.productsData4,
                    gbb.settings.stepsConfigurationData?.productsData5,
                    gbb.settings.stepsConfigurationData?.productsData6,
                    gbb.settings.stepsConfigurationData?.productsData7,
                    gbb.settings.stepsConfigurationData?.productsData8,
                    gbb.settings.stepsConfigurationData?.productsData9,
                    gbb.settings.stepsConfigurationData?.productsData10,
                    gbb.settings.stepsConfigurationData?.productsData11,
                    gbb.settings.stepsConfigurationData?.productsData12
                ];

                // Loop through all product data pages
                for (let i = 0; i < productPages.length; i++) {
                    const productsData = productPages[i];
                    if (productsData && productsData.isProductsEnabled && productsData.uniqueProductsData) {
                        // Get product handles and IDs
                        let productHandles = productsData.uniqueProductsData.map(product => product.handle);
                        let productIds = productsData.uniqueProductsData.map(product => product.productId);

                        // Fetch data for each product
                        for (let j = 0; j < productHandles.length; j++) {
                            let handle = productHandles[j];
                            let productId = productIds[j];

                            // Check if it's already in the cache
                            if (!gbb.state.cachedProductData.has(productId)) {
                                // Fetch product data using utility functions
                                let productData = await gbb.utility.getProductDataV2(handle);

                                // Cache the product data
                                gbb.state.cachedProductData.set(productId, productData);
                                allProducts.push(productData);
                            }
                        }
                    }
                }

                gbb.utility.debugConsole('All products have been fetched and cached:', gbb.state.cachedProductData);
            } catch (error) {
                console.error('Error while caching products data:', error);
            }
        },

        updateNavigationsItems: function (stepId, isStatusActive, isStepCompleted) {
            gbb.state.navigationItems.find((item) => {
                if (item.id == stepId) {
                    if (isStatusActive && isStatusActive == true) {
                        item.isActive = true;
                    } else {
                        item.isActive = false;
                    }
                    if (isStepCompleted && isStepCompleted == true) {
                        item.isCompleted = true;
                    } else {
                        item.isCompleted = false;
                    }
                }
            })
        },
        markPreviousNavigationItemsAsCompleted: function (currentNavItem) {
            let navigationItems = [...gbb.state.navigationItems];
            let currentPageId = currentNavItem.id;

            //split the navigation items into two arrays, one before the current page and one after

            let currentPageIndex = navigationItems.indexOf(currentNavItem);
            let navigationItemsBeforeCurrentPage = navigationItems.slice(0, currentPageIndex);
            let navigationItemsAfterCurrentPage = navigationItems.slice(currentPageIndex + 1, navigationItems.length);

            //mark all the navigation items before the current page as completed
            navigationItemsBeforeCurrentPage.forEach(function (item) {
                gbb.f.updateNavigationsItems(item.id, false, true);
            })
            //mark all the navigation items after the current page as not completed
            navigationItemsAfterCurrentPage.forEach(function (item) {
                gbb.f.updateNavigationsItems(item.id, false, false);
            })

            gbb.f.updateNavigationsItems(currentPageId, true, false);


        },
        getNavigationItemsToDisplay: function (startFromNavItemId) {
            // let navigationItems =JSON.parse(JSON.stringify(gbb.state.navigationItems));
            // gbb.utility.debugConsole("before: gbb.state.navigationItems.length:", gbb.state.navigationItems.length)
            let navigationItems = [...gbb.state.navigationItems];


            let blackListedNavigationItems = ["landingPage", "reviewPage"];

            navigationItems = navigationItems.filter(function (item) {
                return !blackListedNavigationItems.includes(item.id);
            })

            // startFromNavItemId = "landingPage" when user is on landing page
            // Q: why does getNavigationItemsToDisplay get fired at all when user is on landing page?

            // A: because we also display navigation items on landing page
            // so to solve this, we just set startFromNavItemId to the first navigation item

            if (startFromNavItemId == "landingPage") {
                startFromNavItemId = navigationItems[0].id;
            }
            gbb.state.navigationItemsToRender = navigationItems;

            // if screen is less than 768px, then change gbb.state.navItemsViewPerPage to 4
            if (window.innerWidth < 768) {
                gbb.state.navItemsViewPerPage = 4
            }

            let navItem = gbb.f.getNavItem(startFromNavItemId);

            // find the index of the current navigation item
            let navItemIndex = gbb.state.navigationItemsToRender.indexOf(navItem);

            let startIndex = navItemIndex;
            if (startIndex + gbb.state.navItemsViewPerPage > navigationItems.length) {
                startIndex = navigationItems.length - gbb.state.navItemsViewPerPage;
                if (startIndex < 0) {
                    startIndex = 0;
                }
            }

            let endIndex = Math.min(startIndex + gbb.state.navItemsViewPerPage, navigationItems.length);
            let navigationItemsToDisplay = navigationItems.slice(startIndex, endIndex);


            return navigationItemsToDisplay;

        },
        insertDiscountProgressBar: async function () {

            gbb.state.giftBoxCartData = await gbb.utility.getGiftBoxProductsFromCart()


            //check if gbbDiscountProgressBar is enabled
            if (gbb.settings.discountsData.isDiscountEnabled) {
                //check if element exists
                if (gbb.$('.gbbDiscountComponent').length == 0) {
                    gbb.gbbDiscountComponent.init(gbb.settings)
                }
                //update the discount progress bar relative to the current cartTotal
                gbb.gbbDiscountComponent.f.updateCurrentDiscountRule();
            }
        },
        renderTagsPillsHTML: function (product, noteAttribute, category) {
            try {
                const tagsArray = product.tags;

                // const pillHTML 
                const userObjectForTagsAndPills = gbb.state.tagsPillsData || [];
                let tagsAndPillHTMLContainer = gbb.$("<div>").addClass("gbbTagsAndPillHTMLContainer")
                if (userObjectForTagsAndPills && userObjectForTagsAndPills.length < 1) {
                    return "";
                } else if (userObjectForTagsAndPills && userObjectForTagsAndPills.length > 0) {
                    for (let i = 0; i < userObjectForTagsAndPills.length; i++) {
                        const item = userObjectForTagsAndPills[i];
                        const currentKey = item.tagKey;
                        let tagsAndPillHTML = gbb.$("<div>").addClass("gbbTagsAndPillHTML")
                        const currentValueHtml = item.tagValueHTML;
                        // item.tagText
                        if (tagsArray.includes(currentKey)) {
                            tagsAndPillHTML.html(currentValueHtml);
                            tagsAndPillHTMLContainer.append(tagsAndPillHTML);
                        }
                    }
                }
                return tagsAndPillHTMLContainer;

            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        setSelectors: function () {
            let settings = gbb.settings
            gbb.selectors = {
                addToCart: settings.app.addToCartBtnSelectors,
                checkoutBtn: settings.app.checkoutBtnSelectors,
                sideCartSelectors: settings.app.sideCartSelectors,
                buyNowBtn: settings.app.buyNowBtn,
                cartForm: settings.app.cartForm,
                productPageWrapperV2: '.gbbProductPageWrapperV2',
                cartPageWrapperV2: '.gbbCartPageWrapperV2',
                quantityBtnSelectors: settings.app.quantityBtnSelectors,
                scheduleDeliveryPickerSelector: settings.app.scheduleDeliveryPickerSelector,
            }
        },
        setDefaultThemeStyles: function () {
            try {
                DEFAULT_BODY_OVERFLOW_VALUE = gbb.$('body').css('overflow-y');
                return;
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        setCustomStyling: function () {
            let customStyle = gbb.settings.app.customStyle
            if (customStyle) {
                var styleSheet = document.createElement("style")
                styleSheet.innerText = customStyle
                document.body.appendChild(styleSheet)

            }
        },
        getPageType: function () {
            var pageType = "";
            if (window.location.pathname.includes("/cart") && !window.location.pathname.includes("/products")) {
                pageType = "cart";
            } else if (window.location.pathname.includes("/products")) {
                pageType = "product";
            } else if (window.location.pathname.includes("/collections")) {
                pageType = "COLLECTION";
            } else if (window.location.pathname.includes("/")) {
                pageType = "HOME";
            } else if ("undefined" != typeof Shopify && "undefined" != typeof Shopify.Checkout) {
                pageType = "CHECKOUT";
            } else {
                pageType = "PAGE_NOT_FOUND";
            }
            return pageType;
        },
        getProductPageHandle: function () {
            if ("product" === gbb.state.page_type && shopifyLiquidValuesApp4.product.handle) {
                // let pattern = /(?<=\\/products\\/)((?!\\?|\\$).)+/g
                // if(window && window.location && window.location.href){
                //     return window.location.href.match(pattern)[0]
                // }
                return shopifyLiquidValuesApp4.product.handle
            }
            return "undefined"
        },
        applyButtonCSS: function (element) {

            //apply gbb.settings.app.themButtonTextColor themeButtonBackgroundColor themeButtonBorderColor to the button
            if (gbb.settings.app.themButtonTextColor != "") {
                element.css("color", gbb.settings.app.themButtonTextColor);
            }
            if (gbb.settings.app.themeButtonBackgroundColor != "") {
                element.css("background-color", gbb.settings.app.themeButtonBackgroundColor);
            }
            if (gbb.settings.app.themeButtonBorderColor != "") {
                element.css("border", "1px solid")
                element.css("border-color", gbb.settings.app.themeButtonBorderColor);
            }
            // box shadow
            if (gbb.settings.app.themeButtonBoxShadow != "") {
                element.css("box-shadow", gbb.settings.app.themeButtonBoxShadow);
            }
            //themeButtonFontFamily
            if (gbb.settings.app.themeButtonFontFamily != "") {
                element.css("font-family", gbb.settings.app.themeButtonFontFamily);
            }


        },
        resetButtonCSS: function (element) {
            //reset the button css
            element.css("color", "");
            element.css("background-color", "");
            element.css("border", "");
            element.css("border-color", "");
            element.css("box-shadow", "");
        },
        applyHeaderCSS: function (element) {
            //apply gbb.settings.app.themeFontFamily themeFontColor to the header
            if (gbb.settings.app.themeHeaderFontFamily != "") {
                element.css("font-family", gbb.settings.app.themeHeaderFontFamily);
            }
            if (gbb.settings.app.themeHeaderFontColor != "") {
                element.css("color", gbb.settings.app.themeHeaderFontColor);
            }
        },
        applyLabelCSS: function (element) {
            //apply gbb.settings.app.themeLabelFontColor to the label
            if (gbb.settings.app.themeLabelFontColor != "") {
                element.css("color", gbb.settings.app.themeLabelFontColor);
            }
            if (gbb.settings.app.themeLabelFontFamily != "") {
                element.css("font-family", "inherit");
            }
        },
        applyBackgroundColorCss: function (element) {

        },
        applyTextColorCss: function (element) {

        },
        applyPrimaryColorCss: function (element) {
            element.css("background", gbb.settings.pageCustomizationData.colors.primaryColor);
        },
        applySecondaryColorCss: function (element) {
            element.css("background", gbb.settings.pageCustomizationData.colors.secondaryColor);
        },
        applyTextColorCss: function (element) {
            element.css("color", gbb.settings.pageCustomizationData.colors.textColor);
        },
        applyDisabledColorCss: function (element) {
            element.css("color", gbb.settings.pageCustomizationData.colors.disabledColor);
        },
        applyActiveImageStyle: function (element) {
            element.css("border", `2px solid ${gbb.settings?.pageCustomizationData?.productCard.productCardButtonColor}`)
        },
        removeActiveImageStyle: function (element) {
            element.css("border", "none")
        },
        applySelectedVariantStyle: function (element) {
            element.css("background", gbb.settings?.pageCustomizationData?.productCard.productCardButtonColor);
            element.css("color", gbb.settings.pageCustomizationData.productCard.productCardButtonTextColor)
        },
        removeSelectedVariantStyle: function (element) {
            element.css("background", "#f1f2f3")
            element.css("color", "#000000")
        },
        getSelectedVariant: function () {
            if ("product" === gbb.state.page_type) {
                if (ShopifyAnalytics && ShopifyAnalytics.meta && ShopifyAnalytics.meta.selectedVariantId) {
                    return ShopifyAnalytics.meta.selectedVariantId
                }
                if (document.querySelector('[name="id"]') && document.querySelector('[name="id"]').value) {
                    return document.querySelector('[name="id"]').value
                }
                return undefined
            }
        },
        getElements: function (settings) {
            return {
                gbbHTMLWrapperParent: gbb.$(gbb.$.parseHTML('<div class="gbbHTMLWrapper"></div>')),
                gbbHeaderWrapperParent: gbb.$(gbb.$.parseHTML('<div class="gbbHeaderWrapper"></div>')),
                gbbBodyWrapperParent: gbb.$(gbb.$.parseHTML('<div class="gbbBodyWrapper"></div>')),
                //change this for sidebar position
                gbbFooterWrapperParent: gbb.$(gbb.$.parseHTML('<div class="gbbFooterWrapper"></div>')),

                addToCartBtn: gbb.$(document).find(gbb.selectors.addToCart),
                addToCartButtonCloned: undefined,
                checkoutBtn: gbb.$(document).find(gbb.selectors.checkoutBtn),
                cartForm: gbb.$(document).find(gbb.selectors.cartForm),
                productPageWrapperV2: gbb.$(gbb.$.parseHTML('<div class="gbbPageWrapper gbbProductPageWrapperV2"> <div class="gbbGiftOptionsPageEleWrapper"></div>  <div class="gbbLandingPageWrapper"></div><div class="gwmGiftMessageWrapper"></div> </div>')),
                cartPageWrapperV2: gbb.$(gbb.$.parseHTML('<div class="gbbPageWrapper gbbCartPageWrapperV2"> <div class="gbbCartGiftOptionsPageEleWrapper"></div><div class="gwmCartGiftMsgAndWrapWrapper"></div><div class="gwmCartGiftMessageWrapper"></div></div>')),
                buyNowBtn: gbb.$(document).find(gbb.selectors.buyNowBtn)
            }
        },
        renderNavigationHTML: function (parentHTML, noteAttribute, navigationItems) {
            let navigationHTML = gbb.$("<div>").addClass("gbbNavigationItemsContainer");


            let navigationArrowsContainer = gbb.$("<div>").addClass("gbbNavigationArrowsContainer");
            // let navigationItems = gbb.gbbModal.setNavigationItems();
            // let navigationItems = gbb.state.navigationItems;

            // navigationItems = gbb.f.getNextFiveNavigationItems(navigationItems);


            let stepsCount = 0;
            navigationItems = navigationItems.filter((element) => {
                if (element.isNavBarItem && element.isNavBarItem == true) {
                    stepsCount++;
                    return element;
                }
            })

            let navigationItemHTML = gbb.$("<div>").addClass("gbbNavigationItem");
            //run a for loop with each navigation item with the following properties text, onclick function, isActive

            if (stepsCount == 1) {
                return;
            } else {
                if (parentHTML && stepsCount == 2) {
                    if (noteAttribute == "landingPage") {
                        parentHTML.css("margin", "0% 15%");
                    } else {
                        parentHTML.css("margin", "0% 0%");
                    }

                    if (window.innerWidth > 600) {
                        if (noteAttribute != "landingPage") {
                            parentHTML.css("margin", "0% 0%");
                        }

                    }
                }
                for (let i = 0; i < navigationItems.length; i++) {
                    let navigationItemContainer = navigationItemHTML.clone();
                    let _navigationImageContainer = gbb.$("<div>").addClass("gbbNavigationStepImgContainer");

                    let _navigationImage = gbb.$("<img>").addClass("gbbNavigationImage");
                    let item = navigationItems[i];
                    if (stepsCount == 2 && item.id != "personalizationPage") {
                        // _navigationImageContainer.css("justify-self", "start");
                    }

                    if (item.isActive) {
                        let borderWidth = gbb.settings.pageCustomizationData.navigationBanner.navigationBannerStepCompletedBorderWidth || "4px";
                        _navigationImageContainer.addClass("gbbNavigationStepImgContainerActive");
                        _navigationImageContainer.css("border", `${borderWidth} solid ${gbb.settings.pageCustomizationData.navigationBanner.navigationBannerStepCompletionColor}`);
                    } else {
                        _navigationImageContainer.removeClass("gbbNavigationStepImgContainerActive");
                    }

                    if (item.isCompleted) {
                        let divToBeInserted;
                        // gbb.settings.pageCustomizationData.customImage = "https://gift-box-builder-app4.s3.us-east-2.amazonaws.com/public/icons/Deafult+Image.png"
                        if (gbb.settings.merchantInfo?.customSettings?.navCompletedImage) {
                            let tickMarkImg = gbb.$("<img>").addClass("gbbtickMarkImg").addClass("gbbNavigationImage")
                            tickMarkImg.attr("src", gbb.settings.merchantInfo?.customSettings?.navCompletedImage);
                            divToBeInserted = tickMarkImg;
                        } else {
                            let tickMarkDiv = gbb.$("<div>").addClass("gbbtickMark");

                            tickMarkDiv.append(`<svg width="30" height="30" viewBox="0 0 74 74" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M29.4459 54.1897C29.0348 54.1897 28.6494 54.1249 28.2897 53.9954C27.93 53.868 27.5959 53.6501 27.2876 53.3417L14.0293 40.0834C13.464 39.5181 13.1937 38.7853 13.2183 37.885C13.2451 36.9867 13.5411 36.2549 14.1063 35.6896C14.6716 35.1244 15.3911 34.8417 16.2647 34.8417C17.1383 34.8417 17.8577 35.1244 18.423 35.6896L29.4459 46.7126L55.5772 20.5813C56.1425 20.016 56.8753 19.7334 57.7756 19.7334C58.6739 19.7334 59.4057 20.016 59.9709 20.5813C60.5362 21.1466 60.8188 21.8784 60.8188 22.7766C60.8188 23.677 60.5362 24.4098 59.9709 24.9751L31.6043 53.3417C31.2959 53.6501 30.9619 53.868 30.6022 53.9954C30.2425 54.1249 29.857 54.1897 29.4459 54.1897Z" fill=${gbb.settings.pageCustomizationData.navigationBanner.navigationBannerStepDoneColor || "#ffffff"} ></svg>`);
                            let tickMarkPseudo = gbb.$("<div>").addClass("gbbtickMarkPseudo");

                            tickMarkDiv.css("border", "none");

                            tickMarkPseudo.css("background-color", gbb.settings.pageCustomizationData.navigationBanner.navigationBannerStepDoneColor || "#ffffff");
                            //tickMarkDiv.addClass("gbbtickMarkPseudo");

                            _navigationImageContainer.css("border", "none");

                            _navigationImageContainer.css("background-color", gbb.settings.pageCustomizationData.navigationBanner.navigationBannerStepCompletionColor);
                            divToBeInserted = tickMarkDiv;
                        }
                        _navigationImageContainer.html(divToBeInserted);
                        //item.src = "https://d3ks0ngva6go34.cloudfront.net/public/stepsconfiguration/step_completed.png"
                    } else {
                        _navigationImage.attr("src", item.src);
                        _navigationImageContainer.append(_navigationImage);
                    }
                    let _navigationTitleContainer = gbb.$("<div>").addClass("gbbNavigationTitleContainer");
                    let _navigationTitle = gbb.$("<p>").addClass("gbbNavigationTitle");
                    // _navigationTitle.css("color", gbb.settings.pageCustomizationData?.navigationBanner?.navigationBannerTextColor);

                    navigationItemContainer.attr("id", item.id);

                    //TODO: allowNavigationClick flag to be added in the future
                    if (true || gbb.settings.stepsConfigurationData.allowNavigationClick) {
                        navigationItemContainer.on("click", item.showFn)
                    }

                    _navigationTitle.text(item.text || "");
                    _navigationTitle.css("color", gbb.settings.pageCustomizationData?.navigationBanner?.navigationBannerStepTextColor || "black");


                    _navigationTitleContainer.append(_navigationTitle);
                    navigationItemContainer.append(_navigationImageContainer);
                    navigationItemContainer.append(_navigationTitleContainer);

                    // navigationItemContainer.append()
                    navigationHTML.append(navigationItemContainer);
                }

                // gbb.utility.debugConsole("navigationItems", navigationItems)

                let currentNavigationItemIndex = gbb.state.navigationItemsToRender.findIndex((item) => {
                    return item.id == navigationItems[0].id
                })

                // gbb.utility.debugConsole("currentNavigationItemIndex", currentNavigationItemIndex);

                if (currentNavigationItemIndex > -1) {

                    let previousNavigationItemsButton = gbb.$("<div>").addClass("gbbPreviousNavigationItemsButton")
                    previousNavigationItemsButton.append(CONSTANT_ARROW_SVG);
                    previousNavigationItemsButton.find("g").css("fill", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconTextColor || "black");

                    previousNavigationItemsButton.css("background", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconBgColor || "white");

                    let currentIndex = currentNavigationItemIndex

                    let nextStartIndex = Math.max(currentIndex - gbb.state.navItemsViewPerPage, 0);

                    let previousItem = gbb.state.navigationItemsToRender[nextStartIndex];

                    //now fetch the previous 5 items if they exist
                    previousNavigationItemsButton.on("click", () => {
                        const navItems = gbb.f.getNavigationItemsToDisplay(previousItem.id)
                        // gbb.utility.debugConsole(navItems);
                        gbb.$(".gbbNavigationItemsContainer").replaceWith(gbb.f.renderNavigationHTML("", gbb.state.currentPageId, navItems));
                    })

                    if (gbb.state.navigationItemsToRender.length > gbb.state.navItemsViewPerPage) {
                        navigationHTML.append(previousNavigationItemsButton);
                    }

                }

                if (currentNavigationItemIndex < gbb.state.navigationItemsToRender.length - 1) {
                    let nextNavigationItemsButton = gbb.$("<div>").addClass("gbbNextNavigationItemsButton")
                    nextNavigationItemsButton.append(CONSTANT_ARROW_SVG);
                    nextNavigationItemsButton.find("g").css("fill", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconTextColor || "black");
                    nextNavigationItemsButton.css("background", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconBgColor || "white");

                    let currentIndex = currentNavigationItemIndex

                    let nextIndex = currentIndex + gbb.state.navItemsViewPerPage;

                    if (nextIndex > gbb.state.navigationItemsToRender.length - 1) {
                        nextIndex = gbb.state.navigationItemsToRender.length - 1;
                    }

                    let nextItem = gbb.state.navigationItemsToRender[nextIndex];


                    nextNavigationItemsButton.on("click", () => {
                        const navItems = gbb.f.getNavigationItemsToDisplay(nextItem.id)
                        // gbb.utility.debugConsole("next navItems are",navItems);
                        gbb.$(".gbbNavigationItemsContainer").replaceWith(gbb.f.renderNavigationHTML("", gbb.state.currentPageId, navItems));
                    })

                    if (gbb.state.navigationItemsToRender.length > gbb.state.navItemsViewPerPage) {
                        navigationHTML.append(nextNavigationItemsButton);
                    }

                }


                if (navigationItems.length > 0 && gbb.$('.gbbProductsCardLayoutV2').length > 0) {
                    // render steps progress bar
                    setTimeout(() => {
                        gbb.$('.gbbNavigationItemsContainer').css('::before', {
                            'content': 'none'
                        })
                        let stepsProgressBarHTML = gbb.f.renderStepsProgressBar()

                        //calculate the width for progressbar
                        let navItems = gbb.$('.gbbNavigationItem');

                        let startColumn = navItems.first();
                        let endColumn = navItems.last();

                        let startCenter = startColumn.offset().left + startColumn.width() / 2;
                        let endCenter = endColumn.offset().left + endColumn.width() / 2;

                        let progressBarWidth = endCenter - startCenter;
                        stepsProgressBarHTML.css('width', progressBarWidth);
                        // ================================================ //

                        // calculate the filled progressbar width
                        // 1st step to the last step completed 
                        let activeStepIndex = 0
                        let lastCompletedStepIndex = 0
                        for (let i = 0; i < navigationItems.length; i++) {
                            let step = navigationItems[i]
                            if (step.isNavBarItem && step.isActive) {
                                activeStepIndex = i;
                            }
                            if (step.isNavBarItem && step.isCompleted) {
                                lastCompletedStepIndex = i;
                            }
                        }
                        if (activeStepIndex == 0 && lastCompletedStepIndex != 0) {
                            activeStepIndex = lastCompletedStepIndex;
                        }// when you have more than navItemsViewPerPage navItems 
                        /*
                        for eg : you have 10 steps 
                        so in step navigations we will have pagination // TO BE DONE @mufadal
                         */
                        let lastCompletedStep = navItems.eq(activeStepIndex);
                        let lastCompletedStepCenter = lastCompletedStep.offset().left + lastCompletedStep.width() / 2;

                        let filledProgressBarWidth = lastCompletedStepCenter - startCenter;
                        stepsProgressBarHTML.find('.gbbStepsProgressBarFilled').css('width', filledProgressBarWidth);

                        navigationHTML.append(stepsProgressBarHTML)
                    }, 100)
                }
                // navigationHTML.append(navigationArrowsContainer);
                //navigationHTML.append(navigationImages);
                return navigationHTML;
            }
        },
        renderStepsProgressBar: function (parentHTML, noteAttribute, navigationItems) {
            let stepsProgressBarHTML = gbb.$("<div>").addClass("gbbStepsProgressBarContainer");
            let stepsProgressBar = gbb.$("<div>").addClass("gbbStepsProgressBar");
            stepsProgressBar.css('background', gbb.settings.pageCustomizationData.navigationBanner.navigationBannerStepProgressBarEmptyColor || '#eeeeee')
            let stepsProgressBarFilled = gbb.$("<div>").addClass("gbbStepsProgressBarFilled");
            stepsProgressBarFilled.css('background', gbb.settings.pageCustomizationData.navigationBanner.navigationBannerStepProgressBarFilledColor || '#1E1E1E')
            stepsProgressBar.append(stepsProgressBarFilled)
            stepsProgressBarHTML.append(stepsProgressBar);
            return stepsProgressBarHTML;
        },
        addParamsToUrl: function (key, value) {
            // get the navigation item and attach it to the url params
            let urlParams = new URLSearchParams(window.location.search);
            urlParams.set(key, value);
            window.history.replaceState({}, "", `${window.location.pathname}?${urlParams.toString()}`);
        },
        getParamValueFromUrl: function (key) {
            // get the navigation item from the url params
            let urlParams = new URLSearchParams(window.location.search);
            let value = urlParams.get(key);
            // gbb.utility.debugConsole("getParamValueFromUrl:", value);
            return value;
        },


        processAdditionalLogicAsPerUseCase: function () {
            try {
                // check localStorage for extraInfoFromLinkDummyProductPage
                let extraInfoFromLinkDummyProductPage = sessionStorage.getItem("extraInfoFromLinkDummyProductPage");
                let linkProductSetting = gbb.settings.stepsConfigurationData.useLinkProductAsDefaultProduct;

                if (typeof linkProductSetting == "undefined") {
                    //this is a fallback because we have customer who have
                    // this flag on user level but not bundle level
                    linkProductSetting = true;
                }

                if (linkProductSetting == false) {
                    //should we also clear the sessionStorage here?
                    sessionStorage.removeItem("extraInfoFromLinkDummyProductPage");
                    return;
                }
                if (extraInfoFromLinkDummyProductPage) {
                    extraInfoFromLinkDummyProductPage = JSON.parse(extraInfoFromLinkDummyProductPage);
                    if (extraInfoFromLinkDummyProductPage?.addDummyProductToDefaultProducts == true) {
                        // add the dummy product to the default products
                        let dummyProductsData = extraInfoFromLinkDummyProductPage?.dummyProductsData.length > 0 ? extraInfoFromLinkDummyProductPage?.dummyProductsData : null;
                        for (let i = 0; i < dummyProductsData?.length; i++) {
                            let dummyProduct = dummyProductsData[i];
                            if (dummyProduct) {
                                let defaultProductsData = gbb.settings.stepsConfigurationData.defaultProductsData || { products: [], isDefaultProductsEnabled: false };
                                defaultProductsData.products.push(dummyProduct);
                                defaultProductsData.isDefaultProductsEnabled = true;
                                gbb.settings.stepsConfigurationData.defaultProductsData = defaultProductsData;
                            }
                        }
                    }
                }
            } catch (e) {
                gbb.utility.debugConsole("error in processAdditionalLogicAsPerUseCase:", e)
            }
        },

        renderFiltersSearchSortHeaderHTML: function (noteAttribute) {
            let gbbFiltersSearchSortHeader = gbb.$("<div>").addClass("gbbFiltersSearchSortHeader");

            let gbbFiltersMainButtonWrapper = gbb.$("<div>").addClass("gbbFiltersMainButtonWrapper");
            let gbbFiltersCheckboxLabel = gbb.$("<div>").addClass("gbbFiltersCheckboxLabel");

            let activatedFiltersCount = gbb.utility.getActivatedFilters(noteAttribute).length > 0 ? " ( " + gbb.utility.getActivatedFilters(noteAttribute).length + " )" : ""
            gbbFiltersCheckboxLabel.text((gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.filtersLabel) || "Filters1") + activatedFiltersCount);

            let gbbFiltersDropDownButton = gbb.$("<div>").addClass("gbbFiltersDropDownButton");
            // gbbFiltersDropDownButton.css("background", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconBgColor || "white");
            gbbFiltersDropDownButton.css("color", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconTextColor || "#000000");

            // gbbFiltersDropDownButton.append(`<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
            //         width="auto" height="30px" viewBox="0 0 512.000000 512.000000"
            //         preserveAspectRatio="xMidYMid meet">
            //        <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
            //        fill=${gbb.settings.pageCustomizationData.quickSettings.colors.primaryColor || "#000000"} stroke="none">
            //        <path d="M893 4335 c-154 -42 -300 -175 -349 -318 l-16 -46 -221 -3 c-213 -3
            //        -223 -4 -254 -26 -67 -48 -67 -156 0 -204 31 -22 41 -23 254 -26 l221 -3 16
            //        -46 c22 -65 68 -133 129 -190 162 -154 382 -186 586 -87 101 49 223 193 251
            //        294 l6 25 1760 5 1759 5 32 23 c67 48 67 156 0 204 l-32 23 -1759 5 -1760 5
            //        -6 25 c-28 101 -150 245 -251 294 -115 56 -253 71 -366 41z m232 -260 c45 -18
            //        92 -62 123 -114 23 -39 27 -57 27 -121 0 -64 -4 -82 -27 -121 -32 -54 -78 -96
            //        -128 -117 -45 -19 -145 -19 -191 1 -92 38 -159 137 -159 237 0 87 39 156 123
            //        220 49 37 161 44 232 15z"/>
            //        <path d="M3976 3059 c-156 -37 -327 -194 -365 -338 l-7 -26 -1760 -5 -1759 -5
            //        -32 -23 c-67 -48 -67 -156 0 -204 l32 -23 1759 -5 1760 -5 6 -25 c28 -101 150
            //        -245 251 -294 155 -75 323 -75 471 0 99 50 209 175 244 277 l16 46 221 3 c213
            //        3 223 4 254 26 67 48 67 156 0 204 -31 22 -41 23 -254 26 l-221 3 -16 46 c-50
            //        145 -196 277 -353 318 -62 16 -186 18 -247 4z m220 -264 c49 -20 105 -76 130
            //        -130 60 -128 -3 -287 -135 -342 -46 -20 -146 -20 -191 -1 -84 35 -148 121
            //        -157 210 -20 194 172 337 353 263z"/>
            //        <path d="M2433 1775 c-144 -39 -267 -139 -328 -266 -19 -41 -35 -79 -35 -86 0
            //        -10 -201 -13 -992 -15 l-993 -3 -32 -23 c-67 -48 -67 -156 0 -204 l32 -23 993
            //        -3 c791 -2 992 -5 992 -15 0 -7 16 -45 35 -86 148 -309 575 -377 818 -128 54
            //        54 127 178 127 214 0 10 201 13 993 15 l992 3 32 23 c67 48 67 156 0 204 l-32
            //        23 -992 3 c-792 2 -993 5 -993 15 0 7 -16 46 -35 86 -101 210 -356 326 -582
            //        266z m247 -273 c179 -89 178 -354 -3 -446 -153 -78 -330 6 -366 174 -28 131
            //        53 260 187 296 60 17 113 10 182 -24z"/>
            //        </g>
            //        </svg>`);
            gbbFiltersDropDownButton.append(`<svg width="20" height="19" viewBox="0 0 20 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0 5.58863H15.2086V3.47401H0V5.58863ZM17.9738 0C17.2102 0 16.5912 0.676247 16.5912 1.51044V7.5522C16.5912 8.3864 17.2102 9.06264 17.9738 9.06264C18.7374 9.06264 19.3564 8.3864 19.3564 7.5522V1.51044C19.3564 0.676247 18.7374 0 17.9738 0ZM9.67822 12.5367V10.5731C9.67822 9.73889 9.05921 9.06264 8.29562 9.06264C7.53203 9.06264 6.91301 9.73889 6.91301 10.5731V16.6148C6.91301 17.449 7.53203 18.1253 8.29562 18.1253C9.05921 18.1253 9.67822 17.449 9.67822 16.6148V14.6513H19.3564V12.5367H9.67822ZM0 14.6513H5.53041V12.5367H0V14.6513Z" fill="#1E1E1E"}/>
                    </svg>`)
            gbbFiltersMainButtonWrapper.append(gbbFiltersDropDownButton);
            gbbFiltersMainButtonWrapper.append(gbbFiltersCheckboxLabel);

            gbbFiltersMainButtonWrapper.on("click", () => {
                gbb.utility.toggleFiltersSideBar(noteAttribute);
                if (gbb.utility.getFiltersState(noteAttribute)) {
                    // let gbbFiltersSideBarContainer = gbb.$("<div>").addClass("gbbFiltersSideBarContainer").addClass("gbbFiltersSideBarContainerSlideIn");
                    // gbbFiltersSideBarContainer.append(gbb.f.renderFiltersSideBarHTML(noteAttribute));
                    // gbb.$(".gbbPageBody").append(gbbFiltersSideBarContainer);
                    gbb.$("body").append(gbb.f.renderFiltersSideBarHTML(noteAttribute));
                    gbb.f.applyFontToFiltersSidebar();
                } else {
                    gbb.$("body").find(".gbbFiltersSideBarContainer").remove()
                }
            })

            let gbbSearchBarMainWrapper = gbb.$("<div>").addClass("gbbSearchBarMainWrapper");


            let gbbSortByMainWrapper = gbb.$("<div>").addClass("gbbSortByMainWrapper");
            gbbSortByMainWrapper.text("Sort By");

            let filtersInfo = gbb.utility.getFiltersInfo(noteAttribute)
            if (filtersInfo?.isFiltersEnabled && filtersInfo?.categories?.length > 0) {
                gbbFiltersSearchSortHeader.append(gbbFiltersMainButtonWrapper);
            }
            //gbbFiltersSearchSortHeader.append(gbbSearchBarMainWrapper);
            // gbbFiltersSearchSortHeader.append(gbb.f.renderSortByHTML(noteAttribute));
            if (gbb.gbbAddProductsPage?.state?.filterBySearch?.isSearchEnabled) {
                gbbFiltersSearchSortHeader.append(gbb.f.renderSearchBoxHTML(noteAttribute));
            }
            return gbbFiltersSearchSortHeader;
        },
        renderSortByHTML: function (noteAttribute) {
            const gbbSortByDropDownContainer = gbb.$("<div>").addClass("gbbSortByDropDownContainer");
            const gbbSortByDropDownSelect = gbb.$("<select>").addClass("gbbSortByDropDownSelect");

            let sortBy = gbb.utility.getSortByValues(noteAttribute);
            if (!sortBy.isSortByEnabled) {
                return;
            }
            let sortByCategories = [];
            Object.keys(sortBy?.sortByCategories).forEach((element) => {
                sortByCategories.push(sortBy?.sortByCategories[element])
            });



            sortByCategories?.forEach((category, index) => {
                if (index == 0) {
                    let optionEle = gbb.$("<option>").attr("value", "featured")
                        .text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.sortBy.featured) || "Featured");
                    gbbSortByDropDownSelect.append(optionEle);
                }
                if (category.id != "priceHighToLow" && category.id != "priceLowToHigh" && category.isEnabled) {
                    let optionEle = gbb.$("<option>").attr("value", category.id)
                        .text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.sortBy[category.id])); //add code for multi language here
                    //choose this value as default if value found sortBy.sortByValue
                    if (category.id === sortBy?.sortByValue) {
                        optionEle.attr("selected", "selected");
                    }

                    gbbSortByDropDownSelect.append(optionEle);

                }
            });
            gbbSortByDropDownSelect.change(async (event) => {
                gbb.utility.setSortByValues(noteAttribute, event.target.value);
                let products = await gbb.utility.getFilteredSortedProductsData(noteAttribute);
            })
            gbbSortByDropDownContainer.append(gbbSortByDropDownSelect);
            return gbbSortByDropDownContainer;
        },
        renderSearchBoxHTML: function (noteAttribute) {
            try {
                let gbbSearchBarMainWrapper = gbb.$("<div>").addClass("gbbSearchBarMainWrapper");
                let gbbSearchBarInput = gbb.$("<input>").addClass("gbbSearchBarInput").attr("type", "text").attr("placeholder", gbb.utility.renderLanguageValue(gbb.settings.languageData.general.searchLabel) || 'Search1').attr('value', gbb.gbbAddProductsPage.state?.filterBySearch?.searchQuery?.searchText || '');
                let gbbSearchBarIcon = gbb.$("<div>").addClass("gbbSearchBarIcon");
                gbbSearchBarIcon.append(SEARCH_ICON_SVG)
                gbbSearchBarMainWrapper.append(gbbSearchBarIcon);
                gbbSearchBarMainWrapper.append(gbbSearchBarInput);
                gbbSearchBarInput.on("input", async (event) => {
                    let searchedValue = event.target.value
                    let searchedProducts = await gbb.gbbAddProductsPage.f.handleSearchBundleInput(searchedValue, noteAttribute);
                    let activeCategory = gbb.gbbMultipleCategoriesPage.state.currentCategoryId;
                    await gbb.gbbAddProductsPage.f.renderProductsCardContainer(searchedProducts, noteAttribute, 'searchProductsFlow', activeCategory)
                })
                return gbbSearchBarMainWrapper;
            } catch (error) {
                gbb.utility.debugConsole("error in renderSearchBoxHTML", error)
            }
        },
        renderFiltersSideBarHTML: function (noteAttribute) {
            //contains entire filter sidebar
            let gbbProductsFiltersMainContainer = gbb.$("<div>").addClass("gbbProductsFiltersMainContainer");
            let gbbProductsFiltersContainer = gbb.$("<div>").addClass("gbbProductsFiltersContainer");

            let gbbProductsFiltersContainerHeader = gbb.$("<div>").addClass("gbbProductsFiltersContainerHeader");
            let gbbProductsFiltersContainerHeaderLabels = gbb.$("<div>").addClass("gbbProductsFiltersContainerHeaderLabels");

            let gbbProductsFiltersContainerLabel = gbb.$("<div>").addClass("gbbProductsFiltersContainerLabel");
            gbbProductsFiltersContainerLabel.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.filtersLabel) || "Filters1");
            let gbbProductsFiltersClearLabel = gbb.$("<div>").addClass("gbbProductsFiltersClearLabel");
            gbbProductsFiltersClearLabel.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.clearSelection) || "Clear Selection1");

            gbbProductsFiltersClearLabel.on("click", async (event) => {
                gbb.gbbAddProductsPage.f.resetSearchTextValue()
                gbb.utility.clearAllFilters(noteAttribute);

                let filteredProducts = await gbb.utility.getFilteredSortedProductsData(noteAttribute)
                // currentPageHTML.html(gbb.f.renderProductsHTML(filteredProducts, noteAttribute))
                gbb.utility.toggleFiltersSideBar(noteAttribute);
                setTimeout(() => {
                    gbbProductsFiltersContainer.addClass("gbbFiltersSideBarContainerSlideOut")
                    gbb.$("body").find(".gbbProductsFiltersMainContainer").remove()
                }, 500)
            })
            const gbbFilterModalClose = gbb.$("<div>").addClass("gbbFilterModalClose");
            gbbFilterModalClose.text("+");
            gbbFilterModalClose.on("click", () => {
                gbbProductsFiltersContainer.addClass("gbbFiltersSideBarContainerSlideOut")
                gbb.utility.toggleFiltersSideBar(noteAttribute);
                gbb.$("body").find(".gbbProductsFiltersMainContainer").remove()
            })

            gbbProductsFiltersMainContainer.on('click', function (event) {
                if (!gbb.$(event.target).closest(gbbProductsFiltersContainer).length) {
                    gbbProductsFiltersContainer.addClass("gbbFiltersSideBarContainerSlideOut")
                    gbb.utility.toggleFiltersSideBar(noteAttribute);
                    gbb.$("body").find(".gbbProductsFiltersMainContainer").remove()
                }
            });

            gbbProductsFiltersContainerHeaderLabels.append(gbbProductsFiltersContainerLabel);
            gbbProductsFiltersContainerHeaderLabels.append(gbbProductsFiltersClearLabel);

            gbbProductsFiltersContainerHeader.append(gbbProductsFiltersContainerHeaderLabels);
            gbbProductsFiltersContainerHeader.append(gbbFilterModalClose);
            gbbProductsFiltersContainer.append(gbbProductsFiltersContainerHeader);
            //contains one particular filter
            let gbbFiltersInfo = gbb.utility.getFiltersInfo(noteAttribute);
            //TODO
            // if(!gbbFiltersInfo.isFiltersEnabled) {
            //     return;
            // }
            if (gbbFiltersInfo.categories == 0) {
                let gbbProductsNoFilters = gbb.$("<div>").addClass("gbbProductsNoFilters");
                gbbProductsNoFilters.text("No filters have been added");
                gbbProductsFiltersContainer.append(gbbProductsNoFilters);
                gbbProductsFiltersMainContainer.append(gbbProductsFiltersContainer);
                return gbbProductsFiltersMainContainer;
            }
            gbbFiltersInfo.categories.forEach((filterCategory, index) => {

                let isFilterTagsVisible = gbb.utility.getActivatedCategoriesForFilters(noteAttribute, filterCategory);

                let gbbFilterContainer = gbb.$("<div>").attr("data-gbbFilterContainer", index).addClass("gbbFilterContainer");
                let gbbFiltersDropDownWrapper = gbb.$("<div>").attr("data-gbbFiltersDropDownWrapper", index).attr("data-role", "collapsible")
                    .addClass("gbbFiltersDropDownWrapper")
                    .addClass("gbbFiltersDropDownWrapper" + index);
                let gbbFilterLabel = gbb.$("<div>").attr("data-gbbFilterLabel", index).addClass("gbbFilterLabel").text(filterCategory.title);
                let gbbFilterDropDownButton = gbb.$("<img>").attr("data-gbbFilterDropDownButton", index).addClass("gbbFilterDropDownButton").addClass("gbbFilterDropDownButton" + index);
                gbbFilterDropDownButton.attr("src", CONSTANT_IMAGES_DROPDOWN_BUTTON);

                gbbFiltersDropDownWrapper.append(gbbFilterLabel);
                gbbFiltersDropDownWrapper.append(gbbFilterDropDownButton);

                gbbFilterContainer.append(gbbFiltersDropDownWrapper);
                if (filterCategory.type == "price") {
                    return;
                    let showPriceFilter = true;
                    gbbFilterDropDownButton.css("transform", "rotate(360deg)");
                    let gbbFilterPriceContainer = gbb.$("<div>").addClass("gbbFilterPriceContainer");
                    let gbbPriceFieldContainer = gbb.$("<div>").addClass("gbbPriceFieldContainer");
                    let gbbPriceFieldLower = gbb.$("<input>")
                        .addClass("gbbPriceFieldLower")
                        .attr("type", "range")
                        .attr("min", filterCategory.minValue)
                        .attr("max", filterCategory.maxValue)
                        .attr("value", gbb.utility.getPriceFilterValues(noteAttribute)?.minValue);


                    let gbbPriceFieldUpper = gbb.$("<input>")
                        .addClass("gbbPriceFieldUpper")
                        .attr("type", "range")
                        .attr("min", filterCategory.minValue)
                        .attr("max", filterCategory.maxValue)
                        .attr("value", gbb.utility.getPriceFilterValues(noteAttribute)?.maxValue);

                    let lowerVal = parseInt(gbbPriceFieldLower[0].value);
                    let upperVal = parseInt(gbbPriceFieldUpper[0].value);


                    gbbPriceFieldContainer.append(gbbPriceFieldLower);
                    gbbPriceFieldContainer.append(gbbPriceFieldUpper);

                    let gbbPriceTextWrap = gbb.$("<div>").addClass("gbbPriceTextWrap");

                    let gbbPriceWrap1 = gbb.$("<div>").addClass("gbbPriceWrap1");
                    //let gbbPriceWrap1Input = gbb.$("<input>").addClass("gbbPriceWrap1Input");
                    gbb.utility.debugConsole("here ar price:", gbb.utility.getPriceFilterValues(noteAttribute)?.minValue)
                    let gbbPriceWrap1Label = gbb.$("<div>").addClass("gbbPriceWrap1Label").text(gbb.utility.getCurrencySymbol() + " " + gbb.utility.getPriceFilterValues(noteAttribute)?.minValue);
                    //gbbPriceWrap1.append(gbbPriceWrap1Input);
                    gbbPriceWrap1.append(gbbPriceWrap1Label);

                    let gbbPriceWrap2 = gbb.$("<div>").addClass("gbbPriceWrap2");
                    //let gbbPriceWrap2Input = gbb.$("<input>").addClass("gbbPriceWrap2Input");
                    let gbbPriceWrap2Label = gbb.$("<div>").addClass("gbbPriceWrap2Label").text(gbb.utility.getCurrencySymbol() + " " + gbb.utility.getPriceFilterValues(noteAttribute)?.maxValue);
                    //gbbPriceWrap2.append(gbbPriceWrap2Input);
                    gbbPriceWrap2.append(gbbPriceWrap2Label);

                    gbbPriceTextWrap.append(gbbPriceWrap1);
                    gbbPriceTextWrap.append(gbbPriceWrap2);

                    gbbPriceFieldLower.on("input", (event) => {
                        lowerVal = parseInt(gbbPriceFieldLower[0].value);
                        upperVal = parseInt(gbbPriceFieldUpper[0].value);
                        if (lowerVal >= upperVal - 4) {
                            gbbPriceFieldUpper[0].value = lowerVal + 4;
                            if (upperVal == gbbPriceFieldUpper[0].max) {
                                gbbPriceFieldLower[0].value = parseInt(gbbPriceFieldUpper[0].max) - 4;
                            }
                        }
                        if (filterCategory?.minValue == lowerVal
                            && filterCategory?.maxValue == upperVal) {
                            gbb.utility.setActivatePriceFilters(noteAttribute, false);
                        } else {
                            gbb.utility.setActivatePriceFilters(noteAttribute, true);
                        }
                        gbbPriceWrap1Label.text(gbb.utility.getCurrencySymbol() + " " + event.target.value);
                        gbbPriceWrap2Label.text(gbb.utility.getCurrencySymbol() + " " + upperVal);
                        gbb.utility.setPriceFilterValues(noteAttribute, lowerVal, upperVal);
                    })

                    gbbPriceFieldLower.mouseup((event) => {
                        let filteredProducts = gbb.utility.getFilteredSortedProductsData(noteAttribute)
                        gbb.utility.toggleFiltersSideBar(noteAttribute);
                        setTimeout(() => {
                            gbb.$("body").find(".gbbProductsFiltersMainContainer").remove()
                        }, 500)
                    })

                    gbbPriceFieldUpper.on("input", (event) => {
                        lowerVal = parseInt(gbbPriceFieldLower[0].value);
                        upperVal = parseInt(gbbPriceFieldUpper[0].value);
                        if (upperVal < lowerVal + 4) {
                            gbbPriceFieldLower[0].value = upperVal - 4;
                            if (lowerVal == gbbPriceFieldLower[0].min) {
                                gbbPriceFieldUpper[0].value = 4;
                            }
                        }

                        if (filterCategory?.minValue == lowerVal && filterCategory?.maxValue == upperVal) {
                            gbb.utility.setActivatePriceFilters(noteAttribute, false);
                        } else {
                            gbb.utility.setActivatePriceFilters(noteAttribute, true);
                        }

                        gbbPriceWrap2Label.text(gbb.utility.getCurrencySymbol() + " " + event.target.value);
                        gbbPriceWrap1Label.text(gbb.utility.getCurrencySymbol() + " " + lowerVal);

                        gbb.utility.setPriceFilterValues(noteAttribute, lowerVal, upperVal);
                    })

                    gbbPriceFieldUpper.mouseup((event) => {
                        let filteredProducts = gbb.utility.getFilteredSortedProductsData(noteAttribute)
                        gbb.utility.toggleFiltersSideBar(noteAttribute);
                        setTimeout(() => {
                            gbb.$("body").find(".gbbProductsFiltersMainContainer").remove()
                        }, 500)
                    })


                    gbbFiltersDropDownWrapper.on("click", () => {
                        if (!showPriceFilter) {
                            gbb.$(".gbbFilterDropDownButton" + index).css("transform", "rotate(360deg)");
                            gbbFilterPriceContainer.show();
                        } else {
                            gbb.$(".gbbFilterDropDownButton" + index).css("transform", "rotate(180deg)");
                            gbbFilterPriceContainer.hide();
                        }
                        showPriceFilter = !showPriceFilter
                    })

                    gbbFilterPriceContainer.append(gbbPriceFieldContainer);
                    gbbFilterPriceContainer.append(gbbPriceTextWrap);

                    gbbFilterContainer.append(gbbFilterPriceContainer);
                    // if(isFilterTagsVisible) {
                    //     gbbFilterPriceContainer.show();
                    // } else {
                    //     gbbFilterPriceContainer.hide();
                    // }
                    // gbbFiltersDropDownWrapper.on("click",()=>{
                    //     if(isFilterTagsVisible) {
                    //         gbb.$(".gbbFilterDropDownButton"+index).css("transform", "rotate(180deg)");
                    //         gbbFilterTagsContainer.hide();
                    //     } else {
                    //         gbb.$(".gbbFilterDropDownButton"+index).css("transform", "rotate(360deg)");
                    //         gbbFilterTagsContainer.show();
                    //     }
                    //     isFilterTagsVisible = !isFilterTagsVisible;
                    // })

                } else {
                    let gbbFilterTagsContainer = gbb.$("<div>").addClass("gbbFilterTagsContainer").addClass("gbbFilterTagsContainer" + index);

                    filterCategory.tags.forEach((tag, tagIndex) => {
                        //add event listener to tagcontainer
                        let gbbProductsFilterTagContainer = gbb.$("<div>").addClass("gbbProductsFilterTagContainer");
                        let gbbProductsFilterTagCheckbox = gbb.$("<input>").addClass("gbbProductsFilterTagCheckbox").attr("type", "checkbox").attr("val", tag.value);
                        if (gbb.utility.getActivatedFilters(noteAttribute).findIndex(e => e.label == tag.label) != -1) {
                            gbbProductsFilterTagCheckbox.prop("checked", true);
                        }
                        const filterClicked = async () => {
                            gbb.gbbAddProductsPage.f.resetSearchTextValue()
                            if (gbb.utility.getActivatedFilters(noteAttribute).findIndex(e => e.label == tag.label) == -1) {
                                gbb.utility.setActivatedFilters(tag, noteAttribute, "add", filterCategory);
                            } else {
                                gbb.utility.setActivatedFilters(tag, noteAttribute, "remove", filterCategory);
                            }
                            // @ashfaq
                            let filteredProducts = await gbb.utility.getFilteredSortedProductsData(noteAttribute)

                            gbb.utility.toggleFiltersSideBar(noteAttribute);
                            // setTimeout(() => {
                            //     gbb.$("body").find(".gbbProductsFiltersMainContainer").remove()
                            // }, 500)
                        }
                        gbbProductsFilterTagCheckbox.on("click", (event) => {
                            // event.preventDefault();
                            // event.stopPropagation();
                            filterClicked()
                        })

                        let gbbProductsFilterTagLabel = gbb.$("<div>").addClass("gbbProductsFilterTagLabel").text(tag.label);

                        gbbProductsFilterTagLabel.on("click", (event) => {
                            event.preventDefault();
                            event.stopPropagation();
                            if (gbbProductsFilterTagCheckbox.prop("checked")) {
                                gbbProductsFilterTagCheckbox.prop("checked", false);
                            } else {
                                gbbProductsFilterTagCheckbox.prop("checked", true);
                            }
                            filterClicked()
                        })
                        gbbProductsFilterTagContainer.append(gbbProductsFilterTagCheckbox);
                        gbbProductsFilterTagContainer.append(gbbProductsFilterTagLabel);

                        gbbFilterTagsContainer.append(gbbProductsFilterTagContainer);
                    })

                    if (isFilterTagsVisible) {
                        gbbFilterTagsContainer.show();
                    } else {
                        gbbFilterTagsContainer.hide();
                    }
                    gbbFiltersDropDownWrapper.on("click", () => {
                        if (isFilterTagsVisible) {
                            gbb.$(".gbbFilterDropDownButton" + index).css("transform", "rotate(180deg)");
                            gbbFilterTagsContainer.hide();
                        } else {
                            gbb.$(".gbbFilterDropDownButton" + index).css("transform", "rotate(360deg)");
                            gbbFilterTagsContainer.show();
                        }
                        isFilterTagsVisible = !isFilterTagsVisible;
                    })
                    gbbFilterContainer.append(gbbFilterTagsContainer);
                }
                gbbProductsFiltersContainer.append(gbbFilterContainer);
            })
            gbbProductsFiltersMainContainer.append(gbbProductsFiltersContainer);
            return gbbProductsFiltersMainContainer;
        },
        renderProductsHTML: function (products, noteAttribute, category) {

            // products 
            products = JSON.parse(JSON.stringify(products))
            // products?.variants?.length>1 ?alert("multiple variants")
            const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()
            const gbbProductsContainer = gbb.$("<div>").addClass("gbbProductsContainer");
            const gbbProductsLabel = gbb.$("<p>").addClass("gbbProductsLabel");
            let gbbProductsItemsContainer = gbb.$("<div>").addClass("gbbProductsItemsContainer");
            const gbbProductsItemsArray = [];
            let addProductsPageArr = ADDPRODUCT_PAGES_LIST
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                gbbProductsLabel.text(gbb.utility.renderLanguageValue(gbb.settings.languageData.productPage.selectProductsLabel));
            } else if (noteAttribute == "reviewPage") {
                gbbProductsLabel.text(gbb.utility.renderLanguageValue(gbb.settings.languageData.reviewPage.addOnsLabel));
            }
            if (!products || products.length == 0) {
                if (noteAttribute == "reviewPage") { //no need to show no products label when on review page
                    return;
                }
                // else {
                //     const gbbProductsNotAvailable = gbb.$("<p>").addClass("gbbProductsNotAvailable");
                //     gbbProductsNotAvailable.text(gbb.utility.renderLanguageValue(gbb.settings.languageData.general.noProductsAvailable));

                //     //replace gbbProductsNotAvailable class if available
                //     if (gbb.$(".gbbProductsNotAvailable").length > 0) {
                //         gbb.$(".gbbProductsNotAvailable").replaceWith(gbbProductsNotAvailable);
                //     } else {
                //         gbbProductsItemsContainer.append(gbbProductsNotAvailable);
                //     }
                //     return gbbProductsContainer;
                // }  not in use @mufadal
            } else {
                // gbb.utility.debugConsole("Products here is", products)
                //  gbbProductsItemsContainer = gbb.$("<div>").addClass("gbbProductsItemsContainer");
                products = products?.filter((product) => {
                    return product.available == true;
                });

                products.forEach((product, index) => {
                    let currentProductPersonalization = gbb.utility.getCurrentProductPersonalization(product);
                    let doesThisProductHavePersonalization = currentProductPersonalization.isProductPersonalizationEnabled || false;

                    if (doesThisProductHavePersonalization) {
                        product.renderChooseOptionsButton_forcefully = true;
                    }


                    const gbbProductItem = gbb.$("<div>").addClass("gbbProductItem").clone();
                    gbbProductItem.css("background", gbb.settings.pageCustomizationData.productCard.productCardBgColor);
                    gbbProductItem.css("color", gbb.settings.pageCustomizationData.productCard.productCardTextColor);


                    const gbbProductTextContainer = gbb.$("<div>").addClass("gbbProductTextContainer");

                    const gbbProductDynamicContentContainer = gbb.$("<div>").addClass("gbbProductDynamicContentContainer");

                    gbbProductDynamicContentContainer.html(gbb.gbbAddProductsPage.f.renderProductDynamicContent(product,'PRODUCT_CARD'));

                    const gbbProductItemTitle = gbb.$("<div>").addClass("gbbProductItemTitle").css("cursor", "pointer");
                    const gbbProductActionContainer = gbb.$("<div>").addClass("gbbProductActionContainer");
                    const gbbProductReadMore = gbb.$("<div>").addClass("gbbProductReadMore").text("Read More >>");
                    const gbbProductItemPricesContainer = gbb.$("<div>").addClass("gbbProductItemPricesContainer");
                    const gbbProductItemPrice = gbb.$("<div>").addClass("gbbProductItemPrice");
                    const gbbProductItemCompareAtPrice = gbb.$("<div>").addClass("gbbProductItemCompareAtPrice");
                    const gbbProductButtonWrapper = gbb.$("<div>").addClass("gbbProductButtonWrapper");
                    // const gbbProductButton = gbb.$("<button>").addClass("gbbProductAddButton");
                    const gbbProductButton = gbb.$("<div>").addClass("gbbProductAddButton");

                    const gbbProductImageContainer = gbb.$("<div>").addClass("gbbProductImageContainer")
                    const gbbProductImage = gbb.$("<img>").addClass("gbbProductImage");
                    const gbbProductItemOverLay = gbb.$("<div>").addClass("gbbProductItemOverLay");
                    const gbbOverLayIconContainer = gbb.$("<div>").addClass("gbbOverLayIconContainer");

                    gbbProductItem.attr("productId", product?.id)
                    let firstvariantid = product.variants.length > 0 ? product?.variants[0]?.id : "";
                    gbbProductItem.attr("firstvariantid", firstvariantid);
                    if (product.customProductAttribute) {
                        gbbProductItem.attr('custom-product-attribute', product.customProductAttribute)
                    }
                    // gbb.utility.debugConsole("product details array", product.title, index)

                    for (let i = 0; i < product.images.length; i++) {
                        let image = product.images[i];
                        if (!image) {
                            continue;
                        }
                        if (image) {
                            gbbProductImageContainer.append(gbb.$("<img>").addClass('gbbProductImageContainerImg' + i).addClass("gbbProductImageContainerImg").addClass("gbbFade"))
                            gbbProductImageContainer.find('.gbbProductImageContainerImg' + i).attr('src', image).css('display', 'none')
                        }
                        if (i == 0) {
                            gbbProductImageContainer.find('.gbbProductImageContainerImg' + i).css('display', 'block').on("click", () => {
                                gbb.utility.debugConsole("triggering showProductVariantsModal from image click", product.title)
                                event.preventDefault();
                                event.stopPropagation();
                                gbb.f.showProductVariantsModal(product, gbbProductButton, noteAttribute, category)
                            })
                        }
                        if (image) {
                            break;
                        }
                    }
                    //push an anchor tag
                    if (product.images.length > 1) {
                        //let gbbProductSliderNavigatior = gbb.$("<div>").addClass('gbbProductSliderNavigatior')
                        gbbProductImageContainer.append(gbb.$("<a>").addClass('gbbPrevImage'))
                        gbbProductImageContainer.find('.gbbPrevImage').html("&#10094;");
                        //add an onclick event to the anchor tag
                        gbbProductImageContainer.append(gbb.$("<a>").addClass('gbbNextImage'))
                        gbbProductImageContainer.find('.gbbNextImage').html("&#10095;");

                        gbbProductImageContainer.find('.gbbPrevImage').click(function () {
                            gbb.utility.slider.plusSlides(gbbProductImageContainer, 1)
                        })
                        gbbProductImageContainer.find('.gbbNextImage').click(function () {
                            gbb.utility.slider.minusSlides(gbbProductImageContainer, 1)
                        })
                        //gbbProductImageContainer.append(gbbProductImageContainer);
                        //hide the arrows
                        gbbProductImageContainer.find('.gbbPrevImage').css("display", "none");
                        gbbProductImageContainer.find('.gbbNextImage').css("display", "none");
                    }

                    gbbProductImageContainer.append(gbb.f.renderTagsPillsHTML(product, noteAttribute, category));
                    gbbProductItem.append(gbbProductImageContainer);

                    // gbbProductItem.append(gbb.f.renderTagsPillsHTML(product, noteAttribute, category));


                    gbbProductItemTitle.on("click", () => {
                        gbb.f.showProductVariantsModal(product, gbbProductButton, noteAttribute, category)
                    })

                    gbbProductItemOverLay.on("click", () => {
                        gbb.f.showProductVariantsModal(product, gbbProductButton, noteAttribute, category)
                    })





                    // gbbProductReadMore.on("click",()=>{
                    //     gbb.f.showProductVariantsModal(product, gbbProductButton, noteAttribute, category)
                    // })
                    //gbbProductButton.css("background", gbb.settings.pageCustomizationData.productCard.productCardButtonColor);
                    //gbbProductButton.css("color", gbb.settings.pageCustomizationData.productCard.productCardButtonTextColor);

                   

                    let _productPrice = product.price
                    let _compareAtPrice = product.compare_at_price
                    if (isPurchaseTypeSubscription) {
                        _productPrice = gbb.gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId(product.variants[0].id);
                        _compareAtPrice = product.price
                    }
                    if (gbb.settings?.merchantInfo?.bundleSettings?.showCompareAtPrice == true && _compareAtPrice && (isPurchaseTypeSubscription || _compareAtPrice > product.price)) {
                        gbbProductItemCompareAtPrice.text(gbb.utility.formatPrice(_compareAtPrice));
                    }
                    gbbProductItemPrice.text(gbb.utility.formatPrice(_productPrice));
                    gbbProductItemPricesContainer.append(gbbProductItemCompareAtPrice);
                    gbbProductItemPricesContainer.append(gbbProductItemPrice);

                    if (product.variants?.length == 1 && product.available == true && product.renderChooseOptionsButton_forcefully != true) {
                        let argsObj = {
                            variantId: product.variants[0].id,
                            productData: product,
                        }
                        let uniqueItemKey = gbb.utility.getUniqueIdForVariant(argsObj);
                        // const isItemInCart = gbb.utility.checkIfItemPresentInGiftBoxCart(product.variants[0].id);
                        // gbb.utility.debugConsole("isItemInCart:", isItemInCart);
                        let data = {
                            productData: product,
                            variant: product.variants[0],
                            // _boxProduct: product?.properties["_boxProduct"],
                            // _Category: product?.properties["_Category"]
                        }
                        const isItemInCart = gbb.utility.checkIfItemPresentInGiftBoxCart(data?.variant?.id, { uniqueItemKey });
                        let typeOfProduct = "singleVariant";
                        //price of the first variant
                        let price = product.variants[0].price;
                        let compareAtPrice = product.variants[0]?.compare_at_price || null
                        compareAtPrice = compareAtPrice > price ? compareAtPrice : null;

                        if (isPurchaseTypeSubscription) {
                            price = gbb.gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId(product.variants[0].id);
                            compareAtPrice = product.variants[0].price
                        }
                        if (gbb?.settings?.merchantInfo?.bundleSettings?.showCompareAtPrice && compareAtPrice && (isPurchaseTypeSubscription || compareAtPrice > 0)) {
                            gbbProductItemCompareAtPrice.text(gbb.utility.formatPrice(compareAtPrice));
                        } else if (!compareAtPrice) {
                            gbbProductItemCompareAtPrice.text("");
                        }

                        
                        gbbProductItemPrice.text(gbb.utility.formatPrice(price));
                        if (isItemInCart) {
                            //activate quantity button
                            gbb.utility.activateQuantityButtons(gbbProductButton, data, noteAttribute, typeOfProduct, category);
                        } else {
                            gbb.utility.activateAddButton(gbbProductButton, data, noteAttribute, typeOfProduct, category);
                        }
                    } else if (product.renderChooseOptionsButton_forcefully == true || product.variants?.length > 1 && product.available == true) {
                        let variantProduct = gbb.utility.getTheVariantProductPresentInCart(product);
                        let data = {
                            productData: product,
                            variant: variantProduct
                        }
                        let typeOfProduct = "multipleVariants";
                        if (variantProduct && Object.keys(variantProduct).length > 0) {
                            let variantPrice = variantProduct.price
                            if (isPurchaseTypeSubscription) {
                                variantPrice = gbb.gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId(variantProduct.id);
                            }
                            gbb.utility.activateQuantityButtons(gbbProductButton, data, noteAttribute, typeOfProduct, category);
                            gbbProductItemPrice.text(gbb.utility.formatPrice(variantPrice));
                        } else {
                            gbb.utility.activateAddButton(gbbProductButton, data, noteAttribute, typeOfProduct, category);
                        }

                    } else {
                    }

                    // if(product.variants.length == 1 ){
                    //     // gbbProductItemTitle.text(`${product.variants[0].title} (${product?.options[0]?.name})`);
                    //     gbbProductItemTitle.text(`${product.variants[0].title}`);
                    // }else{
                    //     gbbProductItemTitle.text(product.title);
                    // }
                    let gbbProductTitleOnly = gbb.$("<div>").addClass("gbbProductTitleOnly").text(product.title)
                    let gbbVariantTitle = gbb.$("<div>").addClass("gbbVariantTitle").text(product?.variantName);
                    let divsForTitle = [];
                    divsForTitle.push(gbbProductTitleOnly);
                    divsForTitle.push(gbbVariantTitle);

                    gbbProductItemOverLay.append(gbbOverLayIconContainer)
                    // gbbProductItemTitle.text(product.title);
                    gbbProductItemTitle.html(divsForTitle);

                    gbbProductTextContainer.append(gbbProductItemTitle);
                    gbbProductButtonWrapper.append(gbbProductButton);
                    gbbProductActionContainer.append(gbbProductItemPricesContainer);
                    gbbProductActionContainer.append(gbbProductButtonWrapper);
                    gbbProductImageContainer.append(gbbProductItemOverLay);

                    gbbProductItem.append(gbbProductTextContainer);
                    if (gbb.settings?.app?.integrations?.judgeme?.isEnabled) {
                        let starsHTML = gbb.gbbIntegrations?.judgeme?.f?.getStarsHTMLByProductId(product.id);
                        if (starsHTML) {
                            let reviewStarsContainer = gbb.$("<div>").addClass("gbbReviewStarsContainer");
                            let reviewStars = gbb.$("<div>").addClass("gbbReviewStars");
                            reviewStars.html(starsHTML);
                            reviewStarsContainer.append(reviewStars);
                            let appendTo = gbb.$('.gbbProductsCardLayoutV2').length > 0 ? gbbProductItem : gbbProductTextContainer;
                            appendTo.append(reviewStarsContainer);
                        }
                    }
                    if (gbb.settings.bundleSettings?.metafieldNameSpaceAndKeys.length > 0 || gbb.settings.app?.dynamicScriptForHTMLContent) {
                        gbbProductItem.append(gbbProductDynamicContentContainer)
                    }
                    gbbProductItem.append(gbbProductActionContainer);
                    // gbbProductItem.append(gbbProductReadMore);

                    if (isPurchaseTypeSubscription && gbb.gbbSubscriptionProductsPage.state.showDiscountOnProductCards) {
                        const discountRibbon = gbb.gbbSubscriptionProductsPage.f.prepareSubscriptionProductDiscountRibbonUI(product.variants[0])
                        if (discountRibbon) {
                            gbbProductItem.append(discountRibbon)
                        }
                    }
                    if (gbb.state.currentPageId == "personalizationPage" && gbb.gbbAddonProducts.state.isEnabled) {
                        let {type,value,discountText:addonsDiscountRibbonContent} = gbb.gbbAddonProducts.f.prepareDiscountRibbonContentForProductAddons()
                        if (addonsDiscountRibbonContent) {
                            let isFreeProduct = value == 100 // in future for discountType based on amount calculate product price and discounted price for calculatng isFreeProduct
                            if (isFreeProduct) {
                                gbbProductItem.attr("free-addon-product",true)
                            }
                            let ribbonUIOptions = {
                                ribbonContent: addonsDiscountRibbonContent,
                                ribbonClassName: "gbbAddonDiscountRibbon",
                            }
                            let addonDiscountsRibbonHTML = gbb.utility.prepareProductCardRibbonUI(ribbonUIOptions)
                            gbbProductItem.append(addonDiscountsRibbonHTML)
                        }
                    }
                    gbbProductsItemsContainer.append(gbbProductItem);
                    gbbProductsItemsArray.push(gbbProductItem);
                })


                //in gbbProductItemsArray, just figure out the -15 index and loadMoreIndicator as the tag
                let totalNumberOfItemsInArray = gbbProductsItemsArray.length;
                let loadMoreIndicatorItem;

                //attach loadMoreIndicator in the 70% of the array
                if (totalNumberOfItemsInArray > 0) {
                    let indexToAttachLoadMoreIndicator = Math.floor(totalNumberOfItemsInArray * 0.7);
                    loadMoreIndicatorItem = gbbProductsItemsArray[indexToAttachLoadMoreIndicator];
                    //add the data attribute to the loadMoreIndicatorItem
                    loadMoreIndicatorItem.attr("data-load-more-indicator-status", "active");
                }

                //gbbProductsContainer.append(gbbProductsLabel);
                // gbbProductsContainer.append(gbbProductsItemsContainer);
                // gbb.gbbAddProductsPage.f.hideExcessProducts(gbbProductsContainer);
                return gbbProductsItemsArray;
                // return gbbProductsItemsContainer;
            }
        },

        renderFooterButtons: function (noteAttribute, gbbFooterNextButton, renderNewTemplateDesign = false) {

            const gbbFooterButtonsWrapper = gbb.$("<div>").addClass("gbbFooterButtonsWrapper");
            if (renderNewTemplateDesign || gbb.f.getPreviousNavigationItem()) {
                // const gbbFooterBackButton = gbb.$("<button>").addClass("gbbFooterBackButton");
                const gbbFooterBackButton = gbb.$("<div>").addClass("gbbFooterBackButton");
                gbbFooterBackButton.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.general.backButtonText));
                gbbFooterBackButton.css("background", gbb.settings.pageCustomizationData.cartFooter.cartFooterBackButtonColor);
                gbbFooterBackButton.css("color", gbb.settings.pageCustomizationData.cartFooter.cartFooterBackButtonTextColor);
                if (renderNewTemplateDesign && !gbb.f.getPreviousNavigationItem()) {
                    //disable the button
                    gbbFooterBackButton.addClass("gbbDisabled");
                }
                gbbFooterBackButton.on("click", function () {
                    gbb.utility.renderTemporaryLoadingSpinner("show")
                    gbb.giftboxbuilderPage.action.onPrevNavigationBYOB();
                    //add the gbbDisabled class to button
                    gbb.utility.disableElement(gbbFooterBackButton, 1000);
                    gbb.gbbBrowser.emitCustomEvent({
                        eventName: "gbb-back-button-click",
                        attachEventTo: gbbFooterBackButton[0]
                    })
                })
                gbbFooterButtonsWrapper.append(gbbFooterBackButton);
            }
            if (renderNewTemplateDesign) {
                gbbFooterButtonsWrapper.append(gbb.f.renderFooterTotalContainer());
            }
            // const gbbFooterNextButton = gbb.$("<button>").addClass("gbbFooterNextButton");
            //gbbFooterNextButton = gbb.$("<div>").addClass("gbbFooterNextButton");
            gbbFooterNextButton.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.general.nextButtonText));
            gbbFooterNextButton.css("background", gbb.settings.pageCustomizationData.cartFooter.cartFooterNextButtonColor);
            gbbFooterNextButton.css("color", gbb.settings.pageCustomizationData.cartFooter.cartFooterNextButtonTextColor);
            gbbFooterNextButton.on("click", async function () {
                await gbb.utility.checkConditionsAndProceedToNextPage(noteAttribute, gbbFooterNextButton);
                gbb.gbbBrowser.emitCustomEvent({
                    eventName: "gbb-next-button-click",
                    attachEventTo: gbbFooterNextButton[0]
                })
            })
            gbbFooterButtonsWrapper.append(gbbFooterNextButton);
            return gbbFooterButtonsWrapper;
        },

        renderCartProductsFooterHTMLForMobile: function (noteAttribute, gbbProductsFooterHTML, gbbPageFooterHTML, updateFooterFlow) {
            let renderAddonsMessaging  = gbb.gbbAddonProducts.f.checkIfAddonsMessagingNeeded()
            let renderNewTemplateDesign = gbb.$('.gbbProductsCardLayoutV2').length > 0
            let renderProductSlotsFooter = gbb.settings.stepsConfigurationData?.isProductSlotsEnabled && gbb.gbbAddProductsPage?.state?.isEveryConditionHaveTypeQuantity;
            const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()

            gbbProductsFooterHTML.css("grid-template-columns", "1fr");
            gbbProductsFooterHTML.addClass("gbbProductsFooterHTMLForMobile")
            let _boxData = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
            let products = _boxData?.items || [];
            let gbbViewProductsLabelAndTotalContainer = gbb.$("<div>").addClass("gbbViewProductsLabelAndTotalContainer");

            const gbbFooterTotalContainer = gbb.f.renderFooterTotalContainer();

            let gbbViewCartProductsLink = gbb.$("<div>").addClass("gbbViewCartProductsLink");
            gbbViewCartProductsLink.text(gbb?.settings?.languageData?.general?.viewCartProductsLabel?.value || "View Selected Products");
            gbbViewCartProductsLink.append(" ").append(`(${_boxData.item_count})`)
            gbbViewCartProductsLink.on("click", () => {
                gbb.f.renderCartProductsModal(noteAttribute);
            })

            gbbViewProductsLabelAndTotalContainer.append(gbbViewCartProductsLink);
            gbbViewProductsLabelAndTotalContainer.append(gbbFooterTotalContainer);

            let gbbFooterNextButton = gbb.$("<div>").addClass("gbbFooterNextButton");
            const gbbFooterButtonsWrapper = gbb.f.renderFooterButtons(noteAttribute, gbbFooterNextButton, renderNewTemplateDesign);
            let gbbFooterButtonsContainer = gbb.$(`<div>`).addClass('gbbFooterButtonsContainer')
            const gbbFooterProductsContainer = gbb.$("<div>").addClass("gbbFooterProductsContainer");
            if (renderNewTemplateDesign) {
                if (products.length == 0) {
                    gbb.$('body').css("overflow-y", DEFAULT_BODY_OVERFLOW_VALUE)
                    gbb.gbbAddProductsPage.state.showBoxProductsInFooter = false;
                }// reset drawer values
                products.forEach((product) => {
                    const gbbFooterProductContainer = gbb.$("<div>").addClass("gbbFooterProductContainer");
                    // gbb.utility.debugConsole("product:", product)
                    //attach a data attriute to the product container
                    gbbFooterProductContainer.attr("productId", product?.product_id);
                    gbbFooterProductContainer.attr("variantId", product?.variant_id)

                    gbbFooterProductContainer.attr("_boxProduct", product?.properties["_boxProduct"]);
                    gbbFooterProductContainer.attr("_Category", product?.properties["_Category"]);

                    let argsObj = {
                        variantId: product.variant_id,
                        productData: product,
                    }


                    let uniqueGbbItemKey = gbb.utility.getUniqueIdForVariant(argsObj)
                    gbbFooterProductContainer.attr("_uniqueGbbItemKey", uniqueGbbItemKey);




                    const gbbFooterProductImageContainer = gbb.$("<div>").addClass("gbbFooterProductImageContainer");
                    const gbbFooterProductImage = gbb.$("<img>").addClass("gbbFooterProductImage");
                    gbbFooterProductImage.attr("src", product.image);
                    const gbbFooterProductTextContainer = gbb.$("<div>").addClass("gbbFooterProductTextContainer");
                    const gbbFooterProductTitle = gbb.$("<div>").addClass("gbbFooterProductTitle");
                    const gbbFooterProductQtyPriceContainer = gbb.$("<div>").addClass("gbbFooterProductQtyPriceContainer");
                    const gbbFooterProductPrice = gbb.$("<div>").addClass("gbbFooterProductPrice");
                    const gbbFooterProductQuantity = gbb.$("<div>").addClass("gbbFooterProductQuantity");


                    //a button to remove the product from the cart
                    const gbbFooterProductRemoveButton = gbb.$("<div>").addClass("gbbFooterProductRemoveButton");
                    // x icon for the remove button
                    const gbbFooterProductRemoveButtonIcon = gbb.$("<div>").addClass("gbbFooterProductRemoveButtonIcon");


                    // gbbFooterProductRemoveButtonIcon.css("color", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconTextColor);
                    // gbbFooterProductRemoveButton.css("background", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconBgColor)
                    gbbFooterProductRemoveButtonIcon.append(CONSTANT_CLOSE_ICON_SVG);
                    gbbFooterProductRemoveButton.append(gbbFooterProductRemoveButtonIcon)
                    gbbFooterProductRemoveButton.on("click", async () => {
                        //    await gbb.f.removeProductFromCart({id: product.variant_id});
                        let variant = {
                            id: product.variant_id,
                            _boxProduct: product?.properties["_boxProduct"],
                            _Category: product?.properties["_Category"],
                            _uniqueGbbItemKey: uniqueGbbItemKey
                            // _uniqueGbbItemKey : gbbFooterProductContainer.attr("_uniqueGbbItemKey")
                        }
                        if (gbb.settings.giftMessage.messageProduct && gbb.settings.giftMessage.messageProduct.product && gbb.settings.giftMessage.messageProduct.product.variants) {
                            const variantIdForMessage = gbb.settings.giftMessage.messageProduct.product.variants[0].id;
                            if (variantIdForMessage == product.variant_id) {
                                gbb.gbbPersonalizePage.state.customerUploadsResponse = {};
                            }
                        }
                        await gbb.utility.removeFromCart({ variant: variant });
                        gbb.gbbAddProductsPage.f.updateProductCard(product.product_id, variant.id);
                        gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
                    })

                    gbbFooterProductTitle.text(product.title);
                    let _productPrice = product.price
                    if (isPurchaseTypeSubscription) {
                        _productPrice = gbb.gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId(product?.variant_id);
                    }
                    gbbFooterProductPrice.text(gbb.utility.formatPrice(_productPrice));
                    gbbFooterProductQuantity.text("x" + product.quantity);
                    gbbFooterProductImageContainer.append(gbbFooterProductImage);

                    gbbFooterProductTextContainer.append(gbbFooterProductTitle);
                    gbbFooterProductQtyPriceContainer.append(gbbFooterProductPrice);
                    gbbFooterProductQtyPriceContainer.append(gbbFooterProductQuantity);
                    gbbFooterProductTextContainer.append(gbbFooterProductQtyPriceContainer);

                    let pageIdTheProductWasAddedFrom = product?.properties["_boxProduct"]
                    // @ashfaq append commented
                    if (gbb.utility.checkIfRemoveButtonShouldBeAppended(product?.variant_id, pageIdTheProductWasAddedFrom)) {
                        gbbFooterProductContainer.append(gbbFooterProductRemoveButton);
                    }

                    gbbFooterProductContainer.append(gbbFooterProductImageContainer);
                    gbbFooterProductContainer.append(gbbFooterProductTextContainer);
                    gbbFooterProductsContainer.append(gbbFooterProductContainer);
                })
                let displayValue = gbb.gbbAddProductsPage.state.showBoxProductsInFooter ? 'grid' : 'none'
                gbbFooterButtonsContainer.css("background", gbb.settings.pageCustomizationData?.cartFooter?.cartFooterButtonsContainerBgColor || '#f6f6f6')
                gbbFooterButtonsContainer.append(gbbFooterButtonsWrapper);
                gbbFooterProductsContainer.css('display', displayValue)
                gbbProductsFooterHTML.append(gbbFooterProductsContainer);
                if (gbbPageFooterHTML.find('.gbbDiscountFooterHTML').length <= 0) {
                    gbbPageFooterHTML.append(gbb.gbbAddProductsPage.f.renderShowBoxProductsInFooterHTML())
                } // if discount is not enable then will show selected products
            }
            else if (products.length > 0) {
                gbbProductsFooterHTML.append(gbbViewProductsLabelAndTotalContainer);
            }
            let footerButtonsContainerForMobile = renderNewTemplateDesign ? gbbFooterButtonsContainer : gbbFooterButtonsWrapper
            if (renderProductSlotsFooter) {
                let gbbSlotFooterProductsContainer = gbb.f.renderProductSlotsFooterHTML(noteAttribute);
                let isDrawerOpen = gbb.gbbAddProductsPage?.state?.showBoxProductsInFooter || false
                if (isDrawerOpen) {
                    gbbSlotFooterProductsContainer.css("display", "none")
                }

                if (updateFooterFlow == "updateFooterWithoutAppending" && gbb.$(".gbbSlotFooterProductsContainerWrapper").length > 0) {
                    if (!isDrawerOpen && products?.length == 0 && !gbb.$(".gbbSlotFooterProductsContainer").is(":visible")) {
                        gbb.$(".gbbSlotFooterProductsContainerWrapper").slideDown(100)
                    }
                    let productsContainer = gbbSlotFooterProductsContainer.find(".gbbSlotFooterProductContainer")
                    gbb.$(".gbbSlotFooterProductsContainer").html(productsContainer)
                    gbb.$(".gbbFooterProductsContainer").replaceWith(gbbFooterProductsContainer)
                    gbb.gbbAddProductsPage.f.autoScrollSlots()
                    gbb.$(".gbbFooterButtonsWrapper").replaceWith(gbbFooterButtonsWrapper)
                    gbb.$(".gbbCartIconWithQuantityContainer").html(gbb.gbbAddProductsPage.f.renderCartIconWithQuantityHTML())
                    let gbbPageFooterHTML = gbb.$(".gbbPageFooterHTML")
                    if (renderAddonsMessaging || gbb.settings?.discountsData?.isDiscountEnabled && gbb.settings?.discountsData?.isShowDiscountsEnabled && gbb.settings?.discountsData?.rules?.length > 0) {
                        let discountFooterHTML = gbb.gbbDiscountComponent.f.discountStatusFooterHTML()
                        discountFooterHTML.find(".gbbDiscountMessageContainer").on("click", gbb.gbbAddProductsPage.f.toggleBoxProductsDisplayFooter)
                        gbb.$(".gbbDiscountFooterHTML").html(discountFooterHTML)
                    }
                    // gbbPageFooterHTML.find(".gbbDiscountMessageContainer").on("click", gbb.gbbAddProductsPage.f.toggleBoxProductsDisplayFooter)
                    return gbbPageFooterHTML
                } else {
                    gbbProductsFooterHTML.append(gbbSlotFooterProductsContainer);
                }
            }
            gbbProductsFooterHTML.append(footerButtonsContainerForMobile);
            gbbPageFooterHTML.append(gbbProductsFooterHTML);
            if (renderNewTemplateDesign) {
                let gbbCartIconWithQuantityContainer = gbb.gbbAddProductsPage.f.renderCartIconWithQuantityHTML()

                gbbCartIconWithQuantityContainer.click(gbb.gbbAddProductsPage.f.toggleBoxProductsDisplayFooter)

                gbbPageFooterHTML.append(gbbCartIconWithQuantityContainer)
                gbbPageFooterHTML.find(".gbbDiscountMessageContainer").on("click", gbb.gbbAddProductsPage.f.toggleBoxProductsDisplayFooter)
            }
            if (gbb.utility.checkIfBrandingShouldBeVisible()) {
                gbbPageFooterHTML.append(gbb.utility.renderPoweredByLabel());
            }
            return gbbPageFooterHTML;
        },
        renderFooterTotalContainer: function () {
            const gbbFooterTotalContainer = gbb.$("<div>").addClass("gbbFooterTotalContainer");
            let totalLabelTextColor = gbb.settings.pageCustomizationData.cartFooter.cartFooterTotalLabelColor || gbb.settings.pageCustomizationData.cartFooter.cartFooterTextColor;
            const gbbFooterTotalLabel = gbb.$("<div>").addClass("gbbFooterTotalLabel").css("color", totalLabelTextColor)
            const gbbFooterTotalValueContainer = gbb.$("<div>").addClass("gbbFooterTotalValueContainer").css("color", gbb.settings.pageCustomizationData?.cartFooter?.cartFooterTextColor)

            // const gbbFooterOriginalTotalValue = gbb.$("<div>").addClass("gbbFooterOriginalTotalValue").css("color", "#625f5f");
            const gbbFooterOriginalTotalValue = gbb.$("<div>").addClass("gbbFooterOriginalTotalValue").addClass("gbbFooterOriginalTotalValue")
            gbbFooterTotalLabel.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.reviewPage.totalLabel) || "Total");
            gbbFooterOriginalTotalValue.append(gbb.utility.getGiftBoxProductsTotalWithCurrency());

            const gbbFooterDiscountedTotalValue = gbb.$("<div>");
            let finalPriceFontColor = gbb.settings.pageCustomizationData?.cartFooter?.cartFooterFinalPriceFontColor || gbb.settings.pageCustomizationData?.cartFooter?.cartFooterTextColor;
            if (gbb.settings?.discountsData?.isDiscountEnabled && gbb.settings?.discountsData?.isShowDiscountsEnabled) {
                gbbFooterDiscountedTotalValue.addClass("gbbFooterDiscountedTotalValue").css("color", finalPriceFontColor)
            } else {
                gbbFooterDiscountedTotalValue.addClass("gbbFooterTotalValue").css("color", finalPriceFontColor)
            }
            gbbFooterTotalLabel.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.reviewPage.totalLabel) || "Total");

            let originalTotal = gbb.state.giftBoxCartData
            // originalTotal = parseInt(originalTotal.total_price / 100);
            originalTotal = parseFloat(originalTotal.total_price / 100);

            let discountedTotal = gbb.utility.getGiftBoxProductsDiscountedTotal();
            let formattedDiscountedPrice = gbb.utility.getGiftBoxProductsTotalWithCurrency();

            if (gbb.settings?.discountsData?.isDiscountEnabled && gbb.settings?.discountsData?.isShowDiscountsEnabled && gbb.utility.getGiftBoxProductsDiscountedTotal() != originalTotal) {
                discountedTotal = gbb.utility.getGiftBoxProductsDiscountedTotal();
                // formattedDiscountedPrice = gbb.utility.getCurrencySymbol() + "" + parseFloat(discountedTotal).toFixed(2);
                let discountedTotalInShopifyFormat = discountedTotal * 100;
                formattedDiscountedPrice = gbb.utility.formatPrice(discountedTotalInShopifyFormat)
                gbbFooterTotalValueContainer.append(gbbFooterOriginalTotalValue);
            }
            gbbFooterDiscountedTotalValue.append(formattedDiscountedPrice);

            gbbFooterTotalValueContainer.append(gbbFooterDiscountedTotalValue)

            gbbFooterTotalContainer.append(gbbFooterTotalLabel);
            gbbFooterTotalContainer.append(gbbFooterTotalValueContainer);
            return gbbFooterTotalContainer;
        },
        renderProductSlotsFooterHTML: function (noteAttribute) {
            try {
                let gbbSlotFooterProductsContainerWrapper = gbb.$("<div>").addClass("gbbSlotFooterProductsContainerWrapper");
                let gbbSlotFooterProductsContainer = gbb.$("<div>").addClass("gbbSlotFooterProductsContainer");
                let totalNoOfSlotsRequired = gbb.gbbAddProductsPage?.state?.totalProductSlotsRequired || 0;
                let boxData = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
                let boxProducts = boxData?.items || [];
                boxProducts.forEach((product) => {
                    let gbbSlotFooterProductContainer = gbb.$("<div>").addClass("gbbSlotFooterProductContainer");
                    gbbSlotFooterProductContainer.attr("productId", product?.product_id);
                    gbbSlotFooterProductContainer.attr("variantId", product?.variant_id)

                    gbbSlotFooterProductContainer.attr("_boxProduct", product?.properties["_boxProduct"]);
                    gbbSlotFooterProductContainer.attr("_Category", product?.properties["_Category"]);

                    let argsObj = {
                        variantId: product.variant_id,
                        productData: product,
                    }

                    let uniqueGbbItemKey = gbb.utility.getUniqueIdForVariant(argsObj)
                    gbbSlotFooterProductContainer.attr("_uniqueGbbItemKey", uniqueGbbItemKey);

                    const gbbSlotFooterProductImageContainer = gbb.$("<div>").addClass("gbbSlotFooterProductImageContainer");
                    const gbbSlotFooterProductImage = gbb.$("<img>").addClass("gbbSlotFooterProductImage");
                    gbbSlotFooterProductImage.attr("src", product.image);

                    //a button to remove the product from the cart
                    const gbbSlotFooterProductRemoveButton = gbb.$("<div>").addClass("gbbSlotFooterProductRemoveButton");
                    // x icon for the remove button
                    const gbbSlotFooterProductRemoveButtonIcon = gbb.$("<div>").addClass("gbbSlotFooterProductRemoveButtonIcon");

                    const gbbSlotFooterProductQuantity = gbb.$("<div>").addClass("gbbSlotFooterProductQuantity");
                    gbbSlotFooterProductQuantity.text("x" + product.quantity);
                    gbbSlotFooterProductRemoveButtonIcon.append(CONSTANT_CLOSE_ICON_SVG);
                    gbbSlotFooterProductRemoveButton.append(gbbSlotFooterProductRemoveButtonIcon)
                    gbbSlotFooterProductRemoveButton.on("click", async () => {
                        //    await gbb.f.removeProductFromCart({id: product.variant_id});
                        let variant = {
                            id: product.variant_id,
                            _boxProduct: product?.properties["_boxProduct"],
                            _Category: product?.properties["_Category"],
                            _uniqueGbbItemKey: uniqueGbbItemKey
                            // _uniqueGbbItemKey : gbbSlotFooterProductContainer.attr("_uniqueGbbItemKey")
                        }
                        if (gbb.settings.giftMessage.messageProduct && gbb.settings.giftMessage.messageProduct.product && gbb.settings.giftMessage.messageProduct.product.variants) {
                            const variantIdForMessage = gbb.settings.giftMessage.messageProduct.product.variants[0].id;
                            if (variantIdForMessage == product.variant_id) {
                                gbb.gbbPersonalizePage.state.customerUploadsResponse = {};
                            }
                        }
                        await gbb.utility.removeFromCart({ variant: variant });
                        gbb.gbbAddProductsPage.f.updateProductCard(product.product_id, variant.id);
                        gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
                    })

                    gbbSlotFooterProductImageContainer.append(gbbSlotFooterProductImage);

                    let pageIdTheProductWasAddedFrom = product?.properties["_boxProduct"]
                    if (gbb.utility.checkIfRemoveButtonShouldBeAppended(product?.variant_id, pageIdTheProductWasAddedFrom)) {
                        gbbSlotFooterProductContainer.append(gbbSlotFooterProductRemoveButton);
                    }

                    gbbSlotFooterProductContainer.append(gbbSlotFooterProductImageContainer);
                    if (product.quantity > 1) {
                        gbbSlotFooterProductContainer.append(gbbSlotFooterProductQuantity);
                    }
                    gbbSlotFooterProductsContainer.append(gbbSlotFooterProductContainer);
                })

                // render empty slots 
                let totalItemCount = boxData?.item_count || 0;
                for (let startIdx = totalItemCount; startIdx < totalNoOfSlotsRequired; startIdx++) {
                    let gbbSlotFooterProductContainer = gbb.$("<div>").addClass("gbbSlotFooterProductContainer");
                    gbbSlotFooterProductContainer.addClass("gbbSlotFooterProductContainerEmpty");
                    gbbSlotFooterProductContainer.text(`${startIdx + 1}`);
                    gbbSlotFooterProductsContainer.append(gbbSlotFooterProductContainer);
                }
                gbbSlotFooterProductsContainerWrapper.append(gbbSlotFooterProductsContainer);
                return gbbSlotFooterProductsContainerWrapper;
            } catch (error) {
                gbb.utility.debugConsole("error in renderProductSlotsFooterHTML:", error);
            }
        },
        renderCartProductsFooterHTML: function (noteAttribute, options) {
            try {
                let updateFooterFlow = options?.flow
                let renderProductSlotsFooter = gbb.settings.stepsConfigurationData?.isProductSlotsEnabled && gbb.gbbAddProductsPage?.state?.isEveryConditionHaveTypeQuantity;
                const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()
                const renderAddonsMessaging = gbb.gbbAddonProducts.f.checkIfAddonsMessagingNeeded()
                const renderNewTemplateDesign = gbb.$('.gbbProductsCardLayoutV2').length > 0
                //gbb.state.cartData = await gbb.utility.getCart();
                let gbbPageFooterHTML = gbb.$("<div>").addClass("gbbPageFooterHTML");

                let gbbBoxIdContainer = gbb.$("<div>").addClass("gbbPageFooterHTML");
                //gbbBoxIdContainer.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.reviewPage?.boxNumberLabel) || "Box Number:").append(gbb.state?.activeBoxId?.split("box")[1]|| 1);
                //gbbPageFooterHTML.append(gbbBoxIdContainer);

                let gbbProductsFooterHTML;
                gbbProductsFooterHTML = gbb.$("<div>").addClass("gbbProductsFooterHTML");

                gbbProductsFooterHTML.css("background", gbb.settings.pageCustomizationData.cartFooter.cartFooterBgColor)
                gbbProductsFooterHTML.css("color", gbb.settings.pageCustomizationData.cartFooter.cartFooterTextColor)

                if (renderAddonsMessaging || gbb.settings?.discountsData?.isDiscountEnabled && gbb.settings?.discountsData?.isShowDiscountsEnabled && gbb.settings?.discountsData?.rules?.length > 0) {
                    gbbPageFooterHTML.append(gbb.gbbDiscountComponent.f.discountStatusFooterHTML())
                }

                if (window.innerWidth < 600) {
                    return gbb.f.renderCartProductsFooterHTMLForMobile(noteAttribute, gbbProductsFooterHTML, gbbPageFooterHTML, updateFooterFlow);
                }
                const gbbFooterProductsContainer = gbb.$("<div>").addClass("gbbFooterProductsContainer");
                let gbbFooterTotalContainer = gbb.$("<div>");
                let products = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
                products = products?.items || [];
                // products = products?.item_count
                products.forEach((product) => {
                    const gbbFooterProductContainer = gbb.$("<div>").addClass("gbbFooterProductContainer");
                    // gbb.utility.debugConsole("product:", product)
                    //attach a data attriute to the product container
                    gbbFooterProductContainer.attr("productId", product?.product_id);
                    gbbFooterProductContainer.attr("variantId", product?.variant_id)

                    gbbFooterProductContainer.attr("_boxProduct", product?.properties["_boxProduct"]);
                    gbbFooterProductContainer.attr("_Category", product?.properties["_Category"]);

                    let argsObj = {
                        variantId: product.variant_id,
                        productData: product,
                    }


                    let uniqueGbbItemKey = gbb.utility.getUniqueIdForVariant(argsObj)
                    gbbFooterProductContainer.attr("_uniqueGbbItemKey", uniqueGbbItemKey);




                    const gbbFooterProductImageContainer = gbb.$("<div>").addClass("gbbFooterProductImageContainer");
                    const gbbFooterProductImage = gbb.$("<img>").addClass("gbbFooterProductImage");
                    gbbFooterProductImage.attr("src", product.image);
                    const gbbFooterProductTextContainer = gbb.$("<div>").addClass("gbbFooterProductTextContainer");
                    const gbbFooterProductTitle = gbb.$("<div>").addClass("gbbFooterProductTitle");
                    const gbbFooterProductQtyPriceContainer = gbb.$("<div>").addClass("gbbFooterProductQtyPriceContainer");
                    const gbbFooterProductPrice = gbb.$("<div>").addClass("gbbFooterProductPrice");
                    const gbbFooterProductQuantity = gbb.$("<div>").addClass("gbbFooterProductQuantity");


                    //a button to remove the product from the cart
                    const gbbFooterProductRemoveButton = gbb.$("<div>").addClass("gbbFooterProductRemoveButton");
                    // x icon for the remove button
                    const gbbFooterProductRemoveButtonIcon = gbb.$("<div>").addClass("gbbFooterProductRemoveButtonIcon");


                    // gbbFooterProductRemoveButtonIcon.css("color", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconTextColor);
                    // gbbFooterProductRemoveButton.css("background", gbb.settings.pageCustomizationData?.generalSettings?.icon?.iconBgColor)
                    gbbFooterProductRemoveButtonIcon.append(CONSTANT_CLOSE_ICON_SVG);
                    gbbFooterProductRemoveButton.append(gbbFooterProductRemoveButtonIcon)
                    gbbFooterProductRemoveButton.on("click", async () => {
                        //    await gbb.f.removeProductFromCart({id: product.variant_id});
                        let variant = {
                            id: product.variant_id,
                            _boxProduct: product?.properties["_boxProduct"],
                            _Category: product?.properties["_Category"],
                            _uniqueGbbItemKey: uniqueGbbItemKey
                            // _uniqueGbbItemKey : gbbFooterProductContainer.attr("_uniqueGbbItemKey")
                        }
                        if (gbb.settings.giftMessage.messageProduct && gbb.settings.giftMessage.messageProduct.product && gbb.settings.giftMessage.messageProduct.product.variants) {
                            const variantIdForMessage = gbb.settings.giftMessage.messageProduct.product.variants[0].id;
                            if (variantIdForMessage == product.variant_id) {
                                gbb.gbbPersonalizePage.state.customerUploadsResponse = {};
                            }
                        }
                        await gbb.utility.removeFromCart({ variant: variant });
                        gbb.gbbAddProductsPage.f.updateProductCard(product.product_id, variant.id);
                        gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
                    })

                    gbbFooterProductTitle.text(product.title);
                    let _productPrice = product.price;
                    if (isPurchaseTypeSubscription) {
                        _productPrice = gbb.gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId(product?.variant_id)
                    }
                    gbbFooterProductPrice.text(gbb.utility.formatPrice(_productPrice));
                    gbbFooterProductQuantity.text("x" + product.quantity);
                    gbbFooterProductImageContainer.append(gbbFooterProductImage);

                    gbbFooterProductTextContainer.append(gbbFooterProductTitle);
                    gbbFooterProductQtyPriceContainer.append(gbbFooterProductPrice);
                    gbbFooterProductQtyPriceContainer.append(gbbFooterProductQuantity);
                    gbbFooterProductTextContainer.append(gbbFooterProductQtyPriceContainer);

                    let pageIdTheProductWasAddedFrom = product?.properties["_boxProduct"]
                    // @ashfaq append commented
                    if (gbb.utility.checkIfRemoveButtonShouldBeAppended(product?.variant_id, pageIdTheProductWasAddedFrom)) {
                        gbbFooterProductContainer.append(gbbFooterProductRemoveButton);
                    }

                    gbbFooterProductContainer.append(gbbFooterProductImageContainer);
                    gbbFooterProductContainer.append(gbbFooterProductTextContainer);
                    gbbFooterProductsContainer.append(gbbFooterProductContainer);
                })
                let gbbFooterNextButton = gbb.$("<div>").addClass("gbbFooterNextButton");
                const gbbFooterButtonsWrapper = gbb.f.renderFooterButtons(noteAttribute, gbbFooterNextButton, renderNewTemplateDesign); // passing renderNewTemplateDesign to change the layout of footer vuttons

                if (renderNewTemplateDesign) {
                    // let displayValue = gbb.gbbAddProductsPage.state.showBoxProductsInFooter ? 'grid' : 'none'
                    // gbbFooterProductsContainer.css('display', displayValue)
                    // for every re-render we checking do we need to keep the secion open or closed
                    gbbFooterTotalContainer.addClass('gbbFooterButtonsContainer')
                    gbbFooterTotalContainer.css("background", gbb.settings.pageCustomizationData?.cartFooter?.cartFooterButtonsContainerBgColor || '#f6f6f6')
                    // gbbFooterProductsContainer.on("wheel", (event) => {
                    //     event.preventDefault();
                    //     // Detecting the direction of the scroll
                    //     if (event.originalEvent.deltaY < 0) {
                    //         // Scrolling up
                    //         gbb.$(".gbbFooterProductsContainer").scrollLeft(gbb.$(".gbbFooterProductsContainer").scrollLeft() - 50); // Scroll left
                    //     } else {
                    //         // Scrolling down
                    //         gbb.$(".gbbFooterProductsContainer").scrollLeft(gbb.$(".gbbFooterProductsContainer").scrollLeft() + 50); // Scroll right
                    //     }
                    // }) TBD @mufadal
                }
                if (products.length > 0) {
                    if (!renderProductSlotsFooter) {
                        gbbProductsFooterHTML.append(gbbFooterProductsContainer);
                    }
                    if (!renderNewTemplateDesign) {
                        gbbFooterTotalContainer.html(gbb.f.renderFooterTotalContainer())
                    }
                    // In new template design we dont need total price there we have this in renderFooterButtons
                    if (false && renderNewTemplateDesign && gbbPageFooterHTML.find('.gbbDiscountFooterHTML').length <= 0) {
                        gbbPageFooterHTML.append(gbb.gbbAddProductsPage.f.renderShowBoxProductsInFooterHTML())
                    } // if discount is not enable then will show selected products
                } else {
                    gbbProductsFooterHTML.css("grid-template-columns", "1fr");
                    !renderNewTemplateDesign && gbbFooterButtonsWrapper.css("grid-template-columns", "auto 1fr auto");
                    // changing layout for new template design
                    gbbFooterNextButton.css("grid-column", "3/3");
                }

                if (renderProductSlotsFooter) {
                    let productSlotsFooter = gbb.f.renderProductSlotsFooterHTML(noteAttribute)
                    if (updateFooterFlow == "updateFooterWithoutAppending" && gbb.$(".gbbSlotFooterProductsContainerWrapper").length > 0) {
                        let productsContainer = productSlotsFooter.find(".gbbSlotFooterProductContainer")
                        gbb.$(".gbbSlotFooterProductsContainer").html(productsContainer)
                        gbb.$(".gbbFooterButtonsWrapper").replaceWith(gbbFooterButtonsWrapper)
                        gbb.gbbAddProductsPage.f.autoScrollSlots()
                        gbb.$(".gbbCartIconWithQuantityContainer").replaceWith(gbb.gbbAddProductsPage.f.renderCartIconWithQuantityHTML())

                        let gbbPageFooterHTML = gbb.$(".gbbPageFooterHTML")
                        if (renderAddonsMessaging || gbb.settings?.discountsData?.isDiscountEnabled && gbb.settings?.discountsData?.isShowDiscountsEnabled && gbb.settings?.discountsData?.rules?.length > 0) {
                            // remove existing discountfooter and append new one 

                            gbb.$(".gbbDiscountFooterHTML").html(gbb.gbbDiscountComponent.f.discountStatusFooterHTML())
                        }
                        return gbbPageFooterHTML
                    } else {
                        gbbProductsFooterHTML.append(productSlotsFooter)
                    }
                }
                gbbFooterTotalContainer.append(gbbFooterButtonsWrapper);
                gbbProductsFooterHTML.append(gbbFooterTotalContainer);
                gbbPageFooterHTML.append(gbbProductsFooterHTML);
                if (renderNewTemplateDesign) {
                    gbbPageFooterHTML.append(gbb.gbbAddProductsPage.f.renderCartIconWithQuantityHTML())
                }
                if (gbb.utility.checkIfBrandingShouldBeVisible()) {
                    gbbPageFooterHTML.append(gbb.utility.renderPoweredByLabel());
                }
                return gbbPageFooterHTML;
            } catch (error) {
                gbb.utility.debugConsole("error in renderCartProductsFooterHTML", error);
            }
        },
        renderCartProductsModal: function (noteAttribute) {
            const gbbCartProductsMainContainer = gbb.$("<div>").addClass("gbbCartProductsMainContainer");
            const gbbCartProductsContainerModal = gbb.$("<div>").addClass("gbbCartProductsContainerModal");

            const gbbCartProductsContainerHeader = gbb.$("<div>").addClass("gbbCartProductsContainerHeader");
            const gbbCartProductsContainerHeaderLabel = gbb.$("<div>").addClass("gbbCartProductsContainerHeaderLabel").text(gbb.settings?.languageData?.general?.selectedProductsLabel?.value || "Selected Products");
            const gbbCartProductsModalClose = gbb.$("<div>").addClass("gbbCartProductsModalClose");
            gbbCartProductsModalClose.text("+");
            gbbCartProductsModalClose.on("click", () => {
                gbb.$("body").find(".gbbCartProductsMainContainer").remove()
                gbb.$("body").css("overflow-y", DEFAULT_BODY_OVERFLOW_VALUE);
            })

            const gbbCartProductsContainerBody = gbb.$("<div>").addClass("gbbCartProductsContainerBody");

            const gbbCartModalProductsContainer = gbb.$("<div>").addClass("gbbCartModalProductsContainer");
            let products = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
            products = products?.items || [];
            products.forEach((product) => {
                const gbbCartModalProductContainer = gbb.$("<div>").addClass("gbbCartModalProductContainer");
                //attach a data attriute to the product container
                gbbCartModalProductContainer.attr("productId", product?.product_id);
                gbbCartModalProductContainer.attr("variantId", product?.variant_id)

                const gbbCartProductImageContainer = gbb.$("<div>").addClass("gbbCartProductImageContainer");
                const gbbCartModalProductImage = gbb.$("<img>").addClass("gbbCartModalProductImage");
                gbbCartModalProductImage.attr("src", product.image);
                const gbbCartModalProductTextContainer = gbb.$("<div>").addClass("gbbCartModalProductTextContainer");

                const gbbCartModalProductTitleContainer = gbb.$("<div>").addClass("gbbCartModalProductTitleContainer");
                const gbbCartModalProductTitle = gbb.$("<div>").addClass("gbbCartModalProductTitle");
                const gbbCartModalProductQuantity = gbb.$("<div>").addClass("gbbCartModalProductQuantity");

                const gbbCartModalProductPriceQtyContainer = gbb.$("<div>").addClass("gbbCartModalProductPriceQtyContainer");
                const gbbCartModalProductPrice = gbb.$("<div>").addClass("gbbCartModalProductPrice");
                //a button to remove the product from the cart
                const gbbCartModalProductRemoveButton = gbb.$("<div>").addClass("gbbCartModalProductRemoveButton");
                // x icon for the remove button
                const gbbCartModalProductRemoveButtonIcon = gbb.$("<div>").addClass("gbbCartModalProductRemoveButtonIcon");

                gbbCartModalProductRemoveButtonIcon.append(CONSTANT_CLOSE_ICON_SVG);


                gbbCartModalProductRemoveButton.append(gbbCartModalProductRemoveButtonIcon)


                gbbCartModalProductRemoveButton.on("click", async () => {
                    //    await gbb.f.removeProductFromCart({id: product.variant_id});
                    let variant = {
                        id: product.variant_id,
                        _boxProduct: product?.properties["_boxProduct"],
                        _Category: product?.properties["_Category"],
                        _uniqueGbbItemKey: gbb.utility.getUniqueIdForVariant({ productData: product })
                    }
                    await gbb.utility.removeFromCart({ variant: variant });
                    gbb.gbbAddProductsPage.f.updateProductCard(product.product_id, variant.id);
                    gbb.$(".gbbCartProductsMainContainer").replaceWith(gbb.f.renderCartProductsModal(noteAttribute));
                    gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
                })

                gbbCartModalProductTitle.text(product.title);
                gbbCartModalProductPrice.text(gbb.utility.formatPrice(product.price));
                gbbCartModalProductQuantity.text("x" + product.quantity);
                gbbCartProductImageContainer.append(gbbCartModalProductImage);

                gbbCartModalProductTitleContainer.append(gbbCartModalProductTitle);
                //gbbCartModalProductTitleContainer.append(gbbCartModalProductQuantity);

                gbbCartModalProductTextContainer.append(gbbCartModalProductTitleContainer);
                gbbCartModalProductPriceQtyContainer.append(gbbCartModalProductQuantity);
                gbbCartModalProductPriceQtyContainer.append(gbbCartModalProductPrice);
                gbbCartModalProductTextContainer.append(gbbCartModalProductPriceQtyContainer);

                let pageIdTheProductWasAddedFrom = product?.properties["_boxProduct"]

                // @ashfaq append commented
                if (gbb.utility.checkIfRemoveButtonShouldBeAppended(product?.variant_id, pageIdTheProductWasAddedFrom)) {
                    gbbCartModalProductContainer.append(gbbCartModalProductRemoveButton);
                }

                gbbCartModalProductContainer.append(gbbCartProductImageContainer);
                gbbCartModalProductContainer.append(gbbCartModalProductTextContainer);
                gbbCartModalProductsContainer.append(gbbCartModalProductContainer);
            })

            gbbCartProductsContainerHeader.append(gbbCartProductsContainerHeaderLabel);
            gbbCartProductsContainerHeader.append(gbbCartProductsModalClose);

            gbbCartProductsContainerBody.append(gbbCartModalProductsContainer);

            const gbbModalTotalContainer = gbb.f.renderFooterTotalContainer();
            gbbModalTotalContainer.addClass("gbbModalTotalContainer");

            gbbCartProductsContainerModal.append(gbbCartProductsContainerHeader);
            gbbCartProductsContainerModal.append(gbbCartProductsContainerBody);
            gbbCartProductsContainerModal.append(gbbModalTotalContainer);

            gbbCartProductsMainContainer.append(gbbCartProductsContainerModal);
            gbb.$("body").append(gbbCartProductsMainContainer);
            gbb.$("body").css("overflow-y", "hidden");
            gbb.utility.debugConsole("dummy commit");
            gbb.f.applyFontToFooterCartPopup();
        },
        showProductVariantsModal: async function (product, buttonEle, noteAttribute, category) {
            let selectedVariantsCombination = {};
            gbb.state.currentModalProductData = product || {};
            let addProductsPageArr = ADDPRODUCT_PAGES_LIST
            const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()


            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            //gbb.$(".gbbHTMLWrapper").addClass('gbbDisabled');
            let currentProductPersonalization = gbb.utility.getCurrentProductPersonalization(product);
            let doesThisProductHavePersonalization = currentProductPersonalization.isProductPersonalizationEnabled || false;
            let isValidateInventoryEnabled = gbb.settings?.bundleSettings?.isValidateInventoryEnabled || false;
            let allowQuantityInput = gbb.settings?.bundleSettings?.allowQuantityInput || false;
            let incrementProductQtyBy = gbb.gbbAddProductsPage.state.incrementProductQtyBy || 1
            let decrementProductQtyBy = gbb.gbbAddProductsPage.state.decrementProductQtyBy || 1




            const gbbProductVariantModalMainContainer = gbb.$("<div>").addClass("gbbProductVariantModalMainContainer");
            if (gbb.$('.gbbProductsCardLayoutV2').length > 0) {
                gbbProductVariantModalMainContainer.addClass("gbbProductVariantModalLayoutV2");
            }
            if (gbb.$(".gbbNewPageCustomization").length > 0) {
                gbbProductVariantModalMainContainer.addClass("gbbNewPageCustomization");
            }
            const gbbProductVariantModalContainer = gbb.$("<div>").addClass("gbbProductVariantModalContainer");

            // gbbProductVariantModalContainer.addClass
            const gbbProductVariantModalContentContainer = gbb.$("<div>").addClass("gbbProductVariantModalContentContainer");

            gbbProductVariantModalContainer.attr("productId", product?.id);

            // gbbProductVariantModalContainer.attr("")
            let firstvariantid = product.variants.length > 0 ? product?.variants[0]?.id : "";
            gbbProductVariantModalContainer.attr("firstvariantid", firstvariantid);


            const gbbProductVariantModalBodyContainer = gbb.$("<div>").addClass("gbbProductVariantModalBodyContainer");


            const gbbProductVariantModalImageTitleContainer = gbb.$("<div>").addClass("gbbProductVariantModalImageTitleContainer");
            const gbbProductVariantModalDetailsContainer = gbb.$("<div>").addClass("gbbProductVariantModalDetailsContainer");

            const gbbProductVariantModalHeader = gbb.$("<div>").addClass("gbbProductVariantModalHeader");
            const gbbProductVariantModalClose = gbb.$("<div>").addClass("gbbProductVariantModalClose");
            gbbProductVariantModalClose.text("+");

            gbbProductVariantModalClose.on("click", (event) => {
                gbb.utility.closeVariantsModal()
            })
            //add product image and description here
            const gbbProductTextContainer = gbb.$("<div>").addClass("gbbProductCardTextContainer");
            const gbbProductItemTitle = gbb.$("<div>").addClass("gbbProductItemTitle");
            const gbbProductItemPricesContainer = gbb.$("<div>").addClass("gbbProductItemPricesContainer");
            const gbbProductItemCompareAtPrice = gbb.$("<div>").addClass("gbbProductItemCompareAtPrice");
            const gbbProductItemPrice = gbb.$("<div>").addClass("gbbProductItemPrice");

            if (product.compare_at_price && product.compare_at_price > product.price) {
                gbbProductItemCompareAtPrice.text(gbb.utility.formatPrice(product.compare_at_price));
            }
            gbbProductItemPrice.text(gbb.utility.formatPrice(product.price));
            if (product.variants?.length == 1 && product.available == true) {
                let variantPrice = product.variants[0].price;
                let variantCompareAtPrice = product.variants[0].compare_at_price
                if (isPurchaseTypeSubscription) {
                    variantCompareAtPrice = product.variants[0].price;
                    variantPrice = gbb.gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId(product.variants[0].id)
                }
                gbbProductItemPrice.text(gbb.utility.formatPrice(variantPrice));
                if (variantCompareAtPrice) {
                    gbbProductItemCompareAtPrice.text(gbb.utility.formatPrice(variantCompareAtPrice));
                }
            }
            else if (product.variants?.length > 1 && product.available == true) {
                let variantPrice = product.variants[0].price;
                let variantCompareAtPrice = product.variants[0].compare_at_price
                if (isPurchaseTypeSubscription) {
                    variantCompareAtPrice = product.variants[0].price
                    variantPrice = gbb.gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId(product.variants[0].id)
                }
                gbbProductItemPrice.text(gbb.utility.formatPrice(variantPrice));
                if (isPurchaseTypeSubscription || variantCompareAtPrice > product.variants[0].price) {
                    gbbProductItemCompareAtPrice.text(gbb.utility.formatPrice(variantCompareAtPrice));
                }
            }
            // else if (product.variants?.length > 1 && product.available == true) {
            //     gbbProductItemPrice.text(gbb.utility.formatPrice(product.price));
            //     if(product.compare_at_price  && product.compare_at_price > product.price){
            //         gbbProductItemCompareAtPrice.text(gbb.utility.formatPrice(product.compare_at_price));
            //     }
            // }

            const gbbProductDescriptionContainer = gbb.$("<div>").addClass("gbbProductDescriptionContainer");
            const gbbProductDescriptionText = gbb.$("<div>").addClass("gbbProductDescriptionText");

            const gbbProductDynamicContentContainer = gbb.$("<div>").addClass("gbbProductDynamicContentContainer");
            gbbProductDynamicContentContainer.html(gbb.gbbAddProductsPage.f.renderProductDynamicContent(product,'PRODUCT_VARIANTS_MODAL'));


            let description = product?.descriptionHtml?.toString() || product?.description?.toString() || "";  //?.replace(/<[^>]+>/g, '') || ""; //used to remove all HTML tags from a string
            description = description.replace(/\\n/g, "<br>");
            description = gbb.utility.removeIframeTagsFromHtml(description);
            description = gbb.utility.adjustImageTagsInProductDescriptionHtml(description);
            gbbProductDescriptionText.html(description);
            gbbProductDescriptionContainer.append(gbbProductDescriptionText);

            const gbbProductImageContainer = gbb.$("<div>").addClass("gbbProductImageContainer");
            const gbbProductAllImagesContainer = gbb.$("<div>").addClass("gbbProductAllImagesContainer");
            const gbbProductImage = gbb.$("<img>").addClass("gbbProductImage");
            let defaultMedia = {
                src: "https://db07ji0eqime4.cloudfront.net/redeemPage/giftcard/default-no-logo.jpg",
                media_type: "image",
                id: 3656456476
            }
            product.media = product.media ? product.media : [defaultMedia];
            for (let i = 0; i < product.media.length; i++) {
                let media = product.media[i];
                if (!media || !media.src) {
                    continue;
                }
                if (media.src) {
                    gbbProductImageContainer.append(gbb.$("<img>").addClass('gbbProductImageContainerImg' + i).addClass("gbbProductImageContainerImg").addClass("gbbFade"))
                    gbbProductImageContainer.find('.gbbProductImageContainerImg' + i).attr('src', media.src).css('display', 'none')
                }
                if (i == 0) {
                    gbbProductImageContainer.find('.gbbProductImageContainerImg' + i).css('display', 'block')
                }
            }
            //push an anchor tag
            if (product.media.length > 1) {
                //let gbbProductSliderNavigatior = gbb.$("<div>").addClass('gbbProductSliderNavigatior')
                gbbProductImageContainer.append(gbb.$("<a>").addClass('gbbPrevImage'))
                gbbProductImageContainer.find('.gbbPrevImage').html("&#10094;");
                //add an onclick event to the anchor tag
                gbbProductImageContainer.append(gbb.$("<a>").addClass('gbbNextImage'))
                gbbProductImageContainer.find('.gbbNextImage').html("&#10095;");

                gbbProductImageContainer.find('.gbbPrevImage').click(function (event) {
                    event.stopPropagation();
                    event.preventDefault();
                    gbb.utility.slider.minusSlides(gbbProductImageContainer, 1)

                    let prevActiveImage = gbbProductAllImagesContainer.find(".gbbActiveImage")
                    gbb.f.removeActiveImageStyle(prevActiveImage)
                    prevActiveImage.removeClass("gbbActiveImage")

                    let activeImage = gbbProductAllImagesContainer.find(`[imageIndex = ${gbb.utility.slider.state.slideIndex - 1}]`)
                    activeImage.addClass("gbbActiveImage")
                    gbb.f.applyActiveImageStyle(activeImage)
                })
                gbbProductImageContainer.find('.gbbNextImage').click(function (event) {
                    event.stopPropagation();
                    event.preventDefault();
                    gbb.utility.slider.plusSlides(gbbProductImageContainer, 1)

                    gbb.f.removeActiveImageStyle(gbbProductAllImagesContainer.find(".gbbActiveImage"))
                    gbbProductAllImagesContainer.find(".gbbActiveImage").removeClass("gbbActiveImage")

                    let activeImage = gbbProductAllImagesContainer.find(`[imageIndex = ${gbb.utility.slider.state.slideIndex - 1}]`)
                    activeImage.addClass("gbbActiveImage")
                    gbb.f.applyActiveImageStyle(activeImage)
                })
                //gbbProductImageContainer.append(gbbProductImageContainer);
            }

            for (let i = 0; i < product.media.length; i++) {
                let media = product.media[i];
                if (!media || !media.src) {
                    continue;
                }
                if (media.src) {
                    let gbbProductTabImageContainer = gbb.$("<div>").addClass("gbbProductTabImageContainer");
                    gbbProductTabImageContainer.append(gbb.$("<img>")
                        .attr('src', media.src)
                        .attr('imageIndex', i)
                        .attr('mediaId', media.id)
                        .addClass('gbbProducTabImage'))
                    gbbProductTabImageContainer.on("click", (event) => {
                        event.stopPropagation()
                        event.preventDefault()
                        gbb.f.removeActiveImageStyle(gbbProductAllImagesContainer.find(".gbbActiveImage"))
                        gbbProductAllImagesContainer.find(".gbbActiveImage").removeClass("gbbActiveImage")

                        gbbProductTabImageContainer.addClass("gbbActiveImage");
                        let changedVariantDiv = gbbProductAllImagesContainer.find(`[mediaId=${media.id}]`);
                        // let changedVariantDivIndex = parseInt(changedVariantDiv.attr("imageIndex"))
                        let changedVariantDivIndex = parseInt(changedVariantDiv?.parent()?.index())
                        changedVariantDivIndex += 1;

                        gbb.f.applyActiveImageStyle(gbbProductTabImageContainer)
                        gbb.utility.slider.state.slideIndex = changedVariantDivIndex;
                        gbb.utility.slider.showSlides(gbbProductImageContainer, gbb.utility.slider.state.slideIndex)
                    })
                    gbbProductAllImagesContainer.append(gbbProductTabImageContainer)
                }
            }
            let productFormDiv = null;
            if (doesThisProductHavePersonalization) {
                gbbProductVariantModalContainer.addClass("gbbProductVariantModalContainerWithPersonalization");
                productFormDiv = gbb.gbbProductFormStep.f.prepareFormToBeRenderedHTML(currentProductPersonalization, product);
            }


            if (gbb?.settings?.merchantInfo?.bundleSettings?.showCompareAtPrice) {
                gbbProductItemPricesContainer.append(gbbProductItemCompareAtPrice);
            }
            gbbProductItemPricesContainer.append(gbbProductItemPrice);

            // gbbProductItemTitle.text(product.title);
            if (product.variants.length == 1 && gbb.gbbAddProductsPage.state.displayVariantsAsIndividualProducts) {
                // gbbProductItemTitle.text(`${product.variants[0].title} (${product?.options[0]?.name})`);
                gbbProductItemTitle.text(`${product.variants[0].title}`);

            } else {
                gbbProductItemTitle.text(product.title);
            }
            gbbProductTextContainer.append(gbbProductItemTitle);
            if (gbb.settings?.app?.integrations?.judgeme?.isEnabled) {
                let starsHTML = gbb.gbbIntegrations?.judgeme?.f?.getStarsHTMLByProductId(product.id);
                if (starsHTML) {
                    let reviewStarsContainer = gbb.$("<div>").addClass("gbbReviewStarsContainer");
                    let reviewStars = gbb.$("<div>").addClass("gbbReviewStars");
                    reviewStars.html(starsHTML);
                    reviewStarsContainer.append(reviewStars);
                    gbbProductTextContainer.append(reviewStarsContainer);
                }
            }
            gbbProductTextContainer.append(gbbProductItemPricesContainer);
            if (isValidateInventoryEnabled) {
                let gbbVariantInventoryContainer = gbb.$("<div>").addClass("gbbVariantInventoryContainer");
                let activeVariantInfo = gbb.utility.checkIfSelectedVariantCombinationIsAvailable(product, selectedVariantsCombination);
                let totalInventory = activeVariantInfo[0]?.quantityAvailable || 0;
                let inventoryText = gbb.$("<div>").addClass("gbbInventoryText");
                inventoryText.text((`${totalInventory} ${gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.inventoryInStockText) || "in Stock1"}`));
                if (totalInventory > 0) {
                    gbbVariantInventoryContainer.append(inventoryText);
                    gbbProductTextContainer.append(gbbVariantInventoryContainer);
                }
            }
            gbbProductTextContainer.append(gbbProductDescriptionContainer);
            // if (gbb.settings.bundleSettings?.metafieldNameSpaceAndKeys.length > 0) {
            //     gbbProductTextContainer.append(gbbProductDynamicContentContainer);
            // }
            if (gbb.settings.bundleSettings?.metafieldNameSpaceAndKeys.length > 0 || gbb.settings.app?.dynamicScriptForHTMLContent) {
                gbbProductTextContainer.append(gbbProductDynamicContentContainer)
            }


            gbbProductAllImagesContainer.find(`[imageIndex = ${0}]`).addClass("gbbActiveImage")
            gbb.f.applyActiveImageStyle(gbbProductAllImagesContainer.find(`[imageIndex = ${0}]`))
            gbbProductVariantModalImageTitleContainer.append(gbbProductImageContainer);
            // gbbProductVariantModalImageTitleContainer.append(gbbProductAllImagesContainer); // HEREr
            gbbProductVariantModalHeader.append(gbbProductVariantModalClose)
            gbbProductVariantModalContentContainer.append(gbbProductVariantModalHeader);

            gbbProductVariantModalDetailsContainer.append(gbbProductTextContainer);


            if (false && gbbProductVariantModalMainContainer.hasClass("gbbProductVariantModalLayoutV2")) {
                const imageSliderContainer = gbb.$("<div>").addClass("gbbImageSliderContainer");
                const prevBtnContainer = gbb.$("<div>").addClass("gbbPrevBtnContainer");
                const nextBtnContainer = gbb.$("<div>").addClass("gbbNextBtnContainer");
                const prevBtn = gbb.$("<div>").addClass("gbbPrevBtn").html("&#x25B2;");
                const nextBtn = gbb.$("<div>").addClass("gbbNextBtn").html("&#x25BC;");
                prevBtnContainer.append(prevBtn);
                nextBtnContainer.append(nextBtn);
                imageSliderContainer.append(prevBtnContainer);
                imageSliderContainer.append(gbbProductAllImagesContainer);
                imageSliderContainer.append(nextBtnContainer);
                gbbProductVariantModalBodyContainer.append(imageSliderContainer)
                gbbProductVariantModalBodyContainer.append(gbbProductVariantModalImageTitleContainer);
            } else {
                gbbProductVariantModalImageTitleContainer.append(gbbProductAllImagesContainer);
                gbbProductVariantModalBodyContainer.append(gbbProductVariantModalImageTitleContainer);
            }

            let variantQuantity = incrementProductQtyBy;

            let gbbProductQuantityHTMLContainer = gbb.$("<div>").addClass("gbbProductQuantityHTMLContainer");
            let gbbProductQuantityHTML = gbb.$("<div>").addClass("gbbProductQuantityHTML");

            let gbbProductQuantityHeading = gbb.$("<div>").addClass("gbbProductQuantityHeading")
            let productCardPageCustomization = gbb.settings.pageCustomizationData?.productCard
            let buttonTextColor = productCardPageCustomization.productCardQuantitySelectorButtonTextColor || productCardPageCustomization.productCardButtonTextColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor
            // let gbbProductQuantityAddButton = gbb.$("<button>").addClass("gbbProductQuantityAddButton")
            let gbbProductQuantityAddButton = gbb.$("<div>").addClass("gbbProductQuantityAddButton")
                // .css("background", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                // .css("color", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
                .css("background", gbb.settings.pageCustomizationData?.productCard?.productCardButtonColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                .css("color", productCardPageCustomization.productCardButtonTextColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
            // let gbbProductQuantityRemoveButton = gbb.$("<button>").addClass("gbbProductQuantityRemoveButton")

            let gbbProductQuantityRemoveButton = gbb.$("<div>").addClass("gbbProductQuantityRemoveButton")
                // .css("background", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                // .css("color", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
                .css("background", gbb.settings.pageCustomizationData?.productCard?.productCardButtonColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                .css("color", productCardPageCustomization.productCardButtonTextColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
            let gbbProductQuantityLabel = gbb.$("<div>").addClass("gbbProductQuantityLabel");

            let gbbProductQuantityInput = gbb.$("<input>").addClass("gbbProductQuantityInput").attr("type", "number").attr("min", 0);

            gbbProductQuantityAddButton.append(gbb.$("<div>").addClass("gbbProductQuantityAddButtonWrapper").html("+"));
            gbbProductQuantityRemoveButton.append(gbb.$("<div>").addClass("gbbProductQuantityRemoveButtonWrapper").html("-"));

            gbbProductQuantityAddButton.on("click", async (event) => {
                variantQuantity += incrementProductQtyBy;
                gbbProductQuantityLabel.text(variantQuantity);
                gbbProductQuantityInput.val(variantQuantity);
                if (isValidateInventoryEnabled) {
                    let validationOptions = {
                        product: product,
                        selectedVariantsCombination: selectedVariantsCombination,
                        variantQuantity: variantQuantity + incrementProductQtyBy,
                        gbbProductQuantityAddButton: gbbProductQuantityAddButton
                    }
                    gbb.utility.validateProductQuantityAddButton(validationOptions);
                }
            })

            gbbProductQuantityRemoveButton.on("click", async (event) => {
                if (variantQuantity > 0) {
                    variantQuantity -= decrementProductQtyBy;
                    variantQuantity = variantQuantity < 0 ? 0 : variantQuantity;
                    gbbProductQuantityLabel.text(variantQuantity);
                    gbbProductQuantityInput.val(variantQuantity);
                    if (isValidateInventoryEnabled) {
                        let validationOptions = {
                            product: product,
                            selectedVariantsCombination: selectedVariantsCombination,
                            variantQuantity: variantQuantity + incrementProductQtyBy,
                            gbbProductQuantityAddButton: gbbProductQuantityAddButton
                        }
                        gbb.utility.validateProductQuantityAddButton(validationOptions);
                    }
                }
            })

            gbbProductQuantityInput.on("change", (event) => {
                let value = parseInt(event.target.value);
                if (value < 0) {
                    value = 0;
                }
                variantQuantity = value;
                gbbProductQuantityLabel.text(variantQuantity);
                gbbProductQuantityInput.val(variantQuantity);
            })

            gbbProductQuantityLabel.text(variantQuantity);
            gbbProductQuantityInput.val(variantQuantity);

            gbbProductQuantityHeading.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.general.quantity) || "Quantity");

            gbbProductQuantityHTML.append(gbbProductQuantityRemoveButton)

            if (allowQuantityInput) {
                gbbProductQuantityHTML.append(gbbProductQuantityInput);
            } else {

                gbbProductQuantityHTML.append(gbbProductQuantityLabel);
            }

            gbbProductQuantityHTML.append(gbbProductQuantityAddButton);

            gbbProductQuantityHTMLContainer.append(gbbProductQuantityHeading);
            gbbProductQuantityHTMLContainer.append(gbbProductQuantityHTML);
            gbbProductVariantModalDetailsContainer.append(gbbProductQuantityHTMLContainer)

            const gbbProductActionContainer = gbb.$("<div>").addClass("gbbProductCardActionContainer");
            const gbbProductButtonWrapper = gbb.$("<div>").addClass("gbbProductButtonWrapper").html("  ");
            if (product.variants?.length == 1 && product.available == true && product.renderChooseOptionsButton_forcefully != true) {

                if (product.options.length > 0 && product.options[0].name && product.variants[0]?.options?.length > 0) {
                    let options = product.options 
                    options.forEach((option, index) => {
                        selectedVariantsCombination[option.name] = product.variants[0]?.options[index]
                        gbb.utility.debugConsole(selectedVariantsCombination)
                    })
                } 

                // const gbbProductButton = gbb.$("<button>").addClass("gbbProductAddButton");
                const gbbProductButton = gbb.$("<div>").addClass("gbbProductVariantAddButton")
                    // .css("background", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                    // .css("color", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
                    .css("background", gbb.settings.pageCustomizationData?.productCard?.productCardButtonColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                    .css("color", gbb.settings.pageCustomizationData?.productCard?.productCardButtonTextColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);

                if (addProductsPageArr.includes(noteAttribute)) {
                    gbbProductButton.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.general.addToBoxButtonText));
                } else {
                    gbbProductButton.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.general.addButtonText));
                }

                let argsObj = {
                    productData: product,
                    variantId: product.variants[0].id,
                }

                let uniqueItemKey = gbb.utility.getUniqueIdForVariant(argsObj);

                const isItemInCart = gbb.utility.checkIfItemPresentInGiftBoxCart(product.variants[0].id, { uniqueItemKey });

                // const isItemInCart = gbb.utility.checkIfItemPresentInGiftBoxCart(product.variants[0].id);
                let data = {
                    productData: product,
                    variant: product.variants[0]
                }
                gbbProductButton.on("click", async () => {
                    gbbProductButton.addClass("gbbDisabled");
                    setTimeout(function () {
                        gbbProductButton.prop('disabled', false);
                        gbbProductButton.removeClass("gbbDisabled");
                    }, 500);
                    // { productAmount, category, productQuantity}
                    // data?.variant?.price, category, variantQuantity
                    let options = {
                        productAmount: data?.variant?.price,
                        category: category,
                        productQuantity: variantQuantity,
                        productWeight: data?.variant?.weight,
                        productVariantData: data?.variant
                    }
                    let condition = await gbb.utility.checkStepConditions(noteAttribute, options);

                    let formValidationForProduct = gbb.gbbProductFormStep.f.checkFormValidationForProduct(product);
                    if (!formValidationForProduct) {
                        gbb.gbbProductFormStep.f.displayRequiredFieldMessage();
                        return;
                    } else if (formValidationForProduct) {
                        gbb.utility.addPersonalizationDataToProductProperties();
                    }

                    let typeOfProduct = "singleVariant";
                    if (gbb.settings?.bundleSettings?.isValidateInventoryEnabled && !gbb.utility.allowATCBasedOnProductInventory(data?.variant?.id, variantQuantity)) {
                        gbb.utility.closeVariantsModal()
                        gbb.f.renderConditionNotificationToast((gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.inventoryLimitReachedText) || "No More Stock1"))
                        return
                    }
                    if (condition.isConditionMet) {
                        if (isItemInCart && isItemInCart.quantity) {
                            variantQuantity += isItemInCart.quantity
                        }
                        data.qty = variantQuantity;
                        try {
                            let _noteAttribute = product?.customProductAttribute || noteAttribute
                            await gbb.utility.addToCart(data, _noteAttribute, category);
                            await gbb.utility.getGiftBoxProductsFromCart();
                        } catch (e) {
                            // gbb.utility.debugConsole("error generated is", e);
                        }
                        gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
                        // gbb.gbbAddProductsPage.f.autoScrollSlotsBasedOnATC("addToCart")
                        if (noteAttribute == "reviewPage") {
                            gbb.gbbReviewPage.init(gbb.settings, "SUMMARY_PAGE");
                        }

                        let newProductItemHTML = gbb.f.renderProductsHTML([product], noteAttribute, category);
                        // gbb.$(".gbbPageBody").find(`[productId='${product.id}']`).replaceWith(newProductItemHTML);
                        let productCardRef = gbb.$(".gbbProductsContainer").find(`[productId='${product.id}']`);
                        // productCard = find the product that has firstvariantid as variantId
                        if (productCardRef.length > 1) {
                            productCardRef = gbb.$(".gbbProductsContainer").find(`[firstvariantid='${product.variants[0].id}']`);

                            //the below code works but is commented because of 
                            // - we dont use filter a lot, especially in case of jquery objects.
                            // - the above code is more readable, understandable and also faster (surprisingly)
                            // @ashfaq benchmarked it
                            // productCardRef = productCardRef.filter(`[firstvariantid='${product.variants[0].id}']`);
                        }

                        productCardRef.replaceWith(newProductItemHTML);

                        gbb.utility.closeVariantsModal()
                        //TODO: handleAutoNextStep
                        await gbb.gbbAddProductsPage.f.handleAutoNextStep();
                    } else {
                        gbb.utility.closeVariantsModal()
                    }
                })

                //gbbProductButtonWrapper.append(gbbProductButton);
                gbbProductActionContainer.append(gbbProductButtonWrapper);
                gbbProductActionContainer.append(gbbProductButton);
                let isThisNewDesign = gbbProductVariantModalMainContainer.hasClass("gbbProductVariantModalLayoutV2")
                if (isThisNewDesign) {
                    gbbProductVariantModalDetailsContainer.append(gbbProductActionContainer)
                }
                gbbProductVariantModalBodyContainer.append(gbbProductVariantModalDetailsContainer);
                gbbProductVariantModalContentContainer.append(gbbProductVariantModalBodyContainer);
                if (isThisNewDesign != true) { // repeating this if block logic coz both have different placements
                    gbbProductVariantModalContentContainer.append(gbbProductActionContainer);
                }
                if (window.innerWidth < 600) {
                    gbbProductVariantModalContentContainer.append(gbbProductDescriptionContainer);
                }

            } else {
                const gbbProductVariantNotAvailableWarning = gbb.$("<div>").addClass("gbbProductVariantNotAvailableWarning");
                // const gbbProductVariantAddButton = gbb.$("<button>").addClass("gbbProductVariantAddButton")
                const gbbProductVariantAddButton = gbb
                    .$("<div>")
                    .addClass("gbbProductVariantAddButton")
                    // .css("background", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                    // .css("color", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
                    .css("background", gbb.settings?.pageCustomizationData.productCard?.productCardButtonColor || gbb.settings.pageCustomizationData.quickSettings.colors.buttonBgColor)
                    .css("color", gbb.settings?.pageCustomizationData.productCard?.productCardButtonTextColor || gbb.settings.pageCustomizationData.quickSettings.colors.buttonTextColor);

                if (addProductsPageArr.includes(noteAttribute)) {
                    gbbProductVariantAddButton.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.general.addToBoxButtonText));
                } else {
                    gbbProductVariantAddButton.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.general.addButtonText));
                }

                gbbProductVariantAddButton.on("click", (event) => {
                    gbbProductVariantAddButton.addClass("gbbDisabled");
                    setTimeout(function () {
                        gbbProductVariantAddButton.prop("disabled", false);
                        gbbProductVariantAddButton.removeClass("gbbDisabled");
                    }, 500);
                    gbb.utility.addVariantProductToCart(gbbProductVariantNotAvailableWarning, product, selectedVariantsCombination, noteAttribute, buttonEle, category, variantQuantity);

                });

                gbbProductVariantNotAvailableWarning.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.combinationNotAvailable));

                const gbbProductVariantOptionsContainer = gbb.$("<div>").addClass("gbbProductVariantOptionsContainer");
                gbbProductVariantOptionsContainer.append(gbbProductVariantNotAvailableWarning);

                if (gbb?.settings?.merchantInfo?.customSettings?.showOnlyAdminSelectedVariants) {
                    product.options = gbb.utility.returnOnlyAdminSelectedVariantOptions(product);
                }

                product.options?.forEach((option, index) => {
                    let name = option?.name || "";
                    let nameToCompare = name.replace(new RegExp("'", "g"), "");
                    const gbbProductVariantOptionContainer = gbb.$("<div>").addClass("gbbProductVariantOptionContainer").attr("optionId", nameToCompare);
                    const gbbProductVariantOptionLabel = gbb.$("<div>").addClass("gbbProductVariantOptionLabel");
                    gbbProductVariantOptionLabel.text(option.name);
                    gbbProductVariantOptionContainer.append(gbbProductVariantOptionLabel);
                    const gbbProductVariantOptionValuesContainer = gbb.$("<div>").addClass("gbbProductVariantOptionValuesContainer");

                    //set initial selection to the options of first variant product
                    selectedVariantsCombination[option.name] = product.variants[0].options[index];

                    option.values?.forEach((value, index) => {
                        let valueToCompare = value.replace(new RegExp("'", "g"), "");
                        // const gbbProductVariantOptionValue = gbb.$("<button>")
                        const gbbProductVariantOptionValue = gbb.$("<div>").addClass("gbbProductVariantOptionValue").attr("optionValueId", valueToCompare);
                        //.css("background",gbb.settings.pageCustomizationData?.quickSettings?.colors?.primaryColor)
                        //gbbProductVariantOptionValue.attr("optionValueId"+ value)
                        gbbProductVariantOptionValue.text(value);
                        if (option.values.length == 1 && value == "Default Title") {
                            gbbProductVariantOptionContainer.addClass("gbbProductVariantOptionContainerHidden");
                        }

                        gbbProductVariantOptionValuesContainer.append(gbbProductVariantOptionValue);

                        gbbProductVariantOptionValue.on("click", (event) => {
                            event.preventDefault();
                            let activeVariant = gbbProductVariantOptionContainer.find(".gbbActiveVariant");
                            gbb.f.removeSelectedVariantStyle(activeVariant);
                            activeVariant.removeClass("gbbActiveVariant");

                            gbbProductVariantOptionValue.addClass("gbbActiveVariant");
                            gbb.f.applySelectedVariantStyle(gbbProductVariantOptionValue);
                            selectedVariantsCombination[option.name] = value;

                            if (isValidateInventoryEnabled) {
                                gbb.utility.validateATCAndVariantQuantityAddButton({ product, selectedVariantsCombination, variantQuantity, gbbProductQuantityAddButton, gbbProductVariantModalContainer })
                                let activeVariantInfo = gbb.utility.checkIfSelectedVariantCombinationIsAvailable(product, selectedVariantsCombination);
                                let totalInventory = activeVariantInfo[0]?.quantityAvailable || 0;
                                if (totalInventory > 0) {
                                    gbb.$(".gbbVariantInventoryContainer").show();
                                    gbb.$(".gbbInventoryText").text((`${totalInventory} ${gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.inventoryInStockText) || "in Stock1"}`));
                                } else {
                                    gbb.$(".gbbVariantInventoryContainer").hide();
                                }
                            }

                            gbb.utility.handleVariantSelection(
                                gbbProductVariantNotAvailableWarning,
                                product,
                                selectedVariantsCombination,
                                gbbProductVariantAddButton,
                                gbbProductAllImagesContainer,
                                gbbProductImageContainer
                            );
                        });
                    });

                    gbbProductVariantOptionContainer.append(gbbProductVariantOptionValuesContainer);
                    gbbProductVariantOptionsContainer.append(gbbProductVariantOptionContainer);

                    let valueToCompare = product.variants[0].options[index];
                    valueToCompare = valueToCompare.replace(new RegExp("'", "g"), "");

                    let activeVariant = gbbProductVariantOptionsContainer.find(`[optionId='${nameToCompare}']`).find(`[optionValueId='${valueToCompare}']`);
                    activeVariant.addClass("gbbActiveVariant");
                    gbb.f.applySelectedVariantStyle(activeVariant);
                });
                gbbProductActionContainer.append(gbbProductButtonWrapper);
                gbbProductActionContainer.append(gbbProductVariantAddButton);

                let isThisNewDesign = gbbProductVariantModalMainContainer.hasClass("gbbProductVariantModalLayoutV2")
                gbbProductVariantModalDetailsContainer.append(gbbProductVariantOptionsContainer);
                if (isThisNewDesign) {
                    gbbProductVariantModalDetailsContainer.append(gbbProductActionContainer)
                }
                gbbProductVariantModalBodyContainer.append(gbbProductVariantModalDetailsContainer);
                gbbProductVariantModalContentContainer.append(gbbProductVariantModalBodyContainer);




                if (isThisNewDesign != true) { // repeating this block coz both conditions have different placements in the design structure
                    gbbProductVariantModalContentContainer.append(gbbProductActionContainer);
                }
                if (window.innerWidth < 600) {
                    gbbProductVariantModalContentContainer.append(gbbProductDescriptionContainer);
                }
            }

            if (window.innerWidth < 600) {
                gbbProductButtonWrapper.css("display", "none");
                gbbProductActionContainer.css("grid-template-columns", "1fr")
            }

            if (productFormDiv) {
                gbbProductVariantModalDetailsContainer.append(productFormDiv);
            }

            if (isValidateInventoryEnabled) {
                gbb.utility.validateATCAndVariantQuantityAddButton({ product, selectedVariantsCombination, variantQuantity, gbbProductQuantityAddButton, gbbProductVariantModalContainer })
            }
            gbbProductVariantModalContainer.append(gbbProductVariantModalContentContainer);
            gbbProductVariantModalMainContainer.append(gbbProductVariantModalContainer);
            gbb.$("body").append(gbbProductVariantModalMainContainer);
            gbb.$("body").css("overflow-y", "hidden");
            gbb.f.applyFontToProductPopupCard();
            gbb.gbbBrowser.emitCustomEvent({
                eventName: "gbb-variants-modal-open",
            })
        },
        renderConditionNotificationToast: function (conditionMessage, categoryTitle) {
            const gbbConditionNotificationToastMainContainer = gbb.$("<div>").addClass("gbbConditionNotificationToastMainContainer");
            const gbbConditionNotificationToast = gbb.$("<div>").addClass("gbbConditionNotificationToast");
            const gbbConditionNotificationMessage = gbb.$("<div>").addClass("gbbConditionNotificationMessage");
            const gbbConditionNotificationClose = gbb.$("<div>").addClass("gbbConditionNotificationClose");
            gbbConditionNotificationClose.text("+")
            gbbConditionNotificationClose.on("click", () => {
                gbb.$(".gbbPageFooterHTML").find(".gbbConditionNotificationToast").remove()
            })
            if (categoryTitle) {
                conditionMessage = categoryTitle + " : " + conditionMessage
            }
            gbbConditionNotificationMessage.text(conditionMessage);
            gbbConditionNotificationToast.css("background", gbb.settings?.pageCustomizationData?.generalSettings?.conditionToast?.conditionToastBgColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)

            gbbConditionNotificationToast.css("color", gbb.settings?.pageCustomizationData?.generalSettings?.conditionToast?.conditionToastTextColor || "#ffffff")
            gbbConditionNotificationClose.css("color", gbb.settings?.pageCustomizationData?.generalSettings?.conditionToast?.conditionToastTextColor || "#ffffff")

            gbbConditionNotificationToast.append(gbbConditionNotificationMessage);
            gbbConditionNotificationToast.append(gbbConditionNotificationClose);

            //gbbConditionNotificationToastMainContainer.append(gbbConditionNotificationToast);
            gbb.$(".gbbPageFooterHTML").append(gbbConditionNotificationToast);
            setTimeout(() => {
                gbb.$(".gbbPageFooterHTML").find(".gbbConditionNotificationToast").remove()
            }, 6000)
        },

        getVisibilityMaps: function (data, cartData) {
            try {
                let visibilityMaps = {};

                const updateVisibility = (mapKey, type, id, value) => {
                    if (!visibilityMaps[mapKey][type]) {
                        visibilityMaps[mapKey][type] = {};
                    }
                    visibilityMaps[mapKey][type][id] = {
                        ...visibilityMaps[mapKey][type][id],
                        visibility: value
                    };
                };

                data.rules.forEach((rule, index) => {
                    const ruleKey = `r${index + 1}`; // Dynamic rule key (e.g., r1, r2, ...)
                    visibilityMaps[ruleKey] = {};

                    const actionType = rule.action.actionType; // "hide" or "show"
                    const isHideRule = actionType === "hide";

                    const conditionOperator = "OR" || "AND";

                    let cartProductIds = cartData.items.map((item) => String(item.product_id));
                    let cartTags = cartData.items.flatMap((item) => item.productTags || []);

                    let cartVariantTitles = cartData.items.flatMap((item) => item.options);


                    // Apply the rule to the specified products or tags
                    rule.trigger.selectionValues.forEach((selection) => {

                        // strip gid and stuff productId if exists;
                        if (selection.id && !selection.productId) {
                            selection.productId = selection.id.split("gid://shopify/Product/")[1];
                        }


                        let isVariantTitlePartOfCart = cartVariantTitles.filter(item => item.includes(selection.value)).length > 0;
                        let isAnyOfTheSelectionInCart = isVariantTitlePartOfCart || cartProductIds.includes(selection.productId) || cartTags.includes(selection.value);

                        if (conditionOperator == "AND" && !isAnyOfTheSelectionInCart) {
                            visibilityMaps[ruleKey] = {};
                            return;
                        }

                        if (conditionOperator == "OR" && !isAnyOfTheSelectionInCart) {
                            return;
                        }

                        let isActionBasedOnTag = rule.action.selectionType === "productTags";
                        let isActionBasedOnProduct = rule.action.selectionType === "products";
                        let isActionBasedOnVariantTitle = rule.action.selectionType === "variantTitle";
                        // Apply actions based on the rule
                        rule.action.selectionValues.forEach((actionSelection) => {
                            const visibilityValue = isHideRule ? -1 : 1;

                            if (actionSelection.id && !actionSelection.productId) {
                                actionSelection.productId = actionSelection.id.split("gid://shopify/Product/")[1];
                            }

                            if (isActionBasedOnTag) {
                                updateVisibility(ruleKey, 'tags', actionSelection.value, visibilityValue);
                            } else if (isActionBasedOnProduct) {
                                updateVisibility(ruleKey, 'products', actionSelection.productId, visibilityValue);
                            } else if (isActionBasedOnVariantTitle) {
                                updateVisibility(ruleKey, 'variantTitle', actionSelection.value, visibilityValue);
                            }
                        });
                    });
                });

                return visibilityMaps;
            } catch (error) {
                gbb.utility.debugConsole("error in getVisibilityMaps", error);
            }
        },

        applyVisibilityRulesToProducts: function (uniqueProductsByIds, visibilityMapsData, extraOptions) {
            try {
                let isPageTypeMultiCategory = extraOptions?.pageType == "MULTI_CATEGORY"

                let onlyShownProductIds = [];
                let onlyShownVariantIds = [];
                let productShownByRuleKey = {};
                let productHiddenByRuleKey = {};

                Object.keys(visibilityMapsData).forEach((ruleKey) => {
                    let rule = visibilityMapsData[ruleKey];

                    // Apply product visibility rules
                    Object.keys(rule.products || {}).forEach((productId) => {
                        let visibility = rule.products[productId].visibility;
                        if (visibility === 1) {
                            onlyShownProductIds.push(productId);
                        } else if (visibility === -1 && uniqueProductsByIds[productId]) {
                            uniqueProductsByIds[productId].available = false; // Hide the product
                            // product.available = false; // Hide the product based on tag
                            // product.available = false; // Hide the product based on tag
                        }
                    });

                    // Apply tag visibility rules
                    Object.keys(rule.tags || {}).forEach((tag) => {
                        let visibility = rule.tags[tag].visibility;
                        Object.values(uniqueProductsByIds).forEach((product) => {
                            if (product.tags && product.tags.includes(tag)) {
                                // If the product has the tag
                                if (visibility === 1 && !onlyShownProductIds.includes(product.productId)) {
                                    onlyShownProductIds.push(product.productId);
                                } else if (visibility === -1) {
                                    product.available = false; // Hide the product based on tag
                                }
                            } else {
                                // If the product doesn't have the tag
                                if (visibility === 1) {
                                    // Visibility is 1, but the product doesn't have the tag - ensure it's visible
                                    product.available = false; // Make sure the product is available
                                } else if (visibility === -1) {
                                    // Visibility is -1, but the product doesn't have the tag - hide the product
                                    // product.available = true; // Hide the product since the tag isn't present
                                }
                            }
                        });
                    });


                    // Step 1: Apply visibility rules and populate productVisibilityByRuleKey
                    Object.keys(rule.variantTitle || {}).forEach((itemTitle) => {
                        let visibility = rule.variantTitle[itemTitle].visibility;

                        Object.keys(uniqueProductsByIds).forEach((productId) => {
                            let product = uniqueProductsByIds[productId];
                            let onlyVariantsVisibleForThisProduct = [];

                            if (visibility === 1) {
                                if (!productShownByRuleKey[ruleKey]) productShownByRuleKey[ruleKey] = {};
                            } else if (visibility === -1) {
                                if (!productHiddenByRuleKey[ruleKey]) productHiddenByRuleKey[ruleKey] = {};
                            }

                            if (product.variants && product.variants.length > 0) {
                                product.variants.forEach((variant) => {
                                    let variantTitleOptionArray = variant.variantTitle?.split(" / ") || [];

                                    // Match rule logic (AND/OR)
                                    let matchResults = Object.keys(rule.variantTitle).map((ruleItemTitle) => {
                                        return variantTitleOptionArray.some((variantTitle) => ruleItemTitle.trim().toLowerCase() === variantTitle.trim().toLowerCase());
                                    });

                                    let operationType = "AND";
                                    let checkIfMatchFound;

                                    if (operationType === "AND") {
                                        checkIfMatchFound = matchResults.every((result) => result === true);
                                    } else if (operationType === "OR") {
                                        checkIfMatchFound = matchResults.some((result) => result === true);
                                    }

                                    // Apply visibility based on match results
                                    if (checkIfMatchFound) {
                                        if (visibility === 1) {
                                            productShownByRuleKey[ruleKey][productId] = productShownByRuleKey[ruleKey][productId] || { productId: productId, variants: [] };
                                            productShownByRuleKey[ruleKey][productId].variants.push(variant.variantId);
                                        } else if (visibility === -1) {
                                            productHiddenByRuleKey[ruleKey][productId] = productHiddenByRuleKey[ruleKey][productId] || { productId: productId, variants: [] };
                                            productHiddenByRuleKey[ruleKey][productId].variants.push(variant.variantId);
                                        }
                                    }
                                });
                            }
                        });
                    });

                });


                // Step 2: Update uniqueProductsByIds based on merged results
                let finalShownProducts = {};
                let validProductsToShowFromUniqueProducts;
                // Merge all productShownByRuleKey entries
                Object.keys(productShownByRuleKey).forEach((ruleKey) => {
                    Object.assign(finalShownProducts, productShownByRuleKey[ruleKey]);
                });

                // Apply visibility from the merged shown products
                Object.keys(finalShownProducts).forEach((productId) => {
                    let visibilityData = finalShownProducts[productId];
                    let product = uniqueProductsByIds[productId];

                    if (product) {
                        product.variants = product.variants.filter((variant) => visibilityData.variants.includes(variant.variantId));
                        product.available = product.variants.length > 0;
                    }
                });

                // Apply hidden rules
                Object.keys(productHiddenByRuleKey).forEach((ruleKey) => {
                    Object.keys(productHiddenByRuleKey[ruleKey]).forEach((productId) => {
                        if (uniqueProductsByIds[productId]) {
                            // Remove the variants that should be hidden based on the visibilityData
                            uniqueProductsByIds[productId].variants = uniqueProductsByIds[productId].variants.filter((variant) => {
                                if (productHiddenByRuleKey[ruleKey][productId].variants.includes(variant.variantId)) {
                                    return false; // Remove this variant
                                } else {
                                    variant.available = true; // Keep this variant and mark it as available
                                    return true;
                                }
                            });

                            // If all variants are hidden, mark the product as unavailable
                            if (uniqueProductsByIds[productId].variants && uniqueProductsByIds[productId].variants.length > 0) {
                                let allVariantsAreHidden = uniqueProductsByIds[productId].variants.every((variant) => variant.available === false);
                                if (allVariantsAreHidden) {
                                    uniqueProductsByIds[productId].available = false;
                                }
                            } else {
                                uniqueProductsByIds[productId].available = false; // If no variants remain, mark the product as unavailable
                            }
                        }
                    });
                });


                // Collect product IDs and variant IDs that are set to be shown
                let productIdsToBeShown = Object.keys(uniqueProductsByIds).filter((productId) => uniqueProductsByIds[productId].available);




                onlyShownVariantIds = productIdsToBeShown.reduce((variantIds, productId) => {
                    let product = uniqueProductsByIds[productId];
                    variantIds.push(...product.variants.map((variant) => variant.variantId));
                    return variantIds;
                }, []);

                // Final result
                return { onlyShownProductIds, uniqueProductsByIds, onlyShownVariantIds };

                // The final result
                //   return { onlyShownProductIds, uniqueProductsByIds, onlyShownVariantIds };
            } catch (error) {
                gbb.utility.debugConsole("error applyVisibilityRulesToProducts", error);
            }

        },


        filterOutBasedOnConditionalLogic: function (allProducts) {
            try {
                let cartData = gbb.state.giftBoxCartData;
                let conditionalLogic = gbb.settings.stepsConfigurationData?.conditionalLogic;

                if (!conditionalLogic || !conditionalLogic.isEnabled || conditionalLogic.rules.length < 1) {
                    return allProducts;
                }

                let visibilityMapsData = gbb.f.getVisibilityMaps(conditionalLogic, cartData);

                let uniqueProducts = JSON.parse(JSON.stringify(allProducts));
                let uniqueProductsByIds = gbb.utility.convertArrayToObject(uniqueProducts, "productId");


                let applyVisibilityRulesResult = gbb.f.applyVisibilityRulesToProducts(uniqueProductsByIds, visibilityMapsData);

                // let { onlyShownProductIds, uniqueProductsByIds: updatedProductsByIds } = 
                let onlyShownProductIds = applyVisibilityRulesResult.onlyShownProductIds || [];
                let onlyShownVariantIds = applyVisibilityRulesResult.onlyShownVariantIds || [];
                uniqueProductsByIds = applyVisibilityRulesResult.uniqueProductsByIds


                let resultFilteredArrayOfUniqueProducts;
                if (onlyShownProductIds.length > 0) {
                    resultFilteredArrayOfUniqueProducts = onlyShownProductIds.map(itemId => uniqueProductsByIds[itemId]);
                } else {
                    resultFilteredArrayOfUniqueProducts = Object.values(uniqueProductsByIds).filter(product => product.available !== false);
                }

                // clean undefined and null values
                resultFilteredArrayOfUniqueProducts = resultFilteredArrayOfUniqueProducts.filter(item => item);

                if (resultFilteredArrayOfUniqueProducts.length < 1) {
                    return allProducts;
                }


                return resultFilteredArrayOfUniqueProducts;

            } catch (err) {
                gbb.utility.debugConsole("error came", err);
                return allProducts;
            }
        },


        filterOutBasedOnConditionalLogic_MultipleCategories: function (allCategories) {
            try {
                let cartData = gbb.state.giftBoxCartData;
                let conditionalLogic = gbb.settings.stepsConfigurationData?.conditionalLogic;

                if (!conditionalLogic.isEnabled || conditionalLogic.rules.length < 1) {
                    return allCategories;
                }

                let visibilityMapsData = gbb.f.getVisibilityMaps(conditionalLogic, cartData);

                Object.keys(allCategories).forEach(categoryKey => {
                    let category = allCategories[categoryKey];
                    let uniqueProducts = category.uniqueProductsData;
                    let uniqueProductsByIds = gbb.utility.convertArrayToObject(uniqueProducts, "productId");

                    let extraOptions = {
                        pageType: "MULTIPLE_CATEGORY"
                    }
                    let applyVisibilityRulesResult = gbb.f.applyVisibilityRulesToProducts(uniqueProductsByIds, visibilityMapsData, extraOptions);
                    // applyVisibilityRulesResult = gbb.f.applyVisibilityRulesToVariants(uniqueProductsByIds, visibilityMapsData);
                    let onlyShownProductIds = applyVisibilityRulesResult.onlyShownProductIds || [];
                    uniqueProductsByIds = applyVisibilityRulesResult.uniqueProductsByIds
                    let onlyShownVariantIds = applyVisibilityRulesResult.onlyShownVariantIds || [];


                    let tempValue;
                    if (onlyShownProductIds.length > 0 || onlyShownVariantIds.length > 0) {
                        tempValue = onlyShownProductIds.map(productId => uniqueProductsByIds[productId])
                        // .filter(product => product && product.available !== false);
                    }
                    //  else if (onlyShownProductIds.length < 1 && onlyShownVariantIds.length < 1) {
                    //     tempValue = [];
                    // }
                    else {
                        tempValue = Object.values(uniqueProductsByIds).filter(product => product && product.available !== false);
                    }

                    // when the end result will contain no product, we will just return all the data
                    // earlier we used to return all the data. now we dont
                    tempValue = tempValue.filter(item => item);
                    if (tempValue.length > 0) {
                        category.uniqueProductsData = tempValue;
                    } else {

                        category.categoryVisibility = {
                            hide: true,
                            "reason": "NO_PRODUCTS_MEET_CONDITION_LOGIC"
                        }

                    }

                });

                // just before returning check 
                // if all the categories have category.categoryVisibility.hide as true
                // if at least one of them has not hide as true 
                //then just delete all the others
                let allCategoriesVisibilityHidden = Object.values(allCategories).map((category) => {
                    return category.categoryVisibility?.hide || false
                });

                // allCategoriesVisibility =   if 
                if (allCategoriesVisibilityHidden.includes(false)) {
                    // allCategories = allCategories.filter((category)=>{
                    //     return category.categoryVisibility?.hide == false
                    // })
                    Object.keys(allCategories).forEach((categoryKey) => {
                        if (allCategories[categoryKey].categoryVisibility?.hide == true) {
                            delete allCategories[categoryKey]
                        }
                    })
                }


                return allCategories;
            } catch (err) {
                console.error("Error occurred:", err);
                return allCategories;
            }
        },




        filterOutBasedOnConditionalLogic2: function (allProducts) {
            try {
                let cartData = gbb.state.giftBoxCartData;

                let conditionalLogic = gbb.settings.stepsConfigurationData?.conditionalLogic;


                if (!conditionalLogic.isEnabled || conditionalLogic.length < 1) {
                    return allProducts;
                }



                let visibilityMapsData = gbb.f.getVisibilityMaps(conditionalLogic, cartData);

                let visibilityMapForProducts = visibilityMapsData.visibilityMapForProducts;
                let visibilityMapForTags = visibilityMapsData.visibilityMapForTags



                let uniqueProducts = JSON.parse(JSON.stringify(allProducts));


                let rulesVisibilityArrayForProducts = gbb.utility.convertObjectToArray(visibilityMapForProducts);
                let rulesVisibilityArrayForTags = gbb.utility.convertObjectToArray(visibilityMapForTags);

                let uniqueProductsByIds = gbb.utility.convertArrayToObject(uniqueProducts, "productId");

                let onlyShownProducts = [];




                let resultFilteredArrayOfUniqueProducts = [];

                for (let i = 0; i < rulesVisibilityArrayForProducts.length; i++) {
                    let rule = rulesVisibilityArrayForProducts[i];

                    // if we find 1;
                    Object.keys(rule).forEach(item => {
                        if (rule[item] == 1) {
                            onlyShownProducts.push(item)
                        }

                        if (rule[item] == -1 && uniqueProductsByIds[item]) {
                            // hide the product
                            uniqueProductsByIds[item]["available"] = false
                            // uniqueProductsById
                        }
                    });
                }


                for (let i = 0; i < rulesVisibilityArrayForTags.length; i++) {
                    let rule = rulesVisibilityArrayForTags[i];


                    Object.keys(rule).forEach(item => {
                        let isInternalOperator = "OR";
                        let currentMatchedItems;
                        if (isInternalOperator == "OR") {
                            currentMatchedItems = uniqueProducts.filter((product) => {
                                if (product.tags.includes(item)) {
                                    return product;
                                }

                            })
                        } else if (isInternalOperator == "AND") {
                            //  write an operator similar to above but with AND
                            let currentMatchedItems = uniqueProducts.filter((product) => {
                                // if every 
                                // rule is an object so we cant use includes



                            })

                        }

                        // clean currentMatchedItems to not return undefined


                        if (rule[item] == 1) {
                            currentMatchedItems.forEach((product) => {
                                if (product?.productId) {
                                    onlyShownProducts.push(product?.productId)
                                }
                            })
                        }

                        if (rule[item] == -1) {
                            // hide the product
                            // find the detail in uniqueProductsByIds and set available to false
                            let findSameTagValue = uniqueProducts.find((product) => {
                                return product.tags.includes(item)
                            })

                            if (findSameTagValue && uniqueProductsByIds[findSameTagValue.productId]) {
                                uniqueProductsByIds[findSameTagValue.productId]["available"] = false
                            }
                        }
                    });

                }

                if (onlyShownProducts.length > 0) {
                    let onlyShownProductsData = onlyShownProducts.map((item) => {
                        return uniqueProductsByIds[item]
                    });

                    // return onlyShownProductsData;
                    resultFilteredArrayOfUniqueProducts = onlyShownProductsData;
                } else {
                    Object.keys(uniqueProductsByIds).forEach(item => {
                        if (uniqueProductsByIds[item]["available"] == false) {
                            delete uniqueProductsByIds[item]
                        }
                    });

                    let uniqueProductsArray = gbb.utility.convertObjectToArray(uniqueProductsByIds);
                    // return uniqueProductsArray
                    resultFilteredArrayOfUniqueProducts = uniqueProductsArray
                }


                return resultFilteredArrayOfUniqueProducts;

            } catch (err) {
                gbb.utility.debugConsole("error came", err)
                return allProducts;
            }
        },
        filterOutBasedOnConditionalLogic_MultipleCategories2: function (allCategories) {
            try {
                let cartData = gbb.state.giftBoxCartData;
                let conditionalLogic = gbb.settings.stepsConfigurationData?.conditionalLogic;

                // let allCategories = gbb.gbbAddProductsPage.state.productPageData.categories;
                if (!conditionalLogic.isEnabled || conditionalLogic.length < 1) {
                    return allCategories;
                }

                let visibilityMapsData = gbb.f.getVisibilityMaps(conditionalLogic, cartData);

                let visibilityMapForProducts = visibilityMapsData.visibilityMapForProducts;
                let visibilityMapForTags = visibilityMapsData.visibilityMapForTags;

                Object.keys(allCategories).forEach(categoryKey => {
                    let category = allCategories[categoryKey];
                    let uniqueProducts = category.uniqueProductsData;

                    let uniqueProductsByIds = gbb.utility.convertArrayToObject(uniqueProducts, "productId");

                    let rulesVisibilityArrayForProducts = gbb.utility.convertObjectToArray(visibilityMapForProducts);
                    let rulesVisibilityArrayForTags = gbb.utility.convertObjectToArray(visibilityMapForTags);

                    let onlyShownProducts = [];

                    rulesVisibilityArrayForProducts.forEach(rule => {
                        Object.keys(rule).forEach(productId => {
                            if (rule[productId] == 1 && uniqueProductsByIds[productId]) {
                                onlyShownProducts.push(productId);
                            } else if (rule[productId] == -1 && uniqueProductsByIds[productId]) {
                                uniqueProductsByIds[productId]["available"] = false;
                            }
                        });
                    });

                    for (let i = 0; i < rulesVisibilityArrayForTags.length; i++) {
                        let rule = rulesVisibilityArrayForTags[i];

                        let operator = "OR";
                        let currentMatchedItems;
                        if (operator == "OR") {
                            Object.keys(rule).forEach(item => {
                                currentMatchedItems = uniqueProducts.filter((product) => {
                                    if (product.tags.includes(item)) {
                                        return product;
                                    }
                                })



                                // clean currentMatchedItems to not return undefined


                                if (rule[item] == 1) {
                                    currentMatchedItems.forEach((product) => {
                                        if (product?.productId) {
                                            onlyShownProducts.push(product?.productId)
                                        }
                                    })
                                }

                                if (rule[item] == -1) {
                                    // hide the product
                                    // find the detail in uniqueProductsByIds and set available to false
                                    let findSameTagValue = uniqueProducts.find((product) => {
                                        return product.tags.includes(item)
                                    })

                                    if (findSameTagValue && uniqueProductsByIds[findSameTagValue.productId]) {
                                        uniqueProductsByIds[findSameTagValue.productId]["available"] = false
                                    }
                                }
                            });
                        } else {
                            let isMatchedItemForEveryRule;




                        }

                    }

                    let categoryUniqueProductsData;
                    if (onlyShownProducts.length > 0) {
                        category.uniqueProductsData = onlyShownProducts.map(productId => uniqueProductsByIds[productId]).filter(product => product.available !== false);
                    } else {
                        category.uniqueProductsData = Object.values(uniqueProductsByIds).filter(product => product.available !== false);

                    }
                });

                return allCategories;
            } catch (err) {
                console.error("Error occurred:", err);
                // It seems there's a missing definition for allCategories here in the catch block. Assuming it should return an empty object or similar fallback.
                return {}; // or perhaps return the input unmodified or as best fits your error handling strategy
            }
        },
        convertCamelCaseToKebabCase: function (str) {
            try {
                return str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();

            } catch (error) {
                gbb.utility.debugError("error in convertCamelCaseToKebabCase", error);
            }
        },
        setCustomDesignConfigurationValues: function () {
            try {
                let root = document.documentElement;
                let pageCustomizationData = gbb.settings.pageCustomizationData || {}
                const keysToMap = ["productCard", "navigationBanner", "cartFooter"]
                keysToMap.forEach((key) => {
                    let currentKey = pageCustomizationData[key] || {}
                    Object.keys(currentKey).forEach((key) => {
                        let value = currentKey[key];
                        if (value) {
                            let _key = gbb.f.convertCamelCaseToKebabCase(key);
                            root.style.setProperty(`--gbb-${_key}`, value);
                        }

                    })
                })

            } catch (error) {
                gbb.utility.debugConsole("error in setCustomDesignConfigurationValues", error);
            }
        },
        initialize: async function (jQuery) {
            //renderLandingPage(); ->

            //show a loading screen
            gbb.$(".gbbPageFooterHTML").html("<div class='gbbLoadingScreen'><div class='gbbLoadingScreenSpinner'>    </div></div>");
            gbb.$(".gbbLoadingScreen").css("background", gbb?.settings?.app?.loadingBgColor);
            //TODO uncomment
            let tmpCartSettings = await gbb.f.getSettings();
            // tmpCartSettings = gbb.f.modifySettings(tmpCartSettings);
            gbb.f.setSettings(tmpCartSettings)
            gbb.f.setCustomDesignConfigurationValues();
            gbb.f.setSelectors()
            gbb.f.setDefaultThemeStyles();
            // gbb.f.setCustomStyling()
            // gbb.state.page_type = gbb.f.getPageType();
            gbb.elements = gbb.f.getElements(gbb.settings);
            // if ("" === gbb.state.page_type) return false;
            gbb.utility.setLanguageLocale();
            gbb.utility.gbbMultiLangOverrider();
            return gbb.f.bootstrap(gbb.settings);
        },
        globalListener: async function (settings) {
            let isIntervalActive = false
            //if app is disabled reurn
            if (settings?.app?.disableApp) {
                return "<div>App is unavailable</div>"
            } else {
                //gbb.gbbPage.init();
                // initialization will call get settings
                // and therefore we will have the data globally
                //
                gbb.state.cartData = await gbb.utility.getCart()

                // gbb.gbbMainPage.init();
                // gbb.gbbFooter.init();
                // gbb.utility.debugConsole(gbb.settings.languageData);

                gbb.giftboxbuilderPage.init();
            }
        },

        modifySettings: function (settings) {
            try {
                let currentBundleTemplate = settings.stepsConfigurationData.bundleDesignTemplate;

                //    let oldSettings = JSON.parse(JSON.stringify(settings))

                if (currentBundleTemplate && settings.pageCustomizationData?.templateLevelConfig) {
                    settings.pageCustomizationData = settings.pageCustomizationData?.templateLevelConfig[currentBundleTemplate] || settings.pageCustomizationData
                }



                return settings;
            } catch (e) {
                gbb.utility.debugConsole("error in modifySettings", e)
                return settings;
            }
        },
    },
    utility: {
        getcachedProductData: async function (fetchsixtyProductsEachStep) {
            // convert map to array 
            // let cachedProductData = Array.from(gbb.state.cachedProductData.entries());
            // call getProductDataV2 data in batch of 20
            setTimeout(async () => {
                // gbb.utility.debugConsole("getcachedProductData")
                while (fetchsixtyProductsEachStep.length > 0) {
                    let batch = fetchsixtyProductsEachStep.splice(0, 20)
                    let apiCalls = []
                    for (let i = 0; i < batch.length; i++) {
                        apiCalls.push(gbb.utility.getProductDataV2(batch[i]))
                    }
                    await Promise.all(apiCalls)
                }
            },
                1000)

        },
        getcachedProductDataForGraphql: async function (fetchsixtyProductsEachStep) {
            if (gbb.settings.merchantInfo.storefrontAccessToken) {

                // fetchsixtyProductsEachStep.forEach(item=> {
                //     item = "gid://Product/"+ item
                // });

                for (let i = 0; i < fetchsixtyProductsEachStep.length; i++) {
                    let item = fetchsixtyProductsEachStep[i];
                    fetchsixtyProductsEachStep[i] = "gid://shopify/Product/" + item
                    // "gid://shopify/Product/9170602688797"
                }

                let graphQLProductsData = [];

                setTimeout(async () => {
                    // gbb.utility.debugConsole("getcachedProductData")
                    while (fetchsixtyProductsEachStep.length > 0) {
                        let batch = fetchsixtyProductsEachStep.splice(0, 20)
                        // let starttime = 
                        // console.time("fetch-1");
                        let graphQLFetchedData = await gbb.graphQlUtility.getProductsDataByIds(fetchsixtyProductsEachStep.splice(0, 20))
                        graphQLProductsData.push(...graphQLFetchedData)
                        // console.timeEnd("fetch-1")

                        // let apiCalls = []
                        // for (let i = 0; i < batch.length; i++) {
                        //     // apiCalls.push(gbb.utility.getProductDataV2(batch[i]))
                        //     apiCalls.push(gbb.graphQlUtility.getProductsDataByIds(batch[i]))
                        // }
                        // console.time("fetch-2-sync");
                        // await Promise.all(apiCalls)
                        // console.timeEnd("fetch-2-sync");



                    }

                },
                    1000)
            }
            // convert map to array 
            // let cachedProductData = Array.from(gbb.state.cachedProductData.entries());
            // call getProductDataV2 data in batch of 20

        },
        getDynamicDiscountCode: async function () {
            // gbb.utility.getCartDataAfterDiscount()
            // gbb.utility.debugConsole('dyamic called')


            // if kite integration is enabeld then also retyrn early

            let discountData = gbb.settings.discountsData || {}
            if (discountData?.discountMode == 'PRODUCT_SPECIFIC_DISCOUNT' && discountsData?.isKiteIntegrationEnabled) {
                //no need to compute code, just send it back early
                return
            }
            

            if (!gbb.gbbDiscountComponent.state.isAtleastOneDiscountActive) {
                return;
            }

            // let cartData = gbb.gbbDiscountComponent.f.discountEligibleCartData();
            // const bundleQuantity = cartData.bundleQuantity;

            // let cartData = gbb.state.giftBoxCartData;
            // const productIdsPresentInCart = cartData?.items?.map((item) => {
            //     return item?.product_id
            // })


            let bundleDataObj = gbb.utility.calculateCartDiscount();

            const productIdsPresentInCart = bundleDataObj?.cartProductListForDiscounts.map(item => parseInt(item))
            const variantIdsPresentInCart = bundleDataObj?.cartVariantListForDiscounts.map(item => parseInt(item))
            let VariantListPricePresentInCart = bundleDataObj?.cartVarientPriceListForDiscounts;

            let activeCurrencyRate = gbb.utility.getActiveCurrencyRate();
            // let cartTotalAmount = bundleDataObj.cartTotalAmount;
            let cartSubtotalAmount = bundleDataObj.cartSubTotal;

            VariantListPricePresentInCart = VariantListPricePresentInCart.map((price) => {
                return price / parseFloat(activeCurrencyRate)
            })



            let cartValue = cartSubtotalAmount / 100;
            let convertCartValueToStoreCurrencyValue = cartValue / activeCurrencyRate

            let cartDiscount = bundleDataObj.cartDiscount / parseFloat(activeCurrencyRate)
            let cartTotalQty = bundleDataObj.cartTotalQty;
            let discountAmountToBeApplied = cartDiscount / 100;

            if (discountAmountToBeApplied > 0 == false) {
                // gbb.utility.debugConsole("discountAmountToBeApplied is 0")
                return;
            }

            let discountsPerBoxWithCorrectedPrices = {}
            for (let i = 0; i < Object.keys(bundleDataObj?.discountsPerBox).length; i++) {
                let _boxKey = Object.keys(bundleDataObj.discountsPerBox)[i];
                let _boxValue = JSON.parse(JSON.stringify(bundleDataObj.discountsPerBox[_boxKey]));
                _boxValue.boxDiscount = (_boxValue.boxDiscount / 100) / activeCurrencyRate
                _boxValue.boxSubTotal = (_boxValue.boxSubTotal / 100) / activeCurrencyRate
                _boxValue.boxTotalAmount = (_boxValue.boxTotalAmount / 100) / activeCurrencyRate

                discountsPerBoxWithCorrectedPrices[_boxKey] = _boxValue;
            }


            let bodyToBePassed = {
                type: "quantity",
                currency: activeCurrencyRate,
                cartValue: convertCartValueToStoreCurrencyValue,
                bundleId: gbb.state.bundleId,
                discountsPerBox: discountsPerBoxWithCorrectedPrices,
                cartQuantity: cartTotalQty,
                productIds: productIdsPresentInCart,
                variantIds: variantIdsPresentInCart,
                productHandles: bundleDataObj?.cartProductHandlesForDiscounts,
                variantListPrice: VariantListPricePresentInCart,
                discountValue: discountAmountToBeApplied,
                discountCodePrefix: gbb.gbbDiscountComponent.state.discountCodePrefix,
                deviceDetails: navigator && navigator.userAgent ? navigator.userAgent : "Couldnt find device details"
            }

            if (gbb.settings.discountsData.discountMode === "FIXED_BUNDLE_PRICE") {
                bodyToBePassed["type"] = "quantity"
            }
            else if (gbb.gbbDiscountComponent.state.currentDiscountRule?.type === "quantity") {
                bodyToBePassed["type"] = gbb.gbbDiscountComponent.state.currentDiscountRule.type
            } else if (gbb.gbbDiscountComponent.state.currentDiscountRule?.type === "amount") {
                bodyToBePassed["type"] = gbb.gbbDiscountComponent.state.currentDiscountRule.type
            } else {
                bodyToBePassed["type"] = "amount"
            }

            let endPoint = "/dynamicDiscountCodeV2";
            const subscriptionPlanExists = gbb.gbbReviewPage.f.checkIfSubscriptionPlanExists();
            if (subscriptionPlanExists && gbb.gbbBrowser.getSubscriptionType() == "saveSubscription") {
                bodyToBePassed["enableRecurringDiscounts"] = gbb.settings?.stepsConfigurationData?.enableRecurringDiscounts || false;
                bodyToBePassed["subscriptionDiscount"] = true;
                endPoint = "/dynamicDiscountCodeV2"
            }
            const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()
            if (isPurchaseTypeSubscription) {
                bodyToBePassed["enableRecurringDiscounts"] = gbb.settings?.stepsConfigurationData?.enableRecurringDiscounts || false;
                bodyToBePassed["subscriptionDiscount"] = true;
                endPoint = "/dynamicDiscountCodeV2"
            }
            await fetch("/apps/" + gbb.state.gbbUrl + `${endPoint}?bundleId=${gbb.state.bundleId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(bodyToBePassed)
            }).then((response) => {
                return response.json();
            }).then((data) => {
                if (data) {
                    gbb.utility.debugConsole("discount code", data.data.code);
                    gbb.gbbDiscountComponent.state.discountCode = data.data.code;
                }
            }).catch((error) => {
                gbb.utility.debugConsole(error);
            });
        },
        setCachedGraphqlData: function (data) {
            try {
                // TODO: graphql or REST
                // cachedProductDataGraphql or cachedProductData..... confused
                let cachedProductData = gbb.state.cachedProductDataGraphql;

                for (let i = 0; i < data.length; i++) {
                    let item = data[i];
                    let productId = item?.id;
                    let productData = item;
                    cachedProductData.set(productId, productData)
                }
            } catch (e) {
                gbb.utility.debugConsole("error in setCachedGraphqlData", e)
            }
        },
        getLocale: function () {
            if (window.Shopify && window.Shopify.locale) {
                return window.Shopify.locale
            } else {
                return "en"
            }
        },
        getCountry: function () {
            if (window.Shopify && window.Shopify.country) {
                return Shopify.country
            }
        },
        setLanguageLocale: function () {
            let locale = gbb.utility.getLocale()
            gbb.state.languageMode = gbb.settings.languageData.languageMode
            if (gbb.settings.languageData && gbb.settings.languageData.languageMode == "SINGLE") {
                locale = "en"
            }

            if (!gbb.settings.languageData[locale]) {
                locale = "en"
            }
            gbb.settings.languageData = gbb.settings.languageData[locale]
        },
        getNavItem: function (id) {
            let navigationItems = gbb.state.navigationItems;
            let navigationItem = navigationItems.filter(function (item) {
                return item.id === id;
            })
            return navigationItem[0];
        },
        disableElement: function (element, timeInMs) {
            //use this function to disable element for a specific time,
            // most likely to prevent double click
            element.prop("disabled", true);
            element.addClass("gbbDisabled");
            if (timeInMs >= 0) {
                setTimeout(function () {
                    element.prop("disabled", false);
                    element.removeClass("gbbDisabled");
                }, timeInMs);
            }
        },
        getNextNavigationItem: function () {

            let navigationItems = gbb.gbbModal.state.navigationItems;
            let currentNavigationId = gbb.gbbModal.state.currentNavigationId;

            let currentNavigationItem = gbb.gbbModal.f.getNavItem(currentNavigationId);

            // find the index of the current navigation item
            let currentNavigationIndex = navigationItems.indexOf(currentNavigationItem);
            // gbb.utility.debugConsole(currentNavigationIndex);
            // get the next navigation item making sure its not the last one, if its then return null
            if (currentNavigationIndex === navigationItems.length - 1) {
                return null;
            }
            else {
                return navigationItems[currentNavigationIndex + 1];
            }
        },
        isNavElementLast: function (id) {
            // if it is last then return null
            let navigationItems = gbb.gbbModal.state.navigationItems;
            let currentNavigationId = id;

            //check if the passed id is the last one
            let currentNavigationItem = gbb.gbbModal.f.getNavItem(currentNavigationId);
            let currentNavigationIndex = navigationItems.indexOf(currentNavigationItem);
            if (currentNavigationIndex === navigationItems.length - 1) {
                return true;
            }
            else {
                return false;
            }
        },
        getDate: function (date) {
            let d = new Date(date);
            let month = "" + (d.getMonth() + 1);
            let day = "" + d.getDate();
            let year = d.getFullYear();

            if (month.length < 2) month = "0" + month;
            if (day.length < 2) day = "0" + day;

            return [year, month, day].join("-");
        },
        addToCart: async function ({ variant, parent, qty = 1 }, noteAttribute, category = undefined, defaultProduct = undefined) {
            try {
                if (qty == 0) {
                    return
                }
                let data = {
                    updates: { [variant.id]: qty },
                    attributes: {
                        [variant.id]: noteAttribute,
                    }
                }

                if (category && category != "") {
                    data.attributes.category = category
                    data.attributes.categoryName = gbb.gbbAddProductsPage?.state?.productPageData?.categories[category].title || category
                }

                if (defaultProduct && defaultProduct != "") {
                    data.attributes.defaultProduct = true
                }


                // if properties and variant ids are the same then just add their quantities respective



                await gbb.utility.updateCartV2(data)
                if (false && gbb.$(".gbbProductsCardLayoutV2").length > 0) {
                    let isCurrentPageExhausedATCFooterAnimation = gbb?.gbbAddProductsPage?.state?.pagesWhichHaveExhaustedATCFooterAnimation?.includes(gbb?.state?.currentPageId);
                    //true replace true with actual toggle key when implemented from admin
                    let isATCAnimationEnabled = gbb?.gbbAddProductsPage?.state?.isAnimateFooterOnATCEnabled
                    let isAddingFirstProductToCart = gbb?.state?.giftBoxCartData?.items?.length == 1 && gbb?.state?.giftBoxCartData?.items[0]?.quantity == 1
                    if (isATCAnimationEnabled && (isAddingFirstProductToCart || !isCurrentPageExhausedATCFooterAnimation)) {
                        let currentPageId = gbb?.state?.currentPageId;
                        setTimeout(() => {
                            let isFooterOpen = gbb?.gbbAddProductsPage?.state?.showBoxProductsInFooter || false
                            if (!isFooterOpen) {
                                gbb.gbbAddProductsPage.f.toggleBoxProductsDisplayFooter()
                                !isCurrentPageExhausedATCFooterAnimation && gbb?.gbbAddProductsPage?.state?.pagesWhichHaveExhaustedATCFooterAnimation?.push(currentPageId)
                                setTimeout(() => gbb.gbbAddProductsPage.f.toggleBoxProductsDisplayFooter(), 3000)
                            }
                        }, 100)// doing this cause once file is loaded then will can get smooth animation without setTimeout its rendering the open footer direct
                    }
                }
            } catch (error) {
                gbb.utility.debugError("gbb-utility-addToCart");
                gbb.utility.debugError(error);
                return false
            }
        },
        updateCart: async function (data) {
            try {
                let result = await gbb.$.ajax({
                    type: "POST",
                    url: "/cart/update.js",
                    data: data,
                    dataType: "json",
                });
                return result
            } catch (error) {
                gbb.utility.debugError("gbb-utility-updateCart");
                gbb.utility.debugError(error);
                return false
            }
        },
        updateCartV2: async function (data, noteAttribute) {
            try {

                let variantId = Object.keys(data.updates)[0];

                let quantity = data.updates[variantId];

                let originForVariantDetails = data.attributes[variantId] == "addonProduct" ? "addonProducts" :null
                let productItem = gbb.utility.getVariantDetailsFromCurrentProductsDataSet(variantId, originForVariantDetails) || {};

                if (productItem && productItem != "undefined") {
                }
                else {
                    // gbb.utility.debugConsole("variantId is undefined");
                    // return;
                }

                let result;
                //in data.attributes we get key value pair, but we only need the value
                let attributes = data?.attributes || {}
                // let additionalProperties = {}
                let _properties = {
                    "_boxProduct": data?.attributes[variantId],
                    // "_Bundle ID": gbb.state.bundleId,
                    "Bundle": gbb.settings?.stepsConfigurationData?.bundleName || "",
                    "Box ID": gbb.state?.activeBoxId?.split("box")[1] || 1,

                    "_uniqueGbbItemKey": data?.additionalInfo?._uniqueGbbItemKey || gbb.utility.getUniqueIdForVariant({ variantId, attributes: data.attributes }),
                    ...gbb.state.variantCustomProperties
                }
                if (data?.attributes[variantId] == 'addonProduct') { 
                    _properties["_addon_product"] = true;
                    // _properties["_addon_offer_id"] = gbb.gbbAddonProducts.state.offerId
                }
                //this is for storing the  category name on multiple categories step
                if (data?.attributes.category) {
                    _properties["_Category"] = data?.attributes.category;
                    _properties["_CategoryName"] = data?.attributes.categoryName;
                }

                if (data?.attributes.defaultProduct) {
                    _properties["_DefaultProduct"] = "Yes";
                }

                if (data?.attributes[variantId] == "giftMessage") {
                    let msgAttributes = gbb.utility.prepareMsgAttributesForCart();
                    if (msgAttributes.message) {
                        _properties["Message"] = msgAttributes.message
                    }

                    if (msgAttributes.recipientName) {
                        _properties["Recipient Name"] = msgAttributes.recipientName
                    }

                    if (msgAttributes.senderName) {
                        _properties["Sender Name"] = msgAttributes.senderName
                    }

                    if (msgAttributes.email) {
                        _properties["Recipient Email"] = msgAttributes.email
                    }
                    if (msgAttributes._videoMsgId) {
                        _properties["_videoMsgId"] = msgAttributes._videoMsgId
                        _properties["Video Recorded"] = msgAttributes._videoMsgId ? "yes" : "";
                    }
                    if (msgAttributes._gbbEmailDeliveryDate) {
                        _properties["_gbbEmailDeliveryDate"] = msgAttributes._gbbEmailDeliveryDate;
                    }
                    if (msgAttributes._gbbEmailDeliveryOption) {
                        _properties["_gbbEmailDeliveryOption"] = msgAttributes._gbbEmailDeliveryOption;
                    }

                    // if(msgAttributes.customerUploads){
                    //     _properties["Customer Uploads"] = msgAttributes.customerUploads;
                    // }

                    if (msgAttributes.customerUploads) {
                        //use spread operator and add the customerUploads property to the _properties object
                        _properties = { ..._properties, ...msgAttributes.customerUploads }
                    }

                }
                let argsObj = {
                    properties: _properties,
                    variantId: variantId,
                }

                let uniqueItemKey = _properties?._uniqueGbbItemKey || gbb.utility.getUniqueIdForVariant(argsObj);
                const item = gbb.utility.checkIfItemPresentInGiftBoxCart(variantId, { uniqueItemKey });

                if (item) {
                    // if item is present in cart then update the qty using the change attribute method
                    let _data = {
                        id: item.key || item.id,
                        quantity: quantity,
                        properties: {
                            ...item.properties,
                            ..._properties
                        }
                    }
                    result = await gbb.utility.changeCart(_data);
                }
                else {
                    // if item is not present in cart then add it using the add attribute method
                    let _data = {
                        id: variantId,
                        quantity: quantity,
                        properties: _properties
                    }
                    if (_data.quantity != 0) {
                        gbb.gbbBrowser.addItemToCartSessionStorage({ ..._data, ...productItem });
                    }
                }

                gbb.state.giftBoxCartData = await gbb.utility.getGiftBoxProductsFromCart()
                gbb.gbbDiscountComponent.f.updateCurrentDiscountRule();
                gbb.gbbAddonProducts.f.calculateEligibleAddonProductsTier()
                gbb.gbbBrowser.emitCustomEvent({
                    eventName: "gbb-cart-update",
                    detail: {
                        variantId: variantId,
                        // quantity: item - quantity,
                    }
                })
                return result
            } catch (error) {
                gbb.utility.debugError("gbb-utility-updateCartV2");
                gbb.utility.debugError(error);
                return false
            }
        },
        changeCart: async function (data) {
            try {
                return gbb.gbbBrowser.updateCartItemQuantityAndProperty(data.id, data.quantity, data.properties);
                let result = await gbb.$.ajax({
                    type: "POST",
                    url: "/cart/change.js",
                    data: data,
                    dataType: "json",
                });
                return true
            } catch (error) {
                gbb.utility.debugError("gbb-utility-changeCart");
                gbb.utility.debugError(error);
                return false
            }
        },
        getAttributValueFromCart: function (attributeName) {
            if (gbb.state.giftBoxCartData && gbb.state.giftBoxCartData.attributes && gbb.state.giftBoxCartData.attributes[attributeName] && gbb.state.giftBoxCartData.attributes[attributeName] != "") {
                return gbb.state.giftBoxCartData.attributes[attributeName]
            } else {
                return null
            }
        },
        getProductsInDefaultView: function () {
            return gbb.gbbAddProductsPage.state.uniqueProductsData;
        },
        getCurrencySymbolByCode: function (code) {
            try {
                let merchantCurrencies = gbb?.settings?.merchantInfo?.multipleCurrenciesInfo;
                if (merchantCurrencies.hasOwnProperty(code)) {
                    return merchantCurrencies[code]?.symbol;
                }
                return "";
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        setStoreCurrenyStateFromCart: async function () {
            try {
                if (gbb.state.storeCurrencySymbol) {
                    return;
                } else {
                    if (window && window.Shopify && window.Shopify.currency && window.Shopify.currency.active) {
                        gbb.state.storeCurrencySymbol = gbb.utility.getCurrencySymbol();
                    } else {
                        let _shopifyCartData = await gbb.shopifyUtility.getCart();
                        gbb.state.storeCurrencySymbol = gbb.utility.getCurrencySymbolByCode(_shopifyCartData?.currency);
                    }
                }
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        formatPrice: function (price) {
            if (window && window.Shopify && window.Shopify.currency && window.Shopify.currency.active) {
                //find the currency symbol from  gbb.settings.merchantInfo.multipleCurrencies[window.Shopify.currency.active] get the symbol
                let currencySymbol = gbb.utility.getCurrencySymbol();
                return currencySymbol + "" + parseFloat(price / 100).toFixed(2)
            } else {
                return gbb.state.storeCurrencySymbol + "" + parseFloat(price / 100).toFixed(2)
            }
        },
        formatPriceWithoutSymbol: function (price) {
            if (window && window.Shopify && window.Shopify.currency && window.Shopify.currency.active) {
                //find the currency symbol from  gbb.settings.merchantInfo.multipleCurrencies[window.Shopify.currency.active] get the symbol
                return parseFloat(price / 100).toFixed(2)
            } else {
                return parseFloat(price / 100).toFixed(2)
            }
        },

        //calculate cartDiscount uses getCartDataFromSessionStorage, gets the entire data.
        //then we loop on boxes object and inside each object we use
        //we have discountValue as a variable stored in it,
        // depending on the discountMode we will calculate the discount we have to offer
        //we will multiply the discountValue by boxQuantity and also multiply the quantity of each product by boxQuantity
        // the values returned are cartSubTotal: - 1900
        // cartDiscount: - 520
        // cartTotalAmount - 1380
        // cartTotalqty -
        // cartProductListForDiscounts: []
        calculateCartDiscount: function (cartData) {
            if (!cartData) {
                cartData = gbb.gbbBrowser.getCartDataFromSessionStorage({ forSubscription: true });
            }
            // let cartData = gbb.gbbBrowser.getCartDataFromSessionStorage();

            //all the prices in this function are in shopify formats. 
            //.i.e. 100 = 1.00

            let cartSubTotal = 0;
            let cartDiscount = 0;
            let cartTotalAmount = 0;
            let cartTotalQty = 0;
            let cartBlacklistedItemsTotal = 0;
            let cartProductListForDiscounts = [];
            let cartProductHandlesForDiscounts = [];
            let cartVariantListForDiscounts = [];
            let cartVarientPriceListForDiscounts = [];
            let discountMode = gbb.settings.discountsData.discountMode
            let discountsPerBox = {}

            if (gbb.settings.discountsData.isKiteDiscountMessagingEnabled){
                discountMode = gbb.settings.discountsData.kiteDiscountMessaging.discountMode;
            }

            if (cartData && cartData.boxes) {
                Object.keys(cartData.boxes).forEach((item) => {
                    let box = cartData.boxes[item];
                    box = gbb.gbbDiscountComponent.f.discountEligibleCartData(box);
                    //let discountValue = gbb.gbbDiscountComponent.state.currentDiscountRule[box.boxId]?.discountValue || box.discountValue;
                    let discountValue = gbb.gbbDiscountComponent.state.currentDiscountRule[box.boxId]?.discountValue;
                    discountValue = parseFloat(discountValue);
                    let discountValueIsNumber = !isNaN(discountValue) && typeof discountValue == "number";

                    if (discountValueIsNumber && discountMode == "FIXED" || discountMode == "FIXED_BUNDLE_PRICE") {
                        discountValue = parseFloat(discountValue) * 100;
                        let activeCurrencyRate = gbb.utility.getActiveCurrencyRate();
                        discountValue = discountValue * activeCurrencyRate;
                    }


                    let boxQuantity = box.boxQuantity;
                    let boxItemCount = box.item_count;
                    let boxPrice = box.total_price;
                    let boxDiscount = 0;
                    let boxTotalAmount = box.total_price * boxQuantity;
                    let boxTotalQty = box.boxQuantity;

                    let boxProductList = [];
                    let boxProductHandleList = [];
                    let boxVariantList = [];
                    let boxVarientPriceList = [];
                    //check if discountValue in not Nan, or undefinded, or null, check the type of discountValue
                    if (discountValueIsNumber) {
                        if (discountMode == "FIXED") {
                            boxDiscount = discountValue * boxQuantity;
                            boxTotalAmount = ((boxPrice * boxQuantity) - boxDiscount)
                            boxTotalQty = boxQuantity;
                        } else if (discountMode == "PERCENTAGE") {
                            boxDiscount = ((boxPrice * discountValue) / 100) * boxQuantity;
                            boxTotalAmount = ((boxPrice * boxQuantity) - boxDiscount);
                            boxTotalQty = boxQuantity;
                        } else if (discountMode == "FIXED_BUNDLE_PRICE") {
                            boxDiscount = (boxPrice - discountValue) * boxQuantity;

                            //this is written because a floating point error came
                            // boxPrice = 3980
                            // discountValue =3979.9999995
                            if (boxDiscount > 0.0001) {
                                boxDiscount = boxDiscount;
                            } else {
                                boxDiscount = 0;
                            }

                            boxTotalAmount = discountValue * boxQuantity;
                            boxTotalQty = boxQuantity;
                        }
                    }
                    cartSubTotal += boxPrice * boxQuantity;
                    cartDiscount += boxDiscount;
                    cartTotalAmount += boxTotalAmount;
                    cartTotalQty += (boxTotalQty * boxItemCount);


                    if (isNaN(box.blackListedItemsTotalPrice)) {
                        box.blackListedItemsTotalPrice = 0;
                    }

                    cartBlacklistedItemsTotal += box.blackListedItemsTotalPrice;
                    discountsPerBox[box.boxId] = {
                        boxDiscount: boxDiscount,
                        boxSubTotal: boxPrice * boxQuantity,
                        boxTotalAmount: boxTotalAmount,
                        boxTotalQty: boxTotalQty * boxItemCount,
                        boxQuantity: boxQuantity,
                        blackListedItemsTotalPrice: box.blackListedItemsTotalPrice,
                    }
                    // boxProductList = box.products.map((product) => 
                    //push the product.id in the boxProductList
                    box.items.forEach((product) => {
                        if (product.price > 0) {
                            boxProductHandleList.push(product.productHandle)
                            boxProductList.push(product.product_id)
                        }
                    })
                    box.items.forEach((product) => {
                        if (product.price > 0) {
                            boxVariantList.push(product.id)
                            boxVarientPriceList.push(product.price / 100)
                        }
                    })
                    cartProductListForDiscounts.push(boxProductList)
                    cartProductHandlesForDiscounts.push(boxProductHandleList)
                    cartVariantListForDiscounts.push(boxVariantList)
                    cartVarientPriceListForDiscounts.push(boxVarientPriceList)
                })
            }

            //if either of the number is not a number, then return 0
            if (isNaN(cartSubTotal)) {
                cartSubTotal = 0;
            }
            if (isNaN(cartDiscount)) {
                cartDiscount = 0;
            }
            if (isNaN(cartTotalAmount)) {
                cartTotalAmount = 0;
            }
            if (isNaN(cartTotalQty)) {
                cartTotalQty = 0;
            }
            if (isNaN(cartBlacklistedItemsTotal)) {
                cartBlacklistedItemsTotal = 0;
            }


            return {
                cartSubTotal: cartSubTotal,
                cartBlacklistedItemsTotal: cartBlacklistedItemsTotal,
                cartDiscount: cartDiscount,
                cartTotalAmount: cartTotalAmount,
                cartTotalQty: cartTotalQty,
                cartProductListForDiscounts: cartProductListForDiscounts.flat(),
                cartProductHandlesForDiscounts: cartProductHandlesForDiscounts.flat(),
                cartVariantListForDiscounts: cartVariantListForDiscounts.flat(),
                cartVarientPriceListForDiscounts: cartVarientPriceListForDiscounts.flat(),
                discountsPerBox: discountsPerBox,
            }
        },
        removeUnUsedVariantImages: function (product) {
            try {
                const usedMediaIds = new Set();
                product.variants.forEach(variant => {
                    if (variant.featured_media) {
                        usedMediaIds.add(variant.featured_media.id);
                    }
                });

                let allMediasSortedByAltKey = gbb.utility.convertArrayToObjectWithArrays(product.media, "alt");



                // this issue arises whe we find that 
                // not all variants have an image associated with it
                // in that case, all images are product base images
                if (usedMediaIds.size < 1) {
                    return product;
                }

                product.media = product.media.filter(media => usedMediaIds.has(media.id));


                // use the alt key present in the media object to get the media object from allMediasSortedByAltKey
                // and then push it to product.media

                let filteredMedia = JSON.parse(JSON.stringify(product.media));

                filteredMedia.forEach(media => {
                    if (!media.alt){
                        media.alt = media?.id;
                    }
                    let _media = allMediasSortedByAltKey[media.alt];

                    if (_media) {
                        if (_media.length) {
                            product.media.push(..._media);
                        }
                    }
                });

                // sort media by position
                product.media.sort((a, b) => a.position - b.position);
                //  remove duplicates after sorting
                product.media = product.media.filter((media, index, self) =>
                    index === self.findIndex((t) => (
                        t.id === media.id
                    ))
                )



                const usedImageUrls = new Set(product.media.map(media => media.src));

                product.images = product.images.filter(imageUrl => {
                    const httpsImageUrl = imageUrl.startsWith('//') ? 'https:' + imageUrl : imageUrl;
                    return usedImageUrls.has(httpsImageUrl);
                });


                return product;
            } catch (error) {
                gbb.utility.debugConsole("error in removeUnUsedVariantImages", error)
            }
        },

        shiftFirstVariantMedia_toFirstIndexInMediaObj: function (product) {
            try {
                product = JSON.parse(JSON.stringify(product));
                if (product.variants.length > 0) {
                    let firstVariant = product.variants[0];
                    if (firstVariant.featured_media) {
                        let featuredMedia = firstVariant.featured_media;
                        let featuredMediaIndex = product.media.findIndex(media => media.id == featuredMedia.id);
                        if (featuredMediaIndex > -1) {
                            let featuredMedia = product.media.splice(featuredMediaIndex, 1);
                            product.media.unshift(featuredMedia[0]);
                        }
                    }
                }
                return product;
            } catch (error) {
                gbb.utility.debugConsole("error in shiftFirstVariantMedia_toFirstIndexInMediaObj", error)
            }
        },


        getProductData_AfterRemovingUnavailableVariantsAndOptions: function (product) {
            try {
                let productData = JSON.parse(JSON.stringify(product));
                productData.variants = productData?.variants?.filter(variant => variant.available);

                productData.options = productData.options.map(option => {
                    // For each option, filter the values that are included
                    //  in at least one of the variant
                    let values = option.values.filter(value => {
                        for (let variant of productData.variants) {
                            // If the variant's options include the value, 
                            // return true to include it in the filter
                            if (variant.options.includes(value)) {
                                return true;
                            }
                        }
                        // If the value is not found in any variant's options,
                        // return false to exclude it from the filter
                        return false;
                    });

                    // Return the new option object, spreading the previous option 
                    //properties and replacing the 'values' with the filtered ones
                    return {
                        ...option,
                        values
                    };
                })

                //check if productData.variants and productData.options are the same as product.variants and product.options
                //if yes, then return productData : with a removedVariantsAndOptions flag
                if (productData.variants.length != product.variants.length || productData.options.length != product.options.length) {
                    // productData.removedVariantsAndOptions = true;
                    productData.renderChooseOptionsButton_forcefully = true;
                } else {
                    productData.renderChooseOptionsButton_forcefully = false;
                }

                // productData.price = productData.variants[0].price || productData.price
                if (productData.variants && productData.variants.length > 0) {
                    productData.price = productData.variants[0].price || productData.price
                    productData.compare_at_price = productData.variants[0].compare_at_price || productData.compare_at_price
                }

                return productData;
            } catch (error) {
                gbb.utility.debugConsole("error in getProductData_AfterRemovingUnavailableVariantsAndOptions", error)
            }
        },
        getCurrencySymbol: function () {
            if (window && window.Shopify && window.Shopify.currency && window.Shopify.currency.active) {
                let symbol = gbb.settings.merchantInfo.multipleCurrenciesInfo[window.Shopify.currency.active]?.symbol || Shopify.currency.active;
                return symbol;
            } else {
                return gbb.state.storeCurrencySymbol;
            }
        },
        getStoreCurrencySymbol: function () {
            return gbb.settings.merchantInfo.currencyInfo.symbol;
        },

        getProductDataV2: function (productName, options) {
            try {
                let languageValue = window?.Shopify?.routes?.root ? window.Shopify.routes.root : "/"
                return new Promise(async (res, rej) => {
                    if (gbb.state.cachedProductData.has(productName)) {
                        res(gbb.state.cachedProductData.get(productName));
                    } else {
                        let productHandlesAreTranslated = gbb.settings.app.productHandlesAreTranslated || false;
                        let flowForFetch;

                        if (productHandlesAreTranslated && options?.dontRetry != true) {
                            flowForFetch = "HANDLE_TRANSLATED_HANDLES";
                        } else {
                            flowForFetch = "FETCH_DEFAULT_HANDLES";
                        }

                        if (flowForFetch === "FETCH_DEFAULT_HANDLES") {
                            gbb.$.getJSON(languageValue + "products/" + productName + ".js", function (product) {
                                product = gbb.gbbKite.f.modifyProductDataWithDiscountedPrice(product);
                                gbb.state.cachedProductData.set(productName, product);
                                res(product);
                            }).fail(function () {
                                gbb.utility.debugConsole("fail-productName: ", productName);
                                gbb.state.cachedProductData.set(productName, false);
                                res(false);
                            });
                        } else if (flowForFetch === "HANDLE_TRANSLATED_HANDLES") {
                            let _updated = await gbb.utility.getProductDataForTranslatedHandles(productName, languageValue);
                            res(_updated);
                        }
                    }
                });

                return result;
            } catch (error) {
                gbb.utility.debugError("gbb-utility-getProductDataV2");
                gbb.utility.debugError(error);
                return false
            }
        },
            getProductDataForTranslatedHandles: function (productName, languageValue) {
            return new Promise((res, rej) => {
                fetch(languageValue + "products/" + productName)
                    .then(async (response) => {
                        if (!response.ok) throw new Error("Network response was not ok");
                        gbb.utility.debugConsole("Final URL:", response.url); // Log the final redirected URL
                        // response.url = response.url.trim().endsWith("/") ? response.url.slice(0, -1) : response.url;
                        let urlReturned = response.url;

                        // Remove the last character if it is a '/'
                        if (urlReturned[urlReturned.length - 1] === "/") {
                            urlReturned = urlReturned.substring(0, urlReturned.length - 1);
                        }
                        gbb.utility.debugConsole("urlReturned", urlReturned);

                        // Extract the last path segment and get the string before the first '.'
                        let newHandle = urlReturned.split("/").pop().split(".")[0];

                        // console.log("newHandle", newHandle);
                        gbb.utility.debugConsole("newHandle", newHandle);

                        // now call productDataV2 with the final url
                        return await gbb.utility.getProductDataV2(newHandle, { dontRetry: true });
                    })
                    .then(product => {
                        gbb.utility.debugConsole("Product Data:", product);
                        res(product); // resolve the outer promise with the product data
                    })
                    .catch(error => {
                        gbb.utility.debugConsole("fail", error);
                        res(false);
                        // rej(error); // reject the outer promise with the error
                    });
            });
        },
        renderTemporaryLoadingSpinner: function (loaderState) {

            // gbb.$(".gbbPageBody").append(gbb.$("<div>").addClass("gbbEmptyDivWithMaxHeight"));

            //loaderState = "show" => show loader
            //loaderState = "hide" => hide loader
            //loaderState = (empty params) => toggle loader with a timeout 700ms.
            //check switch case for more render details
            if (!loaderState) {
                loaderState = "autoToggle"
            }

            let defaultLoadingGif = "https://gift-box-builder-app4.s3.us-east-2.amazonaws.com/storefront/loading-gif.gif";

            // "https://c.tenor.com/n4w0VzWFbtgAAAAC/loading.gif"

            let loadingGif = gbb.settings.merchantInfo?.customSettings?.loadingGif || "";

            if (loadingGif) {
                defaultLoadingGif = loadingGif;
            }

            let loadingScreenDiv = gbb.$("<div>").addClass("gbbLoadingScreen").css("background", gbb?.settings?.app?.loadingBgColor);
            // let loadingScreenDiv =  gbb.$("<img>").addClass("gbbLoadingScreenSpinner").attr("src",defaultLoadingGif );
            // let loadingScreenSpinner = gbb.$("<div>").addClass("gbbLoadingScreenSpinner");

            // let loadingSpinnerGIF = gbb.$("<img>").attr("src", gbb.utility.getAssetUrl("loading.gif"));
            let loadingSpinnerGIF = gbb.$("<img>").addClass("gbbLoadingSpinnerGIF").attr("src", defaultLoadingGif);




            // loadingScreenDiv.append(loadingScreenSpinner);
            loadingScreenDiv.append(loadingSpinnerGIF);
            // loadingScreenDiv.append(loadingSkeleon);
            switch (loaderState) {
                case "show":
                    if (gbb.$(".gbbLoadingScreen").length < 1) {
                        gbb.$(".gbbPageBody").append(loadingScreenDiv);
                        gbb.$("body").addClass("gbbHideScrollBar");
                    }
                    break;
                case "hide":
                    if (gbb.$(".gbbLoadingScreen").length > 0) {
                        setTimeout(function () {
                            gbb.$(".gbbLoadingScreen").remove();
                            gbb.$("body").removeClass("gbbHideScrollBar");
                        }, 500)


                    }
                    break;
                case "autoToggle":
                    if (gbb.$(".gbbLoadingScreen").length > 0) {
                        return
                    }
                    else {
                        gbb.$(".gbbPageBody").append(loadingScreenDiv);
                    }
                    setTimeout(function () {
                        gbb.$(".gbbLoadingScreen").remove();
                    }, 700)
                    break;
                    return;
            }
        },
        getProductsBulk: async function (listOfHandles) {
            try {
                // fire an api call for each product and store it corresponding to its handle/title
                let promises = []
                for (let i = 0; i < listOfHandles.length; i++) {
                    promises.push(gbb.utility.getProductDataV2(listOfHandles[i]))
                }
                let data = await Promise.all(promises)
                //return the data but in for of array of object which title as key

                let result = {}
                for (let i = 0; i < data.length; i++) {
                    result[data[i].handle] = data[i]
                }
                return result;
            } catch (error) {
                gbb.utility.debugError("gbb-utility-getProductsBulk");
                gbb.utility.debugError(error);
                return false
            }
        },
        getProductsBulkForRelevantVariants: async function (listOfHandles, productsData, options) {
            try {
                // fire an api call for each product and store it corresponding to its handle/title



                let promises = [], idsOfVariants = [];
                for (let i = 0; i < productsData.length; i++) {
                    idsOfVariants?.push(productsData[i]?.variants?.map(variant => variant.variantId))
                }

                idsOfVariants = idsOfVariants?.flat()

                let data;

                if (gbb.settings.app.enableStoreFrontGQLAPI) {
                    data = await gbb.graphQlUtility.getProductsDataByIds(options.listOfProductIds)
                    // promises.push(await gbb.graphQlUtility.getProductsDataByIds(options.listOfProductIds))
                } else {

                    for (let i = 0; i < listOfHandles.length; i++) {

                        // TODO: SF API Check
                        // if(storeFrontapi token pres)
                        // 
                        // {
                        // if ( false && options && options.listOfProductIds){

                        promises.push(gbb.utility.getProductDataV2(listOfHandles[i]))


                        // }

                    }
                    data = await Promise.all(promises)
                }


                //remove the data element which are false
                data = data.filter(element => element)

                //return the data but in for of array of object which title as key
                let result = {}
                for (let i = 0; i < data.length; i++) {
                    //getproductdata based on data[i].id
                    let productdata = productsData.find((item) => item.productId == data[i].id)
                    data[i] = gbb.utility.getProductData_AfterRemovingUnavailableVariantsAndOptions(data[i]);

                    let hasTheUserSelectedOnlyOneVariant = productdata?.variants?.length == 1 ? true : false;
                    if (hasTheUserSelectedOnlyOneVariant) {
                        data[i].renderChooseOptionsButton_forcefully = false;
                    }




                    if (productdata && productdata.variants) {
                        let variants = data[i].variants?.filter(variant => idsOfVariants.includes(String(variant.id)));
                        data[i].variants = variants;


                        if (data[i].variants.length < 1) {
                            continue;
                        }

                        data[i].price = data[i].variants[0]?.price || data[i].price
                        data[i].compare_at_price = data[i].variants[0]?.compare_at_price || data[i].compare_at_price



                        if (gbb.settings.bundleSettings.removeUnUsedVariantImages) {
                            data[i] = gbb.utility.removeUnUsedVariantImages(data[i])
                        }

                        result[data[i].handle] = {
                            ...data[i],
                            variants,
                            requiredQuantity: productdata?.requiredQuantity ? productdata?.requiredQuantity : null //used in case of default products only
                        };
                    } else {
                        let variants = data[i].variants
                        data[i].variants = variants;
                        if (gbb.settings.bundleSettings.removeUnUsedVariantImages) {
                            data[i] = gbb.utility.removeUnUsedVariantImages(data[i])
                        }


                        result[data[i].handle] = {
                            ...data[i],
                            variants,
                            requiredQuantity: productdata?.requiredQuantity ? productdata?.requiredQuantity : null
                        }

                    }

                }
                return result;
            } catch (error) {
                gbb.utility.debugError("gbb-utility-getProductsBulkForRelevantVariants");
                gbb.utility.debugError(error);
                return false
            }
        },
        getProductsFromCollections: function (data) {
            try {
                let resObj = []
                for (let i = 0; i < data.length; i++) {
                    let collection = data[i]
                    if (collection && collection.productList.length > 0) {
                        resObj.push(...collection.productList)
                    }

                }
                return resObj
            } catch (error) {
                gbb.utility.debugError("gbb-utility-getProductsFromCollections");
                gbb.utility.debugError(error);
                return false
            }
        },
        removeFromCartBulk: async function (variantIdList, noteAttribute) {
            try {

                // run a for loop to create promises to remove
                // items from the cart in bulk
                for (let i = 0; i < variantIdList.length; i++) {
                    let variant = { id: variantIdList[i] }
                    await gbb.utility.removeFromCart({ variant }, noteAttribute);
                }
                // wait for all promises to resolve
                return true;
            }
            catch (error) {
                gbb.utility.debugError("gbb-utility-removeFromCartBulk");
                gbb.utility.debugError(error);
                return false
            }
        },
        addToCartV2: function (data) {
            try {
                return new Promise((res, rej) => {
                    gbb.$.post('/cart/add.js', data)
                        .done(function () { gbb.utility.debugConsole("success-/cart/add.js': "); res(true) })
                        .fail(function () { gbb.utility.debugConsole("fail-/cart/add.js"); res(false) })
                })
                return result;
            } catch (error) {
                gbb.utility.debugError("gbb-utility-addToCartV2");
                gbb.utility.debugError(error);
                return false
            }
        },
        clearCart: function (data) {
            try {
                return new Promise((res, rej) => {
                    gbb.$.post('/cart/clear.js', data)
                        .done(function () { gbb.utility.debugConsole("success-/cart/clear.js': "); res(true) })
                        .fail(function () { gbb.utility.debugConsole("fail-/cart/clear.js"); res(false) })
                })
                return result;
            } catch (error) {
                gbb.utility.debugError("gbb-utility-clearCart");
                gbb.utility.debugError(error);
                return false
            }
        },
        getCart: async function (data) {
            try {
                const subscriptionPlanExists = gbb.gbbReviewPage.f.checkIfSubscriptionPlanExists();
                if (subscriptionPlanExists && gbb.gbbBrowser?.getSubscriptionType() == "saveSubscription") {
                    return gbb.gbbBrowser.getCartDataForSubscription();
                }
                return gbb.gbbBrowser.getCartDataFromSessionStorage();
                let result = await gbb.$.ajax({
                    type: "GET",
                    url: "/cart.js",
                    dataType: "json",
                });
                return result
            } catch (error) {
                gbb.utility.debugError("gbb-utility-getCart");
                gbb.utility.debugError(error);
                return false
            }
        },

        getGiftBoxProductsFromCart: async function (data) {
            try {
                let data = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(gbb.state.activeBoxId); //change it to -> getRelevantBoxDataFromSessionStorage
                gbb.state.giftBoxCartData = data
                gbb.gbbDiscountComponent.f.updateCurrentDiscountRule();
                return data

            } catch (error) {
                gbb.utility.debugError("gbb-utility-getCart");
                gbb.utility.debugError(error);
                return false
            }
        },
        getGiftBoxProductsTotalWithCurrency: function (data) {
            try {
                //getGiftBoxProductsFromCart
                // gbb.state.giftBoxCartData = await gbb.utility.getGiftBoxProductsFromCart()
                data = gbb.state.giftBoxCartData
                // if(data.currency){
                // return gbb.utility.getCurrencySymbol() + "" + parseFloat(data.total_price / 100).toFixed(2)
                return gbb.utility.formatPrice(data.total_price)
                // }else{
                // if(Shopify && Shopify.currency && Shopify.currency.active){
                //     return "0.0"+ " " +Shopify.currency.active
                // }else{
                //     return "0.0"
                // }

                // }
            } catch (error) {
                gbb.utility.debugError("gbb-utility-getCart");
                gbb.utility.debugError(error);
                return "0.0"
            }
        },
        getGiftBoxProductsDiscountedTotal: function (boxId) {
            try {
                if (!boxId) {
                    boxId = gbb.state.activeBoxId || "box1";
                }
                let allDiscountsData = gbb.utility.calculateCartDiscount();
                let currentBoxDiscountData = allDiscountsData?.discountsPerBox[boxId];

                if (!currentBoxDiscountData) {
                    return "0.0";
                }

                let discountedTotal = currentBoxDiscountData.boxTotalAmount + currentBoxDiscountData.blackListedItemsTotalPrice || 0;
                discountedTotal = discountedTotal / currentBoxDiscountData.boxQuantity;
                //    let discountedTotal =
                //    return parseInt(discountedTotal / 100);
                //@ashfaq
                return parseFloat(discountedTotal / 100);
            } catch (error) {
                gbb.utility.debugError("gbb-utility-getCart");
                gbb.utility.debugError(error);
                return "0.0"
            }
        },
        getGiftBoxProductsTotalWithCurrency_multipliedByBundleQuantity: function (data) {
            try {
                data = gbb.gbbBrowser.getCartDataFromSessionStorage()
                // data.bundleQuantity = data.bundleQuantity || 1
                return gbb.utility.getCurrencySymbol() + "" + parseFloat(data.total_price * data.bundleQuantity / 100).toFixed(2)
            } catch (error) {
                gbb.utility.debugError("gbb-utility-getCart");
                gbb.utility.debugError(error);
                return "0.0"
            }
        },
        convertArrayToObject: function (array, key) {
            try {
                let obj = {};
                for (let i = 0; i < array.length; i++) {
                    obj[array[i][key]] = array[i];
                }
                return obj;
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        convertArrayToObjectWithArrays: function (array, key) {
            try {
                let obj = {};
                for (let i = 0; i < array.length; i++) {
                    if (!obj[array[i][key]]) {
                        obj[array[i][key]] = [];
                    }
                    obj[array[i][key]].push(array[i]);
                }
                return obj;
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        getCartTotalQuantity: async function () {
            try {
                let total = 0
                let cartData = await gbb.$.ajax({
                    type: "GET",
                    url: "/cart.js",
                    dataType: "json",
                });
                for (var item of cartData['items']) {
                    total += item["quantity"]
                }
                return total
            } catch (error) {
                gbb.utility.debugError("gbb-utility-getCart");
                gbb.utility.debugError(error);
                return false
            }
        },
        getProductQuantityFromCart: async function ({ variant, parent }) {
            let item = gbb.utility.checkIfItemPresentInGiftBoxCart(variant.id);
            if (!item) {
                return gbb.gbbAddProductsPage.state.incrementProductQtyBy;
            } else {
                return item.quantity;
            }
        },
        checkIfItemPresentInCart: function (searchedVariantId) {
            if (gbb.state.cartData && gbb.state.cartData.items && gbb.state.cartData.items.length && gbb.state.cartData.items.length > 0) {
                for (let i = 0; i < gbb.state.cartData.items.length; i++) {
                    let item = gbb.state.cartData.items[i]
                    if (item && item.variant_id && item.variant_id == searchedVariantId) {
                        return item
                    }
                }
                return false
            } else {
                return false
            }
        },
        checkIfItemPresentInGiftBoxCart: function (searchedVariantId, options) {

            const boxProductValuesInPersonalizationPage = ["giftWrap", "giftMessage", "greetingCard","addonProduct"];

            let uniqueItemKey
            if (options) {
                uniqueItemKey = options.uniqueItemKey
            }

            if (gbb.state.giftBoxCartData && gbb.state.giftBoxCartData.items && gbb.state.giftBoxCartData.items.length && gbb.state.giftBoxCartData.items.length > 0) {

                if (uniqueItemKey) {
                    for (let i = 0; i < gbb.state.giftBoxCartData.items.length; i++) {
                        let item = gbb.state.giftBoxCartData.items[i]
                        if (item && item.properties && item.properties["_uniqueGbbItemKey"] && item.properties["_uniqueGbbItemKey"] == uniqueItemKey) {
                            return item
                        }
                    }

                }

                for (let i = 0; i < gbb.state.giftBoxCartData.items.length; i++) {
                    let item = gbb.state.giftBoxCartData.items[i]
                    let findingByVariantId = item && item.variant_id && item.variant_id == searchedVariantId;
                    let findingByLineItemKey = item && item.key && item.key.includes(searchedVariantId);
                    let isProductAddedFromThisPage = item.properties["_boxProduct"] == gbb.state.currentPageId;

                    let isProductFromThisCategory;
                    if (item.properties["_Category"]) {
                        // isProductFromThisCategory
                        isProductFromThisCategory = item.properties["_Category"] == gbb.gbbMultipleCategoriesPage.state.currentCategoryId;
                        if (isProductFromThisCategory) {
                            isProductAddedFromThisPage = true;
                        } else {
                            isProductAddedFromThisPage = false
                        }
                    }

                    // if boxProduct is giftWrap/giftmessage and "greetingCard" then check if gbb.state.currentPageId personalizationPage

                    if (gbb.state.currentPageId == "personalizationPage") {
                        // Check if the _boxProduct is one of the boxProductValuesInPersonalizationPage
                        if (boxProductValuesInPersonalizationPage.includes(item.properties["_boxProduct"])) {
                            isProductAddedFromThisPage = true;
                        }
                    }


                    if (isProductAddedFromThisPage) {
                        if (findingByVariantId || findingByLineItemKey) {
                            return item
                        }
                    }
                }
                return false
            } else {
                return false
            }
        },
        getUniqueIdForVariant: function ({ productData, variantId, attributes }) {
            try {

                let uniqueId
                if (!variantId) {
                    variantId = String(productData.variant_id);
                }

                uniqueId = variantId;


                if (attributes && Object.keys(attributes)) {
                    // uniqueId = concat attributes._Category
                    attributes.pageId = attributes[variantId];
                    if (attributes.pageId) {
                        uniqueId = uniqueId + "_" + "pageId:" + attributes.pageId;
                    }

                    if (attributes.category) {
                        uniqueId = uniqueId + "_" + "categoryId:" + attributes.category;
                    }

                } else if (productData && productData.properties) {
                    if (productData.properties["_boxProduct"]) {
                        uniqueId = uniqueId + "_" + "pageId:" + productData.properties["_boxProduct"];
                    }

                    if (productData.properties["_Category"]) {
                        uniqueId = uniqueId + "_" + "categoryId:" + productData.properties["_Category"];
                    }
                } else {
                    if (gbb.state.currentPageId) {
                        uniqueId = uniqueId + "_" + "pageId:" + gbb.state.currentPageId;
                    }

                    if (gbb.gbbMultipleCategoriesPage.state.currentCategoryId) {
                        uniqueId = uniqueId + "_" + "categoryId:" + gbb.gbbMultipleCategoriesPage.state.currentCategoryId;
                    }
                }

                return uniqueId;

                // _properties["_uniqueGbbItemKey"] + "_" + data?.attributes.category;

            } catch (e) {
                gbb.utility.debugConsole(e);
            }
        },
        checkIfProductPresentInCart: function (searchedProductId) {
            if (gbb.state.cartData && gbb.state.cartData.items && gbb.state.cartData.items.length && gbb.state.cartData.items.length > 0) {
                for (let i = 0; i < gbb.state.cartData.items.length; i++) {
                    // gbb.utility.debugConsole("cjeckIfProductPresentInCart: ", gbb.state.cartData.items[i])
                    let item = gbb.state.cartData.items[i]
                    if (item && item.id && item.id == searchedProductId) {
                        return item
                    }
                }

                return false
            } else {
                return false
            }
        },
        checkIfGiftOptionsInCart: async function () {
            let isGiftWrapPresent = false, isGreetingPresent = false, isGiftNotePresent = false, iseDeliveryPresent = false, isGiftAddonPresent = false


            let giftWrapVariants = [], greetingCardVariants = [], giftAddonVariants = []
            if (gbb.settings && gbb.settings.giftwrap && gbb.settings.giftwrap.isGiftWrapEnabled && gbb.settings.giftwrap.productVariants) {
                gbb.settings.giftwrap.productVariants?.forEach(item => giftWrapVariants.push(item.id))
            }

            if (gbb.settings && gbb.settings.greetingCard && gbb.settings.greetingCard.isGreetingCardEnabled && gbb.settings.greetingCard.productVariants) {
                gbb.settings.greetingCard.productVariants.forEach(item => greetingCardVariants.push(item.id))
            }

            if (gbb.settings && gbb.settings.giftAddons && gbb.settings.giftAddons.isGiftAddonsEnabled && gbb.settings.giftAddons.addOnProducts && gbb.settings.giftAddons.addOnProducts.length && gbb.settings.giftAddons.addOnProducts.length > 0) {
                for (let i = 0; i < gbb.settings.giftAddons.addOnProducts.length; i++) {
                    let addOnProduct = gbb.settings.giftAddons.addOnProducts[i]
                    addOnProduct.variants?.forEach(item => giftAddonVariants.push(parseInt(item.variantId)))
                }
            }

            if (gbb.state.cartData && gbb.state.cartData.attributes) {
                if (gbb.state.cartData.attributes.gbbGiftMessage) {
                    return true
                }

                if (gbb.state.cartData.attributes.gbbScheduleDelivery) {
                    return true
                }
            }

            if (gbb.state.cartData && gbb.state.cartData.items && gbb.state.cartData.items.length && gbb.state.cartData.items.length > 0) {
                for (let i = 0; i < gbb.state.cartData.items.length; i++) {
                    let item = gbb.state.cartData.items[i]
                    if (item && item.variant_id && item.variant_id) {

                        if (giftWrapVariants.includes(item.variant_id)) {
                            isGiftWrapPresent = true
                        }
                        if (greetingCardVariants.includes(item.variant_id)) {
                            isGreetingPresent = true
                        }
                        if (giftAddonVariants.includes(item.variant_id)) {
                            isGiftAddonPresent = true
                        }
                    }
                }

                if (isGiftWrapPresent || isGreetingPresent || isGiftNotePresent || iseDeliveryPresent || isGiftAddonPresent) {
                    return true
                } else {
                    return false
                }

            } else {
                return false
            }



        },
        convertObjectToArray: function (obj) {
            let arr = []
            for (let key in obj) {
                arr.push(obj[key])
            }
            return arr
        },
        getNoteFromCart: function () {

            if (gbb && gbb.state && gbb.state.giftBoxCartData) {
                // return
                const messageProduct = gbb.state.giftBoxCartData.items.find(item => item.id == gbb.settings.shopifyData?.giftMessageData?.variants[0]?.id);
                if (messageProduct) {
                    return messageProduct.properties["Message"]
                }
            }

        },
        getAttributValueFromMessageItem: function (attributeName) {
            if (gbb && gbb.state && gbb.state.giftBoxCartData && gbb.settings.shopifyData?.giftMessageData && gbb.settings.shopifyData?.giftMessageData?.variants && gbb.settings.shopifyData?.giftMessageData?.variants[0]?.id) {
                // return
                const messageProduct = gbb.state.giftBoxCartData.items.find(item => item.id == gbb.settings.shopifyData?.giftMessageData?.variants[0]?.id);
                if (messageProduct) {
                    return messageProduct.properties[attributeName]
                }
            } else {
                return null
            }
        },
        isCartTotalMoreThan: async function (value) {
            gbb.state.cartData = await gbb.utility.getCart()

            if (gbb.state.cartData && gbb.state.cartData.total_price && ((gbb.state.cartData.total_price) / 100 >= parseFloat(value))) {
                gbb.utility.debugConsole("isCartTotalMoreThan: ", gbb.state.cartData.total_price)
                return true
            } else {
                return false
            }
        },
        isCartEmpty: function () {
            if (gbb.state.cartData && gbb.state.cartData.items.length <= 0) {
                return true;

            } else {
                return false
            }
        },
        setMapForVariantId: function (productsObj, extraInfo) {
            try {
                let data = gbb.utility.productDetailsWith_VariantId_Or_ProductIdAsKey(productsObj, extraInfo)
                gbb.state.currentProductsDataSetForVariants = { ...gbb.state.currentProductsDataSetForVariants, ...data };
            }
            catch (e) {
                gbb.utility.debugError("setMapForVariantId", e)
            }

        },

        cloneAddToCartBtn: function () {
        },
        overWriteBuyNowBtn: function () {

            let buyNowBtnEle = gbb.$(document).find(gbb.selectors.buyNowBtn)

            if (buyNowBtnEle && buyNowBtnEle.length > 0 && gbb.$(document).find(".gbb-overwrite-buy-now-btn").length == 0) {
                buyNowBtnEle.show()
                buyNowBtnEle.unbind().unbind("click").off().off("click");
                newBuyNowBtnEle = buyNowBtnEle.clone()
                buyNowBtnEle.after(newBuyNowBtnEle)
                buyNowBtnEle.hide()
                newBuyNowBtnEle.addClass("gbb-overwrite-buy-now-btn")


                newBuyNowBtnEle.on("click", function (event) {
                    event.preventDefault();
                    event.stopPropagation();
                    gbb.$(this).attr("disabled", true);
                    newBuyNowBtnEle.text("loading checkout...");
                    setTimeout(() => { gbb.$(this).attr("disabled", false) }, 3000)
                    addToCartBtnEle = gbb.$(document).find(gbb.selectors.addToCart)
                    sideCartEle = gbb.$(document).find(gbb.selectors.sideCartSelectors)

                    // gbb.$(document).find("body").addClass("loadingCheckoutPage")
                    // gbb.$(document).find("body").text("loading checkout...")

                    if (sideCartEle && sideCartEle.length > 0) {
                        sideCartEle.css("display", "none")
                    }

                    if (addToCartBtnEle && addToCartBtnEle.length > 0) {
                        addToCartBtnEle.trigger("click")
                    }
                    setTimeout(() => {
                        window.location.href = window.location.origin + "/cart/checkout"
                    }, 1000)

                })

            }
        },
        overWriteCheckoutBtn: function () {

            let checkoutBtnEle = gbb.$(document).find(gbb.selectors.checkoutBtnEle)
            if (checkoutBtnEle && checkoutBtnEle.length > 0 && gbb.$(document).find(".gbb-overwrite-checkout-btn").length == 0) {
                checkoutBtnEle.show()
                checkoutBtnEle.unbind().unbind("click").off().off("click");
                let newcheckoutBtnEle = checkoutBtnEle.clone()
                checkoutBtnEle.after(newcheckoutBtnEle)
                checkoutBtnEle.hide()
                newcheckoutBtnEle.addClass("gbb-overwrite-buy-now-btn")


                newcheckoutBtnEle.on("click", function (event) {
                    event.preventDefault();
                    event.stopPropagation();
                    gbb.$(this).attr("disabled", true);
                    newcheckoutBtnEle.text("loading checkout...");
                    setTimeout(() => { gbb.$(this).attr("disabled", false) }, 3000)
                    addToCartBtnEle = gbb.$(document).find(gbb.selectors.addToCart)
                    sideCartEle = gbb.$(document).find(gbb.selectors.sideCartSelectors)

                    // gbb.$(document).find("body").addClass("loadingCheckoutPage")
                    // gbb.$(document).find("body").text("loading checkout...")

                    if (sideCartEle && sideCartEle.length > 0) {
                        sideCartEle.css("display", "none")
                    }

                    if (addToCartBtnEle && addToCartBtnEle.length > 0) {
                        addToCartBtnEle.trigger("click")
                    }
                    setTimeout(() => {
                        let properties = gbbExt.state.cartData.properties;
                        window.location.href = window.location.origin + "/cart/checkout"
                    }, 1000)

                })

            }
        },
        emailValidation: function (emailString) {
            var atSymbol = emailString.indexOf("@");
            if (atSymbol < 1) return false;

            var dot = emailString.lastIndexOf(".");
            if (dot <= atSymbol + 2) return false;

            // check that the dot is not at the end
            if (dot === emailString.length - 1) return false;

            return true;
        },
        renderLanguageValue: function (parent) {
            if (parent) {
                return parent.value;
            }
            return;
        },
        slider: {
            state: {
                slideIndex: 1,
            },
            plusSlides: function (selector, n) {
                this.showSlides(selector, this.state.slideIndex += n);
            },
            //minusSlides
            minusSlides: function (selector, n) {
                this.showSlides(selector, this.state.slideIndex -= n);
            },
            showSlides: function (selector, n) {
                var i;
                var slides = selector.find(".gbbProductImageContainerImg"); //takes the entire container so has refernce to all the images inside that container
                if (slides && slides.length) {
                    //     slides = JSON.parse(slides);
                    // }


                    if (n > slides.length) { this.state.slideIndex = 1 }
                    if (n < 1) { this.state.slideIndex = slides.length }
                    for (i = 0; i < slides.length; i++) {
                        slides[i].style.display = "none";
                    }
                    slides[this.state.slideIndex - 1].style.display = "block";
                    //   plusSlides(1)
                }
                // setTimeout(function () { plusSlides(n + 1) }, 2000);
            },
        },
        getAllFilterTagsForProducts: (products, noteAttribute) => {
            let filterTags = []

            products.forEach((element) => {
                let productTags = element.tags ? element.tags : []
                productTags.forEach((tag) => {
                    if (!filterTags.includes(tag)) {
                        filterTags.push(tag);
                    }
                })
            })
            return filterTags;
        },
        getFiltersInAndCondition: ({ allFiltersValue, productTagsSet, product }) => {
            let isAndProductAdded = false;
            let productCollectionNames = product.collectionNames ? product.collectionNames : [];
            for (let i = 0; i < allFiltersValue.length; i++) {
                let filterValue = allFiltersValue[i];
                if (productTagsSet.has(filterValue) || productCollectionNames.includes(filterValue)) {
                    isAndProductAdded = true;
                } else {
                    isAndProductAdded = false;
                    break;
                }
            }
            return isAndProductAdded;
        },

        getFiltersInOrCondition: ({ filters, product, productTagsSet, productTagsString }) => {
            let isProductAdded = false;
            for (let i = 0; i < filters.length; i++) {
                let filter = filters[i];
                for (let j = 0; j < filter.rules.length; j++) {
                    let rule = filter.rules[j];
                    let isThisFilterForCollections = rule.type == "collectionTag" ? true : false;
                    if (isThisFilterForCollections) {
                        if (rule.operatorType == "isEqualTo" || rule.operatorType == "contains") {
                            let selectedCollectionName = rule.tagValue;
                            if (product.collectionNames && product.collectionNames.includes(selectedCollectionName)) {
                                isProductAdded = true;
                                break;
                            }
                        }
                    } else {
                        if (rule.operatorType == "isEqualTo") {
                            if (productTagsSet.has(rule.tagValue)) {
                                isProductAdded = true;
                                break;
                            }
                        } else if (rule.operatorType == "contains") {
                            if (productTagsString.includes(rule.tagValue)) {
                                isProductAdded = true;
                                break;
                            }
                        }
                    }
                }
                if (isProductAdded) {
                    break;
                }
            }
            return isProductAdded;
        },
        getFilteredSortedProductsData: async (noteAttribute, origin) => {
            let products = gbb.utility.getSortedProducts(noteAttribute);
            gbb.state.setInfiniteScrollTrackerForProducts = true;
            let filters = gbb.utility.getActivatedFilters(noteAttribute);
            let filteredProducts = [];
            let minValue = gbb.utility.getPriceFilterValues(noteAttribute).minValue;
            let maxValue = gbb.utility.getPriceFilterValues(noteAttribute).maxValue;
            let filtersInfo = gbb.utility.getFiltersInfo(noteAttribute);


            let filterBasedOnFilterIdOperator = filtersInfo?.filterRuleAcrossCategory;
            let result = [];
            let allFiltersValue = [];
            let totalProducts = [];
            // let uniqueFilterIds = [];
            let filterIdsMap = {};
            filters.forEach((filter) => {

                if (filterIdsMap[filter.filterId]) {
                    filterIdsMap[filter.filterId].push(filter);
                } else {
                    filterIdsMap[filter.filterId] = [filter];
                }


                filter.rules.forEach((rule) => {
                    if (true || rule.type === "productTag") {
                        allFiltersValue.push(rule.tagValue);
                    }
                });

            });
            let filterIdsKeys = Object.keys(filterIdsMap);
            let allEligibleFilters = [];
            let productsToBeFutherFiltered = null;
            filterIdsKeys.forEach((filterIdKey) => {
                productsToBeFutherFiltered = productsToBeFutherFiltered ? productsToBeFutherFiltered : products;
                let filters = filterIdsMap[filterIdKey];
                if (filterBasedOnFilterIdOperator == "OR") {
                    // if (filters.length > 0) {
                    //     allEligibleFilters.push(...filters)
                    // }
                    totalProducts = [...totalProducts, ...calculateProductsToBeFiltered({ allEligibleFilters: filters })];
                    // allEligibleFilters = [...allEligibleFilters,...filters]   
                } else if (filterBasedOnFilterIdOperator == "AND") {
                    allEligibleFilters = [...filters]
                    // when it is and, then we will have to call the calculateProductsToBeFiltered function with the same existing products again and again
                    // so we will have to store the products in a variable and then pass it to the function
                    // productsToBeFutherFiltered
                    productsToBeFutherFiltered = calculateProductsToBeFiltered({ allEligibleFilters, productsToBeFutherFiltered });
                }
            });

            if (filterBasedOnFilterIdOperator == "OR") {
                totalProducts = [...new Set(totalProducts)];
            } else {
                // totalProducts = [...calculateProductsToBeFiltered(allEligibleFilters)];
                // productsToBeFutherFiltered is not iteratable error

                totalProducts = productsToBeFutherFiltered?.length > 0 ? [...productsToBeFutherFiltered] : []
            }

            function calculateProductsToBeFiltered(options) {
                filteredProducts = [];


                if (filtersInfo?.filterRuleAcrossCategory == "OR") {
                    allFiltersValue = [];
                    let filterArr = options.allEligibleFilters;
                    filterArr.forEach((filter) =>
                        filter.rules.forEach((rule) => {
                            if (true || rule.type === "productTag") {
                                allFiltersValue.push(rule.tagValue);
                            }
                        })
                    );
                }

                if (filtersInfo?.filterRuleAcrossCategory == "AND") {
                    let filterArr = options.allEligibleFilters;
                    let productsToBeFutherFiltered = options.productsToBeFutherFiltered;
                    products = productsToBeFutherFiltered;
                    filters = filterArr;
                }



                if (filters.length == 0) {
                    filteredProducts = gbb.utility.getSortedProducts(noteAttribute);
                } else {
                    products.forEach((product) => {
                        let productTags = product.tags;
                        let productTagsSet = new Set(productTags);
                        let productTagsString = productTags.toString();
                        let filterConditionRule = filtersInfo?.filterRule ? filtersInfo.filterRule : "OR";

                        switch (filterConditionRule) {
                            case "AND":
                                let isProductToBeAddedForAnd = false;
                                isProductToBeAddedForAnd = gbb.utility.getFiltersInAndCondition({ allFiltersValue, productTagsSet, product });
                                if (isProductToBeAddedForAnd) {
                                    filteredProducts.push(product);
                                }
                                break;
                            case "OR":
                                let isProductToBeAdded = false;
                                isProductToBeAdded = gbb.utility.getFiltersInOrCondition({ filters, product, productTagsSet, productTagsString });
                                if (isProductToBeAdded) {
                                    filteredProducts.push(product);
                                }
                                break;

                            default:
                                break;
                        }
                    });
                }

                if (minValue && maxValue) {
                    filteredProducts.forEach((product) => {
                        let productPrice = gbb.utility.formatPriceWithoutSymbol(product.price);
                        productPrice = parseFloat(productPrice);
                        if (productPrice >= minValue && productPrice <= maxValue) {
                            result.push(product);
                        }
                    });
                    filteredProducts = result;
                }
                return filteredProducts;
            };

            if (filters.length == 0) {
                totalProducts = gbb.utility.getSortedProducts(noteAttribute);
            }

            // gbb.gbbAddProductsPage.f.renderProductsCardContainer(filteredProducts, noteAttribute);
            if (!origin || origin != 'searchProductsFlow') {
                let activeCategoryId = gbb.gbbMultipleCategoriesPage.state.currentCategoryId;
                await gbb.gbbAddProductsPage.f.renderProductsCardContainer(totalProducts, noteAttribute, "filtersFlow", activeCategoryId);
            }
            // return filteredProducts;
            return totalProducts;
        },

        OldgetFilteredSortedProductsData: (noteAttribute) => {
            let products = gbb.utility.getSortedProducts(noteAttribute);
            let filters = gbb.utility.getActivatedFilters(noteAttribute);
            let filteredProducts = [];
            let minValue = gbb.utility.getPriceFilterValues(noteAttribute).minValue;
            let maxValue = gbb.utility.getPriceFilterValues(noteAttribute).maxValue;
            let result = [];
            let allFiltersValue = [];
            filters.forEach((filter) => {
                filter.rules.forEach((rule) => {
                    if (true || rule.type === "productTag") {
                        allFiltersValue.push(rule.tagValue);
                    }
                });
            });
            if (filters.length == 0) {
                filteredProducts = products;
            } else {
                products.forEach((product) => {
                    let productTags = product.tags;
                    let productTagsSet = new Set(productTags);
                    let productTagsString = productTags.toString();


                    // now check that product.tags[] contains all the values in allFiltersValue
                    let isAndProductAdded = false;
                    for (let i = 0; i < allFiltersValue.length; i++) {
                        let filterValue = allFiltersValue[i];
                        if (productTagsSet.has(filterValue)) {
                            isAndProductAdded = true;
                        } else {
                            isAndProductAdded = false;
                            break;
                        }
                    }

                    if (isAndProductAdded) {
                        filteredProducts.push(product);
                    }

                    //below part in another function

                    for (i = 0; i < filters.length; i++) {
                        let filter = filters[i];
                        filter
                        let isProductAdded = false;
                        for (let j = 0; j < filter.rules.length; j++) {
                            let rule = filter.rules[j];
                            let isThisFilterForCollections = rule.type == "collectionTag" ? true : false;
                            if (isThisFilterForCollections) {
                                if (rule.operatorType == "isEqualTo" || rule.operatorType == "contains") {
                                    // if product.collectionName == rule.tagValue
                                    let selectedCollectionName = rule.tagValue;
                                    if (product.collectionNames && product.collectionNames.includes(selectedCollectionName)) {
                                        filteredProducts.push(product);
                                        isProductAdded = true;
                                        break;
                                    }
                                    // if(product.collectionIds && product.collectionIds.includes(rule.tagValue)){
                                    //     filteredProducts.push(product);
                                    //     isProductAdded = true;
                                    //     break;
                                    // }
                                }
                            } else if (!isThisFilterForCollections) {
                                if (rule.operatorType == "isEqualTo") {
                                    if (productTagsSet.has(rule.tagValue)) {
                                        filteredProducts.push(product);
                                        isProductAdded = true;
                                        break;
                                    }
                                } else if (rule.operatorType == "contains") {
                                    if (productTagsString.includes(rule.tagValue)) {
                                        filteredProducts.push(product);
                                        isProductAdded = true;
                                        break;
                                    }
                                }
                            }
                        }
                        if (isProductAdded) {
                            break;
                        }

                    }
                })
            }
            if (minValue && maxValue) {
                filteredProducts?.forEach((product) => {
                    let productPrice = gbb.utility.formatPriceWithoutSymbol(product.price)
                    productPrice = parseFloat(productPrice);
                    if (productPrice >= minValue && productPrice <= maxValue) {
                        result.push(product);
                    }
                })
                filteredProducts = result;
            }
            //let filterAndSortedData = apply filter on sorteduniqueProductsData
            //RenderProductCartcontainer(filterAndSortedData)
            gbb.gbbAddProductsPage.f.renderProductsCardContainer(filteredProducts, noteAttribute)
            return filteredProducts;
        },
        clearAllFilters: (noteAttribute) => {
            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            if (addProductsPageArr.includes(noteAttribute)) {
                gbb.state.addProductsFilters.isFiltersActive = false;
                gbb.state.addProductsFilters.activatedFilters = [];
            }
        },

        checkIfSelectedVariantCombinationIsAvailable: function (product, selectedVariantsCombination) {
            try{

            
            let availableVariant = [];
            let productVariants = product?.variants;

            // Helper function to check if all selected variants are in options
            function allSelectedVariantsAreInOptions(selectedVariants, options) {
                return selectedVariants.every(value => options.includes(value));
            }

            // Helper function to check if there are no extra options outside the selected variants
            function noExtraOptionsInVariantOptions(selectedVariants, options) {
                return options.every(option => selectedVariants.includes(option));
            }

            // Extract the selected values from the combination object
            const selectedValues = Object.values(selectedVariantsCombination);

            for (let index = 0; index < productVariants.length; index++) {
                let variantOptions = productVariants[index]['options'] ? productVariants[index]['options'] : [];

                // Check if both conditions are met
                let isAllselectedVariantsAreInOptions = allSelectedVariantsAreInOptions(selectedValues, variantOptions)
                let isNoExtraOptionsInVariantOptions = noExtraOptionsInVariantOptions(selectedValues, variantOptions); 
                if (selectedValues?.length <=0) { // for the first 
                    isNoExtraOptionsInVariantOptions = true
                }
                const isVariantPresent = 
                    isAllselectedVariantsAreInOptions &&
                    isNoExtraOptionsInVariantOptions

                if (isVariantPresent && productVariants[index]['available'] == true) {
                    availableVariant.push(productVariants[index]);
                    break;
                }
            }
            return availableVariant;
            }catch(e){
                gbb.utility.debugConsole("error in e",e)
            }
        },
        checkIfSelectedVariantCombinationIsAvailableV2: function (product, selectedVariantsCombination) {
            let isVariantPresent = false;
            let availableVariant = [];
            let productVariants = product?.variants; // [black/sage,sage/sage]- [sage/sage] -> [black/sage]
            for (let index = 0; index < productVariants.length; index++) {
                let variantOptions = productVariants[index]['options'] ? productVariants[index]['options'] : [];
                isVariantPresent = Object.keys(selectedVariantsCombination).every((element, index) => {
                    // sage -> 
                    return variantOptions.includes(selectedVariantsCombination[element]);
                })
                if (isVariantPresent && productVariants[index]['available'] == true) {
                    availableVariant.push(productVariants[index]);
                    break;
                }
            }
            return availableVariant;
        },
        removeFromCart: async function ({ variant, parent, qty = 0 }, noteAttribute, category) {


            let data = { updates: { [variant.id]: qty }, attributes: { [variant.id]: noteAttribute } }

            data.additionalInfo = { ...variant }


            if (category && category != "") {
                data.attributes.category = category
            }
            await gbb.utility.updateCartV2(data)
            gbb.state.giftBoxCartData = await gbb.utility.getGiftBoxProductsFromCart()
            gbb.gbbDiscountComponent.f.updateCurrentDiscountRule();

        },
        activateAddButton: function (buttonEle, data, noteAttribute, typeOfProduct, category) {
            let incrementProductQtyBy = gbb.gbbAddProductsPage.state.incrementProductQtyBy || 1;
            buttonEle.css("background", gbb.settings.pageCustomizationData.productCard.productCardButtonColor);
            buttonEle.css("color", gbb.settings.pageCustomizationData.productCard.productCardButtonTextColor);
            const isMultipleVariants = (typeOfProduct == "multipleVariants" ? true : false);

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                if (isMultipleVariants) {
                    buttonEle.text(gbb.utility.renderLanguageValue(gbb.settings.languageData.general.chooseOptionsButtonText) || "Choose Options1");
                }
                else {
                    buttonEle.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.addToBoxButtonText) || "Add To Box1");
                }
            } else if (noteAttribute == "reviewPage") {
                if (isMultipleVariants) {
                    buttonEle.text(gbb.utility.renderLanguageValue(gbb.settings.languageData.general.chooseOptionsButtonText) || "Choose Options1");
                }
                else {
                    buttonEle.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.addButtonText) || "Add1");
                }
            } else {
                if (isMultipleVariants) {
                    buttonEle.text(gbb.utility.renderLanguageValue(gbb.settings.languageData.general.chooseOptionsButtonText) || "Choose Options1");
                }
                else {
                    buttonEle.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.addToCartButtonText) || "Add To Cart1");
                }
            }
            //buttonEle.removeClass("gbbProductRemoveButton")
            buttonEle.off("click")
            buttonEle.on("click", async function (event) {
                // buttonEle.prop('disabled', true);
                // buttonEle.addClass("gbbDisabled");
                // setTimeout(function () {
                //     gbb.utility.debugConsole("after timeeout")
                //     buttonEle.prop('disabled', false);
                //     buttonEle.removeClass("gbbDisabled");
                // }, 500);
                gbb.utility.debugConsole("add button clicked")
                //activate quantity buttons
                //TODO
                if (!event) {
                    return
                }
                // window.event11 = event;
                buttonEle = gbb.$(event.currentTarget);
                if (typeOfProduct == "multipleVariants") {
                    gbb.f.showProductVariantsModal(data.productData, buttonEle, noteAttribute, category)
                    return;
                } else {
                    let options = {
                        productAmount: data?.variant?.price,
                        category: category,
                        productWeight: data?.variant?.weight,
                        productVariantData: data?.variant,
                        productQuantity: incrementProductQtyBy,
                    }
                    if (gbb.settings?.bundleSettings?.isValidateInventoryEnabled && !gbb.utility.allowATCBasedOnProductInventory(data?.variant?.id, incrementProductQtyBy)) {
                        gbb.f.renderConditionNotificationToast((gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.inventoryLimitReachedText) || "No More Stock1"))
                        return
                    }
                    let condition = await gbb.utility.checkStepConditions(noteAttribute, options);
                    if (condition.isConditionMet) {
                        if (!data.qty || data.qty == 0) {
                            data.qty = incrementProductQtyBy;
                        }
                        //TODO: migration addButtonLoadingText
                        // buttonEle.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.addButtonLoadingText) || "Adding...");
                        gbb.utility.activateQuantityButtons(buttonEle, data, noteAttribute, typeOfProduct, category);
                        try {
                            let _noteAttribute = data?.productData?.customProductAttribute || noteAttribute
                            await gbb.utility.addToCart(data, _noteAttribute, category);
                            await gbb.utility.getGiftBoxProductsFromCart();
                        } catch (e) {
                            gbb.utility.debugConsole("error generated is", e);
                        }



                        await gbb.gbbAddProductsPage.f.handleAutoNextStep();


                        gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
                        // gbb.gbbAddProductsPage.f.autoScrollSlotsBasedOnATC("addToCart")
                        gbb.utility.showAddedToCartText(buttonEle);
                        if (noteAttribute == "reviewPage") {
                            gbb.gbbReviewPage.init(gbb.settings, "SUMMARY_PAGE");
                        }
                    }
                }
            })
        },
        activateQuantityButtons: async function (buttonEle, data, noteAttribute, typeOfProduct, category) {
            let allowQuantityInput = gbb.settings?.bundleSettings?.allowQuantityInput || false;
            let incrementProductQtyBy = gbb.gbbAddProductsPage.state.incrementProductQtyBy || 1;
            let decrementProductQtyBy = gbb.gbbAddProductsPage.state.decrementProductQtyBy || 1;
            let gbbProductQuantityHTML = gbb.$("<div>").addClass("gbbProductQuantityHTML");
            if (gbb.$('.gbbProductsCardLayoutV2').length > 0) {
                gbbProductQuantityHTML.css("background", gbb.settings.pageCustomizationData?.productCard?.productCardQuantitySelectorBgColor)
            }
            // let gbbProductQuantityAddButton = gbb.$("<button>").addClass("gbbProductQuantityAddButton")
            let productCardPageCustomization = gbb.settings.pageCustomizationData?.productCard
            let buttonTextColor = productCardPageCustomization.productCardQuantitySelectorButtonTextColor || productCardPageCustomization.productCardButtonTextColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor
            let gbbProductQuantityAddButton = gbb.$("<div>").addClass("gbbProductQuantityAddButton")
                // .css("background", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                // .css("color", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
                .css("background", gbb.settings.pageCustomizationData?.productCard?.productCardButtonColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                .css("color", productCardPageCustomization.productCardButtonTextColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
            // let gbbProductQuantityRemoveButton = gbb.$("<button>").addClass("gbbProductQuantityRemoveButton")
            let gbbProductQuantityRemoveButton = gbb.$("<div>").addClass("gbbProductQuantityRemoveButton")
                // .css("background", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                // .css("color", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
                .css("background", gbb.settings.pageCustomizationData?.productCard?.productCardButtonColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                .css("color", productCardPageCustomization.productCardButtonTextColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
            let gbbProductQuantityLabel = gbb.$("<div>").addClass("gbbProductQuantityLabel");

            let gbbProductQuantityInput = gbb.$("<input>").addClass("gbbProductQuantityInput").attr("type", "number").attr("min", 0);

            let currentQuantity = await gbb.utility.getProductQuantityFromCart(data);

            gbbProductQuantityAddButton.append(gbb.$("<div>").addClass("gbbProductQuantityAddButtonWrapper").html("+"));
            gbbProductQuantityRemoveButton.append(gbb.$("<div>").addClass("gbbProductQuantityRemoveButtonWrapper").html("-"));
            gbbProductQuantityLabel.text(currentQuantity);
            gbbProductQuantityInput.val(currentQuantity);

            // add data attribute to gbbProductQuantityInputContainer of previous qty currentQty
            gbbProductQuantityInput.attr("data-previous-qty", currentQuantity);

            const gbbProductQuantityAddButtonFunction = async (event) => {
                let options = {
                    productAmount: data?.variant?.price,
                    category: category,
                    productWeight: data?.variant?.weight,
                    productVariantData: data?.variant,
                    productQuantity: incrementProductQtyBy
                }
                let product = data.productData;
                let formValidationForProduct = gbb.gbbProductFormStep.f.checkFormValidationForProduct(product);
                if (!formValidationForProduct) {
                    gbb.gbbProductFormStep.f.displayRequiredFieldMessage();
                    return;
                } else if (formValidationForProduct) {
                    gbb.utility.addPersonalizationDataToProductProperties();
                }
                if (gbb.settings?.bundleSettings?.isValidateInventoryEnabled && !gbb.utility.allowATCBasedOnProductInventory(data?.variant?.id, incrementProductQtyBy)) {
                    gbb.f.renderConditionNotificationToast((gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.inventoryLimitReachedText) || "No More Stock1"))
                    return
                }
                let condition = await gbb.utility.checkStepConditions(noteAttribute, options);
                // CHECK_INVENTORY
                if (condition.isConditionMet) {
                    currentQuantity += incrementProductQtyBy;
                    data.qty = currentQuantity
                    gbbProductQuantityHTML = gbb.$(event.currentTarget.parentElement)
                    gbbProductQuantityLabel = gbbProductQuantityHTML.find(".gbbProductQuantityLabel");
                    gbbProductQuantityLabel.text(currentQuantity);
                    gbbProductQuantityInput.val(currentQuantity);
                    gbbProductQuantityInput.attr("data-previous-qty", currentQuantity);
                    // gbb.utility.disableElement(gbbProductQuantityAddButton);
                    let _noteAttribute = product?.customProductAttribute || noteAttribute
                    await gbb.utility.addToCart(data, _noteAttribute, category);
                    await gbb.utility.getGiftBoxProductsFromCart()
                    // gbb.utility.disableElement(gbbProductQuantityAddButton,0);


                    await gbb.gbbAddProductsPage.f.handleAutoNextStep();

                    gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
                    // gbb.gbbAddProductsPage.f.autoScrollSlotsBasedOnATC("addToCart")
                    gbb.utility.showAddedToCartText(buttonEle);
                    if (noteAttribute == "reviewPage") {
                        gbb.gbbReviewPage.init(gbb.settings, "SUMMARY_PAGE");
                    }
                }
            }

            const gbbProductQuantitySubstractButtonFunction = async (event) => {

                if (!event) {
                    return
                } else {
                    // window.event1 = event;
                }
                gbbProductQuantityRemoveButton.prop('disabled', true);
                //add a disabled class
                gbbProductQuantityRemoveButton.addClass("gbbDisabled");

                if (currentQuantity <= 0 || currentQuantity <= decrementProductQtyBy) {
                    currentQuantity = 0
                } else {
                    currentQuantity -= decrementProductQtyBy;
                }

                data.qty = currentQuantity
                let _noteAttribute = data.productData.customProductAttribute || noteAttribute
                await gbb.utility.removeFromCart(data, _noteAttribute, category);
                gbbProductQuantityRemoveButton.prop('disabled', false);
                gbbProductQuantityRemoveButton.removeClass("gbbDisabled");
                // let addButtonEle = gbb.$("<button>").addClass("gbbProductAddButton");
                let addButtonEle = gbb.$("<div>").addClass("gbbProductAddButton");
                // window.gbbProductQuantityHTML = gbbProductQuantityHTML;
                gbbProductQuantityHTML = gbb.$(event.currentTarget.parentElement)
                if (currentQuantity <= 0) {
                    gbbProductQuantityHTML.replaceWith(addButtonEle);
                    gbbProductQuantityInput.val(0);
                    gbbProductQuantityInput.attr("data-previous-qty", currentQuantity);
                    gbb.utility.activateAddButton(addButtonEle, data, noteAttribute, typeOfProduct, category)
                } else {
                    gbbProductQuantityLabel = gbbProductQuantityHTML.find(".gbbProductQuantityLabel");
                    gbbProductQuantityLabel.text(currentQuantity);
                    gbbProductQuantityInput.val(currentQuantity);
                    gbbProductQuantityInput.attr("data-previous-qty", currentQuantity);
                }
                await gbb.utility.getGiftBoxProductsFromCart()
                gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
                // gbb.gbbAddProductsPage.f.autoScrollSlotsBasedOnATC("removeFromCart")

                if (noteAttribute == "reviewPage") {
                    gbb.gbbReviewPage.init(gbb.settings, "SUMMARY_PAGE");
                }
            }

            gbbProductQuantityAddButton.on("click", async (event) => {
                //get current quantity -> do +1 and update cart
                gbb.utility.debugConsole("add button clicked")
                gbbProductQuantityAddButtonFunction(event);
            })

            gbbProductQuantityInput.on("change", async (event) => {
                let previousValue = parseInt(gbbProductQuantityInput.attr("data-previous-qty"));
                let currentValue = parseInt(gbbProductQuantityInput.val());

                let differenceInValues = currentValue - previousValue;
                if (differenceInValues > 0) {
                    for (let i = 0; i < differenceInValues; i++) {
                        await gbbProductQuantityAddButtonFunction(event);
                    }
                } else if (differenceInValues < 0) {
                    for (let i = 0; i < Math.abs(differenceInValues); i++) {
                        await gbbProductQuantitySubstractButtonFunction(event);
                    }
                }

            })

            // gbbProductQuantityInput.on("input", async (event) => {
            //     let previousValue = parseInt(gbbProductQuantityInput.attr("data-previous-qty"));
            //     let currentValue = parseInt(gbbProductQuantityInput.val());

            //     let differenceInValues = currentValue - previousValue;
            //     if (differenceInValues > 0) {
            //         for (let i = 0; i < differenceInValues; i++) {
            //             await gbbProductQuantityAddButtonFunction(event);
            //         }
            //     } else if (differenceInValues < 0) {
            //         for (let i = 0; i < Math.abs(differenceInValues); i++) {
            //             await gbbProductQuantitySubstractButtonFunction(event);
            //         }
            //     }

            //     // Update the previous value to the current value

            // });


            gbbProductQuantityRemoveButton.on("click", async (event) => {
                //get current quantity ->  do -1 and update cart
                //if quantity becomes zero after previous step
                //activate add button
                await gbbProductQuantitySubstractButtonFunction(event);

                //disable button after on click for 500ms
                // let btnElements = {gbbProductQuantityRemoveButton, gbbProductQuantityLabel, gbbProductQuantityHTML};
                // let dataToBePassedToActivateAddButton = {data, noteAttribute, category, typeOfProduct};
                // gbb.utility.handleQuantityRemoveButton(btnElements, dataToBePassedToActivateAddButton);
            })


            gbbProductQuantityHTML.append(gbbProductQuantityRemoveButton)

            if (allowQuantityInput) {
                gbbProductQuantityHTML.append(gbbProductQuantityInput);
            } else {
                gbbProductQuantityHTML.append(gbbProductQuantityLabel);
            }

            gbbProductQuantityHTML.append(gbbProductQuantityAddButton);

            buttonEle.replaceWith(gbbProductQuantityHTML);
        },
        handleQuantityRemoveButton: async function (btnElements, dataToBePassedToActivateAddButton) {
            let { gbbProductQuantityRemoveButton, gbbProductQuantityLabel, gbbProductQuantityHTML } = btnElements;
            let { data, noteAttribute, category, typeOfProduct } = dataToBePassedToActivateAddButton;
            gbbProductQuantityRemoveButton.prop('disabled', true);
            //add a disabled class
            gbbProductQuantityRemoveButton.addClass("gbbDisabled");
            currentQuantity -= 1;
            data.qty = currentQuantity
            await gbb.utility.removeFromCart(data, noteAttribute);
            gbbProductQuantityRemoveButton.prop('disabled', false);
            gbbProductQuantityRemoveButton.removeClass("gbbDisabled");
            // let addButtonEle = gbb.$("<button>").addClass("gbbProductAddButton");
            let addButtonEle = gbb.$("<div>").addClass("gbbProductAddButton");
            if (currentQuantity <= 0) {
                gbbProductQuantityHTML.replaceWith(addButtonEle);
                gbb.utility.activateAddButton(addButtonEle, data, noteAttribute, typeOfProduct, category)
            } else {
                gbbProductQuantityLabel.text(currentQuantity);
            }
            await gbb.utility.getGiftBoxProductsFromCart()
            gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
            if (noteAttribute == "reviewPage") {
                gbb.gbbReviewPage.init(gbb.settings, "SUMMARY_PAGE");
            }
        },
        activateSoldOutButton: function (buttonEle, data, noteAttribute) {
            let { variant, parent } = data;
            buttonEle.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.soldOut) || "Sold Out")
            buttonEle.addClass("gbbProductSoldOutButton")
            buttonEle.off("click")
        },
        handleVariantSelection: function (warningElement, product, selectedVariantsCombination, productButtonElement, gbbProductAllImagesContainer, gbbProductImageContainer) {
            try {
                let availableVariant = gbb.utility.checkIfSelectedVariantCombinationIsAvailable(product, selectedVariantsCombination);
                const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()

                const modalRef = gbb.$(".gbbProductVariantModalContainer")
                if (availableVariant.length == 0) {
                    productButtonElement.addClass('gbbDisabled');
                    warningElement.css('display', 'block');

                    //select the image
                } else {
                    productButtonElement.removeClass('gbbDisabled');
                    warningElement.css('display', 'none');
                    modalRef.find(".gbbProductItemCompareAtPrice").text("");
                    if (availableVariant[0]?.compare_at_price && availableVariant[0]?.compare_at_price > availableVariant[0]?.price) {
                        modalRef.find(".gbbProductItemCompareAtPrice").text(gbb.utility.formatPrice(availableVariant[0]?.compare_at_price));
                    }
                    let productPrice = availableVariant[0]?.price
                    if (isPurchaseTypeSubscription) {
                        productPrice = gbb.gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId(availableVariant[0]?.id)
                    }
                    modalRef.find(".gbbProductItemPrice").text(gbb.utility.formatPrice(productPrice));
                    //if the image is not already selected
                    let mediaId;
                    if (availableVariant[0].featured_media && availableVariant[0].featured_media?.id) {
                        mediaId = availableVariant[0].featured_media.id;
                        //find the active class image and check it's media id
                        let activeImage = gbbProductAllImagesContainer.find(".gbbActiveImage");
                        let activeImageIndex = activeImage.attr("imageIndex");
                        let activeImageMediaId = activeImage.attr("mediaId");

                        //find the div of the new variant through mediaId and then assign it slide index
                        let changedVariantDiv = gbbProductAllImagesContainer.find(`[mediaId=${mediaId}]`);
                        // let changedVariantDivIndex = parseInt(changedVariantDiv.attr("imageIndex"))
                        let changedVariantDivIndex = parseInt(changedVariantDiv?.parent()?.index())
                        changedVariantDivIndex += 1;

                        if (activeImageMediaId != mediaId && gbb.utility.slider.state.slideIndex != changedVariantDivIndex) {

                            gbb.utility.slider.state.slideIndex = changedVariantDivIndex//current changes image index;
                            // gbb.utility.slider.state.slideIndex = activeImageIndex//current changes image index;
                            gbb.utility.slider.showSlides(gbbProductImageContainer, gbb.utility.slider.state.slideIndex)
                            // gbb.utility.slider.showSlides(gbbProductImageContainer, gbb.utility.slider.state.slideIndex)

                            gbb.f.removeActiveImageStyle(gbbProductAllImagesContainer.find(".gbbActiveImage"))
                            gbbProductAllImagesContainer.find(".gbbActiveImage").removeClass("gbbActiveImage")

                            gbb.f.applyActiveImageStyle(gbbProductAllImagesContainer.find(`[mediaId=${mediaId}]`))
                            gbbProductAllImagesContainer.find(`[mediaId=${mediaId}]`).addClass("gbbActiveImage")
                        }
                    }
                }
            } catch (error) {
                gbb.utility.debugConsole("Error in handleVariantSelection", error)
            }
        },
        addPersonalizationDataToProductProperties: function (product) {

            let formSubmissionObj = JSON.parse(JSON.stringify(gbb.gbbProductFormStep.state.formSubmissionData));
            let resultKeyValuePair = {};
            let formSubmissionObjKeys = Object.keys(formSubmissionObj);
            //iterate and just copy the values
            formSubmissionObjKeys.forEach((key) => {
                if (formSubmissionObj[key].value) {
                    resultKeyValuePair[key] = formSubmissionObj[key].value;
                }
            });
            let productPersonalizationMetaData = formSubmissionObj;
            gbb.state.variantCustomProperties = { ...gbb.state.variantCustomProperties, ...resultKeyValuePair, productPersonalizationMetaData };

        },
        addVariantProductToCart: async function (warningElement, product, selectedVariantsCombination, noteAttribute, buttonEle, category, quantity = 1) {
            let availableVariant = gbb.utility.checkIfSelectedVariantCombinationIsAvailable(product, selectedVariantsCombination);
            if (availableVariant.length == 0) {
                warningElement.css('display', 'block');
            } else {
                let data = {
                    productData: product,
                    variant: availableVariant[0]
                }
                warningElement.css('display', 'none');
                let productData = data.productData;
                let uniqueItemKey = gbb.utility.getUniqueIdForVariant({ productData, variantId: data?.variant?.id })
                const isItemInCart = gbb.utility.checkIfItemPresentInGiftBoxCart(data?.variant?.id, { uniqueItemKey });
                // if (isItemInCart && isItemInCart.quantity) {
                //     quantity += isItemInCart.quantity
                //     data.qty = quantity
                // } else {
                //     data.qty = quantity
                // }
                let options = {
                    productAmount: data?.variant?.price,
                    category: category,
                    productQuantity: quantity,
                    productWeight: data?.variant?.weight,
                    productVariantData: data?.variant

                }
                if (gbb.settings?.bundleSettings?.isValidateInventoryEnabled && !gbb.utility.allowATCBasedOnProductInventory(data?.variant?.id, quantity)) {
                    // gbb.utility.closeVariantsModal()
                    gbb.f.renderConditionNotificationToast((gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.inventoryLimitReachedText) || "No More Stock1"))
                    return
                }
                let condition = await gbb.utility.checkStepConditions(noteAttribute, options);
                let formValidationForProduct = gbb.gbbProductFormStep.f.checkFormValidationForProduct(product);
                if (!formValidationForProduct) {
                    gbb.gbbProductFormStep.f.displayRequiredFieldMessage();
                    return;
                } else if (formValidationForProduct) {
                    gbb.utility.addPersonalizationDataToProductProperties();
                }

                if (condition.isConditionMet) {
                    if (isItemInCart && isItemInCart.quantity) {
                        quantity += isItemInCart.quantity
                    }
                    data.qty = quantity;
                    let _noteAttribute = product?.customProductAttribute || noteAttribute
                    await gbb.utility.addToCart(data, _noteAttribute, category)
                    let newProductItemHTML = gbb.f.renderProductsHTML([product], noteAttribute, category);
                    // gbb.$(".gbbPageBody").find(`[productId='${product.id}']`).replaceWith(newProductItemHTML);
                    let productCardRef = gbb.$(".gbbProductsContainer").find(`[productId='${product.id}']`);

                    if (productCardRef.length > 1) {
                        productCardRef = gbb.$(".gbbProductsContainer").find(`[firstvariantid='${data.variant.id}']`);
                    }
                    productCardRef.replaceWith(newProductItemHTML);

                    // if (condition.isConditionMet) {
                    //     gbb.utility.debugConsole("condition is met")
                    //     console.log("conditions", condition.conditions);
                    //     debugger
                    //     let argOptions = {
                    //         // conditions : condition.conditions,
                    //         condition: condition
                    //         // categoryId: category,
                    //         // pageType,
                    //     };
                    // }

                    await gbb.gbbAddProductsPage.f.handleAutoNextStep();



                    //gbb.utility.activateQuantityButtons(buttonEle, data, noteAttribute, "multipleVariants", category)
                    //buttonEle.addClass("gbbProductRemoveButton")
                    gbb.utility.closeVariantsModal()
                    gbb.$(".gbbHTMLWrapper").removeClass('gbbDisabled');
                    gbb.utility.showAddedToCartText(buttonEle);
                    await gbb.utility.getGiftBoxProductsFromCart()
                    gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(noteAttribute, { flow: "updateFooterWithoutAppending" }));
                    if (noteAttribute == "reviewPage") {
                        gbb.gbbReviewPage.init(gbb.settings, "SUMMARY_PAGE");
                    }



                } else {
                    gbb.utility.closeVariantsModal()
                }
            }
        },
        activateAFilter: function () {
        },
        removeAFilter: function () {

        },
        getTheVariantProductPresentInCart: function (product) {
            let variantPresent;
            let productVariants = product.variants;
            for (let index = 0; index < productVariants.length; index++) {
                variantPresent = gbb.utility.checkIfItemPresentInGiftBoxCart(productVariants[index].id);
                if (variantPresent) {
                    return variantPresent;
                }
            }
            // product.variants.forEach((variant) => {
            //     variantPresent = gbb.utility.checkIfItemPresentInGiftBoxCart(variant.id);
            //     if(variantPresent) {
            //         return variantPresent;
            //     }
            // })
            return false;
        },
        showAddedToCartText: function (buttonEle) {
            // add a new element next to the buttonEle and show the text
            let addedToCartText = gbb.$("<div>").addClass("gbbAddedToCartText").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.addedText) || "Added")
            buttonEle.after(addedToCartText)
            setTimeout(function () {
                addedToCartText.remove();
            }, 2000)
        },
        getCurrentPageSelectedProducts: function (noteAttribute) {
            let products = [];

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                // products = gbb.state.currentFilteredProducts[keyAttribute];
                products = gbb.state.currentFilteredProducts;
            } else {
                products = [];
            }

            return products;
        },
        setProductsToOriginalState: function (noteAttribute) {
            let tempProductsArr = [];

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            let data;
            if (noteAttribute == "addProductsPage1") {
                data = gbb.settings.stepsConfigurationData.productsData1.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage2") {
                data = gbb.settings.stepsConfigurationData.productsData2.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage3") {
                data = gbb.settings.stepsConfigurationData.productsData3.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage4") {
                data = gbb.settings.stepsConfigurationData.productsData4.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage5") {
                data = gbb.settings.stepsConfigurationData.productsData5.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage6") {
                data = gbb.settings.stepsConfigurationData.productsData6.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage7") {
                data = gbb.settings.stepsConfigurationData.productsData7.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage8") {
                data = gbb.settings.stepsConfigurationData.productsData8.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage9") {
                data = gbb.settings.stepsConfigurationData.productsData9.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage10") {
                data = gbb.settings.stepsConfigurationData.productsData10.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage11") {
                data = gbb.settings.stepsConfigurationData.productsData11.uniqueProductsData;
            } else if (noteAttribute == "addProductsPage12") {
                data = gbb.settings.stepsConfigurationData.productsData12.uniqueProductsData;
            }
            if (data) {
                Object.keys(data).forEach((product) => {
                    tempProductsArr.push(data[product])
                });
            }
            gbb.state.currentFilteredProducts = tempProductsArr;
            return tempProductsArr;
        },
        getOriginalStateProducts: function (noteAttribute) {
            let tempProductsArr = [];

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                let data = gbb.settings.shopifyData[keyAttribute]
                if (data) {
                    Object.keys(data).forEach((product) => {
                        tempProductsArr.push(data[product])
                    });
                }
            }
            return tempProductsArr;
        },
        initializeFiltersInfo: function (productPageKey) {
            gbb.state.addProductsFilters.isFiltersEnabledByAdmin = gbb.settings.stepsConfigurationData[productPageKey].filterTypes?.isFiltersEnabled || false
            let categories = Object.values(gbb.settings.stepsConfigurationData[productPageKey].filterTypes?.categories || {});
            gbb.state.addProductsFilters.allFilters = categories || [];
            categories?.forEach((category) => {
                if (category.type == "price") {
                    gbb.state.addProductsFilters.minPriceValue = category.minValue;
                    gbb.state.addProductsFilters.maxPriceValue = category.maxValue;
                }
            })

        },
        getFiltersInfo: function (noteAttribute) {
            let filtersInfo = {
                isFiltersEnabled: false,
                categories: {},
                filterRule: "OR",
                filterRuleAcrossCategory: "OR"
            };


            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                filtersInfo.isFiltersEnabled = gbb.settings.stepsConfigurationData[keyAttribute]?.filterTypes?.isFiltersEnabled;
                filtersInfo.filterRule = gbb.settings.stepsConfigurationData[keyAttribute]?.filterTypes?.filterRule || "OR";
                filtersInfo.filterRuleAcrossCategory = gbb.settings.stepsConfigurationData[keyAttribute]?.filterTypes?.filterRuleAcrossCategory || filtersInfo.filterRule;
                filtersInfo.categories = gbb.state.addProductsFilters.allFilters;
            }

            return filtersInfo;
        },
        setPriceFilterValues: function (noteAttribute, minValue, maxValue) {


            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                gbb.state.addProductsFilters.minPriceValue = minValue;
                gbb.state.addProductsFilters.maxPriceValue = maxValue;
            }


            return;
        },
        getPriceFilterValues: function (noteAttribute) {
            let values = {};


            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                values.minValue = gbb.state.addProductsFilters.minPriceValue;
                values.maxValue = gbb.state.addProductsFilters.maxPriceValue;
            }
            return values;
        },
        toggleFiltersSideBar: function (noteAttribute) {


            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                gbb.state.addProductsFilters.isFiltersActive = !gbb.state.addProductsFilters.isFiltersActive
            }

            return;
        },
        getFiltersState: function (noteAttribute) {
            let isActive = false;

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                isActive = gbb.state.addProductsFilters.isFiltersActive
            }
            return isActive;
        },
        setActivatedFilters: function (filterTag, noteAttribute, operation, category) {

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey;
            if (category) {
                filterTag.category = category
                filterTag.filterId = category?.filterId || "123"
            }
            if (addProductsPageArr.includes(noteAttribute)) {
                let activatedFilters = gbb.state.addProductsFilters.activatedFilters;
                if (operation == "add") {
                    if (activatedFilters.findIndex(e => e.label == filterTag.label) == -1) {
                        activatedFilters.push(filterTag);
                    }
                } else {
                    activatedFilters = activatedFilters.filter((element) => {
                        return element.label != filterTag.label
                    })
                }
                gbb.state.addProductsFilters.activatedFilters = activatedFilters;

            }
        },
        setActivatePriceFilters: function (noteAttribute, value) {

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                gbb.state.addProductsFilters.priceFilterActive = value;
            }
            return;
        },
        getIsPriceFilterActive: function (noteAttribute) {
            let isPriceFilterActive = false;


            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                isPriceFilterActive = gbb.state.addProductsFilters.priceFilterActive
            }
            return isPriceFilterActive;
        },
        getActivatedFilters: function (noteAttribute) {
            let activatedFilters = [];

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                activatedFilters = gbb.state.addProductsFilters.activatedFilters
            }

            return activatedFilters;
        },
        getActivatedCategoriesForFilters: function (noteAttribute, filterCategory) {
            try {
                let activatedFilters = gbb.utility.getActivatedFilters(noteAttribute);
                for (let i = 0; i < activatedFilters.length; i++) {
                    let activatedFilter = activatedFilters[i];
                    if (activatedFilter?.category && activatedFilter.category == filterCategory) {
                        return true;
                    }
                }
                return false;
            } catch (err) {
                gbb.utility.debugConsole(err + "inside getActivatedCategoryForFilters");
            }

        },
        getCurrentPageHTML: function (noteAttribute) {
            let currentPageHTML = "";
            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                currentPageHTML = gbb.$(".gbbPageBody").find(".gbbAddProductsContainerHTML");
            }

            return currentPageHTML;
        },
        setSortByValues: function (noteAttribute, sortByValue) {


            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                gbb.state.addProductsSortBy.isSortByEnabled = gbb.settings.stepsConfigurationData[keyAttribute].sortBy?.isSortByEnabled || false;
                gbb.state.addProductsSortBy.sortByCategories = gbb.settings.stepsConfigurationData[keyAttribute].sortBy?.categories || [];
                gbb.state.addProductsSortBy.sortByValue = sortByValue || "";
            }



            return;
        },
        getSortByValues: function (noteAttribute) {
            let sortBy = {};

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
            if (addProductsPageArr.includes(noteAttribute)) {
                sortBy.isSortByEnabled = gbb.state.addProductsSortBy?.isSortByEnabled || false;
                sortBy.sortByCategories = gbb.state.addProductsSortBy?.sortByCategories || [];
                sortBy.sortByValue = gbb.state.addProductsSortBy?.sortByValue || "";
            }

            return sortBy;
        },
        sortAscending: function (arr, key) {
            return arr.sort(function (a, b) {
                var x = a[key];
                var y = b[key];

                if (typeof x == "string") {
                    x = ("" + x).toLowerCase();
                }
                if (typeof y == "string") {
                    y = ("" + y).toLowerCase();
                }

                return ((x < y) ? -1 : ((x > y) ? 1 : 0));
            });
        },
        sortDescending: function (arr, key) {
            return arr.sort(function (a, b) {
                var x = a[key];
                var y = b[key];

                if (typeof x == "string") {
                    x = ("" + x).toLowerCase();
                }
                if (typeof y == "string") {
                    y = ("" + y).toLowerCase();
                }

                return ((x > y) ? -1 : ((x < y) ? 1 : 0));
            });
        },
        getSortedProducts: function (noteAttribute) {
            let result = gbb.utility.getSortByValues(noteAttribute);
            let activeCategoryId = gbb.gbbMultipleCategoriesPage.state.currentCategoryId;
            let totalProducts = []
            if (activeCategoryId) { // changing filter search DB for multicategory -> to get only the products of the active category
                totalProducts = gbb.gbbAddProductsPage.state.productPageData.categories[activeCategoryId].uniqueProductsData
            }
            else {
                totalProducts = gbb.gbbAddProductsPage.state.uniqueProductsData;
            }
            // let products = JSON.parse(JSON.stringify(gbb.gbbAddProductsPage.state.uniqueProductsData));
            let products = JSON.parse(JSON.stringify(totalProducts));


            if (result?.isSortByEnabled) {
                if (result.sortByValue == "alphabeticalAToZ") {
                    products = gbb.utility.sortAscending(products, "title")
                } else if (result.sortByValue == "alphabeticalZToA") {
                    products = gbb.utility.sortDescending(products, "title")
                } else if (result.sortByValue == "priceLowToHigh") {
                    products = gbb.utility.sortAscending(products, "price")
                } else if (result.sortByValue == "priceHighToLow") {
                    products = gbb.utility.sortDescending(products, "price")
                }
            }
            return products;
        },
        /**
         * Generates a stylesheet string based on the settings 
         * and appends it to the head of the HTML document.
         * @returns {string} The generated style string.
         */
        getActiveVariantStyle: function () {
            let style =
                `<style>
                    .gbbActiveVariant {
                            background: ${gbb.settings?.pageCustomizationData?.productCard.productCardButtonColor} !important;
                            color:${gbb.settings.pageCustomizationData.productCard.productCardButtonTextColor} !important;
                        }
                    .gbbActiveImage {
                            border: 2px solid ${gbb.settings?.pageCustomizationData?.productCard.productCardButtonColor} !important;
                    }    
                    .gbbBodyWrapper ::-webkit-scrollbar-thumb{
                        background: ${gbb.settings?.pageCustomizationData?.generalSettings?.scrollBar?.scrollBarColor || "#000000"} !important;
                    }    
                    .gbbActiveMsgDeliveryOptions {
                        border: 1px solid #A2A2A2 !important;
                        background-color: rgb(255, 255, 255) !important;
                    }      
                    .gbbCustomerUploadButton{
                        background-color: ${gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor};
                        color: ${gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor};
                    }      
                    </style>`
            gbb.$('html > head').append(style);
            return style;
        },
        getConditionMessage: function (type, condition) {
            let result = gbb.settings?.languageData?.conditions;
            if (type == "amount") {
                result = result.amount;
            } else if (type == "quantity") {
                result = result.quantity;
            } else if (type == "weight") {
                result = result.weight;
            }
            result = result[condition];
            result = result["value"]
            return result;
        },
        checkConditions: function (value, element, goToNextStep) {
            let result = true;
            // let conditions = additionalInfo.conditions || [];
            let elementMaxValue = element.maxValue || element.value
            switch (element.condition) {
                case "lessThanOrEqualTo": {
                    result = value <= element.value ? true : false;
                    break;
                }
                case "equalTo": {
                    if (!goToNextStep) {
                        result = value <= elementMaxValue ? true : false;
                    } else {
                        // result = value == element.value ? true : false;
                        result = value - element.value >= 0 ? true : false;
                    }
                    break;
                }
                case "greaterThanOrEqualTo": {
                    if (goToNextStep) {
                        result = value >= element.value ? true : false;
                    }
                    break;
                }
            }
            return result;
        },
        checkConditionsAndProceedToNextPage: async function (noteAttribute, gbbFooterNextButton) {
            try {
                let result = await gbb.utility.checkConditionsOnNext(noteAttribute, gbbFooterNextButton);
                if (result.isConditionMet) {
                    gbb.utility.renderTemporaryLoadingSpinner("show");
                    gbb.giftboxbuilderPage.action.onNextNavigationBYOB();
                    let isRenderSlotFooterEnable = gbb.settings.stepsConfigurationData?.isProductSlotsEnabled && gbb.gbbAddProductsPage?.state?.isEveryConditionHaveTypeQuantity
                    if (isRenderSlotFooterEnable) {
                        setTimeout(() => {
                            gbb.gbbAddProductsPage.f.autoScrollSlotsOnNavigation()
                        }, 1000)
                    }
                    gbb.utility.disableElement(gbbFooterNextButton, 1000);
                    return true;
                } else {
                    return false;
                }
            } catch (e) {
                gbb.utility.debugConsole(e);
            }
        },
        checkStepConditions: async function (noteAttribute, { productAmount, category, productQuantity, productWeight }) {
            //this function recognizes what kind of page type it is
            //single category page -> fire checkSingleCategoryPageConditions function
            //multiple category page ->
            //->check if page level conditions are enabled
            //if not enabled-> fire checkMultipleCategoryPageCondition function
            //else -> fire checkSingleCategoryPageConditions function
            // let productAmount = 
            let conditionResult;
            let pageType = gbb?.gbbAddProductsPage?.state?.productPageData?.pageType
            if (gbb.state.currentPageId == 'personalizationPage') {
                let options = {
                    productQtyToAdd : productQuantity
                }
                conditionResult = gbb.gbbAddonProducts.f.checkMaxAddonProductsConditions(options)
            } else if (pageType && pageType == "MULTIPLE_CATEGORY") {
                let globalConditions = gbb.gbbAddProductsPage.state.productPageData?.isPageConditionsEnabled;
                if (!globalConditions) {
                    // let options = {productAmount, goToNextStep, category, checkConditionsForOneCategoryOnNext, productQuantity}  
                    let options = {
                        productAmount: productAmount,
                        goToNextStep: false,
                        category: category,
                        checkConditionsForOneCategoryOnNext: false,
                        productQuantity: productQuantity,
                        productWeight: productWeight
                    }
                    conditionResult = await gbb.utility.checkMultipleCategoryPageCondition(noteAttribute, options);
                } else {
                    let options = {
                        productAmount: productAmount,
                        productQuantity: productQuantity,
                        goToNextStep: false,
                        productWeight: productWeight
                    }

                    conditionResult = await gbb.utility.checkSingleCategoryPageConditions(noteAttribute, options);
                }
            } else {
                let options = {
                    productAmount: productAmount,
                    productQuantity: productQuantity,
                    goToNextStep: false,
                    productWeight: productWeight
                }
                // conditionResult = await gbb.utility.checkSingleCategoryPageConditions(noteAttribute, productAmount, productQuantity, false);
                conditionResult = await gbb.utility.checkSingleCategoryPageConditions(noteAttribute, options);
            }

            return conditionResult;
        },
        checkMultipleCategoryPageConditionOnNext: async function (noteAttribute, categoriesData) {
            //this function is fired when we're trying to go from a "multiple category" page to next page and "pagelevel" conditions are not enabled on this page
            let result;

            let categories = JSON.parse(JSON.stringify(categoriesData));
            //sort the checkMultipleCategoryPageConditionOnNext and place the current category at the first

            let currentCategory = gbb.gbbMultipleCategoriesPage.state.currentCategoryId;

            categories = categories.sort((a, b) => {
                if (a.categoryId == currentCategory) {
                    return -1;
                } else {
                    return 1;
                }
            });



            for (let index = 0; index < categories.length; index++) {
                // let options = {productAmount, goToNextStep, category, checkConditionsForOneCategoryOnNext, productQuantity}
                let options = {
                    productAmount: "",
                    goToNextStep: true,
                    category: categories[index]["categoryId"],
                    checkConditionsForOneCategoryOnNext: true,
                    productQuantity: ""
                }
                // result = await gbb.utility.checkMultipleCategoryPageCondition(noteAttribute, "", true, categories[index]["categoryId"], true, "");
                result = await gbb.utility.checkMultipleCategoryPageCondition(noteAttribute, options);
                if (!result.isConditionMet) {
                    break;
                }
            }
            return result;
        },
        checkMultipleCategoryPageCondition: async function (noteAttribute, { productAmount, goToNextStep, category, checkConditionsForOneCategoryOnNext, productQuantity, productWeight }) {
            //this function tells us if the conditions on multiple category page is satisfied
            //goToNextStep determines if productAmount or productQuantity values should be modified or not
            let categoryTitle;
            let categories = undefined
            categories = gbb.gbbAddProductsPage.state.productPageData.categories;
            categories = gbb.utility.convertObjectToArray(categories)

            if (goToNextStep && !checkConditionsForOneCategoryOnNext) {
                return gbb.utility.checkMultipleCategoryPageConditionOnNext(noteAttribute, categories);
            }
            let conditionResult = gbb.utility.getStepConditionsForMultipleCategoriesPage(categories, category);
            conditions = conditionResult.conditions;
            let categoryData = {
                categoryTitle: conditionResult.categoryTitle,
                categoryId: category
            }

            productAmount = gbb.utility.formatPriceWithoutSymbol(productAmount);
            let cartAmount, cartQuantity, cartResult;

            let pageType = "MULTIPLE_CATEGORY"
            let options = {
                productAmount: productAmount,
                productQuantity: productQuantity,
                goToNextStep: goToNextStep,
                category: category,
                pageType: pageType,
                productWeight: productWeight
            }
            let modifiedValues = await gbb.utility.modifyProductValuesToCheckCondiitons(noteAttribute, options)
            cartAmount = modifiedValues.result.cartAmount;
            cartQuantity = modifiedValues.result.cartQuantity;
            cartResult = modifiedValues.result.cartResult;
            cartWeight = modifiedValues.result.cartWeight;

            let dataForConditionsCheck = {
                conditions: conditions,
                cartAmount: cartAmount,
                cartQuantity: cartQuantity,
                cartResult: cartResult,
                goToNextStep: goToNextStep,
                categoryData: categoryData,
                cartWeight: cartWeight
            }

            let result = gbb.utility.loopThroughEachConditionAndCheck(conditions, dataForConditionsCheck);
            // result = {
            //     ...result,
            //     conditions: conditions
            // }
            return result;
        },
        checkSingleCategoryPageConditions: async function (noteAttribute, { productAmount, productQuantity, goToNextStep, productWeight }) {
            //this function tells us if the conditions on page is satisfied
            //goToNextStep determines if productAmount or productQuantity values should be modified or not
            let conditions = gbb.utility.getStepCondtions(noteAttribute);
            productAmount = gbb.utility.formatPriceWithoutSymbol(productAmount);
            let cartAmount, cartQuantity, cartResult, cartWeight;
            let options = {
                productAmount: productAmount,
                productQuantity: productQuantity,
                goToNextStep: goToNextStep,
                productWeight: productWeight
            }
            let modifiedValues = await gbb.utility.modifyProductValuesToCheckCondiitons(noteAttribute, options)
            cartAmount = modifiedValues.result.cartAmount;
            cartQuantity = modifiedValues.result.cartQuantity;
            cartResult = modifiedValues.result.cartResult;
            cartWeight = modifiedValues.result.cartWeight;
            let dataForConditionsCheck = {
                conditions: conditions,
                cartAmount: cartAmount,
                cartQuantity: cartQuantity,
                cartResult: cartResult,
                cartWeight: cartWeight,
                goToNextStep: goToNextStep
            }
            let result = gbb.utility.loopThroughEachConditionAndCheck(conditions, dataForConditionsCheck)
            // result = {
            //     ...result,
            //     conditions: conditions
            // }
            return result;
        },
        modifyProductValuesToCheckCondiitons: async function (noteAttribute, { productAmount, productQuantity, category, pageType, goToNextStep, productWeight }) {
            let cartResult = await gbb.utility.getStepCartData(noteAttribute, category, pageType);
            let cartQuantity = cartResult.quantity;
            let cartAmount = cartResult.amount;
            let cartWeight = cartResult.weight;
            gbb.utility.debugConsole("cartResult", cartResult);
            gbb.utility.debugConsole("ccartResult cartWeight", cartWeight);
            productAmount = parseInt(productAmount);
            if (!goToNextStep) {
                if (productQuantity) {
                    cartQuantity += productQuantity; //new cart quantity
                    productAmount = productAmount * productQuantity
                    productWeight = productWeight * productQuantity
                } else {
                    cartQuantity += gbb.gbbAddProductsPage.state.incrementProductQtyBy || 1;
                }
                cartAmount += productAmount;
                cartWeight += productWeight;
            }
            return { result: { cartAmount, cartQuantity, cartResult, cartWeight } };
        },
        loopThroughEachConditionAndCheck: function (conditions, { cartAmount, cartQuantity, cartResult, goToNextStep, categoryData, cartWeight }) {
            let categoryTitle = categoryData?.categoryTitle;
            let categoryId = categoryData?.categoryId;
            let pageType = gbb?.gbbAddProductsPage?.state?.productPageData?.pageType
            let result = {
                isConditionMet: true,
                message: "",
                conditions: conditions
            }

            let maxValue = 0;

            for (let j = 0; j < conditions.length; j++) {
                let currentCondtion = conditions[j]
                if (currentCondtion && currentCondtion.customValue){ // outdoor-dog-supply.com -> when merchant wants to handle conditions dynamically based on some custom logic 
                    // currentCondtion.customValue = "window.customStepCondition"
                    let customConditionValue = eval(currentCondtion.customValue) || currentCondtion.value
                    currentCondtion.value = customConditionValue
                }
                // get maxValue from the conditions array in the value field
                if (parseInt(conditions[j].value) > maxValue) {
                    maxValue = parseInt(conditions[j].value)
                }

                if (conditions[j].condition == "greaterThanOrEqualTo") {
                    maxValue = Number.MAX_SAFE_INTEGER;
                    break;
                }
            }



            for (let index = 0; index < conditions.length; index++) {
                let element = JSON.parse(JSON.stringify(conditions[index]));

                let allValuesFromConditions = conditions.map((condition) => {
                    return parseInt(condition.value)
                });
                element.maxValue = maxValue;

                let isThisLastElement = index - (conditions.length - 1) == 0 ? true : false
                let additionalInfo = {
                    conditions: conditions
                }
                if (element.type == "quantity") {
                    result.isConditionMet = gbb.utility.checkConditions(cartQuantity, element, goToNextStep);

                } else if (element.type == "amount") {
                    result.isConditionMet = gbb.utility.checkConditions(cartAmount, element, goToNextStep);
                } else if (element.type == "weight") {
                    //conver element value to grams
                    let weightValueInGrams = gbb.utility.convertToGrams(element.value, element.unit);
                    let weightConditionObject = {
                        ...element,
                        value: weightValueInGrams
                    }
                    result.isConditionMet = gbb.utility.checkConditions(cartWeight, weightConditionObject, goToNextStep);
                }

                let isAtleastOneTierSatisifed = false;
                if (element.condition == "equalTo") {
                    switch (element.type) {
                        case "quantity":
                            isAtleastOneTierSatisifed = allValuesFromConditions.includes(parseInt(cartQuantity))
                            break;
                        case "amount":
                            isAtleastOneTierSatisifed = allValuesFromConditions.includes(parseInt(cartAmount))
                            break;
                        case "weight":
                            isAtleastOneTierSatisifed = allValuesFromConditions.includes(parseInt(cartWeight))
                            break;
                    }
                }


                if (isAtleastOneTierSatisifed) {
                    result.isConditionMet = true;
                    break;
                }


                if (!result.isConditionMet) {
                    result.message = gbb.utility.getConditionMessage(element.type, element.condition);
                    let quantityVariables = gbb.utility.getQuantityVariables(element, cartResult, additionalInfo);
                    let amountVariables = gbb.utility.getAmountVariables(element, cartResult, additionalInfo);
                    let weightVariables = gbb.utility.getWeightVariables(element, cartResult, additionalInfo);
                    let message = gbb.utility.replaceConditionVariables(result.message, quantityVariables, amountVariables, weightVariables);
                    if (pageType && pageType == "MULTIPLE_CATEGORY") {
                        // scroll to categoryId
                        // write after clicking on category
                        // -100 for the top
                        // dont click on category if it's already clicked
                        if (gbb.utility.isCategoryOpen(categoryId)) {
                            gbb.utility.debugConsole("category already open")
                        } else {
                            gbb.$(`div[categoryId='${categoryId}']`).click()
                        }
                        // gbb.utility.scrollToCategory(categoryId, -100)

                        gbb.f.renderConditionNotificationToast(message, categoryTitle);
                    } else {
                        gbb.f.renderConditionNotificationToast(message);
                    }
                    break;
                }
            }
            return result;
        },
        getPageRankByPageId: function (pageId) {
            try {
                let navigationItems = gbb.state.navigationItems || [];
                let item = navigationItems.find(item => item?.id == pageId);
                return item?.rank;
            } catch (error) {
                gbb.utility.debugConsole("error in getPageRankByPageId", error)
            }
        },
        checkConditionsOnNext: async function (noteAttribute) {
            //this function is fired when we're going from current page to next page
            //if it's a single catgory page -> fire checkSingleCategoryPageConditions function
            //multiple category page ->
            //->check if page level conditions are enabled
            //if not enabled-> fire checkMultipleCategoryPageCondition function
            //else -> fire checkSingleCategoryPageConditions function
            //personalization page -> relevant conditions
            let condition;
            let pageType = gbb?.gbbAddProductsPage?.state?.productPageData?.pageType
            let options = {
                productAmount: "",
                productQuantity: "",
                goToNextStep: true
            }
            if (noteAttribute == "personalizePage" || gbb.state.currentPageId == 'personalizationPage') {
                condition = gbb.utility.checkPersonalizePageConditions();

            } else if (pageType && pageType == "MULTIPLE_CATEGORY") {
                let globalConditions = gbb.gbbAddProductsPage.state.productPageData?.isPageConditionsEnabled;
                if (!globalConditions) {
                    let categories = gbb.gbbAddProductsPage.state.productPageData.categories;
                    categories = gbb.utility.convertObjectToArray(categories)
                    condition = await gbb.utility.checkMultipleCategoryPageConditionOnNext(noteAttribute, categories);
                } else {
                    // condition = await gbb.utility.checkSingleCategoryPageConditions(noteAttribute, "", "", true);
                    condition = await gbb.utility.checkSingleCategoryPageConditions(noteAttribute, options);
                }

            } else {
                // condition = await gbb.utility.checkSingleCategoryPageConditions(noteAttribute, "", "", true);
                condition = await gbb.utility.checkSingleCategoryPageConditions(noteAttribute, options);
            }
            return condition;
        },
        checkPersonalizePageConditions: function () {
            let result = {
                isConditionMet: true, //because if text message and video message are both disabled -> isConditionMet should be true
                message: ""
            }
            if (gbb?.settings?.giftMessage?.isGiftMessageMandatory && (!gbb.gbbPersonalizePage.state?.giftMessage || gbb.gbbPersonalizePage.state?.giftMessage?.trim().length == 0)) {
                let warningMsg = gbb.$(".gbbPageBody").find(".gbbGiftMessageV2RequiredWarning");
                warningMsg.css("display", "block")
                result.isConditionMet = false;
                return result;
            } else {
                let warningMsg = gbb.$(".gbbPageBody").find(".gbbGiftMessageV2RequiredWarning");
                warningMsg.css("display", "none")
                result.isConditionMet = true;
            }

            let isEmailInfoValid = gbb.gbbPersonalizePage.f.verifyEmailFields();
            if (!isEmailInfoValid) {
                result.isConditionMet = false
            }
            let isAddonEnabled = gbb.gbbAddonProducts.state.isEnabled 
            if (isAddonEnabled) {
                let isAddonPageConditionMet = gbb.gbbAddonProducts.f.checkAddonsConditionsOnNext();
                if (!isAddonPageConditionMet) {
                    result.isConditionMet = false;
                    let message = gbb.utility.renderLanguageValue(gbb.settings?.languageData?.addons?.addonProductsMandatory) || "Please add atleast one product1"
                    gbb.f.renderConditionNotificationToast(message)
                }

            }
            return result;
        },
        getQuantityVariables: function (element, cartResult, additionalInfo) {
            let quantityVariables = {};

            let conditions = additionalInfo?.conditions || [];
            let isNextValueSet = false;

            if (element.condition == "equalTo") {
                for (let j = 0; j < conditions.length; j++) {
                    let item = conditions[j];
                    if ((parseInt(item.value) >= parseInt(cartResult.quantity)) && !isNextValueSet) {
                        // nextConditionalQuantity = item.value;
                        isNextValueSet = true;
                        element.value = item.value
                    }
                }
            }

            quantityVariables.currentQuantity = cartResult.quantity;
            quantityVariables.conditionQuantity = element.value;
            quantityVariables.remainingQuantity = Math.abs(quantityVariables.currentQuantity - quantityVariables.conditionQuantity);
            return quantityVariables;
        },
        getAmountVariables: function (element, cartResult, additionalInfo) {
            let amountVariables = {};
            let conditions = additionalInfo?.conditions || [];
            let isNextValueSet = false;

            if (element.condition == "equalTo") {
                for (let j = 0; j < conditions.length; j++) {
                    let item = conditions[j];
                    if ((parseInt(item.value) >= parseInt(cartResult.amount)) && !isNextValueSet) {
                        element.value = item.value
                        isNextValueSet = true;
                    }
                }
            }
            amountVariables.currentAmount = cartResult.amount;
            amountVariables.conditionAmount = element.value;
            amountVariables.remainingAmount = Math.abs(amountVariables.currentAmount - amountVariables.conditionAmount);
            return amountVariables;
        },
        getWeightVariables: function (element, cartResult, additionalInfo) {
            let weightVariables = {};

            let conditions = additionalInfo?.conditions || [];
            let isNextValueSet = false;

            if (element.condition == "equalTo") {
                for (let j = 0; j < conditions.length; j++) {
                    let item = conditions[j];
                    if ((parseInt(item.value) >= parseInt(cartResult.weight)) && !isNextValueSet) {
                        element.value = item.value
                        isNextValueSet = true;
                    }
                }
            }

            weightVariables.currentWeight = cartResult.weight;
            weightVariables.conditionWeight = element.value + String(element.unit);
            weightVariables.remainingWeight = Math.abs(weightVariables.currentWeight - weightVariables.conditionWeight) + String(element.unit);
            return weightVariables;
        },
        replaceConditionVariables: function (message, quantityVariables, amountVariables, weightVariables) {
            for (let [key, value] of Object.entries(quantityVariables)) {
                if (!value) {
                    value = ""
                }
                let VariableName = "##" + key + "##"
                //let VariableName = JSON.stringify(`}`)
                message = message.replace(new RegExp(`${VariableName}`, 'g'), value);
            }
            for (let [key, value] of Object.entries(amountVariables)) {
                if (!value) {
                    value = ""
                }
                let VariableName = "##" + key + "##"
                value = gbb.utility.getCurrencySymbol() + "" + value;
                message = message.replace(new RegExp(`${VariableName}`, 'g'), value);
            }
            for (let [key, value] of Object.entries(weightVariables)) {
                if (!value) {
                    value = ""
                }
                let VariableName = "##" + key + "##"
                message = message.replace(new RegExp(`${VariableName}`, 'g'), value);
            }
            return message;
        },
        getStepCondtions: function (noteAttribute) {
            let conditions = [];

            let addProductsPageArr = ADDPRODUCT_PAGES_LIST;
            let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey

            // convert this to if else
            if (addProductsPageArr.includes(noteAttribute)) {
                conditions = gbb.settings.stepsConfigurationData[keyAttribute].conditions || [];
            }

            return conditions;
        },
        getStepConditionsForMultipleCategoriesPage: function (categories, category) {
            let result = {
                categoryTitle: "",
                conditions: []
            }
            for (let index = 0; index < categories.length; index++) {
                let ele = categories[index];
                if (ele.categoryId == category) {
                    result.conditions = ele.conditions;
                    result.categoryTitle = ele.title || ""
                    break;
                }
            }
            return result;
        },
        getStepCartData: async function (noteAttribute, category, pageType) { //gets the total amount of the products added in a specific step
            let result = {
                amount: 0,
                quantity: 0,
                weight: 0
            }
            let cartData = await gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage() //if we should use the cart state

            let items = cartData.items;
            for (let index = 0; index < items.length; index++) {

                let item = items[index];
                if (item && item.properties && item.properties._boxProduct == noteAttribute) {

                    if (pageType && pageType == "MULTIPLE_CATEGORY") {
                        //document - metch category if MULTIPLE_CATEGORY page, 
                        if (item.properties._Category != category) {
                            continue
                        }
                    }

                    let amount = gbb.utility.formatPriceWithoutSymbol(item.price);
                    amount = amount * item.quantity;
                    result.amount += amount;
                    result.quantity += item.quantity
                    result.weight += item.weight * item.quantity
                }
            }
            return result;
        },
        executeRedirectAction: function () {
            try {

                let regionalLocale = gbb.utility.getRegionalLocaleFromUrl();
                if (gbb.settings.app.stackDiscounts) {
                    let discountString = gbb.gbbBrowser.prepareDiscountString();
                    if (discountString) {
                        gbb.gbbDiscountComponent.state.discountCode = discountString;
                    }
                }

                if (gbb.settings.app.redirectToScript && gbb.settings.app.redirectToScript?.trim()?.length != 0) {
                    const codeString = gbb.settings.app.redirectToScript;
                    eval(codeString);
                } else if (gbb.settings.app.redirectToCheckoutEnabled) {
                    if (gbb.gbbDiscountComponent.state.discountCode) {
                        // https://{domain}/discount/{discountCode}?redirect=/checkout
                        window.location.href = window.location.origin + regionalLocale + "/cart/checkout?discount=" + gbb.gbbDiscountComponent.state.discountCode;
                        // window.location.href =  window.location.origin + "/discount/" + gbb.gbbDiscountComponent.state.discountCode+"?redirect=/checkout";
                    }
                    else {
                        window.location.href = window.location.origin + regionalLocale + "/cart/checkout";
                    }
                } else if (gbb.settings.app.redirectToCartEnabled) {
                    window.location.href = window.location.origin + regionalLocale + "/cart/";
                } else {
                    if (gbb.gbbDiscountComponent.state.discountCode) {
                        window.location.href = window.location.origin + regionalLocale + "/cart/checkout?discount=" + gbb.gbbDiscountComponent.state.discountCode;
                        // window.location.href =  window.location.origin + "/discount/" + gbb.gbbDiscountComponent.state.discountCode+"?redirect=/checkout";
                    }
                    else {
                        window.location.href = window.location.origin + regionalLocale + "/cart/checkout";
                    }
                }
            } catch (err) {
                gbb.utility.debugConsole(err + "inside executeRedirectAction");
            }
        },

        loadCheckoutPage: async function () {

            if (gbb.state.giftBoxCartData?.items?.length > 0 && gbb.settings?.discountsData?.isDiscountEnabled && gbb.gbbDiscountComponent?.state?.discountCode) {
                // window.location.href = window.location.origin + "/discount/" + gbb.gbbDiscountComponent.state.discountCode + "?redirect=" + window.location.pathname
                // const discountResp = await fetch("/discount/" + gbb.gbbDiscountComponent.state.discountCode);
                // if (response.status == 200) {
                // window.location.href = window.location.origin + "/cart/checkout"
                // gbb.utility.executeRedirectAction();
                // }

                await fetch("/discount/" + gbb.gbbDiscountComponent.state.discountCode)
                    .then(resp => resp.json())
                    .then((response) => {
                        //response.data
                        if (response.data.isAutomatic) {
                            setTimeout(() => {
                                gbb.utility.executeRedirectAction();
                            }, 1000);
                        } else {
                            gbb.utility.executeRedirectAction();
                        }
                    }).catch((err) => {
                        gbb.utility.debugConsole(err);
                        gbb.utility.executeRedirectAction();
                    })

                return;
            }

            gbb.utility.executeRedirectAction();
        },
        getVariantDetailsFromCurrentProductsDataSet: function (variantId,origin) { 
            try {
                let variantDetails = gbb.state.currentProductsDataSetForVariants[variantId];
                if (origin == 'addonProducts') {
                    variantDetails = gbb.gbbAddonProducts.state.currentProductsDataSetForVariants_addons[variantId]
                }
                return variantDetails;
            } catch (error) {
                gbb.utility.debugError("error in getVariantDetailsFromCurrentProductsDataSet",error)
            }
        },
        getProductDetailsFromState: function (productId, variantId) {
            let productDetails = {};
            let productsDbToSearchIn = gbb.gbbAddProductsPage.state.currentProductsDataset
            let addonProductsState = gbb.gbbAddonProducts.state
            let isAddonProductDataSetExists = addonProductsState?.addonProductsDataSet?.length > 0
            let isCurrentPageTypePersonalization = gbb.state.currentPageId == 'personalizationPage'
            let eligibleTierForAddons = addonProductsState?.eligibleTierForAddons || {}

            if (isCurrentPageTypePersonalization && Object.keys(eligibleTierForAddons).length>0 && isAddonProductDataSetExists) {
                productsDbToSearchIn = addonProductsState?.addonProductsDataSet
            }

            for (let i = 0; i < productsDbToSearchIn?.length; i++) {
                let product = productsDbToSearchIn[i];
                if (product.id == productId) {
                    let variantDetails;
                    productDetails = product;
                    let isDisplayVariantsAsIndividualProductsEnabled = gbb.gbbAddProductsPage.state.displayVariantsAsIndividualProducts

                    if (isCurrentPageTypePersonalization) {
                        let activeTierIndex = eligibleTierForAddons?.tierIndex
                        isDisplayVariantsAsIndividualProductsEnabled = addonProductsState.tiers[activeTierIndex]?.displayVariantsAsIndividualProducts_addons// read from addon
                    }

                    if (variantId && isDisplayVariantsAsIndividualProductsEnabled) {
                        let origin = isCurrentPageTypePersonalization ? "addonProducts": null
                        variantDetails = gbb.utility.getVariantDetailsFromCurrentProductsDataSet(variantId, origin)
                        gbb.utility.debugConsole("variants name is ", variantDetails.title);
                        product.variants = [variantDetails];
                        product = gbb.gbbAddProductsPage.f.updateProductDataWithFirstVariantData(product);
                        productDetails = product;
                        break;  // Exit the loop once we found the product
                    }
                }
            }
            return productDetails;
        },
        closeVariantsModal: function () {
            try {
                gbb.utility.slider.state.slideIndex = 1;
                gbb.state.variantCustomProperties = {};
                gbb.state.currentModalProductData = {};
                gbb.gbbProductFormStep.state.formSubmissionData = {};
                // gbb.$("body").css("overflow-y", "auto");
                gbb.$("body").find(".gbbProductVariantModalContainer").remove()
                gbb.$("body").find(".gbbProductVariantModalMainContainer").remove()
                gbb.$("body").css("overflow-y", DEFAULT_BODY_OVERFLOW_VALUE);
                gbb.gbbBrowser.emitCustomEvent({
                    eventName: "gbb-variants-modal-close",
                })
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        productDetailsWith_VariantId_Or_ProductIdAsKey: function (products, extraInfo) {
            //products is an objects with product handle as key
            //this function returns an object with product id as key
            let productsWithIdAsKey = {};
            for (let [key, value] of Object.entries(products)) {
                let product = value
                //if product has variants
                if (product.variants.length > 0) {

                    // if product.variants.length == 1;
                    // change product.featured_image to product.variants[0].image

                    //if there is only one variant in the product
                    // then change the product.featured_image to an image
                    // using product.media[]
                    if (product.variants.length == 1) {
                        let getNewImageAndMediaObjectWhenOnlyOneVariant = gbb.utility.getNewImageAndMediaObjectWhenOnlyOneVariant(product);
                        product.featured_image = getNewImageAndMediaObjectWhenOnlyOneVariant.newFeaturedImage;
                        product.media = getNewImageAndMediaObjectWhenOnlyOneVariant.newMedia;
                        product.images = getNewImageAndMediaObjectWhenOnlyOneVariant.newImages
                    }

                    for (let i = 0; i < product.variants.length; i++) {
                        product.variants[i]["productTags"] = product.tags;
                        product.variants[i].variant_id = product.variants[i].id;
                        product.variants[i].image = product.variants[i].featured_image?.src;
                        if (!product.variants[i].image) {
                            product.variants[i].image = product.featured_image
                        }

                        if (extraInfo == undefined || product.variants[i].title == "" || product?.variants?.length == 1) {
                            product.variants[i].title = product.variants[i].name
                        } else if (!extraInfo.shouldVariantTitleBeConvertedToProductTitle) {
                            product.variants[i].title = product.variants[i].title
                        }
                        product.variants[i].product_id = product.id
                        product.variants[i].productHandle = product.handle;
                        if (product.selling_plan_groups) {
                            //product.variants[i].sellingPlanDetails = gbb.utility.getSellingPlanDetailsForVariant(product?.selling_plan_groups, product.variants[i]?.selling_plan_allocations)
                            product.variants[i].selling_plan_groups = product.selling_plan_groups || [];
                            product.variants[i].selling_plan_allocations = product?.variants[i]?.selling_plan_allocations || [];
                        }
                        productsWithIdAsKey[product.variants[i].id] = product.variants[i];

                    }
                }

                //if product has no variants
                else {
                    productsWithIdAsKey[product.id] = product;
                }
            }

            return productsWithIdAsKey;
        },
        doesThisProductHaveConditions: function (currentProductProperties) {
            // const pagesWhichHaveConditionsOnPages = 
            const categoriesWhichHaveConditions = gbb.gbbAddProductsPage.state.categoriesWhichHaveConditions;
            const pagesWhichHaveConditionsOnPages = gbb.gbbAddProductsPage.state.pagesWhichHaveConditionsOnPages;
            if (pagesWhichHaveConditionsOnPages.includes(currentProductProperties._boxProduct) || categoriesWhichHaveConditions.includes(currentProductProperties._Category)) {
                return true;
            } else {
                return false;
            }

        },
        prepareMsgAttributesForCart: function () {
            try {
                let videoRecordId;
                let videoToggle = gbb.$(".gbbVideoMsgCheckboxField").is(":checked")
                if (videoToggle == false) {
                    videoRecordId = "";
                    gbb.gbbVideoMsg.state.uploadedVideoId = ""
                } else {
                    videoRecordId = gbb.gbbVideoMsg?.state?.uploadedVideoId;
                }

                gbb.gbbVideoMsg.state.uploadedVideoId = videoRecordId;

                if (!gbb.gbbPersonalizePage.state.giftMessage && !gbb.gbbVideoMsg.state.uploadedVideoId) {
                    quantity = 0;
                }



                return {
                    message: gbb.gbbPersonalizePage.state.giftMessage,
                    recipientName: gbb.gbbPersonalizePage.state.recipientName,
                    senderName: gbb.gbbPersonalizePage.state.senderName,
                    customerUploads: gbb.gbbPersonalizePage.state.customerUploadsResponse,
                    _videoMsgId: videoRecordId ? videoRecordId : null,
                    email: gbb.gbbVideoMsg?.state?.emailId,
                    _gbbEmailDeliveryOption: gbb?.gbbPersonalizePage?.state?.emailDeliveryOption,
                    _gbbEmailDeliveryDate: gbb?.gbbPersonalizePage?.state?.emailDatePicker ? gbb?.gbbPersonalizePage?.state?.emailDatePicker?.val() : "",
                }
            } catch (e) {
                gbb.utility.debugConsole(e)
                return false
            }
        },
        getActiveCurrencyRate: function () {
            let currencyRate = 1;
            if (window.Shopify && window.Shopify.currency && window.Shopify.currency.rate) {
                currencyRate = window.Shopify.currency.rate;
            }
            return currencyRate;
        },
        multiplyByBundleQuantity: function (cartData) {
            let cart = { ...cartData }
            cartData.bundleQuantity = cartData.boxQuantity || 1;
            let bundleQuantity = cartData?.bundleQuantity || 1;

            if (bundleQuantity > 1) {
                cart.items.forEach((item) => {
                    item.quantity = item.quantity * bundleQuantity;
                });
                cart.item_count = cart.item_count * bundleQuantity;
                cart.total_price = cart.total_price * bundleQuantity;
            }
            return cart;
        },
        applySellingPlanToAllCartItems: function (cartData) {
            let subscriptionPlan = gbb.gbbBrowser.getSubscriptionPlan();
            if (subscriptionPlan) {
                for (let i = 0; i < cartData.items.length; i++) {
                    delete cartData.items[i]?.selling_plan_allocations;
                    delete cartData.items[i]?.selling_plan_groups;
                    delete cartData.items[i]?.sellingPlanDetails;
                    cartData.items[i].selling_plan = parseInt(subscriptionPlan);
                }
            }
            return cartData;
        },
        applySellingPlanToAllCartItemsV2: function (cartData) {
            let activeSellingPlanId = gbb.gbbSubscriptionProductsPage.state.activeSellingPlanId
            if (activeSellingPlanId) {
                for (let i = 0; i < cartData.items.length; i++) {
                    delete cartData.items[i]?.selling_plan_allocations;
                    delete cartData.items[i]?.selling_plan_groups;
                    delete cartData.items[i]?.sellingPlanDetails;
                    cartData.items[i].selling_plan = parseInt(activeSellingPlanId);
                }
            }
            return cartData
        },
        checkIfBrandingShouldBeVisible: function (type) {
            try {

                // createdAt is more than 2months;
                let todayDate = new Date();
                let createdAt = new Date(gbb.settings.merchantInfo.createdAt);

                let storeIsOld = false;
                let diffTime = Math.abs(todayDate - createdAt);

                let diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays > 14) {
                    storeIsOld = true
                }

                if (!gbb.settings.merchantInfo?.isSubscription && storeIsOld) {
                    return false;
                }

                if (!gbb.settings?.merchantInfo?.isSubscription) {
                    return true;
                }
                if (gbb.settings?.merchantInfo?.isSubscription && gbb.settings?.merchantInfo?.isSubscription.name.search('Free') !== -1 && !type && type !== 'checkout') {
                    return true;
                }
                return false;
            } catch (error) {
                gbb.utility.debugConsole("error in checkIfBrandingShouldBeVisible", error);
                return false;
            }
        },
        renderPoweredByLabel: function () {
            let gbbPoweredByLabel = gbb.$("<a>")
                .attr("href", "https://apps.shopify.com/bundle-builder").attr("target", "_blank")
                .css("text-align", "end").css("display", "block").css("color", "black").css("font-size", "14px").css("text-decoration", "none");
            gbbPoweredByLabel.text("✨Powered By Easy Bundles✨");
            return gbbPoweredByLabel;
        },
        triggerSlackNotification: function (jsonBody) {
            jsonBody = jsonBody || {};

            gbb.utility.debugConsole("jsonBody", jsonBody)
            jsonBody = {
                errorStack: jsonBody?.stack || jsonBody?.error?.stack,
                errorName: jsonBody?.name || jsonBody?.error?.name,
                errorMessage: jsonBody?.message || jsonBody?.error?.message,
                sessionStorage: gbb.gbbBrowser.getCartDataFromSessionStorage(),
                ...jsonBody
            }

            const tempObj = {
                url: window.location.href,
                function: arguments?.callee?.caller?.name || "unknown",
                error: JSON.stringify(jsonBody)
            }


            let url = gbb.settings.SERVER_URL + "/api/utility/slackNotification";
            fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(tempObj),
            }).then((response) => {
                gbb.utility.debugConsole("response", response)
            }).catch((error) => {
                gbb.utility.debugConsole("error", error)
            })

        },
        /** overwrites particular html tags 
        * example: overwrite tab/document name
        * @returns void 
        */
        setBuilderPageHTMLData_SEO: function () {
            try {
                // page
                let seoData = gbb.settings?.bundleSettings.builderPageSeoData || [];

                // 
                // example
                // [{
                //     target: "title",
                //     value: "Bundle Builder"
                //     // attributeToOverwrite field is not needed as attribute to overwrite as it's a text
                // },
                // {
                //     target: "meta[name='description']",
                //     value: "Bundle Builder",
                //     attributeToOverwrite: "content"
                // }]

                seoData.forEach((data) => {
                    if (data.attributeToOverwrite && data.target && data.value) {
                        // gbb.$(data.target).attr("content", data.value);
                        gbb.$(data.target).attr(data.attributeToOverwrite, data.value);
                    }
                    else if (data.target && data.value) {
                        gbb.$(data.target).text(data.value);
                    }
                })

            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        stringifyError: function (error) {
            const properties = Object.getOwnPropertyNames(error);
            const stringifiedError = JSON.stringify(
                (function () {
                    const obj = {};
                    for (let i = 0; i < properties.length; i++) {
                        const prop = properties[i];
                        obj[prop] = error[prop];
                    }
                    return obj;
                })()
            );
            return stringifiedError;
        },
        cleanUpProperties: function (cart) {
            let cartData = { ...cart }
            let propertiesToRemove = ["addProductsPage", "categoryId", "_Category", "category", "_boxProduct", "productPersonalizationMetaData", "_uniqueGbbItemKey"]
            let conditionalPropertiesToRemove = [];
            if (!gbb?.settings?.bundleSettings?.showCategoryNamesInLineItem) {
                conditionalPropertiesToRemove.push("_CategoryName");
                // propertiesToRemove.push("discount")
            }

            // now lets combine 
            propertiesToRemove = [...propertiesToRemove, ...conditionalPropertiesToRemove];

            cartData.items.forEach((item) => {
                propertiesToRemove.forEach((property) => {
                    if (item.properties && item.properties[property]) {
                        delete item.properties[property];
                    }
                });
            })
            return cartData;
        },
        addCustomProperties: function (cartData, propertiesToAdd,addQtyOfProduct=false) {
            try {
                cartData.items.forEach((item) => {
                    for (let [key, value] of Object.entries(propertiesToAdd)) {
                        let valueToAdd = addQtyOfProduct ? `${value}_${item.quantity}` : value;
                        item.properties[key] = valueToAdd
                    }
                })
                return cartData
            } catch (error) {
                gbb.utility.debugConsole('error in addCustomProperties',error)
            }
        },
        checkIfRemoveButtonShouldBeAppended: function (variantId, pageIdTheProductWasAddedFrom) {
            try {
                let boxCartDataInSessionStorage = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
                if (boxCartDataInSessionStorage) {
                    let items = boxCartDataInSessionStorage.items || [];
                    let currentItem = items.find((item) => item.variant_id == variantId && pageIdTheProductWasAddedFrom == item.properties["_boxProduct"]);
                    // let currentite,
                    if (currentItem) {
                        let item = { ...currentItem };
                        let properties = Object.keys(item.properties) || [];
                        if (properties.includes("_DefaultProduct")) {
                            return false;
                        }

                        if (item.properties._boxProduct == "giftMessage" && gbb.state.currentPageId !== "personalizationPage") {
                            if (gbb.settings.stepsConfigurationData.personalizationData.giftMessage.isGiftMessageMandatory) {
                                return false;
                            } else {
                                return true;
                            }
                        }
                        if (gbb.state.currentPageId == 'personalizationPage' && item.properties._boxProduct == 'addonProduct'){
                            return true;
                        }
                        if (pageIdTheProductWasAddedFrom == gbb.state.currentPageId) {
                            if (item.properties && item.properties._boxProduct != gbb.state.currentPageId) {
                                // now check if this doesThisProductHaveConditions
                                let doesThisProductHaveConditions = gbb.utility.doesThisProductHaveConditions(item.properties);
                                let isConditionalProductFilteringEnabled = gbb.settings.stepsConfigurationData.conditionalLogic.isEnabled || gbb.settings.stepsConfigurationData.conditionalLogic.rules.length > 0
                                gbb.utility.debugConsole("doesThisProductHaveConditions", doesThisProductHaveConditions)
                                if (doesThisProductHaveConditions || isConditionalProductFilteringEnabled) {
                                    return false;
                                } else {
                                    return true;
                                }
                            } else {
                                return true;
                            }
                        } else {
                            return false;
                        }
                    }
                }
                return true;
            } catch (err) {
                gbb.utility.debugConsole(err + "inside checkIfRemoveButtonShouldBeAppended");
            }
        },
        updateBoxIdInCartData: function (cartData) {
            try {

                let currentBoxIdFromCart = gbb.gbbBrowser.state.boxIdOffset || 0;
                if (currentBoxIdFromCart == 0) {
                    gbb.utility.debugConsole("Adding to cart....")
                    return cartData;
                } else {
                    gbb.utility.debugConsole("Aheem. Looks like theres already a box in the cart.")
                    gbb.utility.debugConsole("next boxId starts from->", currentBoxIdFromCart + 1)
                    let cartDataUpdated = { ...cartData };

                    let boxKeys = Object.keys(cartDataUpdated?.boxes) || [];

                    for (let i = 0; i < boxKeys.length; i++) {
                        let boxItem = cartDataUpdated.boxes[boxKeys[i]];

                        boxItem.items.forEach(item => {
                            const existingBoxID = item.properties["Box ID"];
                            item.properties["Box ID"] = parseInt(existingBoxID) + currentBoxIdFromCart;
                        });
                    }
                    return cartDataUpdated;
                }
            } catch (error) {
                gbb.utility.debugConsole("error in updateBoxIdInCartData", error)
                return cartData;
            }
        },
        removeAlreadyAddedProductsFromShopifyCart: async function () {
            try {
                let bundleName = gbb?.settings?.stepsConfigurationData?.bundleName;
                let boxIdOffset = parseInt(gbb.gbbBrowser.state.boxIdOffset);
                let qty = 0;
                let data = { updates: {} };
                let result = true;
                if (bundleName) {
                    let shopifyCartItems = await gbb.shopifyUtility.getCart();
                    shopifyCartItems = shopifyCartItems.items;
                    if (shopifyCartItems.length > 0) {
                        for (let i = 0; i < shopifyCartItems.length; i++) {
                            let item = shopifyCartItems[i];
                            let itemBundleName = item.properties["Bundle"];
                            let itemBoxId = parseInt(item.properties["Box ID"]);
                            if (itemBundleName && itemBundleName == bundleName && itemBoxId > boxIdOffset) { //tbd more conditions?
                                data.updates[shopifyCartItems[i]["key"]] = qty;
                            }
                        }
                        if (Object.keys(data?.updates)?.length > 0) {
                            result = await gbb.shopifyUtility.updateCart(data);
                        }
                    }
                }
                return result;
            } catch (err) {
                gbb.utility.debugConsole(err);
                return false;
            }
        },

        renderPreparingBundleModal: function () {
            try {
                const gbbPreparingBundleMainContainer = gbb.$("<div>").addClass("gbbPreparingBundleMainContainer");
                const gbbPreparingBundleContainerModal = gbb.$("<div>").addClass("gbbPreparingBundleContainerModal");

                const gbbPreparingBundleHeader = gbb.$("<div>").addClass("gbbPreparingBundleHeader");
                gbbPreparingBundleHeader.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.preparingBundleText) || "Preparing Bundle...");

                let preparingBundleGif = gbb.settings.merchantInfo?.customSettings?.preparingBundleGif || "https://d3ks0ngva6go34.cloudfront.net/public/packagingbundle.gif";
                const gbbPreparingBundleGifContainer = gbb.$("<div>").addClass("gbbPreparingBundleGifContainer");
                const gbbPreparingBundleGif = gbb.$("<img>").addClass("gbbPreparingBundleGif").attr("src", preparingBundleGif);

                gbbPreparingBundleGifContainer.append(gbbPreparingBundleGif);

                gbbPreparingBundleContainerModal.append(gbbPreparingBundleHeader);
                gbbPreparingBundleContainerModal.append(gbbPreparingBundleGifContainer);
                gbbPreparingBundleMainContainer.append(gbbPreparingBundleContainerModal);
                gbb.$("body").append(gbbPreparingBundleMainContainer);
                gbb.f.applyFontToPreparingBundlePopup();
            } catch (err) {
                gbb.utility.debugConsole("error inside renderPreparingBundleModal:", err);
            }
        },

        renderUnavaibleProductsModal: async function (products) {
            const gbbUnavailableProductsMainContainer = gbb.$("<div>").addClass("gbbUnavailableProductsMainContainer");
            const gbbUnavailableProductsContainerModal = gbb.$("<div>").addClass("gbbUnavailableProductsContainerModal");

            const gbbCartProductsContainerHeader = gbb.$("<div>").addClass("gbbCartProductsContainerHeader");
            const gbbCartProductsContainerHeaderLabel = gbb.$("<div>").addClass("gbbCartProductsContainerHeaderLabel").text(gbb.settings?.languageData?.general?.productsNotAvailableText?.value || "Oops! Some products are not availble..");

            const gbbCartProductsContainerBody = gbb.$("<div>").addClass("gbbCartProductsContainerBody");

            const gbbCartModalProductsContainer = gbb.$("<div>").addClass("gbbCartModalProductsContainer");


            products.forEach((product) => {
                const gbbCartModalProductContainer = gbb.$("<div>").addClass("gbbCartModalProductContainer");
                //attach a data attriute to the product container
                gbbCartModalProductContainer.attr("productId", product?.product_id);
                gbbCartModalProductContainer.attr("variantId", product?.variant_id)

                const gbbCartProductImageContainer = gbb.$("<div>").addClass("gbbCartProductImageContainer");
                const gbbCartModalProductImage = gbb.$("<img>").addClass("gbbCartModalProductImage");
                gbbCartModalProductImage.attr("src", product.image);
                const gbbCartModalProductTextContainer = gbb.$("<div>").addClass("gbbCartModalProductTextContainer");

                const gbbCartModalProductTitleContainer = gbb.$("<div>").addClass("gbbCartModalProductTitleContainer");
                const gbbCartModalProductTitle = gbb.$("<div>").addClass("gbbCartModalProductTitle");
                const gbbCartModalProductQuantity = gbb.$("<div>").addClass("gbbCartModalProductQuantity");

                const gbbCartModalProductPriceQtyContainer = gbb.$("<div>").addClass("gbbCartModalProductPriceQtyContainer");
                const gbbCartModalProductPrice = gbb.$("<div>").addClass("gbbCartModalProductPrice");
                //a button to remove the product from the cart

                gbbCartModalProductTitle.text(product.title);
                gbbCartModalProductPrice.text(gbb.utility.formatPrice(product.price));
                gbbCartModalProductQuantity.text("x" + product.quantity);
                gbbCartProductImageContainer.append(gbbCartModalProductImage);

                gbbCartModalProductTitleContainer.append(gbbCartModalProductTitle);
                //gbbCartModalProductTitleContainer.append(gbbCartModalProductQuantity);

                gbbCartModalProductTextContainer.append(gbbCartModalProductTitleContainer);
                gbbCartModalProductPriceQtyContainer.append(gbbCartModalProductQuantity);
                gbbCartModalProductPriceQtyContainer.append(gbbCartModalProductPrice);
                gbbCartModalProductTextContainer.append(gbbCartModalProductPriceQtyContainer);

                gbbCartModalProductContainer.append(gbbCartProductImageContainer);
                gbbCartModalProductContainer.append(gbbCartModalProductTextContainer);
                gbbCartModalProductsContainer.append(gbbCartModalProductContainer);
            })

            gbbCartProductsContainerHeader.append(gbbCartProductsContainerHeaderLabel);

            gbbCartProductsContainerBody.append(gbbCartModalProductsContainer);

            let checkoutButtonText = gbb?.settings?.languageData?.general?.checkoutButtonText?.value || "Checkout";

            if (gbb.settings.app.redirectToCartEnabled && !gbb.settings.app.redirectToCheckoutEnabled) {
                checkoutButtonText = gbb?.settings?.languageData?.general?.addToCartButtonText?.value || "Add to Cart";
            }
            const gbbUnavailableProductsModalFooter = gbb.$("<div>").addClass("gbbUnavailableProductsModalFooter");
            const gbbUnavailableProductsModalFooterBackBtn = gbb.$("<div>").addClass("gbbUnavailableProductsModalFooterBackBtn");
            gbbUnavailableProductsModalFooterBackBtn.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.backButtonText) || "Back to Bundle")
            gbbUnavailableProductsModalFooterBackBtn.css("background", gbb.settings.pageCustomizationData.cartFooter.cartFooterBackButtonColor);
            gbbUnavailableProductsModalFooterBackBtn.css("color", gbb.settings.pageCustomizationData.cartFooter.cartFooterBackButtonTextColor);
            gbbUnavailableProductsModalFooterBackBtn.on("click", async () => {
                gbbUnavailableProductsModalFooterBackBtn.addClass("gbbDisabled")
                gbbUnavailableProductsModalFooterCheckoutBtn.addClass("gbbDisabled")
                let removeProducts = await gbb.utility.removeAlreadyAddedProductsFromShopifyCart();
                gbbUnavailableProductsModalFooterBackBtn.removeClass("gbbDisabled")
                gbbUnavailableProductsModalFooterCheckoutBtn.removeClass("gbbDisabled")
                if (removeProducts) {
                    gbb.$("body").find(".gbbUnavailableProductsMainContainer").remove()
                }
                gbb.$("body").find(".gbbSummaryPageCheckoutButton").removeClass("gbbDisabled")

                gbb.$("body").find(".gbbSummaryPageCheckoutButton").text(checkoutButtonText);
                gbb.$("body").find(".gbbSummaryPageCreateNewBoxButton").removeClass("gbbDisabled")
            })

            const gbbUnavailableProductsModalFooterCheckoutBtn = gbb.$("<div>").addClass("gbbUnavailableProductsModalFooterCheckoutBtn");
            gbbUnavailableProductsModalFooterCheckoutBtn.text(checkoutButtonText)
            gbbUnavailableProductsModalFooterCheckoutBtn.css("background", gbb.settings.pageCustomizationData.summaryBlock.summaryBlockAddToCartButtonColor)
            gbbUnavailableProductsModalFooterCheckoutBtn.css("color", gbb.settings.pageCustomizationData.summaryBlock.summaryBlockAddToCartButtonTextColor)
            gbbUnavailableProductsModalFooterCheckoutBtn.on("click", async (event) => {
                event.preventDefault();
                event.stopPropagation();
                gbbUnavailableProductsModalFooterBackBtn.addClass("gbbDisabled")
                gbbUnavailableProductsModalFooterCheckoutBtn.addClass("gbbDisabled")
                gbbUnavailableProductsModalFooterCheckoutBtn.text(gbb.settings.languageData.general?.loadingCheckoutButtonText?.value || "Loading ...1")
                await gbb.utility.applyDiscountOnCheckout();
                gbb.gbbBrowser.clearCartDataFromSessionStorage();
                setTimeout(() => {
                    gbb.$("body").find(".gbbUnavailableProductsMainContainer").remove()
                }, 5000)
                await gbb.utility.loadCheckoutPage();
            })

            gbbUnavailableProductsModalFooter.append(gbbUnavailableProductsModalFooterBackBtn);
            gbbUnavailableProductsModalFooter.append(gbbUnavailableProductsModalFooterCheckoutBtn);

            const gbbUnavailableProductsModalDiscountsMayNotApplyText = gbb.$("<div>").addClass("gbbUnavailableProductsModalDiscountsMayNotApplyText");
            gbbUnavailableProductsModalDiscountsMayNotApplyText.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.discountsMayNotApplyText) || "discounts may not be applied")

            gbbUnavailableProductsContainerModal.append(gbbCartProductsContainerHeader);
            gbbUnavailableProductsContainerModal.append(gbbCartProductsContainerBody);
            gbbUnavailableProductsContainerModal.append(gbbUnavailableProductsModalFooter);
            gbbUnavailableProductsContainerModal.append(gbbUnavailableProductsModalDiscountsMayNotApplyText);


            gbbUnavailableProductsMainContainer.append(gbbUnavailableProductsContainerModal);
            gbb.$("body").append(gbbUnavailableProductsMainContainer);
            gbb.f.applyFontToUnavailableProductsPopup();
        },

        handleBackButtonReload : function () {
            try {
                window.addEventListener("pageshow", function (event) {
                    var historyTraversal = event.persisted ||
                        (typeof window.performance != "undefined" &&
                            window.performance.navigation.type === 2);
                    if (historyTraversal) {
                        // Handle page restore.
                        //or just move the user to the first page of the app
                        // alert("historyTraversal")
                        //   gbb.gbbBrowser.redirectToFirstProductPage();
                        window.location.reload();
                    }
                });
            } catch (err) {
                gbb.utility.debugConsole("error inside handleBackButtonReload", err);
            }
        },

        renderActivatePricingPopup: function () {
            try {
                const gbbActivatePricingMainContainer = gbb.$("<div>").addClass("gbbActivatePricingMainContainer");
                const gbbActivatePricingContainerModal = gbb.$("<div>").addClass("gbbActivatePricingContainerModal");

                const gbbActivatePricingHeader = gbb.$("<div>").addClass("gbbActivatePricingHeader");
                const headerHtml = "<span>Oops! Seems like the bundle plan <br/> isn't setup correctly!</span>";
                gbbActivatePricingHeader.html(headerHtml);

                const gbbActivatePricingDescription = gbb.$("<div>").addClass("gbbActivatePricingDescription");
                const descriptionHtml = "<span>Please contact the merchant to complete <br/> your bundle purchase.</span>";
                gbbActivatePricingDescription.html(descriptionHtml);

                const gbbActivatePricingImgContainer = gbb.$("<div>").addClass("gbbActivatePricingImgContainer");
                const gbbActivatePricingImg = gbb.$("<img>").addClass("gbbActivatePricingImg").attr("src", "https://gift-box-builder-app4.s3.us-east-2.amazonaws.com/public/icons/activate_pricing_popup_image.png");

                const gbbActivatePricingButtonContainer = gbb.$("<div>").addClass("gbbActivatePricingButtonContainer");
                const gbbActivatePricingButton = gbb.$("<button>").addClass("gbbActivatePricingButton");
                gbbActivatePricingButton.text('Complete the setup');
                gbbActivatePricingButtonContainer.append(gbbActivatePricingButton);

                gbbActivatePricingButton.on("click", async () => {
                    window.open(`https://${gbb?.settings?.merchantInfo?.shopName}/admin/apps/10b4272bede142b02924feec498b4009/pricing`, "_blank");
                })

                const gbbActivatePricingPoweredByContainer = gbb.$("<div>").addClass("gbbActivatePricingPoweredByContainer");
                const poweredByLabelHtml = "<span>✨Powered by <b>EasyBundles</b>✨</span>";
                gbbActivatePricingPoweredByContainer.html(poweredByLabelHtml);

                const gbbActivatePricingNoteContainer = gbb.$("<div>").addClass("gbbActivatePricingNoteContainer");
                const noteLabelHtml = "<span>NOTE: Once the pricing is activated, refresh this page.</span>";
                gbbActivatePricingNoteContainer.html(noteLabelHtml);

                gbbActivatePricingImgContainer.append(gbbActivatePricingImg);
                gbbActivatePricingContainerModal.append(gbbActivatePricingImgContainer);
                gbbActivatePricingContainerModal.append(gbbActivatePricingHeader);
                gbbActivatePricingContainerModal.append(gbbActivatePricingDescription);
                gbbActivatePricingContainerModal.append(gbbActivatePricingButtonContainer);
                gbbActivatePricingContainerModal.append(gbbActivatePricingNoteContainer);
                gbbActivatePricingContainerModal.append(gbbActivatePricingPoweredByContainer);
                gbbActivatePricingMainContainer.append(gbbActivatePricingContainerModal);
                gbb.$("body").append(gbbActivatePricingMainContainer);

            } catch (err) {
                gbb.utility.debugConsole("error inside renderActivatePricingPopup", err);
            }
        },

        handleCheckoutClick: async function () {
            try {
                // if(gbb.utility.checkIfBrandingShouldBeVisible('checkout')) {
                //     gbb.utility.renderActivatePricingPopup();
                //     return;
                // }
                gbb.gbbBrowser.emitCustomEvent({
                    eventName: "gbb-checkout-initiated",
                })
                gbb.utility.handleBackButtonReload();

                await gbb.utility.removeZeroPriceBoxes();
                let cartData = gbb.gbbBrowser.getCartDataFromSessionStorage();
                if (!cartData || Object.keys(cartData?.boxes)?.length == 0) {
                    await gbb.utility.loadCheckoutPage();
                    return;
                }
                let isGiftMessageVirtualProduct = gbb.settings.bundleSettings?.isGiftMessageVirtualProduct || false;
                if (isGiftMessageVirtualProduct) {
                    // giftMessageNotAsProduct
                    // remove giftMessageProduct from cartData, and create a new array for it
                    // save this new cartData in session storage
                    // save new array with giftMessage in state
                    gbb.gbbPersonalizePage.f.removeGiftMessageFromSessionStorage(cartData);
                }

                gbb.utility.renderPreparingBundleModal();

                let addGiftMessageToNote = gbb.settings.app.addGiftMessageToNote;

                setTimeout(() => {
                    gbb.$("body").find(".gbbPreparingBundleMainContainer").remove()
                }, 6000)
                let addToCartResult = await gbb.gbbBrowser.addItemsToCart();


                if (addGiftMessageToNote) {
                    let getUpdatedCart = await gbb.shopifyUtility.getCart();
                    let messageToAppend = gbb.utility.extractGiftMessageFromCartItems(getUpdatedCart);
                    await gbb.shopifyUtility.updateCart({ note: messageToAppend })
                }

                
                // setTimeout(() => {
                //     // gbb.utility.renderPreparingBundleModal();
                //     gbb.$("body").find(".gbbPreparingBundleMainContainer").remove()
                // }, 1000)


                if (addToCartResult.data) {
                    await gbb.utility.applyDiscountOnCheckout();
                    gbb.gbbBrowser.clearCartDataFromSessionStorage();
                    setTimeout(() => {
                    // gbb.utility.renderPreparingBundleModal();
                        gbb.$("body").find(".gbbPreparingBundleMainContainer").remove()
                    }, 1000)
                    await gbb.utility.loadCheckoutPage();
                    gbb.gbbBrowser.emitCustomEvent({
                        eventName: "gbb-checkout-success",
                    })
                } else if (!addToCartResult.data && addToCartResult?.failedProductsArr?.length > 0) {
                    //failedProductsArr
                    gbb.utility.renderTemporaryLoadingSpinner("hide")
                    gbb.$("body").find(".gbbPreparingBundleMainContainer").remove()
                    await gbb.utility.renderUnavaibleProductsModal(addToCartResult.failedProductsArr);
                    gbb.gbbBrowser.emitCustomEvent({
                        eventName: "gbb-checkout-failed",
                        detail: {
                            failedProducts: addToCartResult.failedProductsArr
                        }
                    })
                }
                // else {
                //     await gbb.utility.loadCheckoutPage();
                // }

                

            } catch (err) {
                gbb.utility.debugConsole("error inside handleCheckoutClick:", err);
            }
        },

        applyDiscountOnCheckout: async function () {
            try {
                let cartData = gbb.gbbBrowser.getCartDataFromSessionStorage();
                if (gbb.gbbDiscountComponent.state.isAtleastOneDiscountActive) {
                    await gbb.utility.getDynamicDiscountCode()
                    // await gbb.utility.updateCart({ attributes: { ["gbbDiscountCode"]: gbb.gbbDiscountComponent.state.discountCode} });
                }
                cartData.attributes = {
                    ...cartData.attributes,
                    // "gbbDiscountCode": gbb.gbbDiscountComponent.state.isAtleastOneDiscountActive.discountCode
                    // "gbbDiscountCode":  gbb.gbbDiscountComponent.state.discountCode
                }

                cartData.attributes[`gbbDiscountCode-${gbb.state.bundleName}`] = gbb.gbbDiscountComponent.state.discountCode

                // updateCartAttributes
                if (cartData.attributes) {
                    await gbb.shopifyUtility.updateCart({ attributes: cartData.attributes });
                    gbb.gbbBrowser.emitCustomEvent({
                        eventName: "gbb-bundle-discount-applied",
                    })
                }
            } catch (err) {
                gbb.utility.debugConsole("err inside applyDiscountOnCheckout:", err);
            }
        },
        extractGiftMessageFromCartItems: function (updatedCart) {
            try {
                let cartItems = updatedCart.items;
                // gbb.utility.debugConsole("cartItems", cartItems)
                let messagesPresentInCart = [];
                let messageToAppend = "";
                let isGiftMessageVirtualProduct = gbb.settings.bundleSettings?.isGiftMessageVirtualProduct || false;
                // decision on giftMessageAsProduct
                if (!isGiftMessageVirtualProduct) {
                    for (let i = 0; i < cartItems.length; i++) {
                        let item = cartItems[i];
                        // go deep and check if there are properties to the product
                        // if there is a property, then check if it has a gift message
                        // properties.Message
                        if (item.properties && item.properties.Message) {
                            messagesPresentInCart.push({ "Box ID": item.properties["Box ID"], "Message": item.properties.Message, "To": item.properties["Recipient Name"], "From": item.properties["Sender Name"] })
                        }
                    }

                }

                if (isGiftMessageVirtualProduct) {

                    let items = gbb.state.giftMessageProductInActiveSession || [];
                    if (items) {
                        messagesPresentInCart = items;
                    }

                    // from notes
                    let existingCartNotes = updatedCart?.note || "";
                    messageToAppend += existingCartNotes;
                }

                //sort the messagesPresentInCart by Box ID
                messagesPresentInCart = messagesPresentInCart.sort((a, b) => {
                    return a["Box ID"] - b["Box ID"]
                })
                //now append the message with a ":" separator in between

                if (messageToAppend != "" && messagesPresentInCart.length > 0) {
                    messageToAppend += "|| "
                }

                for (let i = 0; i < messagesPresentInCart.length; i++) {
                    let item = messagesPresentInCart[i];
                    // messageToAppend += `${item["Box ID"]}: ${item.Message} | `

                    if (isGiftMessageVirtualProduct) { // condition for gift message not as product
                        // has a bug, which says same box ID
                        // if(item['Box ID']){
                        //     messageToAppend += `Box Id: ${item["Box ID"]}\n`
                        // }
                        if (item["Bundle Name"]) {
                            messageToAppend += `Bundle Name: ${item["Bundle Name"]}\n`
                        }
                    }

                    if (item.To) {
                        messageToAppend += `To ${item.To},\n`
                    }

                    messageToAppend += `${item.Message}.`

                    if (item.From) {
                        messageToAppend += `\nFrom ${item.From}.`
                    }


                    if (i != messagesPresentInCart.length - 1 && messagesPresentInCart.length > 1) {
                        messageToAppend += `|| `
                    }

                }

                return messageToAppend;
            } catch (err) {
                gbb.utility.debugConsole("error inside extractGiftMessageFromCartItems", err);
            }
        },
        isElementVisible: function (element) {
            try {
                const vanillaJsElement = gbb.$(element)[0];
                if (!vanillaJsElement) {
                    return false;
                }
                const rect = vanillaJsElement.getBoundingClientRect();
                // gbb.utility.debugConsole("isElementVisible rect", rect)
                const viewHeight = Math.max(document.documentElement.clientHeight, window.innerHeight);
                // gbb.utility.debugConsole("isElementVisible viewheight",viewHeight)
                return !(rect.bottom < 0 || rect.top - viewHeight >= 0);
            } catch (err) {
                gbb.utility.debugConsole("error inside isElementVisible", err);
            }
        },
        removeFirstCharacterIfUnderscore: function (str) {
            try {
                if (str.charAt(0) === '_') {
                    str = str.slice(1);
                }
                return str;
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        returnOnlyAdminSelectedVariantOptions: function (product) {
            try {
                let result = [];
                const validValues = new Set();
                for (const variant of product?.variants) {
                    if (variant?.option1) {
                        validValues.add(variant.option1);
                    }
                    if (variant?.option2) {
                        validValues.add(variant.option2);
                    }
                    if (variant?.option3) {
                        validValues.add(variant.option3);
                    }
                }
                gbb.utility.debugConsole("validValues:", validValues);
                for (let i = 0; i < product?.options?.length; i++) {
                    let option = product?.options[i];
                    if (option) {
                        gbb.utility.debugConsole("option:", option);
                        const invalidValues = [];
                        for (let j = 0; j < option?.values?.length; j++) {
                            let value = option?.values[j] || "";
                            if (value && !validValues.has(value)) {
                                invalidValues.push(value);
                            }
                            gbb.utility.debugConsole("invalid values:", invalidValues)
                        }
                        product.options[i].values = product?.options[i]?.values?.filter((value) => !invalidValues.includes(value));
                    }
                }
                result = product.options;
                return result;
            } catch (err) {
                gbb.utility.debugConsole(err)
            }
        },
        convertFromStoreCurrencyToCustomer: function (amount) {
            try {
                let activeCurrencyRate = gbb.utility.getActiveCurrencyRate();
                let convertedAmount = parseFloat(amount * activeCurrencyRate).toFixed(2);
                return convertedAmount;
            } catch (err) {
                gbb.utility.debugConsole(err)
            }
        },
        convertFromCustomerCurrencyToStore: function (amount) {
            try {
                let activeCurrencyRate = gbb.utility.getActiveCurrencyRate();
                let convertedAmount = parseFloat(amount / activeCurrencyRate).toFixed(2);
                return convertedAmount;
            } catch (err) {
                gbb.utility.debugConsole(err)
            }
        },
        removeZeroPriceBoxes: async function () {
            try {
                let cartData = gbb.gbbBrowser.getCartDataFromSessionStorage();
                for (const boxId in cartData.boxes) {
                    const box = cartData.boxes[boxId];
                    if (box.total_price == 0) {
                        await gbb.gbbBrowser.clearRelevantBoxFromSessionStorage(boxId);
                    }
                }
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        removeIframeTagsFromHtml: function (html) {
            try {
                let parser = new DOMParser();
                let doc = parser?.parseFromString(html, 'text/html');
                let iframeElements = doc?.getElementsByTagName('iframe');
                if (!iframeElements || iframeElements.length === 0) {
                    return html; // No <video> tags found, return the original HTML
                }
                for (let i = iframeElements.length - 1; i >= 0; i--) {
                    let iframeElement = iframeElements[i];
                    iframeElement.parentNode.removeChild(iframeElement);
                }
                let modifiedHtml = new XMLSerializer().serializeToString(doc);
                return modifiedHtml;
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        adjustImageTagsInProductDescriptionHtml: function (html) {
            try {
                const parser = new DOMParser();
                const doc = parser?.parseFromString(html, 'text/html');

                const imgElements = doc?.getElementsByTagName('img');
                if (!imgElements || imgElements.length === 0) {
                    return html; // No <img> tags found, return the original HTML
                }

                for (let i = 0; i < imgElements.length; i++) {
                    const imgElement = imgElements[i];
                    imgElement.setAttribute('width', '100px');
                    imgElement.setAttribute('height', '100px');
                    imgElement.style.objectFit = 'contain';
                }

                const modifiedHtml = new XMLSerializer().serializeToString(doc);
                return modifiedHtml;
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        getNewImageAndMediaObjectWhenOnlyOneVariant: function (product) {
            // return an object know as newFeaturedImage, newMedia,newImages
            try {
                //setting defaults
                let newFeaturedImage = product?.featured_image;
                let newMedia = product.media
                let newImages = product?.images;
                let theresAnImageOrMediaToVariant = product.variants[0]?.image || product.variants[0]?.featured_media?.id || product.variants[0]?.featured_media?.src ? true : false;
                if (product?.variants?.length === 1 && theresAnImageOrMediaToVariant) {
                    //reset the featured image to this variant's featured image
                    newFeaturedImage = product?.variants[0]?.image || product.variants[0]?.featured_image?.src;
                    // change the order of the media but mapping the src to the variant's featured image
                    let indexofNewImage = product?.media.findIndex((media) => media?.src === newFeaturedImage);
                    if (indexofNewImage > -1) {
                        // shuffle the array, so that the ovject with the new featured image is at the front of the array]
                        newMedia = product?.media;
                        let newMediaObject = newMedia.splice(indexofNewImage, 1)[0];
                        newMedia.unshift(newMediaObject);
                    }

                    // change the order of the images but mapping the src to the variant's featured image
                    indexOfImageInImagesArr = product?.images.findIndex((image) => newFeaturedImage.includes(image));
                    if (indexOfImageInImagesArr > -1) {
                        newImages = product?.images;
                        // newImages[indexOfImageInImagesArr] = product?.variants[0]?.image;
                        // unshift the new featured image to the front of the array
                        newImages.unshift(newFeaturedImage);
                    }
                }
                return {
                    newFeaturedImage,
                    newMedia,
                    newImages
                }

            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        isCategoryOpen: function (categoryId) {
            try {
                // Get the parent element
                const parentElement = gbb.$(".gbbCategoryBodyContainer" + categoryId);

                // Check if it exists and has children
                if (parentElement.length > 0) {
                    // Check if gbbProductsContainer is one of the children
                    const gbbProductsItemsContainer = parentElement.find(".gbbProductsItemsContainer");

                    if (gbbProductsItemsContainer.length > 0) {
                        // gbbProductsContainer is not empty
                        gbb.utility.debugConsole("category is open")
                        return true;
                    } else {
                        // gbbProductsContainer is empty
                        gbb.utility.debugConsole("category is not open")
                        return false;
                    }
                } else {
                    // The parent element doesn't exist or has no children
                    gbb.utility.debugConsole("couldnt find category")
                    return false;
                }
            } catch (err) {
                gbb.utility.debugConsole(err, "error in isCategoryOpen");
            }
        },
        convertToGrams: function (weight, weightUnit) {
            try {
                let weightInGrams = 0;
                let weightValue = JSON.parse(JSON.stringify(weight))
                switch (weightUnit) {
                    case "kg":
                    case "KILOGRAMS":
                        weightInGrams = weightValue * 1000;
                        break;
                    case "g":
                    case "GRAMS":
                        weightInGrams = weightValue;
                        break;
                    case "lb":
                    case "POUNDS":
                        weightInGrams = weightValue * 453.592;
                        //round it off
                        weightInGrams = Math.round(weightInGrams);
                        break;
                    case "oz":
                    case "OUNCES":
                        weightInGrams = weightValue * 28.3495;
                        //round it off
                        weightInGrams = Math.round(weightInGrams);
                        break;
                    default:
                        weightInGrams = weightValue;
                        break;
                }
                return weightInGrams;
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        getCurrentProductPersonalization: function (product) {
            try {
                let isProductPersonalizationEnabled = gbb?.gbbAddProductsPage?.state?.productPersonalizationMap && gbb.gbbAddProductsPage.state.productPersonalizationMap[product.id] ? true : false;
                // gbb.gbbAddProductsPage.state.productPersonalizationData
                let productPersonalizationData = gbb?.gbbAddProductsPage?.state?.productPersonalizationMap && gbb.gbbAddProductsPage.state.productPersonalizationMap[product.id] ? gbb.gbbAddProductsPage.state.productPersonalizationMap[product.id] : {};
                return {
                    isProductPersonalizationEnabled,
                    productPersonalizationData
                }
            } catch (err) {
                gbb.utility.debugConsole(err);
            }
        },
        getRegionalLocaleFromUrl: function () {
            let localePresentInUrl = window.location.pathname.split("/") || "";
            // now get locale from Shopify.locale   
            let currentShopifyLocale = Shopify.locale || "";

            let regionalLocale = "";

            if (currentShopifyLocale && currentShopifyLocale != "" && localePresentInUrl) {
                // check if both are same
                if (currentShopifyLocale == localePresentInUrl[1]) {
                    regionalLocale = `/${currentShopifyLocale}`
                } else {
                }
            }

            return regionalLocale;
        },
        debugConsole: function (...messages) {
            try {
                let flag = gbb.state.CONSTANT_DEBUG_FLAG;
                if (flag == false) {
                    return;
                }
                if (flag == true) {
                    for (let message of messages) {
                        console.log(message);
                    }
                    return;
                }
                let isDebug = localStorage.getItem("debug");
                if (isDebug) {
                    for (let message of messages) {
                        console.log(message);
                    }
                    gbb.state.CONSTANT_DEBUG_FLAG = true
                } else {
                    gbb.state.CONSTANT_DEBUG_FLAG = false
                }
            } catch (err) {
                console.error('error inside debugConsole ->', err)
            }
        },
        debugError: function (...messages) {
            try {
                let flag = gbb.state.CONSTANT_DEBUG_FLAG;
                if (flag == false) {
                    return;
                }
                if (flag == true) {
                    for (let message of messages) {
                        console.error(message);
                    }
                    return;
                }
                let isDebug = localStorage.getItem("debug");
                if (isDebug) {
                    gbb.state.CONSTANT_DEBUG_FLAG = true;
                    for (let message of messages) {
                        console.error(message);
                    }
                } else {
                    gbb.state.CONSTANT_DEBUG_FLAG = false
                }
            } catch (err) {
                console.error('error inside the debugError function ->', err)
            }
        },
        gbbMultiLangOverrider: function () {
            try {
                let languageMode = gbb.state.languageMode;
                let languageData = gbb.utility.getLocale();
                if (languageMode != "SINGLE") {

                    gbb.utility.gbbMultiLangDiscountOverrider(languageData)
                    gbb.utility.gbbMultiLangBundleDataOverriding(languageData)
                    gbb.utility.gbbMultiLangPersonalizationOverrider(languageData)
                    gbb.utility.gbbMultiLangSummaryPageOverrider(languageData);
                }
            } catch (error) {
                gbb.utility.debugError("error in gbbMultiLangOverrider", error)
            }
        },
        gbbMultiLangDiscountOverrider: function (languageData) {
            try {
                if (gbb.settings.discountsData != {}) {
                    let discountsData = gbb.settings.discountsData;
                    if (discountsData.multiLangData.hasOwnProperty(languageData)) {
                        discountsData.discountTextBody = discountsData.multiLangData[languageData].discountTextBody;
                        discountsData.discountTextForSuccess = discountsData.multiLangData[languageData].discountTextForSuccess || "";
                    }
                }
            } catch (error) {
                gbb.utility.debugError("error in gbbMultiLangDiscountOverrider", error);
            }
        },
        gbbMultiLangBundleDataOverriding: function (languageData) {
            try {
                let stepsConfigurationData = gbb.settings.stepsConfigurationData;
                for (const key in stepsConfigurationData) {
                    if (key.startsWith("productsData")) {
                        const productData = stepsConfigurationData[key];
                        if (productData && productData.multiLangData && productData?.multiLangData.hasOwnProperty(languageData)) {
                            productData.productPageStepText = productData.multiLangData[languageData].productPageStepText;
                            productData.productPageSubtext = productData.multiLangData[languageData].productPageSubtext;
                        }
                        // Iterate over categories and update titles
                        if (productData && productData.categories) {
                            for (const categoryKey in productData.categories) {
                                const category = productData.categories[categoryKey];
                                if (category.multiLangData && category.multiLangData.hasOwnProperty(languageData)) {
                                    category.title = category.multiLangData[languageData].categoryTitle;
                                    category.subTitle = category.multiLangData[languageData].categorySubtitle;
                                }
                            }
                        }
                    }
                }

            } catch (error) {
                gbb.utility.debugError("error in gbbMultiLangBundleDataOverriding", error);
            }
        },
        gbbMultiLangPersonalizationOverrider: function (languageData) {
            try {
                let personalizationData = gbb.settings.stepsConfigurationData.personalizationData;
                //stepsConfigurationData?.personalizationData?.personalizeStepText
                if (personalizationData && personalizationData.isPersonalizationEnabled && personalizationData.multiLangData && personalizationData?.multiLangData.hasOwnProperty(languageData) || false) {
                    personalizationData.personalizeStepText = personalizationData.multiLangData[languageData].personalizeStepText;
                    personalizationData.personalizePageSubtext = personalizationData.multiLangData[languageData].personalizePageSubtext;
                }

            } catch (error) {
                gbb.utility.debugError("error in gbbMultiLangPersonalizationOverrider", error);
            }
        },
        gbbMultiLangSummaryPageOverrider: function (languageData) {
            try {
                let summaryPageData = gbb.settings.stepsConfigurationData.summaryPageData;
                // gbb.settings?.stepsConfigurationData?.summaryPageData
                //stepsConfigurationData?.summaryPageData?.personalizeStepText
                if (summaryPageData && summaryPageData.isSummaryPageEnabled && summaryPageData.multiLangData && summaryPageData?.multiLangData.hasOwnProperty(languageData) || false) {
                    // reviewPageBannerSubtext
                    // : 
                    // "Review your bundle and proceed to checkout ar"
                    // reviewPageBannerText
                    // : 
                    // "You’ve made the  Right Choice! ar"
                    // reviewPageEmptyStateBannerButtonText
                    // : 
                    // "Go back to the bundle flow"
                    // reviewPageEmptyStateBannerSubText
                    // : 
                    // ""
                    // reviewPageEmptyStateBannerText

                    summaryPageData.reviewPageBannerSubtext = summaryPageData.multiLangData[languageData].reviewPageBannerSubtext;
                    summaryPageData.reviewPageBannerText = summaryPageData.multiLangData[languageData].reviewPageBannerText;
                    summaryPageData.reviewPageEmptyStateBannerButtonText = summaryPageData.multiLangData[languageData].reviewPageEmptyStateBannerButtonText;
                    summaryPageData.reviewPageEmptyStateBannerSubText = summaryPageData.multiLangData[languageData].reviewPageEmptyStateBannerSubText;
                    summaryPageData.reviewPageEmptyStateBannerText = summaryPageData.multiLangData[languageData].reviewPageEmptyStateBannerText;



                }

            } catch (error) {
                gbb.utility.debugError("error in gbbMultiLangPersonalizationOverrider", error);
            }
        },
        groupCartDataBasedOnId_and_Properties: function (items) {
            try {
                function consolidateProducts(products) {
                    const consolidated = [];

                    // Function to check if two properties objects are the same
                    function arePropertiesEqual(props1, props2) {
                        const keys1 = Object.keys(props1);
                        const keys2 = Object.keys(props2);
                        if (keys1.length !== keys2.length) return false;
                        return keys1.every(key => props1[key] === props2[key]);
                    }

                    // Iterate through each product in the input array
                    products.forEach(product => {
                        // Find an existing product in the consolidated array that matches the current product
                        // const existingProduct = consolidated.find(consProduct =>
                        //     consProduct.id === product.id && arePropertiesEqual(consProduct.properties, product.properties)
                        // );

                        // check if products have properties
                        let existingProduct;
                        if (product.properties && Object.keys(product.properties).length > 0) {
                            existingProduct = consolidated.find(consProduct =>
                                consProduct.id === product.id && arePropertiesEqual(consProduct.properties, product.properties));
                        } else {
                            existingProduct = consolidated.find(consProduct => consProduct.id === product.id);
                        }






                        if (existingProduct) {
                            // If found, add the quantity of the current product to the existing one
                            existingProduct.quantity += product.quantity || 1;
                        } else {
                            // If not found, add the current product to the consolidated array
                            consolidated.push({ ...product });
                        }
                    });

                    return consolidated;
                }

                // Example usage
                const products = JSON.parse(JSON.stringify(items));
                const result = consolidateProducts(products);
                // return 
                // console.log(consolidatedProducts);
                return result;
            } catch (e) {
                gbb.utility.debugConsole("error occured in groupCartDataBasedOnId_and_Properties", e)
                return items;
            }

        },
        debounceWrapper: function (callbackFn, delay = 500) {
            gbb.utility.debugConsole('INSIDE DEBOUNCE WRAPPER');
            let timeoutId;
            let lastResult;

            return function (...args) {
                if (timeoutId) {
                    clearTimeout(timeoutId);
                }

                return new Promise((resolve, reject) => {
                    timeoutId = setTimeout(() => {
                        try {
                            lastResult = callbackFn.apply(this, args);
                            resolve(lastResult);
                        } catch (error) {
                            reject(error);
                        }
                    }, delay);
                });
            }
        },
        allowATCBasedOnProductInventory: function (variantId, quantityToAdd = 1) {
            try {
                let qtyAlreadyInCart = 0;
                let cartData = gbb.state?.giftBoxCartData?.items || []
                let isATCAllowed = true
                let originForVariantDetails = gbb.state.currentPageId == 'personalizationPage' ? "addonProducts": null
                let variantDetails = gbb.utility.getVariantDetailsFromCurrentProductsDataSet(variantId, originForVariantDetails) || null
                if (!variantDetails) {
                    gbb.utility.debugConsole("variant details not found : allowATCBasedOnProductInventory")
                    isATCAllowed = false
                    return isATCAllowed;
                }
                if (variantDetails.currentlyNotInStock) { // digital product
                    isATCAllowed = true
                    return isATCAllowed
                }
                // check if variant present alreadyInCart
                if (cartData.length > 0) {
                    for (let i = 0; i < cartData.length; i++) {
                        if (cartData[i].id == variantId) {
                            qtyAlreadyInCart += cartData[i].quantity;
                        }
                    }
                }
                let totalQty = qtyAlreadyInCart + quantityToAdd;
                if (totalQty > variantDetails.quantityAvailable) {
                    isATCAllowed = false
                    return isATCAllowed
                }

                return isATCAllowed

            } catch (error) {
                gbb.utility.debugConsole("error in allowATCBasedOnProductInventory", error)
            }
        },
        isCurrentActiveVariantAllowedToAdd: function ({ product, selectedVariantsCombination, variantQuantity }) {
            try {
                let activeVariantInfo = gbb.utility.checkIfSelectedVariantCombinationIsAvailable(product, selectedVariantsCombination);
                let variantId = activeVariantInfo[0]?.id;
                let isInventoryAvailable = gbb.utility.allowATCBasedOnProductInventory(variantId, variantQuantity);
                return isInventoryAvailable
            } catch (error) {
                gbb.utility.debugConsole("error in isCurrentActiveVariantAllowedToAdd", error)
            }
        },
        validateProductQuantityAddButton: function ({ product, selectedVariantsCombination, variantQuantity, gbbProductQuantityAddButton }) {
            try {
                let isInventoryAvailable = gbb.utility.isCurrentActiveVariantAllowedToAdd({ product, selectedVariantsCombination, variantQuantity });
                if (isInventoryAvailable != true) {
                    gbbProductQuantityAddButton.addClass("gbbVariantInventoryNotAvailable")
                    gbbProductQuantityAddButton.addClass("gbbDisabled")
                } else if (
                    isInventoryAvailable == true &&
                    gbbProductQuantityAddButton.hasClass("gbbVariantInventoryNotAvailable")
                ) {
                    gbbProductQuantityAddButton.removeClass("gbbVariantInventoryNotAvailable")
                    gbbProductQuantityAddButton.removeClass("gbbDisabled")
                }
            } catch (error) {
                gbb.utility.debugConsole("error in validateProductQuantityAddButton", error)
            }
        },
        validateATCAndVariantQuantityAddButton: function ({ product, selectedVariantsCombination, variantQuantity, gbbProductQuantityAddButton, gbbProductVariantModalContainer }) {
            try {
                let validationOptions = {
                    product: product,
                    selectedVariantsCombination: selectedVariantsCombination,
                    variantQuantity: variantQuantity + gbb.gbbAddProductsPage.state.incrementProductQtyBy || 1,// adding 1 to check if we can add 1 more product or not 
                    gbbProductQuantityAddButton: gbbProductQuantityAddButton
                }
                gbb.utility.validateProductQuantityAddButton(validationOptions);
                let currentQty = variantQuantity;
                let isVariantWithCurrentQtyAllowedToAdd = gbb.utility.isCurrentActiveVariantAllowedToAdd({ ...validationOptions, variantQuantity: currentQty })
                if (isVariantWithCurrentQtyAllowedToAdd != true) {
                    gbbProductVariantModalContainer.addClass("gbbVariantInventoryNotAvailable")
                } else {
                    gbbProductVariantModalContainer.removeClass("gbbVariantInventoryNotAvailable")
                }
            } catch (error) {
                gbb.utility.debugConsole("error in validateATCAndVariantQuantityAddButton", error)
            }
        },
        extractIdsFromGraphQlId: function (id) {
            try {
                return Number(id.split("/").pop())
            } catch (error) {
                gbb.utility.debugConsole("error in extractIdsFromGraphQlId", error)
            }
        },
        generateSellingPlanGroupIdByName: function (groupName) {
            try {
                let base64Str = btoa(encodeURIComponent(groupName));
                return "EB_" + base64Str;
            } catch (error) {
                gbb.utility.debugConsole('error in generateSellingPlanGroupIdByName', error)
            }
        },
        prepareProductCardRibbonUI: function ({ ribbonContent, ribbonClassName }) {
            try {
                const gbbDiscountRibbon = gbb.$('<div>').addClass('gbbDiscountRibbon')
                if (ribbonClassName) {
                    gbbDiscountRibbon.addClass(ribbonClassName)
                }
                const gbbDiscountRibbonContent = gbb.$('<div>').addClass('gbbDiscountRibbonContent')
                if (ribbonContent) {
                    gbbDiscountRibbonContent.text(ribbonContent)
                    gbbDiscountRibbon.append(gbbDiscountRibbonContent)
                    return gbbDiscountRibbon
                }
            } catch (error) {
                gbb.utility.debugError('error in prepareProductCardRibbonUI', error)
            }
        }
    },
    shopifyUtility: {
        addToCart: async function (cartData) {
            try {
                let result = await gbb.$.ajax({
                    url: "/cart/add.js",
                    data: cartData,
                    type: "POST",
                    dataType: "json",
                })
                return result;
            } catch (error) {
                gbb.utility.debugConsole("error in shopifyUtility.addToCart", error)
                // throw error
                return false
            }
        },
        updateCart: async function (cartData) {
            try {
                let result = await gbb.$.ajax({
                    url: "/cart/update.js",
                    data: cartData,
                    type: "POST",
                    dataType: "json",
                })
                return result;
            } catch (error) {
                gbb.utility.debugConsole("error in shopifyUtility.updateCart", error)
                // throw error
                return false
            }
        },
        getCart: async function () {
            try {
                let result = await gbb.$.ajax({
                    url: "/cart.js",
                    type: "GET",
                    dataType: "json",
                })
                return result;
            } catch (error) {
                gbb.utility.debugConsole("error in shopifyUtility.getCart", error)
                // throw error
                return false
            }
        },
        changeCart: async function (data) {
            try {
                let result = await glpro.$.ajax({
                    type: "POST",
                    url: "/cart/change.js",
                    data: data,
                    dataType: "json",
                });
                return true
            } catch (error) {
                gbb.utility.debugError("glpro-utility-changeCart");
                gbb.utility.debugError(error);
                return false
            }
        },
    },
    graphQlUtility: {
        graphQlAPIWrapper: async function (query, variables) {
            try {
                let shopDomain = window.Shopify.shop;
                let storefrontAccessToken = gbb.state.storefrontAccessToken || gbb.settings.STOREFRONT_ACCESS_TOKEN;

                // debugger;
                // if (gbb.state.cachedProductDataGraphql.has(variables.ids[0])){
                //     return gbb.state.cachedProductDataGraphql.get(variables.ids[0]);
                // }

                const res = await fetch(`https://${shopDomain}/api/2023-10/graphql.json`, {
                    // const res = await fetch(`https://gift-kart-test-01.myshopify.com/api/2024-01/graphql.json`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Shopify-Storefront-Access-Token': storefrontAccessToken,
                    },
                    body: JSON.stringify({ query, variables }),
                })



                const data = await res.json();
                return data;

            } catch (error) {
                gbb.utility.debugConsole("error in graphQlAPIWrapper =>", error);
            }
        },
        gbbCleaningAndArrangingData: function (data) {
            try {
                let cleanedData = gbb.graphQlUtility.flattenGraphQLResponse(data);
                gbb.utility.debugConsole("cleanedData before processing =========>:", cleanedData);

                // remove null, undefined and missing values from the array
                cleanedData = cleanedData.filter(item => item != null && item != undefined);

                cleanedData = gbb.graphQlUtility.dataMappingFromGraphQL(cleanedData);

                return cleanedData;
            } catch (err) {
                gbb.utility.debugConsole("err in gbbCleaningAndArrangingData => ", err);
            }
        },
        dataMappingFromGraphQL: function (cleanedData) {
            try {

                const convertPlanNameToId = (planName) => {
                    let base64Str = btoa(encodeURIComponent(planName));
                    let id = "EB_" + base64Str;
                    return id;
                }

                const getAllMetafieldValuesInArray = (productData) => {
                    // productData.forEach(node => {
                    const metafields = [];
                    Object.keys(productData).forEach(key => {
                        if (key.startsWith('metafield_')) {
                            metafields.push(productData[key]);
                        }
                    });
                    return metafields;
                }

                const transformSellingPlans = (sellingPlanGroups) => {

                    let sellingPlanGroupsFlattened = []

                    let tempArray = []
                    let flattendData = gbb.graphQlUtility.flattenGraphQLResponse({ data: { nodes: sellingPlanGroups } });
                    tempArray = flattendData.map(item => {
                        return {
                            id: convertPlanNameToId(item.name),
                            name: item.name,
                            description: null,
                            options: item.options.map((option, index) => ({
                                name: option.name,
                                position: index + 1,
                                value: option.value
                            })),
                            selling_plans: item.sellingPlans?.map((plan) => {
                                return {
                                    id: parseInt(plan?.id?.split('/').pop()),
                                    gid: plan?.id,
                                    option: plan?.option,
                                    name: plan?.name,
                                    price_adjustments: plan?.priceAdjustments?.map((element, index) => {
                                        let adjustmentType = element?.adjustmentValue?.price ? 'price' : element?.adjustmentValue?.adjustmentAmount ? 'fixed_amount' : 'percentage'
                                        let _adjustmentValue = adjustmentType == 'percentage' ? element?.adjustmentValue?.adjustmentPercentage : adjustmentType == 'price' ? element?.adjustmentValue?.price?.amount : element?.adjustmentValue?.adjustmentAmount?.amount
                                        return {
                                            orderCount: element.orderCount,
                                            position: index + 1,
                                            value_type: adjustmentType,
                                            value: adjustmentType == 'percentage' ? parseFloat(_adjustmentValue) : parseFloat(_adjustmentValue) * 100
                                        }
                                    })
                                }
                            }),
                            recurring_deliveries: item.recurringDeliveries,
                        };
                    });

                    sellingPlanGroupsFlattened.push(tempArray);

                    return sellingPlanGroupsFlattened.flat();
                };
                const getSellingPlansGroupId = (sellingPlansGroup, sellingPlanId) => {
                    for (let i = 0; i < sellingPlansGroup?.length; i++) {
                        let currGroupData = sellingPlansGroup[i];
                        let foundSellingPlan = currGroupData?.selling_plans?.find((sellingPlan) => sellingPlan?.id == sellingPlanId);
                        if (foundSellingPlan) {
                            return currGroupData?.id;
                        }
                    }
                }
                const transformSellingPlanAllocation = (sellingPlanAllocations, sellingPlansGroup, variantDetails) => {
                    let response = gbb.graphQlUtility.flattenGraphQLResponse(sellingPlanAllocations);
                    response = response.map((el) => {
                        let sellingPlanId = parseInt(el?.node?.sellingPlan?.id?.split('/').pop())
                        let _price = parseFloat(variantDetails?.price?.amount) * 100 // read product's price 
                        let _per_delivery_price = _price
                        let priceAdjustmentArray = el?.node?.priceAdjustments || []
                        if (priceAdjustmentArray.length > 0) {
                            _price = parseFloat(priceAdjustmentArray[0]?.price?.amount) * 100
                            _per_delivery_price = parseFloat(priceAdjustmentArray[0]?.perDeliveryPrice?.amount) * 100
                        }
                        return {
                            compare_at_price: parseFloat(el?.node?.priceAdjustments[0]?.compareAtPrice?.amount) * 100,
                            per_delivery_price: _per_delivery_price,
                            price: _price,
                            selling_plan_id: sellingPlanId,
                            selling_plan_group_id: getSellingPlansGroupId(sellingPlansGroup, sellingPlanId) || null,
                            price_adjustments: [{ position: 1, price: _price }]
                        }
                    })
                    return response;
                };
                let newProductArray = JSON.parse(JSON.stringify(cleanedData));
                let returningArray = [];
                for (let i = 0; i < newProductArray.length; i++) {

                    let currProduct = newProductArray[i];
                    let originalProduct = cleanedData[i];

                    currProduct.available = originalProduct.availableForSale;
                    currProduct.featured_image = originalProduct?.featuredImage?.originalSrc;
                    let variantData = currProduct.variants;
                    let ogVariants = originalProduct.variants;
                    // productId
                    let splitProductId = originalProduct.id.split('/');
                    let pureProductId = parseInt(splitProductId[splitProductId.length - 1])

                    currProduct.productId = pureProductId;
                    currProduct.type = originalProduct.productType;
                    currProduct.id = pureProductId
                    currProduct.metafieldsData = getAllMetafieldValuesInArray(originalProduct);

                    currProduct.images = originalProduct?.images?.map(item => item?.originalSrc);

                    //   currProduct.media = originalProduct?.media?.map((item, index) moving to images from media coz we dont get variant media from shopify
                    currProduct.media = originalProduct?.images?.map((item, index) => {
                        return {
                            alt: item.alt,
                            computedPosition: index + 1,
                            gid: item.id,
                            id: item.id?.split('/').pop(),
                            // position: index+1, // since shopify SF Api doesnt provide position
                            src: item?.originalSrc
                        }
                    })

                    currProduct.compare_at_price = originalProduct?.compareAtPriceRange?.maxVariantPrice?.amount || originalProduct?.compareAtPriceRange?.minVariantPrice?.amount
                    currProduct.price = originalProduct?.priceRange?.maxVariantPrice?.amount || originalProduct.priceRange.minVariantPrice.amount

                    currProduct.compare_at_price = currProduct.compare_at_price > 0 ? currProduct.compare_at_price * 100 : null
                    currProduct.price = currProduct.price * 100

                    //   forEach originalProduct
                    //   let productSellingPlans = gbb.graphQlUtility.flattenGraphQLResponse(originalProduct.selling)
                    currProduct.selling_plan_groups = transformSellingPlans(originalProduct?.sellingPlanGroups)
                    // for variants
                    for (let j = 0; j < variantData.length; j++) {
                        variantData[j].available = ogVariants[j].availableForSale
                        variantData[j].image = ogVariants[j]?.image?.url || ogVariants[j]?.image?.originalSrc
                        variantData[j].price = parseFloat(variantData[j].price.amount) * 100;
                        let tempOptions = ogVariants[j]?.selectedOptions;
                        variantData[j].options = tempOptions.map(item => item.value);
                        // variantData[j].op
                        // variantData[]    
                        // derive option1,option2 and option3 values

                        if (tempOptions.length > 0) variantData[j].option1 = tempOptions[0].value;
                        if (tempOptions.length > 1) variantData[j].option2 = tempOptions[1].value;
                        if (tempOptions.length > 2) variantData[j].option3 = tempOptions[2].value;
                        // fixing variantId;
                        // variantData[j].id = variantData[j].variantId;
                        let spliVariantId = variantData[j].id.split('/');
                        let variantId = parseInt(spliVariantId[spliVariantId.length - 1])
                        variantData[j].variantId = variantId;
                        variantData[j].variant_id = variantId;
                        variantData[j].id = variantId
                        // variantData[j].public_title = (concat options by /)
                        variantData[j].public_title = tempOptions.map(item => item.value).join(' / ');
                        // publicTitle????
                        // variantData[j].name = currProduct.title +  " - " + ogVariants[j].title;
                        variantData[j].name = ogVariants[j].title == "Default Title" ? currProduct.title : currProduct.title + " - " + ogVariants[j].title;

                        variantData[j].featured_image = {
                            gid: ogVariants[j]?.image?.id,
                            id: ogVariants[j]?.image?.id?.split('/').pop(),
                            src: ogVariants[j]?.image?.originalSrc
                        }
                        variantData[j].featured_media = {
                            gid: ogVariants[j]?.image?.id,
                            id: ogVariants[j]?.image?.id?.split('/').pop(),
                            src: ogVariants[j]?.image?.originalSrc
                        }
                        variantData[j].compare_at_price = ogVariants[j].compareAtPrice ? parseFloat(ogVariants[j].compareAtPrice.amount) * 100 : null

                        variantData[j].weight = gbb.utility.convertToGrams(variantData[j].weight, variantData[j].weightUnit);
                        variantData[j].weightConvertedToGrams = true

                        variantData[j].selling_plan_allocations = transformSellingPlanAllocation(ogVariants[j]?.sellingPlanAllocations, currProduct.selling_plan_groups, ogVariants[j])



                    }
                    currProduct.variants = variantData;
                    currProduct = gbb.gbbKite.f.modifyProductDataWithDiscountedPrice(currProduct);
                    returningArray.push(currProduct);
                }

                return returningArray;

            } catch (error) {
                gbb.utility.debugConsole("error in dataMappingFromGraphQL ", error);
            }
        },
        flattenGraphQLResponse: function (response) {
            // console.log("response", response);
            const nodes = response.data ? response.data.nodes : [];
            const edges = response.edges ? response.edges : [];

            const flattenNodesOrEdges = (items) => {
                return items.map((item) => {
                    if (item) {
                        const flattenedItem = {};

                        Object.keys(item).forEach((key) => {
                            const value = item[key];
                            if (value && typeof value === "object") {
                                if (value.edges) {
                                    flattenedItem[key] = value.edges.map((edge) => edge.node);
                                } else if (value.node) {
                                    flattenedItem[key] = value.node;
                                } else {
                                    flattenedItem[key] = value;
                                }
                            } else {
                                flattenedItem[key] = value;
                            }
                        });

                        // console.log("flattenedItem", flattenedItem);
                        return flattenedItem;
                    }
                });
            };


            let flattenedNodes = []
            if (nodes.length > 0) {
                flattenedNodes = flattenNodesOrEdges(nodes);
            } else if (edges.length > 0) {
                flattenedNodes = flattenNodesOrEdges(edges);
            }

            // console.log("flattened-nodes", nodes);
            // console.log("flattened-edges", edges);


            // console.log("flattenedNodes", flattenedNodes);

            return flattenedNodes;
        },
        generateMetafieldQueries: function (metafields) {
            return metafields.map(metafield => {
                const { key, namespace } = metafield;
                return `metafield_${namespace}_${key}: metafield(key:"${key}", namespace:"${namespace}"){ 
                    id 
                    key
                    value
                    description
                    type
                }`;
            }).join(' ');
        },

        getProductsDataByIds: async function (productIds) {
            try {


                const metafields = gbb.settings.bundleSettings.metafieldNameSpaceAndKeys

                // const metafields = [
                //     { key: "test", namespace: "gbbNameSpace" },
                //     { key: "test2", namespace: "gbbNameSpace" },
                //     // Add more metafields as needed
                //     ];
                //  gbb.settings.bundleSettings.


                const metafieldQueries = gbb.graphQlUtility.generateMetafieldQueries(metafields);
                const query = `query test($ids: [ID!]!, $countryCode: CountryCode!, $languageCode: LanguageCode!) @inContext(country: $countryCode, language: $languageCode) {    
                nodes(ids: $ids) {
                ... on Product{
                  id
                  availableForSale
                  title
                  handle
                  createdAt
                  description
                  descriptionHtml
                  productType
                  ${metafieldQueries}
                  onlineStoreUrl
                  options{
                    id
                    name
                    values
                  }
                  featuredImage{
                    id
                    originalSrc
                    transformedSrc(maxWidth: 800, maxHeight: 800, crop: CENTER)
                  }
                 updatedAt
                tags
                totalInventory
                vendor
                requiresSellingPlan
                compareAtPriceRange{
                    maxVariantPrice{
                        amount
                        currencyCode
                    }
                    minVariantPrice{
                        amount
                        currencyCode
                    }
                }
                priceRange{
                    maxVariantPrice{
                        amount
                        currencyCode
                    }
                    minVariantPrice{
                        amount
                        currencyCode
                    }
                }
                media(first:100){
                    edges{
                        node{
                            id
                            alt
                            previewImage{
                                url
                                id
                            } 
                            
                        }
                    }

                }
                images(first:100){
                    edges{
                        node{
                            id
                            originalSrc
                            transformedSrc(maxWidth: 800, maxHeight: 800, crop: CENTER)
                        }
                    }
                }
                sellingPlanGroups(first: 100) {
                    edges{
                        node{
                            name
                            appName
                            options{
                                name
                                values
                            }
                            sellingPlans (first:100){
                                edges{
                                    node{
                                        id
                                        name
                                        recurringDeliveries
                                        priceAdjustments {
                                            adjustmentValue {
                                            ... on SellingPlanFixedAmountPriceAdjustment{
                                                adjustmentAmount{
                                                amount
                                                currencyCode
                                                }
                                                }
                                            ... on SellingPlanFixedPriceAdjustment{
                                                 price{
                                                    amount
                                                    currencyCode
                                                    }
                                                 }
                                            ... on SellingPlanPercentagePriceAdjustment{
                                                adjustmentPercentage
                                                }
                                            }
                                            orderCount
                                        }
                                        options{
                                            name
                                            value
                                        }

                                    }
                                }
                            }
                        }
                    }
                }
                variants(first: 100) {
                    edges {
                      node {
                        id
                        sku
                        title
                        price{
                          amount
                          currencyCode
                        }
                        weight
                        weightUnit
                        requiresShipping
                        currentlyNotInStock 
                        compareAtPrice{
                          amount
                          currencyCode
                        }
                        quantityAvailable
                        selectedOptions{
                            name
                            value
                        }
                       
                        availableForSale
                        image {
                          id
                          originalSrc
                          transformedSrc(maxWidth: 800, maxHeight: 800, crop: CENTER)
                        }
                        sellingPlanAllocations(first:100){
                            edges{
                                node{
                                     sellingPlan{
                                         id
                                         name
                                     }
                                    priceAdjustments{
                                        compareAtPrice{
                                            amount
                                            currencyCode
                                        }
                                        perDeliveryPrice{
                                            amount 
                                            currencyCode
                                        }
                                        price{
                                            amount
                                            currencyCode
                                        }
                                        unitPrice{
                                            amount
                                            currencyCode
                                        }
                                    }
                                }
                            }
                        }
                      }
                    }
                  }
                }
              }
              }`;

                
                 
                // remove the product ids that are already present
                let cachedProductData = []
                productIds = productIds.filter((id) => {
                    if (gbb.state.cachedProductDataGraphql.has(+id)) {
                        cachedProductData.push(gbb.state.cachedProductDataGraphql.get(+id))
                    }
                    else return id
                })

                for (let i = 0; i < productIds.length; i++) {
                    let item = productIds[i];
                    if (!String(item).includes("gid")) {
                        productIds[i] = "gid://shopify/Product/" + productIds[i]
                    }
                }




                const variables = {
                    ids: productIds,
                    // countryCode: "IN"  || variables.countryCode,
                    countryCode: gbb.utility.getCountry(),
                    languageCode: gbb.utility.getLocale().toUpperCase().split("-")[0]
                    // languageCode: "EN" || variables.languageCode.toUpperCase()
                };

                let response = []
                let failedProductsData = []

                if (productIds?.length > 0) {
                    response = await gbb.graphQlUtility.graphQlAPIWrapper(query, variables)

                    response?.data?.nodes?.forEach((item, idx) => {
                        if (!item) {
                            failedProductsData.push({
                                id: gbb.utility.extractIdsFromGraphQlId(productIds[idx]),
                                failedToFetch: true
                            })
                        }
                    });

                    response = gbb.graphQlUtility.gbbCleaningAndArrangingData(response);
                    response = [...cachedProductData, ...response, ...failedProductsData]
                    gbb.utility.setCachedGraphqlData(response);
                } else {
                    response = cachedProductData
                }

                response = response.filter(product => !product.failedToFetch)
                return response;

            } catch (error) {
                console.error('error in getProductDataByIds ', error)
            }
        },
    },
    gbbBrowser: {
        state: {
            boxIdOffset: 0,
            gbbDiscountsAlreadyPresentInCart: {},
        },
        addDefaultProductsToBox: function (boxId) {
            try {
                if (!boxId) {
                    boxId = gbb.state.activeBoxId || "box1";
                }
                gbb.state.activeBoxId = boxId;
                let defaultProducts = Object.values(gbb?.settings?.shopifyData?.defaultProductsData);

                for (let i = 0; i < defaultProducts.length; i++) {
                    let currentProduct = defaultProducts[i];
                    for (let j = 0; j < currentProduct.variants?.length; j++) {
                        let currentVariant = currentProduct.variants[j];
                        let quantity = currentProduct?.requiredQuantity || 1;
                        let data = {
                            variant: { id: currentVariant.id },
                            qty: quantity,
                        }
                        gbb.utility.addToCart(data, "defaultProduct", undefined, "defaultProduct");
                    }
                }

            } catch (err) {
                gbb.utility.debugConsole(err + "inside addDefaultProductsToTheCart");
            }
        },
        getRelevantGiftBoxProductsTotalWithCurrency: function (boxId) {
            try {
                //getGiftBoxProductsFromCart
                let boxCartDataInSessionStorage = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(boxId);
                // gbb.state.giftBoxCartData = await gbb.utility.getGiftBoxProductsFromCart()
                let data = boxCartDataInSessionStorage
                // if(data.currency){
                return gbb.utility.getCurrencySymbol() + "" + parseFloat(data.total_price / 100).toFixed(2)
                // }else{
                // if(Shopify && Shopify.currency && Shopify.currency.active){
                //     return "0.0"+ " " +Shopify.currency.active
                // }else{
                //     return "0.0"
                // }

                // }
            } catch (error) {
                gbb.utility.debugError("getRelevantGiftBoxProductsTotalWithCurrency");
                gbb.utility.debugError(error);
                return "0.0"
            }
        },
        getProductsFromAllBoxesFromCart: function (cartDataFromSessionStorage) {
            try {
                let allCartItems = [];
                let addBoxQuantityToProperties = gbb.settings.app.addBoxQuantityToProperties || false;
                if (!cartDataFromSessionStorage) {
                    cartDataFromSessionStorage = sessionStorage.getItem(`gbb-cart-${gbb.state.bundleId}`);
                    cartDataFromSessionStorage = JSON.parse(cartDataFromSessionStorage);
                }
                if (cartDataFromSessionStorage && cartDataFromSessionStorage.boxes) {
                    Object.keys(cartDataFromSessionStorage?.boxes)?.forEach((box) => {
                        let tempArr = cartDataFromSessionStorage?.boxes[box]["items"] || [];
                        if (addBoxQuantityToProperties) {
                            tempArr.forEach((item) => {
                                item.properties["_Box Quantity"] = cartDataFromSessionStorage?.boxes[box]["boxQuantity"] || 1;
                            })
                        }
                        allCartItems.push(...tempArr)
                    })
                }
                return allCartItems;
            } catch (err) {
                gbb.utility.debugError(err + "getProductsFromAllBoxesFromCart");
            }
        },
        setRelevantBoxDataToSessionStorage: function (boxData, boxId) {
            try {
                const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()// for subscription bundles only

                if (!boxId) {
                    boxId = gbb.state.activeBoxId;
                }
                boxData.items = boxData.items.map((item) => {
                    let productPrice = item.price
                    let originForVariantDetails = item?.properties?._boxProduct == 'addonProduct' ? "addonProducts": null
                    let variantInfo = gbb.utility.getVariantDetailsFromCurrentProductsDataSet(item.variant_id, originForVariantDetails)
                    if (variantInfo) {
                        productPrice = variantInfo.price
                    }
                    if (isPurchaseTypeSubscription) {
                        productPrice = gbb.gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId(item.variant_id)
                    }
                    return {
                        ...item,
                        price: productPrice
                    }
                })
                gbb.state.giftBoxCartData = boxData;

                // // update discount rule
                gbb.gbbDiscountComponent.f.updateCurrentDiscountRule();

                // @rafath why not call getCartDataFromSessionStorage here?
                let cartDataFromSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
                if (cartDataFromSessionStorage) {
                    if (gbb.gbbDiscountComponent.state.currentDiscountRule[gbb.state.activeBoxId]) {
                        boxData["discountValue"] = gbb.gbbDiscountComponent.state.currentDiscountRule[gbb.state.activeBoxId]["discountValue"];
                    } else {
                        boxData["discountValue"] = null;
                    }
                    cartDataFromSessionStorage.boxes[boxId] = boxData;
                    gbb.gbbDiscountComponent.f.updateCurrentDiscountRule();
                    sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataFromSessionStorage));
                }
            } catch (err) {
                gbb.utility.debugError(err + "setRelevantBoxDataToSessionStorage");
            }
        },
        addItemToCartSessionStorage: function (itemData) {
            try {
                // if(item && item.quantity == 0){
                //     return 
                // }
                let boxCartDataInSessionStorage = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
                let currentBoxId = gbb.state.activeBoxId;
                if (boxCartDataInSessionStorage && boxCartDataInSessionStorage.items) {
                    boxCartDataInSessionStorage.items.push(itemData);
                    gbb.gbbBrowser.setRelevantBoxDataToSessionStorage(boxCartDataInSessionStorage, currentBoxId);
                }
                else {
                    gbb.utility.debugConsole("no items in session storage")
                }
                gbb.gbbBrowser.updateTotalPriceInSessionStorage()
                gbb.gbbBrowser.updateTotalofRelevantBoxPriceInSessionStorage()

            } catch (e) {
                gbb.utility.debugError("addItemToCartSessionStorage", e)
                gbb.utility.triggerSlackNotification(e)
            }

        },

        getCartDataFromSessionStorage: function (options) {
            try {

                const subscriptionPlanExists = gbb.gbbReviewPage.f.checkIfSubscriptionPlanExists();

                if (subscriptionPlanExists && options && options?.forSubscription && gbb.gbbBrowser?.getSubscriptionType() == "saveSubscription") {
                    return gbb.gbbBrowser.getCartDataForSubscription();
                }

                let cart = sessionStorage.getItem(`gbb-cart-${gbb.state.bundleId}`);
                cart = JSON.parse(cart);
                if (cart) { //&& cart.items
                    // gbb.state.giftBoxCartData = cart;
                    return cart;
                }
                else {
                    //return { items: [], attributes: {}, bundleQuantity: 1 };
                }

            } catch (error) {
                gbb.utility.debugError("getCartDataFromSessionStorage", error)
            }
        },
        getRelevantBoxDataFromSessionStorage: function (boxId) {
            try {

                // if(!boxId) {
                //     if(!gbb.state.activeBoxId) {
                //         gbb.state.activeBoxId = "box1"
                //     }
                //     boxId = gbb.state.activeBoxId;


                // }

                // let bundleCartData;
                // bundleCartData = sessionStorage.getItem(`gbb-cart-${gbb.state.bundleId}`);
                // bundleCartData = JSON.parse(bundleCartData);

                let bundleCartData;
                bundleCartData = sessionStorage.getItem(`gbb-cart-${gbb.state.bundleId}`);
                bundleCartData = JSON.parse(bundleCartData);

                if (!boxId) {
                    if (!gbb.state.activeBoxId) {
                        gbb.state.activeBoxId = "box1";
                    }
                    boxId = gbb.state.activeBoxId;
                    //find the isBoxActive box and set that as the active box
                    if (bundleCartData && bundleCartData.boxes) {
                        Object.keys(bundleCartData.boxes).forEach((box) => {
                            if (bundleCartData.boxes[box].isBoxActive) {
                                gbb.state.activeBoxId = box;
                                boxId = gbb.state.activeBoxId;
                            }
                        });
                    }
                }



                if (bundleCartData) {
                    let currentBoxData = bundleCartData?.boxes[boxId] || {};
                    if (currentBoxData && currentBoxData.items) {
                        gbb.state.giftBoxCartData = currentBoxData;
                        return currentBoxData;
                    }
                } else {
                    //initialization of the item session storage item happens here
                    bundleCartData = {
                        bundleId: gbb.state.bundleId,
                        attributes: {},
                        boxes: {
                            box1: {
                                boxId: "box1",
                                boxName: "Box - 1",
                                items: [],
                                boxQuantity: 1,
                                isBoxActive: true,
                                total_price: 0
                            }
                        }
                    }
                    gbb.state.activeBoxId = "box1";
                    gbb.state.giftBoxCartData = bundleCartData.boxes["box1"];
                    sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(bundleCartData));
                    if (gbb?.settings?.stepsConfigurationData?.defaultProductsData?.isDefaultProductsEnabled) {
                        gbb.gbbBrowser.addDefaultProductsToBox();
                    }
                }
                return bundleCartData;
            } catch (error) {
                gbb.utility.debugError("getRelevantBoxDataFromSessionStorage", error)
            }
        },
        updateTotalofRelevantBoxPriceInSessionStorage: function (boxId) {
            try {
                if (!boxId) {
                    boxId = gbb.state.activeBoxId
                }
                let boxCartDataInSessionStorage = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(boxId);
                if (boxCartDataInSessionStorage && boxCartDataInSessionStorage.items) {
                    let totalPrice = 0;
                    let totalQuantity = 0;
                    boxCartDataInSessionStorage.items.forEach((item) => {
                        totalPrice += item.price * item.quantity;
                        totalQuantity += item.quantity;
                    })
                    boxCartDataInSessionStorage.total_price = totalPrice;
                    boxCartDataInSessionStorage.item_count = totalQuantity;
                    gbb.gbbBrowser.setRelevantBoxDataToSessionStorage(boxCartDataInSessionStorage, boxId);
                    //sessionStorage.setItem(`gbb-cart-${gbb.state.boxId}`, JSON.stringify(cartDataInSessionStorage));
                }
            } catch (err) {
                gbb.utility.debugConsole(err + "at updateTotalofRelevantBoxPriceInSessionStorage");
            }
        },
        updateTotalPriceInSessionStorage: function () {
            try {
                let cartDataInSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
                if (cartDataInSessionStorage && cartDataInSessionStorage.boxes) {
                    let totalPrice = 0;
                    let totalQuantity = 0;
                    Object.keys(cartDataInSessionStorage.boxes).forEach((box) => {
                        let boxItem = cartDataInSessionStorage.boxes[box];
                        boxItem.items.forEach((item) => {
                            totalPrice += item.price * item.quantity;
                            totalQuantity += item.quantity;
                        })
                    })
                    cartDataInSessionStorage.total_price = totalPrice;
                    cartDataInSessionStorage.item_count = totalQuantity;
                    sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataInSessionStorage));
                }
            } catch (e) {
                gbb.utility.debugError("updateTotalPriceInSessionStorage", e)
            }
        },
        updateCartItemQuantityAndProperty: function (variantId, quantity, properties, boxId) {
            try {
                if (!boxId) {
                    boxId = gbb.state.activeBoxId;
                }
                let boxCartDataInSessionStorage = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(boxId);


                // in properties there is _uniqueGbbItemkey;
                // let boxCartDataInSessionStorageIndex = boxCartDataInSessionStorage.items.findIndex((cart) => cart.id == variantId);

                let boxCartDataInSessionStorageIndex = boxCartDataInSessionStorage.items.findIndex(cart => {
                    if (cart.properties && cart.properties["_uniqueGbbItemKey"]) {
                        return cart.properties["_uniqueGbbItemKey"] == properties["_uniqueGbbItemKey"];
                    } else {
                        return cart.id == variantId;
                    }
                });
                boxCartDataInSessionStorage.items[boxCartDataInSessionStorageIndex].quantity = quantity;
                boxCartDataInSessionStorage.items[boxCartDataInSessionStorageIndex].properties = properties;

                //  if quantity is 0 then remove the item from cart
                if (quantity == 0 && boxCartDataInSessionStorageIndex > -1) {
                    boxCartDataInSessionStorage.items.splice(boxCartDataInSessionStorageIndex, 1);
                }

                gbb.gbbBrowser.setRelevantBoxDataToSessionStorage(boxCartDataInSessionStorage)
                //sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(boxCartDataInSessionStorage));
                gbb.gbbBrowser.updateTotalPriceInSessionStorage()
                gbb.gbbBrowser.updateTotalofRelevantBoxPriceInSessionStorage()
                return boxCartDataInSessionStorage;
            }
            catch (e) {
                gbb.utility.debugError("updateCartItemQuantityAndProperty", e)
            }
        },

        getCartDataForSubscription: function () {
            try {
                //gbb.state.giftboxCartData 
                // gbb.utility.debugConsole("inside getCartDataForSubscription");
                let cart = gbb.gbbBrowser.getCartDataFromSessionStorage();
                cart.total_price = 0;
                cart.item_count = 0;
                Object.keys(cart.boxes).forEach((box) => {
                    let boxItem = cart.boxes[box];
                    boxItem.total_price = 0;
                    boxItem.item_count = 0;
                    boxItem.items.forEach((item) => {
                        let sellingPlanDetails = item.sellingPlanDetails;
                        if (sellingPlanDetails) {
                            let planItem = sellingPlanDetails[cart?.subscriptionPlan];
                            // total_price += (item.quantity) * (item?.price - planItem?.price);
                            // item.price = planItem?.price || planItem?.perDeliveryPrice;
                            item.price = planItem?.price;
                        }
                        boxItem.total_price += item.price * item.quantity;
                        boxItem.item_count += item.quantity;
                    })
                    cart.total_price += boxItem.total_price;
                    cart.item_count += boxItem.item_count;
                    //setRelevantBoxDataToSessionStorage
                    // gbb.gbbBrowser.setRelevantBoxDataToSessionStorage(boxItem, box);
                })

                // gbb.gbbBrowser.updateSubscriptionTotal(cart.total_price)   

                gbb.gbbBrowser.updateTotalPriceInSessionStorage()

                return cart;

            } catch (e) {
                gbb.utility.debugError("getCartDataForSubscription", e)
            }
        },

        updateCartItemSellingDetails: function (variantId, sellingPlanDetails = []) {
            try {
                let cartDataInSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
                let boxDataInSessionStorageIndex;
                let boxItem;
                let allBoxesKeys = Object.keys(cartDataInSessionStorage?.boxes)

                for (let i = 0; i < allBoxesKeys.length; i++) {
                    boxItem = cartDataInSessionStorage.boxes[allBoxesKeys[i]];
                    boxDataInSessionStorageIndex = boxItem.items.findIndex((cart) => cart.id == variantId)
                    if (boxDataInSessionStorageIndex != -1) {
                        boxItem.items[boxDataInSessionStorageIndex].sellingPlanDetails = sellingPlanDetails;
                        break;
                    }
                }
                cartDataInSessionStorage.boxes[boxItem.boxId] = boxItem;
                sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataInSessionStorage));

                gbb.gbbBrowser.updateTotalPriceInSessionStorage()
                gbb.gbbBrowser.updateTotalofRelevantBoxPriceInSessionStorage(boxItem.boxId)

                return cartDataInSessionStorage;
            }
            catch (e) {
                gbb.utility.debugError("updateCartItemSellingDetails", e)
            }
        },
        updateCartAttributes: function (attributesvalues) {
            try {
                let cartDataInSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();

                //loop cartDataInSessionStorage attributes and update one by one
                for (let [key, value] of Object.entries(attributesvalues)) {
                    cartDataInSessionStorage.attributes[key] = value;
                }
                sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataInSessionStorage));

                gbb.gbbBrowser.updateTotalPriceInSessionStorage();
                //gbb.gbbBrowser.updateTotalofRelevantBoxPriceInSessionStorage() #TBD
                return cartDataInSessionStorage;
            }
            catch (e) {
                gbb.utility.debugError("updateCartAttributes", e)
            }
        },
        deleteCartAttributes: function (attributes) {
            try {
                let cartDataInSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
                let attributesKeys = Object.keys(cartDataInSessionStorage.attributes);
                for (let i = 0; i < attributesKeys.length; i++) {
                    if (attributes.includes(attributesKeys[i])) {
                        delete cartDataInSessionStorage.attributes[attributesKeys[i]];
                    }
                }
                sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataInSessionStorage));
                gbb.gbbBrowser.updateTotalPriceInSessionStorage();
                //gbb.gbbBrowser.updateTotalofRelevantBoxPriceInSessionStorage() #TBD
                return cartDataInSessionStorage;
            } catch (e) {
                gbb.utility.debugError("deleteCartAttributes", e)
            }
        },

        clearRelevantBoxFromSessionStorage: async function (boxId) {
            try {
                let cartDataInSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();

                //ex:allBoxesKeys = [box1, box2, box3, box4]
                let allBoxesKeys = Object.keys(cartDataInSessionStorage?.boxes) || [];
                gbb.gbbDiscountComponent.state.currentDiscountRule[boxId] = null;

                let currentBoxNo = parseInt(boxId.split("box")[1]);

                let lastBoxNo = parseInt(allBoxesKeys[allBoxesKeys.length - 1].split("box")[1]);

                let allBoxesData = JSON.parse(JSON.stringify(cartDataInSessionStorage.boxes));
                let tempAllBoxesData = JSON.parse(JSON.stringify(cartDataInSessionStorage.boxes));


                //allBoxesKeys = [box1, box2, box3, box4]
                for (let index = currentBoxNo; index < lastBoxNo; index++) {
                    let nextBoxIndex = index + 1;
                    let tempCopiedProductsDataObject = JSON.parse(JSON.stringify(tempAllBoxesData["box" + nextBoxIndex]))
                    allBoxesData[`box${index}`] = tempCopiedProductsDataObject;
                    allBoxesData[`box${index}`]["boxName"] = "Box - " + index;
                    allBoxesData[`box${index}`]["boxId"] = "box" + index;
                }
                delete allBoxesData["box" + allBoxesKeys.length];

                cartDataInSessionStorage.boxes = allBoxesData;

                sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataInSessionStorage));

                //update item properties for all boxes
                let newAllBoxesKeys = Object.keys(cartDataInSessionStorage?.boxes) || [];
                for (let i = 0; i < newAllBoxesKeys.length; i++) {
                    let boxItem = cartDataInSessionStorage.boxes[allBoxesKeys[i]];
                    let items = boxItem.items || [];
                    for (let i = 0; i < items.length; i++) {
                        let item = items[i];
                        let _data = {
                            id: item.key || item.id,
                            quantity: item.quantity,
                            properties: {
                                ...item.properties,
                                "Box ID": boxItem?.boxId?.split("box")[1] || 1
                            }
                        }
                        gbb.state.activeBoxId = boxItem.boxId;
                        await gbb.utility.changeCart(_data);
                    }
                }

                gbb.gbbBrowser.updateSubscriptionType("oneTimeSubscription");
                gbb.gbbBrowser.removeSubscriptionPlan();
                if (!cartDataInSessionStorage.boxes || Object.keys(cartDataInSessionStorage.boxes).length == 0) {
                    gbb.gbbBrowser.clearCartDataFromSessionStorage();
                }
                gbb.gbbReviewPage.init();
            } catch (err) {
                gbb.utility.debugConsole(err + "clearRelevantBoxFromSessionStorage");
            }
        },
        clearCartDataFromSessionStorage: function () {
            try {
                gbb.state.activeBoxId = null;
                sessionStorage.removeItem(`gbb-cart-${gbb.state.bundleId}`);
                let isEligibleTierForAddonsExists = gbb.storage.getItem(`eligible-tiers-for-addons-${gbb.state.bundleId}`)
                if (isEligibleTierForAddonsExists) {
                    sessionStorage.removeItem(`eligible-tiers-for-addons-${gbb.state.bundleId}`)
                }
            } catch (e) {
                gbb.utility.debugError("clearCartDataFromSessionStorage", e)
            }
        },
        addItemsToCart: async function () {
            try {
                const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()

                //perform ajax calls and add items to cart, then return the cart data
                //get the bundleQuantity from cartData
                // cartData = gbb.utility.multiplyByBundleQuantity(cartData)
                let cartData = gbb.gbbBrowser.getCartDataFromSessionStorage();
                let result = {
                    data: false,
                    failedProductsArr: []
                };
                //for loop and multiply quantity of items by boxQuantity
                for (let boxId in cartData.boxes) {
                    let boxCartData = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(boxId);
                    cartData.boxes[boxId] = gbb.utility.multiplyByBundleQuantity(boxCartData)
                }

                //now traverse the cartData and remove all items from cart

                let allItems = gbb.gbbBrowser.getProductsFromAllBoxesFromCart(cartData);

                cartData.items = allItems;

                cartData = gbb.utility.cleanUpProperties(cartData);

                if (gbb.gbbAddonProducts.state.isEnabled) {
                    // check if cart contains addon products 
                    let isAddonProductPresentInCart = cartData.items.find(item => item.properties.hasOwnProperty("_addon_product"))
                    if (isAddonProductPresentInCart) {
                        let propertiesToAdd = {
                            _addon_offer_id:gbb.gbbAddonProducts.state.offerId
                        }
                        let addQtyToProducts = true
                        gbb.utility.addCustomProperties(cartData, propertiesToAdd, addQtyToProducts)
                    }
                }

                if (gbb.gbbBrowser.getSubscriptionType() == "saveSubscription" && gbb.gbbBrowser.getSubscriptionPlan()) {
                    cartData = gbb.utility.applySellingPlanToAllCartItems(cartData);
                }

                if (isPurchaseTypeSubscription) {
                    cartData = gbb.utility.applySellingPlanToAllCartItemsV2(cartData);
                }

                let cartDataWithBoxIdCorrected = gbb.utility.updateBoxIdInCartData(cartData);

                // if more than 
                // if ()

                cartDataWithBoxIdCorrected.items = gbb.utility.groupCartDataBasedOnId_and_Properties(cartDataWithBoxIdCorrected.items)


                result.data = await gbb.shopifyUtility.addToCart(cartDataWithBoxIdCorrected)

                if (!result.data) {
                    let response = await gbb.gbbBrowser.addIndividualItemsToCart(cartDataWithBoxIdCorrected);
                    result.data = response.data;
                    result.failedProductsArr = response.failedProductsArr;
                    gbb.gbbBrowser.emitCustomEvent({
                        eventName: "gbb-add-bundle-to-cart-failed",
                        detail: {
                            failedProducts:response.failedProductsArr || []
                        }
                    })
                } else {
                    result.data = true;
                    gbb.gbbBrowser.emitCustomEvent({
                        eventName: "gbb-add-bundle-to-cart-success",
                    })
                }
                // if (result.data) {
                //     gbb.gbbBrowser.clearCartDataFromSessionStorage()
                // }
                return result;
            } catch (error) {
                gbb.utility.debugConsole("error in gbbBrowser.addItemsToCart", error)
                return false
            }
        },
        addIndividualItemsToCart: async function (cartData) {
            let currentProduct;
            let result = {
                data: false,
                failedProductsArr: []
            }
            try {
                //individual ajax calls for each item
                let items = cartData.items;
                let apiResponse = [];
                for (let i = 0; i < items.length; i++) {
                    currentProduct = items[i];
                    let resp = await gbb.shopifyUtility.addToCart(items[i]);
                    apiResponse.push(resp)
                    if (resp && result.data) {
                        result.data = true;
                    }
                    if (!resp) {
                        result.data = false;
                        result.failedProductsArr.push(currentProduct);
                    }
                }
                return result;
            } catch (error) {
                // result.data = false;
                gbb.utility.debugConsole("error in gbbBrowser.addIndividualItemsToCart", error)
                return result;
            }
        },
        initializeRelevantBoxQuantity: function () {
            if (!gbb.gbbBrowser.getRelevantBoxQuantity()) {
                gbb.gbbBrowser.updateRelevantBoxQuantity(1);
            }
        },
        updateRelevantBoxQuantity: function (value, boxId) {
            if (!boxId) {
                boxId = gbb.state.activeBoxId
            }
            let boxCartDataInSessionStorage = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(boxId);
            boxCartDataInSessionStorage.boxQuantity = value;
            // if(gbb.state.giftBoxCartData){ //TBD
            //     gbb.state.giftBoxCartData["bundleQuantity"] = value;
            // }
            gbb.gbbBrowser.setRelevantBoxDataToSessionStorage(boxCartDataInSessionStorage, boxId);
            return boxCartDataInSessionStorage.boxQuantity;
        },
        getRelevantBoxQuantity: function (boxId) {
            if (!boxId) {
                boxId = gbb.state.activeBoxId
            }
            let boxCartDataInSessionStorage = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(boxId)
            if (boxCartDataInSessionStorage) {
                return boxCartDataInSessionStorage.boxQuantity;
            }
            return 0;
        },
        getSubscriptionType: function () {
            let cart = sessionStorage.getItem(`gbb-cart-${gbb.state.bundleId}`);
            cart = JSON.parse(cart);
            if (cart && cart.subscriptionType) {
                return cart.subscriptionType;
            }
            return 0;
        },
        updateSubscriptionType: function (value) {
            let cartDataInSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
            cartDataInSessionStorage.subscriptionType = value;
            if (gbb.state.giftBoxCartData) {
                gbb.state.giftBoxCartData["subscriptionType"] = value;
            }
            sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataInSessionStorage));
            return cartDataInSessionStorage.subscriptionType;
        },
        getSubscriptionPlan: function () {
            let cart = sessionStorage.getItem(`gbb-cart-${gbb.state.bundleId}`);
            cart = JSON.parse(cart);
            if (cart && cart.subscriptionPlan) {
                return cart.subscriptionPlan;
            }
            return 0;
        },
        updateSubscriptionPlan: function (value) {
            let cartDataInSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
            cartDataInSessionStorage.subscriptionPlan = value;
            if (cartDataInSessionStorage["subscriptionTotal"]) {
                delete cartDataInSessionStorage["subscriptionTotal"];
            }
            if (gbb.state.giftBoxCartData) {
                gbb.state.giftBoxCartData["subscriptionPlan"] = value;
            }
            sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataInSessionStorage));
            return cartDataInSessionStorage.subscriptionPlan;
        },
        prepareDiscountString: function () {
            let getAllDiscountsToApply = gbb.gbbBrowser.state.gbbDiscountsAlreadyPresentInCart;

            let bundleName = gbb.state.bundleName;


            if (gbb.gbbDiscountComponent.state.discountCode) {
                getAllDiscountsToApply = { ...getAllDiscountsToApply, [`gbbDiscountCode-${bundleName}`]: gbb.gbbDiscountComponent.state.discountCode };
            }
            let discountCodeString;
            // {"gbbDiscountCode-1": 'teeboxblandselv-42609929',"gbbDiscountCode-2": 'teeboxblandselv-42609929'}
            if (getAllDiscountsToApply) {
                //convert them to teeboxblandselv-42609929,teeboxblandselv-42609929
                discountCodeString = Object.values(getAllDiscountsToApply).join(",");
            }
            if (discountCodeString) {
                gbb.gbbDiscountComponent.state.discountCode = gbb.gbbDiscountComponent.state.discountCode + "," + discountCodeString;
            }

            return discountCodeString;
        },
        updateSubscriptionTotal: function (value) {
            let cartDataInSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
            cartDataInSessionStorage.subscriptionTotal = value;
            if (gbb.state.giftBoxCartData) {
                gbb.state.giftBoxCartData["subscriptionTotal"] = value;
            }
            sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataInSessionStorage));
            return cartDataInSessionStorage.subscriptionTotal;
        },
        removeSubscriptionPlan: function () {
            let cartDataInSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
            delete cartDataInSessionStorage.subscriptionPlan;
            sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataInSessionStorage));
            return cartDataInSessionStorage.subscriptionPlan;
        },
        createNewBoxInSessionStorage: function (isRedirectAllowed) {
            try {
                let cartDataFromSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
                let boxKeys = Object.keys(cartDataFromSessionStorage?.boxes) || [];
                let maxBoxKey = 0;
                for (let i = 0; i < boxKeys.length; i++) {
                    let tempBoxKeyNo = parseInt(boxKeys[i]?.split("box")[1]);
                    if (tempBoxKeyNo > maxBoxKey) {
                        maxBoxKey = tempBoxKeyNo;
                    }
                }
                maxBoxKey = maxBoxKey + 1;
                let newBoxId = "box" + maxBoxKey
                let newBox = {
                    boxId: newBoxId,
                    boxName: "Box - " + maxBoxKey,
                    items: [],
                    boxQuantity: 1,
                    isBoxActive: true,
                    total_price: 0
                }

                gbb.gbbPersonalizePage.state.customerUploadsErrors = null;
                gbb.gbbPersonalizePage.state.customerUploadsResponse = null;

                // gbb.gbbBrowser.activateRelevantBoxInSessionStorage(newBoxId,{redirectToFirstProductPage:isRedirectAllowed});
                cartDataFromSessionStorage = gbb.gbbBrowser.activateRelevantBoxInSessionStorage(newBoxId, { redirectToFirstProductPage: isRedirectAllowed });

                gbb.gbbDiscountComponent.state.currentDiscountRule[gbb.state.activeBoxId] = null;
                cartDataFromSessionStorage.boxes[newBoxId] = newBox;
                sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataFromSessionStorage));

                if (gbb?.settings?.stepsConfigurationData?.defaultProductsData?.isDefaultProductsEnabled) {
                    gbb.gbbBrowser.addDefaultProductsToBox();
                }
                let isEligibleTierForAddonsExists = gbb.storage.getItem(`eligible-tiers-for-addons-${gbb.state.bundleId}`)
                if (isEligibleTierForAddonsExists) { 
                    sessionStorage.removeItem(`eligible-tiers-for-addons-${gbb.state.bundleId}`)
                }
                return cartDataFromSessionStorage;
            } catch (err) {
                gbb.utility.debugError(err);
            }
        },
        redirectToFirstProductPage: function () {
            try {
                let firstItem = gbb.state.navigationItems[0];
                if (firstItem.id == "landingPage") {
                    firstItem = gbb.state.navigationItems[1];
                }
                firstItem.initFn();
                gbb.f.addParamsToUrl("page", firstItem.id)
            } catch (err) {
                gbb.utility.debugError(err);
            }
        },

        activateRelevantBoxInSessionStorage: function (boxId, options) {
            // options = {redirectToFirstProductPage:true/false}
            try {
                gbb.state.activeBoxId = boxId;
                let cartDataFromSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();
                let boxKeys = Object.keys(cartDataFromSessionStorage?.boxes) || [];
                for (let i = 0; i < boxKeys.length; i++) {
                    let boxItem = cartDataFromSessionStorage.boxes[boxKeys[i]];
                    if (boxItem.isBoxActive) {
                        boxItem.isBoxActive = false;
                        break;
                    }
                }
                for (let i = 0; i < boxKeys.length; i++) {
                    let boxItem = cartDataFromSessionStorage.boxes[boxKeys[i]];
                    if (boxItem.boxId == boxId) {
                        boxItem.isBoxActive = true;
                        break;
                    }
                }
                if (options?.redirectToFirstProductPage) {
                    gbb.gbbBrowser.redirectToFirstProductPage();
                }
                gbb.gbbPersonalizePage.state.customerUploadsResponse = null;
                sessionStorage.setItem(`gbb-cart-${gbb.state.bundleId}`, JSON.stringify(cartDataFromSessionStorage));
                return cartDataFromSessionStorage;
            } catch (err) {
                gbb.utility.debugError(err);
            }
        },
        getCartDataFromShopify: async function () {
            try {
                const cartData = await gbb.shopifyUtility.getCart();
                //now loop through items and check if theres any property on known as Box ID
                // if yes, then save that BoxId as gbb.gbbBrowser.state.boxIdOffset
                let boxIdOffset = 0;
                let listOfBundleNamesPresentInCart = [];
                cartData.items.forEach(item => {
                    if (item.properties["Box ID"]) {
                        //  boxIdOffset = parseInt(item.properties["Box ID"]);
                        boxIdOffset = Math.max(boxIdOffset, parseInt(item.properties["Box ID"]));
                        // this will append duplicate box names, but its not gonna harm or cause a problem, so its fine
                        listOfBundleNamesPresentInCart.push(item.properties["Bundle"]);
                    }
                });

                listOfBundleNamesPresentInCart = [...new Set(listOfBundleNamesPresentInCart)];

                //              cartData.attributes
                // {gbbDiscountCode-1: 'teeboxblandselv-42609929'}

                let gbbDiscountsAlreadyPresentInCart = Object.keys(cartData.attributes).filter(key => key.includes("gbbDiscountCode-"));

                if (gbbDiscountsAlreadyPresentInCart.length > 0) {
                    gbbDiscountsAlreadyPresentInCart.forEach(discountCodeKey => {
                        let discountCode = cartData.attributes[discountCodeKey];
                        // check if this discountCodeKey is present in listOfBundleNamesPresentInCart
                        let discountCodeKeyBoxName = discountCodeKey.split("gbbDiscountCode-")[1];

                        //is discountCodeKeyBoxName present in listOfBundleNamesPresentInCart
                        if (discountCodeKeyBoxName && listOfBundleNamesPresentInCart.includes(discountCodeKeyBoxName)) {
                            // if yes, then add this discountCode to gbb.gbbBrowser.state.gbbDiscountsAlreadyPresentInCart
                            gbb.gbbBrowser.state.gbbDiscountsAlreadyPresentInCart[discountCodeKey] = discountCode;
                        }
                    })
                }

                gbb.gbbBrowser.state.cartDataFromShopifyBeforeLastPage = cartData;

                gbb.utility.debugConsole("boxIdOffset-> set as", boxIdOffset)
                gbb.gbbBrowser.state.boxIdOffset = boxIdOffset;
                return cartData;
            } catch (error) {
                gbb.utility.debugError(error);
                return;
            }
        },
        setSubscriptionBundleDataInSessionStorage: function (payload) {
            try {
                // set payload in session storage with bundleId
                sessionStorage.setItem(`gbb-subscription-bundle-${gbb.state.bundleId}`, JSON.stringify(payload));

            } catch (error) {
                gbb.utility.debugError('error in setSubscriptionBundleDataInSessionStorage', error)
            }
        },
        emitCustomEvent: function ({
            eventName,
            attachEventTo = document,
            detail = '',
            bubbles = true,
            cancelable = false
        }) {
            try {
                gbb.utility.debugConsole("customEvent:",{
                    eventName,
                    attachEventTo,
                    detail,
                });
                let event = new CustomEvent(eventName, {
                    detail: detail, // extra information that can be accessed via e.detail.message
                    bubbles: bubbles,    // Allow event propagation through the DOM if needed
                    // cancelable: cancelable, // we dont want to give other dev power to interrupt our execution / operations
                });
                // Dispatch the event on the specified element (default is document)
                attachEventTo.dispatchEvent(event);
                return attachEventTo
            } catch (error) {
                gbb.utility.debugError(`Error in emitCustomEvent for event: ${eventName}`, error);
            }
        }
    },
    storage: {

        setItem: function (field, value) {
            sessionStorage.setItem(field, value)
        },
        getItem: function (field) {
            return sessionStorage.getItem(field)
        }
    },
    themeSpecificCode: {
        init: function (settings) {
            gbb.themeSpecificCode.f.ventureTheme(settings)
        },

        f: {
            ventureTheme: function () {
                if (window.Shopify && window.Shopify.theme && window.Shopify.theme.theme_store_id && window.Shopify.theme.theme_store_id == gbb.constants.themesIds.VENTURE_THEME) {
                    // reload on save
                    gbb.selectors.sideCartDrawerOverlay = ""
                }
            }
        }
    },
    giftboxbuilderPage: {
        //init, selectGiftBoxPage, AddProductsPage, personalizePage, reviewPage,
        init: async function (settings) {
            gbb.giftboxbuilderPage.initialize(settings)
        },
        initialize: async function (settings) {
            // gbb.giftboxbuilderPage.init(settings)

            // gbb.state.cartData = await gbb.utility.getCart()

            gbb.utility.debugConsole("dummy commit");
            //initialize active variant class
            gbb.utility.getActiveVariantStyle();
            await gbb.utility.setStoreCurrenyStateFromCart();

            gbb.utility.setBuilderPageHTMLData_SEO()

            let navigationItems = gbb.f.setNavigationItems();

            if (gbb.settings.stepsConfigurationData.bundleStatus == "PAUSED") {
                navigationItems = [];
            }

            gbb.state.navigationItems = navigationItems
            let currentNavigationItem;

            gbb.giftboxbuilderPage.f.insertWrapperIntoBody();

            gbb.gbbAddProductsPage.f.createArraysOfPageWhichHaveConditions();

            if (gbb.settings?.stepsConfigurationData?.isProductSlotsEnabled) {
                gbb.gbbAddProductsPage.f.calculateProductSlotsData()
            }
            // document.title = "Easy Bundles"

            gbb.gbbDiscountComponent.f.updateCurrentDiscountRule()
            gbb.gbbKite.init();
            // currentPageId
            //  check the url params and see if there is ?page field

            let navId = gbb.f.getParamValueFromUrl("page")
            let currentFlow = gbb.f.getParamValueFromUrl("currentFlow")
            //check if landing page is enabled or not that's it
            let isLandingPageEnabled = gbb.settings?.stepsConfigurationData?.landingPageData?.isLandingPageEnabled
            if (isLandingPageEnabled && (navId == null || typeof navId == "undefined" || navId == "landingPage")) {
                gbb.gbbLandingPage.init(settings, "GIFTBOXBUILDER_PAGE")
                gbb.utility.renderTemporaryLoadingSpinner("hide")
                //prefetchFn of the next page to be loaded, figure out from navigationitems
                let nextNavigationItem = gbb.f.getNextNavigationItem();
                if (nextNavigationItem) {

                    if (nextNavigationItem.intialFetchFn) {
                        nextNavigationItem.intialFetchFn()
                    }
                }
            } else {
                gbb.utility.renderTemporaryLoadingSpinner("show")
            }


            // initialize all these fns after calling
            // prefetching the data from shopify

            // extract extra info from localStorage extraInfoFromLinkDummyProductPage
            gbb.f.processAdditionalLogicAsPerUseCase();

            const getProductsData = await gbb.f.prefetchData(settings)
            gbb.gbbBrowser.initializeRelevantBoxQuantity();
            const directlyLoadCheckoutPage = gbb.state.navigationItems.length < 1 ? true : false;
            if (directlyLoadCheckoutPage) {
                await gbb.gbbBrowser.getCartDataFromShopify();
                await gbb.utility.handleCheckoutClick();
                return;
            }

            if (navId != null && navId != "landingPage" && typeof navId != "undefined") {
                //find the current navigationItem
                currentNavigationItem = gbb.f.getNavItem(navId);
                gbb.state.currentPageId = currentNavigationItem.id
                //call the initFn
                gbb.f.markPreviousNavigationItemsAsCompleted(currentNavigationItem)
                await currentNavigationItem.initFn()
                gbb.utility.renderTemporaryLoadingSpinner("hide")
            } else {
                //call the initFn of the first item
                let firstItem = gbb.state.navigationItems[0];
                gbb.f.addParamsToUrl("page", firstItem.id)
                gbb.f.addParamsToUrl("currentFlow", "byob")
                gbb.f.markPreviousNavigationItemsAsCompleted(firstItem)

                if (firstItem.id != "landingPage") {
                    await firstItem.initFn()
                    gbb.utility.renderTemporaryLoadingSpinner("hide")
                }
            }

            gbb.utility.renderTemporaryLoadingSpinner("hide")

            await gbb.f.insertDiscountProgressBar();

            let isThisLastNavigationItem = gbb.state.navigationItems.indexOf(currentNavigationItem) == gbb.state.navigationItems.length - 1
            let isThisTheOnlyNavigationItem = gbb.state.navigationItems.length == 1

            if (isThisLastNavigationItem || isThisTheOnlyNavigationItem) {
                gbb.gbbBrowser.getCartDataFromShopify();
            }

            // gbb.giftboxbuilderPage.f.scrollIntoBundleViewForIndependentPage();

        },
        f: {
            applyCustomizationClassToBodyIfNeeded: function (body) {
                try {
                    let applyNewCustomization = gbb.settings.pageCustomizationData?.generalSettings?.bundle?.applyNewPageCustomization;

                    // If customization flag is not set, check against the version release date
                    if (!applyNewCustomization) {
                        let userCreatedAt = gbb.settings.merchantInfo.createdAt;
                        const versionReleaseDate = new Date('2024-09-19T00:00:00Z'); // 19th September 2024

                        applyNewCustomization = new Date(userCreatedAt) >= versionReleaseDate;
                    }

                    // Add class if customization is applicable
                    if (applyNewCustomization) {
                        gbb.$(body).addClass('gbbNewPageCustomization');
                    }
                } catch (error) {
                    gbb.utility.debugError("applyCustomizationClassToBodyIfNeeded", error);
                }
            },
            insertWrapperIntoBody: function () {
                let currentBundleDesignTemplate = gbb.settings.stepsConfigurationData.bundleDesignTemplate
                const gbbHTMLWrapper = gbb.elements.gbbHTMLWrapperParent;
                const gbbBodyWrapper = gbb.elements.gbbBodyWrapperParent;
                gbbHTMLWrapper.append(gbbBodyWrapper);
                gbb.$(".gbbPageBody").html(gbbHTMLWrapper);

                //attach bundle-number  to the html tag
                gbb.$("html").addClass(`bundle-${gbb.state.bundleId}`)
                gbb.$("html").addClass(`gbbBundle-HTML`)


                // add an id too
                if (currentBundleDesignTemplate == 'BUILD_FROM_SCRATCH_NEWPRODUCTCARD') {
                    gbb.$(".gbbPageBody").addClass('gbbProductsCardLayoutV2')
                }
                gbb.giftboxbuilderPage.f.applyCustomizationClassToBodyIfNeeded('.gbbPageBody')
                // if(gbb.settings.pageCustomizationData.)
                gbb.$(".gbbPageBody").attr("id", "gbbBundle")
                gbb.$(".gbbPageBody").addClass(`bundle-${gbb.state.bundleId}`)
                if (gbb.settings.pageCustomizationData.generalSettings.bundle.bundleBgColor) {
                    gbb.$(".gbbPageBody").css("background-color", gbb.settings.pageCustomizationData.generalSettings.bundle.bundleBgColor)
                }
            },
            scrollIntoBundleViewForIndependentPage: function () {
                try {
                    let gbbBundleElement = gbb.$("#gbbBundle").length > 0 && window.easyBundlesConfig;

                    if (gbbBundleElement) {
                        // gbbBundleElement[0].scrollIntoView({ behavior: "smooth", block: "start" });

                        // scroll with some  margin of top 20px;

                        let topPos = gbb.$("#gbbBundle").offset().top - 20;

                        // scroll into it;
                        gbb.$('html, body').animate({
                            scrollTop: topPos
                        }, 1000);
                    }
                } catch (e) {
                    gbb.utility.debugError("error in scrollIntoBundleViewForIndependentPage", e)
                }
            }
        },
        action: {
            onPrevNavigationBYOB: async function () {
                let currentPageItem = gbb.f.getNavItem(gbb.state.currentPageId);
                let scrollPoisitionAfterPageChange = gbb.state.scrollPoisitionAfterPageChange;

                let prevNavigationItem = gbb.f.getPreviousNavigationItem();
                gbb.state.navigationItems.forEach(function (item) {
                    if (item.id == currentPageItem.id) {
                        item.isActive = false;
                    }
                })
                gbb.state.navigationItems.forEach(function (item) {
                    if (item.id == prevNavigationItem.id) {
                        item.isActive = true;
                    }
                })
                //check if its the last navigation item
                if (prevNavigationItem) {

                    gbb.f.markPreviousNavigationItemsAsCompleted(prevNavigationItem)
                    await prevNavigationItem.initFn();

                    gbb.f.addParamsToUrl("page", prevNavigationItem.id)
                    setTimeout(() => {
                        window.scrollTo(0, scrollPoisitionAfterPageChange);
                    }, 700)
                }
                else {
                    gbb.utility.debugConsole("Welcome to the first page bro")
                    // gbb.gbbModal.action.onModalClose();
                }

            },
            onNextNavigationBYOB: async function (nextPageId) {
                // type -> back or next

                //next button click on path 2 -> create your own gift box

                // gbb.giftboxbuilderPage.f.onFooterNextButtonClick(settings)
                // if(nextNavigationItem.updatePageStatusFn){
                // nextNavigationItem
                // }
                // todo,
                let currentPageValidationPassed = true;
                let currentPageItem = gbb.f.getNavItem(gbb.state.currentPageId);
                let nextNavigationItem;

                if (nextPageId) {
                    nextNavigationItem = gbb.f.getNavItem(nextPageId);
                } else {
                    nextNavigationItem = gbb.f.getNextNavigationItem();
                }

                if (currentPageItem.updatePageStatusFn) {
                    currentPageValidationPassed = await currentPageItem.updatePageStatusFn();
                }

                //make next navigation item active
                if (nextNavigationItem) {
                    gbb.state.navigationItems.forEach(function (item) {
                        if (item.id == nextNavigationItem.id) {
                            item.isActive = true;
                        }
                    })
                }

                //is this nextNavigationItem is the last navigation item then call shopifyAddToCart
                let isThisLastNavigationItem = gbb.state.navigationItems.indexOf(nextNavigationItem) == gbb.state.navigationItems.length - 1
                let scrollPoisitionAfterPageChange = gbb.state.scrollPoisitionAfterPageChange;
                //check if its the last navigation item
                if (nextNavigationItem && currentPageValidationPassed) {
                    await nextNavigationItem.initFn();
                    gbb.f.addParamsToUrl("page", nextNavigationItem.id)
                    setTimeout(() => {
                        window.scrollTo(0, scrollPoisitionAfterPageChange);
                        // window.scrollTo(0, 70);
                    }, 700)

                }

                if (isThisLastNavigationItem) {
                    gbb.gbbBrowser.getCartDataFromShopify();
                }

                else if (!nextNavigationItem) {
                    gbb.utility.debugConsole("Welcome to the end bro")
                    let cartData = await gbb.utility.getCart();
                    gbb.state.giftBoxCartData = cartData;
                    await gbb.utility.handleCheckoutClick();
                    // gbb.gbbModal.action.onModalClose();
                }

                // gbbBundle scroll to gbbBundle id attribute
                gbb.giftboxbuilderPage.f.scrollIntoBundleViewForIndependentPage();

            }
        }

    },
    gbbLandingPage: {
        state: {
            buildBoxButtonAction: undefined,
            // giftBoxData: null,
        },
        init: async function (settings, parent) {
            gbb.state.navigationItems = gbb.f.setNavigationItems();
            gbb.state.currentPageId = "landingPage";
            if (gbb?.gbbAddProductsPage?.state?.productPageData) {
                gbb.gbbAddProductsPage.state.productPageData = undefined
            }
            let navItem = gbb.utility.getNavItem(gbb.state.currentPageId)
            gbb.f.markPreviousNavigationItemsAsCompleted(navItem)
            gbb.gbbLandingPage.initialize(settings, parent)
            gbb.gbbLandingPage.f.registerEvents(settings)
            gbb.utility.renderTemporaryLoadingSpinner("hide")

            // gbb.gbbModel.init(settings)
        },
        initialize: function (settings, parent) {

            // gbb.utility.debugConsole("settings:",settings.giftwrap);

            // let {isEnabledOnProductPage, isEnabledOnCartPage} = gbb.gbbLandingPage.f.checkifGiftWrapEnabled(settings.giftwrap, productHandle, parent)
            // if (isEnabledOnProductPage) {
            let gbbLandingPageWrapper = gbb.$("<div>").addClass("gbbLandingPageWrapper");
            const gbbLandingPageHeaderHTML = gbb.gbbLandingPage.f.prepareHeader();
            const gbbLandingPageBodyHTML = gbb.gbbLandingPage.f.prepareUI();
            const gbbLandingPageFooterHTML = gbb.gbbLandingPage.f.prepareFooter();

            gbbLandingPageWrapper.append(gbbLandingPageHeaderHTML);
            gbbLandingPageWrapper.append(gbbLandingPageBodyHTML);
            gbbLandingPageWrapper.append(gbbLandingPageFooterHTML);

            gbb.$("body").attr("data-page", gbb.state.currentPageId)
            gbb.state.landingPageBody = gbbLandingPageWrapper;
            gbb.gbbLandingPage.f.insertIntoMainPageWrapper();
        },
        f: {

            prepareHeader: function () {
                //this is a header
                const gbbLandingPageHeaderHTML = gbb.$("<div>").addClass("gbbLandingPageHeader");
                // gbbLandingPageHeaderHTML.append("<div> <h1> Header Gift Box Builder</h1> </div>");
                // return gbbLandingPageHeaderHTML;
            },
            prepareUI: function () {

                let scrollPoisitionAfterPageChange = gbb.state.scrollPoisitionAfterPageChange;

                window.scrollTo(0, scrollPoisitionAfterPageChange);

                // window.scrollTo(0, 70);
                let gbbLandingPageHTML;

                //gbbLandingPageHTMLContent = create divs with classNams
                gbbLandingPageHTML = gbb.$("<div>").addClass("gbbLandingPageHTMLContent");
                //one image div, 2 text divs, 1 button div and one label div and 1 cards main div
                const landingPageBanner = gbb.$("<div>").addClass("gbbLandingPageBanner");
                //all the text and button goes in this div
                const landingPageBannerImage = gbb.$("<img>").addClass("gbbLandingPageBannerImage");
                const gbbLandingPageBannerTextWrapper = gbb.$("<div>").addClass("gbbLandingPageBannerTextWrapper");
                const landingPageBannerText = gbb.$("<div>").addClass("gbbLandingPageBannerText");
                //subtext
                const landingPageBannerSubText = gbb.$("<div>").addClass("gbbLandingPageBannerSubText");
                //create a button
                const gbbLandingPageBannerButtonWrapper = gbb.$("<div>").addClass("gbbLandingPageBannerButtonWrapper");
                // const gbbLandingPageBannerButton = gbb.$("<button>").addClass("landingPageBannerButton");
                const gbbLandingPageBannerButton = gbb.$("<div>").addClass("landingPageBannerButton");

                landingPageBannerImage.attr("src", gbb.settings.stepsConfigurationData.landingPageData.stepImage);


                landingPageBannerText.text(gbb.settings?.stepsConfigurationData?.landingPageData?.bannerText);
                landingPageBannerSubText.text(gbb.settings?.stepsConfigurationData?.landingPageData?.bannerSubtext);

                landingPageBannerText.css("color", gbb.settings.pageCustomizationData.landingPage.landingPageTextColor);
                landingPageBannerSubText.css("color", gbb.settings.pageCustomizationData.landingPage.landingPageTextColor);

                gbbLandingPageBannerButton.css("background", gbb.settings.pageCustomizationData.landingPage.landingPageButtonBgColor);
                gbbLandingPageBannerButton.css("color", gbb.settings.pageCustomizationData.landingPage.landingPageButtonTextColor);
                gbbLandingPageBannerButton.on("click", function () {
                    gbb.state.currentFlow = "byob";
                    //add params to url
                    gbb.f.addParamsToUrl("currentFlow", "byob")
                    gbb.giftboxbuilderPage.action.onNextNavigationBYOB()
                    // add pointer events none to none
                    // setTimeout(() => {
                    // gbb.utility.renderTemporaryLoadingSpinner();
                    // }, 100)
                    gbbLandingPageBannerButton.css("pointer-events", "none");
                    setTimeout(() => {
                        gbbLandingPageBannerButton.css("pointer-events", "auto");
                    }, 1000)

                    //gbb.gbbReviewPage.init(gbb.settings, "SUMMARY_PAGE")
                    //gbb.gbbAddProductsPage.init(gbb.settings, "ADD_PRODUCTS_PAGE");
                    //gbb.gbbAddProductsPage.f.insertIntoMainPageWrapper();
                });
                gbbLandingPageBannerButton.text(gbb.settings?.stepsConfigurationData?.landingPageData?.bannerButtonText);

                //gbbLandingPageBannerTextWrapper.append(landingPageBannerText);
                //gbbLandingPageBannerTextWrapper.append(landingPageBannerSubText);
                gbbLandingPageBannerButtonWrapper.append(gbbLandingPageBannerButton);
                //gbb.f.applyPrimaryColorCss(gbbLandingPageBannerButton);
                gbbLandingPageBannerTextWrapper.append(gbbLandingPageBannerButtonWrapper.clone());

                //Navigation items container
                const landingPageNavigationItemsContainer = gbb.$("<div>").addClass("gbbLandingPageNavigationItemsContainer");




                landingPageBanner.append(landingPageBannerImage);
                let nextNavigationItems = gbb.f.getNavigationItemsToDisplay(gbb.state.currentPageId);
                landingPageNavigationItemsContainer.append(gbb.f.renderNavigationHTML(landingPageNavigationItemsContainer, "landingPage", nextNavigationItems));




                gbbLandingPageHTML.append(landingPageBanner);
                gbbLandingPageHTML.append(landingPageBannerText);
                gbbLandingPageHTML.append(landingPageNavigationItemsContainer);
                gbbLandingPageHTML.append(gbbLandingPageBannerButtonWrapper);



                return gbbLandingPageHTML;

            },
            prepareFooter: function () {
                //this is a footer
                const gbbLandingPageFooterHTML = gbb.$("<div>").addClass("gbbLandingPageFooter");
                // gbbLandingPageFooterHTML.append("<div> <h1>Footer Gift Box Builder</h1> </div>");
                // return gbbLandingPageFooterHTML;
            },
            insertIntoMainPageWrapper: function () {

                gbb.$(".gbbBodyWrapper").html(gbb.state.landingPageBody);
                gbb.$(".gbbBodyWrapper").addClass(`bundle-${gbb.state.bundleId}`);
                gbb.$(".gbbBodyWrapper").children().first().hide();
                gbb.$(".gbbBodyWrapper").children().first().fadeIn(700);

            },
            registerEvents: function (settings) {
                gbb.gbbLandingPage.state.buildBoxButtonAction = function () {
                    gbb.utility.debugConsole("build box button clicked");
                    // window.alert("build box button clicked");
                };
            }

        },
        events: function (settings) {
        },
        action: {
        }
    },
    gbbAddProductsPage: {
        state: {
            buildBoxButtonAction: undefined,
            productPageKey: "",
            //TODO: @abhishek change it here
            fetchCountPerBatch: 24,
            fetchBatchStartIndex: 0,
            uniqueProductsData: [],
            currentProductsDataset: [],
            pagesWhichHaveConditionsOnPages: [],
            categoriesWhichHaveConditions: [],
            displayVariantsAsIndividualProducts: false,
            dataForInfiniteScroll: {
                noteAttribute: "",
                allProductsData: null,
                categoryId: "",
            },
            filterBySearch: {
                isSearchEnabled: false,
                searchQuery: {
                    searchField: 'title',
                    searchFieldType: String,
                    searchText: '',
                }
            },
            showBoxProductsInFooter: false,
            autoNextStepOnConditionMet: false,
            pagesWhichHaveExhaustedATCFooterAnimation: [],
            isAnimateFooterOnATCEnabled: false,
            lastClearedDiscountProgressBarValue: 0,
            totalProductSlotsRequired: 0,
            productSlotsCalculationData: [],
            isEveryConditionHaveTypeQuantity: null,
            incrementProductQtyBy: 1,
            decrementProductQtyBy: 1,
            // giftBoxData: null,
        },
        initPageX: async function (pageNumber, settings, parent) {
            // Construct the dynamic parts of the state based on the page number
            const pageId = `addProductsPage${pageNumber}`;
            const productPageKey = `productsData${pageNumber}`;
            const productsData = JSON.parse((JSON.stringify(gbb.settings.stepsConfigurationData[productPageKey])))

            if (true || pageId !== gbb.state.currentPageId) {
                gbb.gbbBrowser.emitCustomEvent({
                    eventName: "gbb-page-init",
                    detail: {
                        activePageId: pageId,
                        prevPageId: gbb.state.currentPageId,
                    }
                })
            }

            // Set the global state for the current page
            gbb.state.currentPageId = pageId;
            gbb.gbbMultipleCategoriesPage.state.currentCategoryId = undefined;
            gbb.gbbMultipleCategoriesPage.currentIndex = undefined;
            gbb.gbbAddProductsPage.state.productPageKey = productPageKey;
            gbb.gbbMultipleCategoriesPage.state.currentCategory = undefined;



            // Check if we need to use the filter logic or not
            let uniqueProductsData = productsData.uniqueProductsData;



            // get first page from the array of navigationItems.
            let navigationItems = [...gbb.state.navigationItems];


            let blackListedNavigationItems = ["landingPage", "reviewPage"];

            navigationItems = navigationItems.filter(function (item) {
                return !blackListedNavigationItems.includes(item.id);
            })


            let skipConditionalLogicFiltering = navigationItems[0].id == pageId || productsData?.skipConditionalLogicFiltering || gbb.settings.bundleSettings.conditionalLogicFilterOnFirstPageAswell || false;

            if (skipConditionalLogicFiltering == false) {
                if (productsData.pageType == "MULTIPLE_CATEGORY") {
                    let allCategoriesData = gbb.f.filterOutBasedOnConditionalLogic_MultipleCategories(productsData.categories)

                    productsData.categories = allCategoriesData;
                    // uniqueProductsData = gbb.f.filterOutBasedOnConditionalLogic(productsData.uniqueProductsData);
                } else {
                    // uniqueProductsData = productsData.uniqueProductsData; // Or some default value or logic
                    uniqueProductsData = gbb.f.filterOutBasedOnConditionalLogic(productsData.uniqueProductsData);
                }
            }


            gbb.gbbAddProductsPage.state.productPageData = productsData;
            gbb.gbbAddProductsPage.state.uniqueProductsData = uniqueProductsData;

            // reset search value
            gbb.gbbAddProductsPage.state.filterBySearch.isSearchEnabled = productsData?.filterBySearch?.isSearchEnabled || false
            gbb.gbbAddProductsPage.state.filterBySearch.searchQuery.searchFieldType = productsData?.filterBySearch?.searchFieldType || `String`
            gbb.gbbAddProductsPage.f.resetSearchTextValue()
            gbb.gbbAddProductsPage.state.dataForInfiniteScroll = {
                noteAttribute: undefined,
                allProductsData: undefined,
                categoryId: undefined,
            }
            if (gbb.settings?.app?.integrations?.judgeme?.isEnabled) {
                await gbb.gbbIntegrations?.judgeme?.init(uniqueProductsData)
            }
            gbb.gbbAddProductsPage.state.showBoxProductsInFooter = false
            // Initialize the page
            if (gbb.$("body").hasClass("gbbBodyOverflowHidden")) {  // when drawer is open and user navigates to another page in that case we will close the footer drawer
                gbb.$("body").removeClass("gbbBodyOverflowHidden")
                // gbb.$("body").css("overflow",DEFAULT_BODY_OVERFLOW_VALUE)
            }
            let bundleType = gbb.settings?.stepsConfigurationData?.bundleType || ''
            let isSubscriptionBundle = bundleType == 'SUBSCRIPTION_BUNDLE'
            if (isSubscriptionBundle) {
                let subscriptionBundlesData = gbb.settings?.stepsConfigurationData?.subscriptionBundlesData || {}
                gbb.gbbSubscriptionProductsPage.f.subscriptionBundlesInit(subscriptionBundlesData)
            }
            await gbb.gbbAddProductsPage.init(settings, parent);
            if (isSubscriptionBundle) {
                gbb.gbbSubscriptionProductsPage.f.autoScrollToActiveSellingPlanNavigation()
             }
        },
        initPage1: async function (settings, parent) {

            await gbb.gbbAddProductsPage.initPageX(1, settings, parent)
            // gbb.state.currentPageId = "addProductsPage1"
            // gbb.gbbAddProductsPage.state.productPageKey = "productsData1"
            // gbb.gbbAddProductsPage.state.productPageData = gbb.settings.stepsConfigurationData.productsData1
            // gbb.gbbAddProductsPage.state.uniqueProductsData = gbb.settings.stepsConfigurationData.productsData1.uniqueProductsData
            // await gbb.gbbAddProductsPage.init(settings, parent)
        },
        initPage2: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(2, settings, parent)
        },
        initPage3: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(3, settings, parent);
        },
        initPage4: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(4, settings, parent);
        },
        initPage5: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(5, settings, parent);
        },
        initPage6: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(6, settings, parent);
        },
        initPage7: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(7, settings, parent);
        },
        initPage8: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(8, settings, parent);
        },
        initPage9: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(9, settings, parent);
        },
        initPage10: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(10, settings, parent);
        },
        initPage11: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(11, settings, parent);
        },
        initPage12: async function (settings, parent) {
            await gbb.gbbAddProductsPage.initPageX(12, settings, parent);
        },
        init: async function (settings, parent) {
            // gbb.utility.debugConsole("INSIDE INIT");
            //clear the dom reference for gbb
            // add the data-page attribute to it as well and attach it on body

            // let productsData = await gbb.utility.getFilteredSortedProductsData(gbb.gbbAddProductsPage.state.uniqueProductsData);
            gbb.gbbAddProductsPage.f.resetFiltersInfo();
            await gbb.utility.getGiftBoxProductsFromCart()
            gbb.gbbAddProductsPage.state.fetchBatchStartIndex = 0
            let navItem = gbb.utility.getNavItem(gbb.state.currentPageId)
            gbb.f.markPreviousNavigationItemsAsCompleted(navItem)
            gbb.$("body").attr("data-page", gbb.state.currentPageId)
            //documentation: gbb.gbbAddProductsPage.state.productPageKey can be productsData1,productsData2, productsData3
            gbb.utility.initializeFiltersInfo(gbb.gbbAddProductsPage.state.productPageKey);

            //documentation: currentPageId  - addProductsPage1, addProductsPage2, addProductsPage3, addProductsPage4
            gbb.utility.setSortByValues(gbb.state.currentPageId);
            gbb.gbbAddProductsPage.f.setMapForProductsThatHavePersonalization();

            await gbb.gbbAddProductsPage.initialize(settings, parent)
            gbb.gbbAddProductsPage.f.registerEvents(settings)
            gbb.utility.renderTemporaryLoadingSpinner("hide")

            gbb.state.setInfiniteScrollTrackerForProducts = true;

            // activate this only on scroll event of page
            if (gbb.settings.app.isInfiniteScrollEnabled) {
                gbb.$(window).on('scroll', gbb.gbbAddProductsPage.events.activateInfiniteScrollForProducts);
            }
        },


        initialFetch: async function (noteAttribute, productsData) {
            //the task of the page is to get uniqueProductsDat from gbb.settings.stepsConfiguration 
            // at a given time only gbb.addProductsPage.state.fetchCountPerBatch
            // and fetch them from shopify  using  getProductsBulk (helpfull methods are present in  gbb.utility)
            //  once fetched they should all be saved in currentPageSelectedProducts for the initFn to render
            let originalProductsData = [...productsData]
            gbb.gbbAddProductsPage.state.currentProductsDataset = [];
            let response;
            // gbb.utility.debugConsole('fetching...')

            //fetchCountPerBatch 24
            //0-24
            //
            let productsToFetch = null
            try {
                //splice and fetch products from uniqueProductsData from gbb.settings.stepsConfiguration
                productsToFetch = originalProductsData.slice(0, gbb.gbbAddProductsPage.state.fetchCountPerBatch)
            } catch (e) {
                gbb.utility.debugError(e)
            }
            if (productsToFetch) {
                let listOfHandles = productsToFetch.map((product) => product.handle);
                let listOfProductIds = productsToFetch.map((product) => product.productId);
                gbb.gbbAddProductsPage.state.fetchBatchStartIndex = gbb.gbbAddProductsPage.state.fetchCountPerBatch;

                //   TOOD: SF API conditional check
                let fetchOptions = { listOfProductIds }
                response = await gbb.utility.getProductsBulkForRelevantVariants(listOfHandles, productsToFetch, fetchOptions);



                // gbb.utility.debugConsole("fetched products", response)
                gbb.utility.setMapForVariantId(response);
                response = gbb.utility.convertObjectToArray(response);

                if (gbb.gbbAddProductsPage.state.displayVariantsAsIndividualProducts) {
                    //  products has something known as variants[];
                    // now duplicate entries if theres more than one variant.
                    //use a for loop
                    // function flattenVariants(products) {
                    const flattened = [];
                    response.forEach((product) => {

                        const { variants, ...productAttrs } = product; // Extract variants and keep the rest of the product attributes

                        variants.forEach((variant) => {
                            let merged = { ...productAttrs, compare_at_price: variant.compare_at_price, variants: [variant] }; // Merge product attributes with variant attributes
                            merged = gbb.gbbAddProductsPage.f.updateProductDataWithFirstVariantData(merged)
                            flattened.push(merged);
                        });
                    });
                    response = flattened;
                    // return flattened;
                    // }
                }
            }
            if (response) {
                return response;
            }
        },

        fetchNextProductsBatch: async function (noteAttribute, allProductsData) {
            try {
                let dataFromDB;
                let resp;
                // let currentCount = gbb.gbbAddProductsPage.state.currentProductsDataset.length
                let currentCount = gbb.gbbAddProductsPage.state.fetchBatchStartIndex;

                //: remove this switch case and put just uniqueProductsData state as dependency
                dataFromDB = allProductsData;

                // if(gbb.state.addProductsFilters.activatedFilters.length>0){
                //     dataFromDB = gbb.state.currentFilteredProducts
                // }

                let productsToFetch = null;
                try {
                    productsToFetch = dataFromDB.slice(currentCount, currentCount + gbb.gbbAddProductsPage.state.fetchCountPerBatch);
                } catch (e) {
                    gbb.utility.debugError(e);
                }
                if (productsToFetch) {
                    // gbb.utility.debugConsole("products to fetch,", productsToFetch)
                    let listOfHandles = productsToFetch.map((product) => product.handle);
                    let listOfProductIds = productsToFetch.map((product) => product.productId);
                    gbb.gbbAddProductsPage.state.fetchBatchStartIndex = gbb.gbbAddProductsPage.state.fetchBatchStartIndex + gbb.gbbAddProductsPage.state.fetchCountPerBatch;
                    let fetchOptions = { listOfProductIds }

                    resp = await gbb.utility.getProductsBulkForRelevantVariants(listOfHandles, productsToFetch, fetchOptions);
                    gbb.utility.debugConsole("fetched products");
                    resp = gbb.utility.convertObjectToArray(resp);
                    gbb.utility.setMapForVariantId(resp);
                    if (gbb.gbbAddProductsPage.state.displayVariantsAsIndividualProducts) {
                        //  products has something known as variants[];
                        // now duplicate entries if theres more than one variant.
                        //use a for loop
                        // function flattenVariants(products) {
                        const flattened = [];
                        resp.forEach((product) => {
                            const { variants, ...productAttrs } = product; // Extract variants and keep the rest of the product attributes

                            variants.forEach((variant) => {
                                let merged = { ...productAttrs, variants: [variant] }; // Merge product attributes with variant attributes
                                merged = gbb.gbbAddProductsPage.f.updateProductDataWithFirstVariantData(merged);
                                flattened.push(merged);
                            });
                        });
                        resp = flattened;
                        // return flattened;
                        // }
                    }

                    //addProductsPage1Data is now currentProducts
                    gbb.gbbAddProductsPage.state.currentProductsDataset = [...gbb.gbbAddProductsPage.state.currentProductsDataset, ...resp];
                }
                // gbb.utility.debugConsole(currentCount, "/", dataFromDB.length)
                if (dataFromDB.length > currentCount) {
                    //activateLoadMore Button
                    // gbb.gbbAddProductsPage.f.activateLoadMoreButton(noteAttribute);
                } else {
                    // gbb.gbbAddProductsPage.f.deactivateLoadMoreButton()
                    gbb.gbbAddProductsPage.f.hideLoadMoreButton();
                }
                return resp;
            } catch (e) {
                gbb.utility.debugError(e);
            }
        },
        updatePageStatus: function () {
            // check the currentPageId



            const listOfPageIds = ADDPRODUCT_PAGES_LIST

            if (listOfPageIds.includes(gbb.state.currentPageId) == false) {
                return;
            }
            let navItem = gbb.f.getNavItem(gbb.state.currentPageId);
            if (navItem) {
                // navItem.addClass("gbbNavItemActive");
                navItem.isCompleted = true;
                navItem.isActive = false

                //if cart items have the values, then mark complete, else mark incomplete
            }

            //update the navigationItems  by filtering the array gbb.state.navigationItems using id
            gbb.state.navigationItems.forEach(function (item) {
                if (item.id == gbb.state.currentPageId) {
                    item = {
                        ...item,
                        navItem
                    }
                }
            })
            return true;

            // if it is addProductsPage, then find the item in the navigation list
            // and set the class to active
            // else set the class to inactive

        },
        initialize: async function (settings, parent) {
            try {
                let productPageData = gbb.gbbAddProductsPage.state.productPageData
                let isTabBasedUIEnabled = gbb.gbbAddProductsPage.state.productPageData?.isMultiCategoryTabBasedUIEnabled || false;
                gbb.gbbAddProductsPage.state.displayVariantsAsIndividualProducts = productPageData.displayVariantsAsIndividualProducts || false

                if (gbb.$(".gbbAddGiftBoxPageWrapper") && gbb.$(".gbbAddGiftBoxPageWrapper").length > 0) {
                    gbb.$(".gbbAddGiftBoxPageWrapper").remove();
                }
                let gbbAddProductsPageWrapper = gbb.$("<div>").addClass("gbbAddGiftBoxPageWrapper");

                let gbbAddProductsPageBodyHTML = ""

                if (productPageData?.pageType == "MULTIPLE_CATEGORY") {
                    if (isTabBasedUIEnabled) {
                        gbbAddProductsPageBodyHTML = await gbb.gbbMultipleCategoriesPage.f.prepareUIV2TabUI(productPageData)
                    } else {
                        gbbAddProductsPageBodyHTML = await gbb.gbbMultipleCategoriesPage.f.prepareUIV2(productPageData)
                    }
                } else {
                    gbbAddProductsPageBodyHTML = await gbb.gbbAddProductsPage.f.prepareUI();
                }





                const gbbAddProductPageSubtextWrapper = gbb.$("<div>").addClass("gbbAddProductPageSubtextWrapper");
                const gbbAddProductPageSubtext = gbb.$("<div>").addClass("gbbAddProductPageSubtext");
                const gbbDiscountComponent = gbb.$("<div>").addClass("gbbDiscountComponent");
                const gbbAddProductPageBanners = gbb.$("<div>").addClass("gbbAddProductPageBanners")


                gbbAddProductPageSubtext.html(productPageData?.productPageSubtext);
                gbbAddProductPageSubtext.css("color", gbb.settings?.pageCustomizationData?.generalSettings?.productPage?.productPageTitleColor || "black");


                if (productPageData?.pageBanners) {
                    if (productPageData.pageBanners?.mobileBanner) {
                        let mobileBanner = gbb.$("<img>").addClass("gbbMobileImageBanner")
                        mobileBanner.attr('src', productPageData.pageBanners?.mobileBanner)
                        gbbAddProductPageBanners.append(mobileBanner);
                    }
                    if (productPageData.pageBanners?.desktopBanner) {
                        let desktopBanner = gbb.$("<img>").addClass("gbbDesktopImageBanner")
                        desktopBanner.attr('src', productPageData.pageBanners?.desktopBanner)
                        gbbAddProductPageBanners.append(desktopBanner);
                    }
                }

                gbbAddProductPageSubtextWrapper.append(gbbAddProductPageSubtext);
                gbbAddProductPageSubtextWrapper.append(gbbAddProductPageBanners);
                const gbbAddProductsPageFooterHTML = gbb.gbbAddProductsPage.f.prepareFooter();
                const gbbAddProductsPageHeaderHTML = gbb.gbbAddProductsPage.f.prepareHeader();

                // if(isTabBasedUIEnabled){
                //     gbbAddProductsPageFooterHTML.addClass("tabBasedUIFooter");
                // }


                gbbAddProductsPageFooterHTML.css("background", gbb.settings.pageCustomizationData.cartFooter.cartFooterBgColor)
                gbbAddProductsPageFooterHTML.css("color", gbb.settings.pageCustomizationData.cartFooter.cartFooterTextColor)


                gbbAddProductsPageWrapper.append(gbbAddProductsPageHeaderHTML);
                gbbAddProductsPageWrapper.append(gbbAddProductPageSubtextWrapper);
                gbbAddProductsPageWrapper.append(gbbDiscountComponent);

                // ask ashfaq
                // if(isTabBasedUIEnabled){
                //     gbbAddProductsPageBodyHTML.append(gbbAddProductsPageFooterHTML);
                //     gbbAddProductsPageWrapper.append(gbbAddProductsPageBodyHTML);
                // }else{
                gbbAddProductsPageWrapper.append(gbbAddProductsPageBodyHTML);
                gbbAddProductsPageWrapper.append(gbbAddProductsPageFooterHTML);
                // }


                gbb.state.addProductsBody = gbbAddProductsPageWrapper;
                gbb.gbbAddProductsPage.f.insertIntoMainPageWrapper();
            } catch (e) {
                gbb.utility.debugConsole("error in gbbAddProductsPage init", e)
            }
        },
        f: {

            prepareHeader: function () {
                //this is a header
                let bundleType = gbb.settings?.stepsConfigurationData?.bundleType || '';
                let isSubscriptionBundle = bundleType == 'SUBSCRIPTION_BUNDLE'
                const gbbAddProductsPageHeaderHTML = gbb.$("<div>").addClass("gbbAddProductsPageHeader");
                let gbbPageHeader = gbb.$("<div>").addClass("gbbPageHeader");
                let gbbPageHeaderText = gbb.$("<div>").addClass("gbbPageHeaderText");
                gbbPageHeaderText.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.landingPage.bannerText));

                let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
                let currentPage = gbb.state.currentPageId;

                const gbbAddProductsPageBannerImage = gbb.$("<img>").addClass("gbbPageBannerImage");
                gbbAddProductsPageBannerImage.attr("src", gbb.settings.pageCustomizationData.banners.pageBannerImageSrc)
                let navigationItems = gbb.state.navigationItems;
                let stepsCount = 0;
                navigationItems = navigationItems.filter((element) => {
                    if (element.isNavBarItem && element.isNavBarItem == true) {
                        stepsCount++;
                        return element;
                    }
                })
                if (stepsCount == 1) {
                    gbbPageHeader.addClass("gbbPageHeaderWithoutLine");
                }
                const gbbAddProductsPageNavigationContainer = gbb.$("<div>").addClass("gbbAddProductsPageNavigationContainer");
                //gbbPageHeader.append(gbbPageHeaderText);

                let nextNavigationItems = gbb.f.getNavigationItemsToDisplay(gbb.state.currentPageId);

                gbbAddProductsPageNavigationContainer.append(gbb.f.renderNavigationHTML(gbbAddProductsPageNavigationContainer, currentPage, nextNavigationItems));

                // STEP PROGRESS BAR

                gbbAddProductsPageHeaderHTML.append(gbbPageHeader);
                if (isSubscriptionBundle) {
                    let subscriptionBundleWrapper = gbb.gbbSubscriptionProductsPage.f.prepareSubscriptionHeaderHTML()
                    gbbAddProductsPageHeaderHTML.append(subscriptionBundleWrapper)
                }
                gbbAddProductsPageHeaderHTML.append(gbbAddProductsPageNavigationContainer)
                return gbbAddProductsPageHeaderHTML;
            },
            prepareUI: async function () {
                let gbbAddProductsPageHTML = gbb.$("<div>").addClass("gbbAddProductsPageHTML");
                let noteAttribute = gbb.state.currentPageId;
                gbb.utility.setSortByValues(noteAttribute, "featured");

                productsData = gbb.utility.getProductsInDefaultView()
                gbbAddProductsPageHTML.append(await gbb.gbbAddProductsPage.f.renderProductsCardContainer(productsData, noteAttribute, "initFlow"));

                //no navigation will be available if there is only one step enabled - adjust the positioning
                let navigationItems = gbb.state.navigationItems;
                let stepsCount = 0;
                navigationItems = navigationItems.filter((element) => {
                    if (element.isNavBarItem && element.isNavBarItem == true) {
                        stepsCount++;
                        return element;
                    }
                })

                return gbbAddProductsPageHTML;
            },
            prepareFooter: function () {
                const gbbAddProductsPageFooterHTML = gbb.$("<div>").addClass("gbbAddProductsPageFooterHTML");
                let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey
                const currentPage = gbb.state.currentPageId
                gbbAddProductsPageFooterHTML.append(gbb.f.renderCartProductsFooterHTML(currentPage));
                return gbbAddProductsPageFooterHTML;
            },
            prepare_and_updateProductsCardContainerHTML: async function ({ allProductsData, noteAttribute, origin, categoryId }) {
                try {
                    let gbbAddProductsContainerHTML
                    let gbbProductsContainer
                    gbb.gbbAddProductsPage.f.setMapForProductsThatHavePersonalization({ categoryId: categoryId });
                    if (origin == "initFlow") {
                        gbbAddProductsContainerHTML = gbb.$("<div>").addClass("gbbAddProductsContainerHTML");
                    } else {
                        gbbAddProductsContainerHTML = gbb.utility.getCurrentPageHTML(noteAttribute);
                    }

                    let productsDataFirstBatch = await gbb.gbbAddProductsPage.initialFetch(noteAttribute, allProductsData);

                    gbb.gbbAddProductsPage.state.currentProductsDataset = productsDataFirstBatch;


                    let parentProductsContainerSelector = categoryId ? '.gbbMultipleCategoryBody' : '.gbbAddProductsContainerHTML'
                    let isProductContainerExists = gbb.$(parentProductsContainerSelector).find('.gbbProductsContainer').length > 0;
                    let productsCardHTML = gbb.f.renderProductsHTML(productsDataFirstBatch, noteAttribute, categoryId);
                    let gbbProductsItemsContainer = gbb.$("<div>").addClass("gbbProductsItemsContainer");
                    if (isProductContainerExists) {
                        gbbProductsContainer = gbb.$(".gbbProductsContainer");
                        // gbbProductsItemsContainer = gbbProductsItemsContainer.html(productsCardHTML);
                        gbbProductsItemsContainer.html(productsCardHTML);
                        gbbProductsContainer.html(gbbProductsItemsContainer)
                    } else {
                        gbbProductsContainer = gbb.$("<div>").addClass("gbbProductsContainer");

                        gbbProductsItemsContainer.append(productsCardHTML);
                        gbbProductsContainer.append(gbbProductsItemsContainer);
                    }
                    if (productsCardHTML && productsCardHTML.length <= 4) {
                        gbbProductsItemsContainer.addClass("gbbProductsItemsContainerLessProducts");
                    }
                    gbbProductsItemsContainer.attr('total-products', productsCardHTML?.length || 0)
                    // add no products available card
                    if (productsDataFirstBatch.length <= 0 && noteAttribute !== 'reviewPage') {

                        const gbbProductsNotAvailable = gbb.$("<div>").addClass("gbbProductsNotAvailable");
                        gbbProductsNotAvailable.text(gbb.utility.renderLanguageValue(gbb.settings.languageData.general.noProductsAvailable) || 'No Products Found1');

                        //replace gbbProductsNotAvailable class if available
                        if (gbb.$(".gbbProductsNotAvailable").length > 0) {
                            gbb.$(".gbbProductsNotAvailable").replaceWith(gbbProductsNotAvailable);
                        } else {
                            gbbProductsContainer.append(gbbProductsNotAvailable);
                        }
                    }

                    return {
                        gbbAddProductsContainerHTML,
                        gbbProductsContainer,
                    }
                } catch (error) {
                    gbb.utility.debugConsole("error in prepare_and_updateProductsCardContainerHTML", error)

                }

            },
            renderProductsCardContainer: async function (allProductsData, noteAttribute, origin, categoryId) {
                try {
                    let divsArray = [];
                    let { gbbAddProductsContainerHTML, gbbProductsContainer } = await gbb.gbbAddProductsPage.f.prepare_and_updateProductsCardContainerHTML({ allProductsData, noteAttribute, origin, categoryId });

                    let gbbProductsFilterTags = gbb.utility.getAllFilterTagsForProducts(allProductsData, noteAttribute);
                    if (origin == 'initFlow' || !origin) {
                        if (!categoryId) {
                            let filterSearchHeaderHTML = gbb.f.renderFiltersSearchSortHeaderHTML(noteAttribute);
                            divsArray.push(filterSearchHeaderHTML)
                        }
                        divsArray.push(gbbProductsContainer);
                        gbbAddProductsContainerHTML.html(divsArray);
                    } else if (origin == 'filtersFlow') {
                        let filterSearchHeaderHTML = gbb.f.renderFiltersSearchSortHeaderHTML(noteAttribute);
                        gbb.$('.gbbFiltersSearchSortHeader').replaceWith(filterSearchHeaderHTML);
                    }
                    const isLoadMoreButtonRequired = allProductsData.length > gbb.gbbAddProductsPage.state.fetchBatchStartIndex
                    //showLoadMoreButton needed
                    if (isLoadMoreButtonRequired) {
                        origin = origin == 'filtersFlow' ? 'resetLoadMoreRef' : origin;
                        gbb.gbbAddProductsPage.f.activateLoadMoreButton(noteAttribute, gbbAddProductsContainerHTML, allProductsData, categoryId, origin);
                    } else {
                        gbb.gbbAddProductsPage.f.hideLoadMoreButton();
                    }

                    return gbbAddProductsContainerHTML;
                } catch (error) {
                    gbb.utility.debugConsole("error in renderProductsCardContainer", error)
                }
            },
            insertIntoMainPageWrapper: function () {

                gbb.$(".gbbBodyWrapper").html(gbb.state.addProductsBody);
                //find the first child of gbbBodyWrapper and hide it in ui for 700ms
                gbb.$(".gbbBodyWrapper").children().first().hide();
                gbb.$(".gbbBodyWrapper").children().first().fadeIn(700);

                //gbb.$(".gbbNavigationItemsContainer").replaceWith(gbb.f.renderNavigationHTML())
            },
            updateProductCard: function (productId, variantId) {

                let productItem = gbb.$(".gbbProductsContainer").find(`[productId='${productId}']`);

                // now filter based on firstvariantid as well 
                if (variantId) {
                    let productItem_temp = gbb.$(".gbbProductsContainer").find(`[productId='${productId}'][firstvariantid='${variantId}']`);
                    // gbb.utility.debugConsole("productItems array length",productItem.length)
                    // productItem = 
                    if (productItem_temp.length > 0) {
                        productItem = productItem_temp;
                    }

                    // productItem = gbb.$(".gbbProductsContainer").find(``);
                }
                let categoryId = (productItem).parents(".gbbCategoryContainer").attr("categoryid");
                let product = gbb.utility.getProductDetailsFromState(productId, variantId);

                let noteAttribute = gbb.state.currentPageId;

                let newProductItemHTML = gbb.f.renderProductsHTML([product], noteAttribute, categoryId);
                // gbb.$(".gbbPageBody").find(`[productId='${productId}']`).replaceWith(newProductItemHTML);
                productItem.replaceWith(newProductItemHTML);

            },
            resetFiltersInfo: function () {
                // gbb.state.addProductsFilters.isFiltersActive
                // gbb.state.addProductsFilters.activatedFilters
                // gbb.state.addProductsFilters.priceFilterActive
                // gbb.state.addProductsFilters.addProductsActivatedFilters;
                gbb.state.addProductsFilters = {
                    isFiltersActive: false,
                    activatedFilters: [],
                    priceFilterActive: false,
                    addProductsActivatedFilters: []
                }

            },
            resetSearchTextValue: function () {
                gbb.gbbAddProductsPage.state.filterBySearch.searchQuery.searchText = '';
            },
            hideExcessProducts: function (gbbAddProductsContainerHTML) {
                let productsCount = gbbAddProductsContainerHTML.find(".gbbProductItem").length;
                if (productsCount > (gbb.gbbAddProductsPage.state.fetchCountPerBatch)) {
                    gbbAddProductsContainerHTML.find(".gbbProductItem").each(function (index) {
                        if (index >= (gbb.gbbAddProductsPage.state.fetchCountPerBatch)) {
                            gbb.$(this).hide();
                        }
                    })
                    // commenting out (no use case for this as of now)
                    // gbb.gbbAddProductsPage.f.activateLoadMoreButton();
                }
            },
            loadMoreProducts: async function (noteAttribute, allProductsData, categoryId) {

                // gbb.utility.debugConsole("")

                if (categoryId) {
                    gbb.utility.debugConsole("fetching products from category: ", categoryId)
                }
                let productItemsHTML = gbb.$(".gbbProductItem")
                //find the productItems that are not hidden
                let currentProductItems = gbb.gbbAddProductsPage.state.currentProductsDataset;


                let productsCount = currentProductItems.length;
                let productsToShow = gbb.gbbAddProductsPage.state.fetchCountPerBatch;
                //: this condition is not in shape
                if (true) {

                    let startIndex = productsCount - 1;
                    gbb.utility.debugConsole("fetching starts.. in loadMoreProducts")
                    const productsData = await gbb.gbbAddProductsPage.fetchNextProductsBatch(noteAttribute, allProductsData)
                    if (productsData && productsData.length > 0) {
                        let productItems = gbb.f.renderProductsHTML(productsData, noteAttribute, categoryId);
                        if (productItems && productItems.length > 0) {
                            gbb.$(".gbbProductsItemsContainer").append(productItems);
                        }
                    }

                    //append product items to the container

                    let dbDataCount = allProductsData.length
                    let fetchBatchStartIndex = gbb.gbbAddProductsPage.state.fetchBatchStartIndex
                    if (fetchBatchStartIndex >= dbDataCount) {
                        //scrollBarListener is disabled
                        gbb.utility.debugConsole("scrollBarListener is disabled from loadMoreProductsFn:")
                        gbb.state.setInfiniteScrollTrackerForProducts = false;
                        gbb.$(".gbbLoadMoreProductsButton").hide();
                    }
                }
            },
            activateLoadMoreButton: function (noteAttribute, parentEle, allProductsData, categoryId, origin) {

                // if already present
                if (origin == 'resetLoadMoreRef' || gbb.gbbAddProductsPage.state.filterBySearch?.searchQuery?.searchText?.length > 0) {
                    // continue processing
                }
                else if (!categoryId) {
                    if (gbb.$(".gbbLoadMoreProductsButton").length > 0) {
                        // alert("already found load more btuton")
                        return;
                    }
                }

                let attachButtonTo = parentEle || gbb.$(".gbbLoadMoreProductsButton").parent();
                gbb.gbbAddProductsPage.state.dataForInfiniteScroll = {
                    noteAttribute: noteAttribute,
                    allProductsData: allProductsData,
                    categoryId: categoryId
                }

                let loadMoreButton = gbb.$("<div>").addClass("gbbLoadMoreProductsButton");
                loadMoreButton.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.general?.loadMoreProductsButtonText) || "Load More Products1");
                loadMoreButton.on("click", async function () {
                    gbb.utility.disableElement(loadMoreButton, 500);
                    await gbb.gbbAddProductsPage.f.loadMoreProducts(noteAttribute, allProductsData, categoryId);
                })
                // if (gbb.$(".gbbLoadMoreProductsButton").length <= 0) {
                //     gbb.$(attachButtonTo).append(loadMoreButton);
                // } else {
                //     let loadMoreBtn = gbb.$(".gbbLoadMoreProductsButton")
                //     loadMoreBtn.text('REPLACED')
                //     loadMoreBtn.replaceWith(loadMoreButton)
                // } In multicategory we were updating dom -> then we were updating parentEle container -> here we were loosing load more btn ref
                if (gbb.$(".gbbLoadMoreProductsButton").length > 0) {
                    gbb.$(".gbbLoadMoreProductsButton").remove()
                }
                gbb.$(attachButtonTo).append(loadMoreButton);

                return loadMoreButton

            },
            hideLoadMoreButton: function () {
                //scrollBarListener is disabled
                gbb.utility.debugConsole("scrollBarListener is disabled from hideLoadMoreButton:")
                gbb.state.setInfiniteScrollTrackerForProducts = false;
                gbb.$(".gbbLoadMoreProductsButton").hide();
            },
            registerEvents: function (settings) {
                gbb.gbbAddProductsPage.state.buildBoxButtonAction = function () {
                    gbb.utility.debugConsole("build box button clicked");
                };
            },
            renderNextPage: async function (pageId) {
               try {
                   let noteAttribute = gbb.state.currentPageId
                   let currentPageRank = gbb.utility.getPageRankByPageId(noteAttribute)
                   let pageToRenderRank = gbb.utility.getPageRankByPageId(pageId)
                   let renderPrevStep = pageToRenderRank < currentPageRank
                   let condition = !renderPrevStep && await gbb.utility.checkConditionsOnNext(noteAttribute, "", true);
                   if (renderPrevStep || condition.isConditionMet) {
                       gbb.utility.renderTemporaryLoadingSpinner("show")
                       gbb.giftboxbuilderPage.action.onNextNavigationBYOB(pageId);
                   }
               } catch (error) {
                    gbb.utility.debugConsole("error in renderNextPage", error)
               }
            },
            createArraysOfPageWhichHaveConditions: function () {

                // each of these fields has an array of conditions, if empty then check if they have an object with key as "categories"
                // if they have an object with key as "categories" then check if the objects keys have a conditions array
                // if they have a conditions array then check if the conditions array is empty
                // if not empty then copy the category id and push to the array 
                let pagesWhichHaveConditionsOnPages = [];
                let pagesWhichHaveConditionOnCategories = [];
                let categoriesWhichHaveConditions = [];

                // so in gbb.settings.stepsConfigurationData
                // there are fields such as productsData1 ...... till 12.
                for (let i = 0; i < Object.keys(gbb.settings.stepsConfigurationData).length; i++) {
                    // object keys are productsData1, productsData2, productsData3, productsData4, productsData5, productsData6, productsData7, productsData8, productsData9, productsData10, productsData11, productsData12
                    // so we are looping through each of these keys
                    let _key = Object.keys(gbb.settings.stepsConfigurationData)[i];
                    let currData = gbb.settings.stepsConfigurationData[_key];
                    _key = String(_key)
                    if (_key.includes("productsData")) {
                        //now check if the productsData has a conditions array
                        if (currData?.conditions?.length > 0) {
                            // if it has a conditions array then push the page name to the pagesWhichHaveConditionsOnPages array
                            pagesWhichHaveConditionsOnPages.push(_key);
                        } else {
                            // currData
                            //check if the productsData has a categories object
                            if (currData?.categories) {
                                // if it has a categories object then loop through the categories object
                                for (let [key, value] of Object.entries(currData.categories)) {
                                    // if the categories object has a conditions array then push the page name to the pagesWhichHaveConditionOnCategories array
                                    if (value?.conditions?.length > 0) {
                                        pagesWhichHaveConditionOnCategories.push(_key);
                                        categoriesWhichHaveConditions.push(key);
                                    }
                                }
                            }
                        }
                    }
                }

                // now we have an array of pages which have conditions on pages and pages which have conditions on categories
                // we also have an array of categories which have conditions
                // now we need to check if the current product has any of the categories which have conditions
                // if it does then we need to check if the current product has any of the conditions

                // in the pagesWhichHaveCondtionOnCategories array we have the page names. change the page number from productsData1 to addProductsPage1
                // and similarly

                pagesWhichHaveConditionsOnPages.forEach((page, index) => {
                    pagesWhichHaveConditionsOnPages[index] = page.replace("productsData", "addProductsPage");
                })

                gbb.gbbAddProductsPage.state.pagesWhichHaveConditionsOnPages = pagesWhichHaveConditionsOnPages;
                gbb.gbbAddProductsPage.state.categoriesWhichHaveConditions = categoriesWhichHaveConditions;

            },
            setMapForProductsThatHavePersonalization: function (options = {}) {
                try {
                    let map = {};
                    let keyAttribute = gbb.gbbAddProductsPage.state.productPageKey;
                    let currentProductsData = JSON.parse(JSON.stringify(gbb.settings.stepsConfigurationData[keyAttribute]));
                    let categoryProductsData;

                    if (currentProductsData && currentProductsData.pageType == "MULTIPLE_CATEGORY") {
                        // gbb.utility.debugConsole("multiple category page")
                        //create a map for each
                        //object.keys(currentProductsData.categories).forEach((category) => {

                        let categoryIds = Object.keys(currentProductsData.categories);

                        options.categoryId = options.categoryId || currentProductsData?.categories[categoryIds[0]]?.categoryId;
                        categoryProductsData = currentProductsData.categories[options.categoryId];

                        currentProductsData = categoryProductsData;
                    }
                    let productFormData = currentProductsData.productPersonalization;
                    if (productFormData && productFormData.isProductPersonalizationEnabled == true) {
                        if (productFormData?.isEnabledForSelectedProducts == true) {
                            productFormData.selectedProducts.forEach((product) => {
                                map[product.productId] = { formBlocks: productFormData.formBlocks };
                            });
                        } else if (productFormData?.isEnabledForAllProducts == true) {
                            // create a map out of  this data but select only productId
                            currentProductsData.uniqueProductsData.forEach((product) => {
                                map[product.productId] = { formBlocks: productFormData.formBlocks };
                            });
                        } else {
                            // none; no map needed
                        }

                        gbb.gbbAddProductsPage.state.productPersonalizationData = productFormData;
                        gbb.gbbAddProductsPage.state.productPersonalizationMap = map;
                    } else {
                        gbb.gbbAddProductsPage.state.productPersonalizationData = null;
                        gbb.gbbAddProductsPage.state.productPersonalizationMap = null;
                    }
                } catch (error) {
                    gbb.utility.debugConsole("error in setMapForProductsThatHavePersonalization", error);
                }
            },
            updateProductDataWithFirstVariantData: function (productData) {
                try {
                    let firstVariantData = productData.variants[0];
                    // productData.title = firstVariantData.name || productData.title;
                    productData.title = productData.title;
                    productData.variantName = firstVariantData.public_title == "Default Title" ? "" : firstVariantData.public_title;
                    productData.renderChooseOptionsButton_forcefully = false
                    productData.featured_image = firstVariantData.image || productData.featured_image;
                    // push the firstVariantData.image into the product.images. but the firstVariantData.image should be the first element
                    productData.images = [firstVariantData.image, ...productData.images];
                    if (gbb?.settings?.bundleSettings?.removeUnUsedVariantImages) {
                        productData = gbb.utility.removeUnUsedVariantImages(productData)
                    }
                    productData = gbb.utility.shiftFirstVariantMedia_toFirstIndexInMediaObj(productData);
                    //find the "https://cdn.shopify.com/s/files/1/0603/6874/8751/products/Candle_UH_Back.png?v=1639895559"
                    // in the 
                    // productData.media = [... new Set(firstVariantData.featured_image, ...productData.media)]
                    return productData;
                } catch (error) {
                    gbb.utility.debugConsole("error in updateProductDataWithFirstfirstVariantDataData", error)
                }
            },
            handleAutoNextStep: async function (options) {
                try {
                    // return;
                    // let conditionRules = options.condition.conditions;
                    // let condition = options.condition;
                    let currentPageId = gbb.state.currentPageId;
                    // 

                    let activeConditionConfig = gbb.gbbAddProductsPage.f.getConditionConfig_basedOnCurrentPageOrCategory(gbb.state.currentPageId);

                    let validConditionTypesForAutoNext = ["equalTo"]

                    let conditionRules = activeConditionConfig.conditions;

                    if (conditionRules && conditionRules.length > 0 && conditionRules.length == 1
                        && validConditionTypesForAutoNext.includes(conditionRules[0].condition)
                        && activeConditionConfig.autoNextStepOnConditionMet == true) {
                        await gbb.utility.checkConditionsAndProceedToNextPage(currentPageId);
                    }


                } catch (error) {
                    gbb.utility.debugConsole("error in handleAutoNextStep", error)
                }
            },
            getConditionConfig_basedOnCurrentPageOrCategory: function (pageId) {
                try {
                    // from active pageId, get if its a productPageData 
                    let currentPageData = gbb.gbbAddProductsPage.state.productPageData;
                    let result = {
                        conditions: [],
                        autoNextStepOnConditionMet: false
                    }
                    if (!currentPageData) {
                        return result
                    }
                    //give priorty to global config conditions
                    if (currentPageData.conditions && currentPageData.conditions.length > 0) {
                        //if present then return the conditions
                        result.conditions = currentPageData.conditions;
                        result.autoNextStepOnConditionMet = currentPageData.autoNextStepOnConditionMet;
                    }

                    if (currentPageData.pageType == "MULTIPLE_CATEGORY" && gbb.gbbAddProductsPage.state.productPageData.isPageConditionsEnabled != true) {
                        // get active category id
                        let currentCategoryId = gbb.gbbMultipleCategoriesPage.state.currentCategoryId;

                        // get conditions for the currentCategoryId
                        let categoryData = currentPageData.categories[currentCategoryId];
                        if (categoryData.conditions && categoryData.conditions.length > 0) {
                            result.conditions = categoryData.conditions;
                        }

                        result.autoNextStepOnConditionMet = categoryData.autoNextStepOnConditionMet;

                    }

                    return result;
                    //if MULTIPLE_CATEGORY then 
                    // get the currentCategoryId. 
                } catch (error) {
                    gbb.utility.debugConsole("error in getConditionConfig_basedOnCurrentPageOrCategory", error)
                }
            },
            prepareHTMLforProductMetafields: function (productData,origin) {
                try {
                    const metafieldNameSpaceAndKeys = gbb.settings.bundleSettings.metafieldNameSpaceAndKeys || []
                   
                    if (!metafieldNameSpaceAndKeys.length) return ''
                    // filter origin 
                    let metafieldWrapper = gbb.$("<div>").addClass('productsMetafieldWrapper')
                    const validMetafieldTypes = ["single_line_text_field","multi_line_text_field"] //only allow the type whose value we can get root level -- for eg : metafield.value 
                    for (let i = 0; i < metafieldNameSpaceAndKeys.length; i++){
                        let metafieldData = metafieldNameSpaceAndKeys[i]
                        if (metafieldData.hasOwnProperty("showOnProductCard") || metafieldData.hasOwnProperty("showOnModal")) { 
                            if (origin == 'PRODUCT_CARD' && !metafieldData.showOnProductCard) {
                                continue
                            }
                            else if (origin == 'PRODUCT_VARIANTS_MODAL' && !metafieldData.showOnModal) {
                                continue
                            } 
                        }
                        let productMetafieldAccessKey = `metafield_${metafieldData?.namespace}_${metafieldData?.key}`
                        let productMetafieldData = productData[productMetafieldAccessKey] || {}
                        if (validMetafieldTypes.includes(productMetafieldData?.type)) {
                            let divToAppend = gbb.$('<div>').addClass(`product_metafield_${metafieldData?.key}`).attr('metafield-key', metafieldData?.key)
                            divToAppend.text(productMetafieldData?.value)
                            metafieldWrapper.append(divToAppend)
                        }
                    }
                    return metafieldWrapper;
                } catch (error) {   
                    gbb.utility.debugConsole("error in prepareHTMLforProductMetafields", error)
                }
            },
            renderProductDynamicContent: function (productData,origin) {
                try {
                    // the value will be present in 
                    // let content = `<div>
                    //  ${productData?.metafield_gbbNameSpace_test?.value}
                    // </div>`
                    if(gbb.settings.app.dynamicScriptForHTMLContent){
                        return eval(gbb.settings.app.dynamicScriptForHTMLContent)
                    } else {
                        return gbb.gbbAddProductsPage.f.prepareHTMLforProductMetafields(productData,origin)
                    }
                   
                    // prodCard
                    // popup 
                    // dono dikhao
                    
                    // return content;
                    // return eval(gbb.settings.app.dynamicScriptForHTMLContent)

                    // gbb.settings.app.dynamicHTMLContent
                    // retu
                    // return gbb.settings.app.dynamicHTMLContent;

                } catch (e) {
                    gbb.utility.debugConsole("error in renderProductDynamicContent", e)
                }
            },
            getSearchedProductInBundlePage: function (query, productsData) {
                try {
                    // query -> contains the search params eg: {title:'val'} || {tags:'spo-default'}
                    // productsData is the array of products on which we will implement search functionality 
                    let searchKey = Object.keys(query)[0] || 'title';
                    let searchVal = query[searchKey] || '';
                    searchVal = searchVal?.toString()?.trim()?.toLowerCase();
                    let searchType = gbb.gbbAddProductsPage.state.filterBySearch.searchQuery.searchFieldType || 'String'
                    let searchedProducts = [];

                    switch (searchType) {
                        case 'String': {
                            searchedProducts = productsData?.filter((product) => {
                                return product[searchKey]?.toLowerCase()?.trim()?.includes(searchVal);
                            })
                            break
                        }
                        case 'Array': {
                            for (let i = 0; i < productsData.length; i++) {
                                let product = productsData[i];
                                // product[searchKey] => product[tags] = ['snow','sport'] => array
                                if (product[searchKey] && product[searchKey].length > 0) {
                                    for (let j = 0; j < product[searchKey].length; j++) {
                                        let arrayElement = product[searchKey][j]?.toString()?.toLowerCase()?.trim()
                                        if (arrayElement?.includes(searchVal)) {
                                            searchedProducts.push(product)
                                        }
                                    }
                                }
                            }
                            // searchedProducts = productsData?.filter((product) => {
                            //     if (product[searchKey] && product[searchKey].length > 0) { 
                            //         return product[searchKey]?.some((el) => {
                            //             let arrayElement = el?.toString()?.toLowerCase()?.trim()
                            //             return arrayElement?.includes(searchVal);
                            //         })
                            //     }
                            // })
                            break
                        }
                        default: {
                            searchedProducts = productsData
                        }
                    }
                    return searchedProducts;
                } catch (e) {
                    gbb.utility.debugConsole("error in getSearchedProductInBundlePage", e)

                }
            },
            handleSearchBundleInput: async function (value, noteAttribute) {
                try {
                    let isFilterActive = gbb.utility.getActivatedFilters(noteAttribute).length > 0
                    gbb.gbbAddProductsPage.state.filterBySearch.searchQuery.searchText = value
                    let pageType = gbb.gbbAddProductsPage.state.productPageData.pageType
                    let categoryId = gbb.gbbMultipleCategoriesPage.state.currentCategoryId

                    let totalProducts = pageType == 'MULTIPLE_CATEGORY' ? gbb.gbbAddProductsPage.state.productPageData.categories[categoryId].uniqueProductsData : gbb.gbbAddProductsPage.state.uniqueProductsData

                    if (isFilterActive) {
                        totalProducts = await gbb.utility.getFilteredSortedProductsData(noteAttribute, 'searchProductsFlow')
                    }
                    let keyToSearch = gbb.gbbAddProductsPage.state.filterBySearch.searchQuery.searchField || 'title';
                    let searchQueryParams = {
                        [keyToSearch]: gbb.gbbAddProductsPage.state.filterBySearch.searchQuery.searchText
                    }
                    // reset load more btn ref if search value is cleared 
                    // to load normal products with load more functionality
                    if (value.trim().length <= 0) {
                        let gbbAddProductsContainerHTML = gbb.$('.gbbAddProductsContainerHTML')
                        gbb.gbbAddProductsPage.f.activateLoadMoreButton(noteAttribute, gbbAddProductsContainerHTML, totalProducts, categoryId, 'resetLoadMoreRef');
                    }

                    let searchedProducts = gbb.gbbAddProductsPage.f.getSearchedProductInBundlePage(searchQueryParams, totalProducts)
                    gbb.state.setInfiniteScrollTrackerForProducts = true;

                    return searchedProducts
                } catch (error) {
                    gbb.utility.debugConsole("error in handleSearchBundleInput", error)
                }
            },
            renderShowBoxProductsToggleHTML: function () {
                try {
                    let gbbShowBoxProductsToggleContainer = gbb.$('<div>').addClass('gbbShowBoxProductsToggleContainer')
                    gbbShowBoxProductsToggleContainer.append(PLAIN_CHEVRON_UP_SVG)
                    if (gbb.gbbAddProductsPage.state.showBoxProductsInFooter) {
                        gbbShowBoxProductsToggleContainer.css('transform', 'rotate(180deg)');
                    }

                    if (gbb.state.giftBoxCartData?.items?.length <= 0) {
                        gbbShowBoxProductsToggleContainer.css('transform', 'rotate(0deg)');
                        gbb.gbbAddProductsPage.state.showBoxProductsInFooter = false;

                    }
                    return gbbShowBoxProductsToggleContainer;
                } catch (error) {
                    gbb.utility.debugConsole("error in renderShowBoxProductsToggleHTML", error)
                }
            },
            renderCartIconWithQuantityHTML: function () {
                try {
                    let _boxData = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
                    let cartIconWithQuantity = gbb.$('<div>').addClass('gbbCartIconWithQuantityContainer')
                    let cartIconWithQuantityText = gbb.$('<div>').addClass('gbbCartIconWithQuantityText')
                    let cartQuantity = gbb.$('<div>').addClass('gbbCartQuantity')
                    let cartQuantityValue = _boxData?.item_count || 0

                    cartIconWithQuantity.css('background', gbb.settings?.pageCustomizationData?.cartFooter?.cartFooterNextButtonColor || '#000000')
                    cartIconWithQuantity.css("color", gbb.settings?.pageCustomizationData?.cartFooter?.cartFooterNextButtonTextColor || '#ffffff')

                    // cartIconWithQuantity.click(gbb.gbbAddProductsPage.f.toggleBoxProductsDisplayFooter)

                    cartQuantity.text(cartQuantityValue)
                    cartIconWithQuantityText.append(cartQuantity)
                    cartIconWithQuantity.append(cartIconWithQuantityText)
                    cartIconWithQuantity.append(CART_SVG)
                    return cartIconWithQuantity;
                } catch (error) {
                    gbb.utility.debugConsole("error in renderCartIconWithQuantityHTML", error)
                }
            },
            toggleBoxProductsDisplayFooter: function () {
                if (gbb.state.giftBoxCartData?.items?.length <= 0) {
                    return
                }
                let isShowProductsActive = gbb.gbbAddProductsPage.state.showBoxProductsInFooter;
                let gbbFooterProductsContainer = gbb.$('.gbbFooterProductsContainer')
                let gbbSlotFooterProductsContainerWrapper = gbb.$(".gbbSlotFooterProductsContainerWrapper")
                // let gbbShowBoxProductsToggleContainer = gbb.$('.gbbShowBoxProductsToggleContainer')
                if (gbbFooterProductsContainer.is(':visible')) {
                    gbbFooterProductsContainer.slideUp(700); // Hide with animation
                    gbb.$("body").removeClass("gbbBodyOverflowHidden")
                    // gbbShowBoxProductsToggleContainer.css('transform', 'rotate(0deg)')
                    gbbSlotFooterProductsContainerWrapper && gbbSlotFooterProductsContainerWrapper.slideDown(700)
                    // gbb.$("body").css("overflow-y", DEFAULT_BODY_OVERFLOW_VALUE);
                } else {
                    gbbFooterProductsContainer.slideDown(700); // Show with animation
                    // gbb.$('body').css('overflow-y', 'hidden');
                    gbb.$("body").addClass("gbbBodyOverflowHidden")
                    gbbSlotFooterProductsContainerWrapper && gbbSlotFooterProductsContainerWrapper.slideUp(700)
                    // gbbShowBoxProductsToggleContainer.css('transform', 'rotate(180deg)');
                }
                gbb.gbbAddProductsPage.state.showBoxProductsInFooter = !isShowProductsActive;
            },
            renderShowBoxProductsInFooterHTML: function () {
                try {
                    let _boxData = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
                    let showBoxProductsInFooter = gbb.$('<div>').addClass('showBoxProductsInFooter')
                    let showBoxProductsInFooterText = gbb.$('<div>').addClass('showBoxProductsInFooterText')
                    showBoxProductsInFooterText.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.general?.viewCartProductsLabel) || 'View Selected Products')
                    // showBoxProductsInFooterText.append(" ").append(`(${_boxData?.item_count})`)
                    // let toggleForDisplayProducts = gbb.gbbAddProductsPage.f.renderShowBoxProductsToggleHTML()
                    showBoxProductsInFooter.click(gbb.gbbAddProductsPage.f.toggleBoxProductsDisplayFooter)
                    showBoxProductsInFooter.append(showBoxProductsInFooterText)
                    return showBoxProductsInFooter
                } catch (e) {
                    gbb.utility.debugConsole("error in renderShowBoxProductsInFooterHTML", e)
                }

            },
            renderProgressBarHTML: function (configOptions) {
                try {
                    const { filledPercentage, filledColor, emptyColor } = configOptions
                    let progressBarContainer = gbb.$('<div>').addClass('progressBarContainer')
                    let progressBar = gbb.$('<div>').addClass('progressBar')
                    progressBar.css('background', emptyColor)
                    let progressBarFill = gbb.$('<div>').addClass('progressBarFill')
                    progressBarFill.css('background', filledColor)
                    let animationConfig = {
                        start: gbb?.gbbAddProductsPage?.state?.lastClearedDiscountProgressBarValue || 0,
                        end: filledPercentage
                    }
                    progressBarFill.css('width', animationConfig?.start + '%')
                    progressBarFill.animate({ width: animationConfig?.end + '%' }, 500)

                    progressBar.append(progressBarFill)
                    progressBarContainer.append(progressBar)
                    gbb.gbbAddProductsPage.state.lastClearedDiscountProgressBarValue = filledPercentage
                    return progressBarContainer;
                } catch (error) {
                    gbb.utility.debugConsole("error in renderProgressBarHTML", error)
                }
            },
            calculateProductSlotsData: function () {
                try {
                    let totalNoOfSlotsRequired = 0
                    let productSlotsCalculationArray = []
                    let stepsConfigurationData = gbb.settings?.stepsConfigurationData
                    for (let i = 1; i <= 12; i++) {// max page can be 12
                        let currentPageData = stepsConfigurationData[`productsData${i}`]
                        if (gbb.gbbAddProductsPage.state?.isEveryConditionHaveTypeQuantity == false) {
                            break
                        }
                        if (!currentPageData) { // if page 6 is not present then no point checking page 7,8,9....12
                            break
                        }
                        if (!currentPageData?.isProductsEnabled) {
                            continue
                        }
                        let isMultiCategory = currentPageData?.pageType == 'MULTIPLE_CATEGORY' ? true : false
                        if (isMultiCategory && currentPageData?.isPageConditionsEnabled != true) { // if pageLevel condition is false for multicategory then only we will check categories conditions else pagelevel conditions will be considered
                            for (let key in currentPageData?.categories) {
                                let currentCategoryData = currentPageData?.categories[key]
                                if (currentCategoryData?.conditions && currentCategoryData?.conditions?.length > 0) {
                                    let slotsRequiredForThisStep = gbb.gbbAddProductsPage.f.calculateNumberOfSlotsRequired(currentCategoryData?.conditions)
                                    totalNoOfSlotsRequired += slotsRequiredForThisStep
                                    productSlotsCalculationArray.push({
                                        pageId: `addProductsPage${i}`,
                                        categoryId: key,
                                        slotsRequired: slotsRequiredForThisStep
                                    })
                                }
                            }
                        } else {
                            if (currentPageData?.conditions && currentPageData?.conditions?.length > 0) {
                                let slotsRequiredForThisStep = gbb.gbbAddProductsPage.f.calculateNumberOfSlotsRequired(currentPageData?.conditions)
                                totalNoOfSlotsRequired += slotsRequiredForThisStep
                                productSlotsCalculationArray.push({
                                    pageId: `addProductsPage${i}`,
                                    categoryId: null,
                                    slotsRequired: slotsRequiredForThisStep
                                })
                            }
                        }
                        gbb.gbbAddProductsPage.state.productSlotsCalculationData = productSlotsCalculationArray
                        gbb.gbbAddProductsPage.state.totalProductSlotsRequired = totalNoOfSlotsRequired
                        if (gbb.gbbAddProductsPage?.state?.isEveryConditionHaveTypeQuantity == null) { // we change this flag to false if any of the condition does not have type as quantity ---- if this flag is null which means all conditions have type as quantity
                            gbb.gbbAddProductsPage.state.isEveryConditionHaveTypeQuantity = true
                        }
                    }
                } catch (error) {
                    gbb.utility.debugConsole("error in initializeProductSlotsData", error)
                }
            },
            calculateNumberOfSlotsRequired: function (conditionsArray) {
                try {
                    let slotsRequiredForThisStep = 0
                    let calculationRule = "Maximum"
                    let conditionTypesToExclude = []
                    let conditionValues = []
                    for (let i = 0; i < conditionsArray.length; i++) {
                        let currentCondition = conditionsArray[i]
                        if (currentCondition.type != 'quantity') {
                            gbb.gbbAddProductsPage.state.isEveryConditionHaveTypeQuantity = false
                            return 0
                        }
                        if (!conditionTypesToExclude.includes(currentCondition.condition)) {
                            conditionValues.push(+currentCondition.value)
                        }
                    }
                    if (conditionValues.length > 0) {
                        if (calculationRule == "Minimum") {
                            slotsRequiredForThisStep = Math.min(...conditionValues)
                        } else {
                            slotsRequiredForThisStep = Math.max(...conditionValues)
                        }
                    }
                    return slotsRequiredForThisStep
                } catch (error) {
                    gbb.utility.debugConsole("error in calculateNumberOfSlotsRequired", error)
                }
            },
            autoScrollSlotsOnNavigation: function () {
                try {
                    let productsContainer = gbb.$(".gbbSlotFooterProductsContainer")
                    let totalNoOfEmptySlots = productsContainer.find(".gbbSlotFooterProductContainerEmpty").length
                    let totalNoOfFilledSlots = productsContainer.find(".gbbSlotFooterProductContainer").not('.gbbSlotFooterProductContainerEmpty').length
                    // let totalNoOfSlotsToScroll = totalNoOfFilledSlots - 1

                    let minimumSlotsToScroll = -1 * Math.min(totalNoOfFilledSlots, 3)
                    let lastFilledCardToScroll = productsContainer.find(".gbbSlotFooterProductContainer").not(".gbbSlotFooterProductContainerEmpty").eq(minimumSlotsToScroll)
                    lastFilledCardToScroll.length > 0 && lastFilledCardToScroll[0].scrollIntoView({ behavior: "smooth", block: "nearest", inline: "start" });
                    // if (totalNoOfEmptySlots > 0) {
                    // let card = productsContainer.find('.gbbSlotFooterProductContainer');
                    // let cardWidth = card[0].offsetWidth
                    // let distanceToScroll = (totalNoOfSlotsToScroll * cardWidth) + (totalNoOfSlotsToScroll * 10)
                    // productsContainer.animate({
                    //     scrollLeft:distanceToScroll
                    // },300)
                    // } 

                } catch (error) {
                    gbb.utility.debugConsole("error in autoScrollSlotsOnNavigation", error)
                }
            },
            // autoScrollSlotsBasedOnATC: function (flow) {
            //     try {
            //         let gbbSlotFooterProductsContainerWrapper = gbb.$('.gbbSlotFooterProductsContainerWrapper')
            //         let visibleContentWidth = gbbSlotFooterProductsContainerWrapper.width()
            //         let containerLeft = gbbSlotFooterProductsContainerWrapper.scrollLeft();
            //         let distanceToScroll = 0 
            //         let productCardsContainer = gbb.$(".gbbSlotFooterProductsContainer")
            //         let emptyCardFound = false
            //         //  find the last child which has class gbbSlotFooterProductContainer and doesnt contain gbbSlotFooterProductContainerEmpty

            //         if (flow == "addToCart") {
            //             productCardsContainer.find(".gbbSlotFooterProductContainer").each(function (index) {
            //                 let productCard = gbb.$(this)

            //                 let isProductSlotEmpty = productCard.hasClass("gbbSlotFooterProductContainerEmpty")
            //                 if (isProductSlotEmpty) {
            //                     let productCardLeft =  productCard.position().left; 
            //                     let productCardRight = productCardLeft + productCard.width();

            //                     // Check if the card is already visible within the container's width
            //                     if (productCardLeft >= containerLeft && productCardRight <= visibleContentWidth) {
            //                         emptyCardFound = true;
            //                     } else {
            //                         let previousCardLeft = productCard.prev().position().left
            //                         distanceToScroll = previousCardLeft
            //                         // use scrollIntoView to scroll to the card 
            //                         previousCardLeft[0].scrollIntoView({ behavior: "smooth", block: "nearest", inline: "start" });
            //                         // gbb.$(".gbbSlotFooterProductsContainer").animate({
            //                         //     scrollLeft: productCard.prev()
            //                         //     }, 500)
            //                     }
            //                     return false; // Exit the loop once the first empty card is found
            //                 }
            //             })
            //             // Scroll to the first empty card if it is not visible
            //             // if (!emptyCardFound && distanceToScroll > 0) {
            //             //     gbb.$(".gbbSlotFooterProductsContainer").animate({
            //             //         scrollLeft:  distanceToScroll
            //             //     }, 500)
            //             // }
            //         } else if (flow == "removeFromCart") {
            //             let lastFilledCard = productCardsContainer.find(".gbbSlotFooterProductContainer").not(".gbbSlotFooterProductContainerEmpty").last()
            //             let lastFilledCardLeft = lastFilledCard?.position().left;
            //             // last filledCard is inside visbility then dont scroll 
            //             let lastFilledCardRight = lastFilledCardLeft + lastFilledCard.width();
            //             // if (lastFilledCardRight > visibleContentWidth) {
            //             //     distanceToScroll = lastFilledCardLeft - containerLeft;
            //             //     gbb.$(".gbbSlotFooterProductsContainer").animate({
            //             //         scrollLeft: lastFilledCardLeft
            //             //     }, 500)
            //             // }

            //             // lastFilledCard.scrollIntoView({ behavior: "smooth", block: "nearest", inline: "start" });
            //                 gbb.$(".gbbSlotFooterProductsContainer").animate({
            //                     scrollLeft: lastFilledCard
            //                 }, 500)
            //        }

            //     } catch (error) {
            //         gbb.utility.debugConsole("error in autoScrollSlotsBasedOnATC", error)
            //     }
            // },
            autoScrollSlots: function () {
                try {
                    let productsContainer = gbb.$(".gbbSlotFooterProductsContainer")
                    let totalNoOfFilledSlots = productsContainer.find(".gbbSlotFooterProductContainer").not(".gbbSlotFooterProductContainerEmpty").length
                    let productCard = productsContainer.find('.gbbSlotFooterProductContainer').eq(0)

                    let slotsFooterWrapperWidth = gbb.$('.gbbSlotFooterProductsContainerWrapper').width()
                    let gridGap = 10
                    let totalSizeTakenByFilledSlots = (totalNoOfFilledSlots * productCard.width()) + ((totalNoOfFilledSlots - 1) * gridGap)
                    let slideConditionPercentage = 0.6 // calculate 60% of the width of the container
                    let triggerAutoSlide = totalSizeTakenByFilledSlots > (slotsFooterWrapperWidth * slideConditionPercentage)
                    if (triggerAutoSlide) {
                        let thirdLastFilledProductCard = productsContainer.find(".gbbSlotFooterProductContainer").not(".gbbSlotFooterProductContainerEmpty").eq(-3)
                        if (thirdLastFilledProductCard?.length > 0) {
                            thirdLastFilledProductCard[0].scrollIntoView({ behavior: "smooth", block: "nearest", inline: "start" });
                        }
                    }
                } catch (err) {
                    gbb.utility.debugConsole("error in autoScrollSlots", err)
                }
            }
        },
        events: {
            activateInfiniteScrollForProducts: async function () {
                if (gbb.state.setInfiniteScrollTrackerForProducts == false) {
                    return;
                }
                const myElement = gbb.$('[data-load-more-indicator-status]');

                if (gbb.utility.isElementVisible(myElement)) {
                    if (myElement.attr("data-load-more-indicator-status") != "fetching") {
                        myElement.attr("data-load-more-indicator-status", "fetching")
                        let fetchInProgress;
                        if (!fetchInProgress) {
                            fetchInProgress = true;
                            setTimeout(async function () {
                                gbb.utility.debugConsole("fetching..in progress")
                                const noteAttribute = gbb.gbbAddProductsPage.state.dataForInfiniteScroll.noteAttribute
                                const allProductsData = gbb.gbbAddProductsPage.state.dataForInfiniteScroll.allProductsData
                                const categoryId = gbb.gbbAddProductsPage.state.dataForInfiniteScroll.categoryId
                                await gbb.gbbAddProductsPage.f.loadMoreProducts(noteAttribute, allProductsData, categoryId);
                                myElement.removeAttr("data-load-more-indicator-status")
                            }, 400)
                            gbb.utility.debugConsole("queued...in setTimeout");
                        }
                    } else {
                        // gbb.utility.debugConsole("fetching...from else if")
                    }
                } else {
                    // gbb.utility.debugConsole('Element is not visible');
                }
            }

        },
        action: {
            showPage1: async function () {
                //updatePageStatusFn
                // gbb.gbbAddProductsPage.state.updatePageStatusFn(1);
                let pageId = "addProductsPage1";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId);

            },
            showPage2: async function () {

                let pageId = "addProductsPage2";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId);
            },
            showPage3: async function () {
                let pageId = "addProductsPage3";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId);

            },

            showPage4: async function () {
                let pageId = "addProductsPage4";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            },

            showPage5: async function () {
                let pageId = "addProductsPage5";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            },

            showPage6: async function () {
                let pageId = "addProductsPage6";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            },

            showPage7: async function () {
                let pageId = "addProductsPage7";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            },

            showPage8: async function () {
                let pageId = "addProductsPage8";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            },

            showPage9: async function () {
                let pageId = "addProductsPage9";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            },

            showPage10: async function () {
                let pageId = "addProductsPage10";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            },

            showPage11: async function () {
                let pageId = "addProductsPage11";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            },

            showPage12: async function () {
                let pageId = "addProductsPage12";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            }
        },
    },
    gbbSubscriptionProductsPage: {
        state: {
            selectedSellingPlanGroup: null,
            activeSellingPlanId: null,
            activeSellingPlanDetails: null,
            selectedSellingPlanGroupId: null,
            sellingPlansArray: [],
            enableOneTimePurchase: false,
            showDiscountOnProductCards: false,
            purchaseType: null,
            constants: {
                ONE_TIME_PURCHASE: 'ONE_TIME_PURCHASE',
                SUBSCRIPTION_PURCHASE: 'SUBSCRIPTION_PURCHASE'
            },
            languageFields: {
                oneTimePurchaseLabel: "One time Purchase", // get it from multilang
                subscriptionPurchaseLabel: "Subscription Purchase",// get it from multilang
                frequencyLabel: "Frequency1",
                pageTitle: "Page Title1"
            },
        },
        settings: {
            pageCustomizationData: { // change values 
                header: {
                    purchaseOptionActiveColor: "#2B2B2B",
                    purchaseOptionActiveBgColor: "#FFFFFF",
                    purchaseOptionInActiveColor: "#888888",
                    purchaseOptionInActiveBgColor: "#F0F0F0",
                    purchaseOptionStrokeRadius: "8px",
                    purchaseOptionStrokeColor: "#D5D5D5",
                    purchaseOptionStrokeWidth: "2px",
                    sellingPlanNavigationActiveBgColor: "#FFFFFF",
                    sellingPlanNavigationActiveTitleColor: "#333333",
                    sellingPlanNavigationInActiveTitleColor: "#333333",
                    pageTitleColor: "#333333",
                    pageTitleFontWeight: "bold",
                    headerBgColor: "#EDEDED",
                    sellingPlanNavigationNextPrevIconBgColor: "#2B2B2B",
                    sellingPlanNavigationActiveDiscountPillBgColor: "#CAE983",
                    sellingPlanNavigationActiveDiscountPillTextColor: "#000000",
                    sellingPlanNavigationInActiveDiscountPillTextColor: "#000000",
                    sellingPlanNavigationInActiveDiscountPillBgColor: "#9D9D9D",
                    productDiscountRibbonBgColor: "#FF0000",
                    productDiscountRibbonTextColor: "#FFFFFF",
                    subscriptionFrequencyLabelTextColor: "#333333",
                    subscriptionFrequencyLabelFontWeight: "bold",
                    subscriptionPageTitleTextColor: "#000000",
                    subscriptionPageTitleFontWeight: "bold",
                    sellingPlansNavigationStrokeColor: "#B7B7B7",
                    sellingPlansNavigationStrokeWidth: "2px",
                    sellingPlansNavigationStrokeRadius: "10px"
                }
            }
        },
        f: {
            setCssVariablesForSubscriptionProductsPage: function () {
                try {
                    let root = document.documentElement;
                    let pageCustomizationData = gbb.gbbSubscriptionProductsPage.settings.pageCustomizationData || {}
                    const keysToMap = ['header']
                    keysToMap.forEach((key) => {
                        let currentKey = pageCustomizationData[key] || {}
                        Object.keys(currentKey).forEach((key) => {
                            let value = currentKey[key];
                            if (value) {
                                let _key = gbb.f.convertCamelCaseToKebabCase(key);
                                root.style.setProperty(`--gbb-gbbSubscriptionBundle-${_key}`, value);
                            }
                        })
                    })
                } catch (error) {
                    gbb.utility.debugError('error in setCssVariablesForSubscriptionProductsPage', error)
                }
            },
            checkIfPurchaseTypeIsSubscription: function () {
                try {
                    const { SUBSCRIPTION_PURCHASE } = gbb.gbbSubscriptionProductsPage.state.constants
                    const subscriptionDataFromSessionStorage = gbb.gbbSubscriptionProductsPage.f.getSubscriptionDataFromSessionStorage()
                    if (subscriptionDataFromSessionStorage && subscriptionDataFromSessionStorage.purchaseType) { 
                        return subscriptionDataFromSessionStorage.purchaseType == SUBSCRIPTION_PURCHASE
                    }
                    const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.state.purchaseType == SUBSCRIPTION_PURCHASE
                    return isPurchaseTypeSubscription
                } catch (error) {
                    gbb.utility.debugError('error in checkIfPurchaseTypeIsSubscription', error)
                }
            },
            updateSubscriptionDataInSessionStorage: function (data = {}) {
                try {
                    let { ONE_TIME_PURCHASE } = gbb.gbbSubscriptionProductsPage.state.constants
                    let dataToSet = {
                        activeSellingPlanId: gbb.gbbSubscriptionProductsPage.state.activeSellingPlanId,
                        activeSellingPlanDetails: gbb.gbbSubscriptionProductsPage.state.activeSellingPlanDetails,
                        purchaseType: gbb.gbbSubscriptionProductsPage.state.purchaseType,
                        selectedSellingPlanGroupId: gbb.gbbSubscriptionProductsPage.state.selectedSellingPlanGroupId,
                        enableOneTimePurchase: gbb.gbbSubscriptionProductsPage.state.enableOneTimePurchase,
                        sellingPlansArray: gbb.gbbSubscriptionProductsPage.state.sellingPlansArray,
                    }
                    dataToSet = { ...dataToSet, ...data }
                    if (dataToSet.purchaseType == ONE_TIME_PURCHASE) {
                        dataToSet['activeSellingPlanId'] = null
                        dataToSet['activeSellingPlanDetails'] = null
                    }
                    sessionStorage.setItem(`gbb-subscription-bundle-${gbb.state.bundleId}`, JSON.stringify(dataToSet));
                } catch (error) {
                    gbb.utility.debugError('error updateSubscriptionDataInsessionStorage', error)
                }
            },
            getSubscriptionDataFromSessionStorage: function () {
                try {
                    return JSON.parse(sessionStorage.getItem(`gbb-subscription-bundle-${gbb.state.bundleId}`))
                } catch (error) {
                    gbb.utility.debugError('error in getSubscriptionDataFromSessionStorage', error)
                }
            },
            checkIfPricingPoliciesChanged: function (sessionArray, settingsArray) {
                try {
                    for (const settingsItem of settingsArray) {
                        const sessionItem = sessionArray.find(item => item.id === settingsItem.id);
                        if (!sessionItem) return true;

                        const sessionPricingPolicies = sessionItem.pricingPolicies;
                        const settingsPricingPolicies = settingsItem.pricingPolicies;

                        if (sessionPricingPolicies.length !== settingsPricingPolicies.length) return true;

                        for (let j = 0; j < sessionPricingPolicies.length; j++) {
                            const sessionPolicy = sessionPricingPolicies[j];
                            const settingsPolicy = settingsPricingPolicies[j];

                            if (sessionPolicy.adjustmentType !== settingsPolicy.adjustmentType) return true;

                            const { adjustmentType } = sessionPolicy.adjustmentType;
                            const adjustmentValueSession = sessionPolicy.adjustmentValue;
                            const adjustmentValueSettings = settingsPolicy.adjustmentValue;

                            if (adjustmentType === 'PERCENTAGE') {
                                if (adjustmentValueSession.percentage !== adjustmentValueSettings.percentage) return true;
                            } else if (adjustmentType === 'PRICE' || adjustmentType === 'FIXED_AMOUNT') {
                                if (adjustmentValueSession.amount !== adjustmentValueSettings.amount) return true;
                            }
                        }
                    }
                    return false;
                } catch (error) {
                    gbb.utility.debugError('error in checkIfPricingPoliciesChanged', error);
                }
            },

            checkIfNameChanged: function (sessionArray, settingsArray) {
                try {
                    for (const settingsItem of settingsArray) {
                        const sessionItem = sessionArray.find(item => item.id === settingsItem.id);
                        if (!sessionItem) return true;

                        const keysToCheck = ['name', 'displayTitle', 'displayDiscountText'];
                        for (const key of keysToCheck) {
                            if (sessionItem[key] !== settingsItem[key]) return true;
                        }
                    }
                    return false;
                } catch (error) {
                    gbb.utility.debugError('error in checkIfNameChanged', error);
                }
            },

            hasSubscriptionDataChanged: function (dataToUpdate) {
                try {
                    const subscriptionDataFromSessionStorage = gbb.gbbSubscriptionProductsPage.f.getSubscriptionDataFromSessionStorage();
                    if (!subscriptionDataFromSessionStorage) return false;

                    const sellingPlanArrayFromSession = subscriptionDataFromSessionStorage.sellingPlansArray;
                    const sellingPlanArrayFromSettings = dataToUpdate.sellingPlansArray;

                    if (sellingPlanArrayFromSession.length !== sellingPlanArrayFromSettings.length) return true;

                    if (this.checkIfNameChanged(sellingPlanArrayFromSession, sellingPlanArrayFromSettings)) return true;
                    if (this.checkIfPricingPoliciesChanged(sellingPlanArrayFromSession, sellingPlanArrayFromSettings)) return true;

                    const keysToCompare = ['enableOneTimePurchase', 'selectedSellingPlanGroupId'];
                    for (const key of keysToCompare) {
                        if (dataToUpdate[key] !== subscriptionDataFromSessionStorage[key]) return true;
                    }

                    return false;
                } catch (error) {
                    gbb.utility.debugError('error in hasSubscriptionDataChanged', error);
                }
            },
            setSubscriptionBundlesLanguageFields: function (options) {
                try {
                    let languageFields = gbb.gbbSubscriptionProductsPage.state.languageFields
                    for (let key in options) {
                        if (key && languageFields.hasOwnProperty(key)) {
                            languageFields[key] = options[key]
                        }
                    }
                    gbb.gbbSubscriptionProductsPage.state.languageFields = languageFields
                } catch (error) {
                    gbb.utility.debugError('error in setSubscriptionBundlesLanguageFields', error)
                }
            },
            setSubscriptionBundlesSettings: async function (dataToSet) {
                try {
                    let { selectedSubscriptionGroup, enableOneTimePurchase, showDiscountOnProductCards, frequencyLabel, pageTitle, isDefaultPurchaseTypeSubscription = false } = dataToSet || {}
                    const { ONE_TIME_PURCHASE, SUBSCRIPTION_PURCHASE } = gbb.gbbSubscriptionProductsPage.state.constants
                    const purchaseType = (enableOneTimePurchase && isDefaultPurchaseTypeSubscription) || !enableOneTimePurchase ? SUBSCRIPTION_PURCHASE:ONE_TIME_PURCHASE
                    const activeSellingPlanData = selectedSubscriptionGroup?.sellingPlans[0] || {}
                    let groupId = gbb.utility.generateSellingPlanGroupIdByName(selectedSubscriptionGroup.name)
                    const updateStates = {
                        selectedSellingPlanGroup: selectedSubscriptionGroup,
                        selectedSellingPlanGroupId: groupId,
                        activeSellingPlanDetails: activeSellingPlanData,
                        activeSellingPlanId: gbb.utility.extractIdsFromGraphQlId(activeSellingPlanData?.id) || null,
                        sellingPlansArray: selectedSubscriptionGroup?.sellingPlans || [],
                        purchaseType: purchaseType,
                        enableOneTimePurchase: enableOneTimePurchase,
                        showDiscountOnProductCards: showDiscountOnProductCards,
                    }

                    const subscriptionDataFromSessionStorage = gbb.gbbSubscriptionProductsPage.f.getSubscriptionDataFromSessionStorage()

                    let isSessionDataChanged = gbb.gbbSubscriptionProductsPage.f.hasSubscriptionDataChanged(updateStates)

                    if (isSessionDataChanged || !subscriptionDataFromSessionStorage) {
                        let dataToSet = {
                            activeSellingPlanId: gbb.utility.extractIdsFromGraphQlId(activeSellingPlanData?.id),
                            activeSellingPlanDetails: activeSellingPlanData,
                            purchaseType: purchaseType,
                            selectedSellingPlanGroupId: groupId,
                            enableOneTimePurchase: enableOneTimePurchase,
                        }
                        gbb.gbbSubscriptionProductsPage.f.updateSubscriptionDataInSessionStorage(dataToSet)
                    }
                    else if (subscriptionDataFromSessionStorage) {
                        for (let key in subscriptionDataFromSessionStorage) {
                            if (key && updateStates.hasOwnProperty(key)) {
                                updateStates[key] = subscriptionDataFromSessionStorage[key]
                            }
                        }
                    }
                    gbb.gbbSubscriptionProductsPage.state = { ...gbb.gbbSubscriptionProductsPage.state, ...updateStates }
                    gbb.gbbSubscriptionProductsPage.f.setSubscriptionBundlesLanguageFields({ frequencyLabel, pageTitle })
                    if (isSessionDataChanged) {
                        await gbb.gbbSubscriptionProductsPage.f.resetProductsDataBasedOnActiveSellingPlan()
                    }
                } catch (error) {
                    gbb.utility.debugError("error in gbbSubscriptionProductsPage.f.setSubscriptionBundlesSettings", error)
                }
            },
            prepareSubscriptionHeaderHTML: function () {
                try {
                    const enableOneTimePurchase = gbb.gbbSubscriptionProductsPage.state.enableOneTimePurchase || false
                    const purchaseType = gbb.gbbSubscriptionProductsPage.state.purchaseType
                    const { SUBSCRIPTION_PURCHASE } = gbb.gbbSubscriptionProductsPage.state.constants

                    const gbbSubscriptionBundleWrapper = gbb.$('<div>').addClass('gbbSubscriptionBundleWrapper')
                    if (enableOneTimePurchase) {
                        let purchaseOptionsWrapperHTML = gbb.gbbSubscriptionProductsPage.f.preparePurchaseOptionsUI()
                        gbbSubscriptionBundleWrapper.append(purchaseOptionsWrapperHTML)
                    }
                    if (purchaseType == SUBSCRIPTION_PURCHASE) {
                        let sellingPlansNavigationHTML = gbb.gbbSubscriptionProductsPage.f.prepareSellingPlansNavigationUI()
                        gbbSubscriptionBundleWrapper.append(sellingPlansNavigationHTML)
                    }

                    return gbbSubscriptionBundleWrapper;
                } catch (error) {
                    gbb.utility.debugError('error in gbbSubscriptionProductsPage.f.prepareSubscriptionHeaderHTML', error)
                }
            },
            resetProductsDataBasedOnActiveSellingPlan: async function () {
                try {
                    gbb.gbbSubscriptionProductsPage.f.updateSubscriptionDataInSessionStorage()
                    let cartData = gbb.state.giftBoxCartData
                    gbb.gbbBrowser.setRelevantBoxDataToSessionStorage(cartData)
                    gbb.gbbBrowser.updateTotalPriceInSessionStorage()
                    gbb.gbbBrowser.updateTotalofRelevantBoxPriceInSessionStorage()
                    await gbb.gbbSubscriptionProductsPage.f.resetProductsCardContainerUI()
                    gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML(gbb.state.currentPageId));
                } catch (error) {
                    gbb.utility.debugError('error in gbbSubscriptionProductsPage.f.resetProductsDataBasedOnActiveSellingPlan', error)
                }
            },
            handleChangeActiveSellingPlan: async function (event) {
                try {
                    let gbbSellingPlanNavigationTab = gbb.$(event.currentTarget)
                    if (gbbSellingPlanNavigationTab.hasClass("active")) {
                        return
                    }
                    let sellingPlanId = gbbSellingPlanNavigationTab.data('selling-plan-id')
                    let sellingPlanIdGid = `gid://shopify/SellingPlan/${sellingPlanId}`
                    let sellingPlansArray = gbb.gbbSubscriptionProductsPage.state.sellingPlansArray
                    let sellingPlan = sellingPlansArray.find((sellingPlan) => sellingPlan.id == sellingPlanIdGid)
                    gbb.$('.gbbSellingPlanNavigationTab').removeClass('active')
                    gbbSellingPlanNavigationTab.addClass('active')
                    gbb.gbbSubscriptionProductsPage.state.activeSellingPlanId = sellingPlanId
                    gbb.gbbSubscriptionProductsPage.state.activeSellingPlanDetails = sellingPlan
                    await gbb.gbbSubscriptionProductsPage.f.resetProductsDataBasedOnActiveSellingPlan()
                    return sellingPlanId
                } catch (error) {
                    gbb.utility.debugError('error in gbbSubscriptionProductsPage.f.handleChangeActiveSellingPlan', error)
                }
            },
            prepareIndividualSellingPlanNavigationTabHTML: function (sellingPlan) {
                try {
                    const activeSellingPlanId = gbb.gbbSubscriptionProductsPage.state.activeSellingPlanId
                    const gbbSellingPlanNavigationTab = gbb.$('<div>').addClass('gbbSellingPlanNavigationTab')
                    const gbbSellingPlanNavigationTabTitle = gbb.$('<div>').addClass('gbbSellingPlanNavigationTabTitle')
                    const gbbSellingPlanNavigationDiscountText = gbb.$('<div>').addClass('gbbSellingPlanNavigationDiscountText')
                    const sellingPlanId = gbb.utility.extractIdsFromGraphQlId(sellingPlan.id)
                    if (sellingPlanId == activeSellingPlanId) {
                        gbbSellingPlanNavigationTab.addClass("active")
                    }
                    gbbSellingPlanNavigationTab.attr('data-selling-plan-id', sellingPlanId)
                    gbbSellingPlanNavigationTabTitle.text(sellingPlan.displayTitle)
                    gbbSellingPlanNavigationDiscountText.text(sellingPlan.displayDiscountText)
                    gbbSellingPlanNavigationTab.append(gbbSellingPlanNavigationTabTitle)
                    gbbSellingPlanNavigationTab.append(gbbSellingPlanNavigationDiscountText)

                    gbbSellingPlanNavigationTab.on("click", gbb.gbbSubscriptionProductsPage.f.handleChangeActiveSellingPlan)
                    return gbbSellingPlanNavigationTab
                } catch (error) {
                    gbb.utility.debugError('error in gbbSubscriptionProductsPage.f.prepareIndividualSellingPlanNavigationTabHTML', error)
                }
            },
            prepareNextPrevNavigationsHTML: function () {
                try {
                    const nextNavigationIconHTML = gbb.$('<div>').addClass("gbbSellingPlanNextNavigationIconWrapper").append(CONSTANT_ARROW_SVG)
                    const prevNavigationIconHTML = gbb.$('<div>').addClass("gbbSellingPlanPrevNavigationIconWrapper").append(CONSTANT_ARROW_SVG)

                    return { nextNavigationIconHTML, prevNavigationIconHTML }
                } catch (error) {
                    gbb.utility.debugError('error in gbbSubscriptionProductsPage.f.prepareNextPrevNavigationsHTML', error)
                }
            },
            renderSellingPlansNavigationTabs: function (options) {
                try {
                    const { sellingPlansArray, gbbSellingPlansNavigationTabsContainer } = options
                    gbbSellingPlansNavigationTabsContainer.empty();  // Clear previous tabs

                    for (let i = 0; i < sellingPlansArray.length; i++) {
                        const sellingPlan = sellingPlansArray[i];
                        const navigationTab = gbb.gbbSubscriptionProductsPage.f.prepareIndividualSellingPlanNavigationTabHTML(sellingPlan);
                        gbbSellingPlansNavigationTabsContainer.append(navigationTab);
                    }
                    return gbbSellingPlansNavigationTabsContainer
                } catch (error) {
                    gbb.utility.debugError('error in renderSellingPlansNavigationTabs', error)
                }
            },
            handleNextPrevNavigationBtnClickV1: function ({ operation }) {
                try {
                    const navigationTabsContainer = gbb.$(".gbbSellingPlansNavigationTabsContainer").first();
                    const totalSellingPlans = gbb.gbbSubscriptionProductsPage.state.sellingPlansArray?.length || 0;
                    let isMobileView = false;

                    // Check if the navigation container exists
                    if (!navigationTabsContainer.length) return;

                    const navigationTabs = gbb.$(".gbbSellingPlanNavigationTab");
                    let slidesPerView = 4; // Default number of visible slides
                    if (window.innerWidth < 550) {
                        isMobileView = true;
                        slidesPerView = 1;  // Only 1 visible slide in mobile view
                    }

                    // Find the active element using the 'active' class
                    const $activeElement = navigationTabs.filter('.active').first();
                    const activeIndex = navigationTabs.index($activeElement);

                    let scrollToElementIndex;

                    // Calculate the new index to scroll to based on the "NEXT" or "PREV" operation
                    if (operation === "NEXT") {
                        scrollToElementIndex = Math.min(activeIndex + slidesPerView, totalSellingPlans - 1);
                    } else if (operation === "PREV") {
                        scrollToElementIndex = Math.max(activeIndex - slidesPerView, 0);
                    }

                    const $nextSlideElement = navigationTabs.eq(scrollToElementIndex).first();

                    // Make sure the next slide element exists
                    if (!$nextSlideElement.length) return;

                    const containerRect = navigationTabsContainer.get(0).getBoundingClientRect();
                    const nextSlideRect = $nextSlideElement.get(0).getBoundingClientRect();

                    // Calculate the scroll offset based on the active element and the next element
                    const offset = nextSlideRect.left - containerRect.left;

                    // Adjust scrolling direction based on operation
                    if (operation === "NEXT") {
                        navigationTabsContainer.animate({
                            scrollLeft: '+=' + offset
                        }, 500);
                    } else if (operation === "PREV") {
                        navigationTabsContainer.animate({
                            scrollLeft: '-=' + Math.abs(offset)
                        }, 500);
                    }

                    if (isMobileView) {
                        gbb.gbbSubscriptionProductsPage.f.handleChangeActiveSellingPlan({ currentTarget: $nextSlideElement });
                    }

                } catch (error) {
                    gbb.utility.debugError('Error in handleNextPrevNavigationBtnClick', error);
                }
            },
            autoScrollToActiveSellingPlanNavigation: function () {
                try {
                    const navigationTabsContainer = gbb.$(".gbbSellingPlansNavigationTabsContainer").first();
                    if (!navigationTabsContainer.length) return;
                    const navigationTabs = gbb.$(".gbbSellingPlanNavigationTab");
                    const totalSellingPlans = gbb.gbbSubscriptionProductsPage.state.sellingPlansArray?.length || 0;
                    const $activeElement = navigationTabs.filter('.active').first();
                    const activeIndex = navigationTabs.index($activeElement);
                    let scrollToElementIndex = Math.min(activeIndex, totalSellingPlans - 1);
                    
                    const $nextSlideElement = navigationTabs.eq(scrollToElementIndex).first();

                    if (!$nextSlideElement.length) return;

                    const containerRect = navigationTabsContainer.get(0).getBoundingClientRect();
                    const nextSlideRect = $nextSlideElement.get(0).getBoundingClientRect();

                    const offset = nextSlideRect.left - containerRect.left;
                        navigationTabsContainer.animate({
                            scrollLeft: '+=' + offset
                        }, 500);

                } catch (error) {
                    gbb.utility.debugError('error in autoScrollToActiveSellingPlanNavigation', error)
                }
            },
            handleNextPrevNavigationBtnClick: function ({ operation }) {
                try {
                    const navigationTabsContainer = gbb.$(".gbbSellingPlansNavigationTabsContainer").first();
                    const totalSellingPlans = gbb.gbbSubscriptionProductsPage.state.sellingPlansArray?.length || 0;
                    let isMobileView = window.innerWidth < 550; // Check if it's mobile view
                    let slidesPerView = isMobileView ? 1 : 4; // Set slides per view depending on screen size

                    // Check if the navigation container exists
                    if (!navigationTabsContainer.length) return;

                    const navigationTabs = gbb.$(".gbbSellingPlanNavigationTab");

                    let scrollToElementIndex;

                    if (isMobileView) {
                        const $activeElement = navigationTabs.filter('.active').first();
                        const activeIndex = navigationTabs.index($activeElement);

                        // Calculate the new index based on the operation
                        if (operation === "NEXT") {
                            scrollToElementIndex = Math.min(activeIndex + slidesPerView, totalSellingPlans - 1);
                        } else if (operation === "PREV") {
                            scrollToElementIndex = Math.max(activeIndex - slidesPerView, 0);
                        }

                    } else {
                        const containerRect = navigationTabsContainer.get(0).getBoundingClientRect();

                        // Find the index of the first visible element
                        let firstVisibleTabIndex = 0;
                        navigationTabs.each(function (index) {
                            const tabRect = gbb.$(this).get(0).getBoundingClientRect();
                            if (tabRect.left >= containerRect.left && tabRect.right <= containerRect.right) {
                                firstVisibleTabIndex = index;
                                return false; // Stop when first visible tab is found
                            }
                        });

                        // Calculate the new index based on the operation
                        if (operation === "NEXT") {
                            scrollToElementIndex = Math.min(firstVisibleTabIndex + slidesPerView, totalSellingPlans - 1);
                        } else if (operation === "PREV") {
                            scrollToElementIndex = Math.max(firstVisibleTabIndex - slidesPerView, 0);
                        }
                    }

                    const $nextSlideElement = navigationTabs.eq(scrollToElementIndex).first();

                    // Make sure the next slide element exists
                    if (!$nextSlideElement.length) return;

                    const containerRect = navigationTabsContainer.get(0).getBoundingClientRect();
                    const nextSlideRect = $nextSlideElement.get(0).getBoundingClientRect();

                    // Calculate the scroll offset
                    const offset = nextSlideRect.left - containerRect.left;

                    // Scroll to the next or previous element
                    if (operation === "NEXT") {
                        navigationTabsContainer.animate({
                            scrollLeft: '+=' + offset
                        }, 500);
                    } else if (operation === "PREV") {
                        navigationTabsContainer.animate({
                            scrollLeft: '-=' + Math.abs(offset)
                        }, 500);
                    }

                    if (isMobileView) {
                        gbb.gbbSubscriptionProductsPage.f.handleChangeActiveSellingPlan({ currentTarget: $nextSlideElement });
                    }

                } catch (error) {
                    gbb.utility.debugError('Error in handleNextPrevNavigationBtnClick', error);
                }
            },
            addPrevNextNavigationButtons: function ({
                gbbSellingPlansNavigationItemsWrapper,
                gbbSellingPlansNavigationTabsContainer,
            }) {
                try {
                    const { nextNavigationIconHTML, prevNavigationIconHTML } = gbb.gbbSubscriptionProductsPage.f.prepareNextPrevNavigationsHTML();

                    gbbSellingPlansNavigationItemsWrapper.append(prevNavigationIconHTML);
                    gbbSellingPlansNavigationItemsWrapper.append(gbbSellingPlansNavigationTabsContainer);
                    gbbSellingPlansNavigationItemsWrapper.append(nextNavigationIconHTML);
                    prevNavigationIconHTML.prop('disabled', true);

                    nextNavigationIconHTML.on('click', () => {
                        gbb.gbbSubscriptionProductsPage.f.handleNextPrevNavigationBtnClick({ operation: "NEXT" })
                    });

                    prevNavigationIconHTML.on('click', () => {
                        gbb.gbbSubscriptionProductsPage.f.handleNextPrevNavigationBtnClick({ operation: "PREV" })
                    });
                    return gbbSellingPlansNavigationItemsWrapper
                } catch (error) {
                    gbb.utility.debugError('error in addPrevNextNavigationButtons', error)
                }
            },
            prepareSellingPlansNavigationUI: function () {
                try {
                    const noOfTabsToRender = 4;//make it dynamic
                    const isMobileView = window.innerWidth < 500
                    const sellingPlansArray = gbb.gbbSubscriptionProductsPage.state.sellingPlansArray;
                    const numberOfSellingPlans = sellingPlansArray?.length;
                    const languageFields = gbb.gbbSubscriptionProductsPage.state.languageFields
                    const gbbSellingPlansNavigationWrapper = gbb.$('<div>').addClass('gbbSellingPlansNavigationWrapper');
                    const gbbSellingPlansNavigationItemsWrapper = gbb.$('<div>').addClass('gbbSellingPlansNavigationItemsWrapper');
                    const gbbSellingPlansNavigationTabsContainer = gbb.$('<div>').addClass('gbbSellingPlansNavigationTabsContainer');
                    gbbSellingPlansNavigationItemsWrapper.attr('data-total-selling-plans', numberOfSellingPlans);
                    const gbbSellingPlansNavigationTitle = gbb.$('<div>').addClass('gbbSellingPlansNavigationTitle');

                    gbbSellingPlansNavigationTitle.text(languageFields.pageTitle);

                    gbb.gbbSubscriptionProductsPage.f.renderSellingPlansNavigationTabs({ sellingPlansArray, gbbSellingPlansNavigationTabsContainer });

                    if (numberOfSellingPlans > noOfTabsToRender || isMobileView) {
                        gbb.gbbSubscriptionProductsPage.f.addPrevNextNavigationButtons({
                            gbbSellingPlansNavigationItemsWrapper,
                            gbbSellingPlansNavigationTabsContainer,
                        })
                    } else {
                        gbbSellingPlansNavigationItemsWrapper.append(gbbSellingPlansNavigationTabsContainer);
                    }

                    gbbSellingPlansNavigationWrapper.append(gbbSellingPlansNavigationTitle);
                    gbbSellingPlansNavigationWrapper.append(gbbSellingPlansNavigationItemsWrapper);

                    return gbbSellingPlansNavigationWrapper;
                } catch (error) {
                    gbb.utility.debugError('error in gbbSubscriptionProductsPage.f.prepareSellingPlansNavigationUI', error);
                }
            },
            resetProductsCardContainerUI: async function () {
                try {
                    let pageType = gbb.gbbAddProductsPage.state.productPageData.pageType
                    let categoryId = gbb.gbbMultipleCategoriesPage.state.currentCategoryId
                    let totalProducts = pageType == 'MULTIPLE_CATEGORY' ? gbb.gbbAddProductsPage.state.productPageData.categories[categoryId].uniqueProductsData : gbb.gbbAddProductsPage.state.uniqueProductsData
                    let noteAttribute = gbb.state.currentPageId;

                    let updatedProductsCardsContainer = await gbb.gbbAddProductsPage.f.renderProductsCardContainer(totalProducts, noteAttribute, 'resetProductCardsContainer', categoryId)

                    return updatedProductsCardsContainer
                } catch (error) {
                    gbb.utility.debugError("error in resetProductsCardContainerUI", error)
                }
            },
            handlePurchaseOptionClick: async function (event) {
                try {
                    let gbbPurchaseOption = gbb.$(event.currentTarget).first()
                    let optionValue = gbbPurchaseOption.attr('data-purchase-type')
                    const sellingPlansArray = gbb.gbbSubscriptionProductsPage.state.sellingPlansArray || []
                    const { ONE_TIME_PURCHASE } = gbb.gbbSubscriptionProductsPage.state.constants

                    if (gbbPurchaseOption.hasClass("active")) {
                        return
                    }
                    gbb.$('.gbbPurchaseOption').removeClass('active')
                    gbbPurchaseOption.addClass('active')
                    gbb.gbbSubscriptionProductsPage.state.purchaseType = optionValue
                    if (optionValue == ONE_TIME_PURCHASE) {
                        gbb.gbbSubscriptionProductsPage.state.activeSellingPlanId = null
                        gbb.gbbSubscriptionProductsPage.state.activeSellingPlanDetails = null
                    } else {
                        let sellingPlanToSetActive = sellingPlansArray[0] || {}
                        gbb.gbbSubscriptionProductsPage.state.activeSellingPlanId = gbb.utility.extractIdsFromGraphQlId(sellingPlanToSetActive?.id) || null
                        gbb.gbbSubscriptionProductsPage.state.activeSellingPlanDetails = sellingPlanToSetActive || null
                    }
                    let updatedPageHeader = gbb.gbbSubscriptionProductsPage.f.prepareSubscriptionHeaderHTML()
                    gbb.$(".gbbSubscriptionBundleWrapper").replaceWith(updatedPageHeader);
                    await gbb.gbbSubscriptionProductsPage.f.resetProductsDataBasedOnActiveSellingPlan()
                } catch (error) {
                    gbb.utility.debugError("error in handlePurchaseOptionClick", error)
                }
            },
            preparePurchaseOptionsUI: function () {
                try {
                    const activePurchaseType = gbb.gbbSubscriptionProductsPage.state.purchaseType
                    const languageFields = gbb.gbbSubscriptionProductsPage.state.languageFields
                    const { ONE_TIME_PURCHASE, SUBSCRIPTION_PURCHASE } = gbb.gbbSubscriptionProductsPage.state.constants
                    const options = [
                        {
                            label: languageFields.oneTimePurchaseLabel,
                            value: ONE_TIME_PURCHASE,
                            isActive: activePurchaseType == ONE_TIME_PURCHASE,
                        },
                        {
                            label: languageFields.subscriptionPurchaseLabel,
                            value: SUBSCRIPTION_PURCHASE,
                            isActive: activePurchaseType == SUBSCRIPTION_PURCHASE,
                        }
                    ]
                    let gbbPurchaseOptionsWrapper = gbb.$('<div>').addClass('gbbPurchaseOptionsWrapper')
                    let gbbPurchaseOptionsTitle = gbb.$('<div>').addClass("gbbPurchaseOptionsTitle")
                    let gbbPurchaseOptionsButtonWrapper = gbb.$('<div>').addClass('gbbPurchaseOptionsButtonWrapper')
                    gbbPurchaseOptionsTitle.text(gbb.gbbSubscriptionProductsPage.state.languageFields.frequencyLabel)

                    options.forEach((option) => {
                        let gbbPurchaseOption = gbb.$('<div>').addClass('gbbPurchaseOption')
                        let gbbPurchaseOptionTextContent = gbb.$("<div>").addClass('gbbPurchaseOptionTextContent')
                        gbbPurchaseOptionTextContent.text(option.label)
                        gbbPurchaseOption.attr('data-purchase-type', option.value)
                        if (option.isActive) {
                            gbbPurchaseOption.addClass('active')
                        }
                        gbbPurchaseOption.on("click", gbb.gbbSubscriptionProductsPage.f.handlePurchaseOptionClick)
                        gbbPurchaseOption.append(gbbPurchaseOptionTextContent)
                        gbbPurchaseOptionsButtonWrapper.append(gbbPurchaseOption)
                    })
                    gbbPurchaseOptionsWrapper.append(gbbPurchaseOptionsTitle)
                    gbbPurchaseOptionsWrapper.append(gbbPurchaseOptionsButtonWrapper)
                    return gbbPurchaseOptionsWrapper;
                } catch (error) {
                    gbb.utility.debugError('error in gbbSubscriptionProductsPage.f.preparePurchaseOptionsUI', error)
                }
            },
            subscriptionBundlesInit: function (subscriptionBundlesData) {
                try {
                    gbb.gbbSubscriptionProductsPage.f.setSubscriptionBundlesSettings(subscriptionBundlesData)
                    gbb.gbbSubscriptionProductsPage.f.setCssVariablesForSubscriptionProductsPage()
                } catch (error) {
                    gbb.utility.debugError("error in gbbSubscriptionProductsPage.f.subscriptionBundlesInit", error)
                }
            },
            calculateSubscriptionProductDiscountValue: function (variantInfo) {
                try {
                    const { activeSellingPlanDetails } = gbb.gbbSubscriptionProductsPage.state;
                    const pricingPolicies = activeSellingPlanDetails?.pricingPolicies || [];

                    if (!variantInfo || !activeSellingPlanDetails || pricingPolicies.length === 0) return 0;

                    const activePricingPolicy = pricingPolicies[0];
                    const { adjustmentType: discountType, adjustmentValue } = activePricingPolicy || {};
                    let discountValue = 0;

                    switch (discountType) {
                        case 'FIXED_AMOUNT':
                            discountValue = parseInt(adjustmentValue?.amount) * 100;
                            return discountValue > 0 ? gbb.utility.formatPrice(discountValue) : false;

                        case 'PRICE':
                            discountValue = parseInt(adjustmentValue?.amount);
                            const variantPrice = variantInfo.price / 100;
                            const calculateDiscountOn = variantPrice - discountValue;
                            const percentageDiscount = Math.max((calculateDiscountOn / variantPrice) * 100, 0);
                            return percentageDiscount > 0 ? Math.floor(percentageDiscount) + '%' : false;

                        case 'PERCENTAGE':
                            discountValue = adjustmentValue?.percentage;
                            return discountValue > 0 ? discountValue + '%' : false;

                        default:
                            return discountValue;
                    }
                } catch (error) {
                    gbb.utility.debugError('error in gbbSubscriptionProductsPage.f.calculateSubscriptionProductDiscountValue', error);
                }
            }
            ,
            prepareSubscriptionProductDiscountRibbonUI: function (variantDetails) {
                try {
                    const gbbSubscriptionDiscountRibbon = gbb.$('<div>').addClass('gbbSubscriptionDiscountRibbon')
                    const gbbSubscriptionDiscountContent = gbb.$('<div>').addClass('gbbSubscriptionDiscountContent')
                    const discountValue = gbb.gbbSubscriptionProductsPage.f.calculateSubscriptionProductDiscountValue(variantDetails)
                    if (discountValue) {
                        gbbSubscriptionDiscountContent.text(`-${discountValue}`)
                        gbbSubscriptionDiscountRibbon.append(gbbSubscriptionDiscountContent)
                        return gbbSubscriptionDiscountRibbon
                    }
                } catch (error) {
                    gbb.utility.debugError('error in gbbSubscriptionProductsPage.f.prepareSubscriptionProductDiscountRibbonUI', error)
                }
            },
            getSubscriptionPriceByVariantId: function (variantId) {
                try {
                    const variantData = gbb.utility.getVariantDetailsFromCurrentProductsDataSet(variantId)
                    const { selling_plan_allocations } = variantData
                    const activeSellingPlanId = gbb.gbbSubscriptionProductsPage.state.activeSellingPlanId
                    const groupId = gbb.gbbSubscriptionProductsPage.state.selectedSellingPlanGroupId
                    if (!variantData) return 0

                    if (!activeSellingPlanId || !selling_plan_allocations || selling_plan_allocations.length == 0) {
                        return variantData.price
                    }

                    const activeSellingPlanAllocation = selling_plan_allocations.find((allocation) => {
                        return allocation.selling_plan_id == activeSellingPlanId
                    })

                    if (!activeSellingPlanAllocation) {
                        return variantData.price
                    }

                    return activeSellingPlanAllocation.price

                } catch (error) {
                    gbb.utility.debugError("error in gbbSubscriptionProductsPage.f.getSubscriptionPriceByVariantId", error)
                }
            }
        },

    },
    gbbAddonProducts: {
        f: {
            addonProductsInit: function (tmpCartSettings) {
                try {
                    let addonsData = tmpCartSettings.stepsConfigurationData.personalizationData.addonProducts || {}
                    if (Object.keys(addonsData).length > 0 && addonsData?.isEnabled) {
                        let eligibleTiersData = JSON.parse(gbb.storage.getItem(`eligible-tiers-for-addons-${gbb.state.bundleId}`))
                        let statesToUpdate = {
                            isEnabled: addonsData?.isEnabled,
                            tiers: addonsData?.tiers,
                            isSkippable: addonsData?.isSkippable,
                            title: addonsData?.title,
                            eligibleTierForAddons: eligibleTiersData || null,
                            offerId: addonsData?.offerId || null,
                            addonsMessaging : addonsData?.addonsMessaging,
                            displayVariantsAsIndividualProducts_addons: addonsData?.displayVariantsAsIndividualProducts_addons || false,
                        }
                        gbb.gbbAddonProducts.state = { ...gbb.gbbAddonProducts.state, ...statesToUpdate }
                        // gbb.gbbAddonProducts.f.calculateEligibleAddonProductsTier("personalizationPage") // forcefully calculate
                    }
                    return addonsData
                } catch (error) {
                    gbb.utility.debugError("error in gbbAddonProducts.f.addonProductsInit", error)
                }
            },
            getCartTotalItemsAndTotalPriceForAddons: function () {
                try {
                    let cartDataFromSession = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(gbb.state.activeBoxId)
                    let { items: cartItems } = cartDataFromSession || {}
                    let blackListedBoxProductKeys = ["greetingCard", "addonProduct", "giftMessage"]
                    let total_price = 0
                    let item_count = 0
                    cartItems?.forEach((item) => {
                        if (!blackListedBoxProductKeys.includes(item.properties._boxProduct)) {
                            total_price += item.price * item.quantity
                            item_count += item.quantity
                       }
                    })
                    return { total_price, item_count }
                } catch (error) {
                    gbb.utility.debugError("error in gbbAddonProducts.f.getCartTotalItemsAndTotalPriceForAddons", error)
                }
            },
            calculateEligibleAddonProductsTier: function (origin) {
                try {
                    let isAddonEnabled = gbb.gbbAddonProducts.state.isEnabled 
                    let isCurrentPageTypePersonalization = gbb.state.currentPageId == 'personalizationPage'
                    let qualifiedTierIndex = null
                    let tiers = gbb.gbbAddonProducts.state.tiers 

                    if (!origin && (!isAddonEnabled || isCurrentPageTypePersonalization)) {
                        return null
                    }

                    let { total_price, item_count } = gbb.gbbAddonProducts.f.getCartTotalItemsAndTotalPriceForAddons()
                    for (let idx = 0; idx < tiers.length; idx++) { 
                        let { type, value } = tiers[idx]?.condition
                        value = +value
                        total_price = total_price / 100 

                         if (type == "QUANTITY" && item_count>= value) {
                            qualifiedTierIndex = idx
                         } else if (type == 'AMOUNT' && total_price >= gbb.utility.convertFromStoreCurrencyToCustomer(value)) {
                            qualifiedTierIndex = idx
                        }
                    }

                    if (!qualifiedTierIndex && tiers[0]?.condition?.isValidateEligibilityConditionEnabled == false) {
                        qualifiedTierIndex = 0
                    }
                    let qualifiedTier = qualifiedTierIndex!==null ? tiers[qualifiedTierIndex] : null
                    
                    if (qualifiedTier) {
                        gbb.gbbAddonProducts.f.updateProductAndVariantPricesBasedOnAddonTier(qualifiedTier)
                        qualifiedTier.tierIndex = qualifiedTierIndex
                    } else {
                        gbb.gbbAddonProducts.f.removeAddonProductsFromCart()
                        let productsShopifyData = gbb.gbbAddonProducts?.state?.productsShopifyData || {}
                        gbb.gbbAddonProducts.f.setMapForVariantId_addons(productsShopifyData);
                    }
                    gbb.storage.setItem(`eligible-tiers-for-addons-${gbb.state.bundleId}`, JSON.stringify(qualifiedTier))
                    gbb.gbbAddonProducts.state.eligibleTierForAddons = qualifiedTier

                    return qualifiedTier

                } catch (error) {
                    gbb.utility.debugError("error in gbbAddonProducts.f.calculateEligibleAddonProductsTier", error)
                }
            },
            removeAddonProductsFromCart: async function () {
                try {
                    let { items } = gbb.state.giftBoxCartData || {}
                    let addonProducts = items.filter((item) => {
                        return item.properties._boxProduct == 'addonProduct'
                    })

                    for (let i = 0; i < addonProducts.length; i++){
                        let dataToSend = {
                            qty: 0,
                            variant:addonProducts[i]
                        }
                        await gbb.utility.removeFromCart(dataToSend,"addonProduct")
                    }

                    return addonProducts
                } catch (error) {
                    gbb.utility.debugError('error in removeAddonProductsFromCart', error)
                }
            },
            getAddonProductsToRender: function ({ selectedAddonProducts: qualifiedProducts, displayVariantsAsIndividualProducts_addons=false }){
                try {
                    let prefetchedProductsData = gbb.gbbAddonProducts.state.addonProductsDataByHandle || {}
                    let productsToRender = []
                    for (let product of qualifiedProducts) {
                        let currentProductData = prefetchedProductsData[product.handle]
                        if (displayVariantsAsIndividualProducts_addons) {
                            const { variants, ...productAttrs } = currentProductData;
                            variants.forEach((variant) => {
                                let merged = {
                                    ...productAttrs,
                                    compare_at_price: variant.compare_at_price,
                                    variants: [variant]
                                };
                                merged = gbb.gbbAddProductsPage.f.updateProductDataWithFirstVariantData(merged)
                                productsToRender.push(merged);
                            });
                        } else {
                            productsToRender.push(currentProductData)
                        }
                    } 
                    return productsToRender
                } catch (error) {
                    gbb.utility.debugError("error in gbbAddonProducts.f.getAddonProductsToRender", error)
                }
            },
            setPrefetchedAddonsData: function (addonProductsData) {
                try {
                    let productsDataById = {}
                    let productsDataSet = []
                    let productsDataByHandle ={}
                    for (let [key, value] of Object.entries(addonProductsData)) { 
                        let productData = value
                        productData.customProductAttribute = 'addonProduct'
                        productsDataById[productData.id] = productData
                        productsDataByHandle[productData.handle] = productData
                        productsDataSet.push(productData)
                    }
                    gbb.gbbAddonProducts.state.addonProductsDataByHandle = productsDataByHandle
                    gbb.gbbAddonProducts.state.addonProductsDataById = productsDataById
                    gbb.gbbAddonProducts.state.addonProductsDataSet = productsDataSet
                } catch (error) {
                    gbb.utility.debugError('error in gbbAddonProducts.f.setPrefetchedAddonsData')
                }
            },
            prepareAddonProductsUI: function () {
                try {
                    let gbbAddonProductsWrapper = gbb.$("<div>").addClass("gbbAddonProductsWrapper");
                    let gbbAddonProductsSectionTitle = gbb.$("<div>").addClass("gbbAddonProductsSectionTitle");
                    let gbbAddonProductsContainer = gbb.$("<div>").addClass("gbbProductsContainer");
                    gbbAddonProductsContainer.addClass("gbbProductsItemsContainer")
                    let eligibleTier = gbb.gbbAddonProducts.state.eligibleTierForAddons   
                    if (!eligibleTier) {
                        eligibleTier = gbb.gbbAddonProducts.state.tiers[0] || {}
                        gbbAddonProductsContainer.addClass("notEligibleForAddons")
                    }
                    gbb.gbbAddonProducts.f.updateProductAndVariantPricesBasedOnAddonTier(eligibleTier)
                    // let { selectedAddonProducts = [] } = eligibleTier

                    let productsDataToRender = gbb.gbbAddonProducts.f.getAddonProductsToRender(eligibleTier)
                    let productCardsHTML = gbb.f.renderProductsHTML(productsDataToRender,'personalizePage')
                    gbbAddonProductsSectionTitle.html(gbb.gbbAddonProducts.state.title)

                    gbbAddonProductsContainer.append(productCardsHTML)
                    gbbAddonProductsWrapper.append(gbbAddonProductsSectionTitle)
                    gbbAddonProductsWrapper.append(gbbAddonProductsContainer)
                    return gbbAddonProductsWrapper
                } catch (error) {
                    gbb.utility.debugError('error in prepareAddonProductsUI')
                }
            },
            prepareDiscountRibbonContentForProductAddons: function () {
                try {
                    let eligibleTier = gbb.gbbAddonProducts.state.eligibleTierForAddons

                    if (!eligibleTier) {
                        eligibleTier = gbb.gbbAddonProducts.state.tiers[0] || {} // for disable state
                    }

                    let { type, value} = eligibleTier?.discount || {}
                    let discountText = ''
                    if (value && +value > 0 && type == "PERCENTAGE") {
                        discountText = value == 100 ? "Free" : `${value}% off`
                    }

                    return {
                        type,
                        value,
                        discountText
                    }

                } catch (error) {
                    gbb.utility.debugError('error in prepareDiscountRibbonContentForProductAddons',error)
                }
            },
            checkAddonsConditionsOnNext: function () {
                try {
                    let result = true
                    let isAddonSkippable = gbb.gbbAddonProducts.state.isSkippable
                    let eligibleTierForAddons = gbb.gbbAddonProducts.state.eligibleTierForAddons || {}
                    let isEligibleForAddons = Object.keys(eligibleTierForAddons).length > 0
                    if (isEligibleForAddons && !isAddonSkippable) {
                        let cartDataItems = gbb.state.giftBoxCartData.items || []
                        // check if any of the items.properties._boxProduct - addonProduct
                        let isAddonProductExistInCart = cartDataItems.some((item) => {
                            return item.properties._boxProduct == "addonProduct"
                        })
                        result = isAddonProductExistInCart
                    }
                    return result
                } catch (error) {
                    gbb.utility.debugConsole('error in checkAddonsConditionsOnNext', error)
                }
            },
            checkMaxAddonProductsConditions: function ({productQtyToAdd}) {
                try {
                    let result = {
                        isConditionMet:true
                    }
                    let isAddonsEnabled = gbb.gbbAddonProducts.state.isEnabled 
                    let eligibleTiersData = gbb.gbbAddonProducts.state.eligibleTierForAddons
                    let cartItems = gbb.state.giftBoxCartData.items || []
                    let isEligibleForAddons = Object.keys(eligibleTiersData).length>0
                    if (!isAddonsEnabled || !isEligibleForAddons) return result
                    let maxAddonsAllowed = +eligibleTiersData.configurations.maxAddonProductsAllowed
                    let totalAddonsInCart = 0
                    cartItems.forEach((product, idx) => {
                        if (product.properties._boxProduct == 'addonProduct') {
                            totalAddonsInCart+=product.quantity 
                        }
                    })
                    if ((totalAddonsInCart + productQtyToAdd) > maxAddonsAllowed) {
                        result.isConditionMet = false
                        let message = gbb.settings?.languageData?.addons?.maxAddonProductsAllowed?.value 
                        // let message = `add maximum ##maxAllowedAddons## products to continue`
                        if (message) {
                            message = message.replace(new RegExp('##maxAllowedAddons##', 'g'), maxAddonsAllowed);
                        } else {
                            message = `1Only add upto ${maxAddonsAllowed}`
                        }
                        gbb.f.renderConditionNotificationToast(message)
                    }
                    
                    return result
                } catch (error) {
                    gbb.utility.debugConsole('error in checkMaxAddonProductsConditions',error)
                }
            },
            setMapForVariantId_addons: function (productsObj) {
                try {
                    if(Object.keys(productsObj).length == 0) return
                    let data = gbb.utility.productDetailsWith_VariantId_Or_ProductIdAsKey(productsObj)
                    gbb.gbbAddonProducts.state.currentProductsDataSetForVariants_addons = { ...gbb.gbbAddonProducts.state.currentProductsDataSetForVariants_addons, ...data };
                } catch (error) {
                    gbb.utility.debugError("error in setMapForVariantId_addons", error)
                }
            },
            updateProductAndVariantPricesBasedOnAddonTier: function (qualifiedTier) {
                try {
                    let discountValue = qualifiedTier?.discount?.value || 0
                    let products = JSON.parse(JSON.stringify(gbb.gbbAddonProducts.state.productsShopifyData))
                    const updateProductOrVariantPrice = (data) => {
                        let discountedPrice = data.price - (data.price * discountValue / 100)
                        let updatedCompareAtPrice = data.price
                        data.compare_at_price = updatedCompareAtPrice 
                        data.price = discountedPrice
                        return data
                    }
                    for (let [key, value] of Object.entries(products)) {
                        let currentProductDetails = value 
                        currentProductDetails = updateProductOrVariantPrice(currentProductDetails)
                        for (let variantIdx = 0; variantIdx < currentProductDetails.variants.length; variantIdx++) { 
                            let currentVariant = currentProductDetails.variants[variantIdx]
                            currentProductDetails.variants[variantIdx] = updateProductOrVariantPrice(currentVariant)
                        }
                        products[key] = currentProductDetails
                    }
                    gbb.gbbAddonProducts.f.setPrefetchedAddonsData(products)
                    gbb.gbbAddonProducts.f.setMapForVariantId_addons(products);

                    return products
                } catch (error) {
                    gbb.utility.debugError("error in gbbAddonProducts.f.updateProductAndVariantPricesBasedOnAddonTier",error)
                }
            },
            replaceIneligibleConditionVariables: function (message) {
                try {
                    let firstTierInfo = gbb.gbbAddonProducts.state.tiers[0] || {}
                    let { type, value } = firstTierInfo?.condition || {}
                    let { total_price, item_count } = gbb.gbbAddonProducts.f.getCartTotalItemsAndTotalPriceForAddons()

                    function calculateDiffValue(type, value, item_count, total_price) {
                        let diffValue = null
                        if (type === 'QUANTITY') {
                            diffValue = value - item_count;
                        } else if (type === 'AMOUNT') {
                            total_price = total_price / 100;
                            value = gbb.utility.convertFromStoreCurrencyToCustomer(value);
                            diffValue =  (value - total_price).toFixed(2);
                        }
                        return diffValue;
                    }

                    function replaceMessagePlaceholders(message, diffValue, type) {
                        message = message.replace("##AddonsConditionDiff##", diffValue);
                        if (type === 'AMOUNT') {
                            message = message.replace("##currencyUnit##", gbb.utility.getCurrencySymbol());
                        }
                        return message;
                    }

                    const diffValue = calculateDiffValue(type, value, item_count, total_price);
                    if (diffValue !== null) {
                        message = replaceMessagePlaceholders(message, diffValue, type);
                    }
                    return message
                } catch (error) {
                    gbb.utility.debugError("error in gbbAddonProducts.f.replaceIneligibleConditionVariables", error)
                }
            },
            getAddonsMessageToRender: function () {
                try {
                    let message = ""
                    let eligibleTier = gbb.gbbAddonProducts.state.eligibleTierForAddons
                    let addonsMessaging = gbb.gbbAddonProducts.state.addonsMessaging 
                    
                    if (!eligibleTier) {
                        let ineligibleMessaging = addonsMessaging?.ineligibleState
                        message = gbb.gbbAddonProducts.f.replaceIneligibleConditionVariables(ineligibleMessaging)
                    } else {
                        let activerTierIndex = eligibleTier?.tierIndex
                        if (activerTierIndex == null) return message;
                        message = addonsMessaging[`tier${activerTierIndex + 1}`]?.eligibleState
                    }

                    return message
                } catch (error) {
                    gbb.utility.debugError("error in getAddonsMessageToRender",error)
                }
            },
            checkIfAddonsMessagingNeeded: function () {
                try {
                    let isAddonsEnabled = gbb.gbbAddonProducts.state.isEnabled || false;
                    let isMessagingEnabled = gbb.gbbAddonProducts.state.addonsMessaging?.isEnabled || false;
                    let isCurrentPageTypePersonalization = gbb.state.currentPageId == "personalizationPage"
                    return isAddonsEnabled && isMessagingEnabled && isCurrentPageTypePersonalization
                } catch (error) {
                    gbb.utility.debugError("error in checkIfAddonsMessagingNeeded",error)
                }
            },

        },
        settings:{},
        state: {
            isEnabled: false,
            title: "",  
            isSkippable:true,
            tiers: [],
            activeTier:null,
            addonProductsDataByHandle: {},
            addonProductsDataById: {},
            addonProductsDataSet: [],
            eligibleTierForAddons:null,
            offerId: null,
            addonsMessaging: null
        },
        utility:{}
    },
    gbbMultipleCategoriesPage: {
        state: {
            buildBoxButtonAction: undefined,
            categoryStatus: {},
            currentCategory: undefined,
            currentIndex: undefined,
            currentCategoryId: undefined,
            // giftBoxData: null,
        },
        f: {
            prepareUIV2: async function (productPageData) {
                let gbbMultipleCategoriesPageHTML;
                let noteAttribute = gbb.state.currentPageId;
                let gbbMultipleCategoriesContainerHTML = gbb.$("<div>").addClass("gbbMultipleCategoriesContainerHTML");

                gbbMultipleCategoriesPageHTML = gbb.$("<div>").addClass("gbbMultipleCategoriesPageHTML");
                let categories = gbb.utility.convertObjectToArray(productPageData?.categories)
                for (let i = 0; i < categories.length; i++) {
                    // categories?.forEach(async (category, index) => {
                    let category = categories[i];
                    let index = i;
                    let gbbCategoryContainer = gbb.$("<div>").addClass("gbbCategoryContainer");
                    gbbCategoryContainer.css("background", gbb.settings.pageCustomizationData?.categoryBlock?.categoryBgColor || "#FFFFFF")
                    let gbbCategoryHeaderContainer = gbb.$("<div>").addClass("gbbCategoryHeaderContainer").attr("currentIndex", index).attr("categoryId", category.categoryId);
                    let gbbCategoryBodyContainer = gbb.$("<div>").addClass("gbbCategoryBodyContainer" + category.categoryId);

                    //data attribute to store the category id
                    gbbCategoryContainer.attr("categoryId", category.categoryId);

                    let gbbCategoryToggleButton = gbb.$("<img>").addClass("gbbCategoryToggleButton" + index);
                    gbbCategoryToggleButton.attr("src", CONSTANT_IMAGES_DROPDOWN_BUTTON);
                    gbbCategoryToggleButton.css("transform", "rotate(90deg)");

                    let gbbCategoryImage = gbb.$("<img>").addClass("gbbCategoryImage");
                    gbbCategoryImage.attr("src", category.categoryImg);


                    // let gbbCategoryBannerImage = gbb.$("<img>").addClass("gbbCategoryImage").addClass("gbbCategoryBanner")
                    // gbbCategoryBannerImage.attr("src", category?.categoryBanner);

                    if (category?.categoryBanner) {



                        gbbCategoryContainer.addClass("bannerAttached");

                        gbbCategoryImage.attr("src", category?.categoryBanner)
                        // let insertDynamicStyle = ``;

                        // gbb.$("head").append(`<style>${insertDynamicStyle}</style>`);
                    }

                    let gbbCategoryTitlesContainer = gbb.$("<div>").addClass("gbbCategoryTitlesContainer");
                    let gbbCategoryTitle = gbb.$("<div>").addClass("gbbCategoryTitle");
                    let gbbCategorySubTitle = gbb.$("<div>").addClass("gbbCategorySubTitle");

                    gbbCategoryTitle.text(category.title || "Category");
                    gbbCategorySubTitle.text(category.subTitle || "");

                    gbbCategoryTitlesContainer.append(gbbCategoryTitle)
                    gbbCategoryTitlesContainer.append(gbbCategorySubTitle)

                    gbbCategoryHeaderContainer.append(gbbCategoryToggleButton)
                    gbbCategoryHeaderContainer.append(gbbCategoryImage)
                    gbbCategoryHeaderContainer.append(gbbCategoryTitlesContainer)

                    let gbbProductsContainer = gbb.$("<div>").addClass("gbbProductsContainer");
                    // let gbbProductsItemsContainer = gbb.$("<div>").addClass("gbbProductsItemsContainer");
                    // gbbProductsItemsContainer.append(gbb.f.renderProductsHTML(category.dataFromShopify, noteAttribute, category.categoryId));

                    if (gbb.gbbMultipleCategoriesPage.currentIndex != undefined && gbb.gbbMultipleCategoriesPage.currentIndex == index) {
                        gbb.utility.debugConsole("prepareUiV2 for multipleCategories was called")
                        gbb.state.setInfiniteScrollTrackerForProducts = true;
                        gbb.gbbAddProductsPage.state.dataForInfiniteScroll = {
                            noteAttribute: noteAttribute,
                            categoryId: category.categoryId,
                            allProductsData: category.uniqueProductsData,
                        }
                        let renderData = await gbb.gbbAddProductsPage.f.renderProductsCardContainer(category.uniqueProductsData, noteAttribute, "initFlow", category.categoryId)
                        renderData.find(".gbbFiltersSearchSortHeader").remove()
                        gbbProductsContainer.append(renderData)
                        gbbCategoryToggleButton.css("transform", "rotate(360deg)");
                    } else {
                        gbbCategoryBodyContainer.hide();
                    }

                    // gbbProductsContainer.append(gbbProductsItemsContainer);

                    gbbCategoryBodyContainer.append(gbbProductsContainer);
                    gbbCategoryContainer.append(gbbCategoryHeaderContainer);
                    gbbCategoryContainer.append(gbbCategoryBodyContainer);



                    gbbCategoryHeaderContainer.on("click", async (event) => {
                        if (!event) {
                            return
                        }
                        let gbbMultipleCategoriesPageHTMLEle = gbb.$(".gbbAddGiftBoxPageWrapper").find(".gbbMultipleCategoriesPageHTML");
                        // gbb.gbbMultipleCategoriesPage.f.eventListenerForPrepareUIV2(event, gbbMultipleCategoriesPageHTMLEle, false, gbbCategoryHeaderContainer);
                        let categoryObjData = {
                            clickedIndex: event.currentTarget.attributes.currentIndex.value,
                            gbbMultipleCategoriesPageHTMLEle: gbbMultipleCategoriesPageHTMLEle,
                            isTabBasedUI: false,
                            clickedCategoryId: gbbCategoryHeaderContainer.attr('categoryId')
                        }
                        gbb.gbbMultipleCategoriesPage.f.eventListenerForPrepareUIV2(event, categoryObjData);

                        // let clickedIndex = event.currentTarget.attributes.currentIndex.value
                        // let currentIndex = gbb.gbbMultipleCategoriesPage.currentIndex
                        // gbb.$(".gbbAddGiftBoxPageWrapper").find("gbbMultipleCategoriesContainerHTML").css("pointer-events", "none")
                        // if (currentIndex != undefined && currentIndex == clickedIndex) {
                        //     gbb.gbbMultipleCategoriesPage.currentIndex = undefined;
                        //     gbbMultipleCategoriesPageHTMLEle.html(await gbb.gbbMultipleCategoriesPage.f.prepareUIV2(gbb.gbbAddProductsPage.state.productPageData))
                        // } else {
                        //     gbb.gbbMultipleCategoriesPage.currentIndex = event.currentTarget.attributes.currentIndex.value
                        //     gbbMultipleCategoriesPageHTMLEle.html(await gbb.gbbMultipleCategoriesPage.f.prepareUIV2(gbb.gbbAddProductsPage.state.productPageData))
                        //     let categoryId = gbbCategoryHeaderContainer.attr('categoryId');
                        //     gbb.utility.debugConsole(categoryId);
                        //     let selectedDiv = gbb.$(`div[categoryId='${categoryId}']`)
                        //     gbb.$('html, body').scrollTop(selectedDiv.offset().top-100);
                        //     // window.selectedDiv = selectedDiv;
                        // }
                        // isCategoryPrductsVisible = !isCategoryPrductsVisible
                    })



                    gbbMultipleCategoriesContainerHTML.append(gbbCategoryContainer);
                }
                //no navigation will be available if there is only one step enabled - adjust the positioning
                let navigationItems = gbb.state.navigationItems;


                //navigation icons not present

                //gbbAddProductsPageHTML.append(gbb.f.renderFiltersSideBarHTML(noteAttribute));
                gbbMultipleCategoriesPageHTML.append(gbbMultipleCategoriesContainerHTML);
                return gbbMultipleCategoriesPageHTML;

            },
            prepareUIV2TabUI: async function (productPageData) {
                try {
                    gbb.utility.debugConsole("inside tab ui");
                    let gbbMultipleCategoriesPageHTML;
                    let noteAttribute = gbb.state.currentPageId;
                    let gbbMultipleCategoriesContainerHTML = gbb.$("<div>").addClass("gbbMultipleCategoriesContainerHTMLForTabUI");
                    let categories = gbb.utility.convertObjectToArray(productPageData?.categories);
                    gbb.gbbMultipleCategoriesPage.f.setCurrentCategory(categories);
                    let activeCategory = gbb.gbbMultipleCategoriesPage.state.currentCategory;

                    gbbMultipleCategoriesPageHTML = gbb.$("<div>").addClass("gbbMultipleCategoriesPageHTMLForTabUI");
                    let gbbMultipleCategoriesRibbonContainer = gbb.$("<div>").addClass("gbbMultipleCategoriesRibbonContainer");
                    let gbbMultipleCategoriesDropdownContainer = gbb.$("<div>").addClass("gbbMultipleCategoriesDropdownContainer");
                    let gbbFilterSearchHTML = gbb.f.renderFiltersSearchSortHeaderHTML(noteAttribute)
                    gbb.$(gbbFilterSearchHTML).find('.gbbSearchBarMainWrapper').css('grid-column', 2)
                    // create a dropdown aswell
                    let gbbMutipleCategoriesDropdown = gbb.$("<select>").addClass("gbbMutipleCategoriesDropdown");
                    if (gbb.settings.pageCustomizationData?.categoryBlock?.tabActiveBgColor) {
                        gbbMutipleCategoriesDropdown.css("background", gbb.settings.pageCustomizationData?.categoryBlock?.tabActiveBgColor)
                    }
                    if (gbb.settings.pageCustomizationData?.categoryBlock?.tabActiveTextColor) {
                        gbbMutipleCategoriesDropdown.css('color', gbb.settings.pageCustomizationData?.categoryBlock?.tabActiveTextColor)
                    }
                    // let gbbMultipleCategoriesDropdownArrow = gbb.$("<img>").addClass("gbbMultipleCategoriesDropdownArrow");
                    // gbbMultipleCategoriesDropdownArrow.attr("src", ARROW_DOWN_SVG);
                    let gbbMultipleCategoriesDropdownArrow = gbb.$("<div>").addClass("gbbMultipleCategoriesDropdownArrow");
                    gbbMultipleCategoriesDropdownArrow.append(ARROW_DOWN_SVG);


                    let gbbMultipleCategoriesActiveCategorySubtitle = gbb.$("<div>").addClass("gbbMultipleCategoriesActiveCategorySubtitle");
                    for (let i = 0; i < categories.length; i++) {
                        let category = categories[i];
                        let index = i;
                        let gbbCategoryContainer = gbb.$("<div>").addClass("gbbCategoryContainer");
                        gbbCategoryContainer.addClass("gbbCategoryContainerTabUI")
                        if (gbb.settings.pageCustomizationData?.categoryBlock?.tabInactiveBgColor) {
                            gbbCategoryContainer.css("background", gbb.settings.pageCustomizationData?.categoryBlock?.tabInactiveBgColor)

                        }
                        if (gbb.settings.pageCustomizationData?.categoryBlock?.tabInactiveTextColor) {
                            gbbCategoryContainer.css('color', gbb.settings.pageCustomizationData?.categoryBlock?.tabInactiveTextColor)
                        }
                        // gbbCategoryContainer.css("background",gbb.settings.pageCustomizationData.colors.secondaryColor || "#FFFFFF").css("color",gbb.settings.pageCustomizationData.colors.textColor || "black" );
                        let optionValue = gbb.$("<option>").attr("value", category.categoryId).attr("categoryId", category.categoryId).text(category.title || "Category").attr("currentIndex", index)


                        // give active status to selected category
                        if (activeCategory != undefined && activeCategory.categoryId == category.categoryId) {
                            gbbCategoryContainer.addClass("gbbCategoryContainerTabUIActive");
                            optionValue.attr("selected", "selected")
                            // gbbCategoryContainer.css("background",gbb.settings.pageCustomizationData.colors.primaryColor || "#FFFFFF").css("color",gbb.settings.pageCustomizationData.colors.textColor || "black" );
                        }



                        // give active status to first category if no category is selected
                        if (activeCategory == undefined && index == 0) {
                            gbbCategoryContainer.addClass("gbbCategoryContainerTabUIActive");
                            activeCategory = category;
                            gbb.gbbMultipleCategoriesPage.state.currentCategoryId = category.categoryId;
                            gbb.gbbMultipleCategoriesPage.f.setCurrentCategory(categories);
                        }

                        if (gbbCategoryContainer.hasClass("gbbCategoryContainerTabUIActive")) {
                            if (gbb.settings.pageCustomizationData?.categoryBlock?.tabActiveBgColor) {
                                gbbCategoryContainer.css("background", gbb.settings.pageCustomizationData?.categoryBlock?.tabActiveBgColor)
                            }
                            if (gbb.settings.pageCustomizationData?.categoryBlock?.tabActiveTextColor) {
                                gbbCategoryContainer.css('color', gbb.settings.pageCustomizationData?.categoryBlock?.tabActiveTextColor)
                            }
                        }




                        // gbbCategoryContainer.css("background", gbb.settings.pageCustomizationData?.categoryBlock?.categoryBgColor || "#FFFFFF")
                        let gbbCategoryHeaderContainer = gbb.$("<div>").addClass("gbbCategoryHeaderContainer").attr("currentIndex", index).attr("categoryId", category.categoryId);
                        gbbCategoryHeaderContainer.addClass("gbbCategoryHeaderContainerTabUI")
                        gbbCategoryContainer.attr("categoryId", category.categoryId);

                        let gbbCategoryTitlesContainer = gbb.$("<div>").addClass("gbbCategoryTitlesContainer");
                        gbbCategoryTitlesContainer.addClass("gbbCategoryTitlesContainerForTabUI");
                        let gbbCategoryTitle = gbb.$("<div>").addClass("gbbCategoryTitle");
                        let gbbCategorySubTitle = gbb.$("<div>").addClass("gbbCategorySubTitleForTabUI");

                        gbbCategoryTitle.html(category.title || "Category");
                        gbbCategorySubTitle.html(category.subTitle || "");

                        let gbbCategoryImage = gbb.$("<img>").addClass("gbbCategoryImageForTabUI");
                        gbbCategoryImage.attr("src", category.categoryImg)

                        gbbCategoryTitlesContainer.append(gbbCategoryTitle);
                        // gbbCategoryTitlesContainer.append(gbbCategorySubTitle);



                        gbbMutipleCategoriesDropdown.append(optionValue)
                        gbbCategoryHeaderContainer.append(gbbCategoryTitlesContainer);
                        gbbCategoryHeaderContainer.append(gbbCategoryImage);
                        gbbCategoryContainer.append(gbbCategoryHeaderContainer);
                        gbbMultipleCategoriesRibbonContainer.append(gbbCategoryContainer);




                        // can we have onChange?
                        gbbMutipleCategoriesDropdown.off("change").on("change", async (event) => {
                            if (!event) {
                                return
                            }
                            // gbb.utility.clearAllFilters(noteAttribute);
                            gbb.utility.debugConsole("event", event);
                            // gbb.f
                            let optionValueClicked = gbb.$(event.currentTarget).find("option:selected");
                            gbb.utility.debugConsole("optionValueClicked", optionValueClicked);
                            let gbbMultipleCategoriesPageHTMLEle = gbb.$(".gbbAddGiftBoxPageWrapper").find(".gbbMultipleCategoriesPageHTMLForTabUI")
                            let categoryObjData = {
                                clickedIndex: optionValueClicked.attr("currentIndex"),
                                gbbMultipleCategoriesPageHTMLEle: gbbMultipleCategoriesPageHTMLEle,
                                isTabBasedUI: true,
                                clickedCategoryId: optionValueClicked.attr("categoryId")
                            }
                            // debugger;
                            gbb.gbbMultipleCategoriesPage.f.eventListenerForPrepareUIV2(event, categoryObjData);

                            // gbb.gbbMultipleCategoriesPage.f.eventListenerForPrepareUIV2(event, gbbMultipleCategoriesPageHTMLEle, true, optionValueClicked)
                        })



                        gbbCategoryHeaderContainer.on("click", async (event) => {
                            gbb.utility.debugConsole("opton value clicked")
                            if (!event) {
                                return
                            }
                            // gbb.utility.clearAllFilters(noteAttribute);
                            let gbbMultipleCategoriesPageHTMLEle = gbb.$(".gbbAddGiftBoxPageWrapper").find(".gbbMultipleCategoriesPageHTMLForTabUI")
                            let categoryObjData = {
                                clickedIndex: event.currentTarget.attributes.currentIndex.value,
                                gbbMultipleCategoriesPageHTMLEle: gbbMultipleCategoriesPageHTMLEle,
                                isTabBasedUI: true,
                                clickedCategoryId: gbbCategoryHeaderContainer.attr('categoryId')
                            }
                            // debugger;
                            gbb.gbbMultipleCategoriesPage.f.eventListenerForPrepareUIV2(event, categoryObjData);

                            // gbb.gbbMultipleCategoriesPage.f.eventListenerForPrepareUIV2(event, gbbMultipleCategoriesPageHTMLEle, true, gbbCategoryHeaderContainer)

                        })
                    }
                    //no navigation will be available if there is only one step enabled - adjust the positioning
                    let navigationItems = gbb.state.navigationItems;

                    // populate the body section
                    let gbbMultipleCategoryBodyContainer = gbb.$("<div>").addClass("gbbMultipleCategoryBodyContainer");
                    let gbbMultipleCategoryBody = gbb.$("<div>").addClass("gbbMultipleCategoryBody");
                    // debugger
                    let gbbProductsContainer = gbb.$("<div>").addClass("gbbMultiCategoryProductsContainer");


                    let renderData = await gbb.gbbMultipleCategoriesPage.f.renderProductsInTabUI(activeCategory, noteAttribute);
                    gbbMultipleCategoriesActiveCategorySubtitle.html(activeCategory.subTitle || "");



                    gbbProductsContainer.append(renderData);
                    gbbMultipleCategoryBody.append(gbbProductsContainer);
                    gbbMultipleCategoryBodyContainer.append(gbbMultipleCategoryBody);

                    //navigation icons not present


                    gbbMultipleCategoriesPageHTML.append(gbbFilterSearchHTML)
                    gbbMultipleCategoriesPageHTML.append(gbbMultipleCategoriesRibbonContainer);

                    gbbMultipleCategoriesDropdownContainer.append(gbbMutipleCategoriesDropdown);
                    // gbbMultipleCategoriesDropdownArrow
                    gbbMultipleCategoriesDropdownContainer.append(gbbMultipleCategoriesDropdownArrow);

                    gbbMultipleCategoriesPageHTML.append(gbbMultipleCategoriesDropdownContainer)
                    gbbMultipleCategoriesPageHTML.append(gbbMultipleCategoriesActiveCategorySubtitle);
                    gbbMultipleCategoriesPageHTML.append(gbbMultipleCategoryBodyContainer);


                    gbbMultipleCategoriesContainerHTML.append(gbbMultipleCategoriesPageHTML);




                    return gbbMultipleCategoriesContainerHTML;
                } catch (error) {
                    gbb.utility.debugConsole("error in prepareUIV2TabUI", error)
                }
            },
            renderProductsInTabUI: async function (activeCategory, noteAttribute) {
                gbb.state.setInfiniteScrollTrackerForProducts = true;
                gbb.gbbAddProductsPage.state.dataForInfiniteScroll = {
                    noteAttribute: noteAttribute,
                    categoryId: activeCategory.categoryId,
                    allProductsData: activeCategory.uniqueProductsData,
                }
                let totalProducts = activeCategory.uniqueProductsData

                // check if search or filter is active then change totalProducts data to render specific products
                let isFilterActive = gbb.utility.getActivatedFilters(noteAttribute).length > 0
                let isSearchActive = gbb.gbbAddProductsPage.state.filterBySearch.searchQuery.searchText.trim().length > 0
                if (isFilterActive) {
                    let filteredProducts = await gbb.utility.getFilteredSortedProductsData(noteAttribute, 'searchProductsFlow')
                    totalProducts = filteredProducts
                }
                if (isSearchActive) {
                    let searchValue = gbb.gbbAddProductsPage.state.filterBySearch.searchQuery.searchText
                    let searchedProducts = await gbb.gbbAddProductsPage.f.handleSearchBundleInput(searchValue, noteAttribute)
                    totalProducts = searchedProducts

                }
                let renderData = await gbb.gbbAddProductsPage.f.renderProductsCardContainer(totalProducts, noteAttribute, "initFlow", activeCategory.categoryId)
                // renderData.find(".gbbFiltersSearchSortHeader").remove() 

                return renderData;
            },
            setCurrentCategory: function (categories) {
                let currentCategoryId = gbb.gbbMultipleCategoriesPage.state.currentCategoryId;
                if (currentCategoryId) {
                    // find category with currentCategoryId
                    let currentCategory = categories.find((category) => {
                        return category.categoryId == currentCategoryId;
                    })
                    gbb.gbbMultipleCategoriesPage.state.currentCategory = currentCategory;
                }
            },
            eventListenerForPrepareUIV2: async function (event, categoryData) {
                // if (!event) {
                //     return
                // }

                let gbbMultipleCategoriesPageHTMLEle = categoryData.gbbMultipleCategoriesPageHTMLEle;
                let isTabBasedUI = categoryData.isTabBasedUI;
                let clickedIndex = categoryData.clickedIndex;
                let clickedCategoryId = categoryData.clickedCategoryId;
                //  gbbCategoryHeaderContainer
                if (clickedCategoryId !== gbb.gbbMultipleCategoriesPage.state.currentCategoryId) {
                    gbb.gbbBrowser.emitCustomEvent({
                        eventName: 'gbb-category-change',
                        detail: {
                            activeCategory: clickedCategoryId,
                            prevCategory: gbb.gbbMultipleCategoriesPage.state.currentCategoryId
                        }
                    })
                }
                gbb.utility.debugConsole("inside eventListenerForPrepareUI V2")

                // let clickedIndex = 
                let currentIndex = gbb.gbbMultipleCategoriesPage.currentIndex;
                gbb.$(".gbbAddGiftBoxPageWrapper").find("gbbMultipleCategoriesContainerHTML").css("pointer-events", "none")
                if (currentIndex != undefined && currentIndex == clickedIndex) {
                    gbb.gbbMultipleCategoriesPage.currentIndex = undefined;
                    gbb.gbbMultipleCategoriesPage.state.currentCategoryId = clickedCategoryId;

                    // firing function as per requirement
                    if (isTabBasedUI) {
                        // reset search value 
                        // gbb.gbbAddProductsPage.f.resetSearchTextValue()
                        gbbMultipleCategoriesPageHTMLEle.html(await gbb.gbbMultipleCategoriesPage.f.prepareUIV2TabUI(gbb.gbbAddProductsPage.state.productPageData));
                    } else {
                        gbbMultipleCategoriesPageHTMLEle.html(await gbb.gbbMultipleCategoriesPage.f.prepareUIV2(gbb.gbbAddProductsPage.state.productPageData))
                    }

                } else {
                    // gbb.gbbMultipleCategoriesPage.currentIndex = event.currentTarget.attributes.currentIndex.value
                    gbb.gbbMultipleCategoriesPage.currentIndex = clickedIndex;
                    // let categoryId = gbbCategoryHeaderContainer.attr('categoryId');
                    let categoryId = clickedCategoryId;
                    gbb.gbbMultipleCategoriesPage.state.currentCategoryId = categoryId;

                    // firing function as per requirement
                    if (isTabBasedUI) {
                        // reset search value 
                        // gbb.gbbAddProductsPage.f.resetSearchTextValue()

                        gbbMultipleCategoriesPageHTMLEle.html(await gbb.gbbMultipleCategoriesPage.f.prepareUIV2TabUI(gbb.gbbAddProductsPage.state.productPageData));
                        gbb.utility.debugConsole(categoryId);
                        let selectedDiv = gbb.$(`div[categoryId='${categoryId}']`)
                        // gbb.$('html, body').scrollTop(selectedDiv.offset().top-200);
                    } else {
                        gbbMultipleCategoriesPageHTMLEle.html(await gbb.gbbMultipleCategoriesPage.f.prepareUIV2(gbb.gbbAddProductsPage.state.productPageData))
                        gbb.utility.debugConsole(categoryId);
                        let selectedDiv = gbb.$(`div[categoryId='${categoryId}']`)
                        gbb.$('html, body').scrollTop(selectedDiv.offset().top - 100);
                    }
                    // window.selectedDiv = selectedDiv;
                }
                return;
            },
        },
    },
    gbbPersonalizePage: {
        state: {
            // buildBoxButtonAction: undefined,
            // giftBoxData: null,
            giftMessage: null,
            scheduleDeliveryDate: null,
            showAllGreetingCardImages: false,
            showAllGiftWrapImages: false,
            greetingCardActiveImageSrc: "",
            giftWrapActiveImageSrc: "",
            emailDeliveryOption: null,
            emailDatePicker: "",
            // senderNameIsChange:false,
            senderName: "",
            // recipientNameIsChange:false,
            recipientName: "",
            customerUploadsResponse: null, //this is an Object.
            customerUploadsErrors: {},
            // additionalGiftMessageInfoIsChange:false,
            // additionalGiftMessageInfo:""
        },
        init: async function (settings, parent) {
            if (true || gbb.state.currentPageId !== 'personalizationPage') {
                gbb.gbbBrowser.emitCustomEvent({
                    eventName: 'gbb-page-init',
                    detail: {
                        prevPageId: gbb.state.currentPageId,
                        activePageId: 'peronalizationPage'
                    }
                })
            }
            gbb.state.currentPageId = "personalizationPage"
            gbb.gbbMultipleCategoriesPage.state.currentCategory = undefined;
            gbb.gbbMultipleCategoriesPage.state.currentCategoryId = undefined
            gbb.gbbAddProductsPage.state.dataForInfiniteScroll = {
                noteAttribute: undefined,
                allProductsData: undefined,
                categoryId: undefined,
            }
            if (gbb?.gbbAddProductsPage?.state?.productPageData) {
                gbb.gbbAddProductsPage.state.productPageData = undefined
            }
            let navItem = gbb.utility.getNavItem(gbb.state.currentPageId)
            gbb.f.markPreviousNavigationItemsAsCompleted(navItem)
            await gbb.utility.getGiftBoxProductsFromCart()
            gbb.gbbPersonalizePage.initialize(settings, parent)
            gbb.gbbPersonalizePage.f.registerEvents(settings);
            gbb.utility.renderTemporaryLoadingSpinner("hide")
            //gbb.gbbPersonalizePage.f.insertIntoMainPageWrapper();
            // gbb.gbbModel.init(settings)
        },
        initialize: async function (settings, parent) {

            let gbbPersonalizePageWrapper = gbb.$("<div>").addClass("gbbPersonalizePageWrapper");
            const gbbPersonalizePageHeaderHTML = gbb.gbbPersonalizePage.f.prepareHeader();

            const gbbPersonalizePageSubtextWrapper = gbb.$("<div>").addClass("gbbPersonalizePageSubtextWrapper");
            const gbbDiscountComponent = gbb.$("<div>").addClass("gbbDiscountComponent");

            const gbbPersonalizePageSubtext = gbb.$("<div>").addClass("gbbPersonalizePageSubtext");
            gbbPersonalizePageSubtext.html(gbb.settings?.stepsConfigurationData?.personalizationData?.personalizePageSubtext)
            // gbbPersonalizePageSubtext.html("Hi")

            gbbPersonalizePageSubtextWrapper.append(gbbPersonalizePageSubtext);

            const gbbPersonalizePageBodyHTML = await gbb.gbbPersonalizePage.f.prepareUI();

            const gbbPersonalizePageFooterHTML = gbb.gbbPersonalizePage.f.prepareFooter();

            gbbPersonalizePageFooterHTML.css("background", gbb.settings.pageCustomizationData.cartFooter.cartFooterBgColor)
            gbbPersonalizePageFooterHTML.css("color", gbb.settings.pageCustomizationData.cartFooter.cartFooterTextColor)

            gbbPersonalizePageWrapper.append(gbbPersonalizePageHeaderHTML);
            gbbPersonalizePageWrapper.append(gbbPersonalizePageSubtextWrapper);
            gbbPersonalizePageWrapper.append(gbbDiscountComponent);
            gbbPersonalizePageWrapper.append(gbbPersonalizePageBodyHTML);
            gbbPersonalizePageWrapper.append(gbbPersonalizePageFooterHTML);

            gbb.state.personalizePageBody = gbbPersonalizePageWrapper;
            gbb.gbbPersonalizePage.f.insertIntoMainPageWrapper();
            gbb.gbbPersonalizePage.action.refreshCustomerUploadsList();


            // if(gbb.settings?.scheduleDelivery?.isScheduleDeliveryEnabled){
            //     gbb.gbbPersonalizePage.f.useDatePickerLibrary();
            // }


        },

        updatePageStatus: async function () {
            if (gbb.state.currentPageId != "personalizationPage") {
                return;
            }

            let isMessageProductExists = gbb.gbbPersonalizePage.f.checkIfMessageProductExistsInShopifyData();
            let qty = gbb.gbbPersonalizePage.f.getMessageProductQuantity();
            let isVirtualProduct = false;
            let virtualProduct;
            let isGiftMessageVirtualProduct = gbb.settings.bundleSettings.isGiftMessageVirtualProduct || false;
            if (isGiftMessageVirtualProduct) {
                isVirtualProduct = true;
                isMessageProductExists = true;


                if (gbb.settings && gbb.settings.shopifyData) {
                    gbb.settings.shopifyData.giftMessageData = gbb.settings.shopifyData.giftMessageData || {}; // Initialize giftMessageData as an empty array if it doesn't exist

                    gbb.settings.shopifyData.giftMessageData.variants = gbb.settings.shopifyData.giftMessageData.variants || []; // Initialize variants as an empty array if it doesn't exist
                    gbb.settings.shopifyData.giftMessageData.properties = gbb.settings.shopifyData.giftMessageData.properties || {};
                    let variantData = {
                        id: "1111",
                    }

                    let gifMesssageDataForVirtualProduct = {
                        "id": 1111,
                        "title": gbb.settings.giftMessage?.messageProduct?.product?.variants[0]?.option1 || "Message Product",
                        "option1": "Write your message to your loved one",
                        "available": true,
                        "name": "Message - Write your message",
                        "public_title": "Write your message",
                        "requires_selling_plan": false,
                        "variant_id": 1111,
                        "price": 0,
                        "weight": 0,
                        "compare_at_price": null,
                        "inventory_management": null,
                        // "image": "https://cdn.shopify.com/s/files/1/0680/3541/2253/files/1713126763137_8487c4ff-5454-41b7-b36e-ceced15ba145.png?v=1715596242",
                        // "image": "https://d3ks0ngva6go34.cloudfront.net/public/message_default.png",
                        "image": gbb.settings?.giftMessage?.messageProduct?.product?.variants[0]?.variantImage || "https://d3ks0ngva6go34.cloudfront.net/public/message_default.png",
                        "product_id": 1111,
                    }

                    gbb.settings.shopifyData.giftMessageData.variants.push(variantData);
                    let dummyMessageObject = JSON.parse(JSON.stringify(gifMesssageDataForVirtualProduct));

                    dummyMessageObject.variants = gbb.settings.shopifyData.giftMessageData.variants;

                    if (!gbb.state.currentProductsDataSetForVariants || Object.keys(gbb.state.currentProductsDataSetForVariants) < 1) {
                        gbb.state.currentProductsDataSetForVariants = {}
                    }

                    gbb.state.currentProductsDataSetForVariants[variantData.id] = dummyMessageObject;
                }
                qty = 1;
                let message = gbb.gbbPersonalizePage.state.giftMessage
                if (!message) {
                    qty = 0;
                    isMessageProductExists = false;
                }
            }
            // only sideeffect of this is that we are skipping gift message add to the cart.
            // but this is because we couldnt find any gift message product
            if (isMessageProductExists) {
                let data = {
                    variant: { id: gbb.settings?.shopifyData?.giftMessageData?.variants[0].id },
                    qty: qty,
                    //qty : 0 videoMessageDataHasBeenChanged || emailDataHasBeenChanged ? 0 : 1,
                }
                if (data.qty == 0) {
                    await gbb.utility.removeFromCart(data, "giftMessage");
                } else {
                    await gbb.utility.addToCart(data, "giftMessage");
                }
            }
            let navItem = gbb.f.getNavItem(gbb.state.currentPageId);
            if (navItem) {
                navItem.isCompleted = true;
                navItem.isActive = false
                //if cart items have the values, then mark complete, else mark incomplete
            }
            //update the navigationItems  by filtering the array gbb.state.navigationItems using id
            gbb.state.navigationItems.forEach(function (item) {
                if (item.id == gbb.state.currentPageId) {
                    item = {
                        ...item,
                        navItem
                    }
                }
            })
            return true;
        },
        f: {

            prepareHeader: function () {
                const gbbPersonalizePageHeaderHTML = gbb.$("<div>").addClass("gbbPersonalizePageHeader");
                let gbbPageHeader = gbb.$("<div>").addClass("gbbPageHeader");
                let navigationItems = gbb.state.navigationItems;
                let stepsCount = 0;
                navigationItems = navigationItems.filter((element) => {
                    if (element.isNavBarItem && element.isNavBarItem == true) {
                        stepsCount++;
                        return element;
                    }
                })
                if (stepsCount == 1) {
                    gbbPageHeader.addClass("gbbPageHeaderWithoutLine");
                }

                let gbbPageHeaderText = gbb.$("<div>").addClass("gbbPageHeaderText");

                const gbbPersonalizePageBannerImage = gbb.$("<img>").addClass("gbbPageBannerImage");
                gbbPersonalizePageBannerImage.attr("src", gbb.settings.pageCustomizationData.banners.pageBannerImageSrc)
                gbbPageHeader.append(gbbPersonalizePageBannerImage)
                //gbbPageHeader.append(gbbPageHeaderText);

                const gbbPersonalizePageNavigationContainer = gbb.$("<div>").addClass("gbbPersonalizePageNavigationContainer");

                gbbPageHeaderText.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.landingPage.bannerText));
                let nextNavigationItems = gbb.f.getNavigationItemsToDisplay(gbb.state.currentPageId);
                gbbPersonalizePageNavigationContainer.append(gbb.f.renderNavigationHTML(gbbPersonalizePageNavigationContainer, "personalizePage", nextNavigationItems));

                gbbPersonalizePageHeaderHTML.append(gbbPersonalizePageNavigationContainer)
                return gbbPersonalizePageHeaderHTML;
            },
            prepareUI: async function () {
                let settings = gbb.settings
                let gbbPersonalizePageHTML;

                gbbPersonalizePageHTML = gbb.$("<div>").addClass("gbbPersonalizePageHTMLContent");
                gbbPersonalizePageHTML = gbb.$("<div>").addClass("gbbPersonalizePageHTML");

                if (gbb.settings?.addonProducts?.isEnabled) {
                    let addonProductsHTML = gbb.gbbAddonProducts.f.prepareAddonProductsUI()
                    gbbPersonalizePageHTML.append(addonProductsHTML)
                }
                if (gbb.settings?.greetingCard?.isGreetingCardEnabled) {
                    let greetingCardHTML = gbb.gbbPersonalizePage.components.greetingCard();
                    gbbPersonalizePageHTML.append(greetingCardHTML);
                }

                if (gbb.settings?.giftMessage?.isGiftMessageEnabled) {
                    gbb.gbbPersonalizePage.state.giftMessage = gbb.utility.getAttributValueFromMessageItem("Message") //read from noteAttributes
                    let giftMessage = await gbb.gbbPersonalizePage.components.giftMessage();
                    gbbPersonalizePageHTML.append(giftMessage);
                }


                if (gbb.settings?.customerUploads?.isCustomerUploadsEnabled) {
                    let customerAttachmentHTML = gbb.gbbPersonalizePage.components.customerUploads();
                    gbbPersonalizePageHTML.append(customerAttachmentHTML);
                }


                if (gbb.settings.videoMessage.isVideoMessageEnabled) {
                    //read email Id and recordedId from noteAttributes
                    gbb.gbbVideoMsg.state.emailId = gbb.utility.getAttributValueFromMessageItem("Recipient Email");
                    gbb.gbbVideoMsg.state.uploadedVideoId = gbb.utility.getAttributValueFromMessageItem("_videoMsgId");
                    let videoMessageHTML = gbb.gbbPersonalizePage.components.videoMessage();
                    gbbPersonalizePageHTML.append(videoMessageHTML);
                }

                // if(gbb.settings?.scheduleDelivery?.isScheduleDeliveryEnabled){
                //     let scheduleDeliveryHTML = await gbb.gbbPersonalizePage.components.scheduleDelivery();
                //     gbbPersonalizePageHTML.append(scheduleDeliveryHTML);
                // }

                if (gbb.settings?.giftMessage?.isEmailEnabled) {
                    let emailAddressHTML = await gbb.gbbPersonalizePage.components.emailAddress();
                    gbbPersonalizePageHTML.append(emailAddressHTML);
                }

                if (gbb.settings?.giftMessage?.isGiftMessageEnabled || gbb.settings.videoMessage.isVideoMessageEnabled) {
                    if (gbb.settings?.giftMessage?.isEmailEnabled) {
                        let scheduleMessageDeliveryHTML = await gbb.gbbPersonalizePage.components.scheduleMessageDelivery();
                        gbbPersonalizePageHTML.append(scheduleMessageDeliveryHTML);
                    }
                }

                return gbbPersonalizePageHTML;

            },
            prepareFooter: function () {
                //this is a footer
                const gbbPersonalizePageFooterHTML = gbb.$("<div>").addClass("gbbPersonalizePageFooterHTML");
                gbbPersonalizePageFooterHTML.append(gbb.f.renderCartProductsFooterHTML("personalizePage"));
                return gbbPersonalizePageFooterHTML;
            },
            insertIntoMainPageWrapper: function () {

                gbb.$(".gbbBodyWrapper").html(gbb.state.personalizePageBody);

                gbb.$(".gbbBodyWrapper").children().first().hide();
                gbb.$(".gbbBodyWrapper").children().first().fadeIn(700);
            },
            calculateDaysFromToday: function (numberOfDays) {
                return new Date(Date.now() + parseInt(numberOfDays) * 24 * 60 * 60 * 1000)
            },
            useDatePickerLibrary: function () {
                try {
                    const minDate = gbb.gbbPersonalizePage.f.calculateDaysFromToday(gbb.settings.scheduleDelivery.leadTime);
                    let maxDate = gbb.gbbPersonalizePage.f.calculateDaysFromToday(gbb.settings.scheduleDelivery.maxDateInDays);
                    const disabledDates = gbb.settings.scheduleDelivery.disabledDates;
                    const disabledDays = gbb.settings.scheduleDelivery.disabledDaysOfWeek;
                    let datePicker = gbb.$(".gbbScheduleDeliveryDatePicker");
                    flatpickr(datePicker, {
                        // inline: true,
                        dateFormat: "d-m-Y",
                        time_24hr: true,
                        minDate: minDate,
                        maxDate: maxDate,
                        disable: [
                            function (date) {
                                // return true to disable
                                // let d = new Date(date+"Z");
                                let d = gbb.utility.getDate(date);

                                // d = (d.toISOString().split('T')[0]);
                                // return (date.getDay() === 0 || date.getDay() === 6);
                                if (disabledDates.includes(d) || disabledDays.includes(new Date(date).toLocaleString("en-us", { weekday: "long" }))) {
                                    return true;
                                }
                            },
                        ],
                        onChange: async function (selectedDates, dateStr, instance) {
                            gbb.utility.debugConsole("date changed");
                            gbb.utility.debugConsole({ dateStr });
                            gbb.gbbPersonalizePage.state.scheduleDeliveryDate = dateStr;
                            if (gbb.gbbPersonalizePage.state.scheduleDeliveryDate) {
                                // await gbb.utility.updateCart({ attributes: { ["gbbScheduleDelivery"]: gbb.gbbPersonalizePage.state.scheduleDeliveryDate } });
                                gbb.gbbBrowser.updateCartAttributes({ gbbScheduleDelivery: gbb.gbbPersonalizePage.state.scheduleDeliveryDate });
                            }

                            //
                        },
                        // appendTo: gbb.$(body)
                    });
                    if (gbb.utility.getAttributValueFromCart("gbbScheduleDelivery") != null) {
                        datePicker.val(gbb.utility.getAttributValueFromCart("gbbScheduleDelivery"));
                    }
                } catch (e) {
                    gbb.utility.debugConsole(e);

                    //gbbScheduleDeliveryHTML
                    //hide this component
                    gbb.$(".gbbScheduleDeliveryHTML").hide();
                }

            },
            activateClearSelectionButton: function (productType) {
                //create a new button
                // productType -> expected params are
                // "giftWrap" or "greetingCard"
                let clearSelectionButton = gbb.$("<div>").addClass("gbbClearSelectionButton");

                //: clear selection language
                clearSelectionButton.text(gbb.utility.renderLanguageValue(gbb.settings.languageData?.personalizePage?.clearSelectionButton) || "Clear Selection");
                clearSelectionButton.click(function () {
                    gbb.gbbPersonalizePage.action.onClearSelectionButtonClick(productType);
                });

                return clearSelectionButton;
            },
            registerEvents: function (settings) {
                gbb.gbbPersonalizePage.state.buildBoxButtonAction = function () {
                    gbb.utility.debugConsole("build box button clicked");
                    // window.alert("build box button clicked");
                };
            },
            renderGreetingCardImages: function (greetingCardData) {
                try {
                    // let imageList = greetingCardData.images;
                    if (true || imageList) {
                        let gbbGreetingCardImageList = [];
                        let greetingCardProducts = Object.values(greetingCardData) || [];
                        for (let i = 0; i < greetingCardProducts?.length; i++) {
                            let greetingCardProduct = greetingCardProducts[i];
                            for (let j = 0; j < greetingCardProduct?.variants?.length; j++) {
                                //: No Image found png
                                let _img = greetingCardProduct?.variants[j]?.featured_image?.src || greetingCardProduct?.featured_image || "No Image found png";
                                let variantId = greetingCardProduct?.variants[j]?.id;
                                // add an input event listener to each image of radio type
                                let variantTitle = gbb.$("<div>").addClass("gbbVariantTitle").append(greetingCardProduct?.variants[j]?.title);
                                let variantPrice = gbb.$("<span>").addClass("gbbVariantPrice").append(gbb.utility.formatPrice(greetingCardProduct?.variants[j]?.price));
                                let variantDetailsWrapper = gbb.$("<div>").addClass("gbbVariantDetailsWrapper");

                                variantDetailsWrapper.append(variantTitle);
                                variantDetailsWrapper.append(variantPrice);

                                imageInput = gbb.$("<input>").attr("type", "radio").attr("name", "greetingCardImage").attr("value", _img)
                                imageInput.addClass("greetingCardImageInput")
                                let imageAndDetailsWrapper = gbb.$("<div>").addClass("greetingCardImageAndDetailsWrapper");
                                let imageLabel = gbb.$("<label>").addClass('gbbGreetingCardImageLabel')
                                let image = gbb.$("<img>").addClass('greetingCardImage')

                                // imageLabel.on("click", gbb.gbbPersonalizePage.action.onGreetingCardImageClick)
                                imageLabel.on("click", gbb.gbbPersonalizePage.action.onGreetingCardImageClick)

                                let argsObj = {
                                    productData: greetingCardProduct,
                                    variantId: variantId.id,
                                }

                                let uniqueItemKey = gbb.utility.getUniqueIdForVariant(argsObj);


                                const isItemInCart = gbb.utility.checkIfItemPresentInGiftBoxCart(variantId, { uniqueItemKey });
                                if (isItemInCart) {
                                    gbb.gbbPersonalizePage.state.greetingCardActiveImageSrc = _img;
                                    gbb.gbbPersonalizePage.state.greetingCardTitle = isItemInCart.variant_title;
                                    gbb.gbbPersonalizePage.state.greetingCardPrice = isItemInCart.price;
                                } else {
                                    gbb.gbbPersonalizePage.state.greetingCardActiveImageSrc = null;
                                    gbb.gbbPersonalizePage.state.greetingCardTitle = null;
                                    gbb.gbbPersonalizePage.state.greetingCardPrice = null;
                                    imageInput.attr("checked", false)
                                    imageLabel.removeClass("gbbActiveGreetingCard")
                                    gbb.gbbPersonalizePage.action.removeCheckmarkDivsFromGreetingCards();
                                }

                                //if image is checked then attach gbbActiveGreetingCard css to it
                                if (gbb.gbbPersonalizePage.state.greetingCardActiveImageSrc == _img) {
                                    imageInput.attr("checked", true)
                                    imageLabel.addClass("gbbActiveGreetingCard")
                                    gbb.gbbPersonalizePage.action.addCheckMarkDivs(imageLabel);
                                } else {
                                    imageInput.attr("checked", false)
                                    imageLabel.removeClass("gbbActiveGreetingCard")
                                    gbb.gbbPersonalizePage.action.removeCheckmarkDivsFromGreetingCards();
                                }
                                image.attr("src", _img)

                                imageInput.attr("data-variant-id", variantId)
                                image.attr("data-variant-id", variantId)
                                imageLabel.attr("data-variant-id", variantId)

                                imageLabel.append(imageInput)
                                // imageLabel.append(variantTitle).append(variantPrice)
                                imageLabel.append(image)

                                imageAndDetailsWrapper.append(imageLabel);
                                imageAndDetailsWrapper.append(variantDetailsWrapper);
                                gbbGreetingCardImageList.push(imageAndDetailsWrapper)
                            }
                        }
                        // if gbbGreetingCardImageList has no elements then return that there are no Images to display
                        if (gbbGreetingCardImageList.length == 0) {
                            return gbb.$("<div>").addClass('gbbGreetingCardImageList').html("No products found" || gbb.utility.renderLanguageValue(gbb.settings.languageData.giftcardV2.purchasePageFields.noImagesAvailable))
                        }
                        return gbbGreetingCardImageList;
                    }
                } catch (e) {
                    gbb.utility.debugConsole("error occured in renderGreetingCardImages", e)
                }
            },
            renderGiftWrapImages: function (giftWrapData) {
                // let imageList = giftWrapData.images;
                if (true || imageList) {
                    let giftWrapImageList = [];
                    for (let i = 0; i < giftWrapData.variants?.length; i++) {
                        //: no images png
                        let _img = giftWrapData.variants[i]?.featured_image?.src || "No Image found png";
                        let variantId = giftWrapData.variants[i]?.id;

                        let variantTitle = gbb.$("<div>").addClass("gbbVariantTitle").append(giftWrapData.variants[i]?.title);
                        let variantPrice = gbb.$("<span>").addClass("gbbVariantPrice").append(gbb.utility.formatPrice(giftWrapData.variants[i]?.price));

                        let variantDetailsWrapper = gbb.$("<div>").addClass("gbbVariantDetailsWrapper");

                        variantDetailsWrapper.append(variantTitle);
                        variantDetailsWrapper.append(variantPrice);
                        // add an input event listener to each image of radio type
                        imageInput = gbb.$("<input>").attr("type", "radio").attr("name", "giftWrapImage").attr("value", _img)
                        imageInput.addClass("giftWrapImageInput")
                        let imageAndDetailsWrapper = gbb.$("<div>").addClass("greetingCardImageAndDetailsWrapper");
                        let imageLabel = gbb.$("<label>").addClass('giftWrapImageLabel')
                        let image = gbb.$("<img>").addClass('giftWrapImage')

                        //on click set the current item to the preview image as active image
                        // imageLabel.on("click", gbb.gbbPersonalizePage.action.onGiftWrapImageClick)
                        imageAndDetailsWrapper.on("click", gbb.gbbPersonalizePage.action.onGiftWrapImageClick)

                        const isItemInCart = gbb.utility.checkIfItemPresentInGiftBoxCart(variantId);

                        if (isItemInCart) {
                            gbb.gbbPersonalizePage.state.giftWrapActiveImageSrc = _img;
                            gbb.gbbPersonalizePage.state.giftWrapTitle = isItemInCart.variant_title;
                            gbb.gbbPersonalizePage.state.giftWrapPrice = gbb.utility.formatPrice(isItemInCart.price);
                        }

                        //if image is checked then attach activeGiftWrap css to it
                        if (gbb.gbbPersonalizePage.state.giftWrapActiveImageSrc == _img) {
                            imageInput.attr("checked", true)
                            imageLabel.addClass("activeGiftWrap")
                            gbb.gbbPersonalizePage.action.addCheckMarkDivs(imageLabel);
                        }
                        image.attr("src", _img)

                        imageInput.attr("data-variant-id", variantId)
                        image.attr("data-variant-id", variantId)
                        imageLabel.attr("data-variant-id", variantId)

                        imageLabel.append(imageInput)
                        // imageLabel.append(variantTitle).append(variantPrice)
                        imageLabel.append(image)
                        imageAndDetailsWrapper.append(imageLabel);
                        imageAndDetailsWrapper.append(variantDetailsWrapper);
                        giftWrapImageList.push(imageAndDetailsWrapper)
                    }
                    // if giftWrapImageList has no elements then return that there are no Images to display
                    if (giftWrapImageList.length == 0) {
                        return gbb.$("<div>").addClass('giftWrapImageList').html("No products found" || gbb.utility.renderLanguageValue(gbb.settings.languageData.giftcardV2.purchasePageFields.noImagesAvailable))
                    }
                    return giftWrapImageList;
                }

            },
            verifyEmailFields: function () {
                if (gbb.settings?.giftMessage?.isEmailEnabled) {
                    let email = gbb.gbbVideoMsg.state.emailId;
                    let emailValid;
                    let isEmailWarningMsgPresent = gbb.$(".gbbPageBody").find(".gbbEmailValidationError");
                    let emailValidationError = gbb.$("<div>").addClass("gbbEmailValidationError").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.generalSettings?.emailValidationError) || "Please enter a valid email address");
                    if (email && email.trim().length != 0) {//email is not empty -> it must be valid
                        //check for validation
                        emailValid = gbb.utility.emailValidation(email);
                        if (!emailValid) {
                            if (isEmailWarningMsgPresent.length == 0) {
                                gbb.$(".gbbEmailAddressWrapper").append(emailValidationError);
                            }
                            return false;
                        } else {
                            gbb.$(".gbbEmailValidationError").remove();
                            return true;
                        }
                    }
                    else if (!email || email?.trim().length == 0) {//email is empty -> check if video message exists, if it does -> email cannot be empty
                        if (gbb.gbbVideoMsg.state.uploadedVideoId || gbb.$(".gbbVideoMsgCheckboxField").is(":checked")) {
                            if (isEmailWarningMsgPresent.length == 0) {
                                gbb.$(".gbbEmailAddressWrapper").append(emailValidationError);
                            }
                            return false;
                        } else {
                            //if the video message is not checked then remove the error message
                            gbb.$(".gbbEmailValidationError").remove();
                            return true;
                        }
                    }
                } else {
                    return true;
                }
            },
            getMessageProductQuantity: function () { //if text message or video message is present -> then only quantity will be 1 otherwise 0
                let qty;
                let videoToggle = gbb.$(".gbbVideoMsgCheckboxField").is(":checked")
                if (!videoToggle) {
                    gbb.gbbVideoMsg.state.uploadedVideoId = null
                }
                if ((gbb.gbbPersonalizePage.state?.giftMessage && gbb.gbbPersonalizePage.state?.giftMessage?.trim().length != 0) || gbb.gbbVideoMsg.state.uploadedVideoId) {
                    qty = 1;
                } else if (gbb.gbbPersonalizePage.state.customerUploadsResponse && Object.keys(gbb.gbbPersonalizePage.state.customerUploadsResponse).length > 0) {
                    qty = 1;
                } else {
                    qty = 0;
                }
                return qty;
            },
            checkIfMessageProductExistsInShopifyData: function () { //check if we have a message product at all or not
                if (gbb.settings && gbb.settings.shopifyData && gbb.settings?.shopifyData?.giftMessageData
                    && gbb.settings?.shopifyData?.giftMessageData?.variants[0].id) {
                    return true;
                } else {
                    return false;
                }
            },
            deleteCustomerUploadsError: function (key) {
                if (gbb.gbbPersonalizePage.state.customerUploadsErrors != null && gbb.gbbPersonalizePage.state.customerUploadsErrors[key]) {
                    delete gbb.gbbPersonalizePage.state.customerUploadsErrors[key];
                }
            },
            deleteCustomerUploadsResponse: function (key) {
                if (gbb.gbbPersonalizePage.state.customerUploadsResponse != null && gbb.gbbPersonalizePage.state.customerUploadsResponse[key]) {
                    delete gbb.gbbPersonalizePage.state.customerUploadsResponse[key];
                }
            },
            removeGiftMessageFromSessionStorage: function (cartData) {
                try {
                    let boxes = Object.keys(cartData.boxes);
                    let giftMessageProductInSessionStorage = [];
                    let totalCount = 0;
                    for (let i = 0; i < boxes.length; i++) {
                        let box = cartData.boxes[boxes[i]];
                        let items = box.items;
                        for (let j = 0; j < items.length; j++) {
                            let item = items[j];
                            if (item.properties && item.properties.Message) {
                                giftMessageProductInSessionStorage.push({ "Box ID": item.properties["Box ID"], "Message": item.properties.Message, "To": item.properties["Recipient Name"], "From": item.properties["Sender Name"], "Bundle Name": item.properties.Bundle })

                                // remove this item from the cartData
                                items.splice(j, 1);
                                j--;
                            }
                        }
                    }
                    // update cartData in session storage
                    if (cartData) {
                        let bundleId = gbb.state.bundleId;
                        let sessionStorageKey = `gbb-cart-${bundleId}`;
                        sessionStorage.setItem(sessionStorageKey, JSON.stringify(cartData));
                    }

                    gbb.state.giftMessageProductInActiveSession = giftMessageProductInSessionStorage;
                    gbb.gbbBrowser.updateTotalPriceInSessionStorage();
                    gbb.gbbBrowser.updateTotalofRelevantBoxPriceInSessionStorage();
                } catch (err) {
                    gbb.utility.debugConsole("error inside removeGiftMessageFromSessionStorage", err);
                }
            }
        },
        events: {
            onCustomerUploadsFileChange: async function (event) {
                try {
                    let fileBlob = event.target.files[0];
                    gbb.utility.debugConsole(fileBlob, "file")

                    let fileAllowed = true;
                    if (fileBlob.type) {
                        const allowedExtensions = ['.xlsx', '.xls', '.pdf', '.jpeg', '.png', '.jpg', '.heif', '.heic'];
                        const extension = fileBlob.name.split('.').pop();

                        if (allowedExtensions.includes('.' + extension)) {
                            fileAllowed = true;
                        } else if (fileBlob.type.startsWith('video/')) {
                            fileAllowed = true;
                        } else {
                            fileAllowed = false;
                        }
                    }

                    if (!fileAllowed) {
                        let fieldKey = event.target.getAttribute("data-field-key");
                        gbb.gbbPersonalizePage.state.customerUploadsErrors[fieldKey] = { fileNotSupportedError: true };
                        gbb.gbbPersonalizePage.action.refreshCustomerUploadsErrorMessage()
                        return;
                    }

                    //fileSize limit is 5mbs
                    let fieldKey = event.target.getAttribute("data-field-key");

                    // gbbCustomerUploadsActionButton //disable this button
                    let buttonRef = gbb.$(".gbbCustomerUploadsListItem[data-field-key='" + fieldKey + "']").find(".gbbCustomerUploadsActionButton").children(0);

                    let customerUploadTextFields = gbb.settings.customerUploads.textFields || {};


                    buttonRef.text(customerUploadTextFields.uploadingText.value || "Uploading...")
                    buttonRef.addClass("gbbDisabled");

                    let reader = new FileReader();
                    try {
                        reader.onload = async function (event) {
                            if (fileBlob.size > 5000000) {
                                gbb.gbbPersonalizePage.state.customerUploadsErrors[fieldKey] = { fileSizeError: true };
                                gbb.gbbPersonalizePage.action.refreshCustomerUploadsErrorMessage()
                                buttonRef.removeClass("gbbDisabled");
                                buttonRef.text(customerUploadTextFields.uploadText.value || "Upload")
                                gbb.utility.debugConsole("file size is greater than 5mb")
                                return;
                            };

                            // let fileData = event.target.result;
                            let fileUploadData = await gbb.gbbPersonalizePage.action.uploadCustomerUploadsFile(fileBlob, fieldKey);
                            if (fileUploadData) {
                                const responseDataObject = fileUploadData.data;
                                let fileUrl = responseDataObject.url;
                                let fileName = responseDataObject.originalFileName;
                                let labelName = responseDataObject.fieldKey;
                                const fileDataObject = {
                                    fileUrl: fileUrl,
                                    fileName: fileName,
                                    labelName: labelName
                                }
                                gbb.gbbPersonalizePage.state.customerUploadsResponse = {
                                    ...gbb.gbbPersonalizePage.state.customerUploadsResponse,
                                    [fieldKey]: fileDataObject.fileUrl
                                }

                                gbb.gbbPersonalizePage.f.deleteCustomerUploadsError(fieldKey);

                                // gbb.gbbBrowser.updateCartAttributes(gbb.gbbPersonalizePage.state.customerUploadsResponse);
                                gbb.gbbPersonalizePage.action.refreshCustomerUploadsList();
                                gbb.gbbPersonalizePage.action.refreshCustomerUploadsErrorMessage();
                            } else {
                                gbb.utility.debugConsole("error in uploading file")
                                gbb.gbbPersonalizePage.state.customerUploadsErrors[fieldKey] = { fileUploadError: true };
                                gbb.gbbPersonalizePage.action.refreshCustomerUploadsErrorMessage()
                                buttonRef.removeClass("gbbDisabled");
                                buttonRef.text(customerUploadTextFields.uploadText.value || "Upload")
                            }
                        }
                        reader.readAsDataURL(fileBlob);

                        // we accept 


                    } catch (e) {
                        gbb.utility.debugConsole(e)
                        gbb.gbbPersonalizePage.state.customerUploadsErrors[fieldKey] = { fileUploadError: true };
                        gbb.gbbPersonalizePage.action.refreshCustomerUploadsErrorMessage()
                        buttonRef.removeClass("gbbDisabled");
                        buttonRef.text(customerUploadTextFields.uploadText.value || "Upload")
                        return;
                    }
                } catch (error) {
                    gbb.utility.debugConsole(error);
                    return false;
                }
            }
        },
        components: {
            greetingCard: function (settings) {

                let greetingCardContainer = gbb.$("<div>").addClass("gbbGreetingCardContainer")

                let greetingCardCheckboxLabel = gbb.$("<label>").addClass("gbbGreetingCardCheckboxLabel");
                let greetingCardCheckboxPrice = gbb.$("<label>").addClass("gbbGreetingCardCheckboxPrice");


                let greetingCardImg = gbb.$("<img>").addClass("gbbGreetingCardImg");
                let greetingCardImgWrapper = gbb.$("<div>").addClass("greetingCardImgWrapper");


                // 2.a. img for the greeting card
                let greetingCardWrapper = gbb.$("<div>").addClass("greetingCardWrapper");

                let products = gbb.state.giftBoxCartData.items;

                products.forEach((product) => {
                    //product.properties is an object
                    if (product.properties["_boxProduct"] == "greetingCard") {
                        gbb.gbbPersonalizePage.state.greetingCardTitle = product.variant_title;
                        gbb.gbbPersonalizePage.state.greetingCardPrice = gbb.utility.formatPrice(product.price);
                        gbb.gbbPersonalizePage.state.greetingCardActiveImageSrc = product.image;
                    }
                })
                greetingCardCheckboxLabel.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.personalizePage?.selectGreetingCardLabel) || "Greeting Card1");
                //modularize code from here onwards

                // 2. img container for the greeting card
                let greetingCardImageContainer = gbb.$("<div>").addClass("gbbGreetingCardImageContainer");
                let greetingCardDropDownWrapper = gbb.$("<div>").addClass("gbbGreetingCardDropDownWrapper");
                //: Button
                let greetingCardDropDownButton = gbb.$("<img>").addClass("gbbGreetingCardDropDownButton");
                greetingCardDropDownButton.attr("src", CONSTANT_IMAGES_DROPDOWN_BUTTON);
                let _button = gbb.gbbPersonalizePage.f.activateClearSelectionButton("greetingCard");


                // 2.b. container for all the greeting card options
                let greetingCardAllImagesContainer = gbb.$("<div>").addClass("greetingCardAllImagesContainer");
                let greetingCardAllImagesLabel = gbb.$("<div>").addClass("greetingCardAllImagesLabel");

                //: Language support
                greetingCardAllImagesLabel.text("Greeting Card");

                let greetingCardData = gbb.settings?.shopifyData?.greetingCardData;

                //  greetingCardDropDownWrapper.on("click", async function (event) {
                //  gbb.gbbPersonalizePage.action.handleShowAllGreetingCardImagesButtonEvent(event);
                if (true || gbb.gbbPersonalizePage.state.showAllGreetingCardImages == false) {
                    //if greetingCardData.images has only one element add a class to listwrapper that says gbbJustOneProduct
                    let gbbGreetingCardImageList = gbb.$("<div>").addClass("gbbGreetingCardImageList")
                    gbbGreetingCardImageList.html(gbb.gbbPersonalizePage.f.renderGreetingCardImages(greetingCardData));

                    let greetingCardProducts = Object.values(greetingCardData) || [];
                    let greetingCardVariants = greetingCardProducts[0]?.variants || [];
                    if (greetingCardVariants?.length == 1) {
                        gbbGreetingCardImageList.addClass("gbbJustOneProduct")
                    }


                    gbb.gbbPersonalizePage.state.showAllGreetingCardImages = true;

                    // gbb.$(".greetingCardWrapper").html(_button);
                    greetingCardWrapper.append(gbbGreetingCardImageList);
                    // gbb.$(".greetingCardWrapper").append(gbbGreetingCardImageList);

                    // await gbb.$(".greetingCardWrapper").append(gbb.gbbPersonalizePage.f.activateClearSelectionButton("greetingCard"));
                }
                else {
                    // remove the contents of greetingCardWraooer
                    if (gbb.gbbPersonalizePage.state.greetingCardActiveImageSrc) {
                        greetingCardImg.attr("src", gbb.gbbPersonalizePage.state.greetingCardActiveImageSrc);
                        greetingCardImgWrapper.append(greetingCardImg);
                        gbb.$(".greetingCardWrapper").html(greetingCardImgWrapper);
                    }
                    else {
                        greetingCardCheckboxLabel.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.personalizePage?.selectGreetingCardLabel) || "Greeting Card1");
                        greetingCardCheckboxPrice.text("");
                        gbb.$(".greetingCardWrapper").html("")
                    }
                    gbb.$(".gbbGreetingCardDropDownButton").css("transform", "rotate(180deg)");
                    gbb.gbbPersonalizePage.state.showAllGreetingCardImages = false;
                }
                //  });

                greetingCardImageContainer.append(greetingCardWrapper);
                //  greetingCardImageContainer.append(greetingCardShowAllImagesButtonWrapper);

                greetingCardDropDownWrapper.append(greetingCardCheckboxLabel);
                greetingCardDropDownWrapper.append(_button);


                if (false) {
                    greetingCardDropDownWrapper.append(greetingCardCheckboxPrice);
                    greetingCardDropDownWrapper.append(greetingCardDropDownButton);
                }


                greetingCardContainer.append(greetingCardDropDownWrapper);
                greetingCardContainer.append(greetingCardImageContainer);

                return greetingCardContainer;
            },
            giftWrap: function (settings) {
                // 1. checkbox for giftWrap
                let giftWrapContainer = gbb.$("<div>").addClass("gbbGiftWrapContainer");
                let giftWrapCheckboxLabel = gbb.$("<label>").addClass("gbbGiftWrapCheckboxLabel")
                let giftWrapCheckboxPrice = gbb.$("<label>").addClass("gbbGiftWrapCheckboxPrice")

                let products = gbb.state.giftBoxCartData.items;

                products.forEach((product) => {
                    //product.properties is an object
                    if (product.properties["_boxProduct"] == "giftWrap") {
                        gbb.gbbPersonalizePage.state.giftWrapTitle = product.variant_title;
                        gbb.gbbPersonalizePage.state.giftWrapPrice = gbb.utility.formatPrice(product.price);
                        gbb.gbbPersonalizePage.state.giftWrapActiveImageSrc = product.image;
                    }
                })

                //: Language support

                //modularize code from here onwards

                // 2. img container for the greeting card
                let giftWrapImageContainer = gbb.$("<div>").addClass("gbbGiftWrapImageContainer");

                let giftWrapDropDownWrapper = gbb.$("<div>").addClass("gbbGiftWrapDropDownWrapper");
                let giftWrapDropDownButton = gbb.$("<img>").addClass("gbbGiftWrapDropDownButton")
                giftWrapDropDownButton.attr("src", CONSTANT_IMAGES_DROPDOWN_BUTTON);
                // 2.a. img for the greeting card
                let giftWrapWrapper = gbb.$("<div>").addClass("giftWrapWrapper");
                let giftWrapImgWrapper = gbb.$("<div>").addClass("giftWrapImgWrapper");
                let giftWrapImg = gbb.$("<img>").addClass("gbbGiftWrapImg");

                // 2.b. container for all the greeting card options
                let giftWrapAllImagesContainer = gbb.$("<div>").addClass("giftWrapAllImagesContainer");

                //render all the images in an image tag in AllImagesContainer
                let giftWrapData = gbb.settings?.shopifyData?.giftWrapData;

                // [button] to show all the images
                //let giftWrapShowAllImagesButtonWrapper = gbb.$("<div>").addClass("gbbGreetingCardShowAllImagesButtonWrapper");

                //  selectGreetingCardLabel
                if (gbb.gbbPersonalizePage.state.giftWrapTitle) {
                    giftWrapCheckboxLabel.text(gbb.gbbPersonalizePage.state.giftWrapTitle)
                    giftWrapCheckboxPrice.text(gbb.gbbPersonalizePage.state.giftWrapPrice)
                    giftWrapImg.attr("src", gbb.gbbPersonalizePage.state.giftWrapActiveImageSrc);
                    giftWrapImgWrapper.append(giftWrapImg);

                    giftWrapWrapper.append(giftWrapImgWrapper);
                } else {
                    giftWrapCheckboxLabel.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.personalizePage?.giftWrapLabel) || "Select Wrap 1");
                }


                giftWrapDropDownWrapper.on("click", function (event) {
                    //  gbb.gbbPersonalizePage.action.handleShowAllGreetingCardImagesButtonEvent(event);
                    if (gbb.gbbPersonalizePage.state.showAllGiftWrapImages == false) {

                        gbb.$(".gbbGiftWrapDropDownButton").css("transform", "rotate(360deg)");

                        let giftWrapImageList = gbb.$("<div>").addClass("giftWrapImageList")
                        giftWrapImageList.html(gbb.gbbPersonalizePage.f.renderGiftWrapImages(giftWrapData));

                        if (giftWrapData.variants?.length == 1) {
                            giftWrapImageList.addClass("gbbJustOneProduct")
                        }

                        gbb.gbbPersonalizePage.state.showAllGiftWrapImages = true;

                        gbb.$(".giftWrapWrapper").html(gbb.gbbPersonalizePage.f.activateClearSelectionButton("giftWrap"));
                        gbb.$(".giftWrapWrapper").append(giftWrapImageList);
                    }
                    else {
                        if (gbb.gbbPersonalizePage.state.giftWrapActiveImageSrc) {
                            giftWrapImg.attr("src", gbb.gbbPersonalizePage.state.giftWrapActiveImageSrc);
                            giftWrapImgWrapper.append(giftWrapImg);
                            gbb.$(".giftWrapWrapper").html(giftWrapImgWrapper);
                        }
                        else {
                            giftWrapCheckboxLabel.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.personalizePage?.giftWrapLabel) || "Select Wrap 1");
                            giftWrapCheckboxPrice.text("");
                            gbb.$(".giftWrapWrapper").html("")
                        }

                        gbb.$(".gbbGiftWrapDropDownButton").css("transform", "rotate(180deg)");
                        gbb.gbbPersonalizePage.state.showAllGiftWrapImages = false;
                    }
                });

                //  giftWrapCheckboxLabel.text


                //  giftWrapShowAllImagesButtonWrapper.append(giftWrapShowAllImagesButton);

                giftWrapImageContainer.append(giftWrapWrapper);
                //  giftWrapImageContainer.append(giftWrapShowAllImagesButtonWrapper);


                //  giftWrapContainer.append(giftWrapCheckbox);
                giftWrapDropDownWrapper.append(giftWrapCheckboxLabel);
                giftWrapDropDownWrapper.append(giftWrapCheckboxPrice);
                giftWrapDropDownWrapper.append(giftWrapDropDownButton);
                giftWrapContainer.append(giftWrapDropDownWrapper);

                giftWrapContainer.append(giftWrapImageContainer);

                return giftWrapContainer;
            },
            giftMessage: function (settings) {
                let giftMessageV2MainContent = gbb.$("<div>").addClass("gbbGiftMessageV2MainContent");

                let gbbGiftMessageV2HTML = gbb.$("<div>").addClass('gbbGiftMessageV2HTML')


                let gbbGiftMessageV2ToFromContainer;
                if (gbb.settings?.giftMessage.isSenderAndRecipientNameEnabled == true) {
                    gbbGiftMessageV2ToFromContainer = gbb.gbbPersonalizePage.components.gbbGiftMessageV2ToFromUI();
                }
                // a label field
                let giftMessageV2PrepareUI;
                let gbbGiftMessageV2 = gbb.$("<div>").addClass('gbbGiftMessageV2')
                // a label field
                let gbbGiftMessageV2Label = gbb.$("<label>").addClass("gbbGiftMessageV2Label").attr("for", "gbbGiftMessageV2").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.personalizePage?.messageLabel) || "giftnote1 ");
                let gbbGiftMessageV2InputField = gbb.$("<textarea>").addClass("gbbGiftMessageV2InputField").attr("placeholder", gbb.utility.renderLanguageValue(gbb.settings?.languageData?.personalizePage?.messagePlaceholder) || "Placeholder1")
                let gbbGiftMessageV2RequiredWarning = gbb.$("<div>").addClass("gbbGiftMessageV2RequiredWarning").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.personalizePage?.messageIsRequiredError) || "Message is Required!")
                gbbGiftMessageV2RequiredWarning.css("display", "none");

                let gbbGiftMessageCounterEle = gbb.$("<div>").addClass("gbbGiftMessageCounterEle")


                let giftMessageCharacterLimit = gbb.settings.giftMessage.giftMessageCharacterLimit || "";
                giftMessageCharacterLimit = giftMessageCharacterLimit.trim() != "" && giftMessageCharacterLimit.trim() != "0" ? giftMessageCharacterLimit : "";

                if (giftMessageCharacterLimit) {
                    gbbGiftMessageV2InputField.attr("maxlength", giftMessageCharacterLimit)
                }
                // gbbGiftMessageV2MainContent
                ///save the input field values
                if (gbb.utility.getAttributValueFromMessageItem("Message")) {
                    let noteVal = gbb.utility.getAttributValueFromMessageItem("Message");
                    gbbGiftMessageV2InputField.val(noteVal)
                    gbb.gbbPersonalizePage.state.giftMessage = noteVal;
                    if (giftMessageCharacterLimit) {
                        const maxlength = gbbGiftMessageV2InputField.attr("maxlength");
                        const currentLength = gbbGiftMessageV2InputField.val().length;
                        gbbGiftMessageCounterEle.text(currentLength + "/" + maxlength);
                    }
                }

                gbbGiftMessageV2InputField.on("change", function (event) {
                    gbb.gbbPersonalizePage.state.giftMessage = gbbGiftMessageV2InputField.val();
                })

                if (giftMessageCharacterLimit) {
                    gbbGiftMessageV2InputField.on("input", ((e) => {
                        const target = e.target;
                        // Get the `maxlength` attribute
                        const maxLength = target.getAttribute('maxlength');
                        // Count the current number of characters
                        const currentLength = target.value.length;
                        gbbGiftMessageCounterEle.text(`${currentLength}/${maxLength}`);
                    }))
                }
                gbb.f.applyLabelCSS(gbbGiftMessageV2Label)

                // create an empty divider to separate the message and the video message button
                let gbbGiftMessageV2Divider = gbb.$("<div>").addClass("gbbGiftMessageV2Divider")

                let gbbGiftMessageV2InputFieldsDiv = gbb.$("<div>").addClass("gbbGiftMessageV2InputFieldsDiv")
                gbbGiftMessageV2InputFieldsDiv.append(gbbGiftMessageV2InputField).append(gbbGiftMessageV2RequiredWarning)

                if (giftMessageCharacterLimit) {
                    gbbGiftMessageV2InputFieldsDiv.append(gbbGiftMessageCounterEle)
                }

                gbbGiftMessageV2.append(gbbGiftMessageV2InputFieldsDiv)
                gbbGiftMessageV2.append(gbbGiftMessageV2Divider)
                // gbbGiftMessageV2.append(gbbVideoMsgButton)

                gbbGiftMessageV2HTML.append(gbbGiftMessageV2Label);
                if (gbbGiftMessageV2ToFromContainer) {
                    gbbGiftMessageV2HTML.append(gbbGiftMessageV2ToFromContainer);
                }
                gbbGiftMessageV2HTML.append(gbbGiftMessageV2);
                // gbb.$(".gbbModalContent").html(gbbGiftMessageV2HTML);

                giftMessageV2MainContent.append(gbbGiftMessageV2HTML);

                // let giftMessageV2Buttons = await gbb.gbbGiftMessageV2.f.renderButtons();

                return giftMessageV2MainContent;
            },
            gbbGiftMessageV2ToFromUI: function () {
                let gbbGiftMessageV2ToFromContainer = gbb.$("<div>").addClass("gbbGiftMessageV2ToFromContainer")
                let gbbGiftMessageV2ToField = gbb.$("<input>").addClass("gbbGiftMessageV2ToField").attr("placeholder", gbb.utility.renderLanguageValue(gbb.settings?.languageData?.personalizePage.recipientNamePlaceholder) || "To")
                let gbbGiftMessageV2FromField = gbb.$("<input>").addClass("gbbGiftMessageV2FromField").attr("placeholder", gbb.utility.renderLanguageValue(gbb.settings?.languageData?.personalizePage.senderNamePlaceholder) || "From")

                gbbGiftMessageV2ToFromContainer.append(gbbGiftMessageV2FromField);
                gbbGiftMessageV2ToFromContainer.append(gbbGiftMessageV2ToField)

                if (gbb.utility.getAttributValueFromMessageItem("Sender Name")) {
                    let noteVal = gbb.utility.getAttributValueFromMessageItem("Sender Name");
                    gbbGiftMessageV2FromField.val(noteVal);
                    gbb.gbbPersonalizePage.state.senderName = noteVal;
                }


                gbbGiftMessageV2FromField.on("change", function (event) {
                    gbb.gbbPersonalizePage.state.senderName = gbbGiftMessageV2FromField.val();
                })

                if (gbb.utility.getAttributValueFromMessageItem("Recipient Name")) {
                    let noteVal = gbb.utility.getAttributValueFromMessageItem("Recipient Name");
                    gbbGiftMessageV2ToField.val(noteVal);
                    gbb.gbbPersonalizePage.state.recipientName = noteVal;
                }

                gbbGiftMessageV2ToField.on("change", function (event) {
                    gbb.gbbPersonalizePage.state.recipientName = gbbGiftMessageV2ToField.val();
                })

                return gbbGiftMessageV2ToFromContainer;
            },
            customerUploads: function () {
                let gbbCustomerUploadsHTML = gbb.$("<div>").addClass("gbbCustomerUploadsHTML");
                let gbbCustomerUploadsDivider = gbb.$("<div>").addClass("gbbCustomerUploadsDivider")
                let customerUploadTextFields = gbb.settings.customerUploads.textFields || {};

                // customerUploadTextFields.mainText = "Upload your photos here";
                // customerUploadTextFields.subText = "Supported Formats mp4. Max file size 5MB";

                //let gbbCustomerUploadsMainText, subtext and then a list of dialog
                let gbbCustomerUploadsMainText = gbb.$("<div>").addClass("gbbCustomerUploadsMainText").text(customerUploadTextFields.mainText.value);

                gbb.f.applyLabelCSS(gbbCustomerUploadsMainText)


                let gbbCustomerUploadsSubText = gbb.$("<div>").addClass("gbbCustomerUploadsSubText").text(customerUploadTextFields.subText.value);

                let gbbCustomerUploadsList = gbb.$("<div>").addClass("gbbCustomerUploadsList");

                // gbb.settings.customerUploads.attachmentFields = [{
                //     "label": "Photo 1",
                //     "url": "",
                // },
                // {
                //     "label": "Photo 2",
                //     "url": "",
                // },
                // {
                //     "label": "Photo 3",
                //     "url": "",
                // },
                // {
                //     "label": "Photo 4",
                //     "url": "",
                // }];

                let customerUploadsFields = gbb.settings.customerUploads.attachmentFields;
                //each field has a label
                customerUploadsFields.forEach((field, index) => {
                    let labelToDisplay = gbb.utility.removeFirstCharacterIfUnderscore(field.label);
                    let gbbCustomerUploadsListItem = gbb.$("<div>").addClass("gbbCustomerUploadsListItem").attr("data-field-key", field.label);
                    let gbbCustomerUploadsListItemLabel = gbb.$("<div>").addClass("gbbCustomerUploadsListItemLabel").text(labelToDisplay)


                    //.attr("for", `file-upload-${field.label}`);

                    let gbbCustomerUploadsListItemInput = gbb.$("<input>").addClass("gbbCustomerUploadsListItemInput").attr("type", "file").attr("id", `file-upload-${field.label}`)

                    // gbbCustomerUploadsListItemInput accept. excel, pdf, images .jpg .png .jpeg and videos
                    gbbCustomerUploadsListItemInput.attr("accept", ".xlsx,.xls,application/pdf,image/jpeg,image/png,image/jpg,video/*,image/heif,image/heic")

                    let gbbCustomerUploadsActionButton = gbb.$("<div>").addClass("gbbCustomerUploadsActionButton")

                    gbbCustomerUploadsActionButton.text(customerUploadTextFields.uploadText.value)
                    // gbbCustomerUploadsActionButton.addClass("gbbCustomerUploadButton")

                    let gbbCustomerUploadsButton = gbb.$("<label>").addClass("gbbCustomerUploadButton").attr("for", `file-upload-${field.label}`);
                    // gbbCustomerUploadsActionButton

                    // gbbCustomerUploadsButton.on("click", function (event) {
                    //     event.preventDefault();
                    //     gbbCustomerUploadsListItemInput.trigger("click");
                    // })

                    // gbbCustomerUploadsListItemInput.attr("data-field-index",index)
                    gbbCustomerUploadsListItemInput.attr("data-field-key", field.label);
                    gbbCustomerUploadsListItemInput.on("change", gbb.gbbPersonalizePage.events.onCustomerUploadsFileChange)
                    gbbCustomerUploadsListItem.append(gbbCustomerUploadsListItemLabel)
                    gbbCustomerUploadsListItem.append(gbbCustomerUploadsListItemInput)
                    gbbCustomerUploadsActionButton.append(gbbCustomerUploadsButton)
                    gbbCustomerUploadsListItem.append(gbbCustomerUploadsActionButton);
                    gbbCustomerUploadsList.append(gbbCustomerUploadsListItem);
                })

                let gbbCustomerUploadsErrorMsg = gbb.$("<div>").addClass("gbbCustomerUploadsErrorMsg");


                gbbCustomerUploadsHTML.append(gbbCustomerUploadsMainText)
                gbbCustomerUploadsHTML.append(gbbCustomerUploadsSubText)
                gbbCustomerUploadsHTML.append(gbbCustomerUploadsList)
                gbbCustomerUploadsHTML.append(gbbCustomerUploadsErrorMsg)
                gbbCustomerUploadsHTML.append(gbbCustomerUploadsDivider);

                // gbbCustomerUploadsErrorMsg
                return gbbCustomerUploadsHTML;

            },
            videoMessage: function (settings) {
                let gbbVideoMessageHTML = gbb.$("<div>").addClass("gbbVideoMessageHTML");
                let gbbVideoMsgCheckboxWrapper, gbbVideoMsgButtonGroup;
                let gbbVideoMsgCheckboxLabel;
                let videoId = gbb.utility.getAttributValueFromMessageItem("_videoMsgId");
                //TODO: video message entry index
                if (true) {
                    //gbbVideoMsgButton  = gbb.$("<button>").addClass("gbbVideoMsgButton").attr("type", "button").text(gbb.settings.languageData.videoMessage.sendVideoMessageText.value);
                    gbbVideoMsgButton = gbb.$("<button>").addClass("gbbVideoMsgButton").attr("type", "button").text("Video Msg");
                    gbbVideoMsgCheckboxLabel = gbb.$("<label>").addClass("gbbVideoMsgCheckboxLabel").attr("for", "gbbVideoMsgCheckbox").text(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.sendVideoMessageText) || "Record Video 1");
                    // create a label with switch classname

                    gbb.f.applyLabelCSS(gbbVideoMsgCheckboxLabel)

                    gbbVideoMsgCheckboxWrapper = gbb.$("<label>").addClass("gbbVideoMsgCheckboxWrapper").attr("for", "gbbVideoMsg")

                    //input which is type of checkbox
                    let gbbVideoMsgCheckboxField = gbb.$("<input>").addClass("gbbVideoMsgCheckboxField").attr("type", "checkbox").attr("id", "gbbVideoMsg");


                    if (videoId) {
                        gbbVideoMsgCheckboxField.prop("checked", true);
                    } else {
                        gbbVideoMsgCheckboxField.prop("checked", false);
                    }

                    // a span which is round and slider css
                    let gbbVideoMsgSlider = gbb.$("<span>").addClass("gbbVideoMsgSlider").attr("id", "gbbVideoMsgSlider");

                    gbbVideoMsgButtonGroup = gbb.$("<div>").addClass("gbbVideoMsgButtonGroup");

                    //re record button and upload button
                    // reRecordButton
                    let gbbVideoMsgReRecordButton = gbb.$("<button>").addClass("gbbVideoMsgReRecordButton").attr("type", "button").text(gbb.utility.renderLanguageValue(gbb.settings.languageData?.videoMessage?.reRecordText) || "Re-Record");
                    // uploadButton
                    let gbbVideoMsgSaveButton = gbb.$("<button>").addClass("gbbVideoMsgSaveButton").attr("type", "button").text(gbb.utility.renderLanguageValue(gbb.settings.languageData?.videoMessage?.saveVideoText) || "Save");

                    gbbVideoMsgButtonGroup.append(gbbVideoMsgReRecordButton);

                    gbbVideoMsgButtonGroup.append(gbbVideoMsgSaveButton);


                    gbbVideoMsgSaveButton.on("click", function (event) {
                        if (gbb.gbbVideoMsg.state.justNowRecorded) {
                            gbb.gbbVideoMsg.f.clickAccept(event)
                        } else {
                            return;
                        }
                    });

                    gbbVideoMsgReRecordButton.on("click", function (event) {
                        //manipulate the state of gbbVideoMsgCheckboxField
                        if (gbbVideoMsgCheckboxField.prop("checked")) {
                            gbbVideoMsgCheckboxField.prop("checked", false);
                            gbbVideoMsgSlider.removeClass("gbbVideoMsgSliderActive")
                            gbb.gbbVideoMsg.f.clickClose(event);
                        }
                        gbbVideoMsgCheckboxField.prop("checked", true);
                        gbb.gbbVideoMsg.actions.gbbVideoMsgButton(event);
                    });

                    gbbVideoMsgCheckboxField.on("change", function (event) {
                        if (gbbVideoMsgCheckboxField.is(":checked")) {
                            gbb.gbbVideoMsg.actions.gbbVideoMsgButton(event);
                        } else {
                            gbbVideoMsgSlider.removeClass("gbbVideoMsgSliderActive")
                            gbb.gbbVideoMsg.f.clickClose(event);
                        }
                    })
                    gbbVideoMsgCheckboxWrapper.append(gbbVideoMsgCheckboxField)
                    gbbVideoMsgCheckboxWrapper.append(gbbVideoMsgSlider)

                }
                let videoHasAlreadyBeenRecorded = gbb.$("<div>").addClass("gbbVideoHasAlreadyBeenRecorded");
                //007F60
                videoHasAlreadyBeenRecorded.text("You have already recorded a video")
                // gbbGiftMessageV2InputField and gbbGiftMessageV2Label are added to same parent div
                let gbbVideoMessageCheckboxRow = gbb.$("<div>").addClass("gbbVideoMessageCheckboxRow")
                gbb.f.applyLabelCSS(gbbVideoMsgCheckboxLabel)
                gbbVideoMessageCheckboxRow.append(gbbVideoMsgCheckboxLabel).append(gbbVideoMsgCheckboxWrapper)
                if (gbb.utility.getAttributValueFromMessageItem("_videoMsgId") || gbb.gbbVideoMsg.state.uploadedVideoId) {
                    gbbVideoMessageHTML.append(videoHasAlreadyBeenRecorded)
                }
                gbbVideoMessageHTML.append(gbbVideoMessageCheckboxRow)
                gbb.gbbVideoMsg.init(settings, "", gbbVideoMessageCheckboxRow);

                gbbVideoMessageHTML.append(gbbVideoMsgButtonGroup)
                return gbbVideoMessageHTML;
            },
            scheduleDelivery: async function (settings) {
                let gbbScheduleDeliveryHTML = gbb.$("<div>").addClass("gbbScheduleDeliveryHTML");
                let gbbScheduleDeliveryWrapper = gbb.$("<div>").addClass("gbbScheduleDeliveryWrapper");

                //import date-fns
                try {
                    await gbb.importExternalScript("date-flatpickr");
                    gbb.utility.debugConsole("date-flatpickr imported");
                }
                catch (error) {
                    await gbb.importExternalScript("selfHosted-date-flatpickr");
                    gbb.utility.triggerSlackNotification(error)
                    gbb.utility.debugConsole("date-flatpickr not imported");
                }

                const datePicker = gbb.$("<input>").addClass("gbbScheduleDeliveryDatePicker").attr("type", "date")


                datePicker.attr("placeholder", gbb.utility.renderLanguageValue(gbb.settings.languageData?.reviewPage?.deliverySchedulerPlaceholderText) || "Select Date");
                //append a label to the date picker
                // let gbbScheduleDeliveryDateLabel = gbb.$("<div>").addClass("gbbScheduleDeliveryDateLabel").text(gbb.utility.renderLanguageValue(gbb.settings.languageData?.personalizePage?.deliverySchedulerLabel) || "Schedule Delivery1");
                let gbbScheduleDeliveryDateLabel = gbb.$("<div>").addClass("gbbScheduleDeliveryDateLabel").text(gbb.utility.renderLanguageValue(gbb.settings.languageData?.reviewPage?.deliveryDateLabel) || "Schedule Delivery1");
                //gbb.f.applyLabelCSS(gbbScheduleDeliveryDateLabel)

                gbbScheduleDeliveryWrapper.append(gbbScheduleDeliveryDateLabel)

                gbbScheduleDeliveryWrapper.append(datePicker)
                gbbScheduleDeliveryHTML.append(gbbScheduleDeliveryWrapper);

                return gbbScheduleDeliveryHTML;
            },
            emailAddress: function (settings) {
                let emailAddressHTML = gbb.$("<div>").addClass("gbbEmailAddressHTML");
                let emailAddressWrapper = gbb.$("<div>").addClass("gbbEmailAddressWrapper");

                //introduce an input field to enter the email address
                let gbbVideoMsgEmailField = gbb.$("<input>").addClass("gbbVideoMsgEmailField").attr("type", "email").attr("placeholder", gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.personalizePage?.emailAddressPlaceholder) || "Enter Recipient Email Address1");

                let gbbEmailAddressLabelField = gbb.$("<label>").addClass("gbbEmailAddressLabelField").attr("for", "gbbVideoMsgEmailField").text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.personalizePage?.emailAddressLabel) || "Recipient Email Address1");

                gbb.f.applyLabelCSS(gbbEmailAddressLabelField)

                gbbVideoMsgEmailField.on("change", function (event) {
                    gbb.gbbVideoMsg.state.emailId = gbbVideoMsgEmailField.val();
                })

                if (gbb.utility.getAttributValueFromMessageItem("Recipient Email") != null) {
                    let value = gbb.utility.getAttributValueFromMessageItem("Recipient Email");
                    gbbVideoMsgEmailField.val(value)
                    gbb.gbbVideoMsg.state.emailId = value;
                    // gbbVideoMsgEmailField
                }
                let giftMessageDeliveryInfo = gbb.$("<div>").addClass("giftMessageDeliveryInfo").text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.videoMessage?.giftMessageDeliveryInfo) || "The message will be sent to the recipient via email as soon as the order is placed.");
                //insert the email field below the video message row

                emailAddressWrapper.append(gbbEmailAddressLabelField);
                emailAddressWrapper.append(gbbVideoMsgEmailField).append(giftMessageDeliveryInfo)

                emailAddressHTML.append(emailAddressWrapper);
                return emailAddressHTML;
            },
            scheduleMessageDelivery: function () {
                let gbbScheduleMessageDeliveryHTML = gbb.$("<div>").addClass("gbbScheduleMessageDeliveryHTML").text("Email Delivery Date");
                let gbbScheduleMessageDeliveryWrapper = gbb.$("<div>").addClass("gbbScheduleMessageDeliveryWrapper");

                let gbbScheduleMessageSendNowContainer = gbb.$("<button>").addClass("gbbScheduleMessageSendNowContainer");
                let gbbScheduleMessageSendLaterContainer = gbb.$("<button>").addClass("gbbScheduleMessageSendLaterContainer");

                let gbbScheduleMessageDatePicker = gbb.$("<input>").attr("type", "date").addClass("gbbScheduleMessageDatePicker");
                gbb.gbbPersonalizePage.state.emailDatePicker = gbbScheduleMessageDatePicker;

                let dateValue;
                let cartDateValue = gbb.utility.getAttributValueFromMessageItem("_gbbEmailDeliveryDate");
                let emailDeliveryOption = gbb.utility.getAttributValueFromMessageItem("_gbbEmailDeliveryOption");
                gbb.gbbPersonalizePage.state.emailDeliveryOption = emailDeliveryOption

                let today = new Date().toISOString().slice(0, 10);

                dateValue = cartDateValue || today;

                gbbScheduleMessageDatePicker.attr("value", dateValue);
                gbbScheduleMessageDatePicker.attr("max", new Date(new Date().getTime() + 30 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10));


                if (emailDeliveryOption == "sendLater") {
                    gbbScheduleMessageSendLaterContainer.addClass("gbbActiveMsgDeliveryOptions");
                    gbbScheduleMessageDatePicker.css("display", "block");
                } else {
                    gbbScheduleMessageSendNowContainer.addClass("gbbActiveMsgDeliveryOptions");
                }

                gbbScheduleMessageSendLaterContainer.on("click", (event) => {
                    gbbScheduleMessageDatePicker.css("display", "block");
                    gbbScheduleMessageSendLaterContainer.addClass("gbbActiveMsgDeliveryOptions");
                    gbbScheduleMessageSendNowContainer.removeClass("gbbActiveMsgDeliveryOptions");
                    gbb.gbbPersonalizePage.state.emailDeliveryOption = "sendLater"
                })

                gbbScheduleMessageSendNowContainer.on("click", () => {
                    gbbScheduleMessageDatePicker.css("display", "none");
                    gbbScheduleMessageSendNowContainer.addClass("gbbActiveMsgDeliveryOptions");
                    gbbScheduleMessageSendLaterContainer.removeClass("gbbActiveMsgDeliveryOptions");
                    gbb.gbbPersonalizePage.state.emailDeliveryOption = "sendNow"
                    gbbScheduleMessageDatePicker.attr("value", today);
                })

                gbbScheduleMessageSendNowContainer.text(gbb.utility.renderLanguageValue(gbb.settings.languageData.personalizePage.sendNow) || "Send Now1");
                gbbScheduleMessageSendLaterContainer.text(gbb.utility.renderLanguageValue(gbb.settings.languageData.personalizePage.sendLater) || "Send Later1");

                gbbScheduleMessageDeliveryWrapper.append(gbbScheduleMessageSendNowContainer);
                gbbScheduleMessageDeliveryWrapper.append(gbbScheduleMessageSendLaterContainer);

                gbbScheduleMessageDeliveryHTML.append(gbbScheduleMessageDeliveryWrapper);
                gbbScheduleMessageDeliveryHTML.append(gbbScheduleMessageDatePicker);


                return gbbScheduleMessageDeliveryHTML;
            }
        },
        action: {
            handlegreetingCardCheckboxEvent: function (event) {
                // gbb.$(".gbbGreetingCardImgContainer").addClass("")
                if (event.target.checked == true) {
                    gbb.$(".gbbGreetingCardImageContainer").removeClass("gbbDisabled");
                    //find gbbGreetingCardImageContainer inside of  greetingCardWrapper
                } else {
                    gbb.$(".gbbGreetingCardImageContainer").addClass("gbbDisabled");
                }
            },
            handleShowAllGreetingCardImagesButtonEvent: function (event) {
                // gbb.$(".greetingCardAllImagesContainer").toggleClass(");
                //hide the
                gbb.utility.debugConsole("Event triggered to show all greeting cards")
            },
            handlegiftWrapCheckboxEvent: function (event) {
                // gbb.$(".gbbGreetingCardImgContainer").addClass("")
                if (event.target.checked == true) {
                    gbb.$(".gbbGiftWrapImageContainer").removeClass("gbbDisabled");
                } else {
                    gbb.$(".gbbGiftWrapImageContainer").addClass("gbbDisabled");
                }
            },
            onClearSelectionButtonClick: async function (productType) {
                let products = gbb.state.giftBoxCartData.items;
                let allVariantIdList;
                if (productType == "greetingCard") {
                    allVariantIdList = gbb.settings.shopifyData?.greetingCardData?.variants?.map((variant) => {
                        return variant.id
                    });
                }
                if (productType == "giftWrap") {
                    allVariantIdList = gbb.settings.shopifyData?.giftWrapData?.variants?.map((variant) => {
                        return variant.id
                    });
                }
                let variantIdsToRemoveFromCart;
                //find all the variant ids in the cart whose properties have _boxProduct as the same as productType
                if (products) {
                    variantIdsToRemoveFromCart = products.map((product) => {
                        //product.properties is an object
                        if (product.properties["_boxProduct"] == productType) {
                            return product.variant_id
                        }
                    })
                    // remove null and undefined values

                    // ["123",undefined,undefined,"456"] -> ["123","456"]
                    variantIdsToRemoveFromCart = variantIdsToRemoveFromCart.filter((variantId) => {
                        return variantId != null || variantId != undefined;
                    })
                    await gbb.utility.removeFromCartBulk(variantIdsToRemoveFromCart, productType);
                }
                if (productType == "greetingCard") {
                    gbb.$(".gbbGreetingCardImageList").find(".gbb_checkmark").remove()
                    gbb.$(".gbbGreetingCardImageList").find(".gbbActiveGreetingCard").removeClass("gbbActiveGreetingCard")
                    gbb.gbbPersonalizePage.state.greetingCardActiveImageSrc = "";
                    gbb.gbbPersonalizePage.state.greetingCardTitle = "";
                    gbb.gbbPersonalizePage.state.greetingCardPrice = "";
                    gbb.$(".gbbGreetingCardCheckboxPrice").text(" ");
                    gbb.$(".gbbGreetingCardCheckboxLabel").text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.personalizePage?.selectGreetingCardLabel) || "Greeting Card1");
                }
                if (productType == "giftWrap") {
                    gbb.$(".giftWrapImageList").find(".gbb_checkmark").remove()
                    gbb.$(".giftWrapImageList").find(".activeGiftWrap").removeClass("activeGiftWrap")
                    gbb.gbbPersonalizePage.state.giftWrapActiveImageSrc = "";
                    gbb.gbbPersonalizePage.state.giftWrapTitle = "";
                    gbb.gbbPersonalizePage.state.giftWrapPrice = "";

                    gbb.$(".gbbGiftWrapCheckboxPrice").text(" ");
                    gbb.$(".gbbGiftWrapCheckboxLabel").text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.personalizePage?.giftWrapLabel) || "Select Wrap 1");
                }
                await gbb.utility.getGiftBoxProductsFromCart()
                gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML("personalizePage"));
            },
            onGreetingCardImageClick: async function (event) {
                event.preventDefault();
                //disable gbbGreetingCardImageList pointer events
                gbb.$(".gbbGreetingCardImageList").css("pointer-events", "none");
                // Pass either the image or just trigger this as a callback on Onclick
                let imageSrc;
                imageSrc = gbb.$(this).find("img").attr("src")
                gbb.utility.debugConsole("onclick triggered")
                // gbb.$('.greetingCardImagePreview').attr("src", imageSrc)


                // gbb.utility.addToCart
                //get the image attribute of data-variant-id
                let variantId = gbb.$(this).find("img").attr("data-variant-id");

                await gbb.gbbPersonalizePage.action.onClearSelectionButtonClick("greetingCard");
                gbb.gbbPersonalizePage.state.greetingCardActiveImageSrc = imageSrc


                //find the variant_title and price from the variantId by looping over gbb.settings.shopifyData.greetingCardData?.variants
                let variantTitle = "";
                let variantPrice = "";
                gbb.settings.shopifyData?.greetingCardData?.variants?.forEach((variant) => {
                    if (variant.id == variantId) {
                        variantTitle = variant.title;
                        variantPrice = variant.price;
                    }
                })
                if (variantTitle) {
                    gbb.gbbPersonalizePage.state.greetingCardTitle = variantTitle;
                    // gbb.$(".gbbGreetingCardCheckboxLabel").text(gbb.gbbPersonalizePage.state.greetingCardTitle)
                }
                gbb.$(this).find("input").prop("checked", true)
                gbb.$(this).addClass("gbbActiveGreetingCard")
                // add an icon on top of it
                gbb.gbbPersonalizePage.action.addCheckMarkDivs(gbb.$(this))
                gbb.gbbPersonalizePage.action.removeCheckmarkDivsFromSiblings(gbb.$(this))


                await gbb.utility.updateCartV2({ updates: { [variantId]: 1 }, attributes: { [variantId]: "greetingCard" } })
                gbb.$(".gbbGreetingCardImageList").css("pointer-events", "auto");
                await gbb.utility.getGiftBoxProductsFromCart();
                gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML("personalizePage"));
            },
            onGiftWrapImageClick: async function (event) {
                event.preventDefault();
                gbb.$(".giftWrapImageList").css("pointer-events", "none");
                // Pass either the image or just trigger this as a callback on Onclick
                let imageSrc;
                imageSrc = gbb.$(this).find("img").attr("src")

                await gbb.gbbPersonalizePage.action.onClearSelectionButtonClick("giftWrap");
                // gbb.$('.greetingCardImagePreview').attr("src", imageSrc)
                gbb.gbbPersonalizePage.state.giftWrapActiveImageSrc = imageSrc

                gbb.$(this).find("input").prop("checked", true)
                gbb.$(this).addClass("activeGiftWrap")
                // add an icon on top of it
                gbb.gbbPersonalizePage.action.addCheckMarkDivs(gbb.$(this))
                gbb.gbbPersonalizePage.action.removeCheckmarkDivsFromSiblings(gbb.$(this))
                // gbb.utility.addToCart
                //get the image attribute of data-variant-id
                // gbb.gbbPersonalizePage.f.activateClearSelectionButton("giftWrapImageList","giftWrap");

                let variantId = gbb.$(this).find("img").attr("data-variant-id");


                //find the variant_title and price from the variantId by looping over gbb.settings.shopifyData.greetingCardData?.variants
                let variantTitle = "";
                let variantPrice = "";
                gbb.settings?.shopifyData?.giftWrapData?.variants?.forEach((variant) => {
                    if (variant.id == variantId) {
                        variantTitle = variant.title;
                        variantPrice = variant.price;
                    }

                })
                if (variantTitle) {
                    gbb.gbbPersonalizePage.state.giftWrapTitle = variantTitle;
                }
                if (variantPrice) {
                    gbb.gbbPersonalizePage.state.giftWrapPrice = gbb.utility.formatPrice(variantPrice);
                }

                // gbbGiftWrapCheckboxLabel
                gbb.$(".gbbGiftWrapCheckboxLabel").text(gbb.gbbPersonalizePage.state.giftWrapTitle)
                gbb.$(".gbbGiftWrapCheckboxPrice").text(gbb.gbbPersonalizePage.state.giftWrapPrice)


                await gbb.utility.updateCartV2({ updates: { [variantId]: 1 }, attributes: { [variantId]: "giftWrap" } })
                gbb.$(".giftWrapImageList").css("pointer-events", "auto");
                await gbb.utility.getGiftBoxProductsFromCart()
                gbb.$(".gbbPageFooterHTML").replaceWith(gbb.f.renderCartProductsFooterHTML("personalizePage"));
            },
            findSelectedGreetingCardImage: function () {
                let selectedGreetingCardImage = gbb.$(".greetingCardImageContainer").find(".gbbActiveGreetingCard")
                return selectedGreetingCardImage
            },
            removeCheckmarkDivsFromSiblings: function (element) {
                element.siblings().find(".gbb_checkmark").remove()
                element.siblings().removeClass("gbbActiveGreetingCard")
            },
            removeCheckmarkDivsFromGreetingCards: function () {
                gbb.$(".gbbGreetingCardImageList").find(".gbb_checkmark").remove()
                gbb.$(".gbbGreetingCardImageList").find(".gbbActiveGreetingCard").removeClass("gbbActiveGreetingCard")
            },
            removeCheckmarkDivsFromGiftWrap: function () {
                gbb.$(".giftWrapImageList").find(".gbb_checkmark").remove()
                gbb.$(".giftWrapImageList").find(".activeGiftWrap").removeClass("activeGiftWrap")
            },
            addCheckMarkDivs: function (element) {
                let checkMarkDiv = gbb.$("<span>").addClass("gbb_checkmark")
                checkMarkDiv.append(gbb.$("<div>").addClass("gbb_checkmark_circle"))
                checkMarkDiv.append(gbb.$("<div>").addClass("gbb_checkmark_stem"))
                checkMarkDiv.append(gbb.$("<div>").addClass("gbb_checkmark_kick"))
                element.append(checkMarkDiv)
            },

            showPersonalizationPage: async function () {
                //updatePageStatusFn
                // gbb.gbbAddProductsPage.state.updatePageStatusFn(1);
                let pageId = "personalizationPage";
                await gbb.gbbAddProductsPage.f.renderNextPage(pageId)
            },

            uploadCustomerUploadsFile: async function (fileBlob, fieldKey) {
                try {
                    let formData = new FormData();

                    formData.append("shopName", gbb.settings.merchantInfo.shopName);
                    formData.append("upload_data", fileBlob);
                    formData.append("fieldKey", fieldKey);
                    // formData.append("fileExtension", fileExtension);
                    // formData.append("fileType", fileExtension);
                    // formData.append("fieldKey", fieldKey);
                    formData.append("upload_preset", "gbb_customer_uploads");
                    let response = await fetch("/apps/" + gbb.state.gbbUrl + "/upload/fileUploads", {
                        method: "POST",
                        body: formData
                    });
                    let data = await response.json();
                    return data;
                } catch (e) {
                    gbb.utility.debugConsole(e)
                    return false;
                }
            },
            refreshCustomerUploadsErrorMessage: function (buttonRef) {
                // fileSizeError
                // fileUploadError     

                try {
                    let fileSizeErrorText = gbb.settings.customerUploads.textFields.fileSizeError.value;
                    let fileUploadErrorText = gbb.settings.customerUploads.textFields.fileUploadError.value;
                    let fileNotSupportedText = gbb.settings.customerUploads.textFields.fileNotSupportedError.value;

                    let errorMsgField = gbb.$(".gbbCustomerUploadsErrorMsg");

                    if (errorMsgField) {
                        errorMsgField.html(" ");
                        const objectKeys = Object.keys(gbb.gbbPersonalizePage.state.customerUploadsErrors)

                        for (let i = 0; i < objectKeys.length; i++) {
                            let currentKey = objectKeys[i];
                            let currentItem = gbb.gbbPersonalizePage.state.customerUploadsErrors[currentKey];
                            if (currentItem) {
                                let isFileSizeError = currentItem.fileSizeError;
                                let isFileUploadError = currentItem.fileUploadError;
                                let isFileNotSupported = currentItem.fileNotSupportedError;
                                if (isFileSizeError) {
                                    errorMsgField.append(currentKey + " - " + fileSizeErrorText + "<br/>");
                                }
                                if (isFileUploadError) {
                                    errorMsgField.append(currentKey + " - " + fileUploadErrorText + "<br/>");
                                }
                                if (isFileNotSupported) {
                                    errorMsgField.append(currentKey + " - " + fileNotSupportedText + "<br/>");
                                }

                            }
                        }
                    } else {
                        gbb.utility.debugConsole("field not found")
                    }


                } catch (error) {
                    gbb.utility.debugConsole(error)
                    return;
                }

            },

            refreshCustomerUploadsList: function () {
                try {
                    let customerUploadsList = gbb.$(".gbbCustomerUploadsList");
                    //getCartAttributes
                    //filter attributes to get only those keys that are in customerUploads.fields
                    let customerUploadFields = gbb.settings.customerUploads.attachmentFields;

                    let customerUploads = {};
                    if (!customerUploadFields || !customerUploadFields?.length) {
                        return;
                    }
                    for (let i = 0; i < customerUploadFields?.length; i++) {
                        let currentKey = customerUploadFields[i].label;
                        let imageURL = gbb.utility.getAttributValueFromMessageItem(currentKey);
                        if (imageURL) {
                            customerUploads[currentKey] = imageURL;
                        }
                    }

                    // this occurs when the state is empty, often when the page is refreshed
                    if (gbb.gbbPersonalizePage.state.customerUploadsResponse == null) {
                        gbb.gbbPersonalizePage.state.customerUploadsResponse = customerUploads;
                    }

                    let customerUploadsTextFields = gbb.settings.customerUploads.textFields || {};
                    if (customerUploadsList) {
                        for (let i = 0; i < customerUploadFields.length; i++) {
                            let currentKey = customerUploadFields[i].label;
                            let currentItem = gbb.gbbPersonalizePage.state.customerUploadsResponse[currentKey];
                            let currentListItem = gbb.$(".gbbCustomerUploadsListItem[data-field-key='" + currentKey + "']");
                            let gbbCustomerUploadsActionButton = currentListItem.find(".gbbCustomerUploadsActionButton");
                            if (currentItem) {
                                if (currentListItem) {
                                    //currentListItem has a gbbCustomerUploadsActionButton that should be hidden 
                                    let removeButton = currentListItem.find(".gbbCustomerUploadsRemoveButton");
                                    gbbCustomerUploadsActionButton.removeClass("gbbDisabled");
                                    let previewButton = gbb.$("<div>").addClass("gbbCustomerUploadPreviewButton").text(customerUploadsTextFields.previewText.value || "Preview");

                                    //remove all previous on click events from the button

                                    // gbbCustomerUploadsActionButton.addClass("gbbCustomerUploadPreviewButton")
                                    // gbbCustomerUploadsActionButton.removeClass("gbbCustomerUploadButton")

                                    // gbbCustomerUploadsActionButton.off("click");
                                    previewButton.on("click", function () {
                                        gbb.utility.debugConsole("Clicked on preview from current Item");
                                        window.open(currentItem, '_blank')
                                    });

                                    if (removeButton.length > 0 == false) {
                                        removeButton = gbb.$("<div>").addClass("gbbCustomerUploadsRemoveButton")
                                    }

                                    removeButton.html(CONSTANT_CLOSE_ICON_SVG)


                                    //add a remove button
                                    removeButton.on("click", function () {
                                        gbb.utility.debugConsole("remove button clicked")
                                        currentListItem.find(".gbbCustomerUploadsListItemInput").val("");
                                        gbb.gbbPersonalizePage.f.deleteCustomerUploadsError(currentKey);
                                        gbb.gbbPersonalizePage.f.deleteCustomerUploadsResponse(currentKey);

                                        gbb.gbbPersonalizePage.action.refreshCustomerUploadsList();
                                    });
                                    gbbCustomerUploadsActionButton.html(previewButton)
                                    currentListItem.append(removeButton);
                                }
                            } else {
                                gbb.utility.debugConsole("currentListItem not found")
                                gbbCustomerUploadsActionButton.removeClass("gbbDisabled");
                                // gbbCustomerUploadsActionButton.text(customerUploadsTextFields.uploadText.value || "Upload");
                                // gbbCustomerUploadsActionButton.removeClass("")
                                // gbbCustomerUploadsActionButton.addClass("gbbCustomerUploadButton")
                                //remove the previous click event
                                // gbbCustomerUploadsActionButton.off("click");
                                let gbbCustomerUploadButton = gbb.$("<label>").addClass("gbbCustomerUploadButton").text(customerUploadsTextFields.uploadText.value || "Upload").attr("for", `file-upload-${currentKey}`);
                                // gbbCustomerUploadButton.on("click",function(event){
                                //     gbb.utility.debugConsole("Clicked on upload from current Item");
                                //     event.preventDefault();
                                //     currentListItem.find(".gbbCustomerUploadsListItemInput").trigger("click");
                                // });
                                gbbCustomerUploadsActionButton.html(gbbCustomerUploadButton);
                                gbb.$(currentListItem).find(".gbbCustomerUploadsRemoveButton").remove();
                            }
                        }
                    }
                    gbb.utility.debugConsole("list refreshed")
                } catch (error) {
                    gbb.utility.debugConsole(error)
                }
            },
        }
    },
    gbbProductFormStep: {
        state: {
            formSubmissionData: {},
        },
        components: {
            prepareTextHTML: function (formData, productData) {

                gbb.gbbProductFormStep.f.initFormSubmissionData(formData, productData);

                // Container creation
                let container = gbb.$("<div>").addClass("gbbProductFormTextContainer").attr("fieldKey", formData.fieldKey)

                // Label creation
                let label = gbb.$("<div>").addClass("gbbProductFormTextLabel").text(formData.fieldLabel);
                container.append(label);

                // Validation message and character count
                let validationContainer = gbb.$("<div>").addClass("gbbProductFormValidationContainer");
                let validationMessage = gbb.$("<div>").addClass("gbbRequiredFieldMessage").text(formData.validationMessage)

                validationMessage.hide();


                let isRenderMultiLineInput = formData?.allowMultiLineText || false;

                // Input field creation
                let inputField;
                if (isRenderMultiLineInput) {
                    inputField = gbb.$("<textarea>").addClass("gbbProductFormText").attr({
                        placeholder: formData.placeholderText,
                        fieldKey: formData.fieldKey,
                        isMandatory: formData.isMandatory,
                        minCharacterLimit: formData?.minCharacterLimit || 0,
                        maxCharacterLimit: formData?.maxCharacterLimit || 99999
                    });
                } else {
                    inputField = gbb.$("<input>").addClass("gbbProductFormText").attr({
                        placeholder: formData.placeholderText,
                        type: "text",
                        fieldKey: formData.fieldKey,
                        isMandatory: formData.isMandatory,
                        minCharacterLimit: formData?.minCharacterLimit || 0,
                        maxCharacterLimit: formData?.maxCharacterLimit || 99999
                    });
                }
               // Initial value and character count
                let initialValue = gbb.gbbProductFormStep.state.formSubmissionData[formData.fieldKey]?.value || "";
                inputField.val(initialValue);

                // Character count display creation
                let characterCount = gbb.$("<div>").addClass("gbbProductFormTextCharacterCount").text(initialValue.length + "/" + formData.maxCharacterLimit);
                if (!formData?.maxCharacterLimit) {
                    characterCount.hide();
                }

                // On key up event
                inputField.on("keyup", function (e) {
                    gbb.gbbProductFormStep.f.handleInputChange(gbb.$(this), validationMessage, characterCount);
                });

                container.append(inputField);
                validationContainer.append(validationMessage, characterCount);
                container.append(validationContainer);

                return container;
            },

            prepareImageSelectorHTML: function (formData, productData) {
                gbb.gbbProductFormStep.f.initFormSubmissionData(formData, productData);

                // Initialize variables
                let formSubmissionData = gbb.gbbProductFormStep.state.formSubmissionData;
                let fieldKey = formData.fieldKey;
                let images = formData.images;
                let selectedImage = formSubmissionData[fieldKey]?.value || "";

                // Create main container
                // // let gbbProductFormImageSelectorContainer = createContainer("gbbProductFormImageSelectorContainer", formData.fieldLabel);
                // let gbbProductFormImageSelectorContainer = gbb.$("<div>").addClass("gbbProductFormImageSelectorContainer");


                // // Create image list container
                // let gbbProductFormImageSelectorListContainer = createContainer("gbbProductFormImageSelectorListContainer");

                let gbbProductFormImageSelectorContainer = gbb.$("<div>").addClass("gbbProductFormImageSelectorContainer").attr("fieldKey", fieldKey)
                let gbbProductFormImageSelectorLabel = gbb.$("<div>").addClass("gbbProductFormImageSelectorLabel").text(formData.fieldLabel);
                let gbbProductFormImageSelectorListContainer = gbb.$("<div>").addClass("gbbProductFormImageSelectorListContainer");

                // Create image list
                let gbbProductFormImageSelectorListItems = gbb.$("<div>").addClass("gbbProductFormImageSelectorListItems");


                // Validation message and character count
                let validationContainer = gbb.$("<div>").addClass("gbbProductFormValidationContainer");
                let validationMessage = gbb.$("<div>").addClass("gbbRequiredFieldMessage").text(formData.validationMessage)

                validationMessage.hide();


                // If mandatory, select first image
                if (false && formData.isMandatory && images.length > 0) {
                    selectedImage = images[0].imageCaption;
                }

                // Create image list items
                images.forEach(image => {
                    let currentImageListItem = gbb.gbbProductFormStep.f.createImageListItem(image, fieldKey, selectedImage);
                    gbbProductFormImageSelectorListItems.append(currentImageListItem);
                });

                // Append list items to the list container
                let gbbProductFormImageSelectorList = gbb.$("<div>").addClass("gbbProductFormImageSelectorList");
                gbbProductFormImageSelectorList.append(gbbProductFormImageSelectorListItems);

                // Append list container to the main container
                validationContainer.append(validationMessage);

                gbbProductFormImageSelectorListContainer.append(gbbProductFormImageSelectorList);
                gbbProductFormImageSelectorContainer.append(gbbProductFormImageSelectorLabel);
                gbbProductFormImageSelectorContainer.append(gbbProductFormImageSelectorListContainer);
                gbbProductFormImageSelectorContainer.append(validationContainer);

                return gbbProductFormImageSelectorContainer;


            },
            prepareRadioHTML: function (formData) {

                gbb.gbbProductFormStep.f.initFormSubmissionData(formData);

                // Initialize variables
                let formSubmissionData = gbb.gbbProductFormStep.state.formSubmissionData;
                let fieldKey = formData.fieldKey;
                let options = formData.options;
                let selectedOption = formSubmissionData[fieldKey]?.value || "";

                // Create main container
                let gbbProductFormRadioContainer = gbb.$("<div>").addClass("gbbProductFormRadioContainer").attr("fieldKey", fieldKey);
                let gbbProductFormRadioLabel = gbb.$("<div>").addClass("gbbProductFormRadioLabel");
                gbbProductFormRadioLabel.text(formData.fieldLabel);
                gbbProductFormRadioContainer.append(gbbProductFormRadioLabel);

                // Create radio list container
                let gbbProductFormRadioListContainer = gbb.$("<div>").addClass("gbbProductFormRadioListContainer");

                // Create radio list
                let gbbProductFormRadioListItems = gbb.$("<div>").addClass("gbbProductFormRadioListItems");

                // If mandatory, select first option
                if (formData.isMandatory && options.length > 0) {
                    selectedOption = options[0].value;
                }

                // Create radio list items
                options.forEach((option) => {
                    let currentRadioListItem = gbb.gbbProductFormStep.f.createRadioListItem(option, fieldKey, selectedOption);
                    gbbProductFormRadioListItems.append(currentRadioListItem);
                });

                // Append list items to the list container
                let gbbProductFormRadioList = gbb.$("<div>").addClass("gbbProductFormRadioList");
                gbbProductFormRadioList.append(gbbProductFormRadioListItems);

                // Append list container to the main container
                gbbProductFormRadioListContainer.append(gbbProductFormRadioList);
                gbbProductFormRadioContainer.append(gbbProductFormRadioListContainer);

                return gbbProductFormRadioContainer;



            },

        },
        f: {
            prepareFormToBeRenderedHTML: function (form, product) {

                gbb.gbbProductFormStep.state.formSubmissionData = {};

                // gbb.gbbAddProductsPage.state.productPersonalizationData has a block known as formblock
                //formBlocks: [
                // {
                //     type: "text",
                //     fieldLabel: "Your Name",
                //     fieldKey: "customerNameKey", // this will be used in SF as product attribute.
                //     placeholderText: "Enter your name",
                //     isMandatory: true,
                //     min and max character limit
                //     minCharacterLimit: 2,
                //     maxCharacterLimit: 10,
                //     validationMessage: "Name field is required"
                // },
                // 
                let gbbProductFormContainer = gbb.$("<div>").addClass("gbbProductFormContainer");
                let formComponentDiv;
                let productPersonalizationDataFormBlocks = gbb.gbbAddProductsPage.state.productPersonalizationData?.formBlocks || [];
                productPersonalizationDataFormBlocks.forEach((formBlock) => {
                    switch (formBlock.type) {
                        case "TEXT":
                            formComponentDiv = gbb.gbbProductFormStep.components.prepareTextHTML(formBlock, product);
                            break;
                        case "IMAGE_SELECTOR":
                            formComponentDiv = gbb.gbbProductFormStep.components.prepareImageSelectorHTML(formBlock, product);
                            break;
                        case "RADIO":
                            formComponentDiv = gbb.gbbProductFormStep.components.prepareRadioHTML(formBlock, product);
                            break;

                        // case "radio":
                        //     formComponentDiv = gbb.f.prepareRadioHTML(formBlock);
                        //     break;
                        // case "checkbox":
                        //     formComponentDiv = gbb.f.prepareCheckboxHTML(formBlock);
                        //     break;
                        // case "imageSelector":
                        //     formComponentDiv = gbb.f.prepareImageSelectorHTML(formBlock);
                        //     break;
                        // case default:
                        //     break;
                    }
                    gbbProductFormContainer.append(formComponentDiv);
                })

                return gbbProductFormContainer;

            },
            // formSubmissionData
            initFormSubmissionData: function (formData, productData) {
                try {
                    let formSubmissionData = gbb.gbbProductFormStep.state.formSubmissionData;
                    let fieldKey = formData.fieldKey;
                    formSubmissionData[fieldKey] = {
                        ...gbb.gbbProductFormStep.state.formSubmissionData[fieldKey],
                        fieldLabel: formData.fieldLabel,
                        type: formData.type,
                        value: "",
                        isValid: formData.isMandatory ? false : true,
                        isMandatory: formData.isMandatory,
                        showValueOnSummaryPage: formData?.showValueOnSummaryPage || false,
                    }

                    // let retreiveProductFormTextFromCart = gbb.gbbProductFormStep.f.retreiveProductFormTextFromCart(fieldKey,productData);

                    // if(retreiveProductFormTextFromCart){
                    //     formSubmissionData[fieldKey] = {
                    //         value : retreiveProductFormTextFromCart,
                    //         isValid: true,
                    //         isMandatory : formData.isMandatory,
                    //     }
                    // }

                    gbb.gbbProductFormStep.state.formSubmissionData = formSubmissionData;
                } catch (error) {
                    gbb.utility.debugConsole(error)
                }
            },
            handleFormSubmissionData: function (key, data) {
                gbb.utility.debugConsole("Data to be updated is", data);
                let formSubmissionData = gbb.gbbProductFormStep.state.formSubmissionData;
                formSubmissionData[key] = {
                    // value: value,
                    ...formSubmissionData[key],
                    ...data,
                }
                gbb.gbbProductFormStep.state.formSubmissionData = formSubmissionData;

                // let currentVariantData = JSON.parse(JSON.stringify(gbb.state.variantCustomProperties));
                // currentVariantData[key] = value;
                // gbb.state.variantCustomProperties = currentVariantData;
            },
            checkFormValidationForProduct: function () {
                let formSubmissionData = gbb.gbbProductFormStep.state.formSubmissionData || {};
                let isFormValid = true;
                let formSubmissionDataKeys = Object.keys(formSubmissionData);
                for (let i = 0; i < formSubmissionDataKeys.length; i++) {
                    let currentKey = formSubmissionDataKeys[i];
                    let currentData = formSubmissionData[currentKey];
                    if (currentData.isValid == false) {
                        isFormValid = false;
                        break;
                    }
                }
                return isFormValid;
            },
            displayRequiredFieldMessage: function () {
                let formSubmissionData = gbb.gbbProductFormStep.state.formSubmissionData || {};
                let formSubmissionDataKeys = Object.keys(formSubmissionData);
                for (let i = 0; i < formSubmissionDataKeys.length; i++) {
                    let currentKey = formSubmissionDataKeys[i];
                    let currentData = formSubmissionData[currentKey];
                    let currentInput = gbb.$(`[fieldKey="${currentKey}"]`);
                    let currentInputRequiredFieldMessage = currentInput.find(".gbbRequiredFieldMessage");
                    if (currentData.isValid == false) {
                        currentInputRequiredFieldMessage.css("display", "block");
                    } else {
                        currentInputRequiredFieldMessage.css("display", "none");
                    }
                }
            },
            retreiveProductFormTextFromCart: function (key, product) {
                // let cartData = gbb.gbbBrowser.getCartDataFromSessionStorage();
                let cartData = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(gbb.state.activeBoxId)
                let productFormText = "";
                if (cartData && cartData.items.length > 0) {
                    // let itemsInTheCart = cartData.boxes[gbb.state.activeBoxId].items;
                    let itemsInTheCart = cartData.items;
                    let productInCart = itemsInTheCart.find((item) => {
                        return item.product_id == product.id;
                    })
                    if (productInCart && productInCart.properties) {
                        let properties = productInCart.properties;
                        if (properties && properties[key]) {
                            productFormText = properties[key];
                        }
                    }
                }
                return productFormText;
            },
            handleInputChange: function (currentInput, validationMessage, characterCount) {
                let currentValue = currentInput.val();
                let minLimit = parseInt(currentInput.attr("minCharacterLimit")) || 1;
                let maxLimit = currentInput.attr("maxCharacterLimit");
                let isMandatory = currentInput.attr("isMandatory") == "true";
                let fieldKey = currentInput.attr("fieldKey");
                let isValidationPassed = true;
                let characterCountText = currentValue.length + "/" + maxLimit;

                if (isMandatory && (currentValue.length < minLimit || currentValue.length > maxLimit)) {
                    isValidationPassed = false;
                    //dont show validation message now, we will show it later
                    //when user clicks on Add TO box
                    // validationMessage.show();
                } else {
                    validationMessage.hide();
                }

                if (currentValue.length > maxLimit) {
                    currentInput.val(currentValue.substring(0, maxLimit));
                    currentValue = currentInput.val();
                    characterCountText = maxLimit + "/" + maxLimit;
                }

                characterCount.text(characterCountText);
                gbb.gbbProductFormStep.f.handleFormSubmissionData(fieldKey, { value: currentValue, isValid: isValidationPassed });
            },
            createImageListItem: function (image, fieldKey, selectedImage) {
                let currentImageListItem = gbb.$("<div>").addClass("gbbProductFormImageSelectorListItem");
                let currentImageLabel = gbb.$("<label>").addClass("gbbPersonalizationImageLabel").attr("fieldKey", fieldKey)
                let captionSpan = gbb.$("<span>").addClass("gbbPersonalizationImageCaption").text(image.imageCaption);
                let currentImageListItemRadio = gbb.$("<input>").addClass("personalizationImageInput").attr("type", "radio").attr("name", fieldKey).attr("value", image.imageCaption).attr("fieldKey", fieldKey);
                let currentImageListItemImage = gbb.$("<img>").addClass("personalizationImage").attr("src", image.url).attr("fieldKey", fieldKey);

                currentImageLabel.append(currentImageListItemRadio, currentImageListItemImage);
                currentImageLabel.append(captionSpan);

                currentImageListItem.append(currentImageLabel);


                currentImageListItemRadio.on("click", function (event) {
                    gbb.gbbProductFormStep.f.handleImageSelection(gbb.$(this), currentImageListItem);
                });

                if (selectedImage == image.imageCaption) {
                    currentImageListItemRadio.trigger("click");
                }

                return currentImageListItem;
            },
            handleImageSelection: function (selectedRadio, currentListItem) {
                let radioValue = selectedRadio.val();
                let radioName = selectedRadio.attr("name");

                gbb.gbbProductFormStep.f.handleFormSubmissionData(radioName, { value: radioValue, isValid: true });

                currentListItem.addClass("gbbActiveImageSelectorListItem");
                currentListItem.siblings().removeClass("gbbActiveImageSelectorListItem");

                currentListItem.find(".gbb_checkmark").remove();
                gbb.gbbPersonalizePage.action.addCheckMarkDivs(currentListItem);
                gbb.gbbPersonalizePage.action.removeCheckmarkDivsFromSiblings(currentListItem);
            },
            createRadioListItem: function (option, fieldKey, selectedOption) {
                let currentRadioListItem = gbb.$("<div>").addClass("gbbProductFormRadioListItem");
                let currentRadioLabel = gbb.$("<label>").addClass("gbbpersonalizationRadioLabel").attr("fieldKey", fieldKey);
                let currentRadioItemRadio = gbb.$("<input>").addClass("personalizationRadioInput").attr("type", "radio").attr("name", fieldKey).attr("value", option.value).attr("fieldKey", fieldKey);
                let currentRadioListItemLabel = gbb.$("<span>").addClass("personalizationRadioLabel").text(option.label).attr("fieldKey", fieldKey);

                currentRadioLabel.append(currentRadioItemRadio, currentRadioListItemLabel);
                currentRadioListItem.append(currentRadioLabel);

                currentRadioItemRadio.on("click", function (event) {
                    gbb.gbbProductFormStep.f.handleRadioSelection(gbb.$(this), currentRadioListItem);
                });

                if (selectedOption == option.value) {
                    currentRadioItemRadio.trigger("click");
                }

                return currentRadioListItem;
            },

            handleRadioSelection: function (selectedRadio, currentListItem) {
                let radioValue = selectedRadio.val();
                let radioName = selectedRadio.attr("name");

                gbb.gbbProductFormStep.f.handleFormSubmissionData(radioName, { value: radioValue, isValid: true });

                currentListItem.addClass("gbbActiveRadioSelectorListItem");
                currentListItem.siblings().removeClass("gbbActiveRadioSelectorListItem");
            }

        }
    },
    gbbReviewPage: {
        state: {
            buildBoxButtonAction: undefined,
            ReviewPageBody: ""
        },
        init: async function (settings, parent) {
            if (true || gbb.state.currentPageId !== 'reviewPage') {
                gbb.gbbBrowser.emitCustomEvent({
                    eventName: 'gbb-page-init',
                    detail: {
                        prevPageId: gbb.state.currentPageId,
                        activePageId: 'reviewPage'
                    }
                })
            }
            gbb.state.currentPageId = "reviewPage"
            if (gbb?.gbbAddProductsPage?.state?.productPageData) {
                gbb.gbbAddProductsPage.state.productPageData = undefined
            }
            let navItem = gbb.utility.getNavItem(gbb.state.currentPageId)
            gbb.f.markPreviousNavigationItemsAsCompleted(navItem)
            let cartData = gbb.gbbBrowser.getCartDataFromSessionStorage();
            if (cartData && Object.keys(cartData.boxes).length > 0 && gbb.gbbBrowser.getProductsFromAllBoxesFromCart()?.length > 0 && !gbb.gbbReviewPage.f.checkIfAllBoxesHaveZeroPrice(cartData)) {
                await gbb.gbbReviewPage.initialize(settings, parent)
                await gbb.utility.getGiftBoxProductsFromCart(); //#TBD
            } else {
                await gbb.gbbReviewPage.renderEmptyState();
            }
            gbb.utility.renderTemporaryLoadingSpinner("hide")

            gbb.gbbReviewPage.f.registerEvents(settings)


            // gbb.gbbModel.init(settings)
        },
        renderEmptyState: async function () {

            let gbbEmptySummaryPageWrapper = gbb.$("<div>").addClass("gbbEmptySummaryPageWrapper");
            let gbbSummaryPageHTML = gbb.$("<div>").addClass("gbbSummaryPageBodyHTML");
            const EmptySummaryPageBanner = gbb.$("<div>").addClass("gbbEmptySummaryPageBanner");
            //all the text and button goes in this div
            const EmptySummaryPageBannerImage = gbb.$("<img>").addClass("gbbEmptySummaryPageBannerImage");
            const EmptySummaryPageBannerTextWrapper = gbb.$("<div>").addClass("gbbEmptySummaryPageBannerTextWrapper")
                .css("color", gbb.settings?.pageCustomizationData?.SummaryPage?.bannerTextColor)
                .css("width", "100%");
            const EmptySummaryPageBannerText = gbb.$("<div>").addClass("gbbEmptySummaryPageBannerText");
            const EmptySummaryPageAction = gbb.$("<div>").addClass("EmptySummaryPageAction");

            EmptySummaryPageAction.text(gbb.settings?.stepsConfigurationData?.summaryPageData?.reviewPageEmptyStateBannerButtonText || DEFAULT_EMPTY_REVIEWPAGE_BUTTONTEXT);
            EmptySummaryPageAction.on("click", function (event) {
                gbb.gbbBrowser.initializeRelevantBoxQuantity();
                gbb.state.currentPageId = gbb.state.navigationItems[0]['id'];
                let firstPageItem = gbb.f.getNavItem(gbb.state.currentPageId);
                firstPageItem.initFn();
                gbb.f.addParamsToUrl("page", firstPageItem.id)
            })
            //subtext
            const EmptySummaryPageBannerSubText = gbb.$("<div>").addClass("gbbEmptySummaryPageBannerSubText");
            EmptySummaryPageBannerImage.attr("src", gbb.settings?.stepsConfigurationData?.summaryPageData?.reviewPageEmptyStateBanner || DEFAULT_EMPTY_REVIEWPAGE_BANNER);

            EmptySummaryPageBannerText.text(gbb.settings?.stepsConfigurationData?.summaryPageData?.reviewPageEmptyStateBannerText);
            EmptySummaryPageBannerSubText.text(gbb.settings?.stepsConfigurationData?.summaryPageData?.reviewPageEmptyStateBannerSubText);

            EmptySummaryPageBannerTextWrapper.append(EmptySummaryPageBannerText);
            EmptySummaryPageBannerTextWrapper.append(EmptySummaryPageAction);
            EmptySummaryPageBannerTextWrapper.append(EmptySummaryPageBannerSubText);

            EmptySummaryPageBanner.append(EmptySummaryPageBannerImage);

            gbbSummaryPageHTML.append(EmptySummaryPageBanner);
            gbbSummaryPageHTML.append(EmptySummaryPageBannerTextWrapper);
            gbbEmptySummaryPageWrapper.append(gbbSummaryPageHTML);

            gbb.state.ReviewPageBody = gbbEmptySummaryPageWrapper;
            gbb.gbbReviewPage.f.insertIntoMainPageWrapper();
        },
        initialize: async function (settings, parent) {

            // gbb.utility.debugConsole("settings:",settings.giftwrap);
            // let {isEnabledOnProductPage, isEnabledOnCartPage} = gbb.gbbLandingPage.f.checkifGiftWrapEnabled(settings.giftwrap, productHandle, parent)
            // if (isEnabledOnProductPage) {
            const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()
            let gbbSummaryPageWrapper = gbb.$("<div>").addClass("gbbSummaryPageWrapper");
            if (isPurchaseTypeSubscription) { 
                gbbSummaryPageWrapper.addClass('gbbSubscriptionBundle')
            }
            const gbbSummaryPageHeaderHTML = gbb.gbbReviewPage.f.prepareHeader();
            const gbbDiscountComponent = gbb.$("<div>").addClass("gbbDiscountComponent");
            const gbbSummaryPageBodyHTML = await gbb.gbbReviewPage.f.prepareUIV2();
            // const gbbReviewPageFooterHTML = gbb.gbbReviewPage.f.prepareFooter();

            gbbSummaryPageWrapper.append(gbbSummaryPageHeaderHTML);
            gbbSummaryPageWrapper.append(gbbDiscountComponent);
            gbbSummaryPageWrapper.append(gbbSummaryPageBodyHTML);
            // gbbSummaryPageWrapper.append(gbbReviewPageFooterHTML);

            gbb.state.ReviewPageBody = gbbSummaryPageWrapper;
            gbb.gbbReviewPage.f.insertIntoMainPageWrapper();

            gbb.$("body").attr("data-page", gbb.state.currentPageId)

            // const gbbScheduleDeliveryWrapper = gbb.$();
            //find the selector which is in DEFAULT_scheduleDeliveryPickerSelector
            let gbbSummaryPageDeliveryAndOrderDetailsUI = gbb.$(document).find(".gbbSummaryPageDeliverOrderDetailsDiv");
            gbbSummaryPageDeliveryAndOrderDetailsUI.append(await gbb.gbbReviewPage.f.prepareDeliveryAndOrderDetailsUI());
            gbb.gbbReviewPage.f.reRenderDiscountAndSubTotalV2()

        },
        f: {

            prepareHeader: function () {
                //this is a header
                const gbbSummaryPageHeaderHTML = gbb.$("<div>").addClass("gbbSummaryPageHeader");
                // gbbSummaryPageHeaderHTML.append("<div> <h1> Header Gift Box Builder</h1> </div>");
                // return gbbSummaryPageHeaderHTML;
            },
            prepareUIV2: async function () {

                let gbbSummaryPageHTML = gbb.$("<div>").addClass("gbbSummaryPageHTML");

                const SummaryPageBanner = gbb.$("<div>").addClass("gbbSummaryPageBanner");
                //all the text and button goes in this div
                const SummaryPageBannerImage = gbb.$("<img>").addClass("gbbSummaryPageBannerImage");

                const gbbSummaryPageBannerTextWrapper = gbb.$("<div>").addClass("gbbSummaryPageBannerTextWrapper")
                    .css("color", gbb.settings?.pageCustomizationData?.SummaryPage?.bannerTextColor)
                    .css("width", "100%");
                const SummaryPageBannerText = gbb.$("<div>").addClass("gbbSummaryPageBannerText");
                //subtext
                const SummaryPageBannerSubText = gbb.$("<div>").addClass("gbbSummaryPageBannerSubText");

                SummaryPageBannerImage.attr("src", gbb.settings.pageCustomizationData.banners.productReviewImageSrc);
                SummaryPageBannerText.text(gbb.settings?.stepsConfigurationData?.summaryPageData?.reviewPageBannerText);
                SummaryPageBannerSubText.html(gbb.settings?.stepsConfigurationData?.summaryPageData?.reviewPageBannerSubtext);

                gbbSummaryPageBannerTextWrapper.append(SummaryPageBannerText);
                gbbSummaryPageBannerTextWrapper.append(SummaryPageBannerSubText);

                SummaryPageBanner.append(SummaryPageBannerImage);

                let gbbSummaryPageBodyWrapper = gbb.$("<div>").addClass("gbbSummaryPageBodyWrapper");

                let gbbSummaryPageBundlesContainer = await gbb.gbbReviewPage.f.prepareBundleDetailsContainerUI();
                // if(gbbSummaryPageBundlesContainer.length == 0) {
                //     gbbSummaryPageBundlesContainer = gbb.$("<div>").addClass("gbbSummaryPageBundlesContainer");
                // } else {
                //     gbbSummaryPageBundlesContainer.html("");
                // }

                // let allBoxes = gbb.gbbBrowser.getCartDataFromSessionStorage();
                // allBoxes = allBoxes?.boxes || {}
                // let allBoxesKeys = Object.keys(allBoxes) || [];
                // for(let i=0; i < allBoxesKeys.length; i++) {
                //     let box = allBoxes[allBoxesKeys[i]];
                //     gbbSummaryPageBundlesContainer.append(await gbb.gbbReviewPage.f.prepareBundleDetailsUI(box));
                // }

                let gbbSummaryPageSubsriptionDiv = await gbb.gbbReviewPage.f.prepareSubscriptionUI();
                let gbbSummaryPageDeliverOrderDetailsDiv = gbb.$("<div>").addClass("gbbSummaryPageDeliverOrderDetailsDiv");
                let gbbSummaryPageOrderDetailsUI = gbb.$("<div>").addClass("gbbSummaryPageOrderDetailsUI");

                let gbbCustomHTMLBlock = gbb.gbbReviewPage.f.customHTMLBlock()


                gbbSummaryPageBodyWrapper.append(gbbSummaryPageBundlesContainer);

                if (gbb.settings?.stepsConfigurationData?.isOrderSubscriptionsEnabled) {
                    // gbbSummaryPageBodyWrapper.append(gbbSummaryPageSubsriptionDiv);
                    gbbSummaryPageDeliverOrderDetailsDiv.append(gbbSummaryPageSubsriptionDiv);
                }
                gbbSummaryPageBodyWrapper.append(gbbSummaryPageDeliverOrderDetailsDiv);
                gbbSummaryPageBodyWrapper.append(gbbSummaryPageOrderDetailsUI);

                //gbbSummaryPageHTML.append(SummaryPageBanner);
                gbbSummaryPageHTML.append(gbbSummaryPageBannerTextWrapper);
                gbbSummaryPageHTML.append(gbbSummaryPageBodyWrapper);
                gbbSummaryPageHTML.append(gbbCustomHTMLBlock);
                return gbbSummaryPageHTML;
            },
            prepareSubscriptionUI: async function () {
                //initialize subscriptionValues
                const isOneTimePurchaseEnabled = gbb.settings?.stepsConfigurationData?.isOneTimePurchaseEnabled;

                if (isOneTimePurchaseEnabled == undefined || isOneTimePurchaseEnabled == true) {
                    gbb.gbbBrowser.updateSubscriptionType("oneTimeSubscription");
                } else {
                    gbb.gbbBrowser.updateSubscriptionType("saveSubscription");
                }

                if (gbb.gbbBrowser.getSubscriptionPlan()) {
                    gbb.gbbBrowser.removeSubscriptionPlan();
                }
                let gbbSummaryPageSubscriptionHTML = gbb.$("<div>").addClass("gbbSummaryPageSubscriptionHTML");
                // let gbbSummaryPageSubscriptionContainer = gbb.$("<div>").addClass("gbbSummaryPageSubscriptionContainer");

                let gbbSummaryPageOneTimeSubscriptionDiv = gbb.$("<div>").addClass("gbbSummaryPageOneTimeSubscriptionDiv");
                let gbbSummaryPageOneTimeSubscriptionInput = gbb.$("<input>").attr("id", "oneTimeSubscription").attr("type", "radio").attr("value", "oneTimeSubscription").addClass("gbbSummaryPageOneTimeSubscriptionInput");
                let gbbSummaryPageOneTimeSubscriptionLabel = gbb.$("<label>").attr("for", "oneTimeSubscription").addClass("gbbSummaryPageOneTimeSubscriptionLabel").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.reviewPage?.oneTimePurchaseLabel) || "One-Time Purchase");

                let gbbSummaryPageSubscriptionAndSaveDiv = gbb.$("<div>").addClass("gbbSummaryPageSubscriptionAndSaveDiv");
                let gbbSummaryPageSubscriptionAndSaveInputAndLabel = gbb.$("<div>").addClass("gbbSummaryPageSubscriptionAndSaveInputAndLabel");
                let gbbSummaryPageSubscriptionAndSaveInput = gbb.$("<input>").attr("id", "saveSubscription").attr("type", "radio").attr("value", "saveSubscription").addClass("gbbSummaryPageSubscriptionAndSaveInput");
                let gbbSummaryPageSubscriptionAndSaveLabel = gbb.$("<label>").attr("for", "saveSubscription").addClass("gbbSummaryPageSubscriptionAndSaveLabel").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.reviewPage?.subscribeAndSaveLabel) || "Subscribe and save");

                if (isOneTimePurchaseEnabled == undefined || isOneTimePurchaseEnabled) {
                    gbbSummaryPageOneTimeSubscriptionInput.prop("checked", gbb.gbbBrowser.getSubscriptionType() == "oneTimeSubscription" ? true : false);
                } else {
                    gbbSummaryPageSubscriptionAndSaveInput.prop("checked", true);
                }



                gbbSummaryPageSubscriptionAndSaveInputAndLabel.append(gbbSummaryPageSubscriptionAndSaveInput);
                gbbSummaryPageSubscriptionAndSaveInputAndLabel.append(gbbSummaryPageSubscriptionAndSaveLabel);
                gbbSummaryPageSubscriptionAndSaveInput.prop("checked", gbb.gbbBrowser.getSubscriptionType() == "saveSubscription" ? true : false);

                gbbSummaryPageOneTimeSubscriptionInput.on("change", () => {
                    gbb.gbbBrowser.updateSubscriptionType("oneTimeSubscription");
                    if (gbb.gbbBrowser.getSubscriptionPlan()) {
                        gbb.gbbBrowser.removeSubscriptionPlan();
                    }
                    gbb.$(".gbbSummaryPageNoSellingPlanFoundContainer").remove();
                    gbb.$(".gbbSummaryPageSubscriptionPlansDropdownContainer").remove();
                    gbb.gbbReviewPage.f.reRenderUiOnSubscriptionChange();
                    gbbSummaryPageSubscriptionAndSaveInput.prop("checked", false);
                })

                gbbSummaryPageSubscriptionAndSaveInput.on("change", async () => {
                    gbb.gbbBrowser.updateSubscriptionType("saveSubscription");
                    gbbSummaryPageOneTimeSubscriptionInput.prop("checked", false);
                    gbbSummaryPageSubscriptionAndSaveDiv.append(await gbb.gbbReviewPage.f.prepareSellingsPlansDropDown());

                    const subscriptionPlanExists = gbb.gbbReviewPage.f.checkIfSubscriptionPlanExists();
                    if (subscriptionPlanExists) {
                        gbb.gbbReviewPage.f.reRenderUiOnSubscriptionChange();
                    }
                })
                gbbSummaryPageOneTimeSubscriptionDiv.append(gbbSummaryPageOneTimeSubscriptionInput);
                gbbSummaryPageOneTimeSubscriptionDiv.append(gbbSummaryPageOneTimeSubscriptionLabel);

                gbbSummaryPageSubscriptionAndSaveDiv.append(gbbSummaryPageSubscriptionAndSaveInputAndLabel);

                if (isOneTimePurchaseEnabled != undefined && isOneTimePurchaseEnabled != true) {
                    gbbSummaryPageSubscriptionAndSaveDiv.append(await gbb.gbbReviewPage.f.prepareSellingsPlansDropDown("initialize"));
                    gbb.gbbBrowser.updateSubscriptionType("saveSubscription");
                    gbbSummaryPageOneTimeSubscriptionInput.prop("checked", false);
                    gbb.gbbReviewPage.f.reRenderUiOnSubscriptionChange();
                }

                if (isOneTimePurchaseEnabled == undefined || isOneTimePurchaseEnabled == true) {
                    gbbSummaryPageSubscriptionHTML.append(gbbSummaryPageOneTimeSubscriptionDiv);
                }

                gbbSummaryPageSubscriptionHTML.append(gbbSummaryPageSubscriptionAndSaveDiv);
                return gbbSummaryPageSubscriptionHTML;
            },
            prepareSellingsPlansDropDown: async function (type) {
                let gbbSummaryPageSubscriptionPlansDropdownContainer = gbb.$("<div>").addClass("gbbSummaryPageSubscriptionPlansDropdownContainer");
                let cartProducts = gbb.gbbBrowser.getProductsFromAllBoxesFromCart();

                for (let i = 0; i < cartProducts.length; i++) {
                    cartProducts[i].sellingPlanDetails = gbb.gbbReviewPage.f.getSellingPlanDetailsForVariant(cartProducts[i]?.selling_plan_groups, cartProducts[i]?.selling_plan_allocations);
                    gbb.gbbBrowser.updateCartItemSellingDetails(cartProducts[i]["variant_id"], cartProducts[i]?.sellingPlanDetails);
                }

                let isAllItemsHaveASellingPlan = gbb.gbbReviewPage.f.checkIfAllItemsHasASellingPlan();
                let allAvailableSubscriptions = gbb.gbbReviewPage.f.getAllSubscriptionPlans();
                allAvailableSubscriptions = Object.values(allAvailableSubscriptions) || [];

                if (!isAllItemsHaveASellingPlan || allAvailableSubscriptions.length == 0) {
                    let gbbSummaryPageNoSellingPlanFoundContainer = gbb.$("<div>").addClass("gbbSummaryPageNoSellingPlanFoundContainer");
                    gbbSummaryPageNoSellingPlanFoundContainer.text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.reviewPage?.noSubscriptionFoundLabel) || "Oops! No Subscription Plans were found");
                    gbbSummaryPageSubscriptionPlansDropdownContainer.append(gbbSummaryPageNoSellingPlanFoundContainer);
                    if (gbb.gbbBrowser.getSubscriptionPlan()) {
                        gbb.gbbBrowser.removeSubscriptionPlan();
                    }
                } else {
                    const gbbSubscriptionDeliveryFrequencyLabel = gbb.$("<div>").addClass("gbbSubscriptionDeliveryFrequencyLabel");
                    gbbSubscriptionDeliveryFrequencyLabel.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.reviewPage?.deliveryFrequencyLabel) || "Delivery Frequency");
                    const gbbSubscriptionDropDownSelect = gbb.$("<select>").addClass("gbbSubscriptionDropDownSelect");
                    allAvailableSubscriptions.forEach((plan, index) => {
                        if (plan) {
                            //let planName = plan?.selling_plan_name + " " + "( " + gbb.utility.getCurrencySymbol() + plan?.per_delivery_price + "/" + (gbb.utility.renderLanguageValue(gbb.settings?.languageData?.reviewPage?.deliveryLabel) || "delivery") + " )" || "";
                            let planName = plan?.selling_plan_name;
                            let optionEle = gbb.$("<option>").attr("value", plan?.selling_plan_id)
                                .text(planName);
                            if (index == 0 && (!gbb.gbbBrowser.getSubscriptionPlan() || type == "initialize")) {
                                optionEle.attr("selected", "selected");
                                gbb.gbbBrowser.updateSubscriptionPlan(parseInt(plan?.selling_plan_id))
                            }
                            if (gbb.gbbBrowser.getSubscriptionPlan() == plan?.selling_plan_id) {
                                optionEle.attr("selected", "selected");
                            }
                            gbbSubscriptionDropDownSelect.append(optionEle)
                        }
                    })
                    gbbSubscriptionDropDownSelect.change(async (event) => {
                        gbb.gbbBrowser.updateSubscriptionPlan(parseInt(event.target.value));
                        gbb.gbbReviewPage.f.reRenderUiOnSubscriptionChange();
                    })
                    gbbSummaryPageSubscriptionPlansDropdownContainer.append(gbbSubscriptionDeliveryFrequencyLabel);
                    gbbSummaryPageSubscriptionPlansDropdownContainer.append(gbbSubscriptionDropDownSelect);
                }
                return gbbSummaryPageSubscriptionPlansDropdownContainer;
            },
            getSellingPlanDetailsForVariant: function (selling_plan_groups, selling_plan_allocations) {
                try {
                    // gbb.utility.debugConsole("inside getSellingPlanDetailsForVariant");
                    let result = {};
                    if (selling_plan_groups?.length > 0 && selling_plan_allocations?.length > 0) {
                        //loop through all the selling_plan_allocations
                        for (let i = 0; i < selling_plan_allocations.length; i++) {
                            let sellingPlanId = selling_plan_allocations[i]?.selling_plan_id; //current selling_plan_id from selling_plan_allocations of the variant
                            let sellingPlanName;
                            let perDeliveryPrice = selling_plan_allocations[i]?.per_delivery_price;
                            let price = selling_plan_allocations[i]?.price;
                            let sellingPlanGroup = selling_plan_groups.find(group => group.id == selling_plan_allocations[i]?.selling_plan_group_id); //find the selling plan group to which this plan belongs to get the name of the plan

                            for (let j = 0; j < sellingPlanGroup?.selling_plans.length; j++) { //loop through all the selling_plans of this group

                                let currentSellingPlan = sellingPlanGroup?.selling_plans[j];
                                if (currentSellingPlan && currentSellingPlan.id == sellingPlanId) {
                                    sellingPlanName = currentSellingPlan?.name || "";
                                    break;
                                }
                            }
                            result[sellingPlanId] = {
                                selling_plan_id: sellingPlanId,
                                selling_plan_name: sellingPlanName,
                                per_delivery_price: perDeliveryPrice,
                                price: price
                            }
                            //result.push(obj);
                        }
                    }
                    // gbb.utility.debugConsole("result inside getSellingPlanDetailsForVariant", result);
                    return result;
                } catch (err) {
                    gbb.utility.debugConsole(err);
                }
            },
            getAllSubscriptionPlans: function () {
                try {
                    let items = gbb.gbbBrowser.getProductsFromAllBoxesFromCart();
                    let uniquePlans = {};
                    for (let i = 0; i < items.length; i++) {
                        if (items[i]?.sellingPlanDetails) {
                            let sellingPlanDetails = Object.values(items[i]?.sellingPlanDetails) || [];
                            for (let j = 0; j < sellingPlanDetails?.length; j++) {
                                let currPlan = sellingPlanDetails[j] || "";
                                if (currPlan && !uniquePlans[currPlan.selling_plan_id]) {
                                    uniquePlans[currPlan.selling_plan_id] = {
                                        selling_plan_id: currPlan?.selling_plan_id || "",
                                        selling_plan_name: currPlan?.selling_plan_name || "",
                                        per_delivery_price: currPlan?.per_delivery_price || ""
                                    }
                                }
                            }
                        }
                    }

                    let tempUniquePlans = Object.values(uniquePlans) || [];

                    for (let i = 0; i < tempUniquePlans.length; i++) {
                        for (let j = 0; j < items.length; j++) {
                            let planToTest = items[j].sellingPlanDetails[tempUniquePlans[i]["selling_plan_id"]] || undefined;
                            if (!planToTest) {
                                delete uniquePlans[tempUniquePlans[i]["selling_plan_id"]]
                                break;
                            }
                        }
                    }
                    // gbb.utility.debugConsole("uniquePlans:", uniquePlans);
                    return uniquePlans;
                } catch (err) {
                    gbb.utility.debugConsole(err);
                    return {};
                }
            },
            checkIfAllItemsHasASellingPlan: function () {
                let result = true;
                let products = gbb.gbbBrowser.getProductsFromAllBoxesFromCart();
                // gbb.utility.debugConsole("products inside checkIfAllItemsHasASellingPlan:", products);
                for (let i = 0; i < products?.length; i++) {
                    if (!products[i]?.sellingPlanDetails || Object.values(products[i]?.sellingPlanDetails)?.length == 0) {
                        result = false;
                        break;
                    }
                }
                // gbb.utility.debugConsole("result inside checkIfAllItemsHasASellingPlan", result);
                return result;
            },
            prepareBundleDetailsContainerUI: async function (boxesData) {
                try {
                    let gbbSummaryPageBundlesContainer = gbb.$(".gbbSummaryPageBundlesContainer");
                    if (gbbSummaryPageBundlesContainer.length == 0) {
                        gbbSummaryPageBundlesContainer = gbb.$("<div>").addClass("gbbSummaryPageBundlesContainer");
                    } else {
                        gbbSummaryPageBundlesContainer.html("");
                    }
                    let allBoxes;
                    if (!boxesData) {
                        allBoxes = gbb.gbbBrowser.getCartDataFromSessionStorage();
                        allBoxes = allBoxes?.boxes || {};
                    } else {
                        allBoxes = boxesData?.boxes || {}
                    }

                    let allBoxesKeys = Object.keys(allBoxes) || [];
                    for (let i = 0; i < allBoxesKeys.length; i++) {
                        let box = allBoxes[allBoxesKeys[i]];
                        if (gbb.gbbReviewPage.f.checkIfCurrentBoxPriceIsZero(box)) {
                            continue;
                        }
                        gbbSummaryPageBundlesContainer.append(await gbb.gbbReviewPage.f.prepareBundleDetailsUI(box));
                    }
                    return gbbSummaryPageBundlesContainer;
                } catch (err) {
                    gbb.utility.debugConsole(err + "in prepareBundleDetailsContainerUI");
                }
            },
            prepareBundleDetailsUI: async function (box) {
                //items:
                const isPurchaseTypeSubscription = gbb.gbbSubscriptionProductsPage.f.checkIfPurchaseTypeIsSubscription()
                let gbbSummaryPageBundleDetailsHTML = gbb.$(".gbbSummaryPageBundleDetailsHTML");

                // if(true || gbbSummaryPageBundleDetailsHTML.length == 0) {
                gbbSummaryPageBundleDetailsHTML = gbb.$("<div>").addClass("gbbSummaryPageBundleDetailsHTML");
                // } else {
                //     //empty the div if found, below we will append the new content
                //     gbbSummaryPageBundleDetailsHTML.html("");
                // }

                let gbbSummaryPageBundleDetailsWithProducts = gbb.$("<div>").addClass("gbbSummaryPageBundleDetailsWithProducts");

                let gbbSummaryPageBundleImageTitleContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleImageTitleContainer");
                let gbbSummaryPageBundleImageContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleImageContainer");
                let gbbSummaryPageBundleImage = gbb.$("<img>").addClass("gbbSummaryPageBundleImage")
                    .attr("src", gbb.settings?.stepsConfigurationData?.bundleImg || DEFAULT_BUNDLE_IMAGE);
                gbbSummaryPageBundleImageContainer.append(gbbSummaryPageBundleImage);

                let gbbSummaryPageBundleDetailsContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleDetailsContainer");
                let gbbSummaryPageBundleDetails = gbb.$("<div>").addClass("gbbSummaryPageBundleDetails");

                let gbbSummaryPageBundleActions = gbb.$("<div>").addClass("gbbSummaryPageBundleActions");

                let gbbSummaryPageBundleTitleContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleTitleContainer");
                let gbbSummaryPageBundleTitle = gbb.$("<div>").addClass("gbbSummaryPageBundleTitle");
                gbbSummaryPageBundleTitle.text(gbb?.settings?.stepsConfigurationData?.bundleName || "BundleX");

                //this will be rendered with gbbSummaryPageBundlePriceContainer
                let gbbSummaryPageBundleQuantity = gbb.$("<div>").addClass("gbbSummaryPageBundleQuantity");
                // gbbSummaryPageBundleQuantity.text("x"+gbb.gbbBrowser.getRelevantBoxQuantity(box?.boxId));
                gbbSummaryPageBundleQuantity.text("x" + box?.boxQuantity || 1);

                let noOfItems = 0;
                let cartData = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(box?.boxId);
                if (cartData && cartData.items) {
                    noOfItems = cartData.items.length;
                }
                let gbbSummaryPageBundleItemsLabel = gbb.$("<div>").addClass("gbbSummaryPageBundleItemsLabel")
                    .text(noOfItems)
                gbbSummaryPageBundleItemsLabel.append(" ").append(gbb.settings?.languageData?.reviewPage?.itemsLabel?.value || "item(s)")
                gbbSummaryPageBundleTitleContainer.append(gbbSummaryPageBundleTitle);
                gbbSummaryPageBundleTitleContainer.append(gbbSummaryPageBundleItemsLabel);

                let gbbSummaryPageBundleQuantityContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleQuantityContainer");
                let gbbSummaryPageBundleQuantityText = gbb.$("<div>").addClass("gbbSummaryPageBundleQuantityText");
                // gbbSummaryPageBundleQuantityText.text(gbb.gbbBrowser.getRelevantBoxQuantity(box?.boxId));
                gbbSummaryPageBundleQuantityText.text(box?.boxQuantity || 1);

                let gbbSummaryPageBundleQuantityAddButton = gbb.$("<div>").addClass("gbbSummaryPageBundleQuantityAddButton");
                gbbSummaryPageBundleQuantityAddButton.css("background", gbb.settings.pageCustomizationData?.productCard?.productCardButtonColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                gbbSummaryPageBundleQuantityAddButton.css("color", gbb.settings.pageCustomizationData?.productCard?.productCardButtonTextColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);

                let gbbSummaryPageQuantityAddButtonWrapper = gbb.$("<div>").addClass("gbbSummaryPageQuantityAddButtonWrapper");
                gbbSummaryPageQuantityAddButtonWrapper.html("+");
                gbbSummaryPageBundleQuantityAddButton.append(gbbSummaryPageQuantityAddButtonWrapper);

                let gbbSummaryPageBundleQuantityRemoveButton = gbb.$("<div>").addClass("gbbSummaryPageBundleQuantityRemoveButton");
                gbbSummaryPageBundleQuantityRemoveButton.css("background", gbb.settings.pageCustomizationData?.productCard?.productCardButtonColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                gbbSummaryPageBundleQuantityRemoveButton.css("color", gbb.settings.pageCustomizationData?.productCard?.productCardButtonTextColor || gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor);
                let gbbSummaryPageQuantityRemoveButtonWrapper = gbb.$("<div>").addClass("gbbSummaryPageQuantityRemoveButtonWrapper");
                gbbSummaryPageQuantityRemoveButtonWrapper.html("-");
                gbbSummaryPageBundleQuantityRemoveButton.append(gbbSummaryPageQuantityRemoveButtonWrapper);

                gbbSummaryPageBundleQuantityContainer.append(gbbSummaryPageBundleQuantityRemoveButton);
                gbbSummaryPageBundleQuantityContainer.append(gbbSummaryPageBundleQuantityText);
                gbbSummaryPageBundleQuantityContainer.append(gbbSummaryPageBundleQuantityAddButton);

                gbbSummaryPageBundleQuantityAddButton.on("click", (event) => {
                    setTimeout(function () {
                        //   gbb.utility.debugConsole("after timeeout");
                        gbbSummaryPageBundleQuantityAddButton.prop("disabled", false);
                        gbbSummaryPageBundleQuantityAddButton.removeClass("gbbDisabled");
                    }, 500);
                    let currentBundleQuantity = gbb.gbbBrowser.getRelevantBoxQuantity(box?.boxId);
                    currentBundleQuantity = gbb.gbbBrowser.updateRelevantBoxQuantity(currentBundleQuantity + 1, box?.boxId);
                    gbbSummaryPageBundleQuantityText.text(currentBundleQuantity);
                    gbbSummaryPageBundleQuantity.text("x" + currentBundleQuantity);

                    gbb.gbbReviewPage.f.reRenderDiscountAndSubTotalV2()
                })

                gbbSummaryPageBundleQuantityRemoveButton.on("click", (event) => {
                    setTimeout(function () {
                        // gbb.utility.debugConsole("after timeeout")
                        gbbSummaryPageBundleQuantityRemoveButton.prop('disabled', false);
                        gbbSummaryPageBundleQuantityRemoveButton.removeClass("gbbDisabled");
                    }, 500);
                    let currentBundleQuantity = gbb.gbbBrowser.getRelevantBoxQuantity(box?.boxId);
                    if (currentBundleQuantity > 1) {
                        currentBundleQuantity = gbb.gbbBrowser.updateRelevantBoxQuantity(currentBundleQuantity - 1, box?.boxId);
                        gbbSummaryPageBundleQuantityText.text(currentBundleQuantity);
                        gbbSummaryPageBundleQuantity.text("x" + currentBundleQuantity);
                        gbb.gbbReviewPage.f.reRenderDiscountAndSubTotalV2()
                    }
                })

                gbbSummaryPageBundleDetails.append(gbbSummaryPageBundleTitleContainer);
                if (isPurchaseTypeSubscription) {
                    let gbbSummaryPageBundleSubscriptionDetails = gbb.$("<div>").addClass("gbbSummaryPageBundleSubscriptionDetails");
                    const subscriptionDataFromSessionStorage = gbb.gbbSubscriptionProductsPage.f.getSubscriptionDataFromSessionStorage()
                    let activeSellingPlanDetails = subscriptionDataFromSessionStorage.activeSellingPlanDetails || {}
                    gbbSummaryPageBundleSubscriptionDetails.text(activeSellingPlanDetails?.displayTitle || "");
                    gbbSummaryPageBundleDetails.append(gbbSummaryPageBundleSubscriptionDetails);
                }
                gbbSummaryPageBundleDetails.append(gbbSummaryPageBundleQuantityContainer);
                // gbbSummaryPageBundleDetails.append(gbbSummaryPageBundleProductsContainer);

                let gbbSummaryPageBundlePriceContainer = gbb.$("<div>").addClass("gbbSummaryPageBundlePriceContainer");

                let gbbSummaryPageBundleOriginalPrice = gbb.$("<div>").addClass("gbbSummaryPageBundleOriginalPrice").css("color", "#625f5f");
                gbbSummaryPageBundleOriginalPrice.append(gbb.utility.formatPrice(box.total_price));

                let gbbSummaryPageBundlePriceLabel = gbb.$("<div>").addClass("gbbSummaryPageBundlePriceLabel").text("Price");

                let gbbSummaryPageBundleDiscountedPrice = gbb.$("<div>").addClass("gbbSummaryPageBundleDiscountedPrice");

                if (gbb.settings?.discountsData?.isDiscountEnabled && gbb.settings?.discountsData?.isShowDiscountsEnabled && gbb.utility.getGiftBoxProductsDiscountedTotal(box?.boxId) != parseFloat(box.total_price / 100)) {
                    gbbSummaryPageBundlePriceContainer.css("grid-template-columns", "1fr 1fr min-content")
                    gbbSummaryPageBundlePriceContainer.append(gbbSummaryPageBundleOriginalPrice);
                }

                // gbbSummaryPageBundlePriceContainer.append(gbbSummaryPageBundlePriceLabel);

                // gbbSummaryPageBundleDiscountedPrice.append(gbb.gbbBrowser.getRelevantGiftBoxProductsTotalWithCurrency(box?.boxId))
                let formattedDiscountedPrice = gbb.utility.formatPrice(box.total_price);
                let discountedTotal = gbb.utility.getGiftBoxProductsDiscountedTotal(box?.boxId);

                if (gbb.settings?.discountsData?.isDiscountEnabled && gbb.settings?.discountsData?.isShowDiscountsEnabled && gbb.utility.getGiftBoxProductsDiscountedTotal(box?.boxId) != parseFloat(box.total_price / 100)) {
                    discountedTotal = gbb.utility.getGiftBoxProductsDiscountedTotal(box?.boxId);
                    let discountedTotalInShopifyFormat = discountedTotal * 100;
                    formattedDiscountedPrice = gbb.utility.formatPrice(discountedTotalInShopifyFormat);
                }
                gbbSummaryPageBundleDiscountedPrice.append(formattedDiscountedPrice);

                gbbSummaryPageBundlePriceContainer.append(gbbSummaryPageBundleDiscountedPrice);
                gbbSummaryPageBundlePriceContainer.append(gbbSummaryPageBundleQuantity);
                gbbSummaryPageBundleActions.append(gbbSummaryPageBundlePriceContainer);


                let gbbSummaryPageBundleEditRemoveButtons = gbb.$("<div>").addClass("gbbSummaryPageBundleEditRemoveButtons");
                let gbbSummaryPageBundleRemoveButton = gbb.$("<div>").addClass("gbbSummaryPageBundleRemoveButton")
                    .text(gbb.settings?.languageData?.general?.removeButtonText?.value || "Remove");
                let gbbSummaryPageBundleEditButton = gbb.$("<div>").addClass("gbbSummaryPageBundleEditButton")
                    .text(gbb.settings?.languageData?.reviewPage?.editButtonText?.value || "Edit");

                gbbSummaryPageBundleEditButton.on("click", (event) => {
                    gbb.gbbBrowser.activateRelevantBoxInSessionStorage(box?.boxId, { redirectToFirstProductPage: true });
                })

                gbbSummaryPageBundleRemoveButton.on("click", async (event) => {
                    await gbb.gbbBrowser.clearRelevantBoxFromSessionStorage(box?.boxId);
                })

                gbbSummaryPageBundleEditRemoveButtons.append(gbbSummaryPageBundleEditButton);
                gbbSummaryPageBundleEditRemoveButtons.append(gbbSummaryPageBundleRemoveButton);
                gbbSummaryPageBundleActions.append(gbbSummaryPageBundleEditRemoveButtons);

                gbbSummaryPageBundleDetailsContainer.append(gbbSummaryPageBundleDetails);
                gbbSummaryPageBundleDetailsContainer.append(gbbSummaryPageBundleActions);

                // gbbSummaryPageBundleImageTitleContainer.append(gbbSummaryPageBundleImageContainer);
                // gbbSummaryPageBundleImageTitleContainer.append(gbbSummaryPageBundleDetailsContainer);

                let gbbSummaryPageBundleProductsMainContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleProductsMainContainer");
                //let gbbSummaryPageBundleProductEmptyDiv =  gbb.$("<div>").addClass("gbbSummaryPageBundleProductEmptyDiv");
                let gbbSummaryPageBundleProductsContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleProductsContainer");
                gbb.gbbReviewPage.f.populateIteminGiftBoxProductListV2(gbbSummaryPageBundleProductsContainer, box);
                //gbbSummaryPageBundleProductsMainContainer.append(gbbSummaryPageBundleProductEmptyDiv);
                gbbSummaryPageBundleProductsMainContainer.append(gbbSummaryPageBundleProductsContainer);

                //gbbSummaryPageBundleDetailsHTML.append(gbbSummaryPageBundleImageTitleContainer);
                gbbSummaryPageBundleDetailsHTML.append(gbbSummaryPageBundleImageContainer);
                gbbSummaryPageBundleDetailsWithProducts.append(gbbSummaryPageBundleDetailsContainer);
                gbbSummaryPageBundleDetailsWithProducts.append(gbbSummaryPageBundleProductsMainContainer);
                gbbSummaryPageBundleDetailsHTML.append(gbbSummaryPageBundleDetailsWithProducts);

                return gbbSummaryPageBundleDetailsHTML;
            },
            prepareBundleProductsUI: async function (products) {

                let gbbSummaryPageBundleProductsHTML = gbb.$("<div>").addClass("gbbSummaryPageBundleProductsContainer");

                let gbbSummaryPageBundleProductsContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleProductsContainer");
                let gbbSummaryPageBundleProductTitlesContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleProductTitlesContainer");
                let gbbSummaryPageBundleProductQtysPricesContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleProductQtysPricesContainer");

                products?.forEach((product) => {
                    let gbbSummaryPageBundleProductTitle = gbb.$("<div>").addClass("gbbSummaryPageBundleProductTitle");

                    let gbbSummaryPageBundleProductQtyPriceContainer = gbb.$("<div>").addClass("gbbSummaryPageBundleProductQtyPriceContainer");
                    let gbbSummaryPageBundleProductPrice = gbb.$("<div>").addClass("gbbSummaryPageBundleProductPrice");
                    let gbbSummaryPageBundleProductQuantity = gbb.$("<div>").addClass("gbbSummaryPageBundleProductQuantity");
                    gbbSummaryPageBundleProductQtyPriceContainer.append(gbbSummaryPageBundleProductPrice);
                    gbbSummaryPageBundleProductQtyPriceContainer.append(gbbSummaryPageBundleProductQuantity);

                    gbbSummaryPageBundleProductTitlesContainer.append(gbbSummaryPageBundleProductTitle);
                    gbbSummaryPageBundleProductQtysPricesContainer.append(gbbSummaryPageBundleProductQtyPriceContainer);
                })
                gbbSummaryPageBundleProductsContainer.append(gbbSummaryPageBundleProductTitlesContainer);
                gbbSummaryPageBundleProductsContainer.append(gbbSummaryPageBundleProductQtysPricesContainer);

                gbbSummaryPageBundleProductsHTML.append(gbbSummaryPageBundleProductsContainer);
                return gbbSummaryPageBundleProductsHTML;
            },
            prepareDeliveryAndOrderDetailsUI: async function () {
                let gbbSummaryPageDeliveryAndOrderDetailsHTML = gbb.$("<div>").addClass("gbbSummaryPageDeliveryAndOrderDetailsHTML");
                let gbbSummaryPageDeliverDetails = await gbb.gbbReviewPage.f.prepareDeliveryDetailsUI();
                let gbbSummaryPageOrderDetails = await gbb.gbbReviewPage.f.prepareOrderDetailsUI();
                gbbSummaryPageDeliverDetails.append(gbbSummaryPageOrderDetails)

                //gbbSummaryPageDeliveryAndOrderDetailsHTML.append(gbbSummaryPageDeliverDetails);
                gbbSummaryPageDeliveryAndOrderDetailsHTML.append(gbbSummaryPageOrderDetails);
                return gbbSummaryPageDeliveryAndOrderDetailsHTML;
            },
            prepareDeliveryDetailsUI: async function () {
                let gbbScheduleDeliveryWrapper = gbb.$(document).find(gbb.selectors.scheduleDeliveryPickerSelector);
                let gbbScheduleDeliveryHeadingLabel = gbb.$("<div>").addClass("gbbScheduleDeliveryHeadingLabel");
                //gbbScheduleDeliveryHeadingLabel.text(gbb.settings?.languageData?.reviewPage?.deliveryDetails || "Delivery Details");

                if (gbb.settings?.scheduleDelivery?.isScheduleDeliveryEnabled) {
                    //gbbScheduleDeliveryWrapper.append(gbbScheduleDeliveryHeadingLabel);
                    let scheduleDeliveryHTML = await gbb.gbbPersonalizePage.components.scheduleDelivery();
                    gbbScheduleDeliveryWrapper.append(scheduleDeliveryHTML);
                }
                if (gbb.settings?.scheduleDelivery?.isScheduleDeliveryEnabled) {
                    gbb.gbbPersonalizePage.f.useDatePickerLibrary();
                }
                return gbbScheduleDeliveryWrapper;
            },
            prepareOrderDetailsUI: async function () {
                let gbbOrderDetailsHTMl = gbb.$("<div>").addClass("gbbOrderDetailsHTMl");
                let gbbOrderDetailsHeading = gbb.$("<div>").addClass("gbbOrderDetailsHeading");
                gbbOrderDetailsHeading.text(gbb.settings.languageData.reviewPage?.orderDetailsLabel?.value || "Order Details");

                let gbbOrderSubtotalTotalContainer = gbb.$("<div>").addClass("gbbOrderSubtotalTotalContainer");
                gbbOrderSubtotalTotalContainer.append(gbb.gbbReviewPage.f.prepareSubtotalContainerV2());

                let gbbDiscountContainer = gbb.$("<div>").addClass("gbbSummaryPageDiscountAppliedWrapper");
                if (gbb.gbbDiscountComponent.state.isAtleastOneDiscountActive) {
                    gbbDiscountContainer.html(gbb.gbbReviewPage.f.prepareDiscountContainerV2())
                }

                let gbbSummaryPageActionButtons = gbb.$("<div>").addClass("gbbSummaryPageActionButtons");
                // let gbbSummaryPageBackButton = gbb.$("<div>").addClass("gbbSummaryPageBackButton").text(gbb.settings?.languageData?.general?.backButtonText?.value || "Back")
                // gbbSummaryPageBackButton.css("background", gbb.settings.pageCustomizationData.cartFooter.cartFooterBackButtonColor);
                // gbbSummaryPageBackButton.css("color", gbb.settings.pageCustomizationData.cartFooter.cartFooterBackButtonTextColor);

                // gbbSummaryPageBackButton.on("click", function (event) {
                //     gbb.giftboxbuilderPage.action.onPrevNavigationBYOB();
                // })

                let checkoutButtonText = gbb?.settings?.languageData?.general?.checkoutButtonText?.value || "Checkout";

                if (gbb.settings.app.redirectToCartEnabled && !gbb.settings.app.redirectToCheckoutEnabled) {
                    checkoutButtonText = gbb?.settings?.languageData?.general?.addToCartButtonText?.value || "Add to Cart";
                }


                let gbbSummaryPageCheckoutButton = gbb.$("<div>").addClass("gbbSummaryPageCheckoutButton").text(checkoutButtonText);
                gbbSummaryPageCheckoutButton.css("background", gbb.settings.pageCustomizationData.summaryBlock.summaryBlockAddToCartButtonColor)
                gbbSummaryPageCheckoutButton.css("color", gbb.settings.pageCustomizationData.summaryBlock.summaryBlockAddToCartButtonTextColor)

                gbbSummaryPageCheckoutButton.on("click", async function (event) {
                    event.preventDefault();
                    event.stopPropagation();
                    gbbSummaryPageCheckoutButton.addClass("gbbDisabled")
                    gbbSummaryPageCheckoutButton.text(gbb.settings.languageData.general?.loadingCheckoutButtonText?.value || "Loading ...1")
                    if (gbb.gbbPersonalizePage.state.scheduleDeliveryDate) {
                        // await gbb.utility.updateCart({ attributes: { ["gbbScheduleDelivery"]: gbb.gbbPersonalizePage.state.scheduleDeliveryDate } });
                        gbb.gbbBrowser.updateCartAttributes({ "gbbScheduleDelivery": gbb.gbbPersonalizePage.state.scheduleDeliveryDate })
                    }
                    //if gbb.gbbDiscountComponent.state.currentDiscountRule

                    // let cartData = await gbb.utility.getCart();
                    // gbb.state.giftBoxCartData = cartData; //TBD
                    gbb.gbbBrowser.emitCustomEvent({
                        eventName: "gbb-checkout-button-click",
                        attachEventTo: gbbSummaryPageCheckoutButton[0]
                    })
                    await gbb.utility.handleCheckoutClick()
                    // setTimeout(()=>{
                    //     gbbSummaryPageCheckoutButton.removeClass("gbbDisabled");
                    //     gbbSummaryPageCheckoutButton.text(gbb?.settings?.languageData?.general?.checkoutButtonText?.value || "Checkout");
                    // },4000)
                    // await gbb.shopifyUtility.addToCart();

                    //check if discount is enabled
                })
                let gbbSummaryPageCreateNewBoxButton = gbb.$("<div>").addClass("gbbSummaryPageCreateNewBoxButton")
                    .text(gbb.utility.renderLanguageValue(gbb?.settings?.languageData?.reviewPage?.createNewBoxLabel) || "Create a new Box");

                gbbSummaryPageCreateNewBoxButton.css("background", gbb.settings.pageCustomizationData.cartFooter.cartFooterBackButtonColor);
                gbbSummaryPageCreateNewBoxButton.css("color", gbb.settings.pageCustomizationData.cartFooter.cartFooterBackButtonTextColor);

                gbbSummaryPageCreateNewBoxButton.on("click", () => {
                    setTimeout(function () {
                        gbbSummaryPageCreateNewBoxButton.prop('disabled', false);
                        gbbSummaryPageCreateNewBoxButton.removeClass("gbbDisabled");
                    }, 500);
                    let isRedirectAllowed = true;
                    gbb.gbbBrowser.createNewBoxInSessionStorage(isRedirectAllowed);
                    gbb.gbbBrowser.emitCustomEvent({
                        eventName: "gbb-create-new-box-click",
                        attachEventTo: gbbSummaryPageCreateNewBoxButton[0]
                    })
                })
                //gbbSummaryPageActionButtons.append(gbbSummaryPageBackButton)
                gbbSummaryPageActionButtons.append(gbbSummaryPageCheckoutButton);

                if (gbb?.settings?.merchantInfo?.bundleSettings?.allowMultipleBoxesFromSameBundle) {
                    gbbSummaryPageActionButtons.append(gbbSummaryPageCreateNewBoxButton)
                }

                gbbOrderDetailsHTMl.append(gbbOrderDetailsHeading);
                gbbOrderDetailsHTMl.append(gbbOrderSubtotalTotalContainer);
                gbbOrderDetailsHTMl.append(gbbDiscountContainer);
                gbbOrderDetailsHTMl.append(gbbSummaryPageActionButtons);
                if (gbb.utility.checkIfBrandingShouldBeVisible()) {
                    gbbOrderDetailsHTMl.append(gbb.utility.renderPoweredByLabel());
                }
                return gbbOrderDetailsHTMl;
            },
            prepareDiscountContainerV2: function (cartData) {
                let discountContainerArray = []
                const boxQuantity = gbb.state.giftBoxCartData.boxQuantity
                let cartTotal;
                // if(!cartData){
                //      cartTotal = gbb.utility.calculateCartDiscount().cartTotalAmount;
                // }else{
                //     cartTotal = gbb.utility.calculateCartDiscount(cartData).cartTotalAmount;
                // }
                cartTotal = gbb.utility.calculateCartDiscount(cartData).cartTotalAmount + gbb.utility.calculateCartDiscount(cartData).cartBlacklistedItemsTotal;


                cartTotal = gbb.utility.formatPrice(cartTotal);

                let discountOffered = gbb.utility.calculateCartDiscount(cartData).cartDiscount;
                discountOffered = gbb.utility.formatPrice(discountOffered);

                discountOffered = "-" + discountOffered;

                let gbbSummaryPageDiscountAppliedContainer = gbb.$("<div>").addClass("gbbSummaryPageDiscountAppliedContainer")
                let gbbSummaryPageDiscountAppliedLabel = gbb.$("<div>").addClass("gbbSummaryPageDiscountAppliedLabel").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.reviewPage?.discountAppliedLabel) || "Discount")

                let gbbSummaryPageDiscountAppliedValue = gbb.$("<span>").addClass("gbbSummaryPageDiscountAppliedValue")
                gbbSummaryPageDiscountAppliedValue.append(discountOffered)

                gbbSummaryPageDiscountAppliedContainer.append(gbbSummaryPageDiscountAppliedLabel);
                gbbSummaryPageDiscountAppliedContainer.append(gbbSummaryPageDiscountAppliedValue);
                // let gbbSummaryPageDiscountAppliedValue = gbb.$("<span>").addClass("gbbSummaryPageDiscountAppliedValue")
                // gbbSummaryPageDiscountAppliedValue.append("      ").append(gbb.gbbDiscountComponent.state.currentDiscountRule.discountValue)

                let gbbSummaryPageTotalCartValueContainer = gbb.$("<div>").addClass("gbbSummaryPageTotalCartValueContainer")

                let gbbSummaryPageTotalCartValueLabel = gbb.$("<div>").addClass("gbbSummaryPageTotalCartValueLabel").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.reviewPage?.totalLabel) || "Total1")
                let gbbSummaryPageTotalCartValue = gbb.$("<div>").addClass("gbbSummaryPageTotalCartValue")
                gbbSummaryPageTotalCartValue.append(cartTotal)

                gbbSummaryPageTotalCartValueContainer.append(gbbSummaryPageTotalCartValueLabel);
                gbbSummaryPageTotalCartValueContainer.append(gbbSummaryPageTotalCartValue);

                discountContainerArray.push(gbbSummaryPageDiscountAppliedContainer)

                discountContainerArray.push(gbbSummaryPageTotalCartValueContainer)
                return discountContainerArray;
            },
            prepareSubtotalContainerV2: function (allBoxesData) {
                let gbbSummaryPageSubTotalCart = gbb.$("<div>").addClass("gbbSummaryPageSubTotalCart")
                //let gbbSummaryPageSubTotalCart = gbb.$("<div>").addClass("gbbSummaryPageSubTotalCart")
                let gbbSummaryPageSubTotalCartLabel = gbb.$("<div>").addClass("gbbSummaryPageSubTotalCartLabel").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.reviewPage?.subtotalLabel) || "Sub Total1")
                let gbbSummaryPageSubTotalValue = gbb.$("<div>").addClass("gbbSummaryPageSubTotalValue")
                // gbbSummaryPageSubTotalValue.append(gbb.utility.getGiftBoxProductsTotalWithCurrency())

                let _allBoxesData;
                if (allBoxesData) {
                    _allBoxesData = JSON.parse(JSON.stringify(allBoxesData));
                }
                let subtotalValue = gbb.utility.calculateCartDiscount(_allBoxesData).cartSubTotal + gbb.utility.calculateCartDiscount(_allBoxesData).cartBlacklistedItemsTotal;

                subtotalValue = gbb.utility.formatPrice(subtotalValue);

                gbbSummaryPageSubTotalValue.append(subtotalValue)


                gbbSummaryPageSubTotalCart.append(gbbSummaryPageSubTotalCartLabel)
                gbbSummaryPageSubTotalCart.append(gbbSummaryPageSubTotalValue)

                return gbbSummaryPageSubTotalCart;
            },
            // prepareSubtotalContainer: function () {
            //     let gbbSubTotalCartValue = gbb.$("<div>").addClass("gbbReviewPageSubTotalCart")
            //     let gbbSubTotalLabel = gbb.$("<div>").addClass("gbbReviewPageSubTotalCartLabel").text(gbb.utility.renderLanguageValue(gbb.settings?.languageData?.reviewPage?.subtotalLabel) || "Sub Total1")
            //     gbbSubTotalLabel.append("      ").append(gbb.utility.getGiftBoxProductsTotalWithCurrency())
            //     gbbSubTotalCartValue.append(gbbSubTotalLabel)
            //     return gbbSubTotalCartValue;
            // },
            prepareFooter: function () {
                //this is a footer
                const gbbSummaryPageFooterHTML = gbb.$("<div>").addClass("gbbSummaryPageFooter");
                gbbSummaryPageFooterHTML.append("<div> <h1>Footer Gift Box Builder</h1> </div>");
                return gbbSummaryPageFooterHTML;
            },
            reRenderDiscountAndSubTotalV2: function (allBoxesData) {
                let gbbSummaryPageSubTotalCart = gbb.$(".gbbOrderSubtotalTotalContainer")

                gbbSummaryPageSubTotalCart.html(gbb.gbbReviewPage.f.prepareSubtotalContainerV2(allBoxesData))

                let gbbSummaryPageDiscountAppliedWrapper = gbb.$(".gbbSummaryPageDiscountAppliedWrapper")

                if (!gbbSummaryPageDiscountAppliedWrapper.length > 0) {
                    gbbSummaryPageDiscountAppliedWrapper = gbb.$("<div>").addClass("gbbSummaryPageDiscountAppliedWrapper")
                }
                //if theres an active discount rule
                if (gbb.gbbDiscountComponent.state.isAtleastOneDiscountActive) {
                    if (gbbSummaryPageDiscountAppliedWrapper.length > 0) {
                        // gbb.utility.debugConsole("->gbbreviewPage Code here works");

                        gbbSummaryPageDiscountAppliedWrapper.html(gbb.gbbReviewPage.f.prepareDiscountContainerV2(allBoxesData))
                    } else {
                        // gbb.utility.debugConsole("->came in else block");
                        gbb.$(".gbbSummaryPageDiscountAppliedWrapper").html(gbb.gbbReviewPage.f.prepareDiscountContainerV2(allBoxesData))
                    }
                }

                //if there is no active discount rule. remove the discount container
                else {
                    gbbSummaryPageDiscountAppliedWrapper.remove();
                }
            },
            renderChangeQuantity: async function () {
                // this is the increasedecrease comp
                let variantQuantity = 1;
                let gbbBundleQuantityHTMLContainer = gbb.$("<div>").addClass("gbbBundleQuantityHTMLContainer")

                let gbbBundleQuantityHTML = gbb.$("<div>").addClass("gbbBundleQuantityHTML");

                let gbbBundleQuantityHeading = gbb.$("<div>").addClass("gbbBundleQuantityHeading")
                // let gbbProductQuantityAddButton = gbb.$("<button>").addClass("gbbProductQuantityAddButton")
                let gbbBundleQuantityAddButton = gbb.$("<div>").addClass("gbbBundleChangeButton")
                    .css("background", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                    .css("color", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor)
                    .html("+")
                // let gbbProductQuantityRemoveButton = gbb.$("<button>").addClass("gbbProductQuantityRemoveButton")
                let gbbBundleQuantityRemoveButton = gbb.$("<div>").addClass("gbbBundleChangeButton")
                    .css("background", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonBgColor)
                    .css("color", gbb.settings.pageCustomizationData?.quickSettings?.colors?.buttonTextColor)
                    .html("-")
                let gbbBundleQuantityLabel = gbb.$("<div>").addClass("gbbBundleQuantityLabel");
                // gbbProductQuantityAddButton.append(gbb.$("<div>").addClass("gbbProductQuantityAddButtonWrapper").html("+"));
                // gbbProductQuantityRemoveButton.append(gbb.$("<div>").addClass("gbbProductQuantityRemoveButtonWrapper").html("-"));

                gbbBundleQuantityAddButton.on("click", async (event) => {
                    variantQuantity += 1;
                    gbbBundleQuantityLabel.text(variantQuantity);
                })

                gbbBundleQuantityRemoveButton.on("click", async (event) => {
                    if (variantQuantity > 0) {
                        variantQuantity -= 1;
                        gbbBundleQuantityLabel.text(variantQuantity);
                    }
                })

                gbbBundleQuantityLabel.text(variantQuantity);

                gbbBundleQuantityHeading.text(gbb.utility.renderLanguageValue(gbb.settings?.languageData.general.quantity) || "Quantity");

                gbbBundleQuantityHTML.append(gbbBundleQuantityRemoveButton)
                gbbBundleQuantityHTML.append(gbbBundleQuantityLabel);
                gbbBundleQuantityHTML.append(gbbBundleQuantityAddButton);
                gbbBundleQuantityHTMLContainer.append(gbbBundleQuantityHTML);

                return gbbBundleQuantityHTMLContainer;
            },
            insertIntoMainPageWrapper: function () {

                gbb.$(".gbbBodyWrapper").html(gbb.state.ReviewPageBody);
                gbb.$(".gbbBodyWrapper").children().first().hide();
                gbb.$(".gbbBodyWrapper").children().first().fadeIn(700);
                return

            },
            registerEvents: function (settings) {
                gbb.gbbLandingPage.state.buildBoxButtonAction = function () {
                    gbb.utility.debugConsole("build box button clicked");
                    // window.alert("build box button clicked");
                };
            },
            populateTotalInTotalBlock: async function (ele) {
                let total = gbb.utility.getGiftBoxProductsTotalWithCurrency()
                ele.text(total)

            },
            populateIteminGiftBoxProductListV2: function (gbbSummaryPageProductListItems, box) {

                try {
                    // let productData = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage(boxId);
                    let productData = box;
                    if (productData && productData.items && productData.items.length && productData.items.length > 0) {
                        let products = productData.items
                        for (let i = 0; i < products.length; i++) {
                            let product = products[i]
                            let productProperties = product.properties
                            if (productProperties) {

                                let updateProductTitleOfMessage = gbb.gbbReviewPage.f.getProductTitleModifiedIfMessageOrUpload(product) || "";
                                let updateProductTitleOfProductsThatHavePersonalization = gbb.gbbReviewPage.f.getProductTitleModifiedForPersonalizedProducts(product) || "";

                                if (updateProductTitleOfMessage || updateProductTitleOfProductsThatHavePersonalization) {
                                    product.title = product?.product_title || product?.title || product?.public_title || "";
                                    product.title = product.title + updateProductTitleOfMessage + updateProductTitleOfProductsThatHavePersonalization || "";
                                }



                            }
                            let gbbSummaryPageProductListItem = gbb.$("<div>").addClass("gbbSummaryPageProductListItem")
                            let gbbSummaryPageProductTitleQtyPriceContainer = gbb.$("<div>").addClass("gbbSummaryPageProductTitleQtyPriceContainer");

                            let gbbSummaryPageProductTitleWrapper = gbb.$("<div>").addClass("gbbSummaryPageProductTitleWrapper")
                            let gbbSummaryPageProductQtyPriceContainer = gbb.$("<div>").addClass("gbbSummaryPageProductQtyPriceContainer")

                            let gbbSummaryPageProductListItemName = gbb.$("<div>").addClass("gbbSummaryPageProductListItemName").html(product.title)
                            let qtyHtml1 = gbb.$("<span>").css("font-size", "10px").text("x")
                            let qtyHtml2 = gbb.$("<span>").text("x" + product.quantity)
                            let gbbSummaryPageProductListItemQty = gbb.$("<div>").addClass("gbbSummaryPageProductListItemQty")
                            gbbSummaryPageProductListItemQty.append(qtyHtml2)

                            let gbbSummaryPageProductListItemPrice = gbb.$("<div>").addClass("gbbSummaryPageProductListItemPrice")
                            gbbSummaryPageProductListItemPrice.html(gbb.utility.formatPrice(product.price))
                            let gbbSummaryPageProductListItemRemoveBtn = gbb.$("<span>").addClass("gbbSummaryPageProductListItemRemoveBtn").text(`(${gbb.utility.renderLanguageValue(gbb.settings?.languageData.general.removeButtonText)})`)
                                .attr("data-variant_id", product.variant_id)
                                .attr("data-product_id", product.product_id)

                            gbbSummaryPageProductListItemRemoveBtn.on("click", async function (event) {

                                event.preventDefault();
                                event.stopPropagation();

                                //find the parent element gbbSummaryPageProductListItem and remove it
                                let listItemToBeRemoved = gbb.$(this).parents(".gbbSummaryPageProductListItem")
                                listItemToBeRemoved.remove()

                                gbb.$('.gbbSummaryPageProductListItemRemoveBtn').prop('disabled', true);
                                //add a disabled class
                                // gbb.$('.gbbSummaryPageProductListItemRemoveBtn').addClass('gbbDisabled');
                                setTimeout(function () {
                                    gbb.$('.gbbSummaryPageProductListItemRemoveBtn').prop('disabled', false);
                                    //    gbb.$('.gbbSummaryPageProductListItemRemoveBtn').removeClass('gbbDisabled');
                                }, 500);

                                await gbb.utility.updateCartV2({ updates: { [event.target.dataset.variant_id]: 0 }, attributes: { [event.target.dataset.variant_id]: "reviewPage" } })

                                gbb.gbbReviewPage.f.reRenderDiscountAndSubTotalV2()

                                // gbb.gbbReviewPage.init(gbb.settings, "SUMMARY_PAGE")

                            })

                            // let renderChangeQuantity = await gbb.gbbSummaryPage.f.renderChangeQuantity()

                            //add gbbSummaryPageProductListItemRemoveBtn inside gbbSummaryPageProductListItemName
                            // gbbSummaryPageProductListItemName.append("  ").append(gbbSummaryPageProductListItemRemoveBtn)
                            gbbSummaryPageProductTitleWrapper.append(gbbSummaryPageProductListItemName)
                            // gbbSummaryPageProductTitleWrapper.append(gbbSummaryPageProductListItemRemoveBtn)

                            gbbSummaryPageProductQtyPriceContainer.append(gbbSummaryPageProductListItemPrice)
                            gbbSummaryPageProductQtyPriceContainer.append(gbbSummaryPageProductListItemQty)

                            gbbSummaryPageProductTitleQtyPriceContainer.append(gbbSummaryPageProductTitleWrapper);
                            gbbSummaryPageProductTitleQtyPriceContainer.append(gbbSummaryPageProductQtyPriceContainer);
                            gbbSummaryPageProductListItem.append(gbbSummaryPageProductTitleQtyPriceContainer)


                            gbbSummaryPageProductListItems.append(gbbSummaryPageProductListItem)
                        }
                    }
                } catch (error) {
                    gbb.utility.debugConsole("error", error)
                }
            },
            getProductTitleModifiedIfMessageOrUpload: function (product) {
                try {
                    let titleResult = ""
                    if (product.properties) {
                        //find the value of Message
                        let messageKey = Object.keys(product.properties).find(key => key == "Message");
                        let message = product.properties[messageKey];
                        let recipientEmailKey = Object.keys(product.properties).find(key => key == "Recipient Email");
                        let recipientEmail = product.properties[recipientEmailKey];

                        let attachmentFields = gbb.settings.customerUploads && gbb.settings.customerUploads.attachmentFields && gbb.settings.customerUploads.attachmentFields.map(field => field.label);

                        let customerUploads = attachmentFields && Object.keys(product.properties).filter(key => attachmentFields.includes(key));
                        let videoRecordedKey = Object.keys(product.properties).find(key => key == "Video Recorded");
                        let videoRecordedValue = product.properties[videoRecordedKey];

                        if (message) {
                            titleResult = titleResult + " - " + message;
                        }
                        if (recipientEmail) {
                            titleResult = titleResult + " | Email: " + recipientEmail;
                        }
                        if (videoRecordedValue) {
                            titleResult = titleResult + " | Video Recorded: " + videoRecordedValue;
                        }
                        if (customerUploads) {
                            for (let i = 0; i < customerUploads.length; i++) {
                                let customerUpload = customerUploads[i];
                                customerUpload = gbb.utility.removeFirstCharacterIfUnderscore(customerUpload);
                                titleResult = titleResult + " | " + customerUpload;
                            }
                        }
                    }
                    return titleResult;
                } catch (error) {
                    gbb.utility.debugError("error in getProductTitleModifiedIfMessageOrUpload", error);
                }
            },
            getProductTitleModifiedForPersonalizedProducts: function (product) {
                try {
                    // initialize an empty string to hold the final title result
                    let titleResult = "";

                    // use destructuring to access product properties more directly
                    const productProps = product.properties;

                    if (productProps) {
                        // find the key for "productPersonalizationMetaData" from product properties
                        let personalizationKey = Object.keys(productProps).find(key => key === "productPersonalizationMetaData");

                        // if the key exists
                        if (personalizationKey) {
                            // clone product personalization metadata
                            let metaData = JSON.parse(JSON.stringify(productProps[personalizationKey]));

                            // get the keys of the product personalization metadata
                            let metaDataKeys = Object.keys(metaData);

                            // iterate over each key in product personalization metadata
                            metaDataKeys.forEach(key => {
                                // get the associated value or use empty string if undefined
                                let metaValue = metaData[key] || "";

                                // get field label and value from the metadata value
                                let fieldLabel = metaValue.fieldLabel;
                                let fieldValue = metaValue.value;

                                // create the result to be appended to title using field label and value (if value exists)
                                let appendResult = fieldValue ? `${fieldLabel}: ${fieldValue}` : "";

                                // add the result to the title string with a leading " | "
                                titleResult += ` | ${appendResult}`;
                            });
                        }
                    }

                    // return the final title result
                    return titleResult;
                } catch (error) {
                    // if an error occurs, log it as an error in the console
                    gbb.utility.debugError("error in getProductTitleModifiedForPersonalizedProducts", error);
                }
            },
            reRenderUiOnSubscriptionChange: async function () {
                let allBoxesData = await gbb.utility.getCart(); //TBD
                gbb.gbbReviewPage.f.reRenderDiscountAndSubTotalV2(allBoxesData);
                gbb.gbbReviewPage.f.prepareBundleDetailsContainerUI(allBoxesData);
            },
            checkIfSubscriptionPlanExists: function () {
                const checkIfAllItemsHasASellingPlan = gbb.gbbReviewPage.f.checkIfAllItemsHasASellingPlan()
                const getAllSubscriptionPlans = Object.values(gbb.gbbReviewPage.f.getAllSubscriptionPlans()).length > 0;
                return checkIfAllItemsHasASellingPlan && getAllSubscriptionPlans;
            },
            checkIfAllBoxesHaveZeroPrice: function (cartData) { //this function checks if the items added to cart are only free items
                try {
                    let allBoxesZeroPrice = true;
                    for (const boxId in cartData.boxes) {
                        const box = cartData.boxes[boxId];
                        if (box.total_price != 0) {
                            allBoxesZeroPrice = false;
                            break;
                        }
                    }
                    return allBoxesZeroPrice;
                } catch (err) {
                    gbb.utility.debugConsole(err);
                    return false;
                }
            },
            checkIfCurrentBoxPriceIsZero: function (box) { //this function checks if the items added to cart are only free items
                try {
                    if (box && box?.items?.length > 0 && box?.total_price == 0) {
                        return true;
                    }
                    return false;
                } catch (err) {
                    gbb.utility.debugConsole(err);
                    return false;
                }
            },
            customHTMLBlock: function () {
                let customHTMLBlock = gbb.settings?.stepsConfigurationData?.summaryPageData?.customHTMLBlock || "";
                return customHTMLBlock;
            },
        },
        events: function (settings) {
        },
        action: {
        }
    },


    gbbKite: {
        state: {
            isKiteEnabled: false,
        },
        init: function (settings) {
            gbb.gbbKite.initialize();
        },
        initialize: function () {
            try {
                gbb.gbbKite.f.overWriteDiscountMessaging();
                gbb.gbbKite.f.setMapForDiscountProducts();
            } catch (e) {
                gbb.utility.debugConsole("error in gbbKite initialize", e);
            }
            // gbb.utility.debugConsole("gbbKite initialized");
        },
        f: {
            setMapForDiscountProducts: function () {
                try {
                    if (!gbb.settings.gbbKiteData) {
                        return;
                    }

                    let discounts = gbb.settings.gbbKiteData?.discounts || [];
                    // Initialize a map for discount products
                    let discountMap = {};

                    // Loop through each discount object
                    for (let i = 0; i < discounts.length; i++) {
                        const discountObj = discounts[i];

                        // Check if isEBIntegrationEnabled is false
                        if (!discountObj.isEBIntegrationEnabled) {
                            continue;
                        }

                        // Get the first discount value from the rules
                        const discountValue = discountObj.rules[0].disValue;

                        // Get the discount type
                        const discountType = discountObj.disValueType;

                        // Get the products
                        const products = gbb.gbbKite.f.flattenProductsDataInDesiredFormat(discountObj);

                        // Loop through each product
                        for (let j = 0; j < products.length; j++) {
                            const product = products[j];

                            // Store the discount value and type for this product in the map
                            discountMap[product.productId] = { discountValue, discountType };
                        }
                    }
                    // Return the discount map
                    // return discountMap;
                    gbb.gbbKite.state.mapForDiscountProducts = discountMap;
                } catch (e) {
                    gbb.utility.debugConsole("error in setMapForDiscountProducts", e);
                }
            },
            modifyProductDataWithDiscountedPrice: function (productData) {
                try {
                    // Get the product id
                    const productId = productData.id;

                    //isDiscountToBeAppliedOnThisProduct(productData)

                    // Get the discount map
                    const discountMap = gbb.gbbKite.state.mapForDiscountProducts;



                    // Check if the product id exists in the discount map
                    if (discountMap && discountMap[productId]) {
                        // Get the discount value and type
                        const discountValue = discountMap[productId].discountValue;
                        const discountType = discountMap[productId].discountType;

                        // Get the product price

                        productData.compare_at_price = productData.price;
                        productData.price = gbb.gbbKite.f.modifyPriceBasedOnType(productData.price, { discountValue, discountType });


                        for (let i = 0; i < productData.variants.length; i++) {
                            let variant = productData.variants[i];
                            // variant.price = productPrice;
                            variant.compare_at_price = variant.price;
                            // variant.price = productPrice;
                            variant.price = gbb.gbbKite.f.modifyPriceBasedOnType(variant.price, { discountValue, discountType });
                        }



                    }

                    // Return the modified product data
                    return productData;
                } catch (e) {
                    gbb.utility.debugConsole("error in modifyProductDataWithDiscountedPrice", e);

                    // Return the original product data

                    return productData;
                }
            },
            modifyPriceBasedOnType: function (originalPrice, discountSettings) {
                let { discountValue, discountType } = discountSettings;

                // Apply the discount to the price
                if (discountType === 'PERCENTAGE_DIS') {
                    return originalPrice * (1 - (discountValue / 100));
                } else if (discountType === 'FIXED_DIS') {
                    // multiply by 100 to convert to shopify api original way
                    discountValue = discountValue * 100;
                    return Math.max(originalPrice - discountValue, 0);
                } else {
                    // If the discount type is not recognized, return the original price
                    return originalPrice;
                }
            },

            overWriteDiscountMessaging: function() {
                try {
                    if (gbb.settings.discountsData.isKiteDiscountMessagingEnabled) {
                        gbb.settings.discountsData.rules = gbb.settings.discountsData.kiteDiscountMessaging.rules;
                        gbb.settings.discountsData.discountTextBody = gbb.settings.discountsData.kiteDiscountMessaging.discountTextBody;
                        gbb.settings.discountsData.discountTextForSuccess = gbb.settings.discountsData.kiteDiscountMessaging.discountTextForSuccess;
                    }    
                } catch (error) {
                     gbb.utility.debugConsole("error in overWriteDiscountMessaging", error);
                }
            },
            flattenProductsDataInDesiredFormat: function (discountsObj) {
                try {
                    // Initialize an empty array to hold the normalized products data
                    let flattenedData = [];

                    let productsContainerObj = discountsObj.disProducts;

                    let discountType = productsContainerObj.type;



                    // if the type is "ALL_PRODUCTS", all products are discounted
                    // if (discountType === 'ALL_PRODUCTS') {
                    //     return [];
                    // }

                    // if the type is "COLLECTIONS", check if the product's ID is in the selected collections
                    if (discountType === 'COLLECTIONS') {
                        // Flatten array of product objects in each collection into a single array of product IDs
                        let productsListFromAllCollections = productsContainerObj.collectionsData.map(collection => collection.productList).flat();

                        flattenedData = [...new Set(productsListFromAllCollections)]

                        // Filter products data based on collectionProductIds
                        // flattenedData = productsData.filter(product => collectionProductIds.includes(product.productId));
                    }

                    // if the type is "SELECTED_PRODUCTS", check if the product's ID is in the selected products
                    if (discountType === 'SELECTED_PRODUCTS') {
                        // create an array of product IDs
                        // let selectedProductIds = discountsObj.products.map(product => product.productId);

                        flattenedData = productsContainerObj.products
                        // Filter products data based on selectedProductIds
                        // flattenedData = productsData.filter(product => selectedProductIds.includes(product.productId));
                    }

                    // Return flattened data
                    return flattenedData;
                } catch (error) {
                    gbb.utility.debugError('Error occurred while flattening the products data: ', error);
                    return [];
                }
            },




            isDiscountToBeAppliedOnThisProduct: function (productData, discountObj) {
                try {

                    const discountType = discountObj.type;



                    // return false if none of the above conditions are met
                    return false;
                } catch (e) {
                    gbb.utility.debugConsole("error in isDiscountToBeAppliedOnThisProduct", e);
                }
            }
        }
    },

    gbbDiscountComponent: {
        state: {
            currentDiscountRule: {},
            discountCode: "",
            discountCodePrefix: "",
            isAtleastOneDiscountActive: false,
        },
        init: function (settings) {
            gbb.gbbDiscountComponent.events(settings)
            gbb.gbbDiscountComponent.render(settings)
        },
        render: function (settings) {
            const discountComponentHTML = gbb.gbbDiscountComponent.f.prepareProgressBar()
            //attach all this to the first component of gbbBodyWrapper
            // gbb.$(".gbbBodyWrapper").first().prepend(discountComponentHTML)
            // gbb.elements.cartPageWrapperV2.append(gbbDiscountComponent)
            // return discountComponentHTML;

            //find the gbbDiscountComponent on the page and insert it
            gbb.$(".gbbDiscountComponent").html(discountComponentHTML)
        },
        events: function (settings) {
        },
        f: {
            prepareProgressBar: function (settings) {
                settings = gbb.settings;

                let discountRules = settings.discountsData.rules;
                let isDiscountProgressBarEnabled = settings.discountsData.isDiscountProgressBarEnabled;

                if (isDiscountProgressBarEnabled == false) {
                    return;
                }

                let gbbDiscountComponent = gbb.$("<div>").addClass("gbbDiscountComponent")
                let gbbDiscountComponentTitle = gbb.$("<div>").addClass("gbbDiscountComponentTitle")

                // if(discountD)
                //sort rules by their rule amount in ascending order
                // discountRules = discountRules.sort(function (a, b) {
                //     return a.value - b.value
                // })

                let gbbDiscountComponentProgressBarContainer = gbb.$("<div>").addClass("gbbDiscountComponentProgressBarContainer")

                let gbbDiscountComponentProgressBar = gbb.$("<div>").addClass("gbbDiscountComponentProgressBar")

                let gbbDiscountComponentProgressBarRuleWrapper = gbb.$("<div>").addClass("gbbDiscountComponentProgressBarRuleWrapper")
                let gbbDiscountComponentProgressBarRule = gbb.$("<div>").addClass("gbbDiscountComponentProgressBarRule")
                let gbbDiscountComponentProgressBarRuleText = gbb.$("<span>").addClass("gbbDiscountComponentProgressBarRuleText")


                let maxDiscountValue = discountRules[discountRules.length - 1].amount;
                for (let i = 0; i < discountRules.length; i++) {
                    let rule = discountRules[i]
                    let ruleItemWrapper = gbbDiscountComponentProgressBarRule.clone()
                    let ruleItemText = gbbDiscountComponentProgressBarRuleText.clone()

                    let ruleOffer = gbb.utility.renderLanguageValue(eval(`gbb.settings.languageData.discountRules.rule${i + 1}.text`))
                    let ruleAmount = gbb.utility.renderLanguageValue(eval(`gbb.settings.languageData.discountRules.rule${i + 1}.amount`))
                    ruleItemText.text(ruleOffer + " " + ruleAmount)

                    // let starSvg = gbb.$("<svg>").addClass("gbbDiscountComponentProgressBarRuleStar").attr("src", CONSTANT_SVG_STAR)

                    // let starSvg = gbb.$("<div>").addClass("gbbStarSvgContainer").append(CONSTANT_SVG_STAR)
                    let starSvg = gbb.$("<div>").addClass("gbbStarSvgContainer").append(CONSTANT_SVG_CIRCLE)

                    //add data attribut to this starSvg of discount amount
                    starSvg.attr("data-discount-amount", rule.amount)
                    //.gbbStarSvgContainer polygon.svgStar
                    //the max discount gets the left: 100% and the rest get the left: with a calculated percentage
                    if (rule.amount == maxDiscountValue) {
                        ruleItemText.css("left", "95%")
                        starSvg.css("left", "97%")
                    } else {
                        starSvg.css("left", `${((rule.amount / maxDiscountValue) * 100) - parseInt(2)}%`)
                        ruleItemText.css("left", `${((rule.amount / maxDiscountValue) * 100) - parseInt(5)}%`)
                    }

                    //attach the rule to the progress bar
                    ruleItemWrapper.append(starSvg)
                    ruleItemWrapper.append(ruleItemText)
                    gbbDiscountComponentProgressBarRuleWrapper.append(ruleItemWrapper)

                }
                gbbDiscountComponentProgressBarContainer.append(gbbDiscountComponentProgressBar)
                gbbDiscountComponentProgressBarContainer.append(gbbDiscountComponentProgressBarRuleWrapper)

                gbbDiscountComponent.append(gbbDiscountComponentProgressBarContainer)

                return gbbDiscountComponent;
            },
            updateCurrentDiscountRule: async function () {
                try {

                    if (gbb.settings.discountsData.rules == undefined || gbb.settings.discountsData.isDiscountEnabled == false) {
                        return;
                    }
                    let currentDiscountMode = gbb.settings.discountsData.discountMode;

                    if (gbb.settings.discountsData.isKiteDiscountMessagingEnabled){
                        currentDiscountMode = gbb.settings.discountsData.kiteDiscountMessaging.discountMode
                    }

                    let currentDiscountRuleKeys = [];
                    //get all keys from gbb.gbbDiscountComponent.state.currentDiscountRule = {}
                    if (gbb.gbbDiscountComponent.state.currentDiscountRule) {
                        currentDiscountRuleKeys = Object.keys(gbb.gbbDiscountComponent.state.currentDiscountRule)
                    } else {
                        gbb.gbbDiscountComponent.state.currentDiscountRule = {}
                    }



                    let cartDataFromSessionStorage = gbb.gbbBrowser.getCartDataFromSessionStorage();

                    if (!cartDataFromSessionStorage) {
                        return;
                    }
                    //for loop for each box.  discountEligibleCartData(b)

                    let allBoxes = cartDataFromSessionStorage.boxes

                    let allBoxKeys = Object.keys(allBoxes)

                    for (let i = 0; i < currentDiscountRuleKeys.length; i++) {
                        let boxKey = currentDiscountRuleKeys[i];
                        if (allBoxKeys.includes(boxKey) == false) {
                            delete gbb.gbbDiscountComponent.state.currentDiscountRule[boxKey];
                        }
                    }


                    Object.keys(allBoxes).forEach(function (boxKey) {


                        let box = allBoxes[boxKey];

                        let cartData = gbb.gbbDiscountComponent.f.discountEligibleCartData(box);
                        const cartQuantity = cartData.item_count;

                        // let currentCartValue = gbb.state.giftBoxCartData.total_price / 100
                        let currentCartValue = cartData.total_price / 100;

                        let activeCurrencyRate = gbb.utility.getActiveCurrencyRate();

                        let totalCartValue = currentCartValue / activeCurrencyRate;

                        let applicableRule;
                        let applicableDiscountValue = 0;

                        const rulesArr = JSON.parse(JSON.stringify(gbb.settings.discountsData.rules));
                        // const rulesArr = (gbb.settings.discountsData.rules)
                        if (currentDiscountMode != "FIXED_BUNDLE_PRICE") {
                            for (let i = 0; i < rulesArr.length; i++) {
                                if (rulesArr[i].type == "quantity") {
                                    if (cartQuantity >= rulesArr[i].value) {
                                        let curDiscountValue;
                                        if (currentDiscountMode == "PERCENTAGE") {
                                            curDiscountValue = rulesArr[i].discountValue * (totalCartValue / 100);
                                        } else {
                                            curDiscountValue = rulesArr[i].discountValue;
                                        }
                                        // if (!applicableRule || applicableDiscountValue < curDiscountValue) {
                                        applicableRule = rulesArr[i];
                                        applicableDiscountValue = curDiscountValue;
                                        // }
                                    }
                                } else if (rulesArr[i].type == "amount") {
                                    if (totalCartValue >= rulesArr[i].value) {
                                        let curDiscountValue;
                                        if (currentDiscountMode == "PERCENTAGE") {
                                            curDiscountValue = rulesArr[i].discountValue * (totalCartValue / 100);
                                        } else {
                                            curDiscountValue = rulesArr[i].discountValue;
                                        }
                                        // if (!applicableRule || applicableDiscountValue < curDiscountValue) {
                                        applicableRule = rulesArr[i];
                                        applicableDiscountValue = curDiscountValue;
                                        // }
                                    }
                                }
                            }
                            if (!applicableRule) {
                                applicableRule = null;
                            }
                        } else if (currentDiscountMode == "FIXED_BUNDLE_PRICE") {
                            for (let i = 0; i < rulesArr.length; i++) {
                                //store discount only if cartQuantity is equal to the rule value
                                if (cartQuantity == rulesArr[i].value && totalCartValue >= rulesArr[i].discountValue) {
                                    applicableRule = rulesArr[i];
                                    applicableDiscountValue = rulesArr[i].discountValue;
                                }
                            }
                            if (!applicableRule) {
                                applicableRule = null;
                            }
                        }

                        const cartValue = totalCartValue;

                        //   gbb.utility.debugConsole("cartValue= ", cartValue);

                        //get the last rule from the eligible rules
                        //   gbb.utility.debugConsole("applicable rule: ", applicableRule);
                        if (!applicableRule) {
                            gbb.gbbDiscountComponent.state.currentDiscountRule[box.boxId] = null;
                        } else {
                            gbb.gbbDiscountComponent.state.currentDiscountRule[box.boxId] = applicableRule;
                        }
                    });


                    //check all the objects in the currentDiscountRule object and see if they are all null
                    let isDiscountsExist = false;
                    //use a for loop to check if any of the values are not null
                    for (let key in gbb.gbbDiscountComponent.state.currentDiscountRule) {
                        if (gbb.gbbDiscountComponent.state.currentDiscountRule[key] != null) {
                            gbb.gbbDiscountComponent.state.discountCodePrefix = gbb.gbbDiscountComponent.state.currentDiscountRule[key].discountCodePrefix;
                            isDiscountsExist = true;
                            break;
                        }
                    }

                    gbb.gbbDiscountComponent.state.isAtleastOneDiscountActive = isDiscountsExist;

                } catch (e) {
                    gbb.utility.debugError("error in updateCurrentDiscountRule: ", e)
                    gbb.utility.triggerSlackNotification(e)
                }
            },
            discountEligibleCartData: function (cartData) {
                try {

                    // let gbbPagesWhereDiscountIsDisabled = ["addProductsPage2"];
                    // let gbbPagesWhereDiscountIsDisabled = [];
                    //get the current cart items
                    // let cartData = {...gbb.state.giftBoxCartData};
                    // let cartData = gbb.gbbBrowser.getCartDataFromSessionStorage()
                    // let items = gbb.gbbBrowser.getProductsFromAllBoxesFromCart()

                    // cartData.items = items

                    // cartData  = gbb.utility.multiplyByBundleQuantity(cartData)


                    //blacklist a bunch of products which should be filtered out when calculating the discount

                    const messageProductId = gbb.settings?.giftMessage?.messageProduct?.product?.id || null;

                    // const greetingcardProductId = gbb?.settings?.greetingCard?.greetingCardProducts.length ? gbb?.settings?.greetingCard?.greetingCardProducts[0]?.productId : null;

                    // if the length is more than 1, then there are multiple greeting cards
                    // MAKE A LIST OF ALL THE GREETING CARDS

                    let productIdstoFilterForGreetingCards = [];
                    if (gbb?.settings?.greetingCard?.greetingCardProducts.length > 0) {
                        for (let i = 0; i < gbb?.settings?.greetingCard?.greetingCardProducts.length; i++) {
                            productIdstoFilterForGreetingCards.push(gbb?.settings?.greetingCard?.greetingCardProducts[i]?.productId)
                        }
                    }



                    let quantityToRemove = 0;
                    let blackListedIds = [];
                    let blackListedItemsTotalPrice = 0;

                    for (let i = 0; i < cartData.items.length; i++) {
                        if (cartData.items[i].price == 0) {
                            blackListedIds.push(cartData.items[i].product_id)
                        }
                        // if (gbbPagesWhereDiscountIsDisabled.includes(cartData.items[i].properties._boxProduct)) {
                        //     blackListedIds.push(cartData.items[i].product_id)
                        // }
                    }

                    // push items with value zero to the blacklist

                    if (messageProductId) {
                        blackListedIds.push(messageProductId);
                    }
                    if (productIdstoFilterForGreetingCards.length > 0) {
                        productIdstoFilterForGreetingCards.forEach(id => {
                            blackListedIds.push(id);
                        })
                        // blackListedIds.push(greetingcardProductId);
                    }

                    let newCartValue = 0;

                    // each blackListedId should be a number
                    blackListedIds = blackListedIds.map(id => parseInt(id))

                    let blackListedBoxProductKeys = ['addonProduct']  
                    let applicableProducts = cartData.items.map((item, index) => {
                        item.product_id = parseInt(item.product_id);
                        let isProductIdBlackListed = blackListedIds.includes(item?.product_id)
                        let isProductHavingBlackListedProperty = blackListedBoxProductKeys.includes(item?.properties?._boxProduct)

                        if(isProductIdBlackListed || isProductHavingBlackListedProperty){
                            if (item.price > 0 && item.quantity > 0) {
                                blackListedItemsTotalPrice = blackListedItemsTotalPrice + (item.price * item.quantity)
                            }
                            quantityToRemove = item.quantity + quantityToRemove;
                            return;
                        }
                        else{
                            //new cartValue
                            newCartValue = newCartValue + (item.price * item.quantity)
                            return item;
                        } 
                    })

                    //filter out the undefined values
                    applicableProducts = applicableProducts.filter(item => item != undefined)

                    cartData.blackListedItemsTotalPrice = blackListedItemsTotalPrice;
                    cartData.items = applicableProducts;
                    cartData.total_price = newCartValue
                    cartData.item_count = cartData.item_count - quantityToRemove
                    // gbb.utility.debugConsole("applicableProducts quantity ", cartData.item_count)
                    return cartData

                } catch (e) {
                    gbb.utility.debugError("error in discountEligibleCartData: ", e)
                    return
                }
            },
            calculateNextApplicableDiscountRuleForFixedBundlePrice: function () {
                try {
                    let result = {
                        nextDiscountRuleForFBP: undefined,
                        isFirstDiscountRule: false,
                        nextDiscountRuleIndexForFBP: null
                    }
                    // let allDiscountsData = {...gbb?.settings?.discountsData} || {};
                    let allDiscountsData = JSON.parse(JSON.stringify(gbb?.settings?.discountsData)) || {};

                    // let discountRules = [...gbb?.settings?.discountsData?.rules] || [];
                    let discountRules = JSON.parse(JSON.stringify(gbb?.settings?.discountsData?.rules)) || [];

                    // allDiscountsData?.rules now here go through the rules and convert the discountValue to currency of the customer
                    // allDiscountsData.rules = allDiscountsData.rules.map((rule) => {
                    //     rule.value = gbb.utility.convertFromStoreCurrencyToCustomer(rule.value);
                    //     return rule;
                    // })

                    let boxItemsCount = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
                    boxItemsCount = boxItemsCount.item_count || 0;
                    let noOfRulesCleared = 0
                    if (boxItemsCount == 0) {
                        result.nextDiscountRuleForFBP = undefined;
                    } else {
                        for (let i = 0; i < discountRules.length; i++) {
                            let currentDiscountRuleValue = parseInt(discountRules[i].value)
                            if (boxItemsCount >= currentDiscountRuleValue) {
                                noOfRulesCleared += 1
                            }
                            if (currentDiscountRuleValue > boxItemsCount) {
                                result.nextDiscountRuleForFBP = discountRules[i];
                                if (i == 0) {
                                    result.isFirstDiscountRule = true;
                                } else {
                                    result.isFirstDiscountRule = false;
                                }
                                break;
                            }
                        }
                    }
                    if (result.isFirstDiscountRule || !result.nextDiscountRuleForFBP) {
                        result.nextDiscountRuleForFBP = allDiscountsData?.rules[0];
                        result.nextDiscountRuleIndexForFBP = 1
                    } else {
                        for (let i = 0; i < allDiscountsData?.rules?.length; i++) {
                            let currRule = allDiscountsData?.rules[i];
                            if (result.nextDiscountRuleForFBP && result.nextDiscountRuleForFBP.discountValue == currRule.discountValue) {
                                // if(i != allDiscountsData?.rules?.length - 1) {
                                result.nextDiscountRuleForFBP = allDiscountsData?.rules[i] //? allDiscountsData?.rules[i+1] : allDiscountsData?.rules[i];
                                result.nextDiscountRuleIndexForFBP = i; //allDiscountsData?.rules[i+1] ? i+1 : i;
                                // } else {
                                // result.nextDiscountRuleForFBP = undefined;
                                // }
                                break;
                            }
                        }
                        result.nextDiscountRuleIndexForFBP += 1;
                    }
                    if (noOfRulesCleared >= discountRules.length) {
                        result.nextDiscountRuleForFBP = undefined;
                        result.nextDiscountRuleIndexForFBP = discountRules.length;
                        result.isAllRuleSatisfied = true
                    }
                    return result;
                } catch (err) {
                    gbb.utility.debugError(err + "inside calculateCurrentDiscountRuleForFixedBundlePrice");
                }
            },
            calculateDiscountProgressBarValue: function () {
                try {
                    let { item_count: totalQuantity, total_price: totalCartValue } = gbb.state.giftBoxCartData
                    let { rules: discountRules } = JSON.parse(JSON.stringify(gbb.settings.discountsData))
                    totalCartValue = totalCartValue / 100
                    let discountRulesType = discountRules[0].type
                    let calculateDiscountOnValue = discountRulesType == 'amount' ? totalCartValue : totalQuantity
                    if (discountRulesType == 'amount') {
                        discountRules = discountRules.map((rule) => {
                            rule.value = gbb.utility.convertFromStoreCurrencyToCustomer(rule.value)
                            return rule
                        })
                    }
                    let highestDiscountValue = 0
                    discountRules.forEach((rule) => highestDiscountValue = Math.max(highestDiscountValue, parseInt(rule.value)))
                    let progressPercentage = (calculateDiscountOnValue / highestDiscountValue) * 100
                    return progressPercentage
                } catch (error) {
                    gbb.utility.debugError("error in calculateDiscountProgressBarValue", error);
                }
            },
            OldcalculateDiscountProgressBarValue: function () {
                // this function can return value when you have mixed discount type for eg: mix type of discount amount and quantity
                try {
                    let { item_count: totalQuantity, total_price: totalCartValue } = gbb.state.giftBoxCartData
                    let { rules: discountRules } = gbb.settings.discountsData
                    totalCartValue = totalCartValue / 100
                    let lastClearedRuleNo = 0


                    discountRules.forEach((rule, idx) => {
                        let searchDb = rule.type == 'amount' ? totalCartValue : totalQuantity
                        if (searchDb >= Number(rule.value)) {
                            lastClearedRuleNo = idx + 1
                            // LastClearedRuleNo is nothing but the index of the last discount rule that was cleared -> this will help us to calculate the distance between the last cleared rule and the next rule
                        }
                    });

                    let nextRule = discountRules[lastClearedRuleNo]// ? discountRules[lastClearedRuleNo + 1] : undefined
                    let nextRuleProgress = 0

                    if (nextRule) {
                        let nextRuleValue = Number(nextRule.value)
                        let valeOfEachShare = 100 / discountRules.length // valueOfEachShare is the percentage of the progress bar that each rule will take -> for Eg : 5 rules then each rule will take 20% -> 100/5 = 20
                        let searchDb = nextRule.type == 'amount' ? totalCartValue : totalQuantity
                        nextRuleProgress = (searchDb / nextRuleValue) * valeOfEachShare // using this formulate we calculate the progress of the next rule
                    }

                    let progressPercentage = (lastClearedRuleNo * 100) / discountRules.length;
                    // first calculate the progress of the last cleared rule and then add the progress of the next rule for Eg: lastClearedRuleNo 3 and we have 4 discount rules -> 300/4 = 75% -> now we add the progress of the next rule to this 75% -> 75% + 10% = 85%
                    progressPercentage += nextRuleProgress
                    return progressPercentage
                } catch (error) {
                    gbb.utility.debugError("error in calculateDiscountProgressBarValue", error);
                }
            },
            isEveryDiscountRulehaveSameType: function () {
                try {
                    let discountRulesArray = gbb.settings.discountsData.rules || []
                    if (discountRulesArray.length == 0) return false
                    for (let i = 0; i < discountRulesArray.length; i++) {
                        if (discountRulesArray[i].type != discountRulesArray[0].type) {
                            return false
                        }
                    }
                    return true
                } catch (error) {
                    gbb.utility.debugError("error in isEveryDiscountRulehaveSameType", error);
                }
            },
            discountStatusFooterHTML: function () {
                try {
                    let gbbDiscountFooterHTML = gbb.$("<div>").addClass('gbbDiscountFooterHTML');
                    let gbbDiscountMessage = gbb.$("<div>").addClass('gbbDiscountMessage');
                    let renderAddonsMessaging = gbb.gbbAddonProducts.f.checkIfAddonsMessagingNeeded()
                    if (renderAddonsMessaging) {
                        let messageToDisplay = gbb.gbbAddonProducts.f.getAddonsMessageToRender()
                        gbbDiscountMessage.html(messageToDisplay)
                        gbbDiscountFooterHTML.append(gbbDiscountMessage)
                    } else {
                        let currentDiscountRuleObj = JSON.parse(JSON.stringify(gbb.gbbDiscountComponent.state.currentDiscountRule[gbb.state.activeBoxId]));
                        // let allDiscountsData = {...gbb?.settings?.discountsData} || {};
                        let allDiscountsData = JSON.parse(JSON.stringify(gbb?.settings?.discountsData)) || {};
                        let nextDiscountRule;
                        let nextDiscountRuleIndex;
                        let discountMessageToBeShown = "";
                        let isAllRuleSatisfied = false // this variable will keep track if user has cleared all the discount rules or not / based on this we will show the discount success message 

                        let currentDiscountMode = gbb.settings.discountsData.discountMode;


                        if (gbb.settings.discountsData.isKiteDiscountMessagingEnabled) {
                            currentDiscountMode = gbb.settings.discountsData.kiteDiscountMessaging.discountMode
                        }

                        //the goal is to find next applicable discoune
                        //for FBP we need to get the currentDiscountRule that can be applied
                        if (currentDiscountMode == "FIXED_BUNDLE_PRICE") {
                            let result = gbb.gbbDiscountComponent.f.calculateNextApplicableDiscountRuleForFixedBundlePrice();
                            nextDiscountRule = result.nextDiscountRuleForFBP;
                            nextDiscountRuleIndex = result.nextDiscountRuleIndexForFBP;
                            if (result.isAllRuleSatisfied) {
                                isAllRuleSatisfied = true
                            }
                        } else {
                            //the purpose of nextDiscountRuleIndex is to use this to show the respective message on ui

                            if (!currentDiscountRuleObj) {
                                nextDiscountRule = allDiscountsData?.rules[0];
                                nextDiscountRuleIndex = 1
                            } else {
                                //if it's not the first rule then we iterate through all the rules and check for the next applicable discount rule
                                for (let i = 0; i < allDiscountsData?.rules?.length; i++) {
                                    let currRule = allDiscountsData?.rules[i];
                                    //if currentDiscountRuleObj discount value that is applied is equal to the currRule (rule that is currently)
                                    //being iterated then we need to get the rule right after that -> i+1
                                    if (currentDiscountRuleObj && currentDiscountRuleObj.discountValue == currRule.discountValue && i + 1 <= allDiscountsData?.rules?.length) {
                                        //if the currentDiscountRuleObj is the maximum discount rule that's there
                                        //then we don't do anything, otherwise:
                                        if (i != allDiscountsData?.rules?.length - 1) {
                                            nextDiscountRule = allDiscountsData?.rules[i + 1] //? allDiscountsData?.rules[i+1] : allDiscountsData?.rules[i];
                                            nextDiscountRuleIndex = i + 1; //allDiscountsData?.rules[i+1] ? i+1 : i;
                                            break;
                                        } else {
                                            isAllRuleSatisfied = true
                                            nextDiscountRule = undefined;
                                        }
                                        break;
                                    }
                                }
                                nextDiscountRuleIndex = nextDiscountRuleIndex + 1;
                            }
                        }

                        if (nextDiscountRule?.discountValue && currentDiscountMode == "FIXED_BUNDLE_PRICE") {
                            discountMessageToBeShown = gbb.settings.discountsData.discountTextBody.fixedBundlePrice;
                            nextDiscountRule.discountValue = gbb.utility.convertFromStoreCurrencyToCustomer(nextDiscountRule.discountValue);
                            //round off to the ceiling
                            // nextDiscountRule.discountValue = Math.ceil(nextDiscountRule.discountValue);
                        } else {
                            if (nextDiscountRule && nextDiscountRule?.type == "amount") {
                                nextDiscountRule.value = gbb.utility.convertFromStoreCurrencyToCustomer(nextDiscountRule?.value);
                                // nextDiscountRule.value = Math.ceil(nextDiscountRule.value);
                            }

                            if (nextDiscountRule && currentDiscountMode == "FIXED") {
                                nextDiscountRule.discountValue = gbb.utility.convertFromStoreCurrencyToCustomer(nextDiscountRule?.discountValue);
                                // nextDiscountRule.discountValue = Math.ceil(nextDiscountRule.discountValue);
                            }
                            discountMessageToBeShown = gbb.settings.discountsData.discountTextBody.percentageAndFixed;
                        }
                        discountMessageToBeShown = nextDiscountRuleIndex ? discountMessageToBeShown["rule" + nextDiscountRuleIndex]["text"] : '';

                        let message = ''
                        if (nextDiscountRule && discountMessageToBeShown) {
                            message = gbb.gbbDiscountComponent.f.replaceDiscountVariables(discountMessageToBeShown, nextDiscountRule);
                        }
                        // gbbDiscountMessage.text(message);
                        // whenever user exhausts all the discount rules -> we store undefined in the nextDiscountRule variable till now so to show the success message we need to check if the nextDiscountRule is undefined and all the rules are satisfied
                        if (!nextDiscountRule && isAllRuleSatisfied) {
                            message = gbb.settings.discountsData?.discountTextForSuccess?.value;
                        }
                        let doesThisContainNextLineKeyword = true
                        if (message && (doesThisContainNextLineKeyword)) {
                            gbbDiscountMessage.html(message);
                        } else {
                            gbbDiscountMessage.text(message);
                        }

                        gbbDiscountMessage.css("color", gbb.settings?.pageCustomizationData?.cartFooter?.cartFooterDiscountTextColor || "black")


                        let gbbDiscountMessageContainer = gbb.$('<div>').addClass('gbbDiscountMessageContainer')

                        gbbDiscountMessageContainer.append(gbbDiscountMessage)
                        gbbDiscountFooterHTML.append(gbbDiscountMessageContainer)
                        let isEveryDiscountRulehaveSameType = gbb.gbbDiscountComponent.f.isEveryDiscountRulehaveSameType();
                        if (gbb.settings?.discountsData?.isDiscountProgressBarEnabled && isEveryDiscountRulehaveSameType) {
                            let filledPercentage = gbb.gbbDiscountComponent.f.calculateDiscountProgressBarValue();// get the filled percentage value for the progress bar
                            let progressBarConfigOptions = {
                                filledColor: gbb.settings.pageCustomizationData?.cartFooter?.cartFooterDiscountProgressBarFilledColor || '#4caf50',
                                emptyColor: gbb.settings.pageCustomizationData?.cartFooter?.cartFooterDiscountProgressBarEmptyColor || '#C1E7C5',
                                filledPercentage: filledPercentage || 0
                            }
                            let progressBarHTML = gbb.gbbAddProductsPage.f.renderProgressBarHTML(progressBarConfigOptions)
                            gbbDiscountFooterHTML.append(progressBarHTML)
                        }

                    }
                    return gbbDiscountFooterHTML;
                } catch (err) {
                    gbb.utility.debugError(err + "inside discountStatusFooterHTML");
                }
            },
            replaceDiscountVariables: function (message, nextDiscountRule) {
                if (nextDiscountRule) {
                    let boxCartData = gbb.gbbBrowser.getRelevantBoxDataFromSessionStorage();
                    let discountConditionDiff;
                    let discountUnit;
                    let discountValue;
                    let currentCartValue;
                    let discountValueUnit;
                    let currentDiscountMode = gbb.settings.discountsData.discountMode;


                    if (gbb.settings.discountsData.isKiteDiscountMessagingEnabled){
                        currentDiscountMode = gbb.settings.discountsData.kiteDiscountMessaging.discountMode
                    }

                    if (nextDiscountRule.type == "amount") {
                        currentCartValue = parseFloat(boxCartData?.total_price / 100).toFixed(2);
                        currentCartValue = Math.round(currentCartValue);
                        discountUnit = gbb.utility.getCurrencySymbol();
                        // let activeCurrencyRate = gbb.utility.getActiveCurrencyRate();
                        // currentCartValue = currentCartValue / activeCurrencyRate;
                    } else if (nextDiscountRule.type == "quantity") {
                        // currentCartValue = boxCartData.item_count || 0;
                        let cartValue = JSON.parse(JSON.stringify(boxCartData.items));
                        //find cart item only that have more than 0 price
                        cartValue = boxCartData.items.filter(item => item.price > 0);
                        // 
                        // get me cartValue, boxCartData
                        currentCartValue = 0;
                        cartValue.forEach(item => {
                            currentCartValue = currentCartValue + item.quantity;
                        })
                        discountUnit = " product(s)";
                        if (parseInt(currentCartValue) >= parseInt(nextDiscountRule.value)) {
                            return "";
                        }
                    }

                    if (currentDiscountMode == "FIXED_BUNDLE_PRICE") {
                        discountUnit = " product(s)";
                        discountValueUnit = gbb.utility.getCurrencySymbol();
                        // discountValueUnit = gbb.utility.getStoreCurrencySymbol();
                    }

                    let isDiscountFromKiteAndPercentage = false;
                    let isDiscountFromKiteAndFixed = false;

                    if (gbb.settings.discountsData.isKiteIntegrationEnabled) {
                        const discounts = gbb.settings.gbbKiteData?.discounts;
                        if (discounts && discounts.length > 0) {
                            const fixedDiscountsType = ["FIXED_TOTAL", "FIXED_DIS"];
                            const percentageDiscountsType = ["PERCENTAGE_DIS"];
                            if (fixedDiscountsType.includes(discounts[0].disValueType)) {
                                isDiscountFromKiteAndFixed = true;
                            } else if (percentageDiscountsType.includes(discounts[0].disValueType)) {
                                isDiscountFromKiteAndPercentage = true;
                            }
                        }
                    }


                    if (currentDiscountMode == "FIXED" || isDiscountFromKiteAndFixed) {
                        discountValueUnit = gbb.utility.getCurrencySymbol();
                        // discountValueUnit = gbb.utility.getStoreCurrencySymbol();
                    } else if (currentDiscountMode == "PERCENTAGE" || isDiscountFromKiteAndPercentage) {
                        discountValueUnit = "%"
                    }



                    discountConditionDiff = Math.round(nextDiscountRule.value) - Math.round(currentCartValue); //include item that was just added
                    discountValue = nextDiscountRule.discountValue;

                    let variableValues = {
                        discountConditionDiff,
                        discountUnit,
                        discountValue,
                        discountValueUnit
                    }

                    let variables;
                    if (currentDiscountMode == "PERCENTAGE") {
                        variables = ["discountConditionDiff", "discountUnit", "discountValue", "discountValueUnit"]
                    } else {
                        variables = ["discountConditionDiff", "discountUnit", "discountValueUnit", "discountValue"]
                    }

                    for (let i = 0; i < variables.length; i++) {
                        let VariableName = "##" + variables[i] + "##";
                        let value = variableValues[variables[i]];
                        message = message.replace(new RegExp(`${VariableName}`, 'g'), value);
                    }
                } else {
                    message = "";
                }
                return message;
            },

        }
    },
    gbbVideoMsg: {
        init: function (settings, parent, element) {
            gbb.gbbVideoMsg.initialize(settings, parent, element)
        },
        state: {
            elements: {},
            uploadedVideoId: null,
            recordingTimeMS: 60000,
            recordingTime: "1:00",
            recordedBlob: "",
            mediaRecorder: null,
            interval: undefined,
            emailId: null,
            gbbVideoMsgPlayerWrapper: null,
        },
        initialize: function (settings, parent, element) {
            // let productHandle = gbb.f.getProductPageHandle(settings)
            gbb.utility.debugConsole("videoMesageInitialize");
            //todo
            if (true || gbb.settings.videoMessage.isVideoMessageEnabled) {
                gbb.gbbVideoMsg.f.registerEvents()
                gbb.gbbVideoMsg.f.prepareVideoMsgPlayer(element)
                // // let oneClickUpsellProductPageHTML = gbb.gbbOneClickUpsell.f.prepareUI(settings, variantListToBeShownOnProductPage, parent)
                // let giftMessageProductPageHTML = gbb.gbbMessage.f.prepareUI(settings, productHandle, parent)
                // gbb.gbbMessage.f.insertIntoProductPageWrapper(settings, giftMessageProductPageHTML)
                // gbb.utility.overWriteBuyNowBtn()
                // gbb.state.isOverWriteBuyNowBtnTriggered = true
            }

        },
        f: {
            registerEvents: function () {
                gbb.$(document).on("click", ".gbbVideoMsgButton", gbb.gbbVideoMsg.actions.gbbVideoMsgButton)
            },
            prepareVideoMsgPlayer: function (element) {

                let gbbVideoMsgPlayerWrapper = gbb.$("<div>").addClass("gbbVideoMsgPlayerWrapper");

                gbb.gbbVideoMsg.state.gbbVideoMsgPlayerWrapper = gbbVideoMsgPlayerWrapper;
                let gbbRecorder = gbb.$("<div>").addClass("gbbRecorder")
                gbb.utility.debugConsole("prepareVideoMsgPlayer");
                let gbbRecorderCloseBtn = gbb.$("<button>").addClass("gbbRecorderCloseBtn").on("click", function (e) { gbb.gbbVideoMsg.f.clickClose(e) })

                //: change s3 url
                let gbbRecorderCloseBtnImg = gbb.$("<img>").attr("src", "https://db07ji0eqime4.cloudfront.net/public/videoMessage/close-video.svg")
                gbbRecorderCloseBtn.append(gbbRecorderCloseBtnImg)

                //: change s3 url
                let gbbRecord = gbb.$("<div>").addClass("gbbRecord")
                let gbbVideoPlayer = gbb.$("<video>").addClass("gbbVideoPlayer")
                    .attr("autoplay", true)
                    .prop("muted", true)
                    .attr("poster", "https://db07ji0eqime4.cloudfront.net/public/videoMessage/free-video.jpg")
                let gbbPermissionDenied = gbb.$("<div>").addClass("gbbPermissionDenied gbbVideoPlayerHide").text(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.permissionDenied))
                let gbbVideoPlayerStatus = gbb.$("<div>").addClass("gbbVideoPlayerStatus").html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.pressToRecord))

                //let gbbVideoPlayerEmptyPTag = gbb.$("<p>");

                let gbbVideoPlayerStartBtn = gbb.$("<button>").addClass("gbbVideoPlayerStartBtn").on("click", function (e) { gbb.gbbVideoMsg.f.clickStart(e) })
                let gbbVideoPlayerRedDot = gbb.$("<div><p></p></div>").addClass("gbbVideoPlayerRedDot")
                //gbbVideoPlayerRedDot.append(gbbVideoPlayerEmptyPTag);
                gbbVideoPlayerStartBtn.append(gbbVideoPlayerRedDot)

                let gbbVideoPlayerStopBtn = gbb.$("<button>").addClass("gbbVideoPlayerStopBtn").on("click", function (e) { gbb.gbbVideoMsg.f.clickStop(e) })
                let gbbVideoPlayerRedSquare = gbb.$("<div><p></p></div>").addClass("gbbVideoPlayerRedSquare")
                //gbbVideoPlayerRedSquare.append(gbbVideoPlayerEmptyPTag);
                gbbVideoPlayerStopBtn.append(gbbVideoPlayerRedSquare)


                let gbbVideoPlayerTimeLeft = gbb.$("<div>").addClass("gbbVideoPlayerTimeLeft gbbVideoPlayerHide")

                gbbRecord.append(gbbVideoPlayer)
                gbbRecord.append(gbbPermissionDenied)
                gbbRecord.append(gbbVideoPlayerStatus)
                gbbRecord.append(gbbVideoPlayerStartBtn)
                gbbRecord.append(gbbVideoPlayerStopBtn)
                gbbRecord.append(gbbVideoPlayerTimeLeft)


                let gbbRecorded = gbb.$("<div>").addClass("gbbRecorded")

                let gbbVideoPlayerRecording = gbb.$("<video>").addClass("gbbVideoPlayerRecording")
                    .attr("preload", "none")
                    .attr("poster", "https://db07ji0eqime4.cloudfront.net/public/videoMessage/free-video.jpg")

                let gbbLoadingHeading = gbb.$("<div>").addClass("gbbLoadingHeading gbbVideoPlayerHide").html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.loading))
                let gbbUploadingVideoHeading = gbb.$("<div>").addClass("gbbUploadingVideoHeading gbbVideoPlayerHide").html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.uploading))

                let gbbVideoPlayerControls = gbb.$("<div>").addClass("gbbVideoPlayerControls")

                let gbbVideoPlayerControlsAcceptBtnDiv = gbb.$("<div>").addClass("gbbVideoPlayerControlsAcceptBtnDiv");

                let gbbVideoPlayerControlsAcceptBtnDivInfo = gbb.$("<p>").addClass("gbbVideoPlayerControlsBtnDivInfo").html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.startUploadText));

                gbbVideoPlayerControlsAcceptBtnDiv.append(gbbVideoPlayerControlsAcceptBtnDivInfo);

                let gbbVideoPlayerControlsAcceptBtn = gbb.$("<button>").addClass("gbbVideoPlayerControlsAcceptBtn").on("click", function (e) { gbb.gbbVideoMsg.f.clickAccept(e) })

                //CHORE : change s3 url
                let gbbVideoPlayerControlsAcceptBtnImg = gbb.$("<img>").addClass("gbbVideoPlayerControlsAcceptBtnImg")
                    .attr("src", "https://db07ji0eqime4.cloudfront.net/public/videoMessage/confirm-video.png")
                gbbVideoPlayerControlsAcceptBtn.append(gbbVideoPlayerControlsAcceptBtnImg)
                gbbVideoPlayerControlsAcceptBtnDiv.append(gbbVideoPlayerControlsAcceptBtn);



                let gbbVideoPlayerControlsPlayBtnDiv = gbb.$("<div>").addClass("gbbVideoPlayerControlsPlayBtnDiv");

                let gbbVideoPlayerControlsPlayBtnDivInfo = gbb.$("<p>").addClass("gbbVideoPlayerControlsBtnDivInfo").html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.playText));

                gbbVideoPlayerControlsPlayBtnDiv.append(gbbVideoPlayerControlsPlayBtnDivInfo);

                let gbbVideoPlayerControlsPlayBtn = gbb.$("<button>").addClass("gbbVideoPlayerControlsPlayBtn").on("click", function (e) { gbb.gbbVideoMsg.f.clickPlay(e) })
                let gbbVideoPlayerControlsPlayBtnImg = gbb.$("<img>").addClass("gbbVideoPlayerControlsPlayBtnImg")
                    .attr("src", "https://db07ji0eqime4.cloudfront.net/public/videoMessage/play-video.png")
                gbbVideoPlayerControlsPlayBtn.append(gbbVideoPlayerControlsPlayBtnImg)
                gbbVideoPlayerControlsPlayBtnDiv.append(gbbVideoPlayerControlsPlayBtn);


                let gbbVideoPlayerControlsReStartBtnDiv = gbb.$("<div>").addClass("gbbVideoPlayerControlsReStartBtnDiv");

                let gbbVideoPlayerControlsReStartBtnDivInfo = gbb.$("<p>").addClass("gbbVideoPlayerControlsBtnDivInfo").html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.reRecordVideoText));

                gbbVideoPlayerControlsReStartBtnDiv.append(gbbVideoPlayerControlsReStartBtnDivInfo);

                let gbbVideoPlayerControlsReStartBtn = gbb.$("<button>").addClass("gbbVideoPlayerControlsReStartBtn").on("click", function (e) { gbb.gbbVideoMsg.f.clickReStart(e) })
                let gbbVideoPlayerControlsReStartBtnImg = gbb.$("<img>").addClass("gbbVideoPlayerControlsReStartBtnImg")
                    .attr("src", "https://db07ji0eqime4.cloudfront.net/public/videoMessage/redo-video.png")
                gbbVideoPlayerControlsReStartBtn.append(gbbVideoPlayerControlsReStartBtnImg)
                gbbVideoPlayerControlsReStartBtnDiv.append(gbbVideoPlayerControlsReStartBtn);

                gbbVideoPlayerControls.append(gbbVideoPlayerControlsReStartBtnDiv)
                gbbVideoPlayerControls.append(gbbVideoPlayerControlsPlayBtnDiv)
                gbbVideoPlayerControls.append(gbbVideoPlayerControlsAcceptBtnDiv)


                gbbRecorded.append(gbbVideoPlayerRecording)
                gbbRecorded.append(gbbLoadingHeading)
                gbbRecorded.append(gbbUploadingVideoHeading)
                gbbRecorded.append(gbbVideoPlayerControls)


                gbbRecorder.append(gbbRecorderCloseBtn)
                gbbRecorder.append(gbbRecord)
                gbbRecorder.append(gbbRecorded)

                gbbVideoMsgPlayerWrapper.append(gbbRecorder)
                element.after(gbbVideoMsgPlayerWrapper);
                //attach it to the body
                // gbb.$("body").append(gbbVideoMsgPlayerWrapper);
                // .after(gbbVideoMsgPlayerWrapper);

                gbb.gbbVideoMsg.state.elements.gbbRecorder = gbbRecorder
                gbb.gbbVideoMsg.state.elements.gbbRecord = gbbRecord
                gbb.gbbVideoMsg.state.elements.gbbRecorded = gbbRecorded
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayer = gbbVideoPlayer
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStartBtn = gbbVideoPlayerStartBtn
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStopBtn = gbbVideoPlayerStopBtn
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControlsReStartBtn = gbbVideoPlayerControlsReStartBtn
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControlsPlayBtn = gbbVideoPlayerControlsPlayBtn
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerRecording = gbbVideoPlayerRecording
                gbb.gbbVideoMsg.state.elements.gbbRecorderCloseBtn = gbbRecorderCloseBtn
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControlsAcceptBtn = gbbVideoPlayerControlsAcceptBtn
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControls = gbbVideoPlayerControls
                gbb.gbbVideoMsg.state.elements.gbbLoadingHeading = gbbLoadingHeading
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerTimeLeft = gbbVideoPlayerTimeLeft
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStatus = gbbVideoPlayerStatus
                gbb.gbbVideoMsg.state.elements.gbbPermissionDenied = gbbPermissionDenied
                gbb.gbbVideoMsg.state.elements.gbbUploadingVideoHeading = gbbUploadingVideoHeading


            },
            createRecorder: function () {
                gbb.gbbVideoMsg.state.elements.gbbRecorder.removeClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbRecord.removeClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStartBtn.removeClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStatus.removeClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbPermissionDenied.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbRecorded.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStopBtn.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControls.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerTimeLeft.html(gbb.gbbVideoMsg.state.recordingTime);
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStatus.html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.pressToRecord));
                gbb.gbbVideoMsg.state.recordingTime = "1:00";
                gbb.gbbVideoMsg.state.elements.gbbUploadingVideoHeading.html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.uploading));
                navigator.mediaDevices
                    .getUserMedia({
                        audio: true,
                        video: true,
                    })
                    .then((stream) => {
                        gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].srcObject = stream;
                    })
                    .catch((error) => {
                        gbb.utility.debugConsole("navigator", error)
                        gbb.utility.debugConsole(error);
                        gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStartBtn.addClass("gbbVideoPlayerHide");
                        gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStatus.addClass("gbbVideoPlayerHide");
                        gbb.gbbVideoMsg.state.elements.gbbPermissionDenied.removeClass("gbbVideoPlayerHide");
                    });
            },
            clickClose: function (e) {
                e.preventDefault();
                gbb.gbbVideoMsg.state.gbbVideoMsgPlayerWrapper.css('display', 'none')
                // gbb.gbbVideoMsg.state.elements.gbbRecorder.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.f.stopRecording(gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].srcObject);
                gbb.gbbVideoMsg.f.revokeObjectUrl();
            },
            stopRecording: function (stream) {
                if (gbb.gbbVideoMsg.state.interval) {
                    clearInterval(gbb.gbbVideoMsg.state.interval);
                }
                if (gbb.gbbVideoMsg.state.mediaRecorder && gbb.gbbVideoMsg.state.mediaRecorder.state !== "inactive") {
                    gbb.gbbVideoMsg.state.mediaRecorder.stop();
                }
                stream.getTracks().forEach(function (track) {
                    if (track.readyState == "live") {
                        gbb.utility.debugConsole("hello - stop");
                        track.stop();
                    }
                })
            },

            clearTracks: function (stream) {
                if (stream) {
                    stream.getTracks().forEach(function (track) {
                        if (track.readyState == "live") {
                            gbb.utility.debugConsole("hello - stop");
                            track.stop();
                        }
                    })

                }

            },
            revokeObjectUrl: function () {
                URL.revokeObjectURL(gbb.gbbVideoMsg.state.elements.gbbVideoPlayerRecording.src);
            },
            clickStart: function async(e) {
                e.preventDefault();
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStartBtn.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbRecorderCloseBtn.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStopBtn.removeClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerTimeLeft.removeClass("gbbVideoPlayerHide");

                // the below field for the text
                //hide the toggle
                //gbbVideoMsgCheckboxWrapper

                gbb.gbbVideoMsg.f.clearTracks(gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].srcObject);

                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStatus.html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.recording));
                navigator.mediaDevices
                    .getUserMedia({
                        video: true,
                        audio: true,
                    })
                    .then((stream) => {
                        gbb.utility.debugConsole("1 - navigator");
                        gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].srcObject = stream;
                        gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].captureStream = gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].captureStream || gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].mozCaptureStream;
                        return new Promise((resolve) => (
                            gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].onplaying = resolve
                        ));
                    })
                    .then(() => {
                        gbb.utility.debugConsole("2 - onplaying");
                        return gbb.gbbVideoMsg.f.startRecording(e, gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].captureStream())
                    })
                    .then((recordedChunks) => {
                        gbb.utility.debugConsole("3 - startRecording");
                        gbb.utility.debugConsole(recordedChunks);
                        gbb.gbbVideoMsg.state.justNowRecorded = true
                        gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControls.removeClass("gbbVideoPlayerHide");
                        gbb.gbbVideoMsg.state.elements.gbbUploadingVideoHeading.addClass("gbbVideoPlayerHide");
                        gbb.gbbVideoMsg.state.elements.gbbLoadingHeading.addClass("gbbVideoPlayerHide");
                        gbb.gbbVideoMsg.state.recordedBlob = new Blob(recordedChunks, { type: "video/webm" });
                        gbb.gbbVideoMsg.state.elements.gbbVideoPlayerRecording.attr("src", URL.createObjectURL(gbb.gbbVideoMsg.state.recordedBlob));
                        gbb.gbbVideoMsg.state.elements.gbbVideoPlayerRecording[0].load();
                    })
                    .catch(
                        (error) =>
                            gbb.utility.debugConsole(error)
                    );
            },
            startRecording: function (e, stream) {
                return new Promise((resolve, reject) => {

                    let mediaRecorder = new MediaRecorder(stream);
                    gbb.gbbVideoMsg.state.mediaRecorder = mediaRecorder;
                    let parts = [];
                    mediaRecorder.ondataavailable = (event) => {
                        parts.push(event.data);
                    };
                    mediaRecorder.start(1000);

                    mediaRecorder.onerror = (event) => reject(event.name);

                    gbb.gbbVideoMsg.f.wait(mediaRecorder);

                    mediaRecorder.onstop = function () {
                        gbb.utility.debugConsole("mediaRecorder.onstop() func called");
                        resolve(parts);
                    }
                })
            },
            clickStop: function (e) {
                e.preventDefault();
                gbb.gbbVideoMsg.state.elements.gbbRecord.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbRecorded.removeClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControls.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerTimeLeft.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerStatus.addClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbRecorderCloseBtn.removeClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.state.elements.gbbLoadingHeading.removeClass("gbbVideoPlayerHide");
                gbb.gbbVideoMsg.f.stopRecording(gbb.gbbVideoMsg.state.elements.gbbVideoPlayer[0].srcObject);
            },
            covertBlobToBase64: async function (recordedBlob) {
                const reader = new FileReader();
                reader.readAsDataURL(recordedBlob);

                reader.onloadend = function () {

                    var arrayBuffer = reader.result;

                    gbb.utility.debugConsole(arrayBuffer);

                    var formData = new FormData();

                    formData.append("upload_data", recordedBlob, "video.txt");
                    formData.append("shopName", gbb.settings.merchantInfo.shopName);

                    // fetch("http://"+gbb.settings.SERVER_URL+"/api/proxy/upload/video?shopName="+gbb.settings.merchantInfo.shopName,{
                    // fetch("/apps/gbb/upload/video", {
                    fetch("/apps/" + gbb.state.gbbUrl + "/upload/video", {
                        method: 'POST',
                        body: formData
                    }).then(
                        response => response.json() // if the response is a JSON object
                    ).then(
                        success => {
                            if (success.responseCode == 200) {
                                gbb.gbbVideoMsg.state.uploadedVideoId = success.data.videoMsgId;
                                gbb.utility.debugConsole(success) // Handle the success response object
                                gbb.gbbVideoMsg.state.elements.gbbUploadingVideoHeading.html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage?.uploadConfirmation) || "Successfully uploaded1");
                                //gbb.$('.gbbVideoMsgPlayerWrapper').css('display', 'none')
                                // Show feedback that it got uploaded
                                // gbb.gbbVideoMsg.state.elements.gbbRecorder.addClass("gbbVideoPlayerHide");
                            }
                            /*
                            * @Abhishek, the below if else condition is added to handle the
                            * condition where the api fails in sending over responseCode 200.
                            */
                            else {
                                gbb.utility.debugConsole(success) // Handle the error response object
                                gbb.gbbVideoMsg.state.elements.gbbUploadingVideoHeading.html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.errorMessage));
                            }

                        }
                    ).catch(
                        error => {
                            gbb.utility.debugConsole(error) // Handle the error response object
                            gbb.gbbVideoMsg.state.elements.gbbUploadingVideoHeading.html(gbb.utility.renderLanguageValue(gbb.settings.languageData.videoMessage.errorMessage));
                        }
                    );
                }
            },
            clickAccept: function (e) {
                e.preventDefault();
                gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControls.addClass("gbbVideoPlayerHide")
                gbb.gbbVideoMsg.state.elements.gbbUploadingVideoHeading.removeClass("gbbVideoPlayerHide")
                gbb.gbbVideoMsg.f.covertBlobToBase64(gbb.gbbVideoMsg.state.recordedBlob);
            },
            wait: function (mediaRecorder) {
                var now = new Date().getTime();
                var deadline = new Date(now + gbb.gbbVideoMsg.state.recordingTimeMS).getTime();
                var interval = setInterval(() => {
                    now = new Date().getTime();
                    var t = deadline - now;
                    gbb.utility.debugConsole(t);
                    var minutes = Math.floor((t % (1000 * 60 * 60)) / (1000 * 60));
                    var seconds = Math.floor((t % (1000 * 60)) / 1000);
                    if (t < 0) {
                        gbb.$('.gbbVideoPlayerStopBtn').click();
                    }
                    gbb.gbbVideoMsg.state.elements.gbbVideoPlayerTimeLeft.html(minutes + " : " + seconds)
                }, 1000);
                gbb.gbbVideoMsg.state.interval = interval;
            },
            clickReStart: function (e) {
                e.preventDefault();
                gbb.gbbVideoMsg.f.revokeObjectUrl()
                gbb.gbbVideoMsg.f.createRecorder();
            },
            clickPlay: async function (e) {
                e.preventDefault();
                try {
                    gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControls.addClass("gbbVideoPlayerHide");
                    gbb.gbbVideoMsg.state.elements.gbbVideoPlayerRecording[0].play();
                    let isEnded = new Promise((resolve, reject) => {
                        gbb.gbbVideoMsg.state.elements.gbbVideoPlayerRecording[0].onended = resolve;
                    });
                    await isEnded;
                    gbb.gbbVideoMsg.state.elements.gbbVideoPlayerRecording[0].load();
                    gbb.gbbVideoMsg.state.elements.gbbVideoPlayerControls.removeClass("gbbVideoPlayerHide");

                } catch (error) {
                    gbb.utility.debugConsole(error)
                }
            },
            scrollToVideoDiv: function () {
                // gbb.$(".gbbPersonalizePageMessageContent").animate({scrollTop: 9999},1000);
                gbb.$(".giftMessageV2MainContent").animate({ scrollTop: 360 }, 2000, 'swing');
            },
        },
        actions: {
            gbbVideoMsgButton: function (e) {
                e.preventDefault()
                gbb.gbbVideoMsg.state.gbbVideoMsgPlayerWrapper.css('display', 'grid')
                gbb.gbbVideoMsg.f.createRecorder()
                gbb.gbbVideoMsg.f.scrollToVideoDiv()
            },
        },
        events: {

        },

    },
    gbbIntegrations: {
        judgeme: {
            state: {
                public_token: null,
                baseURL: null,
                reviewStarsHTMLbyProductIds: null,
            },
            init: async function (productsData) {
                try {
                    let params = {}
                    gbb.gbbIntegrations.judgeme.state.public_token = gbb?.settings?.app?.integrations?.judgeme?.public_token
                    gbb.gbbIntegrations.judgeme.state.baseURL = `https://cache.judge.me/widgets/shopify/${gbb?.settings?.merchantInfo?.shopName}?publictoken=${gbb?.settings?.app?.integrations?.judgeme?.public_token}`
                    let productIdsToSend = productsData?.map((product) => Number(product.productId) || product.id).join(',')
                    if (productIdsToSend && productIdsToSend.length > 0) {
                        params = {
                            preview_badge_product_ids: productIdsToSend
                        }
                    }
                    await gbb.gbbIntegrations?.judgeme?.initialize(params)
                } catch (error) {
                    gbb.utility.debugError("error in judgeme init", error);
                }
            },
            initialize: async function (options) {
                try {
                    let judgemeData = await gbb.gbbIntegrations?.judgeme?.f?.getJudgeMeData(options)
                    let judgemeStyle = judgemeData?.html_miracle;
                    gbb.gbbIntegrations?.judgeme?.f?.appendJudgeMeStyle(judgemeStyle)
                    gbb.gbbIntegrations.judgeme.state.reviewStarsHTMLbyProductIds = judgemeData?.preview_badges || []
                } catch (error) {
                    gbb.utility.debugError('error in judgeme initialize', error)
                }
            },
            f: {
                getJudgeMeData: function (options = {}) {
                    try {
                        let params = ''
                        for (const key in options) {
                            params += `&${key}=${options[key]}`
                        }
                        let fetchUrl = gbb.gbbIntegrations?.judgeme?.state?.baseURL + params;

                        let judgemeData = new Promise((resolve, reject) => {
                            fetch(fetchUrl)
                                .then((response) => {
                                    return response.json()
                                }).then((response) => {
                                    gbb.utility.debugConsole("judgeme-data:", response);
                                    resolve(response)
                                })
                                .catch((error) => {
                                    reject(error)
                                })
                        })
                        return judgemeData
                    } catch (error) {
                        gbb.utility.debugError("error in getJudgeMeData", error);
                    }
                },
                appendJudgeMeStyle: function (style) {
                    try {
                        gbb.$('html > head').append(style);
                        return style;
                    } catch (error) {
                        gbb.utility.debugError("error in appendJudgeMeStyle", error);
                    }
                },
                getStarsHTMLByProductId: function (productId) {
                    try {
                        let judgemeProductData = gbb.gbbIntegrations?.judgeme?.state?.reviewStarsHTMLbyProductIds || {}
                        let starsHTML = judgemeProductData[productId]
                        return starsHTML
                    } catch (error) {
                        gbb.utility.debugError('error in getStarsHTMLByProductId', error)
                    }
                },
                applyJudgemeStyleAndLanguage : function(){
                    try{
                        const starRatingTexts = document.querySelectorAll(".jdgm-prev-badge__text");
                        const starRatingWrappers = document.querySelectorAll(".jdgm-prev-badge");
                        const starIcons = document.querySelectorAll(".jdgm-prev-badge__stars .jdgm-star");

                        if (jdgmSettings.badge_star_color) {
                        starIcons.forEach((icon) => {
                            icon.style.color = jdgmSettings.badge_star_color;
                        });
                        } else {
                        starIcons.forEach((icon) => {
                            icon.style.color = jdgmSettings.widget_primary_color ?? "#339999";
                        });
                        }

                        if (jdgmSettings.badge_n_reviews_text) {
                        const textFormat = jdgmSettings.badge_n_reviews_text;

                        starRatingWrappers.forEach((wrapper, idx) => {
                            const reviewCount = parseInt(wrapper.dataset.numberOfReviews);
                            const avgRatingFull = wrapper.dataset.averageRating;
                            const avgRatingShort = Math.round(
                            (parseFloat(wrapper.dataset.averageRating) * 10) / 10
                            );

                            if (reviewCount > 0) {
                            const qntyRegex = /([a-z]+)\/([a-z]+)/;
                            let newText = textFormat.replace(/\{\{\s?n\s?\}\}/g, reviewCount);
                            const qntyTexts = qntyRegex.exec(textFormat);

                            if (qntyTexts != null) {
                                if (reviewCount == 1) {
                                newText = newText.replace(qntyRegex, qntyTexts[1]);
                                } else {
                                newText = newText.replace(qntyRegex, qntyTexts[2]);
                                }
                            } else {
                                if (reviewCount == 1) {
                                starRatingTexts[idx].textContent = `${reviewCount} review`;
                                } else {
                                starRatingTexts[idx].textContent = `${reviewCount} reviews`;
                                }
                            }

                            newText = newText.replace(
                                /\{\{\s?average_rating\s\}\}/g,
                                avgRatingFull
                            );
                            newText = newText.replace(
                                /\{\{\s?average_rating_1_decimal\s\}\}/g,
                                avgRatingShort
                            );
                            starRatingTexts[idx].textContent = newText;

                            if (!jdgmSettings.badge_hide_text) {
                                starRatingTexts[idx].style.visibility = "visible";
                            }
                            }
                        });
                        } else {
                        starRatingWrappers.forEach((wrapper, idx) => {
                            const reviewCount = parseInt(wrapper.dataset.numberOfReviews);

                            if (reviewCount > 0) {
                            if (reviewCount == 1) {
                                starRatingTexts[idx].textContent = `${reviewCount} review`;
                            } else {
                                starRatingTexts[idx].textContent = `${reviewCount} reviews`;
                            }
                            }

                            if (!jdgmSettings.badge_hide_text) {
                            starRatingTexts[idx].style.visibility = "visible";
                            }
                        });
                        }
                    } catch(e){
                        gbb.utility.debugConsole("error in applyJudgemeStyleAndLanguage", e)
                    }

                }
            }
        }

    }
    // gbb Code start
}
window.gbb = gbb;
/*
* start the program
*/
gbbUtils.f.loadJquery(function (jqueryRefObj) {
    gbb.$ = jqueryRefObj;

    gbb.$(document).ready(function () {
        gbb.utility.debugConsole("document-ready-gbb", gbb.$);
        gbb.f.initialize(gbb.$);
        gbb.utility.debugConsole("gbb-page-load-event")
        let event = new CustomEvent('gbb-page-load', {});
        document.dispatchEvent(event);
    })
})


// comment at the end of line
</script>
    <style>.flatpickr-calendar {
  background: transparent;
  opacity: 0;
  display: none;
  text-align: center;
  visibility: hidden;
  padding: 0;
  -webkit-animation: none;
  animation: none;
  direction: ltr;
  border: 0;
  font-size: 14px;
  line-height: 24px;
  border-radius: 5px;
  position: absolute;
  width: 307.875px;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  -ms-touch-action: manipulation;
  touch-action: manipulation;
  background: #fff;
  -webkit-box-shadow: 1px 0 0 #e6e6e6, -1px 0 0 #e6e6e6, 0 1px 0 #e6e6e6,
    0 -1px 0 #e6e6e6, 0 3px 13px rgba(0, 0, 0, 0.08);
  box-shadow: 1px 0 0 #e6e6e6, -1px 0 0 #e6e6e6, 0 1px 0 #e6e6e6,
    0 -1px 0 #e6e6e6, 0 3px 13px rgba(0, 0, 0, 0.08);
}
.flatpickr-calendar.open,
.flatpickr-calendar.inline {
  opacity: 1;
  max-height: 640px;
  visibility: visible;
}
.flatpickr-calendar.open {
  display: inline-block;
  z-index: 99999;
}
.flatpickr-calendar.animate.open {
  -webkit-animation: fpFadeInDown 300ms cubic-bezier(0.23, 1, 0.32, 1);
  animation: fpFadeInDown 300ms cubic-bezier(0.23, 1, 0.32, 1);
}
.flatpickr-calendar.inline {
  display: block;
  position: relative;
  top: 2px;
}
.flatpickr-calendar.static {
  position: absolute;
  top: calc(100% + 2px);
}
.flatpickr-calendar.static.open {
  z-index: 999;
  display: block;
}
.flatpickr-calendar.multiMonth
  .flatpickr-days
  .dayContainer:nth-child(n + 1)
  .flatpickr-day.inRange:nth-child(7n + 7) {
  -webkit-box-shadow: none !important;
  box-shadow: none !important;
}
.flatpickr-calendar.multiMonth
  .flatpickr-days
  .dayContainer:nth-child(n + 2)
  .flatpickr-day.inRange:nth-child(7n + 1) {
  -webkit-box-shadow: -2px 0 0 #e6e6e6, 5px 0 0 #e6e6e6;
  box-shadow: -2px 0 0 #e6e6e6, 5px 0 0 #e6e6e6;
}
.flatpickr-calendar .hasWeeks .dayContainer,
.flatpickr-calendar .hasTime .dayContainer {
  border-bottom: 0;
  border-bottom-right-radius: 0;
  border-bottom-left-radius: 0;
}
.flatpickr-calendar .hasWeeks .dayContainer {
  border-left: 0;
}
.flatpickr-calendar.hasTime .flatpickr-time {
  height: 40px;
  border-top: 1px solid #e6e6e6;
}
.flatpickr-calendar.noCalendar.hasTime .flatpickr-time {
  height: auto;
}
.flatpickr-calendar:before,
.flatpickr-calendar:after {
  position: absolute;
  display: block;
  pointer-events: none;
  border: solid transparent;
  content: "";
  height: 0;
  width: 0;
  left: 22px;
}
.flatpickr-calendar.rightMost:before,
.flatpickr-calendar.arrowRight:before,
.flatpickr-calendar.rightMost:after,
.flatpickr-calendar.arrowRight:after {
  left: auto;
  right: 22px;
}
.flatpickr-calendar.arrowCenter:before,
.flatpickr-calendar.arrowCenter:after {
  left: 50%;
  right: 50%;
}
.flatpickr-calendar:before {
  border-width: 5px;
  margin: 0 -5px;
}
.flatpickr-calendar:after {
  border-width: 4px;
  margin: 0 -4px;
}
.flatpickr-calendar.arrowTop:before,
.flatpickr-calendar.arrowTop:after {
  bottom: 100%;
}
.flatpickr-calendar.arrowTop:before {
  border-bottom-color: #e6e6e6;
}
.flatpickr-calendar.arrowTop:after {
  border-bottom-color: #fff;
}
.flatpickr-calendar.arrowBottom:before,
.flatpickr-calendar.arrowBottom:after {
  top: 100%;
}
.flatpickr-calendar.arrowBottom:before {
  border-top-color: #e6e6e6;
}
.flatpickr-calendar.arrowBottom:after {
  border-top-color: #fff;
}
.flatpickr-calendar:focus {
  outline: 0;
}
.flatpickr-wrapper {
  position: relative;
  display: inline-block;
}
.flatpickr-months {
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
}
.flatpickr-months .flatpickr-month {
  background: transparent;
  color: rgba(0, 0, 0, 0.9);
  fill: rgba(0, 0, 0, 0.9);
  height: 34px;
  line-height: 1;
  text-align: center;
  position: relative;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  overflow: hidden;
  -webkit-box-flex: 1;
  -webkit-flex: 1;
  -ms-flex: 1;
  flex: 1;
}
.flatpickr-months .flatpickr-prev-month,
.flatpickr-months .flatpickr-next-month {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  text-decoration: none;
  cursor: pointer;
  position: absolute;
  top: 0;
  height: 34px;
  padding: 10px;
  z-index: 3;
  color: rgba(0, 0, 0, 0.9);
  fill: rgba(0, 0, 0, 0.9);
}
.flatpickr-months .flatpickr-prev-month.flatpickr-disabled,
.flatpickr-months .flatpickr-next-month.flatpickr-disabled {
  display: none;
}
.flatpickr-months .flatpickr-prev-month i,
.flatpickr-months .flatpickr-next-month i {
  position: relative;
}
.flatpickr-months .flatpickr-prev-month.flatpickr-prev-month,
.flatpickr-months .flatpickr-next-month.flatpickr-prev-month {
  /*
      /*rtl:begin:ignore*/
  left: 0; /*
      /*rtl:end:ignore*/
} /*
      /*rtl:begin:ignore*/
/*
      /*rtl:end:ignore*/
.flatpickr-months .flatpickr-prev-month.flatpickr-next-month,
.flatpickr-months .flatpickr-next-month.flatpickr-next-month {
  /*
      /*rtl:begin:ignore*/
  right: 0; /*
      /*rtl:end:ignore*/
} /*
      /*rtl:begin:ignore*/
/*
      /*rtl:end:ignore*/
.flatpickr-months .flatpickr-prev-month:hover,
.flatpickr-months .flatpickr-next-month:hover {
  color: #959ea9;
}
.flatpickr-months .flatpickr-prev-month:hover svg,
.flatpickr-months .flatpickr-next-month:hover svg {
  fill: #f64747;
}
.flatpickr-months .flatpickr-prev-month svg,
.flatpickr-months .flatpickr-next-month svg {
  width: 14px;
  height: 14px;
}
.flatpickr-months .flatpickr-prev-month svg path,
.flatpickr-months .flatpickr-next-month svg path {
  -webkit-transition: fill 0.1s;
  transition: fill 0.1s;
  fill: inherit;
}
.numInputWrapper {
  position: relative;
  height: auto;
}
.numInputWrapper input,
.numInputWrapper span {
  display: inline-block;
}
.numInputWrapper input {
  width: 100%;
}
.numInputWrapper input::-ms-clear {
  display: none;
}
.numInputWrapper input::-webkit-outer-spin-button,
.numInputWrapper input::-webkit-inner-spin-button {
  margin: 0;
  -webkit-appearance: none;
}
.numInputWrapper span {
  position: absolute;
  right: 0;
  width: 14px;
  padding: 0 4px 0 2px;
  height: 50%;
  line-height: 50%;
  opacity: 0;
  cursor: pointer;
  border: 1px solid rgba(57, 57, 57, 0.15);
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
}
.numInputWrapper span:hover {
  background: rgba(0, 0, 0, 0.1);
}
.numInputWrapper span:active {
  background: rgba(0, 0, 0, 0.2);
}
.numInputWrapper span:after {
  display: block;
  content: "";
  position: absolute;
}
.numInputWrapper span.arrowUp {
  top: 0;
  border-bottom: 0;
}
.numInputWrapper span.arrowUp:after {
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  border-bottom: 4px solid rgba(57, 57, 57, 0.6);
  top: 26%;
}
.numInputWrapper span.arrowDown {
  top: 50%;
}
.numInputWrapper span.arrowDown:after {
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  border-top: 4px solid rgba(57, 57, 57, 0.6);
  top: 40%;
}
.numInputWrapper span svg {
  width: inherit;
  height: auto;
}
.numInputWrapper span svg path {
  fill: rgba(0, 0, 0, 0.5);
}
.numInputWrapper:hover {
  background: rgba(0, 0, 0, 0.05);
}
.numInputWrapper:hover span {
  opacity: 1;
}
.flatpickr-current-month {
  font-size: 135%;
  line-height: inherit;
  font-weight: 300;
  color: inherit;
  position: absolute;
  width: 75%;
  left: 12.5%;
  padding: 7.48px 0 0 0;
  line-height: 1;
  height: 34px;
  display: inline-block;
  text-align: center;
  -webkit-transform: translate3d(0, 0, 0);
  transform: translate3d(0, 0, 0);
}
.flatpickr-current-month span.cur-month {
  font-family: inherit;
  font-weight: 700;
  color: inherit;
  display: inline-block;
  margin-left: 0.5ch;
  padding: 0;
}
.flatpickr-current-month span.cur-month:hover {
  background: rgba(0, 0, 0, 0.05);
}
.flatpickr-current-month .numInputWrapper {
  width: 6ch;
  width: 7ch\0;
  display: inline-block;
}
.flatpickr-current-month .numInputWrapper span.arrowUp:after {
  border-bottom-color: rgba(0, 0, 0, 0.9);
}
.flatpickr-current-month .numInputWrapper span.arrowDown:after {
  border-top-color: rgba(0, 0, 0, 0.9);
}
.flatpickr-current-month input.cur-year {
  background: transparent;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  color: inherit;
  cursor: text;
  padding: 0 0 0 0.5ch;
  margin: 0;
  display: inline-block;
  font-size: inherit;
  font-family: inherit;
  font-weight: 300;
  line-height: inherit;
  height: auto;
  border: 0;
  border-radius: 0;
  vertical-align: initial;
  -webkit-appearance: textfield;
  -moz-appearance: textfield;
  appearance: textfield;
}
.flatpickr-current-month input.cur-year:focus {
  outline: 0;
}
.flatpickr-current-month input.cur-year[disabled],
.flatpickr-current-month input.cur-year[disabled]:hover {
  font-size: 100%;
  color: rgba(0, 0, 0, 0.5);
  background: transparent;
  pointer-events: none;
}
.flatpickr-current-month .flatpickr-monthDropdown-months {
  appearance: menulist;
  background: transparent;
  border: none;
  border-radius: 0;
  box-sizing: border-box;
  color: inherit;
  cursor: pointer;
  font-size: inherit;
  font-family: inherit;
  font-weight: 300;
  height: auto;
  line-height: inherit;
  margin: -1px 0 0 0;
  outline: none;
  padding: 0 0 0 0.5ch;
  position: relative;
  vertical-align: initial;
  -webkit-box-sizing: border-box;
  -webkit-appearance: menulist;
  -moz-appearance: menulist;
  width: auto;
}
.flatpickr-current-month .flatpickr-monthDropdown-months:focus,
.flatpickr-current-month .flatpickr-monthDropdown-months:active {
  outline: none;
}
.flatpickr-current-month .flatpickr-monthDropdown-months:hover {
  background: rgba(0, 0, 0, 0.05);
}
.flatpickr-current-month
  .flatpickr-monthDropdown-months
  .flatpickr-monthDropdown-month {
  background-color: transparent;
  outline: none;
  padding: 0;
}
.flatpickr-weekdays {
  background: transparent;
  text-align: center;
  overflow: hidden;
  width: 100%;
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
  -webkit-align-items: center;
  -ms-flex-align: center;
  align-items: center;
  height: 28px;
}
.flatpickr-weekdays .flatpickr-weekdaycontainer {
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-flex: 1;
  -webkit-flex: 1;
  -ms-flex: 1;
  flex: 1;
}
span.flatpickr-weekday {
  cursor: default;
  font-size: 90%;
  background: transparent;
  color: rgba(0, 0, 0, 0.54);
  line-height: 1;
  margin: 0;
  text-align: center;
  display: block;
  -webkit-box-flex: 1;
  -webkit-flex: 1;
  -ms-flex: 1;
  flex: 1;
  font-weight: bolder;
}
.dayContainer,
.flatpickr-weeks {
  padding: 1px 0 0 0;
}
.flatpickr-days {
  position: relative;
  overflow: hidden;
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: start;
  -webkit-align-items: flex-start;
  -ms-flex-align: start;
  align-items: flex-start;
  width: 307.875px;
}
.flatpickr-days:focus {
  outline: 0;
}
.dayContainer {
  padding: 0;
  outline: 0;
  text-align: left;
  width: 307.875px;
  min-width: 307.875px;
  max-width: 307.875px;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  display: inline-block;
  display: -ms-flexbox;
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-wrap: wrap;
  flex-wrap: wrap;
  -ms-flex-wrap: wrap;
  -ms-flex-pack: justify;
  -webkit-justify-content: space-around;
  justify-content: space-around;
  -webkit-transform: translate3d(0, 0, 0);
  transform: translate3d(0, 0, 0);
  opacity: 1;
}
.dayContainer + .dayContainer {
  -webkit-box-shadow: -1px 0 0 #e6e6e6;
  box-shadow: -1px 0 0 #e6e6e6;
}
.flatpickr-day {
  background: none;
  border: 1px solid transparent;
  border-radius: 150px;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  color: #393939;
  cursor: pointer;
  font-weight: 400;
  width: 14.2857143%;
  -webkit-flex-basis: 14.2857143%;
  -ms-flex-preferred-size: 14.2857143%;
  flex-basis: 14.2857143%;
  max-width: 39px;
  height: 39px;
  line-height: 39px;
  margin: 0;
  display: inline-block;
  position: relative;
  -webkit-box-pack: center;
  -webkit-justify-content: center;
  -ms-flex-pack: center;
  justify-content: center;
  text-align: center;
}
.flatpickr-day.inRange,
.flatpickr-day.prevMonthDay.inRange,
.flatpickr-day.nextMonthDay.inRange,
.flatpickr-day.today.inRange,
.flatpickr-day.prevMonthDay.today.inRange,
.flatpickr-day.nextMonthDay.today.inRange,
.flatpickr-day:hover,
.flatpickr-day.prevMonthDay:hover,
.flatpickr-day.nextMonthDay:hover,
.flatpickr-day:focus,
.flatpickr-day.prevMonthDay:focus,
.flatpickr-day.nextMonthDay:focus {
  cursor: pointer;
  outline: 0;
  background: #e6e6e6;
  border-color: #e6e6e6;
}
.flatpickr-day.today {
  border-color: #959ea9;
}
.flatpickr-day.today:hover,
.flatpickr-day.today:focus {
  border-color: #959ea9;
  background: #959ea9;
  color: #fff;
}
.flatpickr-day.selected,
.flatpickr-day.startRange,
.flatpickr-day.endRange,
.flatpickr-day.selected.inRange,
.flatpickr-day.startRange.inRange,
.flatpickr-day.endRange.inRange,
.flatpickr-day.selected:focus,
.flatpickr-day.startRange:focus,
.flatpickr-day.endRange:focus,
.flatpickr-day.selected:hover,
.flatpickr-day.startRange:hover,
.flatpickr-day.endRange:hover,
.flatpickr-day.selected.prevMonthDay,
.flatpickr-day.startRange.prevMonthDay,
.flatpickr-day.endRange.prevMonthDay,
.flatpickr-day.selected.nextMonthDay,
.flatpickr-day.startRange.nextMonthDay,
.flatpickr-day.endRange.nextMonthDay {
  background: #569ff7;
  -webkit-box-shadow: none;
  box-shadow: none;
  color: #fff;
  border-color: #569ff7;
}
.flatpickr-day.selected.startRange,
.flatpickr-day.startRange.startRange,
.flatpickr-day.endRange.startRange {
  border-radius: 50px 0 0 50px;
}
.flatpickr-day.selected.endRange,
.flatpickr-day.startRange.endRange,
.flatpickr-day.endRange.endRange {
  border-radius: 0 50px 50px 0;
}
.flatpickr-day.selected.startRange + .endRange:not(:nth-child(7n + 1)),
.flatpickr-day.startRange.startRange + .endRange:not(:nth-child(7n + 1)),
.flatpickr-day.endRange.startRange + .endRange:not(:nth-child(7n + 1)) {
  -webkit-box-shadow: -10px 0 0 #569ff7;
  box-shadow: -10px 0 0 #569ff7;
}
.flatpickr-day.selected.startRange.endRange,
.flatpickr-day.startRange.startRange.endRange,
.flatpickr-day.endRange.startRange.endRange {
  border-radius: 50px;
}
.flatpickr-day.inRange {
  border-radius: 0;
  -webkit-box-shadow: -5px 0 0 #e6e6e6, 5px 0 0 #e6e6e6;
  box-shadow: -5px 0 0 #e6e6e6, 5px 0 0 #e6e6e6;
}
.flatpickr-day.flatpickr-disabled,
.flatpickr-day.flatpickr-disabled:hover,
.flatpickr-day.prevMonthDay,
.flatpickr-day.nextMonthDay,
.flatpickr-day.notAllowed,
.flatpickr-day.notAllowed.prevMonthDay,
.flatpickr-day.notAllowed.nextMonthDay {
  color: rgba(57, 57, 57, 0.3);
  background: transparent;
  border-color: transparent;
  cursor: default;
}
.flatpickr-day.flatpickr-disabled,
.flatpickr-day.flatpickr-disabled:hover {
  cursor: not-allowed;
  color: rgba(57, 57, 57, 0.1);
}
.flatpickr-day.week.selected {
  border-radius: 0;
  -webkit-box-shadow: -5px 0 0 #569ff7, 5px 0 0 #569ff7;
  box-shadow: -5px 0 0 #569ff7, 5px 0 0 #569ff7;
}
.flatpickr-day.hidden {
  visibility: hidden;
}
.rangeMode .flatpickr-day {
  margin-top: 1px;
}
.flatpickr-weekwrapper {
  float: left;
}
.flatpickr-weekwrapper .flatpickr-weeks {
  padding: 0 12px;
  -webkit-box-shadow: 1px 0 0 #e6e6e6;
  box-shadow: 1px 0 0 #e6e6e6;
}
.flatpickr-weekwrapper .flatpickr-weekday {
  float: none;
  width: 100%;
  line-height: 28px;
}
.flatpickr-weekwrapper span.flatpickr-day,
.flatpickr-weekwrapper span.flatpickr-day:hover {
  display: block;
  width: 100%;
  max-width: none;
  color: rgba(57, 57, 57, 0.3);
  background: transparent;
  cursor: default;
  border: none;
}
.flatpickr-innerContainer {
  display: block;
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  overflow: hidden;
}
.flatpickr-rContainer {
  display: inline-block;
  padding: 0;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
}
.flatpickr-time {
  text-align: center;
  outline: 0;
  display: block;
  height: 0;
  line-height: 40px;
  max-height: 40px;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  overflow: hidden;
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
}
.flatpickr-time:after {
  content: "";
  display: table;
  clear: both;
}
.flatpickr-time .numInputWrapper {
  -webkit-box-flex: 1;
  -webkit-flex: 1;
  -ms-flex: 1;
  flex: 1;
  width: 40%;
  height: 40px;
  float: left;
}
.flatpickr-time .numInputWrapper span.arrowUp:after {
  border-bottom-color: #393939;
}
.flatpickr-time .numInputWrapper span.arrowDown:after {
  border-top-color: #393939;
}
.flatpickr-time.hasSeconds .numInputWrapper {
  width: 26%;
}
.flatpickr-time.time24hr .numInputWrapper {
  width: 49%;
}
.flatpickr-time input {
  background: transparent;
  -webkit-box-shadow: none;
  box-shadow: none;
  border: 0;
  border-radius: 0;
  text-align: center;
  margin: 0;
  padding: 0;
  height: inherit;
  line-height: inherit;
  color: #393939;
  font-size: 14px;
  position: relative;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  -webkit-appearance: textfield;
  -moz-appearance: textfield;
  appearance: textfield;
}
.flatpickr-time input.flatpickr-hour {
  font-weight: bold;
}
.flatpickr-time input.flatpickr-minute,
.flatpickr-time input.flatpickr-second {
  font-weight: 400;
}
.flatpickr-time input:focus {
  outline: 0;
  border: 0;
}
.flatpickr-time .flatpickr-time-separator,
.flatpickr-time .flatpickr-am-pm {
  height: inherit;
  float: left;
  line-height: inherit;
  color: #393939;
  font-weight: bold;
  width: 2%;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
  align-self: center;
}
.flatpickr-time .flatpickr-am-pm {
  outline: 0;
  width: 18%;
  cursor: pointer;
  text-align: center;
  font-weight: 400;
}
.flatpickr-time input:hover,
.flatpickr-time .flatpickr-am-pm:hover,
.flatpickr-time input:focus,
.flatpickr-time .flatpickr-am-pm:focus {
  background: #eee;
}
.flatpickr-input[readonly] {
  cursor: pointer;
}

@-webkit-keyframes fpFadeInDown {
  from {
    opacity: 0;
    -webkit-transform: translate3d(0, -20px, 0);
    transform: translate3d(0, -20px, 0);
  }
  to {
    opacity: 1;
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
  }
}
@keyframes fpFadeInDown {
  from {
    opacity: 0;
    -webkit-transform: translate3d(0, -20px, 0);
    transform: translate3d(0, -20px, 0);
  }
  to {
    opacity: 1;
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
  }
}
.gbbDiscountComponentProgressBarContainer{
    background: gray;
    display: block;
    position: relative;
    height:20px;
    border-radius:5px;
    width: 100%;
    margin: auto;
    width: 80%;
}

.gbbDiscountComponentProgressBar{
    /* background: rgb(0, 217, 255); */
    background: rgb(26, 240, 58);
    position: absolute;
    display: block !important;
    /* max-width: 100%; */
    height: 100%;
    border-radius:5px;
}
.gbbDiscountComponentProgressBarAnimation{
    animation: progressAnimation 1s forwards;
    width: 100%;
}

.gbbDiscountComponentProgressBarRuleText{
    position: absolute;
    top: 22px;
    width: 6ch;
}

/* progressAnimation based on time */
@keyframes progressAnimation {
    0% { width: 0%; }
    10%{ width: 10%; }
    20%{ width: 20%; }
    30%{ width: 30%; }
    40%{ width: 40%; }
    50%{ width: 50%; }
    60%{ width: 60%; }
    70%{ width: 70%; }
    80%{ width: 80%; }
    90%{ width: 90%; }
    100% { width: 100%; }
}


.gbbDiscountComponentProgressBarContainer{
    height: 10px;
}

.gbbDiscountComponent:not(:empty){
    height: 40px;
}

.gbbStarSvgContainer{
    width: 24px;
    height: 24px;
    position: absolute;
    top: -15px;
}


.gbbReviewPageDiscountAppliedLabel{
    display: grid;
    justify-content: end;
    grid-template-columns: max-content;
    font-size: 14px;
    font-weight: 600;
}

.gbbReviewPageDiscountAppliedWrapper:not(empty){
    display: grid;
    justify-content: end;
}

.gbbReviewPageTotalCartValueLabel{
    display: grid;
    justify-content: end;
    grid-template-columns: max-content;
    font-size: 16px;
    font-weight: 600;
    text-align: end;
}


/* .gbbStarSvgContainer polygon.svgInnerBody{
    fill: white;
} */

.gbbStarActive polygon.svgInnerBody{
    fill: rgb(255, 255, 0) !important;
    /* add animation */
    /* animation: starAnimation 1s infinite; */
    /* put a transform and translate animation */
    
    transition: fill 0.5s;
}

@keyframes starAnimation {
    0% { fill: white; }
    50% { fill: rgb(58, 10, 232); }
    100% { fill: rgb(255, 255, 0); }
}


@media screen and (min-width: 1023px) {
    .gbbDiscountComponentProgressBarRuleText{
        position: absolute;
        top: 22px;
        width: max-content;
    }

    .gbbDiscountComponentProgressBarContainer{
        width: 80%;
    }  
    
    .gbbReviewPageTotalCartValueLabel{

        font-size: 24px;
    
    }
    .gbbReviewPageDiscountAppliedLabel{
        font-size: 16px;
    }
       
}



.gbbCategoryHeaderContainer {
  display: grid;
  /* grid-auto-flow: column; */
  align-items: center;
  justify-content: start;
  grid-template-columns: 0.3fr 1fr 2fr;
}
.gbbCategoryImage {
  width: 150px;
  height: 100px;
  object-fit: contain;
}
.gbbCategoryContainer {
  padding: 5px;
  /* background: #f5f5f5; */
  border: 2px solid #C0C0C0;
  border-radius: 10px;
}
.gbbMultipleCategoriesContainerHTML{
  display: grid;
  grid-gap: 20px;
}
.gbbMultipleCategoriesPageHTML{
  margin: 20px 0;
}
.gbbCategoryHeaderContainer{
  cursor: pointer;
}
.gbbCategoryTitle{
  font-weight: 600;
}

.gbbCategoryContainerTab{
  width: fit-content;
  padding: 5px;
  border-radius: 6px;
  display: grid;
  place-items: center;
}

.gbbCategoryTitlesContainer.gbbCategoryContainerTabUI{
  width: fit-content;
  display: grid;
  place-items: center;
}

.gbbMultipleCategoriesRibbonContainer, .gbbMultipleCategoriesDropdownContainer{
  padding: 21px 15px;
  display: flex;
  place-content: start;
  flex-wrap: wrap;
  grid-gap: 10px;
  overflow-x: auto;
  top: 0;
  z-index: 2;
}

.gbbMultipleCategoriesDropdownContainer{
  border-radius: 4px;
}


.gbbCategoryContainer.gbbCategoryContainerTabUI , .gbbMutipleCategoriesDropdown{
  padding: 5px 15px;
  border-radius: 5px;
  border: 1px solid #3c3c3c;
 
  display: grid;
  flex-grow: 1;
}


.gbbMutipleCategoriesDropdown{
  background: black;
  color: white;
  padding: 10px;
  border-radius: 4px;
}


.gbbCategoryContainer.gbbCategoryContainerTabUI.gbbCategoryContainerTabUIActive{
  background-color: black;
  color: #F6F6F6;
}

.gbbCategorySubTitleForTabUI{
  display: none;
}

.gbbMultipleCategoriesActiveCategorySubtitle{
  display: grid;
  place-items: center;
  grid-template-columns: 1fr;
  font-weight: 900;
}

.gbbCategoryImageForTabUI{
  display: none;
}

.gbbCategoryTitlesContainer.gbbCategoryTitlesContainerForTabUI{
  display: grid;
  place-content: center;
}

.gbbCategoryHeaderContainerTabUI.gbbCategoryHeaderContainer{
  display: grid;
  place-items: center;
  grid-template-columns: 1fr;
}

/* .gbbMultipleCategoriesPageHTMLForTabUI{
  overflow-y: auto;
  max-height: 80vh;
} */
.gbbMultipleCategoriesContainerHTMLForTabUI{
  position: relative;
}
 .gbbFiltersMainButtonWrapper{
  z-index: 1;
}
@media (min-width:600px){
  .gbbCategoryContainer {
      padding: 10px 20px;
  }
  .gbbCategoryHeaderContainer {
      grid-template-columns: unset;
      grid-auto-flow: column;
  }
  .gbbCategoryTitlesContainer.gbbCategoryTitlesContainerForTabUI{
    display: grid;
    place-content: center;
  }
  
  .gbbCategoryHeaderContainerTabUI.gbbCategoryHeaderContainer{
    display: grid;
    place-items: center;
    grid-template-columns: 1fr;
  }
}

@media only screen and (max-width: 600px) {
  .gbbMultipleCategoriesRibbonContainer , .gbbMultipleCategoriesDropdownContainer{
    padding: 21px 15px;
    place-content: start;
  }
 
  .gbbMultipleCategoriesDropdownContainer{
      display: flex;
    }


    .gbbMultipleCategoriesRibbonContainer{
      display: none;
    }

}

@media only screen and (min-width: 601px) {
  .gbbMultipleCategoriesDropdownContainer{
    display: none;
  }
}

.gbbMultipleCategoriesDropdownArrow{
    align-self: center;
    display: grid;
    position: absolute;
    right: 4%;
    pointer-events: none;
}

.gbbMultipleCategoriesDropdownArrow svg path{ 
  fill: white;
}

.gbbMutipleCategoriesDropdown{
  -webkit-appearance: none; /* Remove default arrow for WebKit browsers */
  -moz-appearance: none; /* Remove default arrow for Firefox */
  appearance: none; /* Remove default arrow for modern browsers */
}



.bannerAttached .gbbCategoryHeaderContainer :first-child, .bannerAttached .gbbCategorySubTitle{
  display : none;
}
.bannerAttached .gbbCategoryImage{
  width: unset !important;
  height: unset !important;
  max-width: 100%;
}
.bannerAttached .gbbCategoryHeaderContainer{
  grid-template-columns: unset;
}

.gbbCategoryContainer.bannerAttached {
  background: #FFFFFF;
  border: unset;
}.gbbProductsContainer,.gbbProductsContainerV2{
  margin: 15px 10px;
  
}
.gbbProductsItemsContainer{
  display: grid;
  grid-template-columns: repeat(2,1fr);
  grid-gap: 15px;
  font-size: 14px;
}
.gbbProductItem {
  display: grid;
  grid-template-rows: 2fr 0.1fr 0.5fr;
  background: #f1f2f3;
  /* padding: 10px; */
  position: relative;
  box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
  transition: all 0.3s cubic-bezier(.25,.8,.25,1);
}


.gbbProductItem {
    display: grid;
    grid-template-rows: 1fr 0.1fr 0.1fr;
    background: #F1F2F3;
    /* padding: 10px; */
    position: relative;
    box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
    transition: all 0.3s cubic-bezier(.25,.8,.25,1);
}
  


.gbbProductReadMore{
  display: grid;
  justify-self: end;
  padding: 10px;
  color: red;
  cursor: pointer;
}
.gbbProductDescriptionContainer{
  width: 100%;
}
.gbbProductDescriptionText{
  display: -webkit-box;
  max-width: 100%;
  margin: 0 auto;
  font-size: 14px;
  -webkit-box-orient: vertical;
  overflow: hidden;
  font-weight: 400;
  max-height: 200px;
  overflow-y: auto;
  /* -webkit-line-clamp: 4;
  text-overflow: ellipsis; */
}
.gbbProductVariantModalDetailsContainer{
  display: grid;
  grid-gap: 15px;
}
.gbbProductCardActionContainer{
  display: grid;
  grid-template-rows: min-content;
  grid-gap: 10px;
  grid-template-columns: 1fr 1fr;
}
.gbbProductCardActionContainer .gbbProductButtonWrapper{
  width: 50%;
  justify-self: end;
  user-select: none;
}
.gbbProductVariantModalContentContainer{
  display: grid;
  grid-gap: 20px;
}
.gbbProductItemPrice{
}
.gbbProductImageContainer{
  /* width: 140px;
  height: 140px; */
  position: relative;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}
.gbbProductSliderNavigatior{
  position: absolute;
  bottom: 5px;
  right:5px;
}
.gbbPrevImage,.gbbNextImage{
  margin-left:5px;
  position: absolute;
  top: 50%;
  width: 2px;
  padding: 16px;
  margin-top: -22px;
  color: #777676;
  font-weight: bold;
  font-size: 18px;
  transition: 0.6s ease;
  border-radius: 0 3px 3px 0;
  user-select: none;
  margin-left: 5px;
  font-size: 16px;
  cursor: pointer !important;
}
.gbbNextImage{
  right: 3%;
}
.gbbPrevImage:hover, .gbbNextImage:hover {
  /* background-color: rgb(124 121 121 / 80%);
  color: #ffff; */
  scale: 1.1;
}
.gbbFade {
  animation-name: gbbFade;
  animation-duration: 1.5s;
}

@keyframes gbbFade {
  from {opacity: .4} 
  to {opacity: 1}
}
.gbbProductImageContainerImg{
  width: 100%;
  height: 100%;
  object-fit: cover;
  max-height: 150px;
  background: white;
}
.gbbProductVariantModalContentContainer .gbbProductImageContainerImg{
  max-height: 300px;
}
.gbbAddedToCartText{
  position: absolute;
  top: 5%;
  left: 5%;
  background: #000;
  color: #fff;
  border-radius: 5px;
  padding: 5px;
}
.gbbProductQtyContainer{
  width: 60%;
  margin: 0% 10%;
}
.gbbProductQuantityHTML{
  width: 100%;
  display: grid;
  grid-auto-flow: column;
  grid-gap: 15px;
  align-items: center;
}
.gbbProductQuantityAddButton, .gbbProductQuantityRemoveButton{
  background: #000000;
  color:#ffffff;
  border: none;
  border-radius: 5px;
  width: 35px;
  height: 35px;
  font-size: 24px;
  justify-self: center;
  cursor: pointer;
  position: relative;
  user-select: none;
  
  
}

.gbbProductQuantityAddButtonWrapper, .gbbProductQuantityRemoveButtonWrapper{
  position: absolute;
  top: 16px;
  left: 18px;
  transform: translate(-50%, -50%);
  -webkit-tap-highlight-color: transparent;
  user-select: none;
}


.gbbProductQuantityAddButton{
  justify-self: right;
  -webkit-tap-highlight-color: transparent;
}
.gbbProductQuantityRemoveButton{
  justify-self: left;
  -webkit-tap-highlight-color: transparent;
}
.gbbProductQuantityLabel{
  text-align: center;
  font-size: 16px;
  user-select: none;
}
.gbbProductActionContainer{
  width: 100%;
  padding: 10px 10px;
  align-items: center;
  display: grid;
  grid-gap:5px;
  padding-top: 5px;
}
.gbbProductAddButton{
  -webkit-tap-highlight-color: transparent;
  padding: 10px;
  width: 100%;
  background: #000000;
  color: #ffffff;
  border-radius: 5px;
  border: none;
  font-size: 14px;
  cursor: pointer;
  text-align: center;
}

.gbbProductAddButton:active, .gbbProductQuantityAddButton:active, .gbbProductQuantityRemoveButton:active {
  transform: scale(0.95);
}
.gbbProductTextContainer, .gbbProductCardTextContainer,.gbbProductDynamicContentContainer{
  text-align: left;
  width: 100%;
  font-size: 12px;
  align-self: center;
  padding: 5px 10px;
}
.gbbProductCardTextContainer > div{
  font-weight: bold;
  padding: 0;
  font-size: 14px;
}
.gbbProductItemPrice{
  font-size: 12px;
  /* color: black; */
}
.gbbProductItemTitle{
  /* color: black; */
}
.gbbProductsLabel{
  margin: 0 5px;
  font-size: 16px;
  font-weight: 600;
  color: #4f4b4b;
  margin-bottom: 20px;
}
.gbbProductQuantityHTMLContainer{
  display: grid;
  grid-auto-flow: column;
  grid-template-columns: 0.2fr 0.2fr;
  grid-gap: 15px;
  -webkit-tap-highlight-color: transparent;
}
.gbbPageBannerImage{
  width: 100%;
}
.gbbAddProductsPageNavigationContainer, .gbbChooseGiftBoxPageNavigationContainer, .gbbPersonalizePageNavigationContainer{
  /* width: 100%; */
  position: relative;
  /* top: 15%; */
  /* transform: translate(0px, -45%); */
}
.gbbAddProductsPageHTML, .gbbChooseGiftBoxPageHTML, .gbbPersonalizePageHTML{
  /* position: relative;  */
  /* transform: translate(0px, -150px); */
}
.gbbPrecuratedBoxPageHTML{
  position: relative; 
  transform: translate(0px, -100px);
}
/* .gbbAddProductsPageNavigationContainer .gbbNavigationItemsContainer::before{
  content: none;
}
.gbbChooseGiftBoxPageNavigationContainer .gbbNavigationItemsContainer::before{
  content: none;
}
.gbbPersonalizePageNavigationContainer .gbbNavigationItemsContainer::before{
  content: none;
} */
/* do it for other pages also */
/* .gbbAddProductsPageNavigationContainer .gbbNavigationItemsContainer{ 
  margin: 0 10%;
}
.gbbChooseGiftBoxPageNavigationContainer .gbbNavigationItemsContainer{ 
  /* margin: 0 10%; */
  /* margin: 10%; */
/* } */
/* .gbbPersonalizePageNavigationContainer .gbbNavigationItemsContainer{ 
  margin: 0 10%;
}  */

.gbbChooseGiftBoxPageHeader, .gbbAddProductsPageHeader{
  
}

.gbbProductRemoveButton{
  background: rgb(237 159 159);
}
.gbbProductSoldOutButton{
  background: #d2cccc;
  pointer-events: none;
}
/********************PRODUCT VARIANTS MODAL*********************************/
.gbbDisabled {
  pointer-events: none;
  opacity: 0.2;
  /* background-color: black; */
}
.gbbProductVariantModalMainContainer{
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  top: 0;
  background-color: rgba(24,24,24,0.8);
  z-index: 1000000000;
}
.gbbProductVariantModalContainer{
  position: fixed;
  /* top: 30%;
  left: 5% !important;
  right: 5% !important;
transform: translate(0%, -50%); */
  /* width: 100%;
  margin: 0 25px; */
  height: 100%;
  background: #ffff;
  overflow-y: auto;
  z-index: 100;
  display: grid;
  /* grid-template-rows: 0.1fr 0.6fr 0.1fr;; */
  padding: 20px;
  border: 2px solid #b2b5b9;
  border-radius: 5px;
  grid-gap: 20px;
  overflow-x: hidden;
  /* animation: zoom-in-zoom-out 0.2s ease; */

}
.gbbCartProductsMainContainer{
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  top: 0;
  background-color: rgba(24,24,24,0.8);
  z-index: 1000000000;
}
.gbbCartProductsContainerModal{
  position: fixed;
  z-index: 1000000000;
  transform: translate(0, -50%);
  background: #ffff;
  border-radius: 5px;
  text-align: center;
  padding: 10px;
  max-height: 95vh;
  /* left: 5vw;
  top: 5vh;
  right: 5vw; */
  left: 5vw;
  right: 5vw;
  top: 50vh;
}
.gbbCartProductsContainerHeader{
  display: grid;
  grid-template-columns: 1fr 0.2fr;
  justify-content: space-between;
  align-items: center;
}
.gbbCartProductsModalClose{
  justify-self: end;
  padding: 12px 10px;
  font-weight: bold;
  transform: rotate(45deg);
  font-size: 35px;
  position: absolute;
  top: -8px;
  right: 0px;
  color: #B2B5B9;
  cursor: pointer;
  user-select: none;
}
.gbbModalTotalContainer{
  display: grid;
  grid-template-columns: 1fr 1fr;
  justify-content: space-between;
  align-items: center;
  padding: 0 5px;
}
.gbbModalTotalContainer .gbbFooterTotalContainer{
  text-align: unset;
}
.gbbModalTotalContainer .gbbFooterTotalLabel{
  justify-self: start;
  font-size: 16px;
  font-weight: 600;
}
.gbbModalTotalContainer .gbbFooterTotalValue{
  justify-self: end;
}
.gbbConditionNotificationToastMainContainer{
  position: fixed;
  top: 80%;
transform: translate(-50%, -50%);
  background: #ffff;
  padding: 20px;
  border-radius: 5px;
  text-align: center;
  z-index: 300;
}
.gbbConditionNotificationToast {
  position: absolute;
  left: 50%;
  bottom: 80%;
  right: 5%;
  transform: translate(-50%, -50%);
  background: #ffff;
  z-index: 99999999999;
  padding: 5px 15px;
  border-radius: 5px;
  width: 80%;
  display: grid;
  grid-auto-flow: column;
  grid-gap: 20px;
  align-items: center;
  justify-content: center;
}
@keyframes zoom-in-zoom-out {
  0% {
    transform: scale(0, 0);
  }
  50% {
    transform: scale(0.5, 0.5);
  }
  100% {
    transform: scale(1, 1);
  }
}



.gbbProductVariantOptionValue{
  padding: 5px 15px;
  border: none;
  background: #f1f2f3;
  font-size: 14px;
  border-radius: 5px;
  cursor: pointer;
}
.gbbProductVariantModalHeader{
  display: grid;
  grid-auto-flow: column;
}
.gbbProductVariantOptionLabel, .gbbProductQuantityHeading{
  font-weight: bold;
  font-size: 14px;
}
.gbbProductVariantNotAvailableWarning{
  font-size: 14px;
  color: red;
  font-weight: bold;
  display: none;
}
.gbbProductVariantOptionValuesContainer{
  /* padding: 10px 0; */
  display: flex;
  flex-wrap: wrap;
  row-gap: 10px;
  column-gap: 10px;
}
.gbbProductVariantAddButton{
  padding: 5px 10px;
  width: 100%;
  display: grid;
  justify-self: end;
  border: none;
  border-radius: 5px;
  background: #000000;
  color: #ffffff;
  cursor: pointer;
  text-align: center;
  align-items: center;
}
.gbbProductVariantAddButton:active {
  transform: scale(0.95);
}
.gbbProductVariantModalClose{
  justify-self: end;
  padding: 2px 10px;
  font-weight: bold;
  transform: rotate(45deg);
  font-size: 35px;
  position: absolute;
  top: -5px;
  right: 0px;
  color: #B2B5B9;
  cursor: pointer;
  user-select: none;
}
.gbbConditionNotificationClose{
  justify-self: end;
  transform: rotate(45deg);
  font-size: 35px;
  color: #ffff;
  cursor: pointer;
}
.gbbFooterProductPrice, .gbbCartModalProductPrice{
  font-weight: bold;
}
.gbbFooterTotalValueContainer{
  display: grid;
  grid-auto-flow: column;
  grid-gap: 5px;
  grid-template-columns: repeat(2, min-content);
  justify-content: end;
}
.gbbFooterOriginalTotalValue, .gbbSummaryPageBundleOriginalPrice{
  text-decoration: line-through;
}
.gbbFooterProductsContainer{

}
.gbbDiscountMessage{
  text-align: center;
  font-size: 16px;
  color: black;
}
/* .gbbFooterProductsContainer::-webkit-scrollbar {
  width: 0.3rem;
}

.gbbFooterProductsContainer::-webkit-scrollbar-track {
  -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
}

.gbbFooterProductsContainer::-webkit-scrollbar-thumb {
  background-color: darkgrey;
} */

/********FILTER PRODUCTS*******************************/
.gbbProductsFilterContainer{
  margin: 0 20px;
  cursor: pointer;
  /* margin-top: 70px; */
}
.gbbFiltersDropDownWrapper{
  display: grid;
  grid-template-columns: 1fr 50px;
  margin: 10px 0px;
  align-items: center;
}

.gbbFiltersDropDownButton{
/* transform: rotate(180deg); */
/* height: 30px; */
    display: grid;
width: auto;
cursor: pointer
}
.gbbProductsFilterHeader{
  cursor: pointer !important;
}
.gbbProductsFilterButton{
  color: #796c6c;
  padding: 10px 15px;
  font-size: 16px;
  border: none;
  background: #f1f2f3;
  font-weight: 500;
  font-weight: bold;
  margin: 10px 0;
  border-radius: 5px;
  cursor: pointer;
}
.gbbProductsFilterTagsContainer{
  /* width: min-content; */
  /* display: grid;
  grid-template-columns: repeat(3,1fr);
  grid-gap: 30px; */
  display: flex;
  flex-flow: row wrap;
  gap: 10px;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #f1f2f3;
}
.gbbActiveFilter{
  background: #000000;
  color: #ffffff;
}
.gbbFilterTagContainer{
  /* padding: 0 10px; */
  background: #f1f2f3;
  border-radius: 5px;
  /* display: grid;
  grid-auto-flow: column;
  grid-gap: 10px;
  height: min-content;
  justify-items: center; */
}
.gbbFilterTagText{
  color: black;
  padding: 5px 10px;
}
.gbbFilterTagRemoveSymbol{
  font-size: 14px;
  align-self: center;
}
.gbbFiltersSideBarContainer, .gbbProductsFiltersMainContainer{
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  top: 0;
  z-index: 999999999;
  transition: transform 2s;
}
.gbbProductsFiltersMainContainer{
  background-color: rgba(24,24,24,0.8);
  height: 100%;
}
.gbbProductsFiltersContainer{
  background: white;
  padding: 4%;
  height: 100%;
  width: 70%;
  transition: 0.5s;
  transform: translateX(-100%);
  overflow-y: auto;
  animation: slide-in 0.5s forwards;
  -webkit-animation: slide-in 0.5s forwards;
}
.gbbProductsFiltersContainerHeader{
  display: flex;
  justify-content: space-between;
  margin: 10px 0px;
  position: relative;
}
.gbbFilterDropDownButton{
  transform: rotate(180deg);
  height: 30px;
  width: auto;
  cursor: pointer;
}
.gbbProductsFiltersContainerHeaderLabels{
  display: grid;
  grid-auto-flow: column;
  grid-gap: 10px;
  align-items: center;
}
.gbbProductsFiltersClearLabel{
  font-size: 10px;
  text-decoration: underline;
  cursor: pointer;
}
.gbbProductsFiltersContainerLabel{
  font-weight: 600;
  font-size: 16px;
}
.gbbFilterModalClose{
  justify-self: end;
  transform: rotate(45deg);
  font-size: 45px;
  position: absolute;
  top: -30px;
  right: 0px;
  color: #B2B5B9;
  cursor: pointer;
}
.gbbProductsFilterTagContainer{
  display: flex;
  gap: 10px;
  align-items: center;
}
.gbbProductsFilterTagCheckbox{
  width: 16px;
  height: 16px;
}
.gbbFilterContainer {
  border-top: 1px solid #d5cccc;
  padding-bottom: 15px;
  cursor: pointer; 
}

.gbbFilterTagsContainer{
  height: 85%;
  /* overflow-y: scroll; */
  overflow-y: auto;
}

.gbbFiltersSearchSortHeader{
  margin: 5px 10px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-gap: 10px;
}
.gbbFiltersMainButtonWrapper{
  display: grid;
  grid-auto-flow: column;
  grid-gap: 15px;
  align-items: center;
  font-size: 14px;
  border: 1px solid #f1f2f3;
  padding: 0 20px;
  cursor: pointer;
}
/* Filters sidebar animation */
.gbbFiltersSideBarContainerSlideIn {
  animation: slide-in 0.5s forwards;
  -webkit-animation: slide-in 0.5s forwards;
}

.gbbFiltersSideBarContainerSlideOut {
  animation: slide-out 0.5s forwards;
  -webkit-animation: slide-out 0.5s forwards;
}
  
@keyframes slide-in {
  100% { transform: translateX(0%); }
}

@-webkit-keyframes slide-in {
  100% { -webkit-transform: translateX(0%); }
}
  
@keyframes slide-out {
  0% { transform: translateX(0%); }
  100% { transform: translateX(-100%); }
}

@-webkit-keyframes slide-out {
  0% { -webkit-transform: translateX(0%); }
  100% { -webkit-transform: translateX(-100%); }
}
/* code for price filter from codepen ->  https://codepen.io/sln/pen/bqzRMq */
.gbbFilterPriceContainer {
  width: 100%;
  border: 0;
  padding: 0;
  margin: 0; 
}

.gbbPriceFieldContainer {
  position: relative;
  width: 100%;
  height: 36px;
  box-sizing: border-box;
  background: rgba(248, 247, 244, 0.2);
  padding-top: 15px;
  border-radius: 3px;
}

.gbbPriceFieldContainer input[type=range] {
    position: absolute;
}

/* Reset style for input range */

.gbbPriceFieldContainer input[type=range] {
  width: 100%;
  height: 2px; 
  border: 0;
  outline: 0;
  box-sizing: border-box;
  border-radius: 5px;
  pointer-events: none;
  -webkit-appearance: none;
}

.gbbPriceFieldContainer input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
}

.gbbPriceFieldContainer input[type=range]:active,
.gbbPriceFieldContainer input[type=range]:focus {
  outline: 0;
}

.gbbPriceFieldContainer input[type=range]::-ms-track {
  width: 100%;
  height: 2px; 
  border: 0;
  outline: 0;
  box-sizing: border-box;
  border-radius: 5px;
  pointer-events: none;
  background: transparent;
  border-color: transparent;
  color: transparent;
  border-radius: 5px;
}

/* Style toddler input range */

.gbbPriceFieldContainer input[type=range]::-webkit-slider-thumb { 
  /* WebKit/Blink */
    position: relative;
    -webkit-appearance: none;
    margin: 0;
    border: 0;
    outline: 0;
    border-radius: 50%;
    height: 15px;
    width: 15px;
    margin-top: -6px;
    background-color: #686662;
    cursor: pointer;
    cursor: pointer;
    pointer-events: all;
    z-index: 100;
}

.gbbPriceFieldContainer input[type=range]::-moz-range-thumb { 
  /* Firefox */
  position: relative;
  appearance: none;
  margin: 0;
  border: 0;
  outline: 0;
  border-radius: 50%;
  height: 10px;
  width: 10px;
  margin-top: -5px;
  background-color: #686662;
  cursor: pointer;
  cursor: pointer;
  pointer-events: all;
  z-index: 100;
}

.gbbPriceFieldContainer input[type=range]::-ms-thumb  { 
  /* IE */
  position: relative;
  appearance: none;
  margin: 0;
  border: 0;
  outline: 0;
  border-radius: 50%;
  height: 10px;
  width: 10px;
  margin-top: -5px;
  background-color: #686662;
  cursor: pointer;
  cursor: pointer;
  pointer-events: all;
  z-index: 100;
}

/* Style track input range */

.gbbPriceFieldContainer input[type=range]::-webkit-slider-runnable-track { 
  /* WebKit/Blink */
  width: 188px;
  height: 2px;
  cursor: pointer;
  background: #686662;
  border-radius: 5px;
}

.gbbPriceFieldContainer input[type=range]::-moz-range-track { 
  /* Firefox */
  width: 188px;
  height: 2px;
  cursor: pointer;
  background: #686662;
  border-radius: 5px;
}

.gbbPriceFieldContainer input[type=range]::-ms-track { 
  /* IE */
  width: 188px;
  height: 2px;
  cursor: pointer;
  background: #686662;
  border-radius: 5px;
}

/* Style for input value block */

.gbbPriceTextWrap {
  display: flex;
  justify-content: space-between;
  color: #686662;
  font-size: 14px;
  line-height: 1.2em;
  font-weight: 400;
  margin: 5px 0;
}

.gbbPriceWrap1, 
.gbbPriceWrap1 {
  display: flex;
}



.gbbPriceTextWrap #gbbPriceWrap1Input, 
.gbbPriceTextWrap #gbbPriceWrap2Input {
  width: 30px;
  text-align: right;
  margin: 0;
  padding: 0;
  margin:0 2px;
  background:  0;
  border: 0;
  outline: 0;
  color: #fff;
  font-size: 14px;
  line-height: 1.2em;
  font-weight: 400;
}

.gbbPriceTextWrap label {
  text-align: right;
}

/* Style for active state input */
    
.gbbPriceFieldContainer input[type=range]:hover::-webkit-slider-thumb {
  box-shadow: 0 0 0 0.5px #686662;
  transition-duration: 0.3s;
}

.gbbPriceFieldContainer input[type=range]:active::-webkit-slider-thumb {
  box-shadow: 0 0 0 0.5px #686662;
  transition-duration: 0.3s;
}
.gbbSortByDropDownSelect{
  cursor: pointer;
  padding: 5px 25px;
  border: 2px solid #f1f2f3;
  font-size: 14px;
}
/* style for search box */
.gbbSearchBarMainWrapper{
display: grid;
  grid-template-columns: 0.1fr 1fr;
  align-items: center;
  grid-column: 2;
  margin: 10px 0;
  justify-self: end;
  /* border-bottom: 1px solid #f1f2f3; */
  border-bottom: 1px solid #000000;
}
.gbbSearchBarIcon{
  width: fit-content;
  display: grid;
}
.gbbSearchBarInput{
  padding: 10px;
  font-size: 14px;
  border: none;
  box-shadow: none;
    outline: none;
        width: 100%;
    background-color: transparent;
}
.gbbSearchBarInput::placeholder{
  color: #c4c4c4;
}
/* .gbbSearchBarMainWrapper:focus-within{
  border-bottom: 1px solid #000000;
} */
 .gbbProductsNotAvailable{
  text-align: center;
  font-size: 2rem;
  grid-column: 1 / -1;
 }
/*******************FOOTER HTML****************************/
.gbbAddProductsPageFooterHTML,.gbbChooseGiftBoxPageFooterHTML, .gbbPersonalizePageFooterHTML, .gbbPrecuratedBoxPageFooterHTML, .gbbMultipleCategoriesPageFooterHTML{
  background: #D7D7D7;
  padding: 5px;
  position: sticky;
  bottom: 0;
  /* z-index: 999999; */
}
.gbbProductsFooterHTML{
  display: grid;
  grid-template-columns: 1fr 0.2fr;
  grid-gap: 20px;
  padding: 10px;
  position: relative;
  background: #D7D7D7;
  /* background: #f1f2f3;
  padding: 5px;
  position: sticky;
  bottom: 0; */
}
.gbbFooterProductsContainer{
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: min-content;
  grid-gap: 5px;
  overflow-x: auto;
  overflow-y: hidden;
}
.gbbCartModalProductsContainer{
  display: grid;
  grid-auto-flow: column;
  grid-gap: 5px;
  /* overflow-x: auto; */
  overflow-y: auto;
  max-height: 70vh;
}
.gbbCartModalProductsContainer{
  grid-auto-flow: row;
}
.gbbFooterProductContainer, .gbbCartModalProductContainer{
  display: grid;
  grid-auto-flow: column;
  grid-gap: 10px;
  position: relative;
  padding: 5px;
}
.gbbCartModalProductContainer{
  grid-template-columns: 0.5fr 3fr;
}


.gbbFooterProductImageContainer{
  display: grid;
  width: 50px;
  height: 50px;
  border: 1px solid #cfc9c9;
  overflow: hidden;
}
.gbbCartProductImageContainer{
  display: grid;
  width: 80px;
  height: 80px;
  border: 1px solid #cfc9c9;
  overflow: hidden;
}
.gbbViewCartProductsLink{
  text-decoration: underline;
  cursor: pointer; 
}
.gbbCartModalProductImage{
  width: 100%;
  height: 100%;
}

.gbbFooterProductRemoveButton, .gbbCartModalProductRemoveButton{
  position: absolute;
  cursor: pointer;
}
.gbbCartProductImageContainer{
  object-fit: contain;
}
.gbbFooterProductImage{
  /* max-width: 50px; */
  /* max-width: 40px;
  min-height: 40px; */
  width: 100%;
  height: 100%;
  object-fit: contain;
}
.gbbFooterProductTextContainer{
  font-size: 12px;
  width: 100px;
}
.gbbCartModalProductTextContainer{
  font-size: 14px;
  /* width: 165px; */
  display: grid;
  grid-template-columns: 1fr 0.2fr;
  justify-content: space-between;
  align-items: start;
  grid-gap: 10px;
}
.gbbCartProductsContainerHeaderLabel{
  justify-self: start;
  font-size: 16px;
  font-weight: bold;
}
.gbbProductsFooterHTMLForMobile .gbbFooterButtonsWrapper{
  grid-template-columns: 1fr 2fr;
}
.gbbFooterProductTitle{
  width: 100px;
  white-space: nowrap;
  text-overflow: ellipsis;
  display: block;
  overflow: hidden;
}
.gbbCartModalProductTitle{
  width: 100%;
  text-align: left;
}
.gbbCartModalProductPriceQtyContainer{
  display: grid;
  grid-template-columns: 1fr 2fr;
  grid-gap: 5px;
}
.gbbFooterTotalLabel{
  color: black;
  font-size: 14px;
  line-height: 8px;
}
.gbbFooterTotalValue{
  color: black;
  font-weight: 600;
  font-size: 16px;
  white-space: nowrap;
}
.gbbFooterButtonsWrapper{
  display: grid;
  grid-gap: 15px;
  grid-template-columns: auto auto;
}
.gbbFooterBackButton, .gbbFooterNextButton {
  font-size: 12px;
  padding: 10px 15px;
  border: none;
  border-radius: 5px;
  text-align: center;
  font-weight: 600;
  cursor: pointer;
  user-select: none;
}
.gbbFooterBackButton{
  background: grey;
  color: #ffff;
}
.gbbFooterBackButton:active {
  transform: scale(0.95);
}
.gbbFooterNextButton {
  color: #000;
  background: #000000;
  color: #ffffff;
  grid-column: 2 /-1;
}

.gbbFooterNextButton:active {
  transform: scale(0.95);
}

.gbbFooterTotalContainer{
  text-align: right;
}
.gbbFooterProductQtyPriceContainer, .gbbCartModalProductQtyPriceContainer{
  display: flex;
  gap: 5px;
}
.gbbCartModalProductTitleQty{
  display: grid;
  justify-content: start;
  width: unset;
}
.gbbCartModalProductQuantity{
  justify-self: start;
}
.gbbAddedToCartText{
  position: absolute;
  top: 5%;
  left: 5%;
  background: black;
  color: #ffff;
  padding: 0 4px;
  border-radius: 5px;
  font-size: 12px;
}
.gbbViewProductsLabelAndTotalContainer{
  display: grid;
  grid-template-columns: 1fr 0.4fr;
}
.gbbCartProductsContainerModal{
  display: grid;
  grid-gap: 10px;
}
.gbbAddProductsPageHTML .gbbProductsFilterContainer, .gbbChooseGiftBoxPageHTML .gbbProductsFilterContainer, .gbbPrecuratedBoxPageHTML .gbbProductsFilterContainer{
  /* margin-top: 120px; */
}

.gbbLoadMoreProductsButton{
  text-align: center;
  margin: 20px;
  padding: 10px;
  border: 1px solid black;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
}
.gbbProductAllImagesContainer{
  display: none;
  max-height: 200px;
}
.gbbProductVariantModalImageTitleContainer{
  display: grid;
  grid-gap: 15px;
}
.gbbProductTileImageContainer{
  display: grid;
  justify-items: center;
  align-items: center;
}


@media (min-width:600px){

  .gbbProductsItemsContainer{
      grid-template-columns: repeat(3,1fr);
   
  }
  /* .gbbProductItem{
      grid-template-rows: 3fr 0.8fr 0.8fr;
  } */
  .gbbProductImageContainerImg{
      max-height: 180px;
  }
  
  .gbbAddProductsPageNavigationContainer,.gbbPersonalizePageNavigationContainer,.gbbChooseGiftBoxPageNavigationContainer{
  }
  .gbbAddProductsPageNavigationContainer, .gbbChooseGiftBoxPageNavigationContainer, .gbbPersonalizePageNavigationContainer{
      /* transform: translate(0px, -35%); */
  } 
  .gbbProductTextContainer, .gbbProductItemPrice,.gbbProductDynamicContentContainer{
      font-size: 14px;
  }
  .gbbProductCardTextContainer > div{
      font-size: 18px;
  }
  .gbbProductActionContainer{
      display: grid;
      grid-template-columns: auto auto;
      justify-content: space-between;
      grid-gap: max-content;
      width: 100%;
  } 
  .gbbProductsFilterTagsContainer{
  }
  .gbbAddedToCartText{
      font-size: 14px;
  }
  .gbbAddProductsPageHeader, .gbbChooseGiftBoxPageHeader{
  }
  .gbbProductsFiltersContainerLabel{
      font-size: 20px;
  }
  .gbbFiltersMainButtonWrapper{
      font-size: 18px;
  }
  .gbbSortByDropDownSelect{
      font-size: 18px;
  }
  .gbbFiltersMainButtonWrapper{
      justify-self: start;
      padding: 5px 20px;
  }
  .gbbSortByDropDownContainer{
      justify-self: end;
  }
  .gbbProductsFiltersClearLabel{
      font-size: 14px;
  }
  .gbbProductVariantModalBodyContainer{
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      align-items: center;
      grid-gap: 15px;
  }
  .gbbProductVariantModalDetailsContainer{
      display: grid;
      grid-gap: 20px;
  }
  .gbbProductVariantOptionsContainer{
      display: grid;
      grid-gap: 15px;
  }
  .gbbProductVariantOptionLabel, .gbbProductQuantityHeading{
      font-weight: bold;
      font-size: 16px;
  }
  .gbbProductVariantOptionValue{
      font-size: 16px;
  }
  .gbbProductVariantAddButton{
      /* width: 50%; */
  }
  .gbbProductDescriptionText{
      max-height: 150px;
  }
  .gbbProductAllImagesContainer{
      display: grid;
      grid-gap: 5px;
      grid-auto-columns: min-content;
      grid-template-columns: repeat(4, 1fr);
      overflow-y: auto;
  }
  .gbbProductTileImageContainer{
      object-fit: contain;
  }
  .gbbProductTileImage {
      max-height: 70px;
  }
}
/* @media (min-width:768px) and (max-widthx:1023px){
  .gbbAddProductsPageNavigationContainer, .gbbChooseGiftBoxPageNavigationContainer{
      transform: translate(0px, -55%);
  }    
} */
@media (min-width:1024px){
  .gbbProductVariantModalContainer{
      top: 40vh;
      left: 50vw !important;
      transform: translate(-50%, -50%);
      margin: 10vh 0;
      height: unset;
      grid-gap: 15px;
      max-height: 95vh;
  }
  .gbbProductImageContainerImg{
      max-height: 200px;
  }

  .gbbPrevImage,.gbbNextImage{
      font-size: 20px;
  }

  .gbbProductItem:hover {
      box-shadow: 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
  }

  .gbbProductItem{
      grid-template-rows: 3fr 0.8fr 0.8fr;
  }

  .gbbProductImageContainer{
      /* width: 235px;
      height: 235px; */
  }
  .gbbProductsLabel{
      margin: 0 10px;
      font-size: 18px;
      margin-bottom: 20px;
  }
  .gbbPageBannerImage{
      width: 100%;
      height: 10vw;
  }
  .gbbProductButton{
      padding: 10px;
  }
  .gbbFooterProductTextContainer{
      width: 150px;
      font-size: 12px;
  }
  .gbbFooterProductTitle{
      width: 150px;
  }
  .gbbFooterProductImage{
      /* min-height: 50px;
      max-width: 50px; */
  }
  .gbbFooterBackButton, .gbbFooterNextButton {
      font-size: 14px;
  }
  .gbbFooterTotalValue{
      font-size: 16px;
  }
  .gbbFooterTotalContainer{
      text-align: right;
  }
  .gbbFooterProductsContainer{
      grid-gap: 0;
  }
  .gbbProductsFilterContainer{
      margin: 0 20px;
      cursor: pointer;
      /* margin-top: 80px; */

  }
  .gbbChooseGiftBoxPageHTML .gbbProductsFilterContainer{
      /* margin-top: 0 !important; */
  }
  .gbbProductsFilterButton{
      color: #796c6c;
      padding: 10px 15px;
      font-size: 16px;
      border: none;
      background: #f1f2f3;
      font-weight: 500;
      font-weight: bold;
      margin: 10px 0;
      border-radius: 5px;
      cursor: pointer;
  }
  .gbbProductsFilterTagsContainer{
      /* width: min-content; */
      
  }
  .gbbFilterTagContainer{
      /* padding: 0 10px; */
      background: #f1f2f3;
      border-radius: 5px;
      /* display: grid;
      grid-auto-flow: column;
      grid-gap: 10px;
      height: min-content; */
  }
  .gbbFilterTagText{
      color: black;
      padding: 5px 10px;
  }
  .gbbFilterTagRemoveSymbol{
      font-size: 14px;
      align-self: center;
  }
  .gbbProductsFilterTagsContainer{
      padding: 20px;
      border-radius: 5px;
  }
  .gbbPrevImage,.gbbNextImage{
      width: 5px;
  }
  .gbbAddProductsPageNavigationContainer, .gbbChooseGiftBoxPageNavigationContainer, .gbbPersonalizePageNavigationContainer{
      /* transform: translate(0px, -40%); */
  }  
  .gbbProductTextContainer, .gbbProductItemPrice, .gbbProductCardTextContainer,.gbbProductDynamicContentContainer{
      font-size: 14px;
  }

  .gbbProductDynamicContentContainer{
    font-weight: 600;
  }

  .gbbChooseGiftBoxPageHeader{
  }
  .gbbAddProductsPageHeader {
  }
  .gbbProductsFiltersContainer{
      background: white;
      width: 25%;
  }
  .gbbConditionNotificationToast{
      width: max-content;
  }
}
@media(min-width:1192px){
  .gbbProductsItemsContainer{
      grid-template-columns: repeat(4,1fr);
  }
  .gbbProductImageContainerImg{
      max-height: 240px;
  }
  .gbbLoadMoreProductsButton{
      border: none;
      border-bottom: 1px solid black;
  }
}

@media(min-width:1600px){
  .gbbProductsItemsContainer{
      grid-template-columns: repeat(5,1fr);
  }
  
}

@media(min-width:1920px){
  .gbbProductsItemsContainer{
      grid-template-columns: repeat(6,1fr);
  }
}

@media(min-width:2560px){
  .gbbProductsItemsContainer{
      grid-template-columns: repeat(8,1fr);
  }
}

@media(min-width:3840px){
  .gbbProductsItemsContainer{
      grid-template-columns: repeat(12,1fr);
  }
}

@media(min-width: 1023px){

  .gbbProductItemOverLay{
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex !important;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
    cursor: pointer;
  }
  
  
  .gbbOverLayIconContainer{
    display: block !important;
    width:100%;
    height: 100%;
    background-image: url("https://d3ks0ngva6go34.cloudfront.net/storefront/overlay-image.svg");
    background-repeat: no-repeat;
    background-size: 25%;
    background-position: center;
  }


  /* .gbbProductItem:hover .gbbProductItemOverLay{
    opacity: 0.8;
    display: flex !important;
  } */

  .gbbProductImageContainer:hover .gbbProductItemOverLay{
    opacity: 0.8;
    display: flex !important;
  }
}


.gbbProductFormText{
  margin: 0px;
  padding: 10px 18px;
  width: 100%;
  background-color: #ffffff;
  color: #000000;
  max-width: 100%;
  line-height: 1.2;
  border-radius: 2px;
  padding-bottom: 10px;
  border: 1px solid #A2A2A2;
  font-size: 14px !important;
}

.gbbProductVariantModalContainerWithPersonalization .gbbProductDescriptionContainer{
  display: none;
}

.gbbRequiredFieldMessage{
    color: red;
    margin: 0;
    padding: 0;
    font-size: 12px;

}

.gbbProductFormTextCharacterCount {
  font-size: 12px;
  color: #8c8c8c;
  text-align: end;
  grid-column: 2/-1;
}
.gbbProductFormValidationContainer{
  display: grid;
  grid-template-columns: 1fr 1fr;
}


/* For the main list container */
/* .gbbProductFormImageSelectorListContainer {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  grid-gap: 10px;
} */

/* For individual list items within the list container */
.gbbProductFormImageSelectorListItems {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
}

/* For the label element */
.gbbProductFormImageSelectorListLabel {
  width: 100%;
  height: 125px;
  position: relative;
  cursor: pointer;
  display: inline-block;
  align-self: center;
}

/* For individual list items */
.gbbProductFormImageSelectorListItem {
  position: relative;
}

/* For the input (radio button) element */
.personalizationImageInput {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  visibility: hidden;
}

/* For the image element */
.personalizationImage {
  width: 100%;
  height: auto;
  height: 100%;
}

.gbbActiveImageSelectorListItem{
  border: 1px solid #000000;
  opacity: 0.5;
  padding : 10px;
  padding : 5px;
}

.gbbProductFormContainer{
  display: grid;
  grid-gap: 10px;
}

.gbbPersonalizationImageCaption {
  position: absolute;
  bottom: 5%;
  width: 100%;
  opacity: 0;
  background-color: rgba(0,0,0,0.5);
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: opacity 0.5s;
  cursor: pointer;
  font-size: 1.5rem;
  font-weight: bold;
  text-align: center;
}

.gbbActiveImageSelectorListItem .gbbPersonalizationImageCaption{
  opacity: 0;
  padding: 10px;
}


.gbbProductFormRadioListItems{
  display: flex;
  gap: 20px;
}

.personalizationRadioLabel{
  padding-left: 5px;
}

/* =============== NEW PRODUCT CARD DESIGN ============== */
.gbbProductsCardLayoutV2 .gbbProductTextContainer,.gbbProductsCardLayoutV2 .gbbProductItemPricesContainer{
  text-align: center;
}
.gbbProductsCardLayoutV2 .gbbProductActionContainer{
  grid-template-columns: 1fr;
  padding: 0px;
  grid-template-rows: .5fr 45px;
  place-self: end;
}
.gbbProductsCardLayoutV2 .gbbProductItemPricesContainer{
  display: grid;
  grid-template-columns: auto auto;
  justify-self: center;
  gap:10px;
}
.gbbProductsCardLayoutV2 .gbbProductItem{
  background: white;  
  padding: 8px;
  grid-gap: 5px;
  border-radius: 12px;
  border: 1px solid #E3E3E3;
}
.gbbProductsCardLayoutV2 .gbbProductItem:has(.gbbReviewStarsContainer){
    grid-template-rows: min-content;
}
.gbbProductsCardLayoutV2 .gbbProductItem:not(:hover){
  box-shadow: none;
}
.gbbProductsCardLayoutV2 .gbbProductImageContainer{
  border-radius: 8px;
  overflow: hidden;
}
.gbbProductsCardLayoutV2 .gbbProductQuantityHTML,.gbbProductVariantModalLayoutV2 .gbbProductQuantityHTML{
  height: 100%;
  padding: 5px;
  border-radius: 9px;
  place-items: center;
  background: #eeeeee;
}
.gbbProductsCardLayoutV2 .gbbProductTitleOnly{
  font-weight: bold;
    font-size: 18px;
    line-height: 22px;
}
.gbbProductsCardLayoutV2 .gbbFooterButtonsWrapper{
      grid-template-columns: .5fr 1fr .5fr;
        width: 100%;
}
.gbbProductsCardLayoutV2 .gbbDiscountMessage{
  font-weight: bold;
}
.gbbProductsCardLayoutV2 .gbbFooterButtonsContainer{
  display: grid;
    justify-items: center;
    background: #f6f6f6;
    padding: 8px;
    border-radius: 12px;
}
.gbbProductsCardLayoutV2 .gbbFooterTotalContainer{
    display: grid;
      grid-template-columns: repeat(2, min-content);
      align-items: center;
      grid-gap: 10px;
      font-weight: bold;
      place-content: center;
}
.gbbProductsCardLayoutV2 .gbbFooterTotalValueContainer{
  justify-content: start;
}
.gbbProductsCardLayoutV2 .gbbFooterBackButton{
  color: black ;
    border: 2px solid black;
    background: white ;
}
.gbbProductsCardLayoutV2 .gbbFooterNextButton{
  grid-column: 3;
}
.gbbProductsCardLayoutV2 .gbbProductsFooterHTML{
  grid-template-columns: 1fr;
  padding: 10px 0px;
  grid-gap: 8px;
}
.gbbProductsCardLayoutV2 .gbbDiscountFooterHTML{
  padding-top: 5px;
}
.gbbDiscountFooterHTML:has(.progressBarContainer) {
  display: grid;
  grid-gap: 10px;
}
.gbbProductsCardLayoutV2 .gbbDiscountMessageContainer{
      display: grid;
        grid-template-columns: repeat(2, max-content);
        place-content: center;
        grid-gap: 10px;
        align-items: center;
        /* cursor: pointer; */
}
.gbbProductsCardLayoutV2 .gbbProductAddButton{
  border-radius: 10px;
  font-weight:  bold;
}

.gbbProductsCardLayoutV2 .gbbShowBoxProductsToggle{
  height: 25px;
}
.gbbProductsCardLayoutV2 .gbbShowBoxProductsToggleContainer{
  display: flex;
  align-items: center;
}
.gbbProductsCardLayoutV2 .gbbShowBoxProductsToggleContainer>svg{
  height: 30px;
  width: 30px;
}
.gbbProductsCardLayoutV2 .gbbProductQuantityRemoveButton,.gbbProductsCardLayoutV2 .gbbProductQuantityAddButton{
        border-radius: 6px;
        width: 100%;
}
.gbbProductsCardLayoutV2 .gbbProductQuantityAddButtonWrapper,.gbbProductsCardLayoutV2 .gbbProductQuantityRemoveButtonWrapper{
  top: 50%;
  left: 50%;
}
.gbbProductsCardLayoutV2 .showBoxProductsInFooter{
  display: grid;
  grid-template-columns: repeat(2, max-content);
  justify-content: center;
  align-items: center;
  cursor: pointer;
  grid-gap: 10px;
  padding-top: 5px;
}
/* .gbbProductsCardLayoutV2 .gbbFooterProductsContainer{
  display: none;
} */
 .gbbProductsCardLayoutV2 .gbbFooterTotalLabel{
  font-size: 16px;
 }
 .gbbProductsCardLayoutV2 .gbbPageFooterHTML{
  width: 80%;
 }
 .gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbFooterButtonsWrapper{
  grid-template-columns: .5fr 1.5fr .5fr;
  grid-gap: 10px;
 }
 .gbbProductsCardLayoutV2 .gbbAddProductsPageFooterHTML, .gbbProductsCardLayoutV2 .gbbPersonalizePageFooterHTML{
  display: grid;
  justify-items: center;
  z-index: 2;
 }
.gbbAddProductsPageFooterHTML{
  border-top: 1px solid #E3E3E3;
 }
.progressBarContainer {
      display: flex;
        justify-content: center;
 }
.progressBar {
        background-color: #C1E7C5;
        height: 7px;
        border-radius: 25px;
        overflow: hidden;
        width: 80%;
 }
.gbbProductsCardLayoutV2 .progressBar{
width: 100%;
}
.progressBarFill {
        height: 100%;
        width: 0%;
        background-color: #4caf50;
        transition: width 1s;
        /* animation: fillAnimation 2s forwards; */
        display: block !important;
 }
 .gbbProductsCardLayoutV2 .gbbFooterOriginalTotalValue{
  grid-column: 2;
 }
 .gbbProductsCardLayoutV2 .gbbFooterBackButton, .gbbProductsCardLayoutV2 .gbbFooterNextButton{
  border-radius: 5px;
  font-weight: bold;
 }
 .gbbProductsCardLayoutV2 .gbbOverLayIconContainer{
  background-image: url("https://d3ks0ngva6go34.cloudfront.net/storefront/magnifier_new.svg");
 }
 .gbbProductsCardLayoutV2 .gbbProductItemPrice,
 .gbbProductsCardLayoutV2 .gbbProductItemCompareAtPrice {
   font-size: 16px !important;
   font-weight: bold;
 }
  .gbbProductsCardLayoutV2 .gbbProductItem:hover {
    box-shadow: 0 14px 28px rgba(0, 0, 0, 0.12), 0 10px 10px rgba(0, 0, 0, 0.12);
  }
  .gbbProductsCardLayoutV2 .gbbProductTextContainer{
    padding: 0px;
  }
  .gbbProductsCardLayoutV2 .gbbProductItem .gbbReviewStarsContainer{
    text-align: center;
  }
  .gbbProductVariantModalContainer .gbbReviewStarsContainer{
    font-size: 13px;
  }

 @media (max-width: 900px){
  .gbbProductsCardLayoutV2 .gbbPageFooterHTML{
    width: 100%;
  }
  .gbbProductsCardLayoutV2 .gbbDiscountMessageContainer{
    display: flex;
  }
  .gbbProductsCardLayoutV2 .gbbDiscountMessage,.gbbProductsCardLayoutV2 .gbbFooterTotalContainer{
    font-size: 14px;
  }
  .gbbProductsCardLayoutV2 .gbbProductTitleOnly {
  font-size: 14px;
    line-height: 18px;
  }
  .gbbProductsCardLayoutV2 .gbbProductItemPrice,
    .gbbProductsCardLayoutV2 .gbbProductItemCompareAtPrice {
    font-size: 14px !important;
  }
  .gbbProductsCardLayoutV2 .gbbProductAddButton{
    font-size: 12px;
  }
  .gbbProductsCardLayoutV2 .gbbProductItem{
    grid-gap: 8px;
  }
 }
.gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbFooterProductsContainer {
    display: grid;
      max-height: 60vh;
      overflow-y: auto;
      grid-template-columns: 1fr;
      grid-auto-columns: unset;
      grid-auto-flow: unset;
          padding-top: 5px;
}
.gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbFooterProductContainer {
  grid-template-columns: 65px 1fr;
  align-items: center;
  padding: 0px;
}
.gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbFooterProductImageContainer {
  height: 60px;
    width: 65px;
  border-radius: 8px;
}
.gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbFooterProductImage{
  height: 100%;
  object-fit: contain;
  width: 100%;
}
.gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbFooterProductRemoveButton {
    align-items: center;
      position: absolute;
      cursor: pointer;
      top: 0;
      height: 15px;
      display: flex;
}
.gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbFooterProductTextContainer{
  width: 100%;
  overflow: auto;
}
 .gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbFooterProductTitle{
  font-size: 14px;
  width: 100%;
}
 .gbbProductsCardLayoutV2 .gbbCartIconWithQuantityContainer {
  position: absolute;
  left: 50%;
  transform: translate(-50%, -50%);
  top: 0px;
  display: flex;
    padding: 0px 10px;
    border-radius: 10px;
    font-size: 14px;
    align-items: center;
 }
/* .gbbProductsCardLayoutV2 .gbbProductsFooterHTMLForMobile .gbbCartIconWithQuantityContainer {
  display: flex;
  padding: 0px 10px;
  border-radius: 10px;
  font-size: 14px;
  align-items: center;
} */
.gbbProductsCardLayoutV2 .gbbCartIconWithQuantityContainer>svg {
 height: 20px;
}
/* .gbbProductsCardLayoutV2 .gbbProductsFooterHTML.gbbProductsFooterHTMLForMobile {
  padding: 0px;
} */
/* NEW VARIANT MODAL */
.gbbProductVariantModalLayoutV2 .gbbProductItemPricesContainer {
  display: grid;
  grid-template-columns: repeat(2,max-content);
  align-items: center;
  gap: 5px;
}
.gbbProductVariantModalLayoutV2 .gbbProductItemCompareAtPrice{
  grid-column: -1;
  grid-row: 1;
}
.gbbProductVariantModalLayoutV2 .gbbProductItemPrice{
  grid-column: 1;
  grid-row: 1;
}
.gbbProductVariantModalLayoutV2 .gbbProductQuantityHTMLContainer{
  grid-template-columns: .8fr 1.5fr;
  align-items: center;
}
.gbbProductVariantModalLayoutV2 .gbbProductQuantityAddButton,
.gbbProductVariantModalLayoutV2 .gbbProductQuantityRemoveButton{
  width: 55px;
  height: 30px;
}
.gbbProductVariantModalLayoutV2 .gbbProductQuantityAddButtonWrapper,
.gbbProductVariantModalLayoutV2 .gbbProductQuantityRemoveButtonWrapper{
  top: 50%;
  left: 50%;
}
.gbbProductVariantModalLayoutV2 .gbbProductCardTextContainer{
  display: grid;
    grid-gap: 5px;
}
.gbbProductVariantModalLayoutV2 .gbbProductDescriptionText{
  scrollbar-width: thin;
}
.gbbProductVariantModalLayoutV2 .gbbProductItemTitle{
  font-size: 20px;
}
.gbbProductVariantModalLayoutV2 .gbbProductItemCompareAtPrice{
  font-size: 15px;
}
.gbbProductVariantModalLayoutV2 .gbbProductItemPrice{
  font-size: 16px;
}
.gbbProductVariantModalLayoutV2 .gbbNextBtnContainer,.gbbProductVariantModalLayoutV2 .gbbPrevBtnContainer{
      background: #eeee;
        display: grid;
        place-items: center;
        cursor: pointer;
}
.gbbProductVariantModalLayoutV2 .gbbNextBtnContainer{
  border-bottom-left-radius: 6px;
    border-bottom-right-radius: 6px;
}
.gbbProductVariantModalLayoutV2 .gbbPrevBtnContainer {
  border-top-left-radius: 6px;
  border-top-right-radius: 6px;
}
.gbbProductVariantModalLayoutV2 .gbbProductImageContainerImg{
  border-radius: 10px;
}
.gbbProductVariantModalLayoutV2 .gbbProductTabImageContainer ,.gbbProductVariantModalLayoutV2 .gbbProductTabImageContainer img{
  border-radius: 8px;
}
.gbbProductVariantModalLayoutV2 .gbbProductCardActionContainer{
grid-template-columns: 1fr;
grid-gap: 0px;
}
.gbbProductVariantModalLayoutV2 .gbbProductVariantModalContainer{
  border: none;
}
.gbbProductVariantModalContainer.gbbVariantInventoryNotAvailable .gbbProductVariantAddButton{
  pointer-events: none;
  opacity: 0.5;
}
.gbbInventoryText{
  font-style: italic;
  font-size: 14px;
}

@media (max-width:430px) {
  .gbbProductsCardLayoutV2 .gbbProductItemPricesContainer{
    grid-template-columns: 1fr;
    gap: 0px;
  }
 
}
@media (max-width:330px) {
  .gbbProductsItemsContainer{
      grid-template-columns: repeat(1,1fr);
    }
}

@media screen and (min-width: 1800px) {
  .gbbProductImageContainer img {
    object-fit: contain;
  }
}
/* @media (min-width: 486px) {
.gbbProductsItemsContainer[data-total-products="1"],
  .gbbProductsItemsContainer[data-total-products="2"],
  .gbbProductsItemsContainer[data-total-products="3"],
  .gbbProductsItemsContainer[data-total-products="4"] {
    display: flex;
    justify-content: center;
  } -- not using this block
.gbbProductsItemsContainerLessProducts{
  display: flex;
  justify-content: center;
}
  .gbbProductsItemsContainerLessProducts .gbbProductTitleOnly {
    word-wrap: break-word;
    max-width: 240px;
  }

  .gbbProductsItemsContainerLessProducts .gbbProductItem {
    min-width: 250px;
  }
} */

/* SLOTS */
.gbbSlotFooterProductsContainer {
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: min-content;
  grid-gap: 10px;
  padding: 5px 0px;
  overflow-x: auto;
  overflow-y: hidden;
  /* place-content: center; */
}
.gbbSlotFooterProductContainer {
      position: relative;
      height: 70px;
      width: 75px;
      border-radius: 8px;
      display: grid;
      place-content: center;
}
img.gbbSlotFooterProductImage {
  height: 100%;
  object-fit: contain;
  width: 100%;
}
.gbbSlotFooterProductImageContainer {
        height: 70px;
        width: 75px;
        margin: 0;
            border: 1px solid #cfc9c9;
              overflow: hidden;
              border-radius: 8px;
}
.gbbSlotFooterProductContainerEmpty {
  border: 1px dashed;
  background: #f1f1f1;
}
.gbbSlotFooterProductQuantity {
  position: absolute;
  bottom: 5%;
  font-size: 12px;
  right: 2%;
  background: black;
  color: white;
  padding: 0px 10px;
  border-radius: 10px;
}
.gbbSlotFooterProductRemoveButton{
  align-items: center;
  position: absolute;
  cursor: pointer;
  top: 0;
  /* right: -5px; */
  height: 15px;
  display: flex;
}
.gbbSlotFooterProductsContainerWrapper {
  display: grid;
  justify-content: center;
}
  .gbbProductsFooterHTMLForMobile .gbbSlotFooterProductContainer ,
  .gbbProductsFooterHTMLForMobile .gbbSlotFooterProductImageContainer{
    height: 60px;
    width: 65px;
  }
  .gbbProductsFooterHTMLForMobile .gbbSlotFooterProductQuantity {
    font-size: 10px;
}
.gbbDiscountRibbon {
  background: red;
  color: white;
  font-weight: bold;
  width: fit-content;
  padding: 2px 8px;
  position: absolute;
  top: 25px;
  right: 0;
  font-size: 12px;
}/***************************************************Landing page CSS*******************************************************************/
* {
  margin: 0;
  padding: 0;
}
.gbbReviewPageHTMLContent {
  display: grid;
  grid-gap: 20px;
}
/* review page banner css */
.gbbReviewPageBanner {
  display: grid;
  position: relative;
}
.gbbReviewPageBannerImage {
  display: grid;
  object-fit: cover;
  width: 100%;
  /* width: 100vw; */
  height: 40vw; /*20vw for desktop*/
}
.gbbReviewPageBannerText {
  font-size: 14px;
  /* color: #fff; */
}
.gbbReviewPageBannerSubText {
  font-size: 12px;
  /* color: #fff; */
}
.ReviewPageBannerButton {
  padding: 10px;
  font-size: 12px;
  width: 100%;
  border-radius: 8px;
  border: 2px solid #ffff;
  cursor: pointer;
}
.gbbReviewPageBannerTextWrapper {
  /* position: absolute; */
  top: 55%;
  left: 8%;
  /* top: 20%;
    left: 10%; */
  width: max-content;
  display: grid;
  grid-template-rows: 0.2fr 0.4fr;
  grid-gap: 10px;
  grid-gap: 5px;
  justify-items: center;
  text-align: center;
  width: 70vw;
  padding: 10px;
}

.gbbReviewPageBodyContainer {
  display: grid;
  justify-self: center;
  width: 95%;
}

.gbbReviewPageTotalBlock {
  display: grid;
  grid-auto-flow: column;
  grid-template-columns: auto auto 2fr;
  border-radius: 5px;
  color: #000;
}
.gbbReviewPageTotalBlockPrice {
  display: grid;
  justify-self: center;
  align-self: center;
  padding: 5px 5px;
}
.gbbReviewPageTotalBlockPriceTitle {
  font-size: 12px;
}

.gbbReviewPageTotalBlockPriceValue {
  font-weight: 700;
}
.gbbReviewPageTotalBlockDelivery {
  display: grid;
  justify-self: center;
  align-self: center;
  padding: 5px 5px;
}
.gbbReviewPageTotalBlockDeliveryTitle {
  font-size: 12px;
}
.gbbReviewPageTotalBlockDeliveryTitleValue {
  font-weight: 700;
}

.gbbReviewPageTotalBlockActions {
  display: grid;
  /* grid-template-columns: 1fr auto auto; */
  grid-template-columns: 1fr 1fr;
  grid-auto-flow: column;
  justify-items: end;
  grid-gap: 5px;
  /* padding: 5px 5px; */
  margin-top: 10px;
  justify-items: right;
  align-items: center;
}

.gbbReviewPageTotalBlockActionsBack {
  background-color: grey;
  padding: 5px 10px;
  text-align: center;
  color: #fff;
  border-radius: 5px;
  justify-self: left;
  font-size: 12px;
  cursor: pointer;
}

.gbbReviewPageTotalBlockActionsCheckout {
  padding: 5px 10px;
  text-align: center;
  color: #000;
  border-radius: 5px;
  font-size: 12px;
  cursor: pointer;
  width: 100%;
  font-weight: 500;
}
.gbbReviewPageProductList {
  /* padding-top: 20px; */
}
.gbbReviewPageProductListItems {
  display: grid;
  margin: 10px 0px;
  /* padding: 0px 10px; */
  border-top: 2px solid #f1f2f3;
  border-bottom: 2px solid #f1f2f3;
}
.gbbReviewPageProductListItem,
.gbbReviewPageProductItemsHeaders {
  display: grid;
  grid-auto-flow: column;
  grid-template-columns: 2fr 1fr 1fr;
}
.gbbReviewPageProductListItem {
  font-size: 12px;
}

.gbbReviewPageProductListItemName,
.gbbReviewPageProductItemsHeadersProduct,
.gbbReviewPageProductItemsHeadersQuantity,
.gbbReviewPageProductItemsHeadersPrice {
  padding: 5px 5px;
  font-weight: 600;
}
.gbbReviewPageProductItemsHeadersProduct {
  text-align: left;
}
.gbbReviewPageProductItemsHeadersQuantity {
  text-align: center;
}
.gbbReviewPageProductItemsHeadersPrice {
  text-align: right;
}
.gbbReviewPageProductListItemQty {
  padding: 5px 5px;
  text-align: center;
}
.gbbReviewPageProductListItemPrice {
  padding: 5px 5px;
  text-align: right;
  display: grid;
  grid-template-columns: max-content;
  justify-content: end;
}
.gbbReviewPageProductListItemRemoveBtn {
  padding: 5px 5px;
  font-size: 12px;
  justify-self: end;
  cursor: pointer;
  color: #aba6a6;
}
.gbbReviewPageProductListTitle {
  font-size: 15px;
  font-weight: 600;
}
/**********ADD ON PRODUCTS HTML ****/
.gbbReviewPageHTMLContent .gbbProductItem {
  /* width: auto; */
  display: grid;
  width: 140px;
  grid-template-rows: 90px 0.1fr 0.1fr;
  grid-gap: 5px;
}
.gbbReviewPageHTMLContent .gbbProductsContainer {
  overflow-x: auto;
  display: grid;
  justify-self: center;
}
.gbbReviewPageHTMLContent .gbbProductsItemsContainer {
  display: grid;
  grid-auto-flow: column;
  grid-template-columns: auto;
  grid-gap: 10px;
  overflow-x: auto;
}
.gbbReviewPageHTMLContent .gbbProductTextContainer {
  align-self: normal;
}
.gbbReviewPageHTMLContent .gbbProductItemTitle {
  color: black;
  white-space: nowrap;
  text-overflow: ellipsis;
  width: 120px;
  display: block;
  overflow: hidden;
}
.gbbReviewPageHTMLContent .gbbProductImageContainer {
  position: relative;
  width: 100%;
  height: 100%;
  border: 1px solid #cfc9c9;
  overflow: hidden;
}

.gbbReviewPageSubTotalCartWrapper {
  display: grid;
  grid-template-columns: 1fr 1fr;
}

.gbbReviewPageSubTotalCart {
  text-align: end;
  grid-column: 2/3;
}

.gbbReviewPageSubTotalCartLabel {
  display: grid;
  font-size: 14px;
  font-weight: 600;
  justify-content: end;
  grid-template-columns: max-content;
}
.gbbReviewPageHTMLContent .gbbProductQuantityRemoveButton,
.gbbReviewPageHTMLContent .gbbProductQuantityAddButton {
  height: 25px;
  width: 25px;
  font-size: 14px;
}
.gbbReviewPageHTMLContent .gbbProductActionContainer {
  grid-auto-flow: row !important;
  grid-gap: 10px !important;
}
.gbbReviewPageHTMLContent .gbbPrevImage,
.gbbReviewPageHTMLContent .gbbNextImage {
  padding: 0;
  width: 2px;
  margin-top: 0;
  top: 40%;
  background: none;
  color: grey;
}
.gbbReviewPageBodyContainer {
  margin: 20px;
}
.gbbReviewPageHTMLContent .gbbNextImage {
  right: 10px;
}
@media only screen and (min-width: 600px) {
  .gbbReviewPageProductListTitle {
    font-size: 20px;
  }
  .gbbReviewPageProductListItem {
    font-size: 15px;
  }

  .gbbReviewPageBannerImage {
    height: 22vw;
  }
  .gbbReviewPageBannerTextWrapper {
    /* width: 30vw;
        top: 15%; */
    width: 40vw;
    top: 50%;
    left: 20%;
  }
  .gbbReviewPageBodyContainer {
    width: 80%;
    margin: 20px;
  }
  .gbbReviewPageTotalBlockPrice {
    padding: 5px 20px;
  }
  .gbbReviewPageTotalBlockDelivery {
    padding: 5px 20px;
  }
  .gbbReviewPageTotalBlockActionsBack {
    font-size: 14px;
    /* grid-column: 2/2; */
  }

  .gbbReviewPageTotalBlockActionsCheckout {
    font-size: 16px;
    width: 80%;
    /* grid-column: 3/3; */
  }

  .gbbReviewPageTotalBlockActions {
    /* grid-template-columns: 2fr auto auto; */
    grid-template-columns: 1fr 1fr;
    grid-gap: 15px;
    /* padding: 5px 15px; */
    /* padding: 5px 5px; */
  }

  /* .gbbReviewPageHTMLContent .gbbProductItem{
        grid-template-rows: auto;
    } */
  .gbbReviewPageHTMLContent .gbbProductItem {
    display: grid;
    width: 170px;
    grid-template-rows: 110px 0.1fr 0.1fr;
    grid-gap: 5px;
  }
}

@media (min-width: 1023px) {
  .gbbReviewPageProductListItem {
    font-size: 16px;
  }
  .gbbReviewPageTotalBlockActionsBack {
    font-size: 16px;
  }

  .gbbReviewPageSubTotalCartLabel {
    font-size: 16px;
  }

  .gbbReviewPageDiscountAppliedLabel {
    font-size: 16px;
  }
  .gbbReviewPageTotalBlockActionsCheckout {
    font-size: 16px;
    width: 60%;
  }
  .gbbReviewPageBannerTextWrapper {
    width: 35vw;
  }
  .gbbReviewPageBannerImage {
    height: 18vw;
  }

  .gbbBodyWrapper {
    margin: 0 10%;
  }
  .gbbReviewPageBannerTextWrapper {
    /* grid-gap: 14px; */
    top: 55%;
    left: 20%;
  }
  .gbbReviewPageBannerText {
    font-size: 22px;
  }
  .gbbReviewPageBannerSubText {
    font-size: 15px;
    /* width: 45%; */
  }
  .gbbReviewPageBannerButtonWrapper {
  }
  .ReviewPageBannerButton {
    padding: 12px;
    font-size: 18px;
    width: 100%;
  }

  .gbbReviewPageTotalBlockActions {
    /* grid-template-columns: 3fr auto auto; */
    grid-template-columns: 1fr 1fr;
    grid-gap: 15px;
    margin-top: 10px;
    /* padding: 5px 15px; */
    /* padding: 5px 5px; */
  }

  .gbbReviewPageHTMLContent .gbbProductsItemsContainer {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  }

  .gbbReviewPageHTMLContent .gbbProductItem {
  }
}

@media (min-width: 1192px) {
  .gbbReviewPagePrecuratedBoxesLabel {
    font-size: 18px;
  }
  /* .gbbNavigationItemsContainer::before{
        top: 45px;
    } */
}

/* this  {is the css code */
.gbbBundleQuantityHTMLContainer {
  grid-template-columns: 0fr 0fr;
  grid-gap: 0px;
  display: grid;
  grid-auto-flow: column;
  -webkit-tap-highlight-color: transparent;
}

.gbbBundleChangeButton {
  padding-left: 9px;
  background: #51d5c7;
  border: none;
  border-radius: 5px;
  width: 35px;
  height: 35px;
  font-size: 24px;
  justify-self: center;
  cursor: pointer;
  position: relative;
  user-select: none;
}

.gbbBundleQuantityWrapper {
  width: 100%;
  display: flex;
  justify-content: end;
  flex-direction: row;
}

/* bundle from product */
.gbbBundleQuantityHTML {
  width: 100%;
  display: grid;
  grid-auto-flow: column;
  grid-gap: 15px;
  align-items: center;
}

.gbbBundleQuantityHeading {
  font-weight: bold;
  font-size: 14px;
}

.gbbBundleQuantityLabel {
  text-align: center;
  font-size: 16px;
  user-select: none;
}
.gbbSummaryPageHTML{
  margin-bottom: 100px;
}
.gbbSummaryPageBodyWrapper{
    display: grid;
    grid-gap: 10px;
}
.gbbSummaryPageBundleDetailsContainer{
    display: grid;
    grid-template-columns: 1fr 0.2fr;
    align-items: start;
}
.gbbSummaryPageBundleDetails{
    display: grid;
    grid-gap: 5px;
}
.gbbSummaryPageBundleDetailsHTML{
    display: grid;
    grid-template-columns: 0.1fr 1fr;
    grid-gap: 10px;
    padding: 10px;
    border:2px solid #f1f2f3;
    margin-bottom: 10px;
    /* grid-column: 1/3; */
}
.gbbSummaryPageBundleImage{
    width: 60px;
    height: 60px;
    object-fit: contain;
}
.gbbSummaryPageBundleImageContainer{
    display: grid;
    justify-content: center;
}
.gbbSummaryPageProductListItemName{
  color: #848484;
  font-weight: 600;
}
.gbbSummaryPageProductListItemName, .gbbSummaryPageProductQtyPriceContainer{
    /* padding: 5px 5px; */
    font-size: 12px;
    text-wrap: balance;

}

.gbbSummaryPageProductTitleQtyPriceContainer{
    display: grid;
    grid-template-columns: 1fr 0.2fr;
}
.gbbSummaryPageProductQtyPriceContainer{
    display: grid;
    grid-auto-flow: column;
    grid-gap: 10px;
    grid-template-columns: 1fr 1fr;
}
.gbbSummaryPageBundleQuantityAddButton{
    justify-self: right;
    -webkit-tap-highlight-color: transparent;
}
.gbbSummaryPageBundleQuantityRemoveButton{
    justify-self: left;
    -webkit-tap-highlight-color: transparent;
}
.gbbSummaryPageBundleQuantityAddButton:active, .gbbSummaryPageBundleQuantityRemoveButton:active {
    transform: scale(0.95);
}
.gbbSummaryPageQuantityAddButtonWrapper, .gbbSummaryPageQuantityRemoveButtonWrapper{
  position: absolute;
  top: 10px;
  left: 11px;
  transform: translate(-50%, -50%);
  -webkit-tap-highlight-color: transparent;
  user-select: none;
}
.gbbSummaryPageBundleQuantityAddButton, .gbbSummaryPageBundleQuantityRemoveButton{
    background: #000000;
    color:#ffffff;
    border: none;
    border-radius: 5px;
    width: 20px;
    height: 20px;
    font-size: 14px;
    justify-self: center;
    cursor: pointer;
    position: relative;
    user-select: none;
}
.gbbSummaryPageBundleQuantityAddButton{
  justify-self: right;
  -webkit-tap-highlight-color: transparent;
}
.gbbSummaryPageBundleQuantityRemoveButton{
  justify-self: left;
  -webkit-tap-highlight-color: transparent;
}
.gbbSummaryPageBundleQuantityAddButton{

}
.gbbSummaryPageBundleItemsLabel{
  font-size: 14px;
}
.gbbSummaryPageBundleTitle{
    font-size: 14px;
    font-weight: 700;
}
.gbbSummaryPageBundleQuantityContainer{
    display: grid;
    grid-template-columns: auto auto auto;
    grid-gap: 15px;
    align-items: center;
    width: 20px;
}
.gbbSummaryPageBundleQuantityText{
    text-align: center;
}
.gbbSummaryPageProductListItemPrice{
    font-weight: 600;
    justify-self: end;
}
.gbbSummaryPageProductListItemQty{
  justify-self: end;
}
.gbbOrderDetailsHTMl, .gbbSummaryPageSubscriptionHTML{
    padding: 15px;
    display: grid;
    grid-gap: 10px;
    background: #f1f2f3;
}
.gbbOrderDetailsHeading, .gbbScheduleDeliveryHeadingLabel{
    font-weight: 600;
}
.gbbSummaryPageSubTotalCart, .gbbSummaryPageDiscountAppliedContainer, .gbbSummaryPageTotalCartValueContainer{
    display: grid;
    grid-template-columns: 1fr 1fr;
}
.gbbSummaryPageSubTotalCartLabel, .gbbSummaryPageDiscountAppliedLabel, .gbbSummaryPageTotalCartValueLabel{
    font-weight: 600;
    color: #848484;
}
.gbbScheduleDeliveryDateLabel{
    font-weight: 600;
}
.gbbSummaryPageSubTotalValue, .gbbSummaryPageDiscountAppliedValue, .gbbSummaryPageTotalCartValue{
    justify-self: end;
    font-weight: 600;
}
.gbbSummaryPageBundleProductsMainContainer{
    /* display: grid; */
    /* align-items: center; */
    /* grid-column: span 2; */
    /* grid-column-start: 2; */
    white-space: nowrap;
}
.gbbSummaryPageBundleImageTitleContainer{
    display: grid;
    grid-template-columns: 0.2fr 1fr;
    align-items: center;
}
/* .gbbSummaryPageBundleProductsContainer{
    grid-column: 2;
} */
.gbbSummaryPageBundlePriceLabel{
    font-weight: 600;
    text-align: end;
    justify-self: end;
}
.gbbSummaryPageBundleRemoveButton{
    font-size: 14px;
    color: #ce6b6b;
    text-align: end;
    cursor: pointer;
}
.gbbSummaryPageBundlePriceContainer{
    display: grid;
    grid-template-columns: 1fr min-content;
    grid-gap: 5px;
}
.gbbSummaryPageBundleDiscountedPrice{
    font-weight: 600;
    justify-self: end;
}
.gbbSummaryPageActionButtons{
    display: grid;
    /* grid-template-columns: 0.4fr 1fr; */
    grid-gap: 10px;
}
.gbbSummaryPageBackButton{
    background-color: grey;
    padding: 10px;
    text-align: center;
    color: #fff;
    border-radius: 5px;
    font-size: 14px;
    cursor: pointer;
    border: none;
    display: grid;
    align-self: center;
}
.gbbSummaryPageCheckoutButton, .gbbSummaryPageCreateNewBoxButton, .gbbUnavailableProductsModalFooterBackBtn, .gbbUnavailableProductsModalFooterCheckoutBtn{
    padding: 10px 10px;
    text-align: center;
    color: #000;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
    width: 100%;
    font-weight: 500;
    background: black;
    color: white;
    border: none;
}
.gbbUnavailableProductsModalFooter{
  display: grid;
  grid-gap: 10px;
}
.gbbSummaryPageBanner {
    display: grid;
    position: relative;
  }
  .gbbSummaryPageBannerImage {
    display: grid;
    object-fit: cover;
    width: 100%;
    /* width: 100vw; */
    height: 40vw; /*20vw for desktop*/
  }
  .gbbSummaryPageBannerText {
    font-size: 14px;
    /* color: #fff; */
  }
  .gbbSummaryPageBannerSubText {
    font-size: 12px;
    /* color: #fff; */
  }
  .gbbSummaryPageBannerTextWrapper {
    /* position: absolute; */
    top: 55%;
    left: 8%;
    /* top: 20%;
      left: 10%; */
    width: max-content;
    display: grid;
    grid-template-rows: 0.2fr 0.4fr;
    grid-gap: 10px;
    grid-gap: 5px;
    justify-items: center;
    text-align: center;
    width: 70vw;
    padding: 40px 10px;
  }
  .gbbSummaryPageBannerText {
    font-size: 14px;
    /* color: #fff; */
  }
  .gbbSummaryPageBannerSubText {
    font-size: 12px;
    /* color: #fff; */
  }
  .gbbScheduleDeliveryWrapper{
    display: grid;
    grid-gap: 10px;
    padding: 15px;
    background: #f1f2f3;
  }
  .gbbSummaryPageDeliverOrderDetailsDiv{
    /* padding: 10px;
    background: #f1f2f3; */
  }
  .gbbSummaryPageBundleTitleContainer{
    display: flex;
    gap: 10px;
    align-items: center;
  }
  .gbbEmptySummaryPageWrapper{
    margin-bottom: 100px;
  }
  .gbbEmptySummaryPageWrapper, .gbbEmptySummaryPageBannerTextWrapper{
    display: grid;
    justify-content: center;
    align-items: center;
    grid-gap: 10px;
  }
  .EmptySummaryPageAction{
    text-align: center;
    padding: 10px;
    background: black;
    color: white;
    border-radius: 5px;
    cursor: pointer;
  }
  .gbbEmptySummaryPageBannerText{
    text-align: center;
  }
  .gbbEmptySummaryPageBannerImage{
    width: 250px;
    height: 250px;
    object-fit: contain;
  }
  .gbbOrderSubtotalTotalContainer{
    display: grid;
    /* grid-template-columns: 1fr 1fr; */
  }
  .gbbSummaryPageBundleQuantity{
    justify-self: end;
  }
  .gbbSummaryPageBundleItemsLabel{
    color: #848484;
  }
  .gbbSummaryPageBundleItemsLabel{
    display: none;
  }
  .gbbSummaryPageBundleDetailsWithProducts{
    display: grid;
    grid-template-rows: min-content;
    grid-gap: 10px;
    overflow-wrap: break-word;

  }

  .gbbFooterDiscountedTotalValue, .gbbFooterOriginalTotalValue, .gbbFooterTotalLabel {
    white-space: nowrap !important;
  }
  
  .gbbSummaryPageDiscountAppliedWrapper{
    display: grid;
    grid-gap: 10px;
  }
  .gbbSummaryPageOneTimeSubscriptionDiv, .gbbSummaryPageSubscriptionAndSaveInputAndLabel{
    display: grid;
    grid-template-columns: min-content 1fr;
    grid-gap: 10px;
    align-items: center;
  }
  .gbbSubscriptionDropDownSelect{
    width: 100%;
    padding: 8px 10px;
    border: 1px solid #cbc2c2;
    border-radius: 5px;
    border: 1px solid #D3D5D6;
  }
  .gbbSummaryPageSubscriptionAndSaveDiv{
    display: grid;
    grid-gap: 10px;
  }
  .gbbSummaryPageOneTimeSubscriptionInput, .gbbSummaryPageSubscriptionAndSaveInput{
    width: 15px;
  }
  .gbbSummaryPageSubscriptionAndSaveLabel, .gbbSummaryPageOneTimeSubscriptionLabel{
    cursor: pointer;
  }
  .gbbSubscriptionDeliveryFrequencyLabel{
    font-size: 12px;
    text-transform: uppercase;
  }
  /* .gbbSummaryPageCreateNewBoxButtonWrapper{
    padding: 5px 10px;
    width: fit-content;
    background: black;
    color: white;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    /* text-decoration: underline; 
    border-radius: 5px;
  }*/
  .gbbSummaryPageBundleEditButton{
    font-size: 14px;
    text-align: end;
    cursor: pointer;
    /* text-decoration: underline; */
    font-weight: bold;
  }
  .gbbSummaryPageBundleEditRemoveButtons{
    display: grid;
    grid-template-columns: 1fr 1fr;
    align-items: center;
    grid-gap: 10px;
  }
  .gbbPreparingBundleMainContainer, .gbbUnavailableProductsMainContainer, .gbbActivatePricingMainContainer{
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    top: 0;
    background-color: rgba(24,24,24,0.8);
    z-index: 1000000000;
  }
  .gbbPreparingBundleContainerModal{
    position: fixed;
    z-index: 1000000000;
    transform: translate(0, -50%);
    background: #ffff;
    border-radius: 5px;
    text-align: center;
    padding: 10px;
    max-height: 95vh;
    /* left: 5vw;
    top: 5vh;
    right: 5vw; */
    left: 25vw;
    right: 25vw;
    top: 50vh;
    display: grid;
    grid-gap: 10px;
    justify-content: center;
  }

  @media screen and (min-width: 600px) {
    .gbbPreparingBundleContainerModal{
      left: 35vw;
      right: 35vw;
    }
    
  }

  .gbbUnavailableProductsContainerModal{
    position: fixed;
    z-index: 1000000000;
    transform: translate(0, -50%);
    background: #ffff;
    border-radius: 5px;
    text-align: center;
    padding: 10px;
    max-height: 95vh;
    /* left: 5vw;
    top: 5vh;
    right: 5vw; */
    left: 20vw;
    right: 20vw;
    top: 50vh;
    display: grid;
    grid-gap: 10px;
  }
  .gbbPreparingBundleHeader{
    font-weight: 600;
    font-size: 14px;
  }
  .gbbPreparingBundleGif{
    width: 120px;
    max-width: 100%;
  }
  .gbbUnavailableProductsModalDiscountsMayNotApplyText{
    color: grey;
  }
  .gbbActivatePricingContainerModal{
    position: fixed;
    z-index: 1000000000;
    transform: translate(-50%, -50%);
    background: #ffff;
    border-radius: 5px;
    text-align: center;
    padding: 2rem 1rem;
    max-height: 95vh;
    left: 50%;
    top:50%;
    display: grid;
    grid-gap: 10px;
    width:300px;
  }
  .gbbActivatePricingImg{
    width:150px;
    height:150px;
  }
  .gbbActivatePricingHeader{
    font-weight: 600;
    font-size: 1.7rem;
    color:#8C4444;
    line-height:initial;
  }
  .gbbActivatePricingDescription{
    font-size: 1.3rem;
    font-weight:500;
    line-height:initial;
  }
  .gbbActivatePricingButton{
    background-color: #8C4444;
    color: #ffffff;
    border-radius:5px;
    padding:1rem 2.5rem;
    font-weight:550;
    cursor:pointer;
    border:none;
  }
  .gbbActivatePricingNoteContainer{
    font-size: 1.2rem;
  }
  .gbbActivatePricingPoweredByContainer{
    display:grid;
    justify-items:end;
    font-size: 1.1rem;
  }
  

@media (min-width: 600px) {
    .gbbSummaryPageBannerImage {
        height: 22vw;
      }
      .gbbSummaryPageBundleItemsLabel{
        display: block;
      }
      .gbbSummaryPageBannerTextWrapper {
        /* width: 30vw;
            top: 15%; */
        width: 40vw;
        top: 50%;
        left: 20%;
      }
    .gbbSummaryPageProductListItemName, .gbbSummaryPageProductQtyPriceContainer{
        font-size: 14px;
    }

    .gbbSummaryPageBundleTitle{
      font-size: 16px;
    }
    .gbbSummaryPageBundleImage{
      width: 100px;
      height: 100px;
    }
    .gbbSummaryPageBundleQuantityAddButton, .gbbSummaryPageBundleQuantityRemoveButton{
      width: 25px;
      height: 25px;
    }
    .gbbSummaryPageQuantityAddButtonWrapper, .gbbSummaryPageQuantityRemoveButtonWrapper{
      top: 12px;
      left: 13px;
    }
    .gbbSummaryPageOneTimeSubscriptionInput, .gbbSummaryPageSubscriptionAndSaveInput{
      width: 20px;
      height: 20px;
    }
    .gbbPreparingBundleGif{
      width: 150px;
    }
    .gbbActivatePricingContainerModal{
      width:500px;
    }
}
@media (min-width: 1023px) {
      .gbbSummaryPageBodyWrapper{
        margin: 0 20px;
      }
      .gbbSummaryPageBannerImage {
        height: 18vw;
      }
      .gbbSummaryPageBannerText {
        font-size: 22px;
      }
      .gbbSummaryPageBannerSubText {
        font-size: 15px;
        /* width: 45%; */
      }
      .gbbSummaryPageBannerTextWrapper {
        width: 35vw;
        top: 55%;
        left: 20%;
      }
      .gbbSummaryPageBannerText {
        font-size: 22px;
      }
      .gbbSummaryPageBannerSubText {
        font-size: 15px;
        /* width: 45%; */
      }
      .gbbSummaryPageBodyWrapper{
        grid-template-columns: 1fr 0.5fr;
    }
    .gbbSummaryPageBundleDetailsHTML{
        /* grid-row-start: 1;
        grid-row-end: span 2; */
    }
    .gbbSummaryPageDeliverOrderDetailsDiv{
        /* height: 100%; */
    }
    .gbbSummaryPageOrderDetailsUI{
        grid-column-start: 2;
    }
    .gbbSummaryPageBundlePriceContainer{
      /* grid-template-columns: 1fr 0.3fr; */
      grid-gap: 10px;
  }
  .gbbSummaryPageBundlePriceLabel{
    /* text-align: unset; */
  }
  .gbbPreparingBundleGif{
    width: 200px;
  }
  .gbbUnavailableProductsContainerModal{
    left: 30vw;
    right: 30vw;
  }
  .gbbUnavailableProductsModalFooter{
    grid-template-columns: 1fr 1fr;
  }
}
.gbbSummaryPageWrapper.gbbSubscriptionBundle .gbbSummaryPageCreateNewBoxButton {
  display: none;
  /*--- TEMP FIX ----*/
}

.gbbSummaryPageBundleSubscriptionDetails {
  font-size: 14px;
}
:root {
    --gbb-gbbSubscriptionBundle-purchase-option-active-color: #2B2B2B;
    --gbb-gbbSubscriptionBundle-purchase-option-active-bg-color: #FFFFFF;
    --gbb-gbbSubscriptionBundle-purchase-option-inactive-color: #888888;
    --gbb-gbbSubscriptionBundle-purchase-option-inactive-bg-color: #F0F0F0;
    --gbb-gbbSubscriptionBundle-purchase-option-stroke-radius: 8px;
    --gbb-gbbSubscriptionBundle-purchase-option-stroke-color: #D5D5D5;
    --gbb-gbbSubscriptionBundle-purchase-option-stroke-width: 2px;

    --gbb-gbbSubscriptionBundle-selling-plan-navigation-active-bg-color: #FFFFFF;
    --gbb-gbbSubscriptionBundle-selling-plan-navigation-active-title-color: #333333;
    --gbb-gbbSubscriptionBundle-selling-plan-navigation-inactive-title-color: #333333;

    --gbb-gbbSubscriptionBundle-page-title-color: #000000;
    --gbb-gbbSubscriptionBundle-page-title-font-weight: bold;
    --gbb-gbbSubscriptionBundle-header-bg-color: #EDEDED;

    --gbb-gbbSubscriptionBundle-selling-plan-navigation-next-prev-icon-bg-color: #2B2B2B;
    --gbb-gbbSubscriptionBundle-selling-plan-navigation-active-discount-pill-bg-color: #CAE983;
    --gbb-gbbSubscriptionBundle-selling-plan-navigation-active-discount-pill-text-color: #000000;
    --gbb-gbbSubscriptionBundle-selling-plan-navigation-inactive-discount-pill-text-color: #000000;
    --gbb-gbbSubscriptionBundle-selling-plan-navigation-inactive-discount-pill-bg-color: #9D9D9D;

    --gbb-gbbSubscriptionBundle-product-discount-ribbon-bg-color: #FF0000;
    --gbb-gbbSubscriptionBundle-product-discount-ribbon-text-color: #FFFFFF;

    --gbb-gbbSubscriptionBundle-subscription-frequency-label-text-color: #333333;
    --gbb-gbbSubscriptionBundle-subscription-frequency-label-font-weight: bold;
    --gbb-gbbSubscriptionBundle-selling-plans-navigation-stroke-color: #B7B7B7;
    --gbb-gbbSubscriptionBundle-selling-plans-navigation-stroke-width: 2px;
    --gbb-gbbSubscriptionBundle-selling-plans-navigation-stroke-radius: 10px;
}
.gbbPurchaseOptionsWrapper{
    display: grid;
    place-content: center;
    gap: 5px;
}
.gbbPurchaseOptionsTitle{
    color:var(--gbb-gbbSubscriptionBundle-subscription-frequency-label-text-color);
    text-align: center;
    font-weight: var(--gbb-gbbSubscriptionBundle-subscription-frequency-label-font-weight);
}
.gbbPurchaseOptionsButtonWrapper {
    display: grid;
    grid-template-columns: repeat(2, max-content);
    align-items: center;
    place-content: center;
}
.gbbPurchaseOption{
    padding: 6px 14px;
    font-weight: bold;
    text-transform: capitalize;
    cursor: pointer;
    /* border:var(--gbb-gbbSubscriptionBundle-purchase-option-stroke-width) solid var(--gbb-gbbSubscriptionBundle-purchase-option-stroke-color); */
    background-color: var(--gbb-gbbSubscriptionBundle-purchase-option-inactive-bg-color);
    color: var(--gbb-gbbSubscriptionBundle-purchase-option-inactive-color);
}
.gbbPurchaseOption {
    width: fit-content;
    position: relative;
    overflow: hidden;
    cursor: pointer;
    user-select: none;
    background-color: rgba(0, 0, 0, 0.16);
    color: rgba(255, 255, 255, 0.7);
    transition-timing-function: cubic-bezier(0.25, 0.8, 0.25, 1);
    transition-duration: 300ms;
    transition-property: color, background-color, box-shadow;
    display: flex;
    align-items: center;
    box-shadow: rgba(0, 0, 0, 0.15) 0px 2px 1px 0px inset, rgba(255, 255, 255, 0.17) 0px 1px 1px 0px;
    outline: none;
    justify-content: center;
}
.gbbPurchaseOption.active {
        background-color: #2d6737;
        color: white;
        box-shadow: rgba(0, 0, 0, 0.23) 0px -1px 1px 0px inset, rgba(255, 255, 255, 0.17) 0px -1px 1px 0px, rgba(0, 0, 0, 0.17) 0px 2px 4px 1px;
    }
.gbbPurchaseOption.active .gbbPurchaseOptionTextContent {
    transform: translateY(-2px);
}
.gbbPurchaseOption.active:hover {
    /* background-color: #34723f; */
    box-shadow: rgba(0, 0, 0, 0.26) 0px -1px 1px 0px inset, rgba(255, 255, 255, 0.17) 0px -1px 1px 0px, rgba(0, 0, 0, 0.15) 0px;
}
.gbbPurchaseOption:hover .gbbPurchaseOptionTextContent {
    transform: translateY(-2px);
}
.gbbPurchaseOption:hover {
    background-color: #2c2c2c;
    color: white;
    box-shadow: rgba(0, 0, 0, 0.23) 0px -1px 1px 0px inset, rgba(255, 255, 255, 0.17) 0px -1px 1px 0px, rgba(0, 0, 0, 0.17) 0px 2px 4px 1px;
}
.gbbPurchaseOption .gbbPurchaseOptionTextContent {
    font-size: 14px;
    font-weight: 600;
    pointer-events: none;
    transition-timing-function: cubic-bezier(0.25, 0.8, 0.25, 1);
    transition-duration: 300ms;
    transition-property: transform;
    transform: translateY(0px);
}

.gbbPurchaseOption:hover .gbbPurchaseOptionTextContent {
    transform: translateY(-2px);
}
.gbbPurchaseOption:first-child{
    border-top-left-radius: var(--gbb-gbbSubscriptionBundle-purchase-option-stroke-radius);
    border-bottom-left-radius: var(--gbb-gbbSubscriptionBundle-purchase-option-stroke-radius);
}
.gbbPurchaseOption:last-child{
    border-top-right-radius: var(--gbb-gbbSubscriptionBundle-purchase-option-stroke-radius);
    border-bottom-right-radius: var(--gbb-gbbSubscriptionBundle-purchase-option-stroke-radius);
}
.gbbPurchaseOption.active{
    background-color: var(--gbb-gbbSubscriptionBundle-purchase-option-active-bg-color);
    color: var(--gbb-gbbSubscriptionBundle-purchase-option-active-color);
}
.gbbSellingPlansNavigationTabsContainer {
        display: grid;
        grid-auto-flow: column;
        overflow-x: scroll;
        grid-auto-columns: 25%; /* make it dynamic width tabs */
        scrollbar-width: none;
}

.gbbSellingPlanNavigationDiscountText {
    font-size: 12px;
    background: var(--gbb-gbbSubscriptionBundle-selling-plan-navigation-inactive-discount-pill-bg-color);
    color: var(--gbb-gbbSubscriptionBundle-selling-plan-navigation-inactive-discount-pill-text-color);
    width: fit-content;
    padding: 2px 10px;
    border-radius: 12px;
}
.gbbSellingPlanNavigationTab.active .gbbSellingPlanNavigationDiscountText{
    background-color: var(--gbb-gbbSubscriptionBundle-selling-plan-navigation-active-discount-pill-bg-color);
    color: var(--gbb-gbbSubscriptionBundle-selling-plan-navigation-active-discount-pill-text-color);
}
.gbbSellingPlanNavigationTab {
    display: grid;
    place-content: center;
    text-align: center;
    cursor: pointer;
    position: relative;
    padding: 10px;
    place-items: center;
    border-top-left-radius: var(--gbb-gbbSubscriptionBundle-selling-plans-navigation-stroke-radius);
    border-top-right-radius: var(--gbb-gbbSubscriptionBundle-selling-plans-navigation-stroke-radius);
    border-bottom: var(--gbb-gbbSubscriptionBundle-selling-plans-navigation-stroke-width) solid var(--gbb-gbbSubscriptionBundle-selling-plans-navigation-stroke-color);
}

.gbbSellingPlansNavigationTitle{
    color: var(--gbb-gbbSubscriptionBundle-page-title-color);
    font-weight: var(--gbb-gbbSubscriptionBundle-page-title-font-weight);
}
.gbbSellingPlanNavigationTab.active {
    background-color: var(--gbb-gbbSubscriptionBundle-selling-plan-navigation-active-bg-color);
    border: var(--gbb-gbbSubscriptionBundle-selling-plans-navigation-stroke-width) solid var(--gbb-gbbSubscriptionBundle-selling-plans-navigation-stroke-color);
    border-bottom: none;
}
.gbbSellingPlanNavigationTabTitle{
    color:var(--gbb-gbbSubscriptionBundle-selling-plan-navigation-inactive-title-color)
}
.gbbSellingPlanNavigationTabTitle.active{
    color: var(--gbb-gbbSubscriptionBundle-selling-plan-navigation-active-title-color);
}
.gbbSellingPlansNavigationWrapper {
    display: grid;
    text-align: center;
    gap: 10px;
}
.gbbSubscriptionBundleWrapper {
    display: grid;
    gap: 20px;
    margin: 0 -12.5%;
    background: var(--gbb-gbbSubscriptionBundle-header-bg-color);
}
.gbbSellingPlansNavigationItemsWrapper {
    display: grid;
    align-items: center;
    gap: 20px;
}
.gbbSellingPlanNextNavigationIconWrapper{
    transform: rotate(180deg);
}
.gbbSellingPlanNextNavigationIconWrapper,
.gbbSellingPlanPrevNavigationIconWrapper{
    cursor: pointer;
}
.gbbSellingPlanNextNavigationIconWrapper svg g,
.gbbSellingPlanPrevNavigationIconWrapper svg g{
    fill: var(--gbb-gbbSubscriptionBundle-selling-plan-navigation-next-prev-icon-bg-color);
}

.gbbSellingPlansNavigationItemsWrapper:has(.gbbSellingPlanNextNavigationIconWrapper) {
    grid-template-columns: 30px 1fr 30px;
    padding: 0px 20px;
}

.gbbSubscriptionDiscountContent {
    background: var(--gbb-gbbSubscriptionBundle-product-discount-ribbon-bg-color);
    color: var(--gbb-gbbSubscriptionBundle-product-discount-ribbon-text-color);
    font-weight: bold;
    width: fit-content;
    padding: 2px 8px;
    position: absolute;
    top: 25px;
    right: 0;
    font-size: 12px;
}
.gbbPageBody:has(.gbbSubscriptionBundleWrapper){
    padding: 0px !important;
}
.gbbSellingPlansNavigationItemsWrapper[data-total-selling-plans="2"] .gbbSellingPlansNavigationTabsContainer,
.gbbSellingPlansNavigationItemsWrapper[data-total-selling-plans="3"] .gbbSellingPlansNavigationTabsContainer,
.gbbSellingPlansNavigationItemsWrapper[data-total-selling-plans="1"] .gbbSellingPlansNavigationTabsContainer{
    justify-content: center;
}
.gbbSubscriptionBundleWrapper:not(:has(.gbbSellingPlansNavigationWrapper)){
    padding-bottom: 20px;
}
@media only screen and (max-width: 500px) {
    .gbbSubscriptionBundleWrapper{
        margin: 0px;
    }
    .gbbPurchaseOption .gbbPurchaseOptionTextContent{
        font-size: 12px;
    }
    .gbbSellingPlansNavigationTabsContainer{
        grid-auto-columns: 33%;
    }
    .gbbSellingPlansNavigationItemsWrapper:has(.gbbSellingPlanNextNavigationIconWrapper){
        padding: 0px 5px;
    }
    .gbbSellingPlansNavigationItemsWrapper:has(.gbbSellingPlanNextNavigationIconWrapper) .gbbSellingPlansNavigationTabsContainer{
        grid-auto-columns: 100%;
    }
    .gbbSellingPlanNavigationTab{
        padding :5px;
    }
        .gbbSellingPlansNavigationItemsWrapper[data-total-selling-plans="2"] .gbbSellingPlansNavigationTabsContainer,
        .gbbSellingPlansNavigationItemsWrapper[data-total-selling-plans="3"] .gbbSellingPlansNavigationTabsContainer,
        .gbbSellingPlansNavigationItemsWrapper[data-total-selling-plans="1"] .gbbSellingPlansNavigationTabsContainer {
            justify-content: normal;
        }
 }
  @media only screen and (max-width: 1020px) {
      .gbbSubscriptionBundleWrapper {
          margin: 0px;
      }
  }/***************************************************Landing page CSS*******************************************************************/
*{
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: inherit;
}
main{
    padding: 0 !important;
}

p{
    padding: 0 ;
    margin: 0 ;
}
/* landing page banner css */
.gbbLandingPageBanner{
    display: grid;
    position: relative;
}
.gbbLandingPageBannerImage {
    display: grid;
    object-fit: cover;
    width: 100vw;
    height: 25vw;  /*20vw for desktop*/
}
.gbbLandingPageBannerText{
    font-size: 14px;
    color: black;
    text-align: center;
    margin: 2% 0%;
}
.gbbLandingPageBannerSubText{
    font-size: 12px;
    color: #fff;
}
.landingPageBannerButton{
    padding: 10px;
    font-size: 12px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
    width: 50%;
    margin: 2% 0%;
}

.landingPageBannerButton:active {
    transform: scale(0.95);
}

.gbbMainPrecuratedBoxesContainer{
    margin: 10% 0%;
}
.gbbLandingPageBannerTextWrapper{
    position: absolute;
    top: 12%;
    left: 7%;
    width: max-content;
    display: grid;
    grid-template-rows: 0.2fr 0.4fr 0.2fr;
    grid-gap: 10px;
    justify-items: center;
    text-align: center;
}
/* landing page - navigation css */
.gbbNavigationItemsContainer{
    display: grid;
    /* grid-template-columns: 1fr 1fr 1fr; */
    grid-template-columns: repeat(auto-fit,minmax(50px,1fr));
    justify-content: center;
    position: relative;
    margin:2% 2%;
}
.gbbLandingPageNavigationItemsContainer{
    margin:2% 2%;
}
.gbbNavigationItem{
    cursor: pointer;
}
.gbbLandingPageNavigationItemsContainer::before{
    /* content: '';
    position: absolute;
    border-top: 5px solid #f1f2f3;
    left: 0;
    right: 0;
    top: 45px;
    z-index: -1; */
}
.gbbNavigationItem{
    justify-content: center;
    z-index: 1;
    display: grid;
    justify-items: center;
}
.gbbNavigationItemsContainer::before{
    content: '';
    position: absolute;
    border-top: 2px solid #d4d5d6;
    left: 0px;
    right: 0px;
    top: 22px;
    z-index: 0;
}


.gbbPreviousNavigationItemsButton , .gbbNextNavigationItemsButton{
    cursor: pointer;
    display: grid;
    justify-items: center;
    align-items: center;
    position: absolute;
    top: 10px;
    border-radius: 50%;
}

.gbbPreviousNavigationItemsButton {
    left:-12px;
}

.gbbNextNavigationItemsButton{
    right: -12px;
   
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);  
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
    /* rotate: 180deg; */
}


.gbbNavigationItemsContainer {
    display: grid;
    justify-items: center;
} 

.gbbNavigationStepContainer {
    display: grid;
    grid-template-rows: 1fr 0.2fr;
    justify-content: center;
    align-items: center;
}
.gbbNavigationImage {
    width: 100%;
    height: 100%;
}
.gbbNavigationStepImgContainer {
    background: white;
    text-align: center;
    border: 2px solid #d4d5d6;
    border-radius: 50%;
    padding: 4px;
    display: grid;
    align-items: center;
    justify-items: center;
    width: 40px;
    height: 40px;
    overflow: hidden;
}
.gbbNavigationTitle{
    font-size: 12px;
    font-weight: 600;
    text-align: center;
}
.gbbNavigationTitleContainer{
    display: grid;
    /* justify-content: center; */
    align-items: center; 
    /* width: 100%; */
    /* padding: 7px 25px; */
    /* text-align: center; */
}
/* landing page - precurated boxes css */
.gbbLandingPagePrecuratedBoxes{
    margin:20px 10px;
    display: grid;
    grid-gap: 20px;
}
.gbbLandingPagePrecuratedBoxesLabel {
    font-size: 16px; 
}
.gbbLandingPagePrecuratedBoxesCardWrapper{
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-gap: 12px;
}
.gbbPrecuratedBoxesCard{
    display: grid;
    grid-template-rows: 1fr 0.2fr;
    justify-content: center;
    background: #f1f2f3;
    padding: 20px;
    font-size: 16px;
    grid-gap: 15px;
}
.gbbPrecuratedBoxesCardImageContainer{
    width: 120px;
    height: 120px;
}
.gbbPrecuratedBoxesCardImage{
    width: 100%;
    height: 100%;
    object-fit: contain;
}
.gbbPrecuratedBoxesCardText{
    text-align: center;
}
.activeNavItem{
    border:  4px solid #ffffff;
}
.gbbLandingPageBannerButtonWrapper{
    text-align: center;
    display: grid;
    place-items: center;
}
.gbbPageHeader{
    position: relative;
}
.gbbPageHeaderText{
    position: absolute;
    top: 10%;
    z-index: 100;
    left: 30%;
    color: white;
    font-size: 16px;
    font-size: 14px;
}
.gbbtickMark {
    border: none;
    position: absolute;
    top: 5px;
}

.gbbtickMarkPseudo::before {
    display: block !important;
    position: absolute;
    left: 0;
    top: 50%;
    height: 50%;
    width: 3px;
    background-color: #ffffff;
    content: "";
    transform: translateX(10px) rotate(-45deg);
    transform-origin: left bottom;
}

.gbbtickMarkPseudo::after {
    display: block !important;
    position: absolute;
    left: 0;
    bottom: 0;
    height: 3px;
    width: 100%;
    background-color: #ffffff;
    content: "";
    transform: translateX(10px) rotate(-45deg);
    transform-origin: left bottom;
}

.checkmark {
    display:inline-block;
    width: 22px;
    height:22px;
    -ms-transform: rotate(45deg); /* IE 9 */
    -webkit-transform: rotate(45deg); /* Chrome, Safari, Opera */
    transform: rotate(45deg);
}

.checkmarkStem {
    position: absolute;
    width:3px;
    height:9px;
    background-color:#ccc;
    left:11px;
    top:6px;
}

.checkmarKick {
    position: absolute;
    width:3px;
    height:3px;
    background-color:#ccc;
    left:8px;
    top:12px;
}
.gbbPageHeader{
    position: relative;
}
.gbbPageHeader:after{
    /* content: " ";
    position: absolute;
    width: 75%;
    left: 10%;
    bottom: 10%;
    height: 50px;
    z-index: -1;
    -moz-box-shadow: 0px 4px #d4d5d6;
    -webkit-box-shadow: 0px 4px #d4d5d6;
    box-shadow: 0px 4px #d4d5d6; */
        /* right: 10px; */

}
/* .gbbPrecuratedPageHeader, .gbbPageHeaderWithoutLine{
    position: relative;
}
.gbbPageHeaderWithoutLine:after{
    display: none !important;
} */
.gbbAddProductPageSubtext,
.gbbPrecuratedBoxPageSubtext,
.gbbPersonalizePageSubtext,
.gbbChooseBoxPageSubtext,
.gbbMultipleCategoriesPageSubtext{
    font-size: 14px;
    color: black;
}

.page-container{
overflow : unset !important;
}
#dummy-chat-button-iframe{
display : none !important;
}

#dummy-chat-button{
display : none !important;
}

@media (min-width:600px){
    .gbbNavigationItemsContainer{
        margin: 2% 10%;  
    }
    .gbbLandingPageBannerImage{
        height: 20vw;
    }
    .gbbNavigationTitleContainer{
        padding: 8px 0px;
    }
    .gbbNavigationTitle{
        font-size: 14px;
    }
    .landingPageBannerButton{
        width: 40%;
    }
    .gbbPageHeaderText{
        top: 15%;
        left: 35%;
        font-size: 16px;
    }
    .gbbPageHeader:after{
        bottom: 7%;
    }

    .gbbAddProductPageSubtext,
    .gbbPrecuratedBoxPageSubtext,
    .gbbPersonalizePageSubtext,
    .gbbChooseBoxPageSubtext,
    .gbbMultipleCategoriesPageSubtext{
        font-size: 18px;
        color: black;
    }

}
@media (min-width:1024px){
    .gbbtickMark{
        /* top: 4%; */
    }
    .gbbLandingPageBannerImage{
        height: 18vw;
        width: 78vw;
    }
    .gbbBodyWrapper{
    margin: 0 10%;
    }
    
.gbbPreviousNavigationItemsButton {
    left:-24px;
}
.gbbNextNavigationItemsButton{
    right: -24px;
}
    .gbbMainPrecuratedBoxesContainer{
        margin: 5% 0%;
    }
    .gbbLandingPageBannerTextWrapper{
        grid-gap: 14px;
        top: 16%;
        left: 8%;
    }
    .gbbLandingPageBannerText{
        font-size: 25px;
    }
    .gbbLandingPageBannerSubText{
        font-size: 17px;
        /* width: 45%; */
    }
    .landingPageBannerButton{
        padding: 12px;
        font-size: 18px;
        width: 40%;
        border-radius: 10px;
    }
    .gbbNavigationItemsContainer{
         margin: 2% 20%;
        /* grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); */ 
    }
    /* .gbbNavigationStepImgContainer{
        height: 100px;
        width: 100px;
    } */
    .gbbNavigationImage{
        width: 100%;
        height: 100%;
    }
    .gbbLandingPagePrecuratedBoxesLabel{
        font-size: 18px;
    }
    .gbbLandingPagePrecuratedBoxesCardWrapper{
        display: grid;
        grid-template-columns: repeat(3,1fr);
        grid-gap: 15px;
    }
    .gbbAddProductPageSubtext,
    .gbbPrecuratedBoxPageSubtext,
    .gbbPersonalizePageWrapper,
    .gbbChooseBoxPageSubtext,
    .gbbMultipleCategoriesPageSubtext{
        font-size: 18px;
    }

    .gbbNavigationItemsContainer::before{
        /* top: 30%; */
    }
    .gbbNavigationItem{
        /* width: 100px;         */
    }
    .gbbNavigationTitleContainer{
        justify-content:normal;
        padding: 4px 2px;
        text-align: center;
    }
    .gbbPrecuratedBoxesCard{
        padding: 10px;
    }
    .gbbPrecuratedBoxesCardImageContainer{
        width: 235px;
        height: 235px;
    }
    .gbbPageHeaderText{
        top: 25%;
        left: 40%;

    }
}

.gbbAddProductPageSubtextWrapper:not(:empty),
.gbbPrecuratedBoxPageSubtextWrapper:not(:empty),
.gbbPersonalizePageSubtextWrapper:not(:empty),
.gbbChooseBoxPageSubtextWrapper:not(:empty),
.gbbMultipleCategoriesPageSubtextWrapper:not(:empty){
    display: grid;  
    margin: 10px;
    justify-content: center;
    text-align: center;
}



.gbbAddProductPageSubtext,
.gbbPrecuratedBoxPageSubtext,
.gbbChooseBoxPageSubtext,
.gbbMultipleCategoriesPageSubtext{
    font-size: 18px;
}

@media(min-width:1192px){
    .gbbLandingPagePrecuratedBoxesLabel{
        font-size: 18px;
    }
    .gbbNavigationItemsContainer::before{
        /* top: 45px; */
    }
}






/* .gbbLoadingScreen {
    display: grid;
    place-items: center;
    height: 80vh;
    margin: 0 auto;
    text-align: -webkit-center;
  } */
  /* .gbbLoadingScreenSpinner {
    border: 16px solid #f3f3f3;
    border-radius: 50%;
    border-top: 16px solid rgb(117, 117, 122);
    border-bottom: 16px solid rgb(117, 117, 122);
    width: 120px;
    height: 120px;
    -webkit-animation: spin 2s linear infinite;
    animation: spin 2s linear infinite;
  }

  @-webkit-keyframes spin {
    0% {
      -webkit-transform: rotate(0deg);
    }

    100% {
      -webkit-transform: rotate(360deg);
    }
  } */
/* 
  .gbbLoadingSkeleon {
    opacity: .7;
    animation: skeleton-loading 1s linear infinite alternate;
  }
  .gbbLoadingSkeleon .skeleton-text {
    width: 100%;
    height: .5rem;
    margin-bottom: .25rem;
    border-radius: .125rem;
  }
  .gbbLoadingSkeleon .skeleton-text:last-child {
    margin-bottom: 0;
    width: 80%;
  }

  @keyframes skeleton-loading {
    0% {
      background-color: hsl(200, 20%, 70%);
    }
  100% {
      background-color: hsl(200, 20%, 95%);
    }
  }

  .gbbLoadingScreenSpinner {    
    width: 100%;
    height: 100%;
    display: block;
    background: linear-gradient(
        to right,
        rgba(255, 255, 255, 0),
        rgba(255, 255, 255, 0.5) 50%,
        rgba(255, 255, 255, 0) 80%
      ),
      lightgray;
    background-repeat: repeat-y;
    background-position: 0 0;
    animation: shine 1s infinite;
  }


  @keyframes shine {
    to {
      background-position: 100% 0;
    } 
  /* } */

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }


.gbbNavigationStepsContainer{
    max-width: 100%;
    width: 100%;
    table-layout: fixed;
    display: table;
}

.gbbNavigationStep{
    cursor: pointer;
    margin: 0 15px;
    text-align: center;
    display: table-cell;
    opacity: 0.6;
    color: rgba(58,58,58,1);
}

.gbbProgressBar{
    display: block !important;
    border-bottom: solid 2px rgba(217,225,230,1);
}

.gbbStepActive{
    opacity: 1;
    font-family: bold;
}

.gbbStepCompleted{
    opacity: 1;
}

.gbbNavigationStepCircle{
    display: block !important;
    margin: 0 auto;
    margin-top: -7px;
    width: 12px;
    height: 12px;
    background: white;
    border: solid 2px;
    border-radius: 50%;
}

.gbbNavigationContainerV2{
    margin:5% 15px;
}


.landingPageBannerButton,
.gbbProductAddButton,
.gbbProductQuantityRemoveButton,
.gbbProductQuantityAddButton,
.gbbProductVariantOptionValue,
.gbbProductVariantAddButton,
.gbbFooterNextButton,
.gbbFooterBackButton,
.gbbCustomerUploadsActionButton,
.gbbProductAddButton{
    cursor: pointer;
    user-select: none;
}

.gbbLoadingScreen{
    user-select: none;
    z-index: 1;
    /* background: #fff; */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: grid;
    justify-content: center;
    align-items: center;
}




.gbbHideScrollBar{
    overflow: hidden;
}
.gbbPageBody{
    height:100%;
    padding:10px;
}


.gbbProductItemCompareAtPrice{
    text-decoration: line-through;
    color: #999;
    font-size: 12px;
}
.gbbProductVariantOptionContainerHidden{
    display: none;
}

.gbbFooterOriginalTotalValue{
    color : #625f5f;
}


.gbbTagsAndPillHTMLContainer{
    display: inline;
}


.gbbProductTabImageContainer img {
    width: 100%;
    height: 100%;
}

.gbbMobileImageBanner , .gbbDesktopImageBanner {
    width: 100%;
  }

.gbbProductQuantityInput{
  width: 48px;  
  font-size: 16px;
  padding: 4px;
  border-radius: 5px;
}

.gbbProductQuantityInput{
    text-align: center;
}

.gbbProductQuantityInput::-webkit-outer-spin-button,
.gbbProductQuantityInput::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

/* Firefox */
.gbbProductQuantityInput[type=number] {
  -moz-appearance: textfield;
}

/* Mobile styles */
@media (max-width: 600px) {
    .gbbMobileImageBanner {
      display: block;
    }
    .gbbDesktopImageBanner {
      display: none;
    }
    .gbbProductQuantityHTML{
        grid-gap: 8px;
    }
    .gbbProductQuantityInput{
        width: 64px;
    }
    .gbbProductVariantModalDetailsContainer .gbbProductQuantityHTML{
        grid-gap: 8px;
    }
  }
  
  /* Desktop styles */
  @media (min-width: 601px) {
    .gbbMobileImageBanner {
      display: none;
    }
    .gbbDesktopImageBanner {
      display: block;
    }
  }

  .gbbAddProductPageBanners:empty{
     display: none;
  }


.gbbProductsCardLayoutV2 .gbbNavigationItemsContainer::before{
    content: none;
    }
  .gbbProductsCardLayoutV2 .gbbStepsProgressBarContainer{
    width: 100%;
    height: 6px;
    position: absolute;
    border-radius: 20px;
    overflow: hidden;
    top: 17px;
  }
  .gbbProductsCardLayoutV2 .gbbStepsProgressBar{
    width: 100%;
    background: #eeeeee;
    height: 100%;
  }
  .gbbProductsCardLayoutV2 .gbbStepsProgressBarFilled{
    display: block !important;
    background: black;
    width: 10%;
    height: 100%;
  }

  .gbbBundle-HTML footer, .gbbBundle-HTML .footer  {
    opacity: 0;
    visibility: hidden;
    transition: opacity 3s, visibility 3s;
    animation: showElement 3s forwards;
}

@keyframes showElement {
    from {
        opacity: 0;
        visibility: hidden;
    }
    to {
        opacity: 1;
        visibility: visible;
    }
}

.gbbPersonalizePageWrapper{
  /* margin: 10% 25%; */
}
.gbbPersonalizePageHTML{
  margin: 5% 5%;
  display:grid;
  grid-gap:40px;
  position: relative; 
  transform: translate(0px, -5%);
}

.gbbPersonalizePageHTMLContent{
    display:grid;
    grid-gap: 20px;
}

.greetingCardAllImagesContainer{
    display: grid;
    /* grid-template-columns: repeat(2,1fr); */
    grid-gap: 15px;
    padding: 10px;
    background: white;    
}


.gbbGreetingCardContainer,
.gbbGiftWrapContainer{
    display: grid;
    grid-gap: 10px;
}

.gbbGreetingCardImg,
.gbbGiftWrapImg{
    width: 100%;
    height: 100%;
    object-fit: contain;
    background: white;
}

.greetingCardPreviewImage{
    height: 100px;
    width: 150px;
}
/* .greetingCardImage,.gbbGreetingCardListWrapper{ */
.greetingCardImage,
.giftWrapImage{
    width: 100%;
    height: 100%;
    /* object-fit: contain; */
    object-fit: cover;
    /* border: 2px solid white; */
    /* padding: 5px; */
    background: white;
}

.greetingCardWrapper,
.giftWrapWrapper{
    overflow-x: hidden;
    /* overflow-y: auto; */
    /* overflow-y: auto; */
    padding-right:5px;
    height: auto;
    /* max-height: 400px; */
    max-height: 350px;
    /* padding: 5px 10px; */
    /* border: 2px solid #D3D5D6; */
    border-radius: 5px;
}

.gbbGreetingCardShowAllImagesButtonWrapper{
    padding: 10px;
    background: white;
    height: fit-content;
}

.gbbGreetingCardShowAllImagesButton{
    padding:10px;
    border-radius: 5%;
}

.gbbGreetingCardDropDownWrapper,
.gbbGiftWrapDropDownWrapper{
    display: grid;
    /* grid-template-columns : 1fr; */
    grid-template-columns: 2fr 1fr;
    grid-template-rows: 1fr;
    padding: 0px 10px;
    border-radius: 5px;
  /* 
    border: 2px solid #D3D5D6;
    padding: 5px; */
}

.gbb_checkmark {
    display:inline-block;
    position:absolute;
    top:10px;
    left:10px;
    width: 22px;
    height:22px;
    -ms-transform: rotate(45deg); /* IE 9 */
    -webkit-transform: rotate(45deg); /* Chrome, Safari, Opera */
    transform: rotate(45deg);
}
.gbb_checkmark {
    top: 50%;
    left: 50%;
    transform: rotate(45deg) translate(-50%, -50%);
}



.gbb_checkmark_circle {
    /* display:block;
    position: absolute;
    width:22px;
    height:22px;
    background-color: green;
    border-radius:11px;
    left:0;
    top:0;
    opacity:0.5; */

    display: block !important;
    position: absolute;
    width: 36px;
    height: 36px;
    background-color: #026a02;
    border-radius: 50%;
    left: -6px;
    top: 0px;
}




.gbb_checkmark_stem {
    display:block !important;
    position: absolute;
    width:3px;
    height:9px;
    background-color:#fff;
    left:11px;
    top:6px;
}
.gbb_checkmark_stem {
  height: 20px;
}

.gbb_checkmark_kick {
    display:block !important;
    position: absolute;
    width:3px;
    height:3px;
    background-color:#fff;
    left:8px;
    top:12px;
}

.gbb_checkmark_kick{
     width: 9px;
    background-color: #fff;
    left: 3px;
    top: 23px;
}



.gbbGreetingCardImageList .greetingCardLabel input:checked,
.giftWrapImageList .giftWrapLabel input:checked{
    border:2px solid #A96668;
    border-radius:5px;
}

.gbbGreetingCardImageList .gbbGreetingCardImageLabel img, 
.giftWrapImageList .giftWrapImageLabel img{
    max-width:100%;
    width: 100%;
    /* width: -moz-available;           */
    /* WebKit-based browsers will ignore this. */
}

.gbbGreetingCardImageLabel,
.giftWrapImageLabel{
    width: 100%;
    height: 150px;
    height: 125px;
    position:relative;
    cursor:pointer;
    display:inline-block;
    align-self:center;
}


.gbbGreetingCardImageList,
.giftWrapImageList{
    display:grid;
    /* grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); */
    grid-template-columns: repeat(1, 1fr);
    grid-template-columns: repeat(2, 1fr);
    grid-gap:10px;
}

.gbbGreetingCardImageList .gbbGreetingCardImageLabel,
.giftWrapImageList .giftWrapImageLabel{
/* gbbGreetingCardImageList .gbbGreetingCardImageLabel, */
  /* border: 1px solid #D3D5D6; */

}
.gbbActiveGreetingCard{
  opacity: 0.5;
}

.greetingCardImageInput,
.giftWrapImageInput{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    visibility:hidden;
}


.gbbBodyWrapper ::-webkit-scrollbar {
  height: 4px;
  width: 3px;
}
  
  /* Track */
  .gbbBodyWrapper ::-webkit-scrollbar-track {
    background: #f1f1f1; 
  }
   
  /* Handle */
   .gbbBodyWrapper ::-webkit-scrollbar-thumb {
    background: #2c2c2c 0% 0% no-repeat padding-box;
  }
  
  /* Handle on hover */
  .gbbBodyWrapper ::-webkit-scrollbar-thumb:hover {
    background: #000000 0% 0% no-repeat padding-box;
  }



.greetingCardDropDownWrapper{
    cursor: pointer;
}


.gbbDisabled{
    pointer-events: none;
    opacity: 0.5;
}

.gbbEmailAddressWrapper{
  display: grid;
  /* background: white;     */
  background: none;
}



.gbbScheduleDeliveryDatePicker{
  display: grid;
  padding: 5px 10px;
  font-weight: 500;
  background: white;    
  /* width: 100%; */
  border-radius: 5px;
  border: 1px solid #D3D5D6;
}




.greetingCardWrapper::-webkit-scrollbar,.giftWrapWrapper::-webkit-scrollbar{ 
  width: 0.3rem;
}
.greetingCardWrapper::-webkit-scrollbar-track,.giftWrapWrapper::-webkit-scrollbar-track{
  -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
}
.greetingCardWrapper::-webkit-scrollbar-thumb,.giftWrapWrapper::-webkit-scrollbar-thumb{
  width: 5px;
  background-color: rgb(26, 24, 24);
}


.gbbGreetingCardDropDownButton,
.gbbGiftWrapDropDownButton{
  transform: rotate(180deg);
  justify-self: self-end;
  height: 30px;
  width: auto;
  cursor: pointer
}


.gbbJustOneProduct{
  display: grid;
  grid-template-columns: 1fr;
  grid-template-rows: 1fr;
  padding: 10px 0px;
  background: white;    
}

.gbbClearSelectionButton{
  border: none;
  text-decoration: underline;
  font-size: 12px;
  cursor: pointer;
  justify-self: end;
}


.greetingCardImgWrapper,.giftWrapImgWrapper{
  height: 250px;
  overflow: hidden;
}


.gbbGreetingCardCheckboxPrice,
.gbbGiftWrapCheckboxPrice{
   justify-self: right;
} 

.gbbVideoHasAlreadyBeenRecorded{
  color: #007F60;
  font-size: 12px;
  font-weight: 600;
  text-align: center;
  background: #f1f2f3;
}


.gbbVideoMsgButtonGroup{
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-gap: 10px;
}

.gbbVideoMsgReRecordButton,
.gbbVideoMsgSaveButton{
  background: #f1f2f3;
  border: 1px solid #D3D5D6;
  border-radius: 5px;
  padding: 5px;
  cursor: pointer;
}

.gbbVideoMsgSaveButton{
  grid-column: 2/3;
  padding: 5px;
}

.gbbVariantDetailsWrapper{
  /* position: absolute;
  bottom: 10%;
  right: 25%;
  background: black;
  color: white; */
  display: grid;
  grid-template-columns: 1fr 1fr;
  /* background-color: rgb(189, 183, 183) ; */
  /* grid-gap: 10px; */
  /* justify-items: center; */
}

.greetingCardImageAndDetailsWrapper{
  display: grid;
  /* grid-template-rows: 3fr 0.5fr; */
  /* grid-gap: 10px; */
  /* border: 2px solid #D3D5D6; */
  border-radius: 5px;
  padding: 5px 5px;
  background-color: rgb(241, 242, 243);
  /* padding: 5px;
  justify-content: center; */
}

.gbbScheduleDeliveryHTML{
  /* grid-column: 2/3; */
}

.gbbScheduleMessageDeliveryWrapper{
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-gap: 10px;
  width: 100%;
  max-width: 100%;
}
.gbbScheduleMessageDeliveryHTML{
  display: grid;
  grid-gap: 10px;
}
.gbbScheduleMessageSendNowContainer, .gbbScheduleMessageSendLaterContainer{
  box-shadow: none;
  display: inline-block;
  justify-content: center;
  cursor: pointer;
  line-height: 30px;
  margin: 0px;
  padding: 6px;
  font-weight: 700;
  text-transform: uppercase;
  font-size: 12px;
  color: #585858;
  border: 1px solid #f3f3f3;
  /* border-top: 0 solid #f3f3f3; */
  transition: transform .2s;
  font-family: inherit;
  /* background: none; */
}
.gbbScheduleMessageSendNowContainer:hover, .gbbScheduleMessageSendLaterContainer:hover{

  transform: scale(0.95);

}
.gbbScheduleMessageDatePicker{
  width: 100%;
  padding: 10px;
  border: 1px solid #a6a6a6;
  display: none;
}
.gbbGiftMessageV2RequiredWarning{
  color: #ff0000;
  font-size: 14px;
}

.gbbGiftMessageV2ToFromContainer {
  width: 100%;
  max-width: 100%;
  display: grid;
  grid-template-columns: 1fr;
  grid-gap: 10px;
  margin-bottom: 10px;
}

.gbbGiftMessageV2FromField,
.gbbGiftMessageV2ToField {
  padding: 10px 18px;
  padding-bottom: 10px;
  border-radius: 2px;
  border: 1px solid #A2A2A2;
  width: unset;
}



@media (min-width:600px){
  .gbbPersonalizePageHTML{
      margin: 10% 0%;
  }
  .gbbGiftMessageV2ToFromContainer{
    grid-template-columns: 1fr 1fr;
  }
  
  .gbbGreetingCardImageLabel, .giftWrapImageLabel{
      width: 100%;
      height: 150px;
  }
  .gbbScheduleDeliveryDatePicker{
    
    padding: 8px 10px;
    
  }
  .gbbGreetingCardImageList{
    grid-template-columns: repeat(3, 1fr);
  }
}


@media (min-width:1024px){  
.gbbPersonalizePageHTML{
  position: relative; 
  transform: translate(0px, -10%);
}
.gbbGiftMessageV2InputFieldsDiv textarea {
  height: 130px;
}

.gbbJustOneProduct .gbbGreetingCardImageLabel,
.gbbJustOneProduct .giftWrapImageLabel{
  width: 100%;
  height: 200px;
}
.gbbGreetingCardImageList, .giftWrapImageList {
  display: grid;
  /* grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); */
  grid-template-columns: repeat(4, 1fr);
  grid-gap: 10px;
}
}


.gbbVariantPrice{
  justify-self: right;
}


.gbbGiftMessageCounterEle:not(:empty),.gbbGiftMessageCounterEle:not(:empty){
  font-size: 12px;
  color: #8c8c8c;
  margin-top: 5px;
  text-align: end;
}


.gbbCustomerUploadsListItemInput{
  display: none;
}


.gbbCustomerUploadsList {
  display: grid;
  grid-gap: 15px;
}

.gbbCustomerUploadsListItem {
  display: grid;
  grid-template-columns: 2fr 1fr 25px;
  grid-gap: 10px;
  margin-bottom: 10px;
}


.gbbCustomerUploadsErrorMsg:not(:empty){
  display: block;
  color:red
}


.gbbCustomerUploadButton{
  font-size: 14px;
  padding: 5px 10px;
  border: none;
  /* width: min-content; */
  border-radius: 5px;
  justify-self: end;
  text-align: center;
  cursor: pointer;
  user-select: none;
}


.gbbCustomerUploadsActionButton {
  font-size: 14px;
  justify-self: end;
}


.gbbCustomerUploadsRemoveButton{
  grid-column: 3/4;
  align-self: end;
  cursor: pointer;
  user-select: none;
}



.gbbCustomerUploadPreviewButton{
  /* underline and blue color */
  font-size: 14px;
  padding: 5px 10px;
  border: none;
  /* width: min-content; */
  border-radius: 5px;
  justify-self: end;
  text-align: center;
  cursor: pointer;
  user-select: none;
  cursor: pointer;
  user-select: none;
  text-decoration: underline;
  color: blue;
}
.gbbCustomerUploadButton{

}

.gbbCustomerUploadsRemoveButton svg {
  /* background: #cf1a1a;
  border-radius: 50%;
  stroke: 0;
  border: 1px solid white;
  fill: white; */
}

.gbbCustomerUploadsMainText{
  /* font-size: 15px; */
  font-weight: 600;
}

.gbbCustomerUploadsDivider{
  display: block !important;
  border: 1px solid #A2A2A2 !important;
  height: 0px;
  opacity: 0.5;
}


/* PRODUCT ADDONS */
.gbbAddonDiscountRibbon{
  background: blue; 
  color: white;
  border-radius: 5px 0px 0px 5px;
}
.notEligibleForAddons .gbbProductItem{
  pointer-events: none;
  opacity: 0.5;
}
.gbbPersonalizePageHTML:has(.gbbAddonProductsWrapper){
  transform: translate(0px, 0px);
  margin: 0% 0%;
}
.gbbAddonProductsSectionTitle{
  font-weight: 600;
}
.gbbProductItem[free-addon-product="true"] .gbbProductItemPricesContainer{
  display: none;
}
.gbbProductItem[free-addon-product="true"] .gbbProductActionContainer {
  grid-template-rows: auto;
}

/* PRODUCT ADDONS */:root {
    /* Banners */
    --gbb-landing-page-image-src: url(https://d3ks0ngva6go34.cloudfront.net/public/banners/landing_page_bannerv2.png);
    --gbb-page-banner-image-src: url(https://d3ks0ngva6go34.cloudfront.net/public/banners/page_banner_temp.png);
    --gbb-product-review-image-src: url(https://d3ks0ngva6go34.cloudfront.net/public/banners/landing_page_bannerv2.png);

    /* Colors */
    --gbb-primary-color: blue;
    --gbb-secondary-color: aqua;
    --gbb-text-color: black;
    --gbb-disabled-color: gray;
    --gbb-product-box-color: blue;

    /* Landing Page */
    --gbb-landing-page-text-color: #000000;
    --gbb-landing-page-button-bg-color: #000000;
    --gbb-landing-page-button-text-color: #ffffff;

    /* Cart Footer */
    --gbb-cart-footer-bg-color: #ffffff;
    --gbb-cart-footer-buttons-container-bg-color: #f6f6f6;
    --gbb-cart-footer-border-radius: 0px;
    --gbb-cart-footer-product-image-border-radius: 0px;
    --gbb-cart-footer-buttons-container-border-radius: 9px;
    --gbb-cart-footer-show-hide-prices: visible;
    --gbb-cart-footer-text-color: #000000;
    --gbb-cart-footer-strikethrough-price-color: #8D8D8D;
    --gbb-cart-footer-final-price-font-thickness: bold;
    --gbb-cart-footer-strikethrough-price-font-thickness: regular;
    --gbb-cart-footer-back-button-color: #6d7175;
    --gbb-cart-footer-back-button-text-color: #FFFFFF;
    --gbb-cart-footer-back-button-border-color: #000000;
    --gbb-cart-footer-back-button-border-thickness: 2px;
    --gbb-cart-footer-next-button-text-color: #ffffff;
    --gbb-cart-footer-next-button-color: #000000;
    --gbb-cart-footer-next-button-border-color: #000000;
    --gbb-cart-footer-next-button-border-thickness: 2px;
    --gbb-cart-footer-buttons-border-radius: 9px;
    --gbb-cart-footer-buttons-padding: 10px;
    --gbb-cart-footer-discount-progress-bar-empty-color: #C1E7C5;
    --gbb-cart-footer-discount-progress-bar-filled-color: #15A524;
    --gbb-cart-footer-discount-text-visibility: visible;

    /* Product Card */
    --gbb-product-card-bg-color: #f1f2f3;
    --gbb-product-card-border-radius: 12px;
    --gbb-product-card-image-border-radius: 8px;
    --gbb-product-card-image-fit: cover;
    --gbb-product-card-per-row-xtra-large-screen: 6;
    --gbb-product-card-per-row-large-screen: 4;
    --gbb-product-card-text-color: #252525;
    --gbb-product-card-title-font-size: 19px;
    --gbb-product-card-title-font-weight: regular;
    --gbb-product-card-final-price-visibility: block;
    --gbb-product-card-compare-at-price-font-size: 20px;
    --gbb-product-card-compare-at-price-font-weight: regular;
    --gbb-product-card-compare-at-price-visibility: block;
    --gbb-product-card-final-price-font-size: 18px;
    --gbb-product-card-final-price-font-color: #252525;
    --gbb-product-card-final-price-font-weight: bold;
    --gbb-product-card-button-color: #000000;
    --gbb-product-card-button-text-color: #ffffff;
    --gbb-product-card-button-border-radius: 10px;
    --gbb-product-card-allow-only-one-quantity: block;
    --gbb-product-card-quantity-selector-bg-color: #EEEEEE;
    --gbb-product-card-quantity-selector-btns-bg-color: #000000;
    --gbb-product-card-quantity-selector-text-color: #000000;
    --gbb-product-card-quantity-selector-border-radius: 8px;
    --gbb-product-card-quantity-selector-button-text-color: #ffffff;

    /* Navigation Banner */
    --gbb-navigation-banner-title-color: #ffffff;
    --gbb-navigation-banner-text-color: #ffffff;
    --gbb-navigation-banner-step-completion-color: #000000;
    --gbb-navigation-banner-step-done-color: #000000;
    --gbb-navigation-banner-step-text-color: #000000;
    --gbb-navigation-banner-step-progress-bar-filled-color: #1E1E1E;
    --gbb-navigation-banner-step-progress-bar-empty-color: #cccccc;
    --gbb-navigation-banner-step-text-font-size: 20px;
    --gbb-navigation-check-color: #ffffff;
    --gbb-navigation-banner-step-completed-border-color: #000000;
    --gbb-navigation-banner-step-completed-border-width: 2px;
    --gbb-navigation-banner-step-incomplete-bg-color: #FFFFFF;
    --gbb-navigation-banner-step-incomplete-border-color: #000000;
    --gbb-navigation-banner-step-incomplete-border-width: 2px;
    --gbb-navigation-banner-tabs-active-bg-color: #000000;
    --gbb-navigation-banner-tabs-active-text-color: #F6f6f6;
    --gbb-navigation-banner-tabs-inactive-bg-color: #FFFFFF;
    --gbb-navigation-banner-tabs-inactive-text-color: #000000;
    --gbb-navigation-banner-tabs-border-color: #3c3c3c;
    --gbb-navigation-banner-tabs-corner-radius: 5px;

    /* Summary Block */
    --gbb-summary-block-add-to-cart-button-color: #000000;
    --gbb-summary-block-add-to-cart-button-text-color: #ffffff;
    --gbb-summary-block-back-button-color: #252525;
    --gbb-summary-block-back-button-text-color: #ffffff;

    /* Category Block */
    --gbb-category-bg-color: #f5f5f5;
    --gbb-tab-active-bg-color: #000000;
    --gbb-tab-active-text-color: #F6f6f6;
    --gbb-tab-inactive-bg-color: #FFFFFF;
    --gbb-tab-inactive-text-color: #000000;

    /* Quick Settings */
    --gbb-quick-settings-primary-color: #000000;
    --gbb-quick-settings-button-bg-color: #000000;
    --gbb-quick-settings-button-text-color: #ffffff;

    /* General Settings */
    --gbb-condition-toast-bg-color: #000000;
    --gbb-condition-toast-text-color: #ffffff;
    --gbb-scroll-bar-color: #F6F6F6;
    --gbb-icon-text-color: #1d1d1b;
    --gbb-icon-bg-color: #ffffff;
    --gbb-product-page-title-color: #000000;
    --gbb-bundle-bg-color: #ffffff;
}


.gbbNewPageCustomization.gbbProductsCardLayoutV2 {

    /* CART FOOTER COLOR CONFIG */
    .gbbProductsFooterHTML,
    .gbbAddProductsPageFooterHTML,
    .gbbPersonalizePageFooterHTML {
        background-color: var(--gbb-cart-footer-bg-color);
        border-radius: var(--gbb-cart-footer-border-radius);
    }

    .gbbFooterButtonsWrapper {
        background-color: var(--gbb-cart-footer-buttons-container-bg-color);
        border-radius: var(--gbb-cart-footer-buttons-container-border-radius);
    }

    .gbbFooterTotalContainer {
        visibility: var(--gbb-cart-footer-show-hide-prices);
    }

    .gbbFooterProductImageContainer {
        border-radius: var(--gbb-cart-footer-product-image-border-radius);
    }

    .gbbFooterDiscountedTotalValue {
        font-weight: var(--gbb-cart-footer-final-price-font-thickness);
        color: var(--gbb-cart-footer-final-price-font-color);
    }
    
    .gbbFooterOriginalTotalValue {
        color: var(--gbb-cart-footer-strikethrough-price-color);
        font-weight: var(---gbb-cart-footer-strikethrough-price-font-thickness);
    }

    .gbbFooterBackButton {
        background-color: var(--gbb-cart-footer-back-button-color);
        color: var(--gbb-cart-footer-back-button-text-color);
        border: var(--gbb-cart-footer-back-button-border-thickness) solid var(--gbb-cart-footer-back-button-border-color);

    }

    .gbbFooterNextButton {
        background-color: var(--gbb-cart-footer-next-button-color);
        color: var(--gbb-cart-footer-back-button-text-color);
        border: var(--gbb-cart-footer-next-button-border-thickness) solid var(--gbb-cart-footer-next-button-border-color);
       
    }
    .gbbFooterBackButton,.gbbFooterNextButton{
        border-radius: var(--gbb-cart-footer-buttons-border-radius);
        padding: var(--gbb-cart-footer-buttons-padding);
    }

    .progressBar {
        background-color: var(--gbb-cart-footer-discount-progress-bar-empty-color);
    }

    .progressBarFill {
        background-color: var(--gbb-cart-footer-discount-progress-bar-filled-color);
    }

    .gbbDiscountMessage {
        color: var(--cart-footer-discount-text-color);
        visibility: var(--gbb-cart-footer-discount-text-visibility)
    }

    
    /* CART FOOTER COLOR CONFIG */

    /* PRODUCT CARD COLOR CONFIG */
    .gbbProductItem {
        background-color: var(--gbb-product-card-bg-color);
        border-radius: var(--gbb-product-card-border-radius);
    }

    .gbbProductQuantityAddButton {
        display: var(--gbb-product-card-allow-only-one-quantity);
        border-radius: var(--gbb-product-card-quantity-selector-border-radius);
    }

    .gbbProductItemPrice {
        display: var(--gbb-product-card-final-price-visibility);
    }

    .gbbProductImageContainer {
        border-radius: var(--gbb-product-card-image-border-radius);
    }

    .gbbProductImageContainerImg {
        object-fit: var(--gbb-product-card-image-fit);
    }

    .gbbProductTextContainer {
        color: var(--gbb-product-card-text-color);
    }

    .gbbProductTitleOnly {
        font-size: var(--gbb-product-card-title-font-size);
        font-weight: var(--gbb-product-card-title-font-weight);
    }

    .gbbProductItemCompareAtPrice {
        color: var(--gbb-product-card-compare-at-price-font-color);
        font-size: var(--gbb-product-card-compare-at-price-font-size);
        font-weight: var(--gbb-product-card-compare-at-price-font-weight);
        display: var(--gbb-product-card-compare-at-price-visibility);
    }

    .gbbProductItemPrice {
        color: var(--gbb-product-card-final-price-font-color);
        font-size: var(--gbb-product-card-final-price-font-size);
        font-weight: var(--gbb-product-card-final-price-font-weight);
    }

    .gbbProductAddButton {
        background-color: var(--gbb-product-card-button-color);
        color: var(--gbb-product-card-button-text-color);
        border-radius: var(--gbb-product-card-button-border-radius);
    }

    .gbbProductQuantityHTML {
        background-color: var(--gbb-product-card-quantity-selector-bg-color);
        color:var(--gbb-product-card-quantity-selector-text-color) ;
        border-radius: var(--gbb-product-card-button-border-radius);
    }
    .gbbProductQuantityRemoveButton{
        background-color: var(--gbb-product-card-quantity-selector-btns-bg-color);
        color: var(--gbb-product-card-quantity-selector-button-text-color);
        border-radius: var(--gbb-product-card-quantity-selector-border-radius);
    }
        /* productCardQuantitySelectorButtonTextColor */
    @media screen and (min-width: 1921px) {
        .gbbProductsItemsContainer {
            grid-template-columns: repeat(var(--gbb-product-card-per-row-xtra-large-screen), 1fr);
        }
    }
        @media screen and (min-width: 768px) and (max-width: 1920px) {
            .gbbProductsItemsContainer {
                grid-template-columns: repeat(var(--gbb-product-card-per-row-large-screen), 1fr);
            }
        }
    /* PRODUCT CARD COLOR CONFIG */

    /* Navigation */

    .gbbNavigationTitle {
        color: var(--gbb-navigation-banner-text-color);
        font-size: var(--gbb-navigation-banner-step-text-font-size);
    }

    .gbbStepsProgressBar {
        background-color: var(--gbb-navigation-banner-step-progress-bar-empty-color);
    }

    .gbbStepsProgressBarFilled {
        background-color: var(--gbb-navigation-banner-step-progress-bar-filled-color);
    }

    .gbbCategoryContainerTabUI {
        background-color: var(--gbb-navigation-banner-tabs-inactive-bg-color);
        color: var(--gbb-navigation-banner-tabs-inactive-text-color);
        border: 1px solid var(--gbb-navigation-banner-tabs-border-color);
        border-radius: var(--gbb-navigation-banner-tabs-corner-radius);
    }

    .gbbCategoryContainerTabUIActive {
        background-color: var(--gbb-navigation-banner-tabs-active-bg-color);
        color: var(--gbb-navigation-banner-tabs-active-text-color);
    }

    .gbbtickMark svg>path {
        fill: var(--gbb-navigation-banner-step-done-color);
    }
 /* gbbNavigationStepImgContainer class which doesnt includes gbbNavigationStepImgContainerActive */

    .gbbNavigationStepImgContainer:not(.gbbNavigationStepImgContainerActive) {
        border: var(--gbb-navigation-banner-step-incomplete-border-width) solid var(--gbb-navigation-banner-step-incomplete-border-color);
        background-color: var(--gbb-navigation-banner-step-incomplete-bg-color);
    }

    .gbbNavigationStepImgContainerActive {
        border: var(--gbb-navigation-banner-step-completed-border-width) solid var(--gbb-navigation-banner-step-completion-color);
        /* background-color: var(--gbb-navigation-banner-step-completion-color); */
    }

    /* Navigation */

/*const cssVariables=[ '
--gbb-navigation-banner-title-color',
'--gbb-navigation-banner-step-text-color',
];*/

}
.gbbNewPageCustomization.gbbProductVariantModalLayoutV2 {
    .gbbProductVariantAddButton{
        background-color: var(--gbb-product-card-button-color);
            color: var(--gbb-product-card-button-text-color);
            border-radius: var(--gbb-product-card-button-border-radius);

    }
    .gbbProductQuantityHTML {
        background-color: var(--gbb-product-card-quantity-selector-bg-color);
        color: var(--gbb-product-card-quantity-selector-text-color);
        border-radius: var(--gbb-product-card-quantity-selector-border-radius);
    }
    .gbbProductQuantityAddButton {
        display: var(--gbb-product-card-allow-only-one-quantity);
        border-radius: var(--gbb-product-card-quantity-selector-border-radius);
    }
    .gbbProductQuantityRemoveButton {
        background-color: var(--gbb-product-card-quantity-selector-btns-bg-color);
        color: var(--gbb-product-card-quantity-selector-button-text-color);
        border-radius: var(--gbb-product-card-quantity-selector-border-radius);
    }
}.gbbGiftMessageV2InputFieldsDiv textarea {
    margin:0px;
    padding: 10px 18px;
    width: 100%;
    border: 1px solid #cccccc;
    /* background-color:#f1f2f3; */
    /* background-color: #ffffff; */
    color: #000000;
    max-width: 100%;
    line-height: 1.2;
    border-radius: 2px;
    padding-bottom: 10px;
    max-height: 170px !important;
    min-height:50px !important;
    border: 1px solid #A2A2A2;
    resize: none;
    width: 100%;
    height: 130px;
    padding: 10px;
    background: none;
}


.gbbGiftMessageV2Divider{
    display: block !important;
    border: 1px solid #A2A2A2 !important;
    height: 0px;
    opacity: 0.5;
 }
.gbbGiftMessageV2Label{
    text-align: left;
    letter-spacing: 0px;
    display: block;
    color: #000000;
    padding-bottom: 10px;
    opacity: 1;
}

.gbbGiftMessageV2{
    display: grid;
    grid-template-rows: 0.6fr;
    grid-gap: 10px;
}
.gbbVideoMessageCheckboxRow{
    display: grid;
    grid-auto-flow: column;
    padding: 5px;
    /* background-color: #f1f2f3; */
}
.gbbVideoMsgCheckboxLabel{
    text-align: left;
    letter-spacing: 0px;
    color: #000000;
}
 .gbbVideoMsgCheckboxWrapper {
    position: relative;
    display: inline-block;
    width: 44px;
    justify-self: end;
    height: 26px;
  }
.gbbVideoMsgCheckboxField { 
  width: 0px;
  height: 0px;
}

.gbbVideoMsgToggle input{ 
    opacity: 0;
    width: 0;
    height: 0;
  }
  
.gbbVideoMsgSlider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #fff;
    border: 1px solid black;    
    -webkit-transition: .4s;
    transition: .4s;
  }
  
 .gbbVideoMsgSlider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 4px;
    bottom: 4px;
    top:2px;
    background-color: white;
    -webkit-transition: .4s;
    transition: .4s;
  }
  
   input:checked + .gbbVideoMsgSlider {
    background-color: black;
  }
  
 input:checked + .gbbVideoMsgSlider:before {
    -webkit-transform: translateX(16px);
    -ms-transform: translateX(16px);
    
    transform: translateX(16px);
  }
  
 
 
  /* Rounded sliders */
  .slider.round, .gbbVideoMsgSlider {
    border-radius: 34px;
  }
  
  .slider.round:before, .gbbVideoMsgSlider:before {
    border-radius: 50%;
    border: 1px solid black;
  }


  /* ============================================================================video message  */
  .gbbVideoPlayerHide {
    display: none !important;
  }

  .gbbVideoMsgPlayerWrapper {
    /* height: 100vh; */
    z-index: 10000000000000;
    display: none;
    align-items: center;
    justify-items: center;
    width: 100%;
    /* position: fixed; */
    top: 30px;
    margin: 10px auto;
  }

  .gbbRecorder {
  
    width: 100%;
    min-height: 250px;
    position: relative;
    border-radius: 2%;
    overflow: hidden;
  }

  .gbbVideoPlayer,
  .gbbVideoPlayerRecording {
    width: 100%;
    height: auto;
  }
 
  .gbbRecorderCloseBtn {
    position: absolute;
    z-index: 1;
    left: 2%;
    top: 5%;
    background: transparent;
    border: none;
    display: none;
  }

  .gbbRecorderCloseBtn img {
    height: 30px;
    width: 30px;
    filter: invert(90%);
    cursor: pointer;
  }

  .gbbVideoPlayerStartBtn,
  .gbbVideoPlayerStopBtn {
    position: absolute;
    bottom: 2%;
    left: 50%;
    transform: translateX(-50%);
    cursor: pointer;
    height: 60px;
    width: 60px;
    border-radius: 50%;
    border: none;
    background-color: transparent;
  }

  .gbbVideoPlayerStartBtn {
    background-color: white;
  }

  .gbbVideoPlayerStopBtn {
    background-color: red;
  }

  .gbbVideoPlayerRedDot,
  .gbbVideoPlayerRedSquare {
    height: 20px;
    width: 20px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  .gbbVideoPlayerRedDot {
    background-color: red;
    border-radius: 50%;
  }

  .gbbVideoPlayerRedSquare {
    background-color: white;
    border-radius: 10%;
  }

  .gbbPermissionDenied {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 16px;
  }

  .gbbVideoPlayerTimeLeft {
    position: absolute;
    bottom: 4%;
    right: 4%;
    color: white;
    font-size: 12px;
    background: black;
    padding: 4px;
    color: white;
    opacity: 0.7;  
  }

  .gbbVideoPlayerStatus {
    position: absolute;
    bottom: 4%;
    left: 4%;
    font-size: 12px;
    padding: 4px;
    background-color: black;
    color: white;
    opacity: 0.7;
  }

  

  .gbbVideoPlayerControls {
    width: 100%;
    text-align: center;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1;
    display: grid;
    /* grid-template-columns: repeat(3, 1fr); */
    justify-content: space-evenly;
    align-items: center;
  }

  .gbbLoadingHeading {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1;
    color: white;
    font-size: 20px;
  }

  .gbbUploadingVideoHeading {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1;
    color: #e3dada;
    font-size: 16px;
    text-align: center;
    line-height: 40px;
  }

  .gbbVideoPlayerControlsAcceptBtnDiv, 
  .gbbVideoPlayerControlsPlayBtnDiv, 
  .gbbVideoPlayerControlsReStartBtnDiv{
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  .gbbVideoPlayerControlsReStartBtnDiv,
  .gbbVideoPlayerControlsAcceptBtnDiv{
    display: none;
  }

  .gbbVideoPlayerControlsBtnDivInfo{
    font-size: 12px;
    color: white;
    margin: 0 0 8px 0; 
  }

  .gbbVideoPlayerControlsAcceptBtn,
  .gbbVideoPlayerControlsPlayBtn,
  .gbbVideoPlayerControlsReStartBtn {
    background-color: transparent;
    height: 90px;
    width: 90px;
    border-radius: 50%;
    cursor: pointer;
    border:0;
    /* margin-right: 20px; */
  }

  old.gbbVideoPlayerControlsAcceptBtn {
    border: 5px solid #3ce669;
  }

  old.gbbVideoPlayerControlsPlayBtn {
    border: 5px solid #d3d3d3;
  }

  old.gbbVideoPlayerControlsReStartBtn {
    border: 5px solid #e03838;
  }

  .gbbVideoPlayerControlsAcceptBtnImg,
  .gbbVideoPlayerControlsPlayBtnImg,
  .gbbVideoPlayerControlsReStartBtnImg {
    height: auto;
    width: 100%;
  }

  old.gbbVideoPlayerControlsAcceptBtnImg {
    filter: invert(69%) sepia(59%) saturate(537%) hue-rotate(80deg) brightness(98%) contrast(93%);
  }

  old.gbbVideoPlayerControlsPlayBtnImg {
    filter: invert(100%) sepia(0) saturate(7500%) hue-rotate(116deg) brightness(80%) contrast(109%);
  }

  old.gbbVideoPlayerControlsReStartBtnImg {
    filter: invert(23%) sepia(77%) saturate(3858%) hue-rotate(348deg) brightness(98%) contrast(80%);
  }

  /* 500px and down */
  @media only screen and (max-width: 600px) {
    .gbbVideoPlayerRecording {
      object-fit: cover;
      height: 100%;
    }
    .gbbRecorder {
      min-height: 36vh;
    }
    .gbbVideoPlayer,
  .gbbVideoPlayerRecording{
    width: 100%;
    object-fit: cover;
    position: absolute;
    height: 100%;
  }
    .gbbVideoPlayerControlsAcceptBtn,
    .gbbVideoPlayerControlsPlayBtn,
    .gbbVideoPlayerControlsReStartBtn {
      height: 50px;
      width: 50px;
    }

    .gbbVideoPlayerControlsAcceptBtnImg,
    .gbbVideoPlayerControlsPlayBtnImg,
    .gbbVideoPlayerControlsReStartBtnImg {
      height: 40px;
      width: 40px;
    }
  }

  /* 350px and down */
  @media only screen and (max-width: 600px) {
    .gbbVideoPlayerStartBtn,
    .gbbVideoPlayerStopBtn {
      height: 40px;
      width: 40px;
    }

    .gbbVideoPlayerRedDot,
    .gbbVideoPlayerRedSquare {
      width: 10px;
      height: 10px;
    }
    .gbbGiftMessageV2InputFieldsDiv textarea {
      height: 80px;
    }

  }
  .gbbGiftCardMessageContent{
    overflow-y:auto;
  }

  
  /* Track */
  .gbbGiftCardMessageContent  ::-webkit-scrollbar-track,.gbbGreetingCardListWrapper ::-webkit-scrollbar-track  {
    background: #f1f1f1; 
  }
   
  /* Handle */
   .gbbGiftCardMessageContent  ::-webkit-scrollbar-thumb,.gbbGreetingCardListWrapper ::-webkit-scrollbar-thumb{
    background: #2c2c2c 0% 0% no-repeat padding-box;
  }



  
  /* Handle on hover */
  .gbbGiftCardMessageContent  ::-webkit-scrollbar-thumb:hover, .gbbGreetingCardListWrapper ::-webkit-scrollbar-thumb:hover {
    background: #000000 0% 0% no-repeat padding-box;
  }

  /* Extra small devices (phones, 600px and down) */
  /* @media only screen and (max-width: 800px) {
    .gbbRecorder {
      width: 375px;
      height: 650px;
      background-color: black;
    }

    .gbbVideoPlayer,
    .gbbVideoPlayerRecording {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .gbbVideoPlayerRecording {
      object-fit: contain;
    }

    .gbbVideoPlayerControls {
      width: 80%;
    }

    .gbbVideoPlayerControlsAcceptBtn,
    .gbbVideoPlayerControlsPlayBtn,
    .gbbVideoPlayerControlsReStartBtn {
      margin-right: 7px;
    }

    .gbbVideoPlayerTimeLeft,
    .gbbVideoPlayerStatus {
      font-size: 18px;
      background-color: rgba(0,0,0,0.2);
      padding: 2px 4px;
    }

  } */


  /* @media only screen and (max-width: 850px) {} */

  /* Small devices (portrait tablets and large phones, 600px and up) */
  /* @media only screen and (min-width: 600px) {} */

  /* Medium devices (landscape tablets, 768px and up) */
  /* @media only screen and (min-width: 768px) {} */

  /* Large devices (laptops/desktops, 992px and up) */
  @media only screen and (min-width: 900px) {
    .gbbRecorder {
      min-height: 180px;
      height: 100%;
    }
    .gbbRecord,.gbbRecorded{
      height: 100%;
    }
    .gbbVideoPlayer, .gbbVideoPlayerRecording{
      width: 100%;
      object-fit: cover;
      height: 100%;
    }
    .gbbVideoMsgPlayerWrapper{
      height: auto;  
    }
   
    .gbbGiftCardMessageContent{
      max-height: 350px;
    } 

  }

  /* Extra large devices (large laptops and desktops, 1200px and up) */
  /* @media only screen and (min-width: 1200px) {}  */


  .giftMessageDeliveryInfo{
    font-size: 12px;
    /* font-style: italic; */
    color: #8c8c8c;    
  }
  
.gbbVideoMsgEmailField{
  margin: 0px;
  padding: 10px 18px;
  /* width: 100%; */
  /* background-color: #ffffff; */
  color: #000000;
  max-width: 100%;
  line-height: 1.2;
  border-radius: 2px;
  padding-bottom: 10px;
  border: 1px solid #A2A2A2;
  font-size: 14px !important;
  background: none;
}



.gbbEmailValidationError{
  color: #ff0000;
  font-size: 14px;
  margin-top: 5px;
}

.gbbVideoMessageHTML{
    height: fit-content;
    /* background: #f1f2f3; */
    /* background-color: white; */
    background: none;
    display: grid;
    grid-gap: 5px;
}


.gbbGreetingCardDropDownWrapper,.gbbGiftWrapDropDownWrapper,
.gbbGiftMessageV2Label,.gbbScheduleDeliveryDateLabel,
.gbbEmailAddressLabelField{
  font-weight: 600;
}</style>
    <style>  </style>
    <style></style>
    <style></style>
    <script>  </script>
    <style>  </style>
    <script>
      if (!gbb.state.bundleId){
        gbb.state.bundleId = "2";
      }
    </script>
    <style>
    .gbbLoadingScreen{
    user-select: none;
    z-index: 1;
    /* background: #fff; */
    position: unset;
    top: 0;
    left: 0;
    width: 100%;
    height: 1000px;
    display: grid;
    justify-content: center;
    align-items: center;
    }</style>
    </main><div id="shopify-section-footer" class="shopify-section"><footer class="relative bg-[--backgroundColor] pt-10" style="
    --backgroundColor:#0b464c;
    --textColor:#f7f2e8;
  margin-top:80px;
  ">
  <div class="absolute inset-x-0 -top-[42px] z-10 h-[43px] w-full cursor-default bg-[length:190px_43px] bg-repeat" style="background-image:url(//clean.co/cdn/shop/t/191/assets/wave-bottom-rosemary.svg?v=40788267941191595481734353636);"></div>

  <div class="px-3 lg:px-8">
    <div class="mb-12 flex justify-center">
      <a href="https://clean.co/" title="CleanCo UK" class="block w-[120px]">
        <svg viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g clip-path="url(#prefix__clip0_1058_328)" fill="#F7F2E8"><path d="M94.753 94.75H82.261l-1.998 1.999h16.488V80.26l-1.998 1.998v12.49z"></path><path d="M87.245 89.768h2.528v-2.529l-2.528 2.529z"></path><path d="M83.751 93.26h9.51v-9.51l-1.996 1.996-.003.003v5.513H85.75l-1.998 1.998zM94.753 24.791v12.948l1.998 1.998V22.793H79.804l1.998 1.998h12.951zM24.792 24.791H38.2l1.998-1.998H22.794v17.404l1.998-1.998V24.79z"></path><path d="M36.708 26.283H26.285v10.422l1.998-1.998v-6.426h6.427l1.998-1.998zM89.8 29.755h-3.034l3.034 3.031v-3.031z"></path><path d="M93.26 36.247v-9.964h-9.966l1.998 1.998h5.97v5.967l1.998 1.999zM33.209 29.781h-3.431v3.431l3.43-3.43z"></path><path d="M100.236 40.235V19.307H79.308L60 0 40.692 19.307H19.304v21.386L0 60l19.304 19.304v20.931h20.928L60 120l19.768-19.766h20.468V79.763L120 59.999l-19.764-19.764zM98.23 78.936V98.23H78.936l-2.004 2.004L60 117.168 41.065 98.231H21.312V78.478L2.833 59.998l18.479-18.477v-20.21h20.21L60 2.833l18.479 18.478h19.75v19.75L117.17 60 98.23 78.936z"></path><path d="M29.78 89.767h2.977l-2.977-2.98v2.98z"></path><path d="M26.285 83.292v9.968h9.966l-1.998-1.998h-5.97V85.29l-1.998-1.998z"></path><path d="M24.792 94.75V81.798L22.794 79.8v16.947h16.945l-1.998-1.999h-12.95zM93.26 38.914l-1.999-1.998-3.293-3.293-2.05-2.047-1.997-1.998-4.788-4.788L60 5.657 42.864 22.792l-1.998 1.998-4.788 4.788-1.998 1.998-2.507 2.503L5.654 60 60 114.344l54.345-54.345L93.26 38.914zm3.49 35.852l-1.998 1.998-1.493 1.493-1.998 1.998-3.293 3.292-4.417 4.42L60 111.52 36.449 87.968l-4.875-4.877L8.483 59.999l28.423-28.422 1.998-1.998L60 8.483 70.937 19.42l10.159 10.16 6.872 6.872 1.998 1.998 6.784 6.782 14.767 14.767-11.392 11.39-3.376 3.377z"></path><path d="M31.194 55.4c1.847 0 2.937 1.155 3.353 2.466a.3.3 0 00.356.198l2.6-.6a.306.306 0 00.22-.4c-.898-2.675-3.372-4.496-6.529-4.496-4.248 0-7.182 2.934-7.182 7.428s2.75 7.511 7.162 7.511c3.276 0 5.755-2.012 6.524-4.593a.307.307 0 00-.215-.39l-2.509-.647a.304.304 0 00-.367.198c-.472 1.52-1.649 2.6-3.413 2.6-2.503 0-3.837-2.093-3.837-4.699 0-2.77 1.456-4.577 3.837-4.577v.001zM50.525 66.917v-2.202a.305.305 0 00-.305-.305h-6.696a.305.305 0 01-.305-.305V53.161a.305.305 0 00-.305-.305h-2.612a.305.305 0 00-.305.305v13.756c0 .168.137.305.305.305h9.918a.305.305 0 00.305-.305zM64.376 66.916v-2.181a.305.305 0 00-.304-.305H56.02a.305.305 0 01-.305-.305V61.43c0-.168.137-.305.305-.305h5.137a.305.305 0 00.305-.305V58.64a.305.305 0 00-.305-.305h-5.137a.305.305 0 01-.305-.305v-2.12c0-.168.137-.305.305-.305h7.742a.305.305 0 00.305-.305v-2.14a.305.305 0 00-.305-.306H52.8a.305.305 0 00-.305.305v13.756c0 .168.137.305.305.305h11.273a.305.305 0 00.304-.305v.002zM74.851 53.062a.305.305 0 00-.288-.206h-3.998a.305.305 0 00-.288.203l-4.795 13.756a.304.304 0 00.288.404h2.756c.132 0 .25-.085.29-.21l.808-2.512a.304.304 0 01.29-.212h5.116c.133 0 .251.087.29.214l.79 2.508c.04.127.157.214.29.214h2.88a.304.304 0 00.289-.404l-4.716-13.755h-.002zm-.856 8.576H70.95a.306.306 0 01-.29-.398l1.53-4.75c.091-.283.49-.283.58 0l1.515 4.75a.305.305 0 01-.29.397v.001zM94.484 52.856h-2.468a.305.305 0 00-.305.305v7.468c0 .31-.41.422-.566.155l-4.599-7.778a.307.307 0 00-.263-.15h-4.406a.305.305 0 00-.305.305v13.756c0 .168.137.305.305.305h2.47a.305.305 0 00.305-.305v-9.973c0-.31.409-.423.566-.155l6.096 10.284a.305.305 0 00.262.149h2.907a.305.305 0 00.305-.305V53.16a.305.305 0 00-.305-.305h.001zM45.88 48.858h2.417c.073 0 .107-.038.107-.114V48.2c0-.072-.036-.107-.107-.107H46.88a.291.291 0 01-.217-.092.307.307 0 01-.089-.222V46.52c0-.086.032-.158.093-.218a.296.296 0 01.213-.089h1.018c.07 0 .107-.036.107-.107V45.6c0-.067-.036-.1-.107-.1H46.88a.31.31 0 01-.21-.086.284.284 0 01-.096-.223v-1.013c0-.087.03-.16.09-.219a.293.293 0 01.216-.09h1.345c.072 0 .107-.038.107-.114v-.51c0-.07-.036-.105-.107-.105h-2.344c-.072 0-.107.036-.107.106v5.499c0 .077.036.114.107.114zM49.441 47.879c.286.715.786 1.073 1.502 1.073.452 0 .82-.134 1.105-.401.284-.268.426-.627.426-1.08 0-.406-.2-.813-.601-1.223a196.69 196.69 0 00-1.115-.958c-.406-.338-.609-.624-.609-.858 0-.19.066-.363.197-.518a.602.602 0 01.475-.233c.305 0 .554.208.744.622.048.105.078.179.093.222.029.062.07.084.121.065l.457-.158c.058-.019.076-.057.058-.114-.11-.372-.283-.67-.522-.894a1.364 1.364 0 00-.95-.364c-.387 0-.709.116-.965.35-.282.253-.423.593-.423 1.022 0 .372.196.754.587 1.144.358.31.718.62 1.08.93.391.353.587.674.587.965a.75.75 0 01-.2.543c-.134.138-.315.208-.544.208-.263 0-.486-.133-.672-.4a2.02 2.02 0 01-.264-.602c-.02-.062-.06-.083-.121-.065l-.53.186c-.052.015-.07.05-.05.107.048.176.092.32.136.43h-.002zM53.08 43.824h.88c.08 0 .148.031.2.093.054.062.079.13.079.207v4.64c0 .063.031.093.092.093h.587c.053 0 .078-.031.078-.093v-4.64c0-.076.031-.145.093-.208a.278.278 0 01.2-.092h.88c.067 0 .1-.031.1-.092v-.508c0-.057-.035-.086-.1-.086h-3.09c-.062 0-.092.029-.092.086v.508c0 .062.032.092.093.092zM57.193 48.858h.607c.072 0 .107-.045.107-.135V47.9c0-.072-.036-.107-.107-.107h-.607c-.072 0-.107.036-.107.107v.822c0 .09.036.135.107.135zM61.111 48.858h2.581c.063 0 .093-.031.093-.092v-.5c0-.063-.031-.093-.093-.093h-1.5c-.12 0-.18-.058-.18-.172 0-.038.039-.102.114-.193.54-.677.902-1.155 1.088-1.437.424-.653.636-1.192.636-1.617v-.336c0-.377-.127-.697-.38-.962a1.223 1.223 0 00-.915-.397h-.194c-.362 0-.671.133-.93.4a1.33 1.33 0 00-.386.958v.193c0 .063.036.093.108.093h.599c.062 0 .093-.032.093-.093v-.107c0-.214.058-.402.175-.565.116-.162.261-.242.436-.242s.328.074.444.222c.117.147.174.343.174.585v.158c0 .396-.261.984-.786 1.766-.085.128-.49.674-1.215 1.638a.33.33 0 00-.058.2v.5c0 .063.031.093.093.093h.003zM66.367 48.937h.029c.4 0 .742-.146 1.022-.44.282-.293.423-.65.423-1.07v-2.859c0-.415-.14-.77-.423-1.066a1.359 1.359 0 00-1.022-.442h-.029c-.405 0-.75.147-1.033.442-.283.296-.425.65-.425 1.066v2.86c0 .415.142.77.425 1.065.283.295.628.443 1.033.443v.001zm-.636-4.283c0-.238.065-.447.193-.625.129-.179.29-.267.486-.267s.36.088.49.267c.13.179.197.388.197.625v2.668c0 .244-.066.454-.197.632-.13.18-.294.268-.49.268-.195 0-.357-.09-.486-.268a1.057 1.057 0 01-.193-.632v-2.668zM68.755 44.447h.587c.067 0 .116.024.15.072.033.048.05.092.05.136v4.11c0 .063.031.093.093.093h.586c.072 0 .107-.031.107-.092v-5.542c0-.057-.036-.086-.107-.086h-.278c-.014 0-.094.065-.236.193-.22.205-.52.416-.902.636-.094.058-.142.092-.142.107v.258c0 .076.03.114.093.114h-.001zM72.538 46.72a.972.972 0 00.693-.272c.068-.062.117-.092.15-.092.1 0 .15.055.15.164v1.059a.646.646 0 01-.186.464.6.6 0 01-.45.193.552.552 0 01-.457-.218.848.848 0 01-.171-.54c0-.058-.032-.085-.093-.085h-.558c-.062 0-.092.029-.092.085v.121c0 .372.125.688.375.948.251.26.557.39.92.39h.157c.362 0 .672-.13.93-.39a1.3 1.3 0 00.386-.948v-2.895a1.76 1.76 0 00-.415-1.173c-.268-.314-.582-.471-.944-.471h-.143c-.363 0-.675.135-.937.408-.263.27-.394.589-.394.95v1.194c0 .305.107.566.322.782.214.218.466.326.758.326h-.001zm-.322-2.195a.82.82 0 01.186-.511c.124-.16.274-.24.45-.24h.043c.177 0 .327.08.45.24a.82.82 0 01.186.51v.788c0 .181-.06.35-.178.508-.129.176-.282.264-.458.264h-.043a.588.588 0 01-.45-.2.671.671 0 01-.186-.472v-.887zM52.223 73.625c1.847 0 2.936 1.154 3.353 2.466a.3.3 0 00.356.198l2.6-.6a.306.306 0 00.219-.4c-.898-2.676-3.37-4.496-6.528-4.496-4.248 0-7.182 2.935-7.182 7.43 0 4.493 2.75 7.51 7.162 7.51 3.276 0 5.755-2.011 6.524-4.594a.307.307 0 00-.215-.388l-2.509-.648a.304.304 0 00-.367.198c-.472 1.52-1.649 2.6-3.413 2.6-2.503 0-3.838-2.093-3.838-4.7 0-2.769 1.457-4.575 3.838-4.575v-.001zM67.614 70.792c-4.35 0-7.409 3.078-7.409 7.47 0 4.392 3.058 7.47 7.409 7.47s7.409-3.078 7.409-7.47c0-4.392-3.058-7.47-7.41-7.47zm0 12.108c-2.401 0-4.043-1.847-4.043-4.638s1.642-4.638 4.043-4.638c2.401 0 4.063 1.847 4.063 4.638S70.015 82.9 67.614 82.9z"></path></g><defs><clippath id="prefix__clip0_1058_328"><path fill="#fff" d="M0 0h120v120H0z"></path></clippath></defs>
        </svg>
      </a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 md:gap-8 lg:grid-cols-3 xl:grid-cols-4 xl:gap-0"><div class="flex flex-col border-b-2 border-solid border-[--textColor] md:border-b-0">
            <input type="checkbox" id="footer-menu-quick-links" class="peer sr-only">

            <label for="footer-menu-quick-links" class="group flex cursor-pointer items-center justify-between py-6 font-ultramagnetic uppercase text-[--textColor] md:mb-4 md:cursor-default md:py-0">Quick Links<svg class="w-4 group-peer-checked:rotate-45 md:hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
                <path d="M35 21h-8v-8a1 1 0 00-1-1h-4a1 1 0 00-1 1v8h-8a1 1 0 00-1 1v4a1 1 0 001 1h8v8a1 1 0 001 1h4a1 1 0 001-1v-8h8a1 1 0 001-1v-4a1 1 0 00-1-1z" fill="currentColor"></path>
              </svg>
            </label>

            <ul class="hidden flex-col gap-3 pb-6 peer-checked:flex md:flex md:pb-0"><li>
                  <a href="https://clean.co/blogs/clean-cocktails" title="Clean Cocktails" class="text-[15px] text-[--textColor] transition-all hover:opacity-60">Clean Cocktails</a>
                </li><li>
                  <a href="https://clean.co/blogs/news" title="The Clean Chronicles" class="text-[15px] text-[--textColor] transition-all hover:opacity-60">The Clean Chronicles</a>
                </li><li>
                  <a href="https://clean.co/pages/store-locations" title="Stockists" class="text-[15px] text-[--textColor] transition-all hover:opacity-60">Stockists</a>
                </li></ul>
          </div><div class="flex flex-col border-b-2 border-solid border-[--textColor] md:border-b-0">
            <input type="checkbox" id="footer-menu-about" class="peer sr-only">

            <label for="footer-menu-about" class="group flex cursor-pointer items-center justify-between py-6 font-ultramagnetic uppercase text-[--textColor] md:mb-4 md:cursor-default md:py-0">About<svg class="w-4 group-peer-checked:rotate-45 md:hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
                <path d="M35 21h-8v-8a1 1 0 00-1-1h-4a1 1 0 00-1 1v8h-8a1 1 0 00-1 1v4a1 1 0 001 1h8v8a1 1 0 001 1h4a1 1 0 001-1v-8h8a1 1 0 001-1v-4a1 1 0 00-1-1z" fill="currentColor"></path>
              </svg>
            </label>

            <ul class="hidden flex-col gap-3 pb-6 peer-checked:flex md:flex md:pb-0"><li>
                  <a href="https://clean.co/pages/faqs" title="FAQs" class="text-[15px] text-[--textColor] transition-all hover:opacity-60">FAQs</a>
                </li><li>
                  <a href="https://clean.co/pages/about-cleanco-story" title="Our Story" class="text-[15px] text-[--textColor] transition-all hover:opacity-60">Our Story</a>
                </li><li>
                  <a href="https://clean.co/pages/contact-us" title="Contact Us" class="text-[15px] text-[--textColor] transition-all hover:opacity-60">Contact Us</a>
                </li><li>
                  <a href="https://clean.co/pages/rewards" title="Loyalty Program" class="text-[15px] text-[--textColor] transition-all hover:opacity-60">Loyalty Program</a>
                </li></ul>
          </div><div class="flex flex-col border-b-2 border-solid border-[--textColor] md:border-b-0">
            <input type="checkbox" id="footer-menu-more-info" class="peer sr-only">

            <label for="footer-menu-more-info" class="group flex cursor-pointer items-center justify-between py-6 font-ultramagnetic uppercase text-[--textColor] md:mb-4 md:cursor-default md:py-0">More Info<svg class="w-4 group-peer-checked:rotate-45 md:hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
                <path d="M35 21h-8v-8a1 1 0 00-1-1h-4a1 1 0 00-1 1v8h-8a1 1 0 00-1 1v4a1 1 0 001 1h8v8a1 1 0 001 1h4a1 1 0 001-1v-8h8a1 1 0 001-1v-4a1 1 0 00-1-1z" fill="currentColor"></path>
              </svg>
            </label>

            <ul class="hidden flex-col gap-3 pb-6 peer-checked:flex md:flex md:pb-0"><li>
                  <a href="https://clean.co/policies/shipping-policy" title="Shipping Policy" class="text-[15px] text-[--textColor] transition-all hover:opacity-60">Shipping Policy</a>
                </li><li>
                  <a href="https://clean.co/policies/refund-policy" title="Refund Policy" class="text-[15px] text-[--textColor] transition-all hover:opacity-60">Refund Policy</a>
                </li><li>
                  <a href="https://clean.co/policies/terms-of-service" title="Terms &amp; Conditions" class="text-[15px] text-[--textColor] transition-all hover:opacity-60">Terms &amp; Conditions</a>
                </li><li>
                  <a href="https://clean.co/policies/privacy-policy" title="Privacy Policy" class="text-[15px] text-[--textColor] transition-all hover:opacity-60">Privacy Policy</a>
                </li></ul>
          </div><div class="flex flex-col lg:col-span-3 xl:col-span-1  mt-10 lg:mt-0">
            <h6 class="mb-4 font-ultramagnetic uppercase text-[--textColor]">Sign up to our newsletter &amp; get 10% off</h6>

            <klaviyo-newsletter class="group mb-8" data-discount-code="TOMORROW" data-success-message="Thanks. Enter code TOMORROW at checkout" client:idle="">
              <form action="https://manage.kmail-lists.com/subscriptions/subscribe" method="POST" target="_blank" novalidate="" class="flex flex-col gap-4">
                <input type="hidden" name="g" value="NAXUEJ">
                <input type="hidden" name="$fields" value="$consent,$source,$method_type,$method_id,$consent_version">
                <input type="hidden" name="$list_fields" value="$consent">
                <input type="hidden" name="$consent" value="email">
                <input type="hidden" name="$source" value="newsletter_signup_incentive_form_footer">
                <input type="hidden" name="$method_type" value="Klaviyo Form">
                <input type="hidden" name="$method_id" value="embed">
                <input type="hidden" name="$consent_version" value="Explicit Newsletter Signup Form">

                <div class="flex rounded-md border-2 border-solid border-[--textColor] p-1.5">
                  <label for="Email-61ecc3f2-0091-4d21-ae54-ae000aa28568" class="sr-only"></label>
                  <input type="email" value="" name="email" id="Email-61ecc3f2-0091-4d21-ae54-ae000aa28568" placeholder="Enter email address" autocorrect="off" autocapitalize="off" autocomplete="email" class="grow bg-transparent pl-2 text-[15px] text-ice placeholder:text-ice/50 focus:outline-none">

                  <button type="submit" class="relative shrink overflow-hidden rounded-md bg-ice px-2.5 py-1 font-gtpressura text-[15px] uppercase text-rosemary transition-all hover:bg-blue hover:text-ice group-loading:pointer-events-none group-loading:cursor-default">
                    Sign Up

                    <span class="invisible absolute inset-0 flex h-full w-full items-center justify-center bg-ice opacity-0 group-loading:visible group-loading:opacity-100">
                      <svg class="w-4 animate-spin text-rosemary" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
                        <g fill="currentColor"><path d="M24 48a24 24 0 1124-24 24.027 24.027 0 01-24 24zm0-44a20 20 0 1020 20A20.023 20.023 0 0024 4z" opacity=".4"></path><path d="M48 24h-4A20.023 20.023 0 0024 4V0a24.028 24.028 0 0124 24z"></path></g>
                      </svg>
                    </span>
                  </button>
                </div>
              </form>
            </klaviyo-newsletter><ul class="flex flex-wrap gap-8"><li>
                    <a href="https://www.facebook.com/clean.co/" title="Facebook" target="_blank" class="text-[--textColor] transition-all hover:opacity-60">
                      <svg class="w-3" viewBox="0 0 12 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9.81 3.985H12V.169C11.622.117 10.322 0 8.808 0 5.65 0 3.486 1.987 3.486 5.639V9H0v4.266h3.486V24h4.273V13.267h3.345l.531-4.266H7.758V6.062c.001-1.233.333-2.077 2.051-2.077z" fill="currentColor"></path>
                      </svg>
                    </a>
                  </li><li>
                    <a href="https://www.instagram.com/cleanco/" title="Instagram" target="_blank" class="text-[--textColor] transition-all hover:opacity-60">
                      <svg class="w-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M23.381 4.144c.296.76.502 1.637.558 2.912.056 1.28.061 1.688.061 4.946 0 3.259-.014 3.667-.07 4.947-.057 1.275-.263 2.147-.558 2.911a6.14 6.14 0 01-3.513 3.512c-.76.295-1.636.501-2.912.558-1.28.056-1.688.07-4.947.07-3.259 0-3.667-.014-4.947-.07-1.276-.057-2.148-.263-2.912-.558a5.908 5.908 0 01-2.125-1.383A5.918 5.918 0 01.628 19.86C.333 19.1.127 18.224.07 16.95.014 15.669 0 15.26 0 12.002c0-3.258.014-3.666.075-4.95.056-1.276.263-2.148.558-2.912.3-.797.774-1.524 1.383-2.124A5.857 5.857 0 014.146.628C4.905.333 5.781.127 7.056.07 8.337.014 8.746 0 12.005 0c3.259 0 3.667.014 4.952.075 1.275.056 2.147.263 2.912.558.797.3 1.524.774 2.124 1.383a5.856 5.856 0 011.388 2.128zm-2.016 14.938c.164-.422.36-1.055.412-2.227.056-1.266.07-1.64.07-4.843 0-3.202-.014-3.582-.07-4.848-.051-1.167-.248-1.805-.412-2.227a3.731 3.731 0 00-.896-1.378 3.69 3.69 0 00-1.379-.896c-.422-.164-1.055-.36-2.227-.412-1.262-.057-1.641-.07-4.849-.07-3.203 0-3.583.013-4.849.07-1.167.051-1.805.248-2.227.412-.52.192-.99.497-1.379.896a3.648 3.648 0 00-.9 1.378c-.164.422-.361 1.055-.413 2.227-.056 1.261-.07 1.646-.07 4.848s.014 3.582.07 4.848c.052 1.167.249 1.805.413 2.227.192.52.497.99.895 1.378.385.399.859.704 1.38.896.421.164 1.054.36 2.226.412 1.262.057 1.647.07 4.85.07 3.202 0 3.582-.013 4.848-.07 1.168-.051 1.805-.248 2.227-.412a3.982 3.982 0 002.28-2.279z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M5.144 12A6.859 6.859 0 0112 5.143 6.859 6.859 0 0118.858 12 6.859 6.859 0 0112 18.857 6.859 6.859 0 015.144 12zm2.41 0a4.449 4.449 0 108.897-.002A4.449 4.449 0 007.553 12z" fill="currentColor"></path><path d="M18.858 6a.857.857 0 11-1.714 0 .857.857 0 011.714 0z" fill="currentColor"></path>
                      </svg>
                    </a>
                  </li></ul></div></div>
  </div><div class="pt-24">
  
  <svg class="hidden w-full text-[--textColor] md:block" viewBox="0 0 1800 125.9" fill="none" xmlns="http://www.w3.org/2000/svg">
<style type="text/css">
	.st0{fill:currentColor;}
</style>
<g>
	<path class="st0" d="M9.1,118.4c-0.6-0.6-0.9-1.4-0.9-2.2V12.7c0-0.8,0.3-1.6,0.9-2.2c0.6-0.6,1.4-0.9,2.2-0.9H29
		c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2v81.1c0,1,0.5,1.6,1.6,1.6h34.2c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2
		v17.7c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9H11.3C10.5,119.3,9.8,119,9.1,118.4z"></path>
	<path class="st0" d="M84.6,118.4c-0.6-0.6-0.9-1.4-0.9-2.2V12.7c0-0.8,0.3-1.6,0.9-2.2c0.6-0.6,1.4-0.9,2.2-0.9h17.7
		c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2v103.5c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9H86.7
		C85.9,119.3,85.2,119,84.6,118.4z"></path>
	<path class="st0" d="M129.9,118.4c-0.6-0.6-0.9-1.4-0.9-2.2V12.7c0-0.8,0.3-1.6,0.9-2.2c0.6-0.6,1.4-0.9,2.2-0.9h54.4
		c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2v17.1c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-32c-1,0-1.6,0.5-1.6,1.6
		v16.9c0,1,0.5,1.6,1.6,1.6h30.4c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2v17.2c0,0.8-0.3,1.6-0.9,2.2
		c-0.6,0.6-1.4,0.9-2.2,0.9h-30.4c-1,0-1.6,0.5-1.6,1.6v38.1c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-17.7
		C131.2,119.3,130.5,119,129.9,118.4z"></path>
	<path class="st0" d="M205.9,118.4c-0.6-0.6-0.9-1.4-0.9-2.2V12.7c0-0.8,0.3-1.6,0.9-2.2c0.6-0.6,1.4-0.9,2.2-0.9h56.3
		c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2V30c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-33.9c-1,0-1.6,0.5-1.6,1.6V50
		c0,1,0.5,1.6,1.6,1.6h32.6c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2V72c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9
		h-32.6c-1,0-1.6,0.5-1.6,1.6v17.6c0,1,0.5,1.6,1.6,1.6H265c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2v17.2
		c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-56.9C207.3,119.3,206.5,119,205.9,118.4z"></path>
	<path class="st0" d="M335.9,118.4c-0.6-0.6-0.9-1.4-0.9-2.2V35.1c0-1-0.5-1.6-1.6-1.6h-19.1c-0.8,0-1.6-0.3-2.2-0.9
		c-0.6-0.6-0.9-1.4-0.9-2.2V12.7c0-0.8,0.3-1.6,0.9-2.2c0.6-0.6,1.4-0.9,2.2-0.9h65.5c0.8,0,1.6,0.3,2.2,0.9
		c0.6,0.6,0.9,1.4,0.9,2.2v17.7c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-19.1c-1,0-1.6,0.5-1.6,1.6v81.1
		c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-17.9C337.3,119.3,336.5,119,335.9,118.4z"></path>
	<path class="st0" d="M379.8,118c-0.5-0.9-0.7-1.9-0.5-2.9l29.5-103.2c0.5-1.6,1.5-2.4,3-2.4h23.7c1.6,0,2.6,0.8,3,2.4l29.2,103.2
		c0.1,0.2,0.2,0.5,0.2,0.9c0,0.9-0.3,1.7-0.8,2.4c-0.5,0.6-1.3,0.9-2.2,0.9h-19.4c-1.5,0-2.5-0.8-3-2.4l-5-16.8
		c-0.2-0.7-0.5-1.3-0.8-1.6c-0.3-0.4-0.8-0.5-1.4-0.5h-23.8c-0.9,0-1.6,0.6-1.9,1.7l-4.7,17.2c-0.4,1.6-1.4,2.4-3,2.4h-19.4
		C381.2,119.3,380.3,118.9,379.8,118z M414.9,73.6c0,0.4,0.1,0.8,0.4,1.1c0.3,0.3,0.6,0.5,1,0.5h14.3c0.5,0,0.9-0.2,1.2-0.5
		c0.3-0.4,0.3-0.9,0.2-1.5l-7.4-30.4c-0.1-0.7-0.5-1.1-1.3-1.1c-0.5,0-0.9,0.4-1.3,1.1l-7.2,30.4V73.6z"></path>
	<path class="st0" d="M493.7,117.2c-5.9-2.9-10.5-7-13.9-12.3c-3.3-5.3-5-11.4-5-18.3v-0.8c0-0.8,0.3-1.6,0.9-2.2
		c0.6-0.6,1.4-0.9,2.2-0.9h18.7c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2v1.6c0,3.5,1.3,6.3,3.8,8.5c2.6,2.2,5.8,3.3,9.8,3.3
		c4,0,7.2-1.1,9.7-3.2c2.5-2.1,3.8-4.8,3.8-8.1c0-3-0.9-5.5-2.7-7.4c-1.8-1.9-4.6-3.3-8.4-4.4l-13.3-3.6
		c-7.7-2.1-13.8-5.9-18.2-11.5c-4.4-5.6-6.6-12.4-6.6-20.3c0-6.3,1.6-11.9,4.7-17c3.1-5.1,7.5-9,13-11.9c5.5-2.9,11.8-4.3,18.8-4.3
		c7,0,13.2,1.3,18.7,4c5.4,2.7,9.7,6.4,12.7,11.3c3,4.9,4.5,10.4,4.5,16.7v1.1c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-18
		c-0.8,0-1.6-0.3-2.2-0.9c-0.6-0.6-0.9-1.4-0.9-2.2v-1.1c0-2.9-1-5.3-3.1-7c-2.1-1.7-4.9-2.6-8.5-2.6c-3.6,0-6.4,0.9-8.6,2.7
		c-2.2,1.8-3.3,4.1-3.3,6.9c0,2.8,0.9,5.1,2.7,6.8c1.8,1.7,4.8,3.2,8.9,4.3l12.2,3.6c17,5,25.6,15.7,25.6,32.1
		c0,7.1-1.6,13.3-4.9,18.7c-3.3,5.3-7.8,9.4-13.6,12.3c-5.8,2.9-12.2,4.3-19.4,4.3C506.3,121.5,499.6,120.1,493.7,117.2z"></path>
	<path class="st0" d="M585.1,118.4c-0.6-0.6-0.9-1.4-0.9-2.2V35.1c0-1-0.5-1.6-1.6-1.6h-19.1c-0.8,0-1.6-0.3-2.2-0.9
		c-0.6-0.6-0.9-1.4-0.9-2.2V12.7c0-0.8,0.3-1.6,0.9-2.2c0.6-0.6,1.4-0.9,2.2-0.9H629c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2
		v17.7c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-19.1c-1,0-1.6,0.5-1.6,1.6v81.1c0,0.8-0.3,1.6-0.9,2.2
		c-0.6,0.6-1.4,0.9-2.2,0.9h-17.9C586.4,119.3,585.7,119,585.1,118.4z"></path>
	<path class="st0" d="M645.7,118.4c-0.6-0.6-0.9-1.4-0.9-2.2V12.7c0-0.8,0.3-1.6,0.9-2.2c0.6-0.6,1.4-0.9,2.2-0.9h56.3
		c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2V30c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-33.9c-1,0-1.6,0.5-1.6,1.6V50
		c0,1,0.5,1.6,1.6,1.6H703c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2V72c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-32.6
		c-1,0-1.6,0.5-1.6,1.6v17.6c0,1,0.5,1.6,1.6,1.6h34.5c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2v17.2c0,0.8-0.3,1.6-0.9,2.2
		c-0.6,0.6-1.4,0.9-2.2,0.9h-56.9C647.1,119.3,646.4,119,645.7,118.4z"></path>
	<path class="st0" d="M739.6,117.2c-5.9-2.9-10.5-7-13.9-12.3c-3.3-5.3-5-11.4-5-18.3v-0.8c0-0.8,0.3-1.6,0.9-2.2
		c0.6-0.6,1.4-0.9,2.2-0.9h18.7c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2v1.6c0,3.5,1.3,6.3,3.8,8.5c2.6,2.2,5.8,3.3,9.8,3.3
		c4,0,7.2-1.1,9.7-3.2c2.5-2.1,3.8-4.8,3.8-8.1c0-3-0.9-5.5-2.7-7.4s-4.6-3.3-8.4-4.4l-13.3-3.6c-7.7-2.1-13.8-5.9-18.2-11.5
		s-6.6-12.4-6.6-20.3c0-6.3,1.6-11.9,4.7-17c3.1-5.1,7.5-9,13-11.9c5.5-2.9,11.8-4.3,18.8-4.3c7,0,13.2,1.3,18.7,4
		c5.4,2.7,9.7,6.4,12.7,11.3c3,4.9,4.5,10.4,4.5,16.7v1.1c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-18
		c-0.8,0-1.6-0.3-2.2-0.9c-0.6-0.6-0.9-1.4-0.9-2.2v-1.1c0-2.9-1-5.3-3.1-7c-2.1-1.7-4.9-2.6-8.5-2.6c-3.6,0-6.4,0.9-8.6,2.7
		c-2.2,1.8-3.3,4.1-3.3,6.9c0,2.8,0.9,5.1,2.7,6.8c1.8,1.7,4.8,3.2,8.9,4.3l12.2,3.6c17,5,25.6,15.7,25.6,32.1
		c0,7.1-1.6,13.3-4.9,18.7c-3.3,5.3-7.8,9.4-13.6,12.3c-5.8,2.9-12.2,4.3-19.4,4.3C752.2,121.5,745.5,120.1,739.6,117.2z"></path>
	<path class="st0" d="M849.1,118.4c-0.6-0.6-0.9-1.4-0.9-2.2V12.7c0-0.8,0.3-1.6,0.9-2.2c0.6-0.6,1.4-0.9,2.2-0.9h35
		c6.1,0,11.6,1.4,16.5,4.1c5,2.7,8.9,6.4,11.8,11c2.9,4.6,4.4,9.7,4.4,15.2c0,8.7-2.8,15.7-8.5,21c-0.5,0.5-0.8,1.1-0.8,1.7
		c0,0.5,0.3,0.9,0.8,1.3c3.2,2.5,5.7,5.7,7.4,9.7c1.7,4,2.5,8.1,2.5,12.4c0,6.6-1.5,12.4-4.4,17.5c-2.9,5.1-7,9-12.2,11.8
		c-5.2,2.8-11.1,4.2-17.6,4.2h-35C850.5,119.3,849.7,119,849.1,118.4z M873.1,52.4H885c2.7,0,5-1,6.9-3.1c1.9-2.1,2.8-4.5,2.8-7.4
		c0-2.9-0.9-5.5-2.8-7.6c-1.9-2.1-4.2-3.2-6.9-3.2h-11.9c-1,0-1.6,0.5-1.6,1.6v18.2C871.5,51.9,872.1,52.4,873.1,52.4z M873.1,96.6
		h11.6c3.3,0,6-1.1,8.1-3.4c2-2.3,3.1-5.1,3.1-8.3c0-3.1-1-5.9-3.1-8.2c-2.1-2.3-4.8-3.4-8-3.4h-11.6c-1,0-1.6,0.5-1.6,1.6V95
		C871.5,96.1,872.1,96.6,873.1,96.6z"></path>
	<path class="st0" d="M939,118.4c-0.6-0.6-0.9-1.4-0.9-2.2V12.7c0-0.8,0.3-1.6,0.9-2.2c0.6-0.6,1.4-0.9,2.2-0.9h56.3
		c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2V30c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-33.9c-1,0-1.6,0.5-1.6,1.6V50
		c0,1,0.5,1.6,1.6,1.6h32.6c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2V72c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9
		h-32.6c-1,0-1.6,0.5-1.6,1.6v17.6c0,1,0.5,1.6,1.6,1.6h34.5c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2v17.2
		c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-56.9C940.3,119.3,939.6,119,939,118.4z"></path>
	<path class="st0" d="M1035.7,118.4c-0.6-0.6-0.9-1.4-0.9-2.2V35.1c0-1-0.5-1.6-1.6-1.6h-19.1c-0.8,0-1.6-0.3-2.2-0.9
		c-0.6-0.6-0.9-1.4-0.9-2.2V12.7c0-0.8,0.3-1.6,0.9-2.2c0.6-0.6,1.4-0.9,2.2-0.9h65.5c0.8,0,1.6,0.3,2.2,0.9
		c0.6,0.6,0.9,1.4,0.9,2.2v17.7c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-19.1c-1,0-1.6,0.5-1.6,1.6v81.1
		c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-17.9C1037.1,119.3,1036.3,119,1035.7,118.4z"></path>
	<path class="st0" d="M1114.9,118.4c-0.6-0.6-0.9-1.4-0.9-2.2V35.1c0-1-0.5-1.6-1.6-1.6h-19.1c-0.8,0-1.6-0.3-2.2-0.9
		c-0.6-0.6-0.9-1.4-0.9-2.2V12.7c0-0.8,0.3-1.6,0.9-2.2c0.6-0.6,1.4-0.9,2.2-0.9h65.5c0.8,0,1.6,0.3,2.2,0.9
		c0.6,0.6,0.9,1.4,0.9,2.2v17.7c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-19.1c-1,0-1.6,0.5-1.6,1.6v81.1
		c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-17.9C1116.3,119.3,1115.5,119,1114.9,118.4z"></path>
	<path class="st0" d="M1175.6,118.4c-0.6-0.6-0.9-1.4-0.9-2.2V12.7c0-0.8,0.3-1.6,0.9-2.2c0.6-0.6,1.4-0.9,2.2-0.9h56.3
		c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2V30c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-33.9c-1,0-1.6,0.5-1.6,1.6V50
		c0,1,0.5,1.6,1.6,1.6h32.6c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2V72c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9
		h-32.6c-1,0-1.6,0.5-1.6,1.6v17.6c0,1,0.5,1.6,1.6,1.6h34.5c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2v17.2
		c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-56.9C1176.9,119.3,1176.2,119,1175.6,118.4z"></path>
	<path class="st0" d="M1257,118.4c-0.6-0.6-0.9-1.4-0.9-2.2V12.7c0-0.8,0.3-1.6,0.9-2.2c0.6-0.6,1.4-0.9,2.2-0.9h34.2
		c7.1,0,13.3,1.5,18.7,4.5s9.4,7.2,12.3,12.5c2.9,5.3,4.3,11.3,4.3,18c0,6.1-1.3,11.4-3.8,16c-2.6,4.6-6.2,8.7-10.9,12.4
		c-1.2,1-1.7,2-1.7,2.8c0,0.7,0.2,1.5,0.6,2.4L1328,114c0.3,0.7,0.5,1.5,0.5,2.4c0,2-1,3-3.1,3h-17.7c-2.1,0-3.5-0.9-4.1-2.7
		l-15.1-36.2c-0.4-0.9-1.1-1.4-2-1.4h-4.9c-1,0-1.6,0.5-1.6,1.6v35.6c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-17.7
		C1258.3,119.3,1257.6,119,1257,118.4z M1281.6,56.2h11.4c3.1,0,5.7-1.1,7.8-3.3c2.1-2.2,3.1-4.9,3.1-8.2c0-3.5-1-6.2-3.1-8.4
		c-2-2.1-4.7-3.2-7.9-3.2h-11.4c-1,0-1.6,0.5-1.6,1.6v19.9C1280,55.6,1280.5,56.2,1281.6,56.2z"></path>
	<path class="st0" d="M1397.1,117.9c-5.2-2.4-9.4-5.9-12.4-10.3c-3.3-4.3-5.6-9.9-6.8-16.7c-1.2-6.8-1.8-15.7-1.8-26.4
		c0-10.8,0.6-19.6,1.8-26.4c1.2-6.8,3.5-12.4,6.8-16.7c3.1-4.5,7.3-7.9,12.5-10.3c5.2-2.4,11.3-3.6,18.4-3.6
		c11.2,0,20.2,3.2,27.1,9.6c6.9,6.4,10.3,15.4,10.3,27c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-18.2
		c-0.8,0-1.6-0.3-2.3-0.9c-0.7-0.6-1-1.4-1-2.2c0-3.7-1.2-6.7-3.5-9c-2.3-2.4-5.4-3.5-9.4-3.5c-6.2,0-10.3,2.4-12.4,7.1
		c-1.2,2.4-1.9,5.5-2.1,9.4c-0.3,3.9-0.4,9.4-0.4,16.6s0.1,12.8,0.4,16.6c0.3,3.9,1,7,2.1,9.4c2.3,4.7,6.4,7.1,12.4,7.1
		c4,0,7.1-1.1,9.4-3.5c2.3-2.3,3.5-5.3,3.5-9.1c0-0.8,0.3-1.6,1-2.2c0.7-0.6,1.4-0.9,2.3-0.9h18.2c0.8,0,1.6,0.3,2.2,0.9
		c0.6,0.6,0.9,1.4,0.9,2.2c0,11.5-3.4,20.5-10.3,26.9c-6.8,6.4-15.9,9.6-27.2,9.6C1408.5,121.5,1402.4,120.3,1397.1,117.9z"></path>
	<path class="st0" d="M1470.4,118.4c-0.6-0.6-0.9-1.4-0.9-2.2V12.7c0-0.8,0.3-1.6,0.9-2.2c0.6-0.6,1.4-0.9,2.2-0.9h17.7
		c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2v81.1c0,1,0.5,1.6,1.6,1.6h34.2c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2
		v17.7c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-56.6C1471.7,119.3,1471,119,1470.4,118.4z"></path>
	<path class="st0" d="M1545.8,118.4c-0.6-0.6-0.9-1.4-0.9-2.2V12.7c0-0.8,0.3-1.6,0.9-2.2c0.6-0.6,1.4-0.9,2.2-0.9h56.3
		c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2V30c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-33.9c-1,0-1.6,0.5-1.6,1.6V50
		c0,1,0.5,1.6,1.6,1.6h32.6c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2V72c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9
		h-32.6c-1,0-1.6,0.5-1.6,1.6v17.6c0,1,0.5,1.6,1.6,1.6h34.5c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2v17.2
		c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9H1548C1547.1,119.3,1546.4,119,1545.8,118.4z"></path>
	<path class="st0" d="M1618.2,118c-0.5-0.9-0.7-1.9-0.5-2.9l29.5-103.2c0.5-1.6,1.5-2.4,3-2.4h23.7c1.6,0,2.6,0.8,3,2.4l29.2,103.2
		c0.1,0.2,0.2,0.5,0.2,0.9c0,0.9-0.3,1.7-0.8,2.4c-0.5,0.6-1.3,0.9-2.2,0.9h-19.4c-1.5,0-2.5-0.8-3-2.4l-5-16.8
		c-0.2-0.7-0.5-1.3-0.8-1.6c-0.3-0.4-0.8-0.5-1.4-0.5h-23.8c-0.9,0-1.6,0.6-1.9,1.7l-4.7,17.2c-0.4,1.6-1.4,2.4-3,2.4h-19.4
		C1619.6,119.3,1618.8,118.9,1618.2,118z M1653.4,73.6c0,0.4,0.1,0.8,0.4,1.1c0.3,0.3,0.6,0.5,1,0.5h14.3c0.5,0,0.9-0.2,1.2-0.5
		c0.3-0.4,0.3-0.9,0.2-1.5l-7.4-30.4c-0.1-0.7-0.5-1.1-1.3-1.1c-0.5,0-0.9,0.4-1.3,1.1l-7.2,30.4V73.6z"></path>
	<path class="st0" d="M1719.2,118.4c-0.6-0.6-0.9-1.4-0.9-2.2V12.7c0-0.8,0.3-1.6,0.9-2.2c0.6-0.6,1.4-0.9,2.2-0.9h19.4
		c1.8,0,3,0.9,3.8,2.8l20.9,53.2c0.1,0.5,0.5,0.8,1.3,0.8c0.7,0,1.1-0.4,1.1-1.1V12.7c0-0.8,0.3-1.6,0.9-2.2
		c0.6-0.6,1.4-0.9,2.2-0.9h17.7c0.8,0,1.6,0.3,2.2,0.9c0.6,0.6,0.9,1.4,0.9,2.2v103.5c0,0.8-0.3,1.6-0.9,2.2
		c-0.6,0.6-1.4,0.9-2.2,0.9h-19.4c-1.8,0-3-0.9-3.8-2.8l-20.7-53.2c-0.2-0.5-0.7-0.8-1.4-0.8c-0.7,0-1.1,0.4-1.1,1.1v52.5
		c0,0.8-0.3,1.6-0.9,2.2c-0.6,0.6-1.4,0.9-2.2,0.9h-17.7C1720.6,119.3,1719.8,119,1719.2,118.4z"></path>
</g>
</svg>

  <svg class="w-full text-[--textColor] md:hidden" viewBox="0 0 754 214.2" fill="none" xmlns="http://www.w3.org/2000/svg">
<style type="text/css">
	.st0{fill:currentColor;}
</style>
<g>
	<path class="st0" d="M67.6,90.2c-0.5-0.5-0.7-1.1-0.7-1.7V6.5c0-0.7,0.2-1.2,0.7-1.7C68.1,4.3,68.6,4,69.3,4h14
		c0.7,0,1.2,0.2,1.7,0.7s0.7,1.1,0.7,1.7v64.2c0,0.8,0.4,1.2,1.2,1.2h27.1c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7v14
		c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7H69.3C68.6,90.9,68.1,90.6,67.6,90.2z"></path>
	<path class="st0" d="M127.3,90.2c-0.5-0.5-0.7-1.1-0.7-1.7V6.5c0-0.7,0.2-1.2,0.7-1.7S128.4,4,129,4h14c0.7,0,1.2,0.2,1.7,0.7
		s0.7,1.1,0.7,1.7v81.9c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7h-14C128.4,90.9,127.8,90.6,127.3,90.2z"></path>
	<path class="st0" d="M163.2,90.2c-0.5-0.5-0.7-1.1-0.7-1.7V6.5c0-0.7,0.2-1.2,0.7-1.7c0.5-0.5,1.1-0.7,1.7-0.7H208
		c0.7,0,1.2,0.2,1.7,0.7s0.7,1.1,0.7,1.7V20c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7h-25.3c-0.8,0-1.2,0.4-1.2,1.2v13.4
		c0,0.8,0.4,1.2,1.2,1.2h24.1c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7v13.7c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7
		h-24.1c-0.8,0-1.2,0.4-1.2,1.2v30.2c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7h-14C164.2,90.9,163.6,90.6,163.2,90.2z"></path>
	<path class="st0" d="M223.4,90.2c-0.5-0.5-0.7-1.1-0.7-1.7V6.5c0-0.7,0.2-1.2,0.7-1.7s1.1-0.7,1.7-0.7h44.6c0.7,0,1.2,0.2,1.7,0.7
		c0.5,0.5,0.7,1.1,0.7,1.7v13.7c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7h-26.8c-0.8,0-1.2,0.4-1.2,1.2V36
		c0,0.8,0.4,1.2,1.2,1.2h25.8c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7v13.7c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7
		h-25.8c-0.8,0-1.2,0.4-1.2,1.2V71c0,0.8,0.4,1.2,1.2,1.2h27.3c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7v13.7
		c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7h-45.1C224.4,90.9,223.8,90.6,223.4,90.2z"></path>
	<path class="st0" d="M326.3,90.2c-0.5-0.5-0.7-1.1-0.7-1.7V24.2c0-0.8-0.4-1.2-1.2-1.2h-15.1c-0.7,0-1.2-0.2-1.7-0.7
		c-0.5-0.5-0.7-1.1-0.7-1.7v-14c0-0.7,0.2-1.2,0.7-1.7c0.5-0.5,1.1-0.7,1.7-0.7H361c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7
		v14c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7h-15.1c-0.8,0-1.2,0.4-1.2,1.2v64.2c0,0.7-0.2,1.2-0.7,1.7
		c-0.5,0.5-1.1,0.7-1.7,0.7H328C327.3,90.9,326.7,90.6,326.3,90.2z"></path>
	<path class="st0" d="M361,89.8c-0.4-0.7-0.5-1.5-0.4-2.3L384,5.9c0.4-1.2,1.2-1.9,2.4-1.9h18.7c1.2,0,2,0.6,2.4,1.9l23.1,81.7
		c0.1,0.2,0.1,0.4,0.1,0.7c0,0.7-0.2,1.4-0.6,1.9c-0.4,0.5-1,0.7-1.7,0.7h-15.4c-1.2,0-1.9-0.6-2.4-1.9l-4-13.3
		c-0.2-0.6-0.4-1-0.6-1.3c-0.2-0.3-0.6-0.4-1.1-0.4H386c-0.7,0-1.2,0.5-1.5,1.4L380.7,89c-0.3,1.2-1.1,1.9-2.4,1.9H363
		C362.1,90.9,361.4,90.5,361,89.8z M388.8,54.7c0,0.3,0.1,0.6,0.3,0.9c0.2,0.2,0.5,0.4,0.8,0.4h11.3c0.4,0,0.7-0.1,0.9-0.4
		c0.2-0.3,0.3-0.7,0.2-1.2l-5.8-24.1c-0.1-0.6-0.4-0.9-1-0.9c-0.4,0-0.7,0.3-1,0.9l-5.7,24.1V54.7z"></path>
	<path class="st0" d="M451.2,89.2c-4.7-2.3-8.3-5.5-11-9.7c-2.6-4.2-4-9.1-4-14.5v-0.6c0-0.7,0.2-1.2,0.7-1.7
		c0.5-0.5,1.1-0.7,1.7-0.7h14.8c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7v1.2c0,2.7,1,5,3,6.7c2,1.7,4.6,2.6,7.8,2.6
		c3.1,0,5.7-0.8,7.7-2.5c2-1.7,3-3.8,3-6.4c0-2.4-0.7-4.3-2.2-5.8c-1.4-1.5-3.7-2.6-6.6-3.5l-10.6-2.9c-6.1-1.7-10.9-4.7-14.4-9.1
		c-3.5-4.4-5.2-9.8-5.2-16.1c0-5,1.2-9.5,3.7-13.5c2.5-4,5.9-7.2,10.3-9.4c4.4-2.3,9.4-3.4,14.9-3.4c5.5,0,10.5,1.1,14.8,3.2
		c4.3,2.1,7.7,5.1,10.1,8.9c2.4,3.8,3.6,8.3,3.6,13.2v0.9c0,0.7-0.2,1.2-0.7,1.7s-1.1,0.7-1.7,0.7h-14.3c-0.7,0-1.2-0.2-1.7-0.7
		c-0.5-0.5-0.7-1.1-0.7-1.7v-0.9c0-2.3-0.8-4.2-2.5-5.5c-1.7-1.4-3.9-2-6.7-2c-2.8,0-5.1,0.7-6.8,2.1c-1.7,1.4-2.6,3.2-2.6,5.5
		s0.7,4,2.2,5.4c1.4,1.4,3.8,2.5,7,3.4l9.7,2.9c13.5,4,20.2,12.5,20.2,25.4c0,5.6-1.3,10.6-3.9,14.8c-2.6,4.2-6.2,7.5-10.7,9.7
		c-4.6,2.3-9.7,3.4-15.4,3.4C461.1,92.6,455.9,91.5,451.2,89.2z"></path>
	<path class="st0" d="M523.5,90.2c-0.5-0.5-0.7-1.1-0.7-1.7V24.2c0-0.8-0.4-1.2-1.2-1.2h-15.1c-0.7,0-1.2-0.2-1.7-0.7
		c-0.5-0.5-0.7-1.1-0.7-1.7v-14c0-0.7,0.2-1.2,0.7-1.7c0.5-0.5,1.1-0.7,1.7-0.7h51.9c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7
		v14c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7h-15.1c-0.8,0-1.2,0.4-1.2,1.2v64.2c0,0.7-0.2,1.2-0.7,1.7
		c-0.5,0.5-1.1,0.7-1.7,0.7h-14.2C524.6,90.9,524,90.6,523.5,90.2z"></path>
	<path class="st0" d="M571.5,90.2c-0.5-0.5-0.7-1.1-0.7-1.7V6.5c0-0.7,0.2-1.2,0.7-1.7c0.5-0.5,1.1-0.7,1.7-0.7h44.6
		c0.7,0,1.2,0.2,1.7,0.7s0.7,1.1,0.7,1.7v13.7c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7H591c-0.8,0-1.2,0.4-1.2,1.2V36
		c0,0.8,0.4,1.2,1.2,1.2h25.8c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7v13.7c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7
		H591c-0.8,0-1.2,0.4-1.2,1.2V71c0,0.8,0.4,1.2,1.2,1.2h27.3c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7v13.7
		c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7h-45.1C572.6,90.9,572,90.6,571.5,90.2z"></path>
	<path class="st0" d="M645.8,89.2c-4.7-2.3-8.3-5.5-11-9.7c-2.6-4.2-4-9.1-4-14.5v-0.6c0-0.7,0.2-1.2,0.7-1.7
		c0.5-0.5,1.1-0.7,1.7-0.7h14.8c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7v1.2c0,2.7,1,5,3,6.7c2,1.7,4.6,2.6,7.8,2.6
		c3.1,0,5.7-0.8,7.7-2.5c2-1.7,3-3.8,3-6.4c0-2.4-0.7-4.3-2.2-5.8c-1.4-1.5-3.7-2.6-6.6-3.5l-10.6-2.9c-6.1-1.7-10.9-4.7-14.4-9.1
		c-3.5-4.4-5.2-9.8-5.2-16.1c0-5,1.2-9.5,3.7-13.5c2.5-4,5.9-7.2,10.3-9.4c4.4-2.3,9.4-3.4,14.9-3.4c5.5,0,10.5,1.1,14.8,3.2
		c4.3,2.1,7.7,5.1,10.1,8.9c2.4,3.8,3.6,8.3,3.6,13.2v0.9c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7h-14.3
		c-0.7,0-1.2-0.2-1.7-0.7c-0.5-0.5-0.7-1.1-0.7-1.7v-0.9c0-2.3-0.8-4.2-2.5-5.5c-1.7-1.4-3.9-2-6.7-2c-2.8,0-5.1,0.7-6.8,2.1
		c-1.7,1.4-2.6,3.2-2.6,5.5s0.7,4,2.2,5.4c1.4,1.4,3.8,2.5,7,3.4l9.7,2.9c13.5,4,20.2,12.5,20.2,25.4c0,5.6-1.3,10.6-3.9,14.8
		c-2.6,4.2-6.2,7.5-10.7,9.7c-4.6,2.3-9.7,3.4-15.4,3.4C655.8,92.6,650.5,91.5,645.8,89.2z"></path>
	<path class="st0" d="M5,209.1c-0.5-0.5-0.7-1.1-0.7-1.7v-81.9c0-0.7,0.2-1.2,0.7-1.7c0.5-0.5,1.1-0.7,1.7-0.7h27.7
		c4.8,0,9.2,1.1,13.1,3.2c3.9,2.2,7.1,5,9.4,8.7c2.3,3.6,3.5,7.7,3.5,12c0,6.9-2.2,12.4-6.7,16.6c-0.4,0.4-0.6,0.9-0.6,1.4
		c0,0.4,0.2,0.7,0.6,1c2.6,2,4.5,4.6,5.8,7.7c1.3,3.1,2,6.4,2,9.8c0,5.2-1.2,9.8-3.5,13.8c-2.3,4-5.5,7.1-9.6,9.3
		c-4.1,2.2-8.8,3.3-14,3.3H6.7C6,209.8,5.5,209.6,5,209.1z M23.9,156.8h9.4c2.2,0,4-0.8,5.5-2.5c1.5-1.7,2.2-3.6,2.2-5.8
		c0-2.3-0.7-4.3-2.2-6c-1.5-1.7-3.3-2.5-5.5-2.5h-9.4c-0.8,0-1.2,0.4-1.2,1.2v14.4C22.7,156.4,23.1,156.8,23.9,156.8z M23.9,191.8
		h9.2c2.6,0,4.8-0.9,6.4-2.7c1.6-1.8,2.4-4,2.4-6.6c0-2.5-0.8-4.6-2.5-6.5c-1.7-1.8-3.8-2.7-6.3-2.7h-9.2c-0.8,0-1.2,0.4-1.2,1.2v16
		C22.7,191.4,23.1,191.8,23.9,191.8z"></path>
	<path class="st0" d="M76.1,209.1c-0.5-0.5-0.7-1.1-0.7-1.7v-81.9c0-0.7,0.2-1.2,0.7-1.7c0.5-0.5,1.1-0.7,1.7-0.7h44.6
		c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7v13.7c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7H95.6c-0.8,0-1.2,0.4-1.2,1.2
		V155c0,0.8,0.4,1.2,1.2,1.2h25.8c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7v13.7c0,0.7-0.2,1.2-0.7,1.7
		c-0.5,0.5-1.1,0.7-1.7,0.7H95.6c-0.8,0-1.2,0.4-1.2,1.2V190c0,0.8,0.4,1.2,1.2,1.2h27.3c0.7,0,1.2,0.2,1.7,0.7
		c0.5,0.5,0.7,1.1,0.7,1.7v13.7c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7H77.8C77.2,209.8,76.6,209.6,76.1,209.1z"></path>
	<path class="st0" d="M152.7,209.1c-0.5-0.5-0.7-1.1-0.7-1.7v-64.2c0-0.8-0.4-1.2-1.2-1.2h-15.1c-0.7,0-1.2-0.2-1.7-0.7
		c-0.5-0.5-0.7-1.1-0.7-1.7v-14c0-0.7,0.2-1.2,0.7-1.7c0.5-0.5,1.1-0.7,1.7-0.7h51.9c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7
		v14c0,0.7-0.2,1.2-0.7,1.7s-1.1,0.7-1.7,0.7h-15.1c-0.8,0-1.2,0.4-1.2,1.2v64.2c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7
		h-14.2C153.7,209.8,153.2,209.6,152.7,209.1z"></path>
	<path class="st0" d="M215.3,209.1c-0.5-0.5-0.7-1.1-0.7-1.7v-64.2c0-0.8-0.4-1.2-1.2-1.2h-15.1c-0.7,0-1.2-0.2-1.7-0.7
		c-0.5-0.5-0.7-1.1-0.7-1.7v-14c0-0.7,0.2-1.2,0.7-1.7c0.5-0.5,1.1-0.7,1.7-0.7h51.9c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7
		v14c0,0.7-0.2,1.2-0.7,1.7s-1.1,0.7-1.7,0.7H235c-0.8,0-1.2,0.4-1.2,1.2v64.2c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7
		h-14.2C216.4,209.8,215.8,209.6,215.3,209.1z"></path>
	<path class="st0" d="M263.4,209.1c-0.5-0.5-0.7-1.1-0.7-1.7v-81.9c0-0.7,0.2-1.2,0.7-1.7c0.5-0.5,1.1-0.7,1.7-0.7h44.6
		c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7v13.7c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7h-26.8
		c-0.8,0-1.2,0.4-1.2,1.2V155c0,0.8,0.4,1.2,1.2,1.2h25.8c0.7,0,1.2,0.2,1.7,0.7s0.7,1.1,0.7,1.7v13.7c0,0.7-0.2,1.2-0.7,1.7
		c-0.5,0.5-1.1,0.7-1.7,0.7h-25.8c-0.8,0-1.2,0.4-1.2,1.2V190c0,0.8,0.4,1.2,1.2,1.2h27.3c0.7,0,1.2,0.2,1.7,0.7
		c0.5,0.5,0.7,1.1,0.7,1.7v13.7c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7h-45.1C264.5,209.8,263.9,209.6,263.4,209.1z"></path>
	<path class="st0" d="M327.8,209.1c-0.5-0.5-0.7-1.1-0.7-1.7v-81.9c0-0.7,0.2-1.2,0.7-1.7c0.5-0.5,1.1-0.7,1.7-0.7h27.1
		c5.6,0,10.6,1.2,14.8,3.6c4.2,2.4,7.5,5.7,9.7,9.9c2.3,4.2,3.4,9,3.4,14.3c0,4.8-1,9-3,12.7c-2,3.6-4.9,6.9-8.6,9.8
		c-0.9,0.8-1.4,1.6-1.4,2.2c0,0.6,0.2,1.2,0.5,1.9l12,28.3c0.2,0.6,0.4,1.2,0.4,1.9c0,1.6-0.8,2.4-2.5,2.4h-14
		c-1.7,0-2.7-0.7-3.2-2.1l-11.9-28.7c-0.3-0.7-0.9-1.1-1.6-1.1h-3.8c-0.8,0-1.2,0.4-1.2,1.2v28.2c0,0.7-0.2,1.2-0.7,1.7
		c-0.5,0.5-1.1,0.7-1.7,0.7h-14C328.9,209.8,328.3,209.6,327.8,209.1z M347.3,159.8h9.1c2.5,0,4.6-0.9,6.2-2.6
		c1.7-1.7,2.5-3.9,2.5-6.5c0-2.7-0.8-4.9-2.4-6.6c-1.6-1.7-3.7-2.5-6.3-2.5h-9.1c-0.8,0-1.2,0.4-1.2,1.2v15.8
		C346.1,159.4,346.5,159.8,347.3,159.8z"></path>
	<path class="st0" d="M438.8,208.7c-4.1-1.9-7.4-4.6-9.8-8.2c-2.6-3.4-4.4-7.8-5.4-13.2c-1-5.4-1.4-12.4-1.4-20.9
		c0-8.5,0.5-15.5,1.4-20.9c1-5.4,2.8-9.8,5.4-13.2c2.5-3.6,5.8-6.3,9.9-8.2c4.1-1.9,9-2.9,14.6-2.9c8.9,0,16,2.5,21.5,7.6
		c5.5,5,8.2,12.2,8.2,21.3c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7h-14.4c-0.7,0-1.3-0.2-1.8-0.7c-0.5-0.5-0.8-1.1-0.8-1.7
		c0-2.9-0.9-5.3-2.7-7.1c-1.8-1.9-4.3-2.8-7.4-2.8c-4.9,0-8.2,1.9-9.8,5.6c-0.9,1.9-1.5,4.4-1.7,7.4c-0.2,3.1-0.3,7.4-0.3,13.2
		c0,5.7,0.1,10.1,0.3,13.2c0.2,3.1,0.8,5.5,1.7,7.4c1.8,3.7,5.1,5.6,9.8,5.6c3.1,0,5.6-0.9,7.4-2.7c1.8-1.8,2.7-4.2,2.7-7.2
		c0-0.7,0.3-1.2,0.8-1.7c0.5-0.5,1.1-0.7,1.8-0.7h14.4c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7c0,9.1-2.7,16.2-8.1,21.3
		c-5.4,5.1-12.6,7.6-21.5,7.6C447.8,211.6,442.9,210.6,438.8,208.7z"></path>
	<path class="st0" d="M496.7,209.1c-0.5-0.5-0.7-1.1-0.7-1.7v-81.9c0-0.7,0.2-1.2,0.7-1.7c0.5-0.5,1.1-0.7,1.7-0.7h14
		c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7v64.2c0,0.8,0.4,1.2,1.2,1.2h27.1c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7
		v14c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7h-44.8C497.8,209.8,497.2,209.6,496.7,209.1z"></path>
	<path class="st0" d="M556.4,209.1c-0.5-0.5-0.7-1.1-0.7-1.7v-81.9c0-0.7,0.2-1.2,0.7-1.7c0.5-0.5,1.1-0.7,1.7-0.7h44.6
		c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7v13.7c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7h-26.8
		c-0.8,0-1.2,0.4-1.2,1.2V155c0,0.8,0.4,1.2,1.2,1.2h25.8c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7v13.7
		c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7h-25.8c-0.8,0-1.2,0.4-1.2,1.2V190c0,0.8,0.4,1.2,1.2,1.2h27.3
		c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7v13.7c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7h-45.1
		C557.5,209.8,556.9,209.6,556.4,209.1z"></path>
	<path class="st0" d="M613.8,208.8c-0.4-0.7-0.5-1.5-0.4-2.3l23.3-81.7c0.4-1.2,1.2-1.9,2.4-1.9h18.7c1.2,0,2,0.6,2.4,1.9l23.1,81.7
		c0.1,0.2,0.1,0.4,0.1,0.7c0,0.7-0.2,1.4-0.6,1.9c-0.4,0.5-1,0.7-1.7,0.7h-15.4c-1.2,0-1.9-0.6-2.4-1.9l-4-13.3
		c-0.2-0.6-0.4-1-0.6-1.3c-0.2-0.3-0.6-0.4-1.1-0.4h-18.9c-0.7,0-1.2,0.5-1.5,1.4l-3.7,13.7c-0.3,1.2-1.1,1.9-2.4,1.9h-15.4
		C614.9,209.8,614.2,209.5,613.8,208.8z M641.6,173.6c0,0.3,0.1,0.6,0.3,0.9c0.2,0.2,0.5,0.4,0.8,0.4H654c0.4,0,0.7-0.1,0.9-0.4
		c0.2-0.3,0.3-0.7,0.2-1.2l-5.8-24.1c-0.1-0.6-0.4-0.9-1-0.9c-0.4,0-0.7,0.3-1,0.9l-5.7,24.1V173.6z"></path>
	<path class="st0" d="M693.7,209.1c-0.5-0.5-0.7-1.1-0.7-1.7v-81.9c0-0.7,0.2-1.2,0.7-1.7c0.5-0.5,1.1-0.7,1.7-0.7h15.4
		c1.4,0,2.4,0.7,3,2.2l16.5,42.1c0.1,0.4,0.4,0.6,1,0.6c0.6,0,0.9-0.3,0.9-0.9v-41.6c0-0.7,0.2-1.2,0.7-1.7c0.5-0.5,1.1-0.7,1.7-0.7
		h14c0.7,0,1.2,0.2,1.7,0.7c0.5,0.5,0.7,1.1,0.7,1.7v81.9c0,0.7-0.2,1.2-0.7,1.7c-0.5,0.5-1.1,0.7-1.7,0.7h-15.4
		c-1.4,0-2.4-0.7-3-2.2L714,165.5c-0.2-0.4-0.5-0.6-1.1-0.6c-0.6,0-0.9,0.3-0.9,0.9v41.6c0,0.7-0.2,1.2-0.7,1.7
		c-0.5,0.5-1.1,0.7-1.7,0.7h-14C694.8,209.8,694.2,209.6,693.7,209.1z"></path>
</g>
</svg>

</div>
</footer>


</div><site-drawers client:idle=""><div class="invisible fixed inset-y-4 left-4 right-4 z-[52] translate-x-full overflow-hidden rounded-2xl bg-[--headerFillBackground] opacity-0 transition-all duration-500 active:visible active:translate-x-0 active:opacity-100 md:inset-y-5 md:left-auto md:right-5 md:w-full md:max-w-[470px]" data-drawer-key="cart">
  <button class="absolute right-4 top-4 z-10 w-[36px] text-[--headerFillText] transition-all hover:opacity-80 group-loading/cart:opacity-0" data-drawer-close="">
    <svg viewBox="0 0 37 37" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M24 12.5l-11.5 12M24 24.5l-11.5-12" stroke="currentColor" stroke-width="2"></path><circle cx="18.5" cy="18.5" r="17.5" stroke="currentColor" stroke-width="2"></circle>
    </svg>
  </button>

  <cart-items class="group/cart relative" client:idle="">
    <div class="relative flex h-full flex-col p-4">
      <div class="mb-5 flex gap-6">
        <div class="grow pr-12  hidden" data-cart-shipping-progress-bar="" data-hide-on-empty=""></div>
      </div>

      <h3 class="border-b-2 border-solid border-[--headerFillText] pb-3 font-ultramagnetic uppercase text-[--headerFillText]">Items in cart</h3>

      <div class="-mr-5 mb-4 flex h-full flex-col gap-6 overflow-y-auto pr-5 pt-4" data-cart-items=""><div class="flex grow flex-col items-center justify-center">
      <h3 class="mb-4 font-ultramagnetic text-2xl uppercase text-[--headerFillText]">Your cart is empty</h3>

      <button class="btn-wide border-2 border-solid border-[--headerFillText] bg-[--headerFillText] text-[--headerFillBackground] hover:bg-[--headerFillBackground] hover:text-[--headerFillText]" data-drawer-close="">
        Continue Shopping
      </button>
    </div></div>

      <div class="hidden" data-hide-on-empty=""><h3 class="mb-4 border-b-2 border-solid border-[--headerFillText] pb-3 font-ultramagnetic uppercase text-[--headerFillText]">You'll love these!</h3>

<cart-drawer-recommendations class="mb-4 block w-full">
  <div class="swiper">
    <div class="swiper-wrapper"><div class="swiper-slide">
          <div class="flex animate-pulse gap-4">
            <div class="relative flex aspect-[20/27] w-[100px] shrink-0 items-center justify-center overflow-hidden rounded-md bg-[--headerFillText]">
              <svg class="h-10 w-10 text-ice/20" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 18">
                <path d="M18 0H2a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2Zm-5.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm4.376 10.481A1 1 0 0 1 16 15H4a1 1 0 0 1-.895-1.447l3.5-7A1 1 0 0 1 7.468 6a.965.965 0 0 1 .9.5l2.775 4.757 1.546-1.887a1 1 0 0 1 1.618.1l2.541 4a1 1 0 0 1 .028 1.011Z"></path>
              </svg>
            </div>

            <div class="flex grow flex-col">
              <div class="mb-2 block h-5 w-full rounded-md bg-[--headerFillText]"></div>

              <div class="block h-5 w-14 rounded-md bg-[--headerFillText]"></div>

              <div class="mt-auto block h-10 w-full rounded-md bg-[--headerFillText]"></div>
            </div>
          </div>
        </div><div class="swiper-slide">
          <div class="flex animate-pulse gap-4">
            <div class="relative flex aspect-[20/27] w-[100px] shrink-0 items-center justify-center overflow-hidden rounded-md bg-[--headerFillText]">
              <svg class="h-10 w-10 text-ice/20" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 18">
                <path d="M18 0H2a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2Zm-5.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm4.376 10.481A1 1 0 0 1 16 15H4a1 1 0 0 1-.895-1.447l3.5-7A1 1 0 0 1 7.468 6a.965.965 0 0 1 .9.5l2.775 4.757 1.546-1.887a1 1 0 0 1 1.618.1l2.541 4a1 1 0 0 1 .028 1.011Z"></path>
              </svg>
            </div>

            <div class="flex grow flex-col">
              <div class="mb-2 block h-5 w-full rounded-md bg-[--headerFillText]"></div>

              <div class="block h-5 w-14 rounded-md bg-[--headerFillText]"></div>

              <div class="mt-auto block h-10 w-full rounded-md bg-[--headerFillText]"></div>
            </div>
          </div>
        </div><div class="swiper-slide">
          <div class="flex animate-pulse gap-4">
            <div class="relative flex aspect-[20/27] w-[100px] shrink-0 items-center justify-center overflow-hidden rounded-md bg-[--headerFillText]">
              <svg class="h-10 w-10 text-ice/20" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 18">
                <path d="M18 0H2a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2Zm-5.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm4.376 10.481A1 1 0 0 1 16 15H4a1 1 0 0 1-.895-1.447l3.5-7A1 1 0 0 1 7.468 6a.965.965 0 0 1 .9.5l2.775 4.757 1.546-1.887a1 1 0 0 1 1.618.1l2.541 4a1 1 0 0 1 .028 1.011Z"></path>
              </svg>
            </div>

            <div class="flex grow flex-col">
              <div class="mb-2 block h-5 w-full rounded-md bg-[--headerFillText]"></div>

              <div class="block h-5 w-14 rounded-md bg-[--headerFillText]"></div>

              <div class="mt-auto block h-10 w-full rounded-md bg-[--headerFillText]"></div>
            </div>
          </div>
        </div></div>
  </div>
</cart-drawer-recommendations>
</div>

      <data class="flex flex-col" data-cart-totals=""></data>

      <div class="pointer-events-none invisible absolute inset-0 z-10 flex items-center justify-center bg-[--headerFillBackground] opacity-0 group-loading/cart:visible group-loading/cart:opacity-95">
        <div class="relative flex items-center justify-center" style="--dotColor:var(--headerFillText);">
          <div class="dot-loader"></div>
          <div class="dot-loader dot-loader--2"></div>
          <div class="dot-loader dot-loader--3"></div>
        </div>
      </div>

      <div class="group-error/cart:visible group-error/cart:opacity-100 invisible absolute inset-0 z-10 flex items-center justify-center bg-white/75 opacity-0" data-cart-errors="">
        <template data-cart-error-template=""></template>
      </div>
    </div>

    <script type="application/json" id="cartData">{"note":null,"attributes":{},"original_total_price":0,"total_price":0,"total_discount":0,"total_weight":0.0,"item_count":0,"items":[],"requires_shipping":false,"currency":"GBP","items_subtotal_price":0,"cart_level_discount_applications":[],"checkout_charge_amount":0}</script>
  </cart-items>
</div>
<div class="invisible fixed bottom-5 left-4 right-4 z-[52] translate-y-full overflow-hidden rounded-2xl bg-[--headerFillBackground] opacity-0 transition-all duration-500 active:visible active:translate-y-0 active:opacity-100 md:inset-y-5 md:left-auto md:right-5 md:w-[65vw] md:translate-x-full md:translate-y-0 md:active:translate-x-0 lg:max-w-[470px]" data-drawer-key="login">
  <button class="absolute right-4 top-4 z-10 w-[36px] text-[--headerFillText] transition-all hover:opacity-80" data-drawer-close="">
    <svg viewBox="0 0 37 37" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M24 12.5l-11.5 12M24 24.5l-11.5-12" stroke="currentColor" stroke-width="2"></path><circle cx="18.5" cy="18.5" r="17.5" stroke="currentColor" stroke-width="2"></circle>
    </svg>
  </button>

  <div class="relative flex h-full flex-col p-6" style="
      --formInputBorder:var(--headerFillText);
      --formInputBackground:var(--headerFillBackground);
      --formInputText:var(--headerFillText);
    ">
    <h2 class="mb-6 font-ultramagnetic text-4xl uppercase text-[--headerFillText]">Sign In</h2>

    <p class="mb-6 text-[15px] text-[--headerFillText]">Please enter your details below to sign in</p><form method="post" action="https://clean.co/account/login" id="customer_login" accept-charset="UTF-8" data-login-with-shop-sign-in="true" class="flex flex-col grow"><input type="hidden" name="form_type" value="customer_login"><input type="hidden" name="utf8" value="✓"><input type="email" required="" class="form-input mb-6" name="customer[email]" id="form-login-email" placeholder="Email address" autocomplete="email">

      <input type="password" required="" class="form-input mb-5" name="customer[password]" id="form-login-password" placeholder="Password" autocomplete="current-password">

      <button type="button" class="mb-5 self-start text-sm font-medium text-[--headerFillText] underline hover:no-underline" data-drawer-trigger="forgot-password">
        Forgot password?
      </button>

      <button type="submit" class="btn-full-width mb-6 mt-auto border-2 border-solid border-[--headerFillText] text-[--headerFillText] hover:bg-[--headerFillText] hover:text-[--headerFillBackground]">
        Sign In
      </button>

      <p class="text-center text-[15px] text-[--headerFillText]">
        Don't have an account yet? <button type="button" class="underline hover:no-underline" data-drawer-trigger="register">Sign up here</button>
      </p></form></div>
</div>
<div class="invisible fixed bottom-5 left-4 right-4 z-[52] translate-y-full overflow-hidden rounded-2xl bg-[--headerFillBackground] opacity-0 transition-all duration-500 active:visible active:translate-y-0 active:opacity-100 md:inset-y-5 md:left-auto md:right-5 md:w-[65vw] md:translate-x-full md:translate-y-0 md:active:translate-x-0 lg:max-w-[470px]" data-drawer-key="register">
  <button class="absolute right-4 top-4 z-10 w-[36px] text-[--headerFillText] transition-all hover:opacity-80" data-drawer-close="">
    <svg viewBox="0 0 37 37" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M24 12.5l-11.5 12M24 24.5l-11.5-12" stroke="currentColor" stroke-width="2"></path><circle cx="18.5" cy="18.5" r="17.5" stroke="currentColor" stroke-width="2"></circle>
    </svg>
  </button>

  <div class="relative flex h-full flex-col p-6 text-[15px]" style="
      --formInputBorder:var(--headerFillText);
      --formInputBackground:var(--headerFillBackground);
      --formInputText:var(--headerFillText);
    ">
    <h2 class="mb-6 font-ultramagnetic text-4xl uppercase text-[--headerFillText]">Register</h2>

    <p class="mb-6 text-[--headerFillText]">Please enter your details below to register an account.</p><form method="post" action="https://clean.co/account" id="create_customer" accept-charset="UTF-8" data-login-with-shop-sign-up="true" class="flex flex-col grow"><input type="hidden" name="form_type" value="create_customer"><input type="hidden" name="utf8" value="✓"><input type="text" class="form-input mb-4" name="customer[first_name]" id="register-form-FirstName" placeholder="First name" autocomplete="given-name">

      <input type="text" class="form-input mb-4" name="customer[last_name]" id="register-form-LastName" placeholder="Last name" autocomplete="family-name">

      <input type="email" class="form-input mb-4" name="customer[email]" id="register-form-email" aria-required="true" placeholder="Email address" autocomplete="email">

      <input type="text" class="form-input mb-4" name="customer[phone_number]" id="register-form-PhoneNumber" placeholder="Phone number" autocomplete="tel">

      <input type="password" class="form-input mb-4" name="customer[password]" id="register-form-password" aria-required="true" placeholder="Password" autocomplete="current-password">

      <div class="relative mb-4">
        <input type="checkbox" name="customer[accepts_marketing]" id="register-form-marketing" class="peer sr-only">
        <label for="register-form-marketing" class="flex cursor-pointer items-center pl-8 font-gtpressura text-[15px] uppercase text-[--headerFillText] before:absolute before:left-[0] before:top-1/2 before:size-5 before:-translate-y-1/2 before:rounded-md before:border-2 before:border-solid before:border-[--headerFillText] after:absolute after:left-1 after:top-1/2 after:hidden after:size-3 after:-translate-y-1/2 after:rounded after:bg-[--headerFillText] peer-checked:after:block">Yes, I am happy to receive discount codes, offers and occasional updates by email.</label>
      </div>

      <button type="submit" class="btn-rosemary-filled btn-full-width mb-6 mt-auto">Sign Up</button>

      <p class="text-center text-[15px] text-[--headerFillText]">
        Already have an account?
        <button type="button" class="underline hover:no-underline" data-drawer-trigger="login">Log In</button>
      </p></form></div>
</div>
<div class="invisible fixed bottom-5 left-4 right-4 z-[52] translate-y-full overflow-hidden rounded-2xl bg-[--headerFillBackground] opacity-0 transition-all duration-500 active:visible active:translate-y-0 active:opacity-100 md:inset-y-5 md:left-auto md:right-5 md:w-[65vw] md:translate-x-full md:translate-y-0 md:active:translate-x-0 lg:max-w-[470px]" data-drawer-key="forgot-password">
  <button class="absolute right-4 top-4 z-10 w-[36px] text-[--headerFillText] transition-all hover:opacity-80" data-drawer-close="">
    <svg viewBox="0 0 37 37" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M24 12.5l-11.5 12M24 24.5l-11.5-12" stroke="currentColor" stroke-width="2"></path><circle cx="18.5" cy="18.5" r="17.5" stroke="currentColor" stroke-width="2"></circle>
    </svg>
  </button>

  <div class="relative flex h-full flex-col p-6 text-[15px]" style="
      --formInputBorder:var(--headerFillText);
      --formInputBackground:var(--headerFillBackground);
      --formInputText:var(--headerFillText);
    ">
    <h2 class="mb-6 font-ultramagnetic text-4xl uppercase text-[--headerFillText]">Reset password</h2>

    <p class="mb-6 text-[--headerFillText]">Forgot your password? No problem just enter your email to reset you password.</p><form method="post" action="https://clean.co/account/recover" accept-charset="UTF-8" class="flex flex-col grow"><input type="hidden" name="form_type" value="recover_customer_password"><input type="hidden" name="utf8" value="✓"><input type="email" class="form-input mb-6" name="email" id="form-forgot-password-email" autocomplete="email" autocorrect="off" placeholder="Email address" autocapitalize="off">

      <button type="submit" class="btn-rosemary-filled btn-full-width mb-6 mt-auto">Submit</button>

      <p class="text-center text-[15px] text-[--headerFillText] text-rosemary">
        Remembered your password? <button type="button" class="underline hover:no-underline" data-drawer-trigger="login">Back to login</button>
      </p></form></div>
</div>
<div class="invisible fixed inset-y-4 left-4 right-4 z-[52] translate-x-full overflow-hidden rounded-2xl bg-[--headerFillBackground] opacity-0 transition-all duration-500 active:visible active:translate-x-0 active:opacity-100 md:inset-y-5 md:left-auto md:right-5 md:w-full md:max-w-[470px]" data-drawer-key="quickshop">
  <button class="absolute right-4 top-4 z-10 w-[36px] text-[--headerFillText] transition-all hover:opacity-80" data-drawer-close="">
    <svg viewBox="0 0 37 37" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M24 12.5l-11.5 12M24 24.5l-11.5-12" stroke="currentColor" stroke-width="2"></path><circle cx="18.5" cy="18.5" r="17.5" stroke="currentColor" stroke-width="2"></circle>
    </svg>
  </button>

  <div class="relative flex h-full flex-col overflow-y-auto p-6">
    <h2 class="mb-6 font-ultramagnetic text-4xl uppercase text-[--headerFillText]">Subscribe &amp; Save</h2>

    <div class="-mx-6 mb-10 border-b-2 border-solid border-[--headerFillText] px-6 pb-10">
      <div class="grid grid-cols-2 gap-8">
        <div class="relative block aspect-[170/230] overflow-hidden rounded-md">




  <svg class="w-full h-full object-cover object-center absolute inset-0 opacity-40" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 525.5 525.5"><path d="M375.5 345.2c0-.1 0-.1 0 0 0-.1 0-.1 0 0-1.1-2.9-2.3-5.5-3.4-7.8-1.4-4.7-2.4-13.8-.5-19.8 3.4-10.6 3.6-40.6 1.2-54.5-2.3-14-12.3-29.8-18.5-36.9-5.3-6.2-12.8-14.9-15.4-17.9 8.6-5.6 13.3-13.3 14-23 0-.3 0-.6.1-.8.4-4.1-.6-9.9-3.9-13.5-2.1-2.3-4.8-3.5-8-3.5h-54.9c-.8-7.1-3-13-5.2-17.5-6.8-13.9-12.5-16.5-21.2-16.5h-.7c-8.7 0-14.4 2.5-21.2 16.5-2.2 4.5-4.4 10.4-5.2 17.5h-48.5c-3.2 0-5.9 1.2-8 3.5-3.2 3.6-4.3 9.3-3.9 13.5 0 .2 0 .5.1.8.7 9.8 5.4 17.4 14 23-2.6 3.1-10.1 11.7-15.4 17.9-6.1 7.2-16.1 22.9-18.5 36.9-2.2 13.3-1.2 47.4 1 54.9 1.1 3.8 1.4 14.5-.2 19.4-1.2 2.4-2.3 5-3.4 7.9-4.4 11.6-6.2 26.3-5 32.6 1.8 9.9 16.5 14.4 29.4 14.4h176.8c12.9 0 27.6-4.5 29.4-14.4 1.2-6.5-.5-21.1-5-32.7zm-97.7-178c.3-3.2.8-10.6-.2-18 2.4 4.3 5 10.5 5.9 18h-5.7zm-36.3-17.9c-1 7.4-.5 14.8-.2 18h-5.7c.9-7.5 3.5-13.7 5.9-18zm4.5-6.9c0-.1.1-.2.1-.4 4.4-5.3 8.4-5.8 13.1-5.8h.7c4.7 0 8.7.6 13.1 5.8 0 .1 0 .2.1.4 3.2 8.9 2.2 21.2 1.8 25h-30.7c-.4-3.8-1.3-16.1 1.8-25zm-70.7 42.5c0-.3 0-.6-.1-.9-.3-3.4.5-8.4 3.1-11.3 1-1.1 2.1-1.7 3.4-2.1l-.6.6c-2.8 3.1-3.7 8.1-3.3 11.6 0 .2 0 .5.1.8.3 3.5.9 11.7 10.6 18.8.3.2.8.2 1-.2.2-.3.2-.8-.2-1-9.2-6.7-9.8-14.4-10-17.7 0-.3 0-.6-.1-.8-.3-3.2.5-7.7 3-10.5.8-.8 1.7-1.5 2.6-1.9h155.7c1 .4 1.9 1.1 2.6 1.9 2.5 2.8 3.3 7.3 3 10.5 0 .2 0 .5-.1.8-.3 3.6-1 13.1-13.8 20.1-.3.2-.5.6-.3 1 .1.2.4.4.6.4.1 0 .2 0 .3-.1 13.5-7.5 14.3-17.5 14.6-21.3 0-.3 0-.5.1-.8.4-3.5-.5-8.5-3.3-11.6l-.6-.6c1.3.4 2.5 1.1 3.4 2.1 2.6 2.9 3.5 7.9 3.1 11.3 0 .3 0 .6-.1.9-1.5 20.9-23.6 31.4-65.5 31.4h-43.8c-41.8 0-63.9-10.5-65.4-31.4zm91 89.1h-7c0-1.5 0-3-.1-4.2-.2-12.5-2.2-31.1-2.7-35.1h3.6c.8 0 1.4-.6 1.4-1.4v-14.1h2.4v14.1c0 .8.6 1.4 1.4 1.4h3.7c-.4 3.9-2.4 22.6-2.7 35.1v4.2zm65.3 11.9h-16.8c-.4 0-.7.3-.7.7 0 .4.3.7.7.7h16.8v2.8h-62.2c0-.9-.1-1.9-.1-2.8h33.9c.4 0 .7-.3.7-.7 0-.4-.3-.7-.7-.7h-33.9c-.1-3.2-.1-6.3-.1-9h62.5v9zm-12.5 24.4h-6.3l.2-1.6h5.9l.2 1.6zm-5.8-4.5l1.6-12.3h2l1.6 12.3h-5.2zm-57-19.9h-62.4v-9h62.5c0 2.7 0 5.8-.1 9zm-62.4 1.4h62.4c0 .9-.1 1.8-.1 2.8H194v-2.8zm65.2 0h7.3c0 .9.1 1.8.1 2.8H259c.1-.9.1-1.8.1-2.8zm7.2-1.4h-7.2c.1-3.2.1-6.3.1-9h7c0 2.7 0 5.8.1 9zm-7.7-66.7v6.8h-9v-6.8h9zm-8.9 8.3h9v.7h-9v-.7zm0 2.1h9v2.3h-9v-2.3zm26-1.4h-9v-.7h9v.7zm-9 3.7v-2.3h9v2.3h-9zm9-5.9h-9v-6.8h9v6.8zm-119.3 91.1c-2.1-7.1-3-40.9-.9-53.6 2.2-13.5 11.9-28.6 17.8-35.6 5.6-6.5 13.5-15.7 15.7-18.3 11.4 6.4 28.7 9.6 51.8 9.6h6v14.1c0 .8.6 1.4 1.4 1.4h5.4c.3 3.1 2.4 22.4 2.7 35.1 0 1.2.1 2.6.1 4.2h-63.9c-.8 0-1.4.6-1.4 1.4v16.1c0 .8.6 1.4 1.4 1.4H256c-.8 11.8-2.8 24.7-8 33.3-2.6 4.4-4.9 8.5-6.9 12.2-.4.7-.1 1.6.6 1.9.2.1.4.2.6.2.5 0 1-.3 1.3-.8 1.9-3.7 4.2-7.7 6.8-12.1 5.4-9.1 7.6-22.5 8.4-34.7h7.8c.7 11.2 2.6 23.5 7.1 32.4.2.5.8.8 1.3.8.2 0 .4 0 .6-.2.7-.4 1-1.2.6-1.9-4.3-8.5-6.1-20.3-6.8-31.1H312l-2.4 18.6c-.1.4.1.8.3 1.1.3.3.7.5 1.1.5h9.6c.4 0 .8-.2 1.1-.5.3-.3.4-.7.3-1.1l-2.4-18.6H333c.8 0 1.4-.6 1.4-1.4v-16.1c0-.8-.6-1.4-1.4-1.4h-63.9c0-1.5 0-2.9.1-4.2.2-12.7 2.3-32 2.7-35.1h5.2c.8 0 1.4-.6 1.4-1.4v-14.1h6.2c23.1 0 40.4-3.2 51.8-9.6 2.3 2.6 10.1 11.8 15.7 18.3 5.9 6.9 15.6 22.1 17.8 35.6 2.2 13.4 2 43.2-1.1 53.1-1.2 3.9-1.4 8.7-1 13-1.7-2.8-2.9-4.4-3-4.6-.2-.3-.6-.5-.9-.6h-.5c-.2 0-.4.1-.5.2-.6.5-.8 1.4-.3 2 0 0 .2.3.5.8 1.4 2.1 5.6 8.4 8.9 16.7h-42.9v-43.8c0-.8-.6-1.4-1.4-1.4s-1.4.6-1.4 1.4v44.9c0 .1-.1.2-.1.3 0 .1 0 .2.1.3v9c-1.1 2-3.9 3.7-10.5 3.7h-7.5c-.4 0-.7.3-.7.7 0 .4.3.7.7.7h7.5c5 0 8.5-.9 10.5-2.8-.1 3.1-1.5 6.5-10.5 6.5H210.4c-9 0-10.5-3.4-10.5-6.5 2 1.9 5.5 2.8 10.5 2.8h67.4c.4 0 .7-.3.7-.7 0-.4-.3-.7-.7-.7h-67.4c-6.7 0-9.4-1.7-10.5-3.7v-54.5c0-.8-.6-1.4-1.4-1.4s-1.4.6-1.4 1.4v43.8h-43.6c4.2-10.2 9.4-17.4 9.5-17.5.5-.6.3-1.5-.3-2s-1.5-.3-2 .3c-.1.2-1.4 2-3.2 5 .1-4.9-.4-10.2-1.1-12.8zm221.4 60.2c-1.5 8.3-14.9 12-26.6 12H174.4c-11.8 0-25.1-3.8-26.6-12-1-5.7.6-19.3 4.6-30.2H197v9.8c0 6.4 4.5 9.7 13.4 9.7h105.4c8.9 0 13.4-3.3 13.4-9.7v-9.8h44c4 10.9 5.6 24.5 4.6 30.2z"></path><path d="M286.1 359.3c0 .4.3.7.7.7h14.7c.4 0 .7-.3.7-.7 0-.4-.3-.7-.7-.7h-14.7c-.3 0-.7.3-.7.7zm5.3-145.6c13.5-.5 24.7-2.3 33.5-5.3.4-.1.6-.5.4-.9-.1-.4-.5-.6-.9-.4-8.6 3-19.7 4.7-33 5.2-.4 0-.7.3-.7.7 0 .4.3.7.7.7zm-11.3.1c.4 0 .7-.3.7-.7 0-.4-.3-.7-.7-.7H242c-19.9 0-35.3-2.5-45.9-7.4-.4-.2-.8 0-.9.3-.2.4 0 .8.3.9 10.8 5 26.4 7.5 46.5 7.5h38.1zm-7.2 116.9c.4.1.9.1 1.4.1 1.7 0 3.4-.7 4.7-1.9 1.4-1.4 1.9-3.2 1.5-5-.2-.8-.9-1.2-1.7-1.1-.8.2-1.2.9-1.1 1.7.3 1.2-.4 2-.7 2.4-.9.9-2.2 1.3-3.4 1-.8-.2-1.5.3-1.7 1.1s.2 1.5 1 1.7z"></path><path d="M275.5 331.6c-.8 0-1.4.6-1.5 1.4 0 .8.6 1.4 1.4 1.5h.3c3.6 0 7-2.8 7.7-6.3.2-.8-.4-1.5-1.1-1.7-.8-.2-1.5.4-1.7 1.1-.4 2.3-2.8 4.2-5.1 4zm5.4 1.6c-.6.5-.6 1.4-.1 2 1.1 1.3 2.5 2.2 4.2 2.8.2.1.3.1.5.1.6 0 1.1-.3 1.3-.9.3-.7-.1-1.6-.8-1.8-1.2-.5-2.2-1.2-3-2.1-.6-.6-1.5-.6-2.1-.1zm-38.2 12.7c.5 0 .9 0 1.4-.1.8-.2 1.3-.9 1.1-1.7-.2-.8-.9-1.3-1.7-1.1-1.2.3-2.5-.1-3.4-1-.4-.4-1-1.2-.8-2.4.2-.8-.3-1.5-1.1-1.7-.8-.2-1.5.3-1.7 1.1-.4 1.8.1 3.7 1.5 5 1.2 1.2 2.9 1.9 4.7 1.9z"></path><path d="M241.2 349.6h.3c.8 0 1.4-.7 1.4-1.5s-.7-1.4-1.5-1.4c-2.3.1-4.6-1.7-5.1-4-.2-.8-.9-1.3-1.7-1.1-.8.2-1.3.9-1.1 1.7.7 3.5 4.1 6.3 7.7 6.3zm-9.7 3.6c.2 0 .3 0 .5-.1 1.6-.6 3-1.6 4.2-2.8.5-.6.5-1.5-.1-2s-1.5-.5-2 .1c-.8.9-1.8 1.6-3 2.1-.7.3-1.1 1.1-.8 1.8 0 .6.6.9 1.2.9z"></path></svg>


        </div>

        <div class="flex flex-col">
          <h3 class="mb-2 font-ultramagnetic text-2xl uppercase text-[--headerFillText]"></h3>

          <p class="mb-6 font-calvino italic text-blue"></p>

          <p class="text-[15px] text-[--headerFillText]"></p>
        </div>
      </div>
    </div>

    <div class="grow">Liquid error (snippets/drawer-quickshop line 40): product form must be given a product</div>
  </div>
</div>
</site-drawers><div tabindex="-1" aria-hidden="true" id="web-pixels-manager-sandbox-container" data-shopify-privacy="exclude" style="height: 0px !important; width: 0px !important; position: fixed !important; visibility: hidden !important; overflow: hidden !important; z-index: -100 !important; margin: 0px !important; padding: 0px !important; border: 0px !important;"><iframe tabindex="-1" aria-hidden="true" name="web-pixel-sandbox-CUSTOM-9764961-LAX-bb202aaewd7fabeadp1286c7ffm6c4f3798" src="./CleanCo UK_files/2.html" id="web-pixel-sandbox-CUSTOM-9764961-LAX-bb202aaewd7fabeadp1286c7ffm6c4f3798" sandbox="allow-scripts allow-forms" style="height: 0px !important; width: 0px !important; visibility: hidden !important;"></iframe><iframe tabindex="-1" aria-hidden="true" name="web-pixel-sandbox-CUSTOM-14057569-LAX-bb202aaewd7fabeadp1286c7ffm6c4f3798" src="./CleanCo UK_files/2(1).html" id="web-pixel-sandbox-CUSTOM-14057569-LAX-bb202aaewd7fabeadp1286c7ffm6c4f3798" sandbox="allow-scripts allow-forms" style="height: 0px !important; width: 0px !important; visibility: hidden !important;"></iframe><iframe tabindex="-1" aria-hidden="true" name="web-pixel-sandbox-CUSTOM-shopify-custom-pixel-LAX-bb202aaewd7fabeadp1286c7ffm6c4f3798" src="./CleanCo UK_files/2(2).html" id="web-pixel-sandbox-CUSTOM-shopify-custom-pixel-LAX-bb202aaewd7fabeadp1286c7ffm6c4f3798" sandbox="allow-scripts allow-forms" style="height: 0px !important; width: 0px !important; visibility: hidden !important;"></iframe></div>




  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
  "itemListElement": [{
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://clean.co"
    }]
    }
  </script>


<div id="shopify-block-AQzZUdjQ3SXVxbUpNb__11348531219507317188" class="shopify-block shopify-app-block"><script>
    let shopifyLiquidValuesApp4Ext =   { 
      product: { 
            handle: null,
            productId: null,
            collections: [
                
            ],
        },
        selected_or_first_available_variant: null,
        cartData: {"note":null,"attributes":{},"original_total_price":0,"total_price":0,"total_discount":0,"total_weight":0.0,"item_count":0,"items":[],"requires_shipping":false,"currency":"GBP","items_subtotal_price":0,"cart_level_discount_applications":[],"checkout_charge_amount":0}
    }
    window.shopifyLiquidValuesApp4Ext = shopifyLiquidValuesApp4Ext;
</script>

<script id="easybundles-ext-data" type="application/json" data-json=""></script>

<script>
    //console.log("inside app embed file");
    if (window && !window.easybundles_ext_data) {
      let metafieldData;
      
      // Get the JSON data from the data attribute of the script tag
      const jsonDataElement = document.getElementById('easybundles-ext-data');
      const jsonString = jsonDataElement ? jsonDataElement.getAttribute('data-json') : '';

      try {
        // Parse the JSON string
        metafieldData = JSON.parse(jsonString);
      } catch (error) {
        // Log the error if parsing fails
        console.error("Failed to parse metafield data:", error);
        metafieldData = { errorMsg: "This is not a valid JSON" };
      }

      // If the parsing was successful and no error message exists
      if (metafieldData && !metafieldData?.errorMsg && !metafieldData.isUseAppLevelMetafieldEnabled) {
        window.easybundles_ext_data = metafieldData;
        //console.log("app_data from easybundles app embed", window.easybundles_ext_data);
      }

      // Clear the data-json attribute
      if (jsonDataElement) {
        jsonDataElement.setAttribute('data-json', '');
      }
    }
</script>

</div>

<iframe id="bugherd_embed_communication_frame" name="embedCommunication" sandbox="allow-scripts allow-popups allow-same-origin allow-popups-to-escape-sandbox allow-storage-access-by-user-activation" src="./CleanCo UK_files/embed_html.html" style="display: none; border: none; position: fixed; z-index: 2147483647; right: 0px; height: calc(90% - 138.6px);"></iframe><script src="./CleanCo UK_files/js(1)"></script><div id="dynamic-react-root"></div><div><div class="needsclick kl-teaser-XeDhYd undefined kl-private-reset-css-Xuajs1" tabindex="0" style="z-index: 90000; position: fixed; top: 50%; right: 0px; transform: rotate(90deg) translate(50%, 0px); transform-origin: right top; margin-right: 0px; width: 184px;"><div data-testid="animated-teaser" class="needsclick  kl-private-reset-css-Xuajs1" style="height: 100%; width: 100%;"><span class="needsclick go681896951 kl-private-reset-css-Xuajs1" style="overflow: hidden; box-sizing: border-box; border-radius: 0px 0px 4px 4px; background-color: rgb(11, 70, 76); min-height: 50px; height: 100%; padding: 8px; display: flex; flex-direction: column; justify-content: center;"><div class="needsclick  kl-private-reset-css-Xuajs1"><div class="needsclick  kl-private-reset-css-Xuajs1"><div class="kl-private-reset-css-Xuajs1 go3176171171" id="rich-text-01J93WRWKQ7KJYTHAVT2RMJG7T" style="width: 100%;"><p style="text-align: center; font-size: 14px; font-family: Arial, &#39;Helvetica Neue&#39;, Helvetica, sans-serif; font-weight: 400;"><span style="font-size: 18px; color: rgb(247, 242, 232); font-family: Rubik, &#39;Lucida Sans&#39;, &#39;Lucida Sans Unicode&#39;, Geneva, Verdana, sans-serif; font-weight: 600; font-style: normal;">Get 10% off</span></p></div></div></div></span><button tabindex="0" class="needsclick klaviyo-close-form go2324193863 kl-private-reset-css-Xuajs1" aria-label="Close teaser" style="bottom: -16px; right: -16px; position: absolute; z-index: 6; cursor: pointer; height: 20px; width: 20px; border-radius: 50%;"><svg role="img" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" class="needsclick  kl-private-reset-css-Xuajs1"><title id="title-Close teaser">Close teaser</title><circle cx="10" cy="10" r="9.5" fill="#000000" stroke="#FFFFFF" style="cursor: pointer;"></circle><path d="M6 6L14 14M6 14L14 6L6 14Z" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="cursor: pointer;"></path></svg></button></div></div><div class="needsclick  kl-private-reset-css-Xuajs1"><div class="needsclick go1272136950 kl-private-reset-css-Xuajs1" style="display: none;"></div><div role="dialog" aria-modal="true" aria-label="POPUP Form" class="needsclick  kl-private-reset-css-Xuajs1" style="display: none; z-index: 90000; opacity: 0; position: fixed; left: 0px; top: 0px; width: 100%; height: 100%; justify-content: center; align-items: center; overflow: clip auto; background-color: rgba(20, 20, 20, 0.6); animation-timing-function: ease; animation-play-state: running; animation-iteration-count: 1; animation-fill-mode: forwards; animation-delay: 0s; animation-duration: 0.35s; animation-name: klaviyo-fadein;"><div class="needsclick  kl-private-reset-css-Xuajs1" style="overflow: visible; transform: scale(1); transform-origin: center center; max-height: 100%; border-radius: 4px; position: relative; display: flex; justify-content: center; flex: 0 0 auto; align-self: center;"><div data-testid="POPUP" class="needsclick  kl-private-reset-css-Xuajs1" style="flex: 1 1 0%;"><div class="needsclick go249761392 kl-private-reset-css-Xuajs1" style="position: relative; flex-direction: column; display: flex; margin-left: 20px; margin-right: 20px; flex: 1 1 0%; align-self: stretch;"><div class="needsclick  kl-private-reset-css-Xuajs1"><div class="needsclick  kl-private-reset-css-Xuajs1" style="position: relative; display: flex; flex: 1 1 0%; align-self: stretch; border-radius: 4px;"><button tabindex="0" class="needsclick klaviyo-close-form go2324193863 kl-private-reset-css-Xuajs1" aria-label="Close dialog" style="right: 0px; top: 0px; position: absolute; z-index: 6; cursor: pointer; height: 25px; width: 25px; border-radius: 50%; margin-right: 8px; margin-top: 8px;"><svg role="img" width="25" height="25" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" class="needsclick  kl-private-reset-css-Xuajs1"><title id="title-Close dialog">Close dialog</title><circle cx="10" cy="10" r="9.5" fill="#F7F2E8" stroke="#F7F2E8" style="cursor: pointer;"></circle><path d="M6 6L14 14M6 14L14 6L6 14Z" stroke="#373F47" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" style="cursor: pointer;"></path></svg></button><form aria-live="polite" class="needsclick klaviyo-form klaviyo-form-version-cid_1 go417382439 kl-private-reset-css-Xuajs1" data-testid="klaviyo-form-XeDhYd" novalidate="" style="display: flex; flex-direction: row; box-sizing: border-box; width: 600px; min-width: 200px; max-width: 1000px; border-radius: 4px; border-style: none; border-width: 0px; border-color: rgb(0, 0, 0); background-color: rgb(11, 70, 76); background-repeat: no-repeat; background-position-y: 50%; padding: 20px 15px; flex: 1 1 0%;"><div class="needsclick  kl-private-reset-css-Xuajs1" style="display: flex; flex-direction: column; width: 100%; margin: 0px; padding: 0px 15px 0px 0px; min-height: 300px; justify-content: center;"><div data-testid="form-row" class="needsclick  kl-private-reset-css-Xuajs1" style="display: flex; flex-direction: row; align-items: stretch; position: relative;"><div component="[object Object]" data-testid="form-component" class="needsclick  kl-private-reset-css-Xuajs1" style="display: flex; justify-content: flex-start; padding: 10px 6px 0px 0px; position: relative; flex: 1 0 0px;"><div class="kl-private-reset-css-Xuajs1 go3176171171" id="rich-text-01J93WRWM43Y7EJQVDPFJ76S4D" style="width: 100%;"><p style="text-align: center; font-size: 14px; font-family: Arial, &#39;Helvetica Neue&#39;, Helvetica, sans-serif; font-weight: 400;"><span class="ql-font-liberal" style="font-size: 26px; color: rgb(247, 242, 232); font-family: Rubik, &#39;Lucida Sans&#39;, &#39;Lucida Sans Unicode&#39;, Geneva, Verdana, sans-serif; font-weight: 500; font-style: normal;">10% OFF YOUR <br>FIRST ORDER</span></p></div></div></div><div data-testid="form-row" class="needsclick  kl-private-reset-css-Xuajs1" style="display: flex; flex-direction: row; align-items: stretch; position: relative;"><div component="[object Object]" data-testid="form-component" class="needsclick  kl-private-reset-css-Xuajs1" style="display: flex; justify-content: flex-start; padding: 10px 6px; position: relative; flex: 1 0 0px;"><div class="kl-private-reset-css-Xuajs1 go3176171171" id="rich-text-01J93WRWMDQMQ7H7N4NQD32MXA" style="width: 100%;"><p style="text-align: center; font-size: 14px; font-family: Arial, &#39;Helvetica Neue&#39;, Helvetica, sans-serif; font-weight: 400;"><span class="ql-font-liberal" style="color: rgb(247, 242, 232); font-size: 14px; font-family: Rubik, &#39;Lucida Sans&#39;, &#39;Lucida Sans Unicode&#39;, Geneva, Verdana, sans-serif; font-weight: 400; font-style: normal;">Sign up for exclusive Clean Cocktail recipes, tips on navigating moderation and sobriety, first access to new product drops and more.</span></p></div></div></div><div data-testid="form-row" class="needsclick  kl-private-reset-css-Xuajs1" style="display: flex; flex-direction: row; align-items: stretch; position: relative;"><div component="[object Object]" data-testid="form-component" class="needsclick  kl-private-reset-css-Xuajs1" style="display: flex; justify-content: flex-start; padding: 5px 6px; position: relative; flex: 1 0 0px;"><div class="needsclick  kl-private-reset-css-Xuajs1" style="display: flex; flex-grow: 1; flex-direction: column; align-self: flex-end;"><input id="first_name_01J93WRWMNHKK4Z2TT8SPM4SM2" class="needsclick go4117816934 kl-private-reset-css-Xuajs1" type="text" autocomplete="given-name" tabindex="0" placeholder="First name" aria-label="First name" aria-invalid="false" options="[object Object]" style="box-sizing: border-box; border-radius: 2px; padding: 0px 0px 0px 16px; height: 50px; text-align: left; color: rgb(0, 0, 0); font-family: Rubik, &quot;Lucida Sans&quot;, &quot;Lucida Sans Unicode&quot;, Geneva, Verdana, sans-serif; font-size: 14px; font-weight: 300; letter-spacing: 0px; background-color: rgb(255, 255, 255); border: 1px solid rgb(96, 106, 114);"><div class="needsclick  kl-private-reset-css-Xuajs1" style="width: 100%; position: relative;"></div></div></div></div><div data-testid="form-row" class="needsclick  kl-private-reset-css-Xuajs1" style="display: flex; flex-direction: row; align-items: stretch; position: relative;"><div component="[object Object]" data-testid="form-component" class="needsclick  kl-private-reset-css-Xuajs1" style="display: flex; justify-content: flex-start; padding: 5px 6px 0px; position: relative; flex: 1 0 0px;"><div class="needsclick  kl-private-reset-css-Xuajs1" style="display: flex; flex-grow: 1; flex-direction: column; align-self: flex-end;"><input id="email_01J93WRWMT1CY00Y7K56JGXET6" class="needsclick go4117816934 kl-private-reset-css-Xuajs1" type="email" autocomplete="email" name="email" tabindex="0" placeholder="Email" aria-label="Email" aria-required="true" aria-invalid="false" options="[object Object]" style="box-sizing: border-box; border-radius: 2px; padding: 0px 0px 0px 16px; height: 50px; text-align: left; color: rgb(0, 0, 0); font-family: Rubik, &quot;Lucida Sans&quot;, &quot;Lucida Sans Unicode&quot;, Geneva, Verdana, sans-serif; font-size: 14px; font-weight: 300; letter-spacing: 0px; background-color: rgb(255, 255, 255); border: 1px solid rgb(96, 106, 114);"><div class="needsclick  kl-private-reset-css-Xuajs1" style="width: 100%; position: relative;"></div></div></div></div><div data-testid="form-row" class="needsclick  kl-private-reset-css-Xuajs1" style="display: flex; flex-direction: row; align-items: stretch; position: relative;"><div component="[object Object]" data-testid="form-component" class="needsclick  kl-private-reset-css-Xuajs1" style="display: flex; justify-content: flex-start; padding: 10px 6px; position: relative; background-color: rgba(255, 255, 255, 0); flex: 1 0 0px;"><button class="needsclick go879326207 kl-private-reset-css-Xuajs1" type="button" tabindex="0" style="background: rgb(247, 242, 232); border-radius: 9px; border-style: solid; border-color: rgb(247, 242, 232); border-width: 6px; color: rgb(11, 70, 76); font-family: Rubik, &quot;Lucida Sans&quot;, &quot;Lucida Sans Unicode&quot;, Geneva, Verdana, sans-serif; font-size: 18px; font-weight: 600; letter-spacing: 0px; line-height: 1; font-style: normal; white-space: normal; padding-top: 11px; padding-bottom: 11px; text-align: center; word-break: break-word; align-self: flex-end; cursor: pointer; pointer-events: auto; height: auto; width: 100%;">GET YOUR DISCOUNT</button></div></div></div><div class="needsclick  kl-private-reset-css-Xuajs1" style="display: flex; flex-direction: column; width: 300px; margin: -20px -15px -20px 0px; padding: 0px; border-top: 0px solid transparent; border-right: 0px solid transparent; border-bottom: 0px solid transparent; border-left: 0px; border-bottom-right-radius: 4px; border-top-right-radius: 4px; overflow: hidden; min-width: 300px; min-height: 300px;"><div class="needsclick  kl-private-reset-css-Xuajs1" style="width: 100%; height: 100%; position: relative;"><img src="./CleanCo UK_files/1d210f37-5a98-4d90-95f5-97b338a08377.jpeg" class="needsclick  kl-private-reset-css-Xuajs1" style="width: 100%; height: 100%; object-fit: cover; object-position: center center;"></div></div><input type="submit" tabindex="-1" value="Submit" style="display: none;"></form></div></div></div></div></div></div></div></div><script type="text/javascript" defer="defer" src="./CleanCo UK_files/75084.js.download"></script><div id="swell-overlay"></div><iframe id="swell-popup" class="yui3-cssreset" onload="spapi.loadFiles()" title="loyalty popup" src="./CleanCo UK_files/saved_resource.html"><div style='width:100%;height:100%;background-color:white;text-align:center;'></div></iframe><div class="swell-tab" style="height: 40px; width: 110px; text-align: center; cursor: pointer; font-family: &quot;Open Sans&quot;; color: white; font-size: 15px; font-weight: 400; border-radius: 0px; padding-top: 0px; border: 0px solid rgb(0, 0, 0); background-color: black; inset: auto; margin: 0px; display: none;">Refer Friends</div></body><div id="tella-plugin"><template shadowrootmode="open"><div style="font-size: 16px; font-weight: 400; user-select: none"></div><link rel="stylesheet" type="text/css" href="chrome-extension://enejkfhimljloggnimhebadbjajhgkad/build/index.css"></template></div><grammarly-desktop-integration data-grammarly-shadow-root="true"><template shadowrootmode="open"><style>
      div.grammarly-desktop-integration {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select:none;
        user-select:none;
      }

      div.grammarly-desktop-integration:before {
        content: attr(data-content);
      }
    </style><div aria-label="grammarly-integration" role="group" tabindex="-1" class="grammarly-desktop-integration" data-content="{&quot;mode&quot;:&quot;full&quot;,&quot;isActive&quot;:true,&quot;isUserDisabled&quot;:false}"></div></template></grammarly-desktop-integration></html>